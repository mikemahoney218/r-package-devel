From matthewwolak at gmail.com  Wed Jul  1 11:38:23 2015
From: matthewwolak at gmail.com (Matthew Wolak)
Date: Wed, 1 Jul 2015 10:38:23 +0100
Subject: [R-pkg-devel] package in 'Enhances' not in a repository
Message-ID: <CAKmSfSgWb163oCv=K9Jb1fsLzh3_OXiYqH=vkpdoHaTyh+yQnw@mail.gmail.com>

Hello all,

I maintain the 'nadiv' package on CRAN and am unsure how best to comply
with CRAN policy/not waste CRAN maintainers' time with respect to
structuring my DESCRIPTION file to link with an R package not available in
a public repository. (Note, this is slightly different from a recent
discussion in this forum:
https://stat.ethz.ch/pipermail/r-package-devel/2015q2/000002.html). For
reference, you can browse the 'nadiv' package source or download it from
GitHub (https://github.com/matthewwolak/nadiv).

My issue is that I have a few functions in nadiv that can be used with
model output from the 'asreml' package, which is an R implementation of the
ASReml software (available from VSN International) for which one must
purchase a license to download/use. Thus, asreml is not available in any
form of a repository for which we can point R to manage this package.
However, I have asreml listed under 'Enhances' as well as providing details
where to obtain asreml in the 'Details' sections of the DESCRIPTION file. I
do not have an 'Additional_repositories' field, as I do not think it
appropriate in this case (happy to be told otherwise). As per CRAN policy:

  "Packages on which a CRAN package depends should be available from a
mainstream repository: if any mentioned in ?Suggests? or ?Enhances? fields
are not from such a repository, where to obtain them at a repository should
be specified in an ?Additional_repositories? field of the DESCRIPTION file
(as a comma-separated list of repository URLs) or for other means of
access, described in the ?Description? field."

So I think I fall into the last phrase of this chunk. However, this will
always create the following Note when checking the package:
     checking package dependencies ... NOTE
     Package which this enhances but not available for checking: ?asreml?

and the CRAN folks have e-mailed me about this. My question, then, is there
any way I can avoid the Note so that (A) it is easier to submit updates and
(B) I don't periodically waste the CRAN maintainers' time when they have to
e-mail me regarding this point?

I should say that most of the functionality and purpose of the nadiv
package is not to facilitate the use of the asreml R package, that is just
a minor extension I have added for convenience. I have considered just
creating a standalone package to move only the functions dealing with
asreml - however, I would still have this same problem. So either way, it
would be nice to know of a good resolution. Thanks for any help!!

Sincerely,
Matthew

	[[alternative HTML version deleted]]


From ligges at statistik.tu-dortmund.de  Wed Jul  1 23:39:21 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 01 Jul 2015 23:39:21 +0200
Subject: [R-pkg-devel] package in 'Enhances' not in a repository
In-Reply-To: <CAKmSfSgWb163oCv=K9Jb1fsLzh3_OXiYqH=vkpdoHaTyh+yQnw@mail.gmail.com>
References: <CAKmSfSgWb163oCv=K9Jb1fsLzh3_OXiYqH=vkpdoHaTyh+yQnw@mail.gmail.com>
Message-ID: <55945E09.6070407@statistik.tu-dortmund.de>



On 01.07.2015 11:38, Matthew Wolak wrote:
> Hello all,
>
> I maintain the 'nadiv' package on CRAN and am unsure how best to comply
> with CRAN policy/not waste CRAN maintainers' time with respect to
> structuring my DESCRIPTION file to link with an R package not available in
> a public repository. (Note, this is slightly different from a recent
> discussion in this forum:
> https://stat.ethz.ch/pipermail/r-package-devel/2015q2/000002.html). For
> reference, you can browse the 'nadiv' package source or download it from
> GitHub (https://github.com/matthewwolak/nadiv).
>
> My issue is that I have a few functions in nadiv that can be used with
> model output from the 'asreml' package, which is an R implementation of the
> ASReml software (available from VSN International) for which one must
> purchase a license to download/use. Thus, asreml is not available in any
> form of a repository for which we can point R to manage this package.
> However, I have asreml listed under 'Enhances' as well as providing details
> where to obtain asreml in the 'Details' sections of the DESCRIPTION file. I
> do not have an 'Additional_repositories' field, as I do not think it
> appropriate in this case (happy to be told otherwise). As per CRAN policy:
>
>    "Packages on which a CRAN package depends should be available from a
> mainstream repository: if any mentioned in ?Suggests? or ?Enhances? fields
> are not from such a repository, where to obtain them at a repository should
> be specified in an ?Additional_repositories? field of the DESCRIPTION file
> (as a comma-separated list of repository URLs) or for other means of
> access, described in the ?Description? field."
>
> So I think I fall into the last phrase of this chunk. However, this will
> always create the following Note when checking the package:
>       checking package dependencies ... NOTE
>       Package which this enhances but not available for checking: ?asreml?
>
> and the CRAN folks have e-mailed me about this. My question, then, is there
> any way I can avoid the Note so that (A) it is easier to submit updates and
> (B) I don't periodically waste the CRAN maintainers' time when they have to
> e-mail me regarding this point?

Please explain in your submission comment that the web address is 
provided in the Description of the package and use the full URL 
(inlcuding "http://").

Best,
Uwe Ligges

>
> I should say that most of the functionality and purpose of the nadiv
> package is not to facilitate the use of the asreml R package, that is just
> a minor extension I have added for convenience. I have considered just
> creating a standalone package to move only the functions dealing with
> asreml - however, I would still have this same problem. So either way, it
> would be nice to know of a good resolution. Thanks for any help!!
>
> Sincerely,
> Matthew
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From mfay at niaid.nih.gov  Thu Jul  2 16:51:21 2015
From: mfay at niaid.nih.gov (Fay, Michael (NIH/NIAID) [E])
Date: Thu, 2 Jul 2015 14:51:21 +0000
Subject: [R-pkg-devel] RCMD check --as-cran on Windows
Message-ID: <F064307CEF0BC64593398B58FBE7EC6610306D13@msgb07.nih.gov>

Hi,

I am trying to update my NAMESPACE to include importFrom for packages that are included in the basic R distribution.

When I build my packages and run: RMCD check --as-cran  on from Windows I get no NOTES. But   in other flavors, there are NOTES about "no visible global function definition for...".

For example, see

ftp://cran.r-project.org/pub/R/web/checks/check_results_bpcp.html

I can get the NOTES from the website and attempt to fix them. But I cannot check them on my Windows machine since I have not installed linux on it.

Is there a way to check for those NOTES without installing another operating system?


mike



**************************************
Michael P. Fay, PhD
Mathematical Statistician
Biostatistics Research Branch/DCR/NIAID
5601 Fishers Lane,  Room 4B53
Rockville, MD 20852
240-669-5228

For FexEx/UPS use:
Rockville, MD 20852

For US Mail use:
Bethesda, MD 20892

Disclaimer: The information in this e-mail and any of its attachments is confidential and may contain sensitive information.  It should not be used by anyone who is not the original intended recipient.  If you have received this e-mail in error please inform the sender and delete it from your mailbox or any other storage devices.  The National Institute of Allergy and Infectious Diseases (NIAID)  shall not accept liability for any statement made that are the sender's own and not expressly made on behalf of the NIAID by one of its representatives.



	[[alternative HTML version deleted]]


From avraham.adler at gmail.com  Thu Jul  2 16:59:25 2015
From: avraham.adler at gmail.com (Avraham Adler)
Date: Thu, 2 Jul 2015 10:59:25 -0400
Subject: [R-pkg-devel] RCMD check --as-cran on Windows
In-Reply-To: <F064307CEF0BC64593398B58FBE7EC6610306D13@msgb07.nih.gov>
References: <F064307CEF0BC64593398B58FBE7EC6610306D13@msgb07.nih.gov>
Message-ID: <CAL6gwnKVaqkfT=dLABbkMAeRJWfDjSqhC1BgqBmL-=kL1H239w@mail.gmail.com>

If it helps, in my experience, r-devel has those notes as well, so if you
send your package to the r-devel option on winbuilder, and it comes back
clean, you should be OK on all OSs, at least as respects the global
function issues.

Avi

On Thu, Jul 2, 2015 at 10:51 AM, Fay, Michael (NIH/NIAID) [E] <
mfay at niaid.nih.gov> wrote:

> Hi,
>
> I am trying to update my NAMESPACE to include importFrom for packages that
> are included in the basic R distribution.
>
> When I build my packages and run: RMCD check --as-cran  on from Windows I
> get no NOTES. But   in other flavors, there are NOTES about "no visible
> global function definition for...".
>
> For example, see
>
> ftp://cran.r-project.org/pub/R/web/checks/check_results_bpcp.html
>
> I can get the NOTES from the website and attempt to fix them. But I cannot
> check them on my Windows machine since I have not installed linux on it.
>
> Is there a way to check for those NOTES without installing another
> operating system?
>
>
> mike
>
>
>
> **************************************
> Michael P. Fay, PhD
> Mathematical Statistician
> Biostatistics Research Branch/DCR/NIAID
> 5601 Fishers Lane,  Room 4B53
> Rockville, MD 20852
> 240-669-5228
>
> For FexEx/UPS use:
> Rockville, MD 20852
>
> For US Mail use:
> Bethesda, MD 20892
>
> Disclaimer: The information in this e-mail and any of its attachments is
> confidential and may contain sensitive information.  It should not be used
> by anyone who is not the original intended recipient.  If you have received
> this e-mail in error please inform the sender and delete it from your
> mailbox or any other storage devices.  The National Institute of Allergy
> and Infectious Diseases (NIAID)  shall not accept liability for any
> statement made that are the sender's own and not expressly made on behalf
> of the NIAID by one of its representatives.
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ligges at statistik.tu-dortmund.de  Thu Jul  2 17:05:21 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 02 Jul 2015 17:05:21 +0200
Subject: [R-pkg-devel] RCMD check --as-cran on Windows
In-Reply-To: <CAL6gwnKVaqkfT=dLABbkMAeRJWfDjSqhC1BgqBmL-=kL1H239w@mail.gmail.com>
References: <F064307CEF0BC64593398B58FBE7EC6610306D13@msgb07.nih.gov>
	<CAL6gwnKVaqkfT=dLABbkMAeRJWfDjSqhC1BgqBmL-=kL1H239w@mail.gmail.com>
Message-ID: <55955331.4050109@statistik.tu-dortmund.de>



On 02.07.2015 16:59, Avraham Adler wrote:
> If it helps, in my experience, r-devel has those notes as well, so if you
> send your package to the r-devel option on winbuilder, and it comes back
> clean, you should be OK on all OSs, at least as respects the global
> function issues.

Right, use a recent version of R-devel and --as-cran flag.

Best,
Uwe Ligges


>
> Avi
>
> On Thu, Jul 2, 2015 at 10:51 AM, Fay, Michael (NIH/NIAID) [E] <
> mfay at niaid.nih.gov> wrote:
>
>> Hi,
>>
>> I am trying to update my NAMESPACE to include importFrom for packages that
>> are included in the basic R distribution.
>>
>> When I build my packages and run: RMCD check --as-cran  on from Windows I
>> get no NOTES. But   in other flavors, there are NOTES about "no visible
>> global function definition for...".
>>
>> For example, see
>>
>> ftp://cran.r-project.org/pub/R/web/checks/check_results_bpcp.html
>>
>> I can get the NOTES from the website and attempt to fix them. But I cannot
>> check them on my Windows machine since I have not installed linux on it.
>>
>> Is there a way to check for those NOTES without installing another
>> operating system?
>>
>>
>> mike
>>
>>
>>
>> **************************************
>> Michael P. Fay, PhD
>> Mathematical Statistician
>> Biostatistics Research Branch/DCR/NIAID
>> 5601 Fishers Lane,  Room 4B53
>> Rockville, MD 20852
>> 240-669-5228
>>
>> For FexEx/UPS use:
>> Rockville, MD 20852
>>
>> For US Mail use:
>> Bethesda, MD 20892
>>
>> Disclaimer: The information in this e-mail and any of its attachments is
>> confidential and may contain sensitive information.  It should not be used
>> by anyone who is not the original intended recipient.  If you have received
>> this e-mail in error please inform the sender and delete it from your
>> mailbox or any other storage devices.  The National Institute of Allergy
>> and Infectious Diseases (NIAID)  shall not accept liability for any
>> statement made that are the sender's own and not expressly made on behalf
>> of the NIAID by one of its representatives.
>>
>>
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From murdoch.duncan at gmail.com  Thu Jul  2 23:24:02 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 02 Jul 2015 23:24:02 +0200
Subject: [R-pkg-devel] RCMD check --as-cran on Windows
In-Reply-To: <F064307CEF0BC64593398B58FBE7EC6610306D13@msgb07.nih.gov>
References: <F064307CEF0BC64593398B58FBE7EC6610306D13@msgb07.nih.gov>
Message-ID: <5595ABF2.7080805@gmail.com>

On 02/07/2015 4:51 PM, Fay, Michael (NIH/NIAID) [E] wrote:
> Hi,
> 
> I am trying to update my NAMESPACE to include importFrom for packages that are included in the basic R distribution.
> 
> When I build my packages and run: RMCD check --as-cran  on from Windows I get no NOTES. But   in other flavors, there are NOTES about "no visible global function definition for...".
> 
> For example, see
> 
> ftp://cran.r-project.org/pub/R/web/checks/check_results_bpcp.html
> 
> I can get the NOTES from the website and attempt to fix them. But I cannot check them on my Windows machine since I have not installed linux on it.
> 
> Is there a way to check for those NOTES without installing another operating system?
> 

R-devel is the development version of R.  It changes every day.  Saying
R-devel doesn't work for you is ambiguous:  you need to tell us which
version you used.  The latest one available for download is 2015-07-02
r68620.

Duncan Murdoch


From pgilbert902 at gmail.com  Fri Jul  3 04:46:43 2015
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Thu, 02 Jul 2015 22:46:43 -0400
Subject: [R-pkg-devel] download.file and https
Message-ID: <5595F793.7060005@gmail.com>

(This problem with download.file() affects quantmod, and possibly 
several other packages. e.g. getSymbols('M2',src='FRED') fails.)

I think the St Louis Fed has moved to using https for connections, and I 
believe all the US government web sites are doing this. An http request 
is automatically switched to https. The default download.file method 
does not seem to handle this, but method="wget" does:

 >  tmp <- tempfile()
 > 
download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv", 
destfile = tmp)
trying URL 
'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
Error in 
download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv", 
  :
   cannot open URL 
'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
 >
 >
 > 
download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv", 
destfile = tmp, method="wget")
--2015-07-02 22:29:49-- 
http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
Resolving research.stlouisfed.org (research.stlouisfed.org)... 65.89.18.120
Connecting to research.stlouisfed.org 
(research.stlouisfed.org)|65.89.18.120|:80... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: 
https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv 
[following]
--2015-07-02 22:29:49-- 
https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
Connecting to research.stlouisfed.org 
(research.stlouisfed.org)|65.89.18.120|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/x-comma-separated-values]
Saving to: ?/tmp/RtmpOX7kA1/file1ba639d7fd0f?

     [ <=>                                   ] 34,519       178KB/s   in 
0.2s

2015-07-02 22:29:50 (178 KB/s) - ?/tmp/RtmpOX7kA1/file1ba639d7fd0f? 
saved [34519]

Paul


From josh.m.ulrich at gmail.com  Fri Jul  3 05:07:29 2015
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Thu, 2 Jul 2015 22:07:29 -0500
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <5595F793.7060005@gmail.com>
References: <5595F793.7060005@gmail.com>
Message-ID: <CAPPM_gROcOJkgTZpN-+u3BesX=AKBBYxber2XyOt=0EzmrLoCw@mail.gmail.com>

Hi Paul,

On Thu, Jul 2, 2015 at 9:46 PM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
> (This problem with download.file() affects quantmod, and possibly several
> other packages. e.g. getSymbols('M2',src='FRED') fails.)
>
Thanks for the note.  I'm aware of this, and actually wanted to ask
this list what the "best practice" was for downloading files from
https URLs.

> I think the St Louis Fed has moved to using https for connections, and I
> believe all the US government web sites are doing this. An http request is
> automatically switched to https. The default download.file method does not
> seem to handle this, but method="wget" does:
>
IIUC, only if your system has wget installed and it is on the search
path.  Another user has suggested setting method="curl", but that has
the same limitations.  I could use RCurl to access these files from
FRED, but I'd prefer a solution that doesn't require an additional
package dependency, if possible.

I don't have a lot of experience with downloading from https URLs in R
(especially on Windows) so I would really appreciate some pointers on
how best to handle this.

>>  tmp <- tempfile()
>>
>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>> destfile = tmp)
> trying URL
> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
> Error in
> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
> :
>   cannot open URL
> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
>>
>>
>>
>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>> destfile = tmp, method="wget")
<snip wget output>
> [34519]
>
> Paul



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From pgilbert902 at gmail.com  Fri Jul  3 05:24:28 2015
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Thu, 02 Jul 2015 23:24:28 -0400
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>
References: <5595F793.7060005@gmail.com>
	<CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>
Message-ID: <5596006C.60605@gmail.com>



On 07/02/2015 10:52 PM, Henrik Bengtsson wrote:
>  From R 3.2.0, check:
>
>> capabilities("libcurl")
> libcurl
>     TRUE
>
> TRUE means R was built such that HTTPS is supported.  If you see
> FALSE, make sure libcurl is available when/if you build R from source.

I do have TRUE for this. The default behaviour still does not work.

Paul

>
> /Henrik
>
> On Thu, Jul 2, 2015 at 7:46 PM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
>> (This problem with download.file() affects quantmod, and possibly several
>> other packages. e.g. getSymbols('M2',src='FRED') fails.)
>>
>> I think the St Louis Fed has moved to using https for connections, and I
>> believe all the US government web sites are doing this. An http request is
>> automatically switched to https. The default download.file method does not
>> seem to handle this, but method="wget" does:
>>
>>>   tmp <- tempfile()
>>>
>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>> destfile = tmp)
>> trying URL
>> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
>> Error in
>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>> :
>>    cannot open URL
>> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
>>>
>>>
>>>
>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>> destfile = tmp, method="wget")
>> --2015-07-02 22:29:49--
>> http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>> Resolving research.stlouisfed.org (research.stlouisfed.org)... 65.89.18.120
>> Connecting to research.stlouisfed.org
>> (research.stlouisfed.org)|65.89.18.120|:80... connected.
>> HTTP request sent, awaiting response... 301 Moved Permanently
>> Location:
>> https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>> [following]
>> --2015-07-02 22:29:49--
>> https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>> Connecting to research.stlouisfed.org
>> (research.stlouisfed.org)|65.89.18.120|:443... connected.
>> HTTP request sent, awaiting response... 200 OK
>> Length: unspecified [text/x-comma-separated-values]
>> Saving to: ?/tmp/RtmpOX7kA1/file1ba639d7fd0f?
>>
>>      [ <=>                                   ] 34,519       178KB/s   in 0.2s
>>
>> 2015-07-02 22:29:50 (178 KB/s) - ?/tmp/RtmpOX7kA1/file1ba639d7fd0f? saved
>> [34519]
>>
>> Paul
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch.duncan at gmail.com  Fri Jul  3 05:52:15 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 03 Jul 2015 05:52:15 +0200
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <5596006C.60605@gmail.com>
References: <5595F793.7060005@gmail.com>	<CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>
	<5596006C.60605@gmail.com>
Message-ID: <559606EF.7010901@gmail.com>

On 03/07/2015 5:24 AM, Paul Gilbert wrote:
> 
> 
> On 07/02/2015 10:52 PM, Henrik Bengtsson wrote:
>>  From R 3.2.0, check:
>>
>>> capabilities("libcurl")
>> libcurl
>>     TRUE
>>
>> TRUE means R was built such that HTTPS is supported.  If you see
>> FALSE, make sure libcurl is available when/if you build R from source.
> 
> I do have TRUE for this. The default behaviour still does not work.

Have you tried specifying the protocol explicitly, i.e.

 download.file("https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv", destfile = tmp, method="libcurl")

?

Duncan Murdoch

> 
> Paul
> 
>>
>> /Henrik
>>
>> On Thu, Jul 2, 2015 at 7:46 PM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
>>> (This problem with download.file() affects quantmod, and possibly several
>>> other packages. e.g. getSymbols('M2',src='FRED') fails.)
>>>
>>> I think the St Louis Fed has moved to using https for connections, and I
>>> believe all the US government web sites are doing this. An http request is
>>> automatically switched to https. The default download.file method does not
>>> seem to handle this, but method="wget" does:
>>>
>>>>   tmp <- tempfile()
>>>>
>>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>>> destfile = tmp)
>>> trying URL
>>> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
>>> Error in
>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>> :
>>>    cannot open URL
>>> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
>>>>
>>>>
>>>>
>>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>>> destfile = tmp, method="wget")
>>> --2015-07-02 22:29:49--
>>> http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>>> Resolving research.stlouisfed.org (research.stlouisfed.org)... 65.89.18.120
>>> Connecting to research.stlouisfed.org
>>> (research.stlouisfed.org)|65.89.18.120|:80... connected.
>>> HTTP request sent, awaiting response... 301 Moved Permanently
>>> Location:
>>> https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>>> [following]
>>> --2015-07-02 22:29:49--
>>> https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>>> Connecting to research.stlouisfed.org
>>> (research.stlouisfed.org)|65.89.18.120|:443... connected.
>>> HTTP request sent, awaiting response... 200 OK
>>> Length: unspecified [text/x-comma-separated-values]
>>> Saving to: ?/tmp/RtmpOX7kA1/file1ba639d7fd0f?
>>>
>>>      [ <=>                                   ] 34,519       178KB/s   in 0.2s
>>>
>>> 2015-07-02 22:29:50 (178 KB/s) - ?/tmp/RtmpOX7kA1/file1ba639d7fd0f? saved
>>> [34519]
>>>
>>> Paul
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From pgilbert902 at gmail.com  Fri Jul  3 06:05:16 2015
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Fri, 03 Jul 2015 00:05:16 -0400
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <559606EF.7010901@gmail.com>
References: <5595F793.7060005@gmail.com>	<CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>
	<5596006C.60605@gmail.com> <559606EF.7010901@gmail.com>
Message-ID: <559609FC.5070608@gmail.com>



On 07/02/2015 11:52 PM, Duncan Murdoch wrote:
> On 03/07/2015 5:24 AM, Paul Gilbert wrote:
>>
>>
>> On 07/02/2015 10:52 PM, Henrik Bengtsson wrote:
>>>   From R 3.2.0, check:
>>>
>>>> capabilities("libcurl")
>>> libcurl
>>>      TRUE
>>>
>>> TRUE means R was built such that HTTPS is supported.  If you see
>>> FALSE, make sure libcurl is available when/if you build R from source.
>>
>> I do have TRUE for this. The default behaviour still does not work.
>
> Have you tried specifying the protocol explicitly, i.e.
>
>   download.file("https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv", destfile = tmp, method="libcurl")
>
> ?

Yes. The default does not accept a string with https.  It gives 
"unsupported URL scheme".

A few people have mentioned workarounds or setting options. But, as 
Joshua mentioned, the question is really about best practice to make a 
package robust on all platforms, and tests that pass on CRAN.

Paul

>
> Duncan Murdoch
>
>>
>> Paul
>>
>>>
>>> /Henrik
>>>
>>> On Thu, Jul 2, 2015 at 7:46 PM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
>>>> (This problem with download.file() affects quantmod, and possibly several
>>>> other packages. e.g. getSymbols('M2',src='FRED') fails.)
>>>>
>>>> I think the St Louis Fed has moved to using https for connections, and I
>>>> believe all the US government web sites are doing this. An http request is
>>>> automatically switched to https. The default download.file method does not
>>>> seem to handle this, but method="wget" does:
>>>>
>>>>>    tmp <- tempfile()
>>>>>
>>>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>>>> destfile = tmp)
>>>> trying URL
>>>> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
>>>> Error in
>>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>>> :
>>>>     cannot open URL
>>>> 'http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv'
>>>>>
>>>>>
>>>>>
>>>>> download.file("http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv",
>>>>> destfile = tmp, method="wget")
>>>> --2015-07-02 22:29:49--
>>>> http://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>>>> Resolving research.stlouisfed.org (research.stlouisfed.org)... 65.89.18.120
>>>> Connecting to research.stlouisfed.org
>>>> (research.stlouisfed.org)|65.89.18.120|:80... connected.
>>>> HTTP request sent, awaiting response... 301 Moved Permanently
>>>> Location:
>>>> https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>>>> [following]
>>>> --2015-07-02 22:29:49--
>>>> https://research.stlouisfed.org/fred2/series/M2/downloaddata/M2.csv
>>>> Connecting to research.stlouisfed.org
>>>> (research.stlouisfed.org)|65.89.18.120|:443... connected.
>>>> HTTP request sent, awaiting response... 200 OK
>>>> Length: unspecified [text/x-comma-separated-values]
>>>> Saving to: ?/tmp/RtmpOX7kA1/file1ba639d7fd0f?
>>>>
>>>>       [ <=>                                   ] 34,519       178KB/s   in 0.2s
>>>>
>>>> 2015-07-02 22:29:50 (178 KB/s) - ?/tmp/RtmpOX7kA1/file1ba639d7fd0f? saved
>>>> [34519]
>>>>
>>>> Paul
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>


From edd at debian.org  Fri Jul  3 12:39:59 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 3 Jul 2015 05:39:59 -0500
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <559609FC.5070608@gmail.com>
References: <5595F793.7060005@gmail.com>
	<CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>
	<5596006C.60605@gmail.com> <559606EF.7010901@gmail.com>
	<559609FC.5070608@gmail.com>
Message-ID: <21910.26239.507713.866678@max.nulle.part>


In random, I do the following, using R 3.2.0 or later with libcurl where
installed, and Jeroen's lightweight curl::curl otherwise.


getConnection <- function(urltxt, ...) {
    if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
        url(urltxt, ..., method="libcurl")
    } else {
        curl(urltxt, ...)
    }
}

closeConnection <- function(con) {
    if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
        close(con)
    } else {
        ## nothing to be done for curl()
    }
}


Hth,  Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From pgilbert902 at gmail.com  Fri Jul  3 16:24:57 2015
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Fri, 03 Jul 2015 10:24:57 -0400
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <21910.26239.507713.866678@max.nulle.part>
References: <5595F793.7060005@gmail.com>	<CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>	<5596006C.60605@gmail.com>	<559606EF.7010901@gmail.com>	<559609FC.5070608@gmail.com>
	<21910.26239.507713.866678@max.nulle.part>
Message-ID: <55969B39.3030902@gmail.com>

The difficulty with most workarounds suggested so far is the expanded 
list of dependencies. My package and quantmod, have had a simple 
dependency on download.file in utils. Picking on Dirks suggestion as an 
example, it would add a system dependency on libcurl and an R package 
dependency on curl, which in turn has system dependencies libcurl-devel 
(rpm) or libcurl4-openssl-dev (deb). Furthermore, it suggests testthat, 
knitr, jsonlite, rmarkdown, and magrittr, which means that these and 
their dependencies, imports, and suggests all need to be installed and 
working in order for me to test, and working with R-devel for me to 
submit to CRAN.

Let me mention again that this problem is not specific to my package or 
quantmod. It will be quickly affecting everyone that downloads from US 
government websites, not to mention that other governments and 
commercial web sites may start doing the same thing.

Paul

On 07/03/2015 06:39 AM, Dirk Eddelbuettel wrote:
>
> In random, I do the following, using R 3.2.0 or later with libcurl where
> installed, and Jeroen's lightweight curl::curl otherwise.
>
>
> getConnection <- function(urltxt, ...) {
>      if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
>          url(urltxt, ..., method="libcurl")
>      } else {
>          curl(urltxt, ...)
>      }
> }
>
> closeConnection <- function(con) {
>      if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
>          close(con)
>      } else {
>          ## nothing to be done for curl()
>      }
> }
>
>
> Hth,  Dirk
>


From winstonchang1 at gmail.com  Fri Jul  3 17:07:11 2015
From: winstonchang1 at gmail.com (Winston Chang)
Date: Fri, 3 Jul 2015 10:07:11 -0500
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <55969B39.3030902@gmail.com>
References: <5595F793.7060005@gmail.com>
	<CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>
	<5596006C.60605@gmail.com> <559606EF.7010901@gmail.com>
	<559609FC.5070608@gmail.com>
	<21910.26239.507713.866678@max.nulle.part> <55969B39.3030902@gmail.com>
Message-ID: <CAFOpNVEvx=8rukxzdCq7qKQgGZKcG-VjOzX8BJtRhAPC2zTtbg@mail.gmail.com>

My downloader package was created to deal with https on various platforms:
  http://cran.r-project.org/web/packages/downloader/index.html

The package dates back to before R had libcurl support. It's very
simple: if you're on Windows, it uses setInternet2(), which enable
https support, and if you're on non-Windows, it looks for wget, curl,
and then lynx.

You don't have to import downloader in order to do this - there's just
one function you'd need, which, as far as I'm concerned, you can put
in your code:
  https://github.com/wch/downloader/blob/master/R/download.r

If you need the code to officially relicensed, feel free to contact me by email.

-Winston




On Fri, Jul 3, 2015 at 9:24 AM, Paul Gilbert <pgilbert902 at gmail.com> wrote:
> The difficulty with most workarounds suggested so far is the expanded list
> of dependencies. My package and quantmod, have had a simple dependency on
> download.file in utils. Picking on Dirks suggestion as an example, it would
> add a system dependency on libcurl and an R package dependency on curl,
> which in turn has system dependencies libcurl-devel (rpm) or
> libcurl4-openssl-dev (deb). Furthermore, it suggests testthat, knitr,
> jsonlite, rmarkdown, and magrittr, which means that these and their
> dependencies, imports, and suggests all need to be installed and working in
> order for me to test, and working with R-devel for me to submit to CRAN.
>
> Let me mention again that this problem is not specific to my package or
> quantmod. It will be quickly affecting everyone that downloads from US
> government websites, not to mention that other governments and commercial
> web sites may start doing the same thing.
>
> Paul
>
> On 07/03/2015 06:39 AM, Dirk Eddelbuettel wrote:
>>
>>
>> In random, I do the following, using R 3.2.0 or later with libcurl where
>> installed, and Jeroen's lightweight curl::curl otherwise.
>>
>>
>> getConnection <- function(urltxt, ...) {
>>      if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
>>          url(urltxt, ..., method="libcurl")
>>      } else {
>>          curl(urltxt, ...)
>>      }
>> }
>>
>> closeConnection <- function(con) {
>>      if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
>>          close(con)
>>      } else {
>>          ## nothing to be done for curl()
>>      }
>> }
>>
>>
>> Hth,  Dirk
>>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd at debian.org  Fri Jul  3 17:25:40 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 3 Jul 2015 10:25:40 -0500
Subject: [R-pkg-devel] download.file and https
In-Reply-To: <55969B39.3030902@gmail.com>
References: <5595F793.7060005@gmail.com>
	<CAFDcVCSTTycg7ccWr6U5Y=kBtwjSBXcA4z-TGKXBX7Gh8G8XOw@mail.gmail.com>
	<5596006C.60605@gmail.com> <559606EF.7010901@gmail.com>
	<559609FC.5070608@gmail.com>
	<21910.26239.507713.866678@max.nulle.part>
	<55969B39.3030902@gmail.com>
Message-ID: <21910.43380.915497.207096@max.nulle.part>


On 3 July 2015 at 10:24, Paul Gilbert wrote:
| The difficulty with most workarounds suggested so far is the expanded 
| list of dependencies. My package and quantmod, have had a simple 
| dependency on download.file in utils. Picking on Dirks suggestion as an 
| example, it would add a system dependency on libcurl and an R package 
| dependency on curl, which in turn has system dependencies libcurl-devel 
| (rpm) or libcurl4-openssl-dev (deb). Furthermore, it suggests testthat, 

Well but you cannot have https without these.

Moreover, Depends != Suggests.  That really matters.

| knitr, jsonlite, rmarkdown, and magrittr, which means that these and 
| their dependencies, imports, and suggests all need to be installed and 
| working in order for me to test, and working with R-devel for me to 
| submit to CRAN.

Not my experience.

The .travis.yml I use for random (still) installs curl from source, yet is
done in under a minute.  I never remember whether others can browse my test
history but try

   https://travis-ci.org/eddelbuettel/random/builds   

As Michael Rutter has curl in his cran2deb4ubuntu PPA knows by the R-Travis
setup, I might as well install his r-cran-curl which would make this yet a
little faster.
 
| Let me mention again that this problem is not specific to my package or 
| quantmod. It will be quickly affecting everyone that downloads from US 
| government websites, not to mention that other governments and 
| commercial web sites may start doing the same thing.

Use of curl (to provide https) will become much more common. R now supports
it in R 3.2.0, but only as optional build-time choice.  With that I find
Jeroen's package a pretty good choice.

But that is of course just one suggestion, and if it doesn't work for you I
fully understand.  I was faced with the exact same problem -- Mads switched
random.org to https-only -- and would like to see what other suggestions
people may have.

Dirk
 
| Paul
| 
| On 07/03/2015 06:39 AM, Dirk Eddelbuettel wrote:
| >
| > In random, I do the following, using R 3.2.0 or later with libcurl where
| > installed, and Jeroen's lightweight curl::curl otherwise.
| >
| >
| > getConnection <- function(urltxt, ...) {
| >      if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
| >          url(urltxt, ..., method="libcurl")
| >      } else {
| >          curl(urltxt, ...)
| >      }
| > }
| >
| > closeConnection <- function(con) {
| >      if (getRversion() >= "3.2.0" && capabilities()["libcurl"]) {
| >          close(con)
| >      } else {
| >          ## nothing to be done for curl()
| >      }
| > }
| >
| >
| > Hth,  Dirk
| >

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From charlie at stat.umn.edu  Fri Jul  3 23:40:38 2015
From: charlie at stat.umn.edu (Charles Geyer)
Date: Fri, 3 Jul 2015 16:40:38 -0500
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
Message-ID: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>

I am trying to update a CRAN package (rcdd) for the R-3.3.0 requirements.
And I think I have done it.  But

When I do

    R CMD check rcdd

one of the tests crashes (it says it caught a segfault).  I am on an i686
box running Ubuntu 14.04 and the R is the one that comes from

    http://cran.us.r-project.org/bin/linux/ubuntu trusty/

and is up to date.

Fine.  I have a problem.  So start debugging.  But if I

  * run the file that causes the crash with R CMD check by itself,
        it works, no crash
  * run R CMD check --use-valgrind rcdd, it works, no crash
  * run R CMD check --use-gct rcdd, it works no crash
  * use tools::check_packages_in_dir to check the tarball, it works no crash
  * if I run R CMD check with R-3.2.1 or R-devel built from source on this
box,
        it works, no crash

So it seems it is impossible to get the crash except under circumstances
that give almost no debugging info.

What do I do now?

If it helps the tarball in question is

http://users.stat.umn.edu/~geyer/rcdd_1.1-9.tar.gz

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu

	[[alternative HTML version deleted]]


From csardi.gabor at gmail.com  Fri Jul  3 23:44:49 2015
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Fri, 3 Jul 2015 23:44:49 +0200
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
In-Reply-To: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
Message-ID: <CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>

On Fri, Jul 3, 2015 at 11:40 PM, Charles Geyer <charlie at stat.umn.edu> wrote:
[...]

>   * run the file that causes the crash with R CMD check by itself,
>         it works, no crash
>   * run R CMD check --use-valgrind rcdd, it works, no crash
>   * run R CMD check --use-gct rcdd, it works no crash
>   * use tools::check_packages_in_dir to check the tarball, it works no
> crash
>   * if I run R CMD check with R-3.2.1 or R-devel built from source on this
> box,
>         it works, no crash
>
> So it seems it is impossible to get the crash except under circumstances
> that give almost no debugging info.
>
> What do I do now?
>

Idea: look at the actual valgrind output to see if valgrind reports any
errors?

Gabor


>
> If it helps the tarball in question is
>
> http://users.stat.umn.edu/~geyer/rcdd_1.1-9.tar.gz
>
> --
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From charlie at stat.umn.edu  Sat Jul  4 00:16:45 2015
From: charlie at stat.umn.edu (Charles Geyer)
Date: Fri, 3 Jul 2015 17:16:45 -0500
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
In-Reply-To: <CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
Message-ID: <CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>

valgrind reports no errors

On Fri, Jul 3, 2015 at 4:44 PM, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:

> On Fri, Jul 3, 2015 at 11:40 PM, Charles Geyer <charlie at stat.umn.edu>
> wrote:
> [...]
>
>>   * run the file that causes the crash with R CMD check by itself,
>>         it works, no crash
>>   * run R CMD check --use-valgrind rcdd, it works, no crash
>>   * run R CMD check --use-gct rcdd, it works no crash
>>   * use tools::check_packages_in_dir to check the tarball, it works no
>> crash
>>   * if I run R CMD check with R-3.2.1 or R-devel built from source on this
>> box,
>>         it works, no crash
>>
>> So it seems it is impossible to get the crash except under circumstances
>> that give almost no debugging info.
>>
>> What do I do now?
>>
>
> Idea: look at the actual valgrind output to see if valgrind reports any
> errors?
>
> Gabor
>
>
>>
>> If it helps the tarball in question is
>>
>> http://users.stat.umn.edu/~geyer/rcdd_1.1-9.tar.gz
>>
>> --
>> Charles Geyer
>> Professor, School of Statistics
>> University of Minnesota
>> charlie at stat.umn.edu
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
>


-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu

	[[alternative HTML version deleted]]


From glennmschultz at me.com  Sat Jul  4 02:24:15 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Sat, 04 Jul 2015 00:24:15 +0000 (GMT)
Subject: [R-pkg-devel] Saving binary files in a package
Message-ID: <994736bd-e8d4-48d1-83e2-4b84f5f56ca1@me.com>

Hi All,

I am researching the criteria for submitting packages on the R website and using Hadley's packages book as a general guide. ?The CRAN policy is that a package cannot write files. ?My question is as follows:

Does this apply when the package is installed only? ?I ask because my package does not write any files on install. ?However, I have functions that allow the user to create cusip level information to create a MBS security (dated date, first payment date, etc.). ?The function then saves the file as a binary to the appropiate data folder in the package file directories. ?I use the same strategy to save mortgage prepayment model tuning parameters. ?

If the result of the function, after a package is installed, is to save a data file in the package's subdirectories does this violate CRAN policy against writing files? ?I read the policy but I am not 100% sure in this case.

-Glenn

From thierry.onkelinx at inbo.be  Sat Jul  4 09:12:50 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Sat, 4 Jul 2015 09:12:50 +0200
Subject: [R-pkg-devel] Saving binary files in a package
In-Reply-To: <994736bd-e8d4-48d1-83e2-4b84f5f56ca1@me.com>
References: <994736bd-e8d4-48d1-83e2-4b84f5f56ca1@me.com>
Message-ID: <CAJuCY5ziwntwGZiuyTm58AMwju3SOY7No4kwf5irXdUY6+KW5Q@mail.gmail.com>

You have no guarantee that the user has write access to those folders. So
you might want to rethink your strategy.

?
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
Op 4 jul. 2015 05:00 schreef "Glenn Schultz" <glennmschultz at me.com>:

> Hi All,
>
> I am researching the criteria for submitting packages on the R website and
> using Hadley's packages book as a general guide.  The CRAN policy is that a
> package cannot write files.  My question is as follows:
>
> Does this apply when the package is installed only?  I ask because my
> package does not write any files on install.  However, I have functions
> that allow the user to create cusip level information to create a MBS
> security (dated date, first payment date, etc.).  The function then saves
> the file as a binary to the appropiate data folder in the package file
> directories.  I use the same strategy to save mortgage prepayment model
> tuning parameters.
>
> If the result of the function, after a package is installed, is to save a
> data file in the package's subdirectories does this violate CRAN policy
> against writing files?  I read the policy but I am not 100% sure in this
> case.
>
> -Glenn
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From edd at debian.org  Sat Jul  4 10:00:00 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 4 Jul 2015 03:00:00 -0500
Subject: [R-pkg-devel] Saving binary files in a package
In-Reply-To: <CAJuCY5ziwntwGZiuyTm58AMwju3SOY7No4kwf5irXdUY6+KW5Q@mail.gmail.com>
References: <994736bd-e8d4-48d1-83e2-4b84f5f56ca1@me.com>
	<CAJuCY5ziwntwGZiuyTm58AMwju3SOY7No4kwf5irXdUY6+KW5Q@mail.gmail.com>
Message-ID: <21911.37504.428652.35139@max.nulle.part>


On 4 July 2015 at 09:12, Thierry Onkelinx wrote:
| You have no guarantee that the user has write access to those folders. So
| you might want to rethink your strategy.

Seconded. And I am not aware of a good cross-platform solution so your best
bet may be to require the user to specify a filename. 

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd at debian.org  Sat Jul  4 10:35:04 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 4 Jul 2015 03:35:04 -0500
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
In-Reply-To: <CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
Message-ID: <21911.39608.106191.787828@max.nulle.part>


Charles,

I took a look based on your tar ball.  When I use the normal 'loud' setting I
default to for g++ (ie -pedantic -Wall) or clang++ I get more than a page
full of errors.  I just tried it using the UBSAN-via-clang instrumented R I
provide via a docker container (and for which I showed usage during the
'rocker: Docker on R' tutorial preceding useR! -- slides now on my
presentation page).  It also does not segfault, but it shows a test
difference:

  Running ?bar.R?
    Comparing ?bar.Rout? to ?bar.Rout.save? ...8d7
    <
    51,54c50,53
    < [1,]    0    1    0    1    0    0
    < [2,]    0    1    1    0    0    0
    < [3,]    0    1    0    0    1    0
    < [4,]    0    1    0    0    0    1
    ---
    > [1,]    0    1    0    0    0    1
    > [2,]    0    1    0    0    1    0
    > [3,]    0    1    0    1    0    0
    > [4,]    0    1    1    0    0    0
      Running ?bug2.R?
        Comparing ?bug2.Rout? to ?bug2.Rout.save? ...8d7
        <

(You also seem to consistently differ in one newline which is just a nuisance
and not an error,)

So no free lunch yet.  I fear you may have to minimize the package somewhat
to hopefully arrive at minimally reproducible example.  So far you seem to
have a Heisenbug (https://en.wikipedia.org/wiki/Heisenbug)

Sorry I cannot offer more help.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From h.wickham at gmail.com  Sat Jul  4 10:36:07 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sat, 4 Jul 2015 10:36:07 +0200
Subject: [R-pkg-devel] Saving binary files in a package
In-Reply-To: <21911.37504.428652.35139@max.nulle.part>
References: <994736bd-e8d4-48d1-83e2-4b84f5f56ca1@me.com>
	<CAJuCY5ziwntwGZiuyTm58AMwju3SOY7No4kwf5irXdUY6+KW5Q@mail.gmail.com>
	<21911.37504.428652.35139@max.nulle.part>
Message-ID: <CABdHhvEVtkFnrJ9DMrWEhX-E3Eir9t4nj2kuwVu1_9Muuv87-A@mail.gmail.com>

On Sat, Jul 4, 2015 at 10:00 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> On 4 July 2015 at 09:12, Thierry Onkelinx wrote:
> | You have no guarantee that the user has write access to those folders. So
> | you might want to rethink your strategy.
>
> Seconded. And I am not aware of a good cross-platform solution so your best
> bet may be to require the user to specify a filename.

One attempt to correctly locate the right place to save files (i.e.
the user data dir) is
http://cran.r-project.org/web/packages/rappdirs/index.html, a fork of
the python appdirs (https://github.com/ActiveState/appdirs). There's
no guarantee that these places will be writeable, but they're probably
a reasonably good place to start.

Hadley

-- 
http://had.co.nz/


From charlie at stat.umn.edu  Sat Jul  4 17:15:51 2015
From: charlie at stat.umn.edu (Charles Geyer)
Date: Sat, 4 Jul 2015 10:15:51 -0500
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
In-Reply-To: <21911.39608.106191.787828@max.nulle.part>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
	<21911.39608.106191.787828@max.nulle.part>
Message-ID: <CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>

The diff for bar.Rout is OK.  The solution is the same (the two matrices
have the same rows and so determine the same convex polyhedron).  Why it
picks different orders of rows on different machines, I have no idea.

I also saw the pages of warnings from gcc -W -Wall -Wextra but they are all
about unused variables and unused arguments of functions.  AFAIK these are
not real problems.

I should say that I did not write most of the code.  This package is an R
interface to the computational geometry provided by cddlib, which is not
something linux distributions package.  So in order to avoid hassle, I just
included the cddlib code (which is GPL) in the src directory and added its
author Komei Fukuda to the authors of the package.

AFAIK this code is very high quality from a numerical analysis standpoint,
however much it may fall below the coding standards of most C coders.
Anyway it is the only free software computational geometry code I know
about, so it is the only game in town unless statisticians want to just say
"we cannot deal with problems like that".

This code may actually segfault somewhere, but we haven't seen it in
practice unless this is its fault (rather than the 32 bit R-3.2.1 build for
Ubuntu 14.04).  We still don't have a way to tell which to blame.

I am trying to follow the debugging rules (http://debuggingrules.com/) the
most important here being "divide and conquer".  Until we know where the
crash occurs, we are just clueless.

On Sat, Jul 4, 2015 at 3:35 AM, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> Charles,
>
> I took a look based on your tar ball.  When I use the normal 'loud'
> setting I
> default to for g++ (ie -pedantic -Wall) or clang++ I get more than a page
> full of errors.  I just tried it using the UBSAN-via-clang instrumented R I
> provide via a docker container (and for which I showed usage during the
> 'rocker: Docker on R' tutorial preceding useR! -- slides now on my
> presentation page).  It also does not segfault, but it shows a test
> difference:
>
>   Running ?bar.R?
>     Comparing ?bar.Rout? to ?bar.Rout.save? ...8d7
>     <
>     51,54c50,53
>     < [1,]    0    1    0    1    0    0
>     < [2,]    0    1    1    0    0    0
>     < [3,]    0    1    0    0    1    0
>     < [4,]    0    1    0    0    0    1
>     ---
>     > [1,]    0    1    0    0    0    1
>     > [2,]    0    1    0    0    1    0
>     > [3,]    0    1    0    1    0    0
>     > [4,]    0    1    1    0    0    0
>       Running ?bug2.R?
>         Comparing ?bug2.Rout? to ?bug2.Rout.save? ...8d7
>         <
>
> (You also seem to consistently differ in one newline which is just a
> nuisance
> and not an error,)
>
> So no free lunch yet.  I fear you may have to minimize the package somewhat
> to hopefully arrive at minimally reproducible example.  So far you seem to
> have a Heisenbug (https://en.wikipedia.org/wiki/Heisenbug)
>
> Sorry I cannot offer more help.
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>



-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu

	[[alternative HTML version deleted]]


From charlie at stat.umn.edu  Sat Jul  4 17:20:59 2015
From: charlie at stat.umn.edu (Charles Geyer)
Date: Sat, 4 Jul 2015 10:20:59 -0500
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
In-Reply-To: <CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
	<21911.39608.106191.787828@max.nulle.part>
	<CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>
Message-ID: <CAKctRd2vi0Yfvi9nhLFAiCgnOmTamhdort3=h8roJ_K2EMjUKg@mail.gmail.com>

I should add a more direct question.  When a crash occurs ONLY when running
R CMD check, how does one debug that?  Usually one would say that R CMD
check --use-valgrind
is the answer.  But it only segfaults when --use-vagrind is not used.  So
somehow we have to debug R CMD check itself.  How?

On Sat, Jul 4, 2015 at 10:15 AM, Charles Geyer <charlie at stat.umn.edu> wrote:

> The diff for bar.Rout is OK.  The solution is the same (the two matrices
> have the same rows and so determine the same convex polyhedron).  Why it
> picks different orders of rows on different machines, I have no idea.
>
> I also saw the pages of warnings from gcc -W -Wall -Wextra but they are
> all about unused variables and unused arguments of functions.  AFAIK these
> are not real problems.
>
> I should say that I did not write most of the code.  This package is an R
> interface to the computational geometry provided by cddlib, which is not
> something linux distributions package.  So in order to avoid hassle, I just
> included the cddlib code (which is GPL) in the src directory and added its
> author Komei Fukuda to the authors of the package.
>
> AFAIK this code is very high quality from a numerical analysis standpoint,
> however much it may fall below the coding standards of most C coders.
> Anyway it is the only free software computational geometry code I know
> about, so it is the only game in town unless statisticians want to just say
> "we cannot deal with problems like that".
>
> This code may actually segfault somewhere, but we haven't seen it in
> practice unless this is its fault (rather than the 32 bit R-3.2.1 build for
> Ubuntu 14.04).  We still don't have a way to tell which to blame.
>
> I am trying to follow the debugging rules (http://debuggingrules.com/)
> the most important here being "divide and conquer".  Until we know where
> the crash occurs, we are just clueless.
>
> On Sat, Jul 4, 2015 at 3:35 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
>>
>> Charles,
>>
>> I took a look based on your tar ball.  When I use the normal 'loud'
>> setting I
>> default to for g++ (ie -pedantic -Wall) or clang++ I get more than a page
>> full of errors.  I just tried it using the UBSAN-via-clang instrumented R
>> I
>> provide via a docker container (and for which I showed usage during the
>> 'rocker: Docker on R' tutorial preceding useR! -- slides now on my
>> presentation page).  It also does not segfault, but it shows a test
>> difference:
>>
>>   Running ?bar.R?
>>     Comparing ?bar.Rout? to ?bar.Rout.save? ...8d7
>>     <
>>     51,54c50,53
>>     < [1,]    0    1    0    1    0    0
>>     < [2,]    0    1    1    0    0    0
>>     < [3,]    0    1    0    0    1    0
>>     < [4,]    0    1    0    0    0    1
>>     ---
>>     > [1,]    0    1    0    0    0    1
>>     > [2,]    0    1    0    0    1    0
>>     > [3,]    0    1    0    1    0    0
>>     > [4,]    0    1    1    0    0    0
>>       Running ?bug2.R?
>>         Comparing ?bug2.Rout? to ?bug2.Rout.save? ...8d7
>>         <
>>
>> (You also seem to consistently differ in one newline which is just a
>> nuisance
>> and not an error,)
>>
>> So no free lunch yet.  I fear you may have to minimize the package
>> somewhat
>> to hopefully arrive at minimally reproducible example.  So far you seem to
>> have a Heisenbug (https://en.wikipedia.org/wiki/Heisenbug)
>>
>> Sorry I cannot offer more help.
>>
>> Dirk
>>
>> --
>> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
>
>
>
> --
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
>



-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu

	[[alternative HTML version deleted]]


From edd at debian.org  Sat Jul  4 17:48:06 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 4 Jul 2015 10:48:06 -0500
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
In-Reply-To: <CAKctRd2vi0Yfvi9nhLFAiCgnOmTamhdort3=h8roJ_K2EMjUKg@mail.gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
	<21911.39608.106191.787828@max.nulle.part>
	<CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>
	<CAKctRd2vi0Yfvi9nhLFAiCgnOmTamhdort3=h8roJ_K2EMjUKg@mail.gmail.com>
Message-ID: <21912.54.263096.597525@max.nulle.part>


Agreed on divide-and-conquer. There is no other way. Valgridn et al may move
some code to registers for subtle changes.

On 4 July 2015 at 10:20, Charles Geyer wrote:
| I should add a more direct question.? When a crash occurs ONLY when running R
| CMD check, how does one debug that?? Usually one would say that R CMD check
| --use-valgrind
| is the answer.? But it only segfaults when --use-vagrind is not used.? So
| somehow we have to debug R CMD check itself.? How?

By "mocking" the exact same (compile and run-time) options used by R CMD
check. You can trace that down.  Things depend a little on whether you do or
do not use user-library-paths for .libPaths() or not, whether you use
per-user compile flags etc pp.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From charlie at stat.umn.edu  Sat Jul  4 18:44:47 2015
From: charlie at stat.umn.edu (Charles Geyer)
Date: Sat, 4 Jul 2015 11:44:47 -0500
Subject: [R-pkg-devel] R CMD check crash for Ubuntu 14.04 R-3.2.1 only
In-Reply-To: <21912.54.263096.597525@max.nulle.part>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
	<21911.39608.106191.787828@max.nulle.part>
	<CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>
	<CAKctRd2vi0Yfvi9nhLFAiCgnOmTamhdort3=h8roJ_K2EMjUKg@mail.gmail.com>
	<21912.54.263096.597525@max.nulle.part>
Message-ID: <CAKctRd35-+4n=0eQO+b3_y87vSesqu6HWn4pER-FLRR9DkY7KQ@mail.gmail.com>

Your "mocking" phrase in unknown to me.  I am not sure where to trace that
down.  Read the bash script for check?   Read tools:::.check_packages?
Both are clear as mud to me.

Also I just tried debugging by print statements.  That does not work.  It
leaves the C called just before the crash.  Putting a cat statement in the
R function that calls the C function prevents the crash.  I know.  If there
is memory corruption, doing anything can change the crash behavior.  So
that is not mystifying.  Just frustrating.

On Sat, Jul 4, 2015 at 10:48 AM, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> Agreed on divide-and-conquer. There is no other way. Valgridn et al may
> move
> some code to registers for subtle changes.
>
> On 4 July 2015 at 10:20, Charles Geyer wrote:
> | I should add a more direct question.  When a crash occurs ONLY when
> running R
> | CMD check, how does one debug that?  Usually one would say that R CMD
> check
> | --use-valgrind
> | is the answer.  But it only segfaults when --use-vagrind is not used.  So
> | somehow we have to debug R CMD check itself.  How?
>
> By "mocking" the exact same (compile and run-time) options used by R CMD
> check. You can trace that down.  Things depend a little on whether you do
> or
> do not use user-library-paths for .libPaths() or not, whether you use
> per-user compile flags etc pp.
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>



-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu

	[[alternative HTML version deleted]]


From richierocks at gmail.com  Sun Jul  5 19:17:37 2015
From: richierocks at gmail.com (Richard Cotton)
Date: Sun, 5 Jul 2015 19:17:37 +0200
Subject: [R-pkg-devel] Are import-export-only packages allowed on CRAN?
Message-ID: <CAPp_+=cLcqP2=yeNHroW7b6SPy8TmbTsqrE5PPNjXJuddxwDSg@mail.gmail.com>

One piece of feedback that I received at useR was that the assertive
package is getting too big, and should be broken down into smaller
pieces.

I want to split the functionality into assertive.base,
assertive.types, and a few others, then have the assertive package as
a virtual package (suggestions for better terminology welcomed) that
just imports and reexports the contents of the underlying pieces.

That way end-users can can still type library(assertive) and have the
same behaviour as before, and package developers who worry about
having lightweight dependencies can just use the parts that they need.

Before I do the refactoring, I wanted to check that it is OK to have a
package without any of its own content (other than vignettes) on CRAN.
Is it OK?

<previously accidently posted on r-devel>

-- 
Regards,
Richie

Learning R
4dpiecharts.com


From kamvarz at science.oregonstate.edu  Mon Jul  6 06:23:24 2015
From: kamvarz at science.oregonstate.edu (Zhian Kamvar)
Date: Sun, 5 Jul 2015 21:23:24 -0700
Subject: [R-pkg-devel] How often does the r-devel docker file update?
Message-ID: <885C866F-149F-440F-94DB-C3EE23AE295F@science.oregonstate.edu>

Hello,

I maintain a package that is going to be submitted for an update very soon. I utilize https://registry.hub.docker.com/u/rocker/r-devel/ to check my package with r-devel, but I cannot detect a pattern as to how often it updates. Is there a clear schedule of how often it updates? The reason I'm asking is because it hasn't updated since CRAN has begun to enforce the explicit imports of non-base packages policy. 

Thanks,
Zhian N. Kamvar

From edd at debian.org  Mon Jul  6 12:45:43 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 6 Jul 2015 05:45:43 -0500
Subject: [R-pkg-devel] How often does the r-devel docker file update?
In-Reply-To: <885C866F-149F-440F-94DB-C3EE23AE295F@science.oregonstate.edu>
References: <885C866F-149F-440F-94DB-C3EE23AE295F@science.oregonstate.edu>
Message-ID: <21914.23639.649559.806256@max.nulle.part>


Hi Zhian,

On 5 July 2015 at 21:23, Zhian Kamvar wrote:
| I maintain a package that is going to be submitted for an update very soon. I utilize https://registry.hub.docker.com/u/rocker/r-devel/ to check my package with r-devel, but I cannot detect a pattern as to how often it updates. Is there a clear schedule of how often it updates? The reason I'm asking is because it hasn't updated since CRAN has begun to enforce the explicit imports of non-base packages policy. 

That is almost more of a question for the rocker maintainers / a GitHub issue
ticket.

The answer is a clear "it depends".  We used to have daily builds of r-devel
as well as of the also-nightly-but-smaller 'drd' container (for 'daily r-devel'):
   https://registry.hub.docker.com/u/rocker/drd/

We turned the automatic dailies off when out "upstream" (ie Debian "testing"
was just coming off the newest release of "stable" so that that "testing" was
undergoing a lot of change).  We will discuss.

In any event, I just launched new builds of 'r-devel' and 'drd' under rocker.

Thanks for your interest in rocker.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd at debian.org  Mon Jul  6 12:47:29 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 6 Jul 2015 05:47:29 -0500
Subject: [R-pkg-devel] Are import-export-only packages allowed on CRAN?
In-Reply-To: <CAPp_+=cLcqP2=yeNHroW7b6SPy8TmbTsqrE5PPNjXJuddxwDSg@mail.gmail.com>
References: <CAPp_+=cLcqP2=yeNHroW7b6SPy8TmbTsqrE5PPNjXJuddxwDSg@mail.gmail.com>
Message-ID: <21914.23745.912672.4048@max.nulle.part>


Hi Richie,

On 5 July 2015 at 19:17, Richard Cotton wrote:
| One piece of feedback that I received at useR was that the assertive
| package is getting too big, and should be broken down into smaller
| pieces.
| 
| I want to split the functionality into assertive.base,
| assertive.types, and a few others, then have the assertive package as
| a virtual package (suggestions for better terminology welcomed) that
| just imports and reexports the contents of the underlying pieces.
| 
| That way end-users can can still type library(assertive) and have the
| same behaviour as before, and package developers who worry about
| having lightweight dependencies can just use the parts that they need.
| 
| Before I do the refactoring, I wanted to check that it is OK to have a
| package without any of its own content (other than vignettes) on CRAN.
| Is it OK?

That is a pure CRAN question; maybe someone from CRAN wants to chime in or
else you need to ask directly.

Greg Warnes has/had such a meta package (which I look after in Debian as a
still-existing-there whole and componentds), and Henrik does too.  What **I
think** the practice is now discouraged somewhere in WRE or CRP.  But no
direct reference, sorry,

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From marc_schwartz at me.com  Mon Jul  6 13:36:48 2015
From: marc_schwartz at me.com (Marc Schwartz)
Date: Mon, 06 Jul 2015 06:36:48 -0500
Subject: [R-pkg-devel] Are import-export-only packages allowed on CRAN?
In-Reply-To: <21914.23745.912672.4048@max.nulle.part>
References: <CAPp_+=cLcqP2=yeNHroW7b6SPy8TmbTsqrE5PPNjXJuddxwDSg@mail.gmail.com>
	<21914.23745.912672.4048@max.nulle.part>
Message-ID: <38386724-FDD8-4BBE-B2C4-6672F548616F@me.com>


> On Jul 6, 2015, at 5:47 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> Hi Richie,
> 
> On 5 July 2015 at 19:17, Richard Cotton wrote:
> | One piece of feedback that I received at useR was that the assertive
> | package is getting too big, and should be broken down into smaller
> | pieces.
> | 
> | I want to split the functionality into assertive.base,
> | assertive.types, and a few others, then have the assertive package as
> | a virtual package (suggestions for better terminology welcomed) that
> | just imports and reexports the contents of the underlying pieces.
> | 
> | That way end-users can can still type library(assertive) and have the
> | same behaviour as before, and package developers who worry about
> | having lightweight dependencies can just use the parts that they need.
> | 
> | Before I do the refactoring, I wanted to check that it is OK to have a
> | package without any of its own content (other than vignettes) on CRAN.
> | Is it OK?
> 
> That is a pure CRAN question; maybe someone from CRAN wants to chime in or
> else you need to ask directly.
> 
> Greg Warnes has/had such a meta package (which I look after in Debian as a
> still-existing-there whole and componentds), and Henrik does too.  What **I
> think** the practice is now discouraged somewhere in WRE or CRP.  But no
> direct reference, sorry,
> 
> Dirk


If you are referring to a package ?bundle?, they were deprecated in R 2.10.0 and put into defunct status in R 2.11.0. That is from the NEWS file:

  https://svn.r-project.org/R/trunk/doc/NEWS.2

There is no longer any reference to them in R-Exts.

Greg?s ?gregmisc? bundle is no longer active on CRAN, in deference to using his component packages directly.


Regards,

Marc Schwartz


From jonathan at mazamascience.com  Mon Jul  6 19:29:58 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Mon, 6 Jul 2015 10:29:58 -0700
Subject: [R-pkg-devel] directory for non-checked vignettes
Message-ID: <CAPjNR=QH4t=6N96XrYQM=WrxJ2+bSGyGCjzW0wr0Zgxcpi1T6w@mail.gmail.com>

We have a package for which we'd like to write a number of vignettes.

The purpose of the MazamaSpatialUtils package is to make it easy to
download, convert and use large amounts of spatial data. Because of the
nature of this data it is 1) unreasonable to include it in the package and
2) unreasonable to download and convert data in any examples or vignettes
that need to pass R CMD check.

But we would love to include several vignettes that demonstrate to users
how to work with this package and the near-infinite amount of spatial data
on the web. My question is:

Where can we put .Rmd files so that they will 1) be available to package
users and 2) not run during R CMD check?

Here is what doesn't work:

 * vignettes -- NOPE, gets run during R CMD check
 * demos -- NOPE, R CMD check complains of "invalid file name"

Can we trick R with something like inst/localVignettes/? But then how would
people access these?

Thanks for any suggestions.

Jon
-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From thierry.onkelinx at inbo.be  Tue Jul  7 09:54:04 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Tue, 7 Jul 2015 09:54:04 +0200
Subject: [R-pkg-devel] directory for non-checked vignettes
In-Reply-To: <CAPjNR=QH4t=6N96XrYQM=WrxJ2+bSGyGCjzW0wr0Zgxcpi1T6w@mail.gmail.com>
References: <CAPjNR=QH4t=6N96XrYQM=WrxJ2+bSGyGCjzW0wr0Zgxcpi1T6w@mail.gmail.com>
Message-ID: <CAJuCY5zhbkZeyg+35v8UmugO-bewrYy=-kXGoUXup5h8pLkDAg@mail.gmail.com>

Dear Jonathan,

inst/localVignettes/ seems a reasonable idea to me. The users can find them
there if you add an ordinary vignette which explains where the extra
vignettes are located and how the user can compile them. You could consider
adding compilation scripts to inst/localVignettes/

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

2015-07-06 19:29 GMT+02:00 Jonathan Callahan <jonathan at mazamascience.com>:

> We have a package for which we'd like to write a number of vignettes.
>
> The purpose of the MazamaSpatialUtils package is to make it easy to
> download, convert and use large amounts of spatial data. Because of the
> nature of this data it is 1) unreasonable to include it in the package and
> 2) unreasonable to download and convert data in any examples or vignettes
> that need to pass R CMD check.
>
> But we would love to include several vignettes that demonstrate to users
> how to work with this package and the near-infinite amount of spatial data
> on the web. My question is:
>
> Where can we put .Rmd files so that they will 1) be available to package
> users and 2) not run during R CMD check?
>
> Here is what doesn't work:
>
>  * vignettes -- NOPE, gets run during R CMD check
>  * demos -- NOPE, R CMD check complains of "invalid file name"
>
> Can we trick R with something like inst/localVignettes/? But then how would
> people access these?
>
> Thanks for any suggestions.
>
> Jon
> --
> Jonathan Callahan, PhD
> Mazama Science
> 206-708-5028
> mazamascience.com
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From richierocks at gmail.com  Wed Jul  8 20:05:55 2015
From: richierocks at gmail.com (Richard Cotton)
Date: Wed, 8 Jul 2015 21:05:55 +0300
Subject: [R-pkg-devel] Are import-export-only packages allowed on CRAN?
In-Reply-To: <38386724-FDD8-4BBE-B2C4-6672F548616F@me.com>
References: <CAPp_+=cLcqP2=yeNHroW7b6SPy8TmbTsqrE5PPNjXJuddxwDSg@mail.gmail.com>
	<21914.23745.912672.4048@max.nulle.part>
	<38386724-FDD8-4BBE-B2C4-6672F548616F@me.com>
Message-ID: <CAPp_+=ePqfozruBco2gGFKLxYhy9fEODTU6_dJ7iXLxi04ON0Q@mail.gmail.com>

I emailed the CRAN hotline, and Kurt H's response was:

> I see no problem with this.

> (Having packages which put lots of other packages on the search path are
> a problem: but I understand you won't be doing that, and instead import
> and re-export, right?)

On 6 July 2015 at 14:36, Marc Schwartz <marc_schwartz at me.com> wrote:
>
>> On Jul 6, 2015, at 5:47 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
>>
>>
>> Hi Richie,
>>
>> On 5 July 2015 at 19:17, Richard Cotton wrote:
>> | One piece of feedback that I received at useR was that the assertive
>> | package is getting too big, and should be broken down into smaller
>> | pieces.
>> |
>> | I want to split the functionality into assertive.base,
>> | assertive.types, and a few others, then have the assertive package as
>> | a virtual package (suggestions for better terminology welcomed) that
>> | just imports and reexports the contents of the underlying pieces.
>> |
>> | That way end-users can can still type library(assertive) and have the
>> | same behaviour as before, and package developers who worry about
>> | having lightweight dependencies can just use the parts that they need.
>> |
>> | Before I do the refactoring, I wanted to check that it is OK to have a
>> | package without any of its own content (other than vignettes) on CRAN.
>> | Is it OK?
>>
>> That is a pure CRAN question; maybe someone from CRAN wants to chime in or
>> else you need to ask directly.
>>
>> Greg Warnes has/had such a meta package (which I look after in Debian as a
>> still-existing-there whole and componentds), and Henrik does too.  What **I
>> think** the practice is now discouraged somewhere in WRE or CRP.  But no
>> direct reference, sorry,
>>
>> Dirk
>
>
> If you are referring to a package ?bundle?, they were deprecated in R 2.10.0 and put into defunct status in R 2.11.0. That is from the NEWS file:
>
>   https://svn.r-project.org/R/trunk/doc/NEWS.2
>
> There is no longer any reference to them in R-Exts.
>
> Greg?s ?gregmisc? bundle is no longer active on CRAN, in deference to using his component packages directly.
>
>
> Regards,
>
> Marc Schwartz
>



-- 
Regards,
Richie

Learning R
4dpiecharts.com


From alku at dtu.dk  Thu Jul  9 15:07:45 2015
From: alku at dtu.dk (Alexandra Kuznetsova)
Date: Thu, 9 Jul 2015 13:07:45 +0000
Subject: [R-pkg-devel] NOTE: Error while checking: invalid 'envir'-argument
Message-ID: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>

Hi all,

I am checking the package with the -as-cran option using R Under development (unstable) (2015-07-08 r68642). I get the following NOTE: Error while checking: invalid 'envir'-argument.  Does anyone know how to fix that NOTE? I do not get it with the R 2.3.1

Alexandra


	[[alternative HTML version deleted]]


From pdalgd at gmail.com  Thu Jul  9 19:24:26 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 9 Jul 2015 19:24:26 +0200
Subject: [R-pkg-devel] NOTE: Error while checking: invalid
	'envir'-argument
In-Reply-To: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>
References: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>
Message-ID: <D05BF1D4-EA47-49B9-A134-99F680EB248A@gmail.com>

Hi Alexandra,

Is it possible to narrow down a bit more where the message comes from? That error message doesn't give much of a clue.

-pd

> On 09 Jul 2015, at 15:07 , Alexandra Kuznetsova <alku at dtu.dk> wrote:
> 
> Hi all,
> 
> I am checking the package with the -as-cran option using R Under development (unstable) (2015-07-08 r68642). I get the following NOTE: Error while checking: invalid 'envir'-argument.  Does anyone know how to fix that NOTE? I do not get it with the R 2.3.1
> 
> Alexandra
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From hanas at uw.edu  Thu Jul  9 19:58:44 2015
From: hanas at uw.edu (Hana Sevcikova)
Date: Thu, 09 Jul 2015 10:58:44 -0700
Subject: [R-pkg-devel] NOTE: Error while checking: invalid
	'envir'-argument
In-Reply-To: <D05BF1D4-EA47-49B9-A134-99F680EB248A@gmail.com>
References: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>
	<D05BF1D4-EA47-49B9-A134-99F680EB248A@gmail.com>
Message-ID: <559EB654.9070409@uw.edu>

Alexandra,

I got the same error for this line of code:

e <- new.env()
data("mydataset", envir=e)

As you said it doesn't appear for R 3.2.1. I don't know why that should 
be wrong and would be interested to know, but my hack is this:

e <- new.env()
do.call("data", list("mydataset", envir=e))

Hana


On 7/9/15 10:24 AM, peter dalgaard wrote:
> Hi Alexandra,
>
> Is it possible to narrow down a bit more where the message comes from? That error message doesn't give much of a clue.
>
> -pd
>
>> On 09 Jul 2015, at 15:07 , Alexandra Kuznetsova <alku at dtu.dk> wrote:
>>
>> Hi all,
>>
>> I am checking the package with the -as-cran option using R Under
development (unstable) (2015-07-08 r68642). I get the following NOTE:
Error while checking: invalid 'envir'-argument. Does anyone know how to
fix that NOTE? I do not get it with the R 2.3.1
>>
>> Alexandra
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From maechler at stat.math.ethz.ch  Thu Jul  9 20:56:28 2015
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 9 Jul 2015 20:56:28 +0200
Subject: [R-pkg-devel] NOTE: Error while checking: invalid
	'envir'-argument
In-Reply-To: <559EB654.9070409@uw.edu>
References: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>
	<D05BF1D4-EA47-49B9-A134-99F680EB248A@gmail.com>
	<559EB654.9070409@uw.edu>
Message-ID: <21918.50140.404501.695969@stat.math.ethz.ch>


> Alexandra,
> I got the same error for this line of code:

> e <- new.env()
> data("mydataset", envir=e)

> As you said it doesn't appear for R 3.2.1. I don't know why that should 
> be wrong and would be interested to know, but my hack is this:

> e <- new.env()
> do.call("data", list("mydataset", envir=e))

> Hana

Hmm,  that would look like a bug in your version of R-devel.
In my version of "R-devel" (and R 3.2.1, and "R 3.2.1 patched"), 
I get

  > rm(e); e <- new.env(); data(votes.repub, envir=e); ls(e); dim(e$votes.repub)
  [1] "votes.repub"
  [1] 50 31
  > 

  > R.version.string
  [1] "R Under development (unstable) (2015-07-07 r68640)"
  >

What is your R.version.string very you see the problem?
What's 
       sessionInfo() ?

Best,
Martin

> On 7/9/15 10:24 AM, peter dalgaard wrote:
> > Hi Alexandra,
> >
> > Is it possible to narrow down a bit more where the message comes from? That error message doesn't give much of a clue.
> >
> > -pd
> >
> >> On 09 Jul 2015, at 15:07 , Alexandra Kuznetsova <alku at dtu.dk> wrote:
> >>
> >> Hi all,
> >>
> >> I am checking the package with the -as-cran option using R Under
> development (unstable) (2015-07-08 r68642). I get the following NOTE:
> Error while checking: invalid 'envir'-argument. Does anyone know how to
> fix that NOTE? I do not get it with the R 2.3.1
> >>
> >> Alexandra
> >>
> >>
> >> 	[[alternative HTML version deleted]]
> >>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >

> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From pdalgd at gmail.com  Thu Jul  9 21:20:54 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 9 Jul 2015 21:20:54 +0200
Subject: [R-pkg-devel] NOTE: Error while checking: invalid
	'envir'-argument
In-Reply-To: <21918.50140.404501.695969@stat.math.ethz.ch>
References: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>
	<D05BF1D4-EA47-49B9-A134-99F680EB248A@gmail.com>
	<559EB654.9070409@uw.edu>
	<21918.50140.404501.695969@stat.math.ethz.ch>
Message-ID: <7D719860-D42F-45F3-861F-9ECE9D7AB9DA@gmail.com>


> On 09 Jul 2015, at 20:56 , Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> 
> 
>> Alexandra,
>> I got the same error for this line of code:
> 
>> e <- new.env()
>> data("mydataset", envir=e)
> 
>> As you said it doesn't appear for R 3.2.1. I don't know why that should 
>> be wrong and would be interested to know, but my hack is this:
> 
>> e <- new.env()
>> do.call("data", list("mydataset", envir=e))
> 
>> Hana
> 
> Hmm,  that would look like a bug in your version of R-devel.
> In my version of "R-devel" (and R 3.2.1, and "R 3.2.1 patched"), 
> I get
> 
>> rm(e); e <- new.env(); data(votes.repub, envir=e); ls(e); dim(e$votes.repub)
>  [1] "votes.repub"
>  [1] 50 31
>> 
> 
>> R.version.string
>  [1] "R Under development (unstable) (2015-07-07 r68640)"
>> 
> 
> What is your R.version.string very you see the problem?
> What's 
>       sessionInfo() ?
> 
> Best,
> Martin

I suspect that that is not the way to check it, Martin. As I understand it, the warning comes during R CMD check, possibly via one of the static code analysis checks. So what you really should do is write a package with the construction inside one of its functions or help files, and then try R CMD check --as-cran on it. I tried a simpler way:

> library(codetools)
> foo <- function(){e <- new.env(); data("airquality", envir=e); e}
> checkUsage(foo, all=TRUE)

but that doesn't trigger the issue either...

-pd

> 
>> On 7/9/15 10:24 AM, peter dalgaard wrote:
>>> Hi Alexandra,
>>> 
>>> Is it possible to narrow down a bit more where the message comes from? That error message doesn't give much of a clue.
>>> 
>>> -pd
>>> 
>>>> On 09 Jul 2015, at 15:07 , Alexandra Kuznetsova <alku at dtu.dk> wrote:
>>>> 
>>>> Hi all,
>>>> 
>>>> I am checking the package with the -as-cran option using R Under
>> development (unstable) (2015-07-08 r68642). I get the following NOTE:
>> Error while checking: invalid 'envir'-argument. Does anyone know how to
>> fix that NOTE? I do not get it with the R 2.3.1
>>>> 
>>>> Alexandra
>>>> 
>>>> 
>>>> 	[[alternative HTML version deleted]]
>>>> 
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>> 
> 
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From maechler at stat.math.ethz.ch  Thu Jul  9 21:33:06 2015
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 9 Jul 2015 21:33:06 +0200
Subject: [R-pkg-devel] NOTE: Error while checking: invalid
	'envir'-argument
In-Reply-To: <7D719860-D42F-45F3-861F-9ECE9D7AB9DA@gmail.com>
References: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>
	<D05BF1D4-EA47-49B9-A134-99F680EB248A@gmail.com>
	<559EB654.9070409@uw.edu>
	<21918.50140.404501.695969@stat.math.ethz.ch>
	<7D719860-D42F-45F3-861F-9ECE9D7AB9DA@gmail.com>
Message-ID: <21918.52338.410688.364839@stat.math.ethz.ch>

>>>>> peter dalgaard <pdalgd at gmail.com>
>>>>>     on Thu, 9 Jul 2015 21:20:54 +0200 writes:

    >> On 09 Jul 2015, at 20:56 , Martin Maechler
    >> <maechler at stat.math.ethz.ch> wrote:
    >> 
    >> 
    >>> Alexandra, I got the same error for this line of code:
    >> 
    >>> e <- new.env() data("mydataset", envir=e)
    >> 
    >>> As you said it doesn't appear for R 3.2.1. I don't know
    >>> why that should be wrong and would be interested to
    >>> know, but my hack is this:
    >> 
    >>> e <- new.env() do.call("data", list("mydataset",
    >>> envir=e))
    >> 
    >>> Hana
    >> 
    >> Hmm, that would look like a bug in your version of
    >> R-devel.  In my version of "R-devel" (and R 3.2.1, and "R
    >> 3.2.1 patched"), I get
    >> 
    >>> rm(e); e <- new.env(); data(votes.repub, envir=e);
    >>> ls(e); dim(e$votes.repub)
    >> [1] "votes.repub" [1] 50 31
    >>> 
    >> 
    >>> R.version.string
    >> [1] "R Under development (unstable) (2015-07-07 r68640)"
    >>> 
    >> 
    >> What is your R.version.string very you see the problem?
    >> What's sessionInfo() ?
    >> 
    >> Best, Martin

    > I suspect that that is not the way to check it, Martin. As
    > I understand it, the warning comes during R CMD check,
    > possibly via one of the static code analysis checks. So
    > what you really should do is write a package with the
    > construction inside one of its functions or help files,
    > and then try R CMD check --as-cran on it. I tried a
    > simpler way:

    >> library(codetools) foo <- function(){e <- new.env();
    >> data("airquality", envir=e); e} checkUsage(foo, all=TRUE)

    > but that doesn't trigger the issue either...

You are right on spot, Peter.

In the mean time, I have seen the NOTE  when checking my
'sfsmisc'

str_data: Error while checking: invalid 'envir' argument

(also for the CRAN version of the package, but there it is
 buried inside all the missing globals ..).

So yes, we have a new bug in R-devel
(which I am *not* going to fix this evening ..).

Martin

    > -pd

    >> 
    >>> On 7/9/15 10:24 AM, peter dalgaard wrote:
    >>>> Hi Alexandra,
    >>>> 
    >>>> Is it possible to narrow down a bit more where the
    >>>> message comes from? That error message doesn't give
    >>>> much of a clue.
    >>>> 
    >>>> -pd
    >>>> 
    >>>>> On 09 Jul 2015, at 15:07 , Alexandra Kuznetsova
    >>>>> <alku at dtu.dk> wrote:
    >>>>> 
    >>>>> Hi all,
    >>>>> 
    >>>>> I am checking the package with the -as-cran option
    >>>>> using R Under
    >>> development (unstable) (2015-07-08 r68642). I get the
    >>> following NOTE: Error while checking: invalid
    >>> 'envir'-argument. Does anyone know how to fix that NOTE?
    >>> I do not get it with the R 2.3.1
    >>>>> 
    >>>>> Alexandra
    >>>>> 
    >>>>> 
    >>>>> [[alternative HTML version deleted]]
    >>>>> 
    >>>>> ______________________________________________
    >>>>> R-package-devel at r-project.org mailing list
    >>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
    >>>> 
    >> 
    >>> ______________________________________________
    >>> R-package-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
    >> 
    >> ______________________________________________
    >> R-package-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-package-devel

    > -- 
    > Peter Dalgaard, Professor, Center for Statistics,
    > Copenhagen Business School Solbjerg Plads 3, 2000
    > Frederiksberg, Denmark Phone: (+45)38153501 Email:
    > pd.mes at cbs.dk Priv: PDalgd at gmail.com


From alku at dtu.dk  Thu Jul  9 23:35:40 2015
From: alku at dtu.dk (Alexandra Kuznetsova)
Date: Thu, 9 Jul 2015 21:35:40 +0000
Subject: [R-pkg-devel] NOTE: Error while checking: invalid
 'envir'-argument
In-Reply-To: <21918.50140.404501.695969@stat.math.ethz.ch>
References: <0566E17B6DEC62459078112371B7508E32E072@ait-pex02mbx05.win.dtu.dk>
	<D05BF1D4-EA47-49B9-A134-99F680EB248A@gmail.com>
	<559EB654.9070409@uw.edu>, <21918.50140.404501.695969@stat.math.ethz.ch>
Message-ID: <0566E17B6DEC62459078112371B7508E32E249@ait-pex02mbx05.win.dtu.dk>

I am checking the sensR package https://r-forge.r-project.org/R/?group_id=944

The NOTE is the following one:
* checking R code for possible problems ... NOTE
AnotA: Error while checking: ugyldigt 'envir'-argument
clls: Error while checking: ugyldigt 'envir'-argument
discrimR: Error while checking: ugyldigt 'envir'-argument
duotrio: Error while checking: ugyldigt 'envir'-argument
tetrad: Error while checking: ugyldigt 'envir'-argument
threeAFC: Error while checking: ugyldigt 'envir'-argument
triangle: Error while checking: ugyldigt 'envir'-argument
twoAFC: Error while checking: ugyldigt 'envir'-argument

Looking at the code of these functions I could not find what could be the problem.

My sessionInfo():
> sessionInfo()
R Under development (unstable) (2015-07-08 r68642)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=Danish_Denmark.1252 
[2] LC_CTYPE=Danish_Denmark.1252   
[3] LC_MONETARY=Danish_Denmark.1252
[4] LC_NUMERIC=C                   
[5] LC_TIME=Danish_Denmark.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets 
[6] methods   base     

other attached packages:
[1] sensR_1.4-6

loaded via a namespace (and not attached):
 [1] TH.data_1.0-6     zoo_1.7-12        MASS_7.3-42      
 [4] multcomp_1.4-0    sandwich_2.3-3    tools_3.3.0      
 [7] survival_2.38-3   mvtnorm_1.0-2     codetools_0.2-11 
[10] splines_3.3.0     grid_3.3.0        numDeriv_2014.2-1
[13] lattice_0.20-31  

Alexandra
________________________________________
From: Martin Maechler [maechler at stat.math.ethz.ch]
Sent: Thursday, July 09, 2015 8:56 PM
To: Hana Sevcikova
Cc: Alexandra Kuznetsova; r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] NOTE: Error while checking: invalid 'envir'-argument

> Alexandra,
> I got the same error for this line of code:

> e <- new.env()
> data("mydataset", envir=e)

> As you said it doesn't appear for R 3.2.1. I don't know why that should
> be wrong and would be interested to know, but my hack is this:

> e <- new.env()
> do.call("data", list("mydataset", envir=e))

> Hana

Hmm,  that would look like a bug in your version of R-devel.
In my version of "R-devel" (and R 3.2.1, and "R 3.2.1 patched"),
I get

  > rm(e); e <- new.env(); data(votes.repub, envir=e); ls(e); dim(e$votes.repub)
  [1] "votes.repub"
  [1] 50 31
  >

  > R.version.string
  [1] "R Under development (unstable) (2015-07-07 r68640)"
  >

What is your R.version.string very you see the problem?
What's
       sessionInfo() ?

Best,
Martin

> On 7/9/15 10:24 AM, peter dalgaard wrote:
> > Hi Alexandra,
> >
> > Is it possible to narrow down a bit more where the message comes from? That error message doesn't give much of a clue.
> >
> > -pd
> >
> >> On 09 Jul 2015, at 15:07 , Alexandra Kuznetsova <alku at dtu.dk> wrote:
> >>
> >> Hi all,
> >>
> >> I am checking the package with the -as-cran option using R Under
> development (unstable) (2015-07-08 r68642). I get the following NOTE:
> Error while checking: invalid 'envir'-argument. Does anyone know how to
> fix that NOTE? I do not get it with the R 2.3.1
> >>
> >> Alexandra
> >>
> >>
> >>    [[alternative HTML version deleted]]
> >>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >

> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From profjcnash at gmail.com  Fri Jul 10 21:50:12 2015
From: profjcnash at gmail.com (ProfJCNash)
Date: Fri, 10 Jul 2015 15:50:12 -0400
Subject: [R-pkg-devel]  query about package design
In-Reply-To: <CAKctRd35-+4n=0eQO+b3_y87vSesqu6HWn4pER-FLRR9DkY7KQ@mail.gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>	<21911.39608.106191.787828@max.nulle.part>	<CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>	<CAKctRd2vi0Yfvi9nhLFAiCgnOmTamhdort3=h8roJ_K2EMjUKg@mail.gmail.com>	<21912.54.263096.597525@max.nulle.part>
	<CAKctRd35-+4n=0eQO+b3_y87vSesqu6HWn4pER-FLRR9DkY7KQ@mail.gmail.com>
Message-ID: <55A021F4.402@gmail.com>

I have a general question about appropriate design for a fairly
complicated package, as I am redesigning and rebuilding the optimx
package. It will get a new name as it appears that the calls will change
in order to accommodate new functionality. I plan to make it
fairly easy to add new optimization (function minimization) tools.

The query is whether to use an environment to hold all the common
objects (functions, scaled functions, gradients, scaled gradients,
hessians, scaled hessians, parameters, scaled parameters, program
controls, algorithm tuning parameters, constraints, fixed parametes,
some function value history, etc.) The alternative is a set of very
long calls, especially when the function needing a quantity may be a
couple of layers below the routine that creates or sets the values.

The negative side is that the functions are not portable outside the
package, so would not be exported.

Before I dig into the heavy clay of code that this will need, I thought
I should ask if there are issues I might be missing, as the local
environment -- essentially "global" variables within the perimeter of
the package -- would make the code a lot cleaner, and may offer some
useful efficiencies in computation.

Best,

JN


From h.wickham at gmail.com  Fri Jul 10 22:17:50 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 10 Jul 2015 13:17:50 -0700
Subject: [R-pkg-devel] query about package design
In-Reply-To: <55A021F4.402@gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
	<21911.39608.106191.787828@max.nulle.part>
	<CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>
	<CAKctRd2vi0Yfvi9nhLFAiCgnOmTamhdort3=h8roJ_K2EMjUKg@mail.gmail.com>
	<21912.54.263096.597525@max.nulle.part>
	<CAKctRd35-+4n=0eQO+b3_y87vSesqu6HWn4pER-FLRR9DkY7KQ@mail.gmail.com>
	<55A021F4.402@gmail.com>
Message-ID: <CABdHhvG-CqikMccyQ0cQEYUDTGamjgqCFALFkzUVrvO8fcdRKg@mail.gmail.com>

On Fri, Jul 10, 2015 at 12:50 PM, ProfJCNash <profjcnash at gmail.com> wrote:
> I have a general question about appropriate design for a fairly
> complicated package, as I am redesigning and rebuilding the optimx
> package. It will get a new name as it appears that the calls will change
> in order to accommodate new functionality. I plan to make it
> fairly easy to add new optimization (function minimization) tools.
>
> The query is whether to use an environment to hold all the common
> objects (functions, scaled functions, gradients, scaled gradients,
> hessians, scaled hessians, parameters, scaled parameters, program
> controls, algorithm tuning parameters, constraints, fixed parametes,
> some function value history, etc.) The alternative is a set of very
> long calls, especially when the function needing a quantity may be a
> couple of layers below the routine that creates or sets the values.
>
> The negative side is that the functions are not portable outside the
> package, so would not be exported.
>
> Before I dig into the heavy clay of code that this will need, I thought
> I should ask if there are issues I might be missing, as the local
> environment -- essentially "global" variables within the perimeter of
> the package -- would make the code a lot cleaner, and may offer some
> useful efficiencies in computation.

If you want to store the same set of things for many optimisers, you
might want to consider using reference classes or R6.

Hadley

-- 
http://had.co.nz/


From profjcnash at gmail.com  Fri Jul 10 22:28:11 2015
From: profjcnash at gmail.com (ProfJCNash)
Date: Fri, 10 Jul 2015 16:28:11 -0400
Subject: [R-pkg-devel] query about package design
In-Reply-To: <CABdHhvG-CqikMccyQ0cQEYUDTGamjgqCFALFkzUVrvO8fcdRKg@mail.gmail.com>
References: <CAKctRd3Xaz+Xc+-KJU8zVwrtXrTC-UozzQj_GQSaJH8x2gbMEw@mail.gmail.com>
	<CABtg=Kk8Py2eQduHakWfiL1G1Tg-h0XV-xyELBEUJT7O+bdasA@mail.gmail.com>
	<CAKctRd34wwcRMo-iJJf-00-R+hOm4-Kj=m0E15Fu_3KgeTfX3g@mail.gmail.com>
	<21911.39608.106191.787828@max.nulle.part>
	<CAKctRd2SUDQ=ee1nOhTOTfOW-cR_mF1NChi3A7nAXziSCvZRPQ@mail.gmail.com>
	<CAKctRd2vi0Yfvi9nhLFAiCgnOmTamhdort3=h8roJ_K2EMjUKg@mail.gmail.com>
	<21912.54.263096.597525@max.nulle.part>
	<CAKctRd35-+4n=0eQO+b3_y87vSesqu6HWn4pER-FLRR9DkY7KQ@mail.gmail.com>
	<55A021F4.402@gmail.com>
	<CABdHhvG-CqikMccyQ0cQEYUDTGamjgqCFALFkzUVrvO8fcdRKg@mail.gmail.com>
Message-ID: <55A02ADB.8010203@gmail.com>

I was kind of hoping to avoid reference classes. The optimization stuff
it giving me enough headaches. I've used a local environment
successfully in the Rtnmin package (it is a direct conversion from my
brother's TN Matlab package, which was able to use "globals" there).

JN

On 15-07-10 04:17 PM, Hadley Wickham wrote:
> On Fri, Jul 10, 2015 at 12:50 PM, ProfJCNash <profjcnash at gmail.com> wrote:
>> I have a general question about appropriate design for a fairly
>> complicated package, as I am redesigning and rebuilding the optimx
>> package. It will get a new name as it appears that the calls will change
>> in order to accommodate new functionality. I plan to make it
>> fairly easy to add new optimization (function minimization) tools.
>>
>> The query is whether to use an environment to hold all the common
>> objects (functions, scaled functions, gradients, scaled gradients,
>> hessians, scaled hessians, parameters, scaled parameters, program
>> controls, algorithm tuning parameters, constraints, fixed parametes,
>> some function value history, etc.) The alternative is a set of very
>> long calls, especially when the function needing a quantity may be a
>> couple of layers below the routine that creates or sets the values.
>>
>> The negative side is that the functions are not portable outside the
>> package, so would not be exported.
>>
>> Before I dig into the heavy clay of code that this will need, I thought
>> I should ask if there are issues I might be missing, as the local
>> environment -- essentially "global" variables within the perimeter of
>> the package -- would make the code a lot cleaner, and may offer some
>> useful efficiencies in computation.
> 
> If you want to store the same set of things for many optimisers, you
> might want to consider using reference classes or R6.
> 
> Hadley
>


From wayne.j.taylor at gmail.com  Fri Jul 10 23:23:40 2015
From: wayne.j.taylor at gmail.com (Wayne Taylor)
Date: Fri, 10 Jul 2015 14:23:40 -0700
Subject: [R-pkg-devel] "Imports" for seemingly "base" functions/libraries
Message-ID: <CAFwTAqVFnOdnO9XgXCtxczg_3Y_PiYPOD4eEiQj_-HZPN+4c=Q@mail.gmail.com>

Good afternoon,

I received results from a package development check. On some platforms, I
receive numerous errors such as:

[my own function]: no visible global function definition for ?boxplot?
[my own function]: no visible binding for global variable ?quantile?
[my own function]: no visible global function definition for ?bxp?

To be clear, some of my functions call boxplot, quantile, and bxp - I am
not rewriting these functions. To correct these errors, should I adding
"graphics" and "stats" to the "Imports:" statement in the DESCRIPTION file
(the libraries associated with these functions)? I am a bit surprised that
we would also need to add these common "base" libraries to the Imports
statement, but I wanted to double check with the experts. I noticed these
errors occur only on the "developer" versions of the platforms, so it seems
that they are running a more stringent test. Thanks,

Wayne

-- 
Wayne Taylor
PhD Candidate in Marketing
UCLA Anderson School of Management
wayne.taylor.1 at anderson.ucla.edu <wayne.taylor.2016 at anderson.ucla.edu>

	[[alternative HTML version deleted]]


From josh.m.ulrich at gmail.com  Sat Jul 11 05:03:49 2015
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 10 Jul 2015 22:03:49 -0500
Subject: [R-pkg-devel] "Imports" for seemingly "base" functions/libraries
In-Reply-To: <CAFwTAqVFnOdnO9XgXCtxczg_3Y_PiYPOD4eEiQj_-HZPN+4c=Q@mail.gmail.com>
References: <CAFwTAqVFnOdnO9XgXCtxczg_3Y_PiYPOD4eEiQj_-HZPN+4c=Q@mail.gmail.com>
Message-ID: <CAPPM_gRHekWpwYuSntzcmpA805-=td1egrhxVkb9JTjsn6sCMg@mail.gmail.com>

On Fri, Jul 10, 2015 at 4:23 PM, Wayne Taylor <wayne.j.taylor at gmail.com> wrote:
> Good afternoon,
>
> I received results from a package development check. On some platforms, I
> receive numerous errors such as:
>
> [my own function]: no visible global function definition for ?boxplot?
> [my own function]: no visible binding for global variable ?quantile?
> [my own function]: no visible global function definition for ?bxp?
>
> To be clear, some of my functions call boxplot, quantile, and bxp - I am
> not rewriting these functions. To correct these errors, should I adding
> "graphics" and "stats" to the "Imports:" statement in the DESCRIPTION file
> (the libraries associated with these functions)? I am a bit surprised that
> we would also need to add these common "base" libraries to the Imports
> statement, but I wanted to double check with the experts. I noticed these
> errors occur only on the "developer" versions of the platforms, so it seems
> that they are running a more stringent test. Thanks,
>
Yes, this is expected.  See:
http://developer.r-project.org/blosxom.cgi/R-devel/NEWS/2015/06/29#n2015-06-29

And an earlier email on this list:
https://stat.ethz.ch/pipermail/r-package-devel/2015q2/000171.html

> Wayne
>
> --
> Wayne Taylor
> PhD Candidate in Marketing
> UCLA Anderson School of Management
> wayne.taylor.1 at anderson.ucla.edu <wayne.taylor.2016 at anderson.ucla.edu>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From Dan.Kelley at Dal.Ca  Sun Jul 12 17:33:34 2015
From: Dan.Kelley at Dal.Ca (Daniel Kelley)
Date: Sun, 12 Jul 2015 15:33:34 +0000
Subject: [R-pkg-devel] R-devel problem with temporary files or decompression?
Message-ID: <6FA4EA3B-2C7F-4B92-8678-76008D84594C@dal.ca>

A data file that I?d like to use in my ?oce? package is quite large, and compresses well, so I thought of putting a compressed version into inst/extdata. I want my documentation to show how to uncompress the file, partly because these files tend to compress so well that I think users might like to store them in gzipped form.

Naturally, I want to test my code using R-devel in addition to the ?release? version that I have on my box. Since I?ve never been able to get R-devel installed properly on OSX, I thought of submitting to win-builder. I got errors as below my signature line. What I don?t understand is the ?Invalid argument?, which seems to be different from the ?No such file or directory? that I would expect to get if there were no file. Any ideas on how to proceed?

Dan Kelley / Oceanography / Dalhousie University / Halifax NS Canada

> ### ** Examples
> 
> library(oce)
> ## A CTD-style rsk
> if (requireNamespace("R.utils")) {
+   file <- system.file("extdata", "sample.rsk.gz", package="oce")
+   tmp <- tempfile(fileext=".rsk")
+   R.utils::decompressFile(file, destname=tmp, ext="gz", FUN=gzfile, remove=FALSE)
+   rsk <- read.rsk(tmp)
+   ctd <- as.ctd(rsk)
+   plot(ctdTrim(ctd))
+ }
Loading required namespace: R.utils
Warning in file(file, "r") :
  cannot open file 'd:/RCompile/CRANguest/R-devel/oce.Rcheck/examples_i386/D:\temp\RtmpGUYumI\file29ac3bed3fed.rsk': Invalid argument
Error in file(file, "r") : cannot open the connection
Calls: read.rsk -> file
Execution halted
** running examples for arch 'x64' ... ERROR

From ligges at statistik.tu-dortmund.de  Sun Jul 12 17:38:46 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 12 Jul 2015 17:38:46 +0200
Subject: [R-pkg-devel] R-devel problem with temporary files or
	decompression?
In-Reply-To: <6FA4EA3B-2C7F-4B92-8678-76008D84594C@dal.ca>
References: <6FA4EA3B-2C7F-4B92-8678-76008D84594C@dal.ca>
Message-ID: <55A28A06.8030600@statistik.tu-dortmund.de>



On 12.07.2015 17:33, Daniel Kelley wrote:
> A data file that I?d like to use in my ?oce? package is quite large, and compresses well, so I thought of putting a compressed version into inst/extdata. I want my documentation to show how to uncompress the file, partly because these files tend to compress so well that I think users might like to store them in gzipped form.
>
> Naturally, I want to test my code using R-devel in addition to the ?release? version that I have on my box. Since I?ve never been able to get R-devel installed properly on OSX, I thought of submitting to win-builder. I got errors as below my signature line. What I don?t understand is the ?Invalid argument?, which seems to be different from the ?No such file or directory? that I would expect to get if there were no file. Any ideas on how to proceed?
>
> Dan Kelley / Oceanography / Dalhousie University / Halifax NS Canada
>
>> ### ** Examples
>>
>> library(oce)
>> ## A CTD-style rsk
>> if (requireNamespace("R.utils")) {
> +   file <- system.file("extdata", "sample.rsk.gz", package="oce")
> +   tmp <- tempfile(fileext=".rsk")
> +   R.utils::decompressFile(file, destname=tmp, ext="gz", FUN=gzfile, remove=FALSE)
> +   rsk <- read.rsk(tmp)
> +   ctd <- as.ctd(rsk)
> +   plot(ctdTrim(ctd))
> + }
> Loading required namespace: R.utils
> Warning in file(file, "r") :
>    cannot open file 'd:/RCompile/CRANguest/R-devel/oce.Rcheck/examples_i386/D:\temp\RtmpGUYumI\file29ac3bed3fed.rsk':


Apparently you have put together the location of the current path and 
the one of the tempfile which does not make sense.

So very likely a bug in your code. Surprise you do not see it on your end.

Best,
Uwe Ligges


> Invalid argument
> Error in file(file, "r") : cannot open the connection
> Calls: read.rsk -> file
> Execution halted
> ** running examples for arch 'x64' ... ERROR
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From Dan.Kelley at Dal.Ca  Sun Jul 12 17:45:16 2015
From: Dan.Kelley at Dal.Ca (Daniel Kelley)
Date: Sun, 12 Jul 2015 15:45:16 +0000
Subject: [R-pkg-devel] R-devel problem with temporary files or
 decompression?
In-Reply-To: <55A28A06.8030600@statistik.tu-dortmund.de>
References: <6FA4EA3B-2C7F-4B92-8678-76008D84594C@dal.ca>
	<55A28A06.8030600@statistik.tu-dortmund.de>
Message-ID: <75DD055E-88D0-446C-98B6-2D2EB4A6E5FA@dal.ca>

Uwe, thanks very much. How silly of me.  It was because my code creates full pathnames except if the first char of a filename is ?/? or ?~?, etc. I have never really used windows/msdos (went from 1970s unix to OSX) and so I was being very silly. Dan.

> On Jul 12, 2015, at 12:38 PM, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
> 
> 
> 
> On 12.07.2015 17:33, Daniel Kelley wrote:
>> A data file that I?d like to use in my ?oce? package is quite large, and compresses well, so I thought of putting a compressed version into inst/extdata. I want my documentation to show how to uncompress the file, partly because these files tend to compress so well that I think users might like to store them in gzipped form.
>> 
>> Naturally, I want to test my code using R-devel in addition to the ?release? version that I have on my box. Since I?ve never been able to get R-devel installed properly on OSX, I thought of submitting to win-builder. I got errors as below my signature line. What I don?t understand is the ?Invalid argument?, which seems to be different from the ?No such file or directory? that I would expect to get if there were no file. Any ideas on how to proceed?
>> 
>> Dan Kelley / Oceanography / Dalhousie University / Halifax NS Canada
>> 
>>> ### ** Examples
>>> 
>>> library(oce)
>>> ## A CTD-style rsk
>>> if (requireNamespace("R.utils")) {
>> +   file <- system.file("extdata", "sample.rsk.gz", package="oce")
>> +   tmp <- tempfile(fileext=".rsk")
>> +   R.utils::decompressFile(file, destname=tmp, ext="gz", FUN=gzfile, remove=FALSE)
>> +   rsk <- read.rsk(tmp)
>> +   ctd <- as.ctd(rsk)
>> +   plot(ctdTrim(ctd))
>> + }
>> Loading required namespace: R.utils
>> Warning in file(file, "r") :
>>   cannot open file 'd:/RCompile/CRANguest/R-devel/oce.Rcheck/examples_i386/D:\temp\RtmpGUYumI\file29ac3bed3fed.rsk':
> 
> 
> Apparently you have put together the location of the current path and the one of the tempfile which does not make sense.
> 
> So very likely a bug in your code. Surprise you do not see it on your end.
> 
> Best,
> Uwe Ligges
> 
> 
>> Invalid argument
>> Error in file(file, "r") : cannot open the connection
>> Calls: read.rsk -> file
>> Execution halted
>> ** running examples for arch 'x64' ... ERROR
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From daattali at gmail.com  Sun Jul 12 22:01:05 2015
From: daattali at gmail.com (Dean Attali)
Date: Sun, 12 Jul 2015 13:01:05 -0700
Subject: [R-pkg-devel] Do I need to namespace and import functions from
	'methods' package?
Message-ID: <CA+j8Z+nNWX4r26_vaWH1HcDfCw6xXG=K=QiEPWxMmzqTkVACHw@mail.gmail.com>

I have a package that is using the 'is' function from the 'methods'
package.  My package has been on CRAN for some time now and has had 3
different versions already. Yesterday when submitting, I got a response
with:

* checking R code for possible problems ... NOTE
> ggMarginal: no visible global function definition for 'is'
> Undefined global functions or variables:
>   is


So I fixed it by changing 'is' to 'methods::is', and then I got a response

* checking dependencies in R code ... WARNING
> '::' or ':::' import not declared from: ?methods?


So I suppose I need to declare 'methods' in my imported packages.

My question is: is this a new requirement, to explicitly import 'methods'
and namespace functions from it, or has it always been a requirement but I
just wasn't caught? Or is it not even a requirement and the R CMD check was
being weird?

---
http://deanattali.com

	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Sun Jul 12 22:36:09 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 12 Jul 2015 16:36:09 -0400
Subject: [R-pkg-devel] Do I need to namespace and import functions from
 'methods' package?
In-Reply-To: <CA+j8Z+nNWX4r26_vaWH1HcDfCw6xXG=K=QiEPWxMmzqTkVACHw@mail.gmail.com>
References: <CA+j8Z+nNWX4r26_vaWH1HcDfCw6xXG=K=QiEPWxMmzqTkVACHw@mail.gmail.com>
Message-ID: <55A2CFB9.7080807@gmail.com>

On 12/07/2015 4:01 PM, Dean Attali wrote:
> I have a package that is using the 'is' function from the 'methods'
> package.  My package has been on CRAN for some time now and has had 3
> different versions already. Yesterday when submitting, I got a response
> with:
> 
> * checking R code for possible problems ... NOTE
>> ggMarginal: no visible global function definition for 'is'
>> Undefined global functions or variables:
>>   is
> 
> 
> So I fixed it by changing 'is' to 'methods::is', and then I got a response
> 
> * checking dependencies in R code ... WARNING
>> '::' or ':::' import not declared from: ?methods?
> 
> 
> So I suppose I need to declare 'methods' in my imported packages.
> 
> My question is: is this a new requirement, to explicitly import 'methods'
> and namespace functions from it, or has it always been a requirement but I
> just wasn't caught? Or is it not even a requirement and the R CMD check was
> being weird?
> 

It is a new requirement.  As Joshua Ulrich posted on Friday,

> Yes, this is expected.  See:
> http://developer.r-project.org/blosxom.cgi/R-devel/NEWS/2015/06/29#n2015-06-29
> 
> And an earlier email on this list:
> https://stat.ethz.ch/pipermail/r-package-devel/2015q2/000171.html


From daattali at gmail.com  Sun Jul 12 22:47:43 2015
From: daattali at gmail.com (Dean Attali)
Date: Sun, 12 Jul 2015 13:47:43 -0700
Subject: [R-pkg-devel] Do I need to namespace and import functions from
 'methods' package?
In-Reply-To: <55A2CFB9.7080807@gmail.com>
References: <CA+j8Z+nNWX4r26_vaWH1HcDfCw6xXG=K=QiEPWxMmzqTkVACHw@mail.gmail.com>
	<55A2CFB9.7080807@gmail.com>
Message-ID: <CA+j8Z+mLY2_ef0=kvze=OytZ+83APWVAnLJeTzB56DH5Q540_g@mail.gmail.com>

I see there have been several messages about this recently. I apologize, I
wasn't aware of the fact that I could search old messages on the board -
will do that next time, thanks

---
http://deanattali.com

On 12 July 2015 at 13:36, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> On 12/07/2015 4:01 PM, Dean Attali wrote:
> > I have a package that is using the 'is' function from the 'methods'
> > package.  My package has been on CRAN for some time now and has had 3
> > different versions already. Yesterday when submitting, I got a response
> > with:
> >
> > * checking R code for possible problems ... NOTE
> >> ggMarginal: no visible global function definition for 'is'
> >> Undefined global functions or variables:
> >>   is
> >
> >
> > So I fixed it by changing 'is' to 'methods::is', and then I got a
> response
> >
> > * checking dependencies in R code ... WARNING
> >> '::' or ':::' import not declared from: ?methods?
> >
> >
> > So I suppose I need to declare 'methods' in my imported packages.
> >
> > My question is: is this a new requirement, to explicitly import 'methods'
> > and namespace functions from it, or has it always been a requirement but
> I
> > just wasn't caught? Or is it not even a requirement and the R CMD check
> was
> > being weird?
> >
>
> It is a new requirement.  As Joshua Ulrich posted on Friday,
>
> > Yes, this is expected.  See:
> >
> http://developer.r-project.org/blosxom.cgi/R-devel/NEWS/2015/06/29#n2015-06-29
> >
> > And an earlier email on this list:
> > https://stat.ethz.ch/pipermail/r-package-devel/2015q2/000171.html
>
>
>

	[[alternative HTML version deleted]]


From henrik.bengtsson at ucsf.edu  Sun Jul 12 22:30:16 2015
From: henrik.bengtsson at ucsf.edu (Henrik Bengtsson)
Date: Sun, 12 Jul 2015 13:30:16 -0700
Subject: [R-pkg-devel] R-devel problem with temporary files or
	decompression?
In-Reply-To: <75DD055E-88D0-446C-98B6-2D2EB4A6E5FA@dal.ca>
References: <6FA4EA3B-2C7F-4B92-8678-76008D84594C@dal.ca>
	<55A28A06.8030600@statistik.tu-dortmund.de>
	<75DD055E-88D0-446C-98B6-2D2EB4A6E5FA@dal.ca>
Message-ID: <CAFDcVCT=+D_B1hqP6SV6nL_QbVAxm3i3p4ubZpxUxZBvV-+6cA@mail.gmail.com>

I don't see any particular wrong with your code, so it seems like
R.utils doesn't handle your 'file' / 'tmp' pathnames correctly.
However, I cannot reproduce this (know what 'file' and 'tmp' are would
help), so I cannot fix it either.

Either way, instead of using low-level decompressFile(), you can
achieve what you want with:

rsk <- R.utils::gunzip(file, temporary=TRUE, remove=FALSE)

If you don't use temporary=TRUE, then 'rsk' with point to 'sample.rsk'
in the current directory.

/Henrik
(author of R.utils)

On Sun, Jul 12, 2015 at 8:45 AM, Daniel Kelley <Dan.Kelley at dal.ca> wrote:
> Uwe, thanks very much. How silly of me.  It was because my code creates full pathnames except if the first char of a filename is ?/? or ?~?, etc. I have never really used windows/msdos (went from 1970s unix to OSX) and so I was being very silly. Dan.
>
>> On Jul 12, 2015, at 12:38 PM, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
>>
>>
>>
>> On 12.07.2015 17:33, Daniel Kelley wrote:
>>> A data file that I?d like to use in my ?oce? package is quite large, and compresses well, so I thought of putting a compressed version into inst/extdata. I want my documentation to show how to uncompress the file, partly because these files tend to compress so well that I think users might like to store them in gzipped form.
>>>
>>> Naturally, I want to test my code using R-devel in addition to the ?release? version that I have on my box. Since I?ve never been able to get R-devel installed properly on OSX, I thought of submitting to win-builder. I got errors as below my signature line. What I don?t understand is the ?Invalid argument?, which seems to be different from the ?No such file or directory? that I would expect to get if there were no file. Any ideas on how to proceed?
>>>
>>> Dan Kelley / Oceanography / Dalhousie University / Halifax NS Canada
>>>
>>>> ### ** Examples
>>>>
>>>> library(oce)
>>>> ## A CTD-style rsk
>>>> if (requireNamespace("R.utils")) {
>>> +   file <- system.file("extdata", "sample.rsk.gz", package="oce")
>>> +   tmp <- tempfile(fileext=".rsk")
>>> +   R.utils::decompressFile(file, destname=tmp, ext="gz", FUN=gzfile, remove=FALSE)
>>> +   rsk <- read.rsk(tmp)
>>> +   ctd <- as.ctd(rsk)
>>> +   plot(ctdTrim(ctd))
>>> + }
>>> Loading required namespace: R.utils
>>> Warning in file(file, "r") :
>>>   cannot open file 'd:/RCompile/CRANguest/R-devel/oce.Rcheck/examples_i386/D:\temp\RtmpGUYumI\file29ac3bed3fed.rsk':
>>
>>
>> Apparently you have put together the location of the current path and the one of the tempfile which does not make sense.
>>
>> So very likely a bug in your code. Surprise you do not see it on your end.
>>
>> Best,
>> Uwe Ligges
>>
>>
>>> Invalid argument
>>> Error in file(file, "r") : cannot open the connection
>>> Calls: read.rsk -> file
>>> Execution halted
>>> ** running examples for arch 'x64' ... ERROR
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From pieter.eendebak at gmail.com  Mon Jul 13 00:00:48 2015
From: pieter.eendebak at gmail.com (Pieter Eendebak)
Date: Mon, 13 Jul 2015 00:00:48 +0200
Subject: [R-pkg-devel] size of object files
Message-ID: <CA+j_vEpcC=u7nW909dU05Qe9L4N_1o24wOZ88Qr54FGqO047Ew@mail.gmail.com>

Dear newsgroup,

The size of the object files in my R package is quite large (c++ code with
Eigen templates). How can I reduce this size?

Under linux the final shared library is over 20 Mb large. With the command
strip I can reduce the size to less than 500Kb, but I do not know how to
add the strip command to the R build system. I am also not sure whether
stripping the object files is allowed for R packages, since it can make
debugging harder.

With kind regards,
Pieter Eendebak

	[[alternative HTML version deleted]]


From kasperdanielhansen at gmail.com  Mon Jul 13 14:16:35 2015
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Mon, 13 Jul 2015 14:16:35 +0200
Subject: [R-pkg-devel] recommendation: codetoolsBioC
Message-ID: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>

With the new NAMESPACE requirements of importing everything in the bundled
packages I would like to recommend using
  writeNamespaceImports
from codetoolsBioC.  This analyzes your code and produces a NAMESPACE file
with all imports.  Of course, you might benefit from checking it manually.

This package is from Bioconductor, but you need to check it out from svn
(it was never officially released).

svn co
https://hedgehog.fhcrc.org/gentleman/bioconductor/trunk/madman/Rpacks/codetoolsBioC


Perhaps similar tools exists elsewhere now; this package has been around
for quite a while.

Best,
Kasper

	[[alternative HTML version deleted]]


From berryboessenkool at hotmail.com  Mon Jul 13 18:45:45 2015
From: berryboessenkool at hotmail.com (Berry Boessenkool)
Date: Mon, 13 Jul 2015 18:45:45 +0200
Subject: [R-pkg-devel] invalid URL status 391
Message-ID: <DUB123-W84B5E0964C4AE16FB168ED59C0@phx.gbl>


Good evening (or, depending on your time zone, good morning, night or any favorite time of the day),

I get the following NOTE with Rdevel 2015-07-12 r68650? CMD check --as-cran:

Found the following (possibly) invalid URLs:
? URL: http://www.jstor.org/stable/view/2983411
??? From: man/ci.Rd
??? Status: 391

The other links in the References section work just fine.

My browser changes the url into
http://www.jstor.org/stable/2983411?seq=1#page_scan_tab_contents
but even if I use that link in the Rd file, I still get the note.
Any hints?

Thanks and have a good night (or, depending on...),

Berry


 		 	   		  

From ucfagls at gmail.com  Mon Jul 13 20:01:54 2015
From: ucfagls at gmail.com (Gavin Simpson)
Date: Mon, 13 Jul 2015 12:01:54 -0600
Subject: [R-pkg-devel] invalid URL status 391
In-Reply-To: <DUB123-W84B5E0964C4AE16FB168ED59C0@phx.gbl>
References: <DUB123-W84B5E0964C4AE16FB168ED59C0@phx.gbl>
Message-ID: <CAAHES9z6cO7RQcSaUjNtz1Tte_fp0gDOxYqbnNAmz1P3u=b-kA@mail.gmail.com>

Note the "(possibly)"; just explain the URL is correct when/if you
submitted to CRAN. I think this is may be an issue with the function used
to test the URL not being able to follow the redirect. Status codes in the
3xx block relate to redirects but I couldn't find what code 391 means...
but the URL is fine and works currently, though the recommended URL is
actually: http://www.jstor.org/stable/2983411 so you might consider
updating the URL to this one now.

HTH

Gavin

On 13 July 2015 at 10:45, Berry Boessenkool <berryboessenkool at hotmail.com>
wrote:

>
> Good evening (or, depending on your time zone, good morning, night or any
> favorite time of the day),
>
> I get the following NOTE with Rdevel 2015-07-12 r68650  CMD check
> --as-cran:
>
> Found the following (possibly) invalid URLs:
>   URL: http://www.jstor.org/stable/view/2983411
>     From: man/ci.Rd
>     Status: 391
>
> The other links in the References section work just fine.
>
> My browser changes the url into
> http://www.jstor.org/stable/2983411?seq=1#page_scan_tab_contents
> but even if I use that link in the Rd file, I still get the note.
> Any hints?
>
> Thanks and have a good night (or, depending on...),
>
> Berry
>
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



-- 
Gavin Simpson, PhD

	[[alternative HTML version deleted]]


From Sebastien.Bihorel at cognigencorp.com  Mon Jul 13 21:46:29 2015
From: Sebastien.Bihorel at cognigencorp.com (sbihorel)
Date: Mon, 13 Jul 2015 15:46:29 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
Message-ID: <55A41595.8070500@cognigencorp.com>

Hi,

My group has recently upgraded from a fairly old R version (2.12) to the 
R version 3.1.2. In parallel to this upgrade, I am updating our custom 
packages to add functionality and also make them compliant to the 
requirements of the new version of R. I would like to ask your help with 
respect to warning messages I get when I check and install the packages. 
I read the latest version of the manual on writing R extensions, try to 
apply the recommendations, but somehow I am not getting things right. 
Hopefully, with your suggestions, I could setup my package correctly to 
make these messages stop.

I apologize but, for confidentiality purpose, I will have to partially 
anonymize the information.

So here is the situation: we have 2 custom packages (let's call them 
pkgB and pkgC). The pkgB package depends on a 3rd package (let's call it 
pkgA) that is available on CRAN. The pkgC package depends on pkgB, make 
new function available,  and "overwrites" some of the functions 
distributed as part of pkgA. The following table summarizes the content 
of the DESCRIPTION and NAMESPACE files of each of these packages.

package    DESCRIPTION NAMESPACE
            Depends                       Imports 
import                         importFrom
pkgA       methods, lattice, grid, gam   Hmisc, survival lattice, grid, 
gam, methods    Hmisc
pkgB       pkgA pkgA
pkgC       methods, pkgB methods, pkgB

I do not get any warning when I build, check or install pkgB in our 
linux openSuse environment.

After successful building pkgC, I run R CMD check on my built for pkgC 
but I get a ton of messages under the "checking R code for possible 
problems" section. These notes are related to actual calls to pkgA 
functions (or to one of the function provided by its dependencies). Here 
is a subset for illustration and hopefully information.

* checking R code for possible problems: NOTE
pkgC_function_001: no visible global function definition 
for"pkgA_function_AAA"
pkgC_function_001: no visible global function definition 
for"pkgA_function_AAB"
...
pkgC_function_010: no visible global function definition for"xyplot"
pkgC_function_010: no visible global function definition for"panel.xyplot"
pkgC_function_010: no visible global function definition for"panel.abline"
pkgC_function_010: no visible global function definition for"grid.polygon"
pkgC_function_010: no visible global function definition for"gpar"
...

Now when I try to install the pkgC_0.0.1.tar.gz package, I get the 
following warnings about the content of my documentation Rd files. The 
Rd files of pkgC includes links to lattice, grid, or pkgA functions.

*** installing help indices
   converting help for package ?kiwixposedev?
     finding HTML links ... done
pkgC_function_001                    html
     pkgC_function_002                    html
...
Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file 
link "panel.abline"
...
Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file 
link "pkA_function_AAC"
...

I think I need to somehow modify the content of the DESCRIPTION and 
NAMESPACE files for pkgC... but adding various combinations of pkA and 
its dependencies gave me others errors about redundancies and multiple 
loading of the same packages. So in short, I am kind of lost with the 
new requirements of R 3.1.2 and would greatly appreciate any help or 
suggestions

Thank you in advance for your time.

Sebastien Bihorel


	[[alternative HTML version deleted]]


From jfox at mcmaster.ca  Mon Jul 13 22:31:38 2015
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 13 Jul 2015 16:31:38 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
Message-ID: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>

Dear list members,

I'm getting a new note from R-devel that I haven't seen before when checking
the development version of the Rcmdr package:

	* checking R code for possible problems ... NOTE
	readDataFromPackage: Error while checking: invalid 'envir' argument

This note doesn't appear in R 3.2.1.

My session info:

-------- snip ----------

R Under development (unstable) (2015-07-12 r68650)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 7 x64 (build 7601) Service Pack 1

locale:
[1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
LC_MONETARY=English_Canada.1252
[4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
[1] tools_3.3.0

-------- snip ----------

I can't even localize the problem in readDataFromPackage(). There are only
two places in this function where there's a function call with an envir
argument, and I still get the note if I comment these out. As well,
readDataFromPackage() seems to work as intended -- there is no obvious error
in it.

FWIW, here's readDataFromPackage(). The complete sources for the development
version of the Rcmdr package are on R-Forge.

-------- snip ----------

readDataFromPackage <- function() {
	env <- environment()
	datasets <- NULL
	initializeDialog(title=gettextRcmdr("Read Data From Package"))
	dsname <- tclVar("")
	package <- NULL
	enterFrame <- tkframe(top)
	entryDsname <- ttkentry(enterFrame, width="20", textvariable=dsname)
	packages <- sort(.packages())
	packages <- packages[! packages %in% c("base", "stats")]
	packages <- packages[sapply(packages, function(package){
						ds <-
data(package=package)$results
						if (nrow(ds) == 0)
return(FALSE)
						ds <- ds[, "Item"]
						valid <- sapply(ds,
is.valid.name)
						length(ds[valid]) > 0
					})]
	packageDatasetFrame <- tkframe(top)
	packageFrame <- tkframe(packageDatasetFrame)
	max.height <- getRcmdr("variable.list.height")
	packageBox <- tklistbox(packageFrame, height=min(max.height,
length(packages)), 
            exportselection="FALSE",
			selectmode="single", background="white")
	packageScroll <- ttkscrollbar(packageFrame,
			command=function(...) tkyview(packageBox, ...))
	tkconfigure(packageBox, yscrollcommand=function(...)
tkset(packageScroll, ...))
	for (p in packages) tkinsert(packageBox, "end", p)
	datasetFrame <- tkframe(packageDatasetFrame)
	datasetBox <- tklistbox(datasetFrame, height=max.height,
exportselection="FALSE",
			selectmode="single", background="white")
	datasetScroll <- ttkscrollbar(datasetFrame,
			command=function(...) tkyview(datasetBox, ...))
	tkconfigure(datasetBox, yscrollcommand=function(...)
tkset(datasetScroll, ...))
	onPackageSelect <- function(){
		assign("package",
packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
		datasets <<- data(package=package)$results[,3]
		valid <- sapply(datasets, is.valid.name)
		datasets <<- datasets[valid]
		tkdelete(datasetBox, "0", "end")
		for (dataset in datasets) tkinsert(datasetBox, "end",
dataset)
		tkconfigure(datasetBox, height=min(max.height,
length(datasets)))
		firstChar <- tolower(substr(datasets, 1, 1))
		len <- length(datasets)
		onLetter <- function(letter){
			letter <- tolower(letter)
			current <- 1 +
round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
"))[1])*len)
			mat <- match(letter, firstChar[-(1:current)])
			if (is.na(mat)) return()
			tkyview.scroll(datasetBox, mat, "units")
		}
		onA <- function() onLetter("a")
		onB <- function() onLetter("b")
		onC <- function() onLetter("c")
		onD <- function() onLetter("d")
		onE <- function() onLetter("e")
		onF <- function() onLetter("f")
		onG <- function() onLetter("g")
		onH <- function() onLetter("h")
		onI <- function() onLetter("i")
		onJ <- function() onLetter("j")
		onK <- function() onLetter("k")
		onL <- function() onLetter("l")
		onM <- function() onLetter("m")
		onN <- function() onLetter("n")
		onO <- function() onLetter("o")
		onP <- function() onLetter("p")
		onQ <- function() onLetter("q")
		onR <- function() onLetter("r")
		onS <- function() onLetter("s")
		onT <- function() onLetter("t")
		onU <- function() onLetter("u")
		onV <- function() onLetter("v")
		onW <- function() onLetter("w")
		onX <- function() onLetter("x")
		onY <- function() onLetter("y")
		onZ <- function() onLetter("z")
		for (letter in c(letters, LETTERS)){
			tkbind(datasetBox, paste("<", letter, ">", sep=""),
					get(paste("on", toupper(letter),
sep="")))
		}
		onClick <- function() tkfocus(datasetBox)
		tkbind(datasetBox, "<ButtonPress-1>", onClick)
	}
	onDatasetSelect <- function(){
		tclvalue(dsname) <-
datasets[as.numeric(tkcurselection(datasetBox)) + 1]
	}
	firstChar <- tolower(substr(packages, 1, 1))
	len <- length(packages)
	onLetter <- function(letter){
		letter <- tolower(letter)
		current <- 1 +
round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
"))[1])*len)
		mat <- match(letter, firstChar[-(1:current)])
		if (is.na(mat)) return()
		tkyview.scroll(packageBox, mat, "units")
	}
	onA <- function() onLetter("a")
	onB <- function() onLetter("b")
	onC <- function() onLetter("c")
	onD <- function() onLetter("d")
	onE <- function() onLetter("e")
	onF <- function() onLetter("f")
	onG <- function() onLetter("g")
	onH <- function() onLetter("h")
	onI <- function() onLetter("i")
	onJ <- function() onLetter("j")
	onK <- function() onLetter("k")
	onL <- function() onLetter("l")
	onM <- function() onLetter("m")
	onN <- function() onLetter("n")
	onO <- function() onLetter("o")
	onP <- function() onLetter("p")
	onQ <- function() onLetter("q")
	onR <- function() onLetter("r")
	onS <- function() onLetter("s")
	onT <- function() onLetter("t")
	onU <- function() onLetter("u")
	onV <- function() onLetter("v")
	onW <- function() onLetter("w")
	onX <- function() onLetter("x")
	onY <- function() onLetter("y")
	onZ <- function() onLetter("z")
	for (letter in c(letters, LETTERS)){
		tkbind(packageBox, paste("<", letter, ">", sep=""),
				get(paste("on", toupper(letter), sep="")))
	}
	onClick <- function() tkfocus(packageBox)
	tkbind(packageBox, "<ButtonPress-1>", onClick)
	onOK <- function(){
		datasetName <-
datasets[as.numeric(tkcurselection(datasetBox)) + 1]
		dsnameValue <- tclvalue(dsname)
		if (dsnameValue != "" && is.null(package)){
			closeDialog()
			if (is.element(dsnameValue, listDataSets())) {
				if ("no" ==
tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
					if (GrabFocus()) tkgrab.release(top)
					tkdestroy(top)
					readDataFromPackage()
					return()
				}
			}
			save.options <- options(warn=2)
			check <- try(eval(parse(text=logger(paste("data(",
dsnameValue, ")", sep=""))),
							envir=.GlobalEnv),
silent=TRUE)
			options(save.options)
			if (class(check) == "try-error"){
				errorCondition(recall=readDataFromPackage,
	
message=sprintf(gettextRcmdr("Data set %s does not exit"), dsnameValue))
				return()
			}
			activeDataSet(dsnameValue)
			tkfocus(CommanderWindow())
		}
		else{
			if (is.null(package)) {
				errorCondition(recall=readDataFromPackage,
message=gettextRcmdr("You must select a package."))
				return()
			}
			if (length(datasetName) == 0) {
				errorCondition(recall=readDataFromPackage,
message=gettextRcmdr("You must select a data set.")    )
				return()
			}
			if (is.element(datasetName, listDataSets())) {
				if ("no" ==
tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
					if (GrabFocus()) tkgrab.release(top)
					tkdestroy(top)
					readDataFromPackage()
					return()
				}
			}
			closeDialog()
			command <- paste("data(", datasetName, ',
package="', package, '")', sep="")
			result <- justDoIt(command)
			logger(command)
			if (class(result)[1] !=  "try-error")
activeDataSet(datasetName)
			tkfocus(CommanderWindow())
		}
	}
	onDataHelp <- function(){
    datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) + 1]
		dsnameValue <- tclvalue(dsname)
		if (dsnameValue == "") dsnameValue <- datasetName
		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
set selected."), type="warning")
		else if (is.null(package)) doItAndPrint(paste('help("',
dsnameValue, '")', sep=""))
		else doItAndPrint(paste('help("', dsnameValue, '",
package="', package, '")', sep=""))
	}
	OKCancelHelp(helpSubject="data")
	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
selected data set"), command=onDataHelp)
	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
(Double-click to select)"), fg=getRcmdr("title.color"),
font="RcmdrTitleFont"),
			labelRcmdr(packageDatasetFrame, text="   "),
labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-click to
select)"),
					fg=getRcmdr("title.color"),
font="RcmdrTitleFont"), sticky="w")
	tkgrid(packageBox, packageScroll, sticky="nw")
	tkgrid(datasetBox, datasetScroll, sticky="nw")
	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
datasetFrame, sticky="nw")
	tkgrid(packageDatasetFrame, sticky="w")
	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
sticky="w")
	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"), entryDsname,
sticky="w")
	tkgrid(enterFrame, sticky="w")
	tkgrid(dataHelpButton, sticky="w")
	tkgrid(buttonsFrame, sticky="ew")
	tkgrid.configure(packageScroll, sticky="ns")
	tkgrid.configure(datasetScroll, sticky="ns")
	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
	dialogSuffix(focus=entryDsname)
}

-------- snip ----------

Any insight into the problem would be appreciated.

Thanks,
 John

-----------------------------------------------
John Fox, Professor
McMaster University
Hamilton, Ontario, Canada
http://socserv.socsci.mcmaster.ca/jfox/




---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From pdalgd at gmail.com  Mon Jul 13 22:52:16 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Mon, 13 Jul 2015 22:52:16 +0200
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
Message-ID: <C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>

Yes, there was a similar note from Alexandra Kuznetsova a couple of days ago. Look unintentional, but it is not easy to spot what triggers it. If someone could cook up a minimal example, or - maybe easier given the relatively short timeframe - bisect their way to the exact svn revision that triggered it, it might help in getting it fixed.

-pd

> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
> 
> Dear list members,
> 
> I'm getting a new note from R-devel that I haven't seen before when checking
> the development version of the Rcmdr package:
> 
> 	* checking R code for possible problems ... NOTE
> 	readDataFromPackage: Error while checking: invalid 'envir' argument
> 
> This note doesn't appear in R 3.2.1.
> 
> My session info:
> 
> -------- snip ----------
> 
> R Under development (unstable) (2015-07-12 r68650)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 7 x64 (build 7601) Service Pack 1
> 
> locale:
> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> LC_MONETARY=English_Canada.1252
> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252    
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base     
> 
> loaded via a namespace (and not attached):
> [1] tools_3.3.0
> 
> -------- snip ----------
> 
> I can't even localize the problem in readDataFromPackage(). There are only
> two places in this function where there's a function call with an envir
> argument, and I still get the note if I comment these out. As well,
> readDataFromPackage() seems to work as intended -- there is no obvious error
> in it.
> 
> FWIW, here's readDataFromPackage(). The complete sources for the development
> version of the Rcmdr package are on R-Forge.
> 
> -------- snip ----------
> 
> readDataFromPackage <- function() {
> 	env <- environment()
> 	datasets <- NULL
> 	initializeDialog(title=gettextRcmdr("Read Data From Package"))
> 	dsname <- tclVar("")
> 	package <- NULL
> 	enterFrame <- tkframe(top)
> 	entryDsname <- ttkentry(enterFrame, width="20", textvariable=dsname)
> 	packages <- sort(.packages())
> 	packages <- packages[! packages %in% c("base", "stats")]
> 	packages <- packages[sapply(packages, function(package){
> 						ds <-
> data(package=package)$results
> 						if (nrow(ds) == 0)
> return(FALSE)
> 						ds <- ds[, "Item"]
> 						valid <- sapply(ds,
> is.valid.name)
> 						length(ds[valid]) > 0
> 					})]
> 	packageDatasetFrame <- tkframe(top)
> 	packageFrame <- tkframe(packageDatasetFrame)
> 	max.height <- getRcmdr("variable.list.height")
> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
> length(packages)), 
>            exportselection="FALSE",
> 			selectmode="single", background="white")
> 	packageScroll <- ttkscrollbar(packageFrame,
> 			command=function(...) tkyview(packageBox, ...))
> 	tkconfigure(packageBox, yscrollcommand=function(...)
> tkset(packageScroll, ...))
> 	for (p in packages) tkinsert(packageBox, "end", p)
> 	datasetFrame <- tkframe(packageDatasetFrame)
> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
> exportselection="FALSE",
> 			selectmode="single", background="white")
> 	datasetScroll <- ttkscrollbar(datasetFrame,
> 			command=function(...) tkyview(datasetBox, ...))
> 	tkconfigure(datasetBox, yscrollcommand=function(...)
> tkset(datasetScroll, ...))
> 	onPackageSelect <- function(){
> 		assign("package",
> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
> 		datasets <<- data(package=package)$results[,3]
> 		valid <- sapply(datasets, is.valid.name)
> 		datasets <<- datasets[valid]
> 		tkdelete(datasetBox, "0", "end")
> 		for (dataset in datasets) tkinsert(datasetBox, "end",
> dataset)
> 		tkconfigure(datasetBox, height=min(max.height,
> length(datasets)))
> 		firstChar <- tolower(substr(datasets, 1, 1))
> 		len <- length(datasets)
> 		onLetter <- function(letter){
> 			letter <- tolower(letter)
> 			current <- 1 +
> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
> "))[1])*len)
> 			mat <- match(letter, firstChar[-(1:current)])
> 			if (is.na(mat)) return()
> 			tkyview.scroll(datasetBox, mat, "units")
> 		}
> 		onA <- function() onLetter("a")
> 		onB <- function() onLetter("b")
> 		onC <- function() onLetter("c")
> 		onD <- function() onLetter("d")
> 		onE <- function() onLetter("e")
> 		onF <- function() onLetter("f")
> 		onG <- function() onLetter("g")
> 		onH <- function() onLetter("h")
> 		onI <- function() onLetter("i")
> 		onJ <- function() onLetter("j")
> 		onK <- function() onLetter("k")
> 		onL <- function() onLetter("l")
> 		onM <- function() onLetter("m")
> 		onN <- function() onLetter("n")
> 		onO <- function() onLetter("o")
> 		onP <- function() onLetter("p")
> 		onQ <- function() onLetter("q")
> 		onR <- function() onLetter("r")
> 		onS <- function() onLetter("s")
> 		onT <- function() onLetter("t")
> 		onU <- function() onLetter("u")
> 		onV <- function() onLetter("v")
> 		onW <- function() onLetter("w")
> 		onX <- function() onLetter("x")
> 		onY <- function() onLetter("y")
> 		onZ <- function() onLetter("z")
> 		for (letter in c(letters, LETTERS)){
> 			tkbind(datasetBox, paste("<", letter, ">", sep=""),
> 					get(paste("on", toupper(letter),
> sep="")))
> 		}
> 		onClick <- function() tkfocus(datasetBox)
> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
> 	}
> 	onDatasetSelect <- function(){
> 		tclvalue(dsname) <-
> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> 	}
> 	firstChar <- tolower(substr(packages, 1, 1))
> 	len <- length(packages)
> 	onLetter <- function(letter){
> 		letter <- tolower(letter)
> 		current <- 1 +
> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
> "))[1])*len)
> 		mat <- match(letter, firstChar[-(1:current)])
> 		if (is.na(mat)) return()
> 		tkyview.scroll(packageBox, mat, "units")
> 	}
> 	onA <- function() onLetter("a")
> 	onB <- function() onLetter("b")
> 	onC <- function() onLetter("c")
> 	onD <- function() onLetter("d")
> 	onE <- function() onLetter("e")
> 	onF <- function() onLetter("f")
> 	onG <- function() onLetter("g")
> 	onH <- function() onLetter("h")
> 	onI <- function() onLetter("i")
> 	onJ <- function() onLetter("j")
> 	onK <- function() onLetter("k")
> 	onL <- function() onLetter("l")
> 	onM <- function() onLetter("m")
> 	onN <- function() onLetter("n")
> 	onO <- function() onLetter("o")
> 	onP <- function() onLetter("p")
> 	onQ <- function() onLetter("q")
> 	onR <- function() onLetter("r")
> 	onS <- function() onLetter("s")
> 	onT <- function() onLetter("t")
> 	onU <- function() onLetter("u")
> 	onV <- function() onLetter("v")
> 	onW <- function() onLetter("w")
> 	onX <- function() onLetter("x")
> 	onY <- function() onLetter("y")
> 	onZ <- function() onLetter("z")
> 	for (letter in c(letters, LETTERS)){
> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
> 				get(paste("on", toupper(letter), sep="")))
> 	}
> 	onClick <- function() tkfocus(packageBox)
> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
> 	onOK <- function(){
> 		datasetName <-
> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> 		dsnameValue <- tclvalue(dsname)
> 		if (dsnameValue != "" && is.null(package)){
> 			closeDialog()
> 			if (is.element(dsnameValue, listDataSets())) {
> 				if ("no" ==
> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
> 					if (GrabFocus()) tkgrab.release(top)
> 					tkdestroy(top)
> 					readDataFromPackage()
> 					return()
> 				}
> 			}
> 			save.options <- options(warn=2)
> 			check <- try(eval(parse(text=logger(paste("data(",
> dsnameValue, ")", sep=""))),
> 							envir=.GlobalEnv),
> silent=TRUE)
> 			options(save.options)
> 			if (class(check) == "try-error"){
> 				errorCondition(recall=readDataFromPackage,
> 	
> message=sprintf(gettextRcmdr("Data set %s does not exit"), dsnameValue))
> 				return()
> 			}
> 			activeDataSet(dsnameValue)
> 			tkfocus(CommanderWindow())
> 		}
> 		else{
> 			if (is.null(package)) {
> 				errorCondition(recall=readDataFromPackage,
> message=gettextRcmdr("You must select a package."))
> 				return()
> 			}
> 			if (length(datasetName) == 0) {
> 				errorCondition(recall=readDataFromPackage,
> message=gettextRcmdr("You must select a data set.")    )
> 				return()
> 			}
> 			if (is.element(datasetName, listDataSets())) {
> 				if ("no" ==
> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
> 					if (GrabFocus()) tkgrab.release(top)
> 					tkdestroy(top)
> 					readDataFromPackage()
> 					return()
> 				}
> 			}
> 			closeDialog()
> 			command <- paste("data(", datasetName, ',
> package="', package, '")', sep="")
> 			result <- justDoIt(command)
> 			logger(command)
> 			if (class(result)[1] !=  "try-error")
> activeDataSet(datasetName)
> 			tkfocus(CommanderWindow())
> 		}
> 	}
> 	onDataHelp <- function(){
>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> 		dsnameValue <- tclvalue(dsname)
> 		if (dsnameValue == "") dsnameValue <- datasetName
> 		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
> set selected."), type="warning")
> 		else if (is.null(package)) doItAndPrint(paste('help("',
> dsnameValue, '")', sep=""))
> 		else doItAndPrint(paste('help("', dsnameValue, '",
> package="', package, '")', sep=""))
> 	}
> 	OKCancelHelp(helpSubject="data")
> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
> selected data set"), command=onDataHelp)
> 	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
> (Double-click to select)"), fg=getRcmdr("title.color"),
> font="RcmdrTitleFont"),
> 			labelRcmdr(packageDatasetFrame, text="   "),
> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-click to
> select)"),
> 					fg=getRcmdr("title.color"),
> font="RcmdrTitleFont"), sticky="w")
> 	tkgrid(packageBox, packageScroll, sticky="nw")
> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
> datasetFrame, sticky="nw")
> 	tkgrid(packageDatasetFrame, sticky="w")
> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
> sticky="w")
> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"), entryDsname,
> sticky="w")
> 	tkgrid(enterFrame, sticky="w")
> 	tkgrid(dataHelpButton, sticky="w")
> 	tkgrid(buttonsFrame, sticky="ew")
> 	tkgrid.configure(packageScroll, sticky="ns")
> 	tkgrid.configure(datasetScroll, sticky="ns")
> 	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
> 	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
> 	dialogSuffix(focus=entryDsname)
> }
> 
> -------- snip ----------
> 
> Any insight into the problem would be appreciated.
> 
> Thanks,
> John
> 
> -----------------------------------------------
> John Fox, Professor
> McMaster University
> Hamilton, Ontario, Canada
> http://socserv.socsci.mcmaster.ca/jfox/
> 
> 
> 
> 
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From jfox at mcmaster.ca  Mon Jul 13 23:23:56 2015
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 13 Jul 2015 17:23:56 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
Message-ID: <003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>

Dear Peter,

> -----Original Message-----
> From: peter dalgaard [mailto:pdalgd at gmail.com]
> Sent: July-13-15 4:52 PM
> To: John Fox
> Cc: r-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
> 
> Yes, there was a similar note from Alexandra Kuznetsova a couple of days

Sorry, I didn't notice that.

> ago. Look unintentional, but it is not easy to spot what triggers it. If
> someone could cook up a minimal example, or - maybe easier given the
> relatively short timeframe - bisect their way to the exact svn revision
> that triggered it, it might help in getting it fixed.

I'm afraid that I'm not set up to build R-devel and I'm about to leave town
for three weeks. I'll see if I can produce a simpler example triggering the
error, however.

Thanks for this,
 John

> 
> -pd
> 
> > On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
> >
> > Dear list members,
> >
> > I'm getting a new note from R-devel that I haven't seen before when
> checking
> > the development version of the Rcmdr package:
> >
> > 	* checking R code for possible problems ... NOTE
> > 	readDataFromPackage: Error while checking: invalid 'envir' argument
> >
> > This note doesn't appear in R 3.2.1.
> >
> > My session info:
> >
> > -------- snip ----------
> >
> > R Under development (unstable) (2015-07-12 r68650)
> > Platform: x86_64-w64-mingw32/x64 (64-bit)
> > Running under: Windows 7 x64 (build 7601) Service Pack 1
> >
> > locale:
> > [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> > LC_MONETARY=English_Canada.1252
> > [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > loaded via a namespace (and not attached):
> > [1] tools_3.3.0
> >
> > -------- snip ----------
> >
> > I can't even localize the problem in readDataFromPackage(). There are
> only
> > two places in this function where there's a function call with an
> envir
> > argument, and I still get the note if I comment these out. As well,
> > readDataFromPackage() seems to work as intended -- there is no obvious
> error
> > in it.
> >
> > FWIW, here's readDataFromPackage(). The complete sources for the
> development
> > version of the Rcmdr package are on R-Forge.
> >
> > -------- snip ----------
> >
> > readDataFromPackage <- function() {
> > 	env <- environment()
> > 	datasets <- NULL
> > 	initializeDialog(title=gettextRcmdr("Read Data From Package"))
> > 	dsname <- tclVar("")
> > 	package <- NULL
> > 	enterFrame <- tkframe(top)
> > 	entryDsname <- ttkentry(enterFrame, width="20",
> textvariable=dsname)
> > 	packages <- sort(.packages())
> > 	packages <- packages[! packages %in% c("base", "stats")]
> > 	packages <- packages[sapply(packages, function(package){
> > 						ds <-
> > data(package=package)$results
> > 						if (nrow(ds) == 0)
> > return(FALSE)
> > 						ds <- ds[, "Item"]
> > 						valid <- sapply(ds,
> > is.valid.name)
> > 						length(ds[valid]) > 0
> > 					})]
> > 	packageDatasetFrame <- tkframe(top)
> > 	packageFrame <- tkframe(packageDatasetFrame)
> > 	max.height <- getRcmdr("variable.list.height")
> > 	packageBox <- tklistbox(packageFrame, height=min(max.height,
> > length(packages)),
> >            exportselection="FALSE",
> > 			selectmode="single", background="white")
> > 	packageScroll <- ttkscrollbar(packageFrame,
> > 			command=function(...) tkyview(packageBox, ...))
> > 	tkconfigure(packageBox, yscrollcommand=function(...)
> > tkset(packageScroll, ...))
> > 	for (p in packages) tkinsert(packageBox, "end", p)
> > 	datasetFrame <- tkframe(packageDatasetFrame)
> > 	datasetBox <- tklistbox(datasetFrame, height=max.height,
> > exportselection="FALSE",
> > 			selectmode="single", background="white")
> > 	datasetScroll <- ttkscrollbar(datasetFrame,
> > 			command=function(...) tkyview(datasetBox, ...))
> > 	tkconfigure(datasetBox, yscrollcommand=function(...)
> > tkset(datasetScroll, ...))
> > 	onPackageSelect <- function(){
> > 		assign("package",
> > packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
> > 		datasets <<- data(package=package)$results[,3]
> > 		valid <- sapply(datasets, is.valid.name)
> > 		datasets <<- datasets[valid]
> > 		tkdelete(datasetBox, "0", "end")
> > 		for (dataset in datasets) tkinsert(datasetBox, "end",
> > dataset)
> > 		tkconfigure(datasetBox, height=min(max.height,
> > length(datasets)))
> > 		firstChar <- tolower(substr(datasets, 1, 1))
> > 		len <- length(datasets)
> > 		onLetter <- function(letter){
> > 			letter <- tolower(letter)
> > 			current <- 1 +
> > round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
> > "))[1])*len)
> > 			mat <- match(letter, firstChar[-(1:current)])
> > 			if (is.na(mat)) return()
> > 			tkyview.scroll(datasetBox, mat, "units")
> > 		}
> > 		onA <- function() onLetter("a")
> > 		onB <- function() onLetter("b")
> > 		onC <- function() onLetter("c")
> > 		onD <- function() onLetter("d")
> > 		onE <- function() onLetter("e")
> > 		onF <- function() onLetter("f")
> > 		onG <- function() onLetter("g")
> > 		onH <- function() onLetter("h")
> > 		onI <- function() onLetter("i")
> > 		onJ <- function() onLetter("j")
> > 		onK <- function() onLetter("k")
> > 		onL <- function() onLetter("l")
> > 		onM <- function() onLetter("m")
> > 		onN <- function() onLetter("n")
> > 		onO <- function() onLetter("o")
> > 		onP <- function() onLetter("p")
> > 		onQ <- function() onLetter("q")
> > 		onR <- function() onLetter("r")
> > 		onS <- function() onLetter("s")
> > 		onT <- function() onLetter("t")
> > 		onU <- function() onLetter("u")
> > 		onV <- function() onLetter("v")
> > 		onW <- function() onLetter("w")
> > 		onX <- function() onLetter("x")
> > 		onY <- function() onLetter("y")
> > 		onZ <- function() onLetter("z")
> > 		for (letter in c(letters, LETTERS)){
> > 			tkbind(datasetBox, paste("<", letter, ">", sep=""),
> > 					get(paste("on", toupper(letter),
> > sep="")))
> > 		}
> > 		onClick <- function() tkfocus(datasetBox)
> > 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
> > 	}
> > 	onDatasetSelect <- function(){
> > 		tclvalue(dsname) <-
> > datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> > 	}
> > 	firstChar <- tolower(substr(packages, 1, 1))
> > 	len <- length(packages)
> > 	onLetter <- function(letter){
> > 		letter <- tolower(letter)
> > 		current <- 1 +
> > round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
> > "))[1])*len)
> > 		mat <- match(letter, firstChar[-(1:current)])
> > 		if (is.na(mat)) return()
> > 		tkyview.scroll(packageBox, mat, "units")
> > 	}
> > 	onA <- function() onLetter("a")
> > 	onB <- function() onLetter("b")
> > 	onC <- function() onLetter("c")
> > 	onD <- function() onLetter("d")
> > 	onE <- function() onLetter("e")
> > 	onF <- function() onLetter("f")
> > 	onG <- function() onLetter("g")
> > 	onH <- function() onLetter("h")
> > 	onI <- function() onLetter("i")
> > 	onJ <- function() onLetter("j")
> > 	onK <- function() onLetter("k")
> > 	onL <- function() onLetter("l")
> > 	onM <- function() onLetter("m")
> > 	onN <- function() onLetter("n")
> > 	onO <- function() onLetter("o")
> > 	onP <- function() onLetter("p")
> > 	onQ <- function() onLetter("q")
> > 	onR <- function() onLetter("r")
> > 	onS <- function() onLetter("s")
> > 	onT <- function() onLetter("t")
> > 	onU <- function() onLetter("u")
> > 	onV <- function() onLetter("v")
> > 	onW <- function() onLetter("w")
> > 	onX <- function() onLetter("x")
> > 	onY <- function() onLetter("y")
> > 	onZ <- function() onLetter("z")
> > 	for (letter in c(letters, LETTERS)){
> > 		tkbind(packageBox, paste("<", letter, ">", sep=""),
> > 				get(paste("on", toupper(letter), sep="")))
> > 	}
> > 	onClick <- function() tkfocus(packageBox)
> > 	tkbind(packageBox, "<ButtonPress-1>", onClick)
> > 	onOK <- function(){
> > 		datasetName <-
> > datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> > 		dsnameValue <- tclvalue(dsname)
> > 		if (dsnameValue != "" && is.null(package)){
> > 			closeDialog()
> > 			if (is.element(dsnameValue, listDataSets())) {
> > 				if ("no" ==
> > tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
> > 					if (GrabFocus()) tkgrab.release(top)
> > 					tkdestroy(top)
> > 					readDataFromPackage()
> > 					return()
> > 				}
> > 			}
> > 			save.options <- options(warn=2)
> > 			check <- try(eval(parse(text=logger(paste("data(",
> > dsnameValue, ")", sep=""))),
> > 							envir=.GlobalEnv),
> > silent=TRUE)
> > 			options(save.options)
> > 			if (class(check) == "try-error"){
> > 				errorCondition(recall=readDataFromPackage,
> >
> > message=sprintf(gettextRcmdr("Data set %s does not exit"),
> dsnameValue))
> > 				return()
> > 			}
> > 			activeDataSet(dsnameValue)
> > 			tkfocus(CommanderWindow())
> > 		}
> > 		else{
> > 			if (is.null(package)) {
> > 				errorCondition(recall=readDataFromPackage,
> > message=gettextRcmdr("You must select a package."))
> > 				return()
> > 			}
> > 			if (length(datasetName) == 0) {
> > 				errorCondition(recall=readDataFromPackage,
> > message=gettextRcmdr("You must select a data set.")    )
> > 				return()
> > 			}
> > 			if (is.element(datasetName, listDataSets())) {
> > 				if ("no" ==
> > tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
> > 					if (GrabFocus()) tkgrab.release(top)
> > 					tkdestroy(top)
> > 					readDataFromPackage()
> > 					return()
> > 				}
> > 			}
> > 			closeDialog()
> > 			command <- paste("data(", datasetName, ',
> > package="', package, '")', sep="")
> > 			result <- justDoIt(command)
> > 			logger(command)
> > 			if (class(result)[1] !=  "try-error")
> > activeDataSet(datasetName)
> > 			tkfocus(CommanderWindow())
> > 		}
> > 	}
> > 	onDataHelp <- function(){
> >    datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> > 		dsnameValue <- tclvalue(dsname)
> > 		if (dsnameValue == "") dsnameValue <- datasetName
> > 		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
> > set selected."), type="warning")
> > 		else if (is.null(package)) doItAndPrint(paste('help("',
> > dsnameValue, '")', sep=""))
> > 		else doItAndPrint(paste('help("', dsnameValue, '",
> > package="', package, '")', sep=""))
> > 	}
> > 	OKCancelHelp(helpSubject="data")
> > 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
> > selected data set"), command=onDataHelp)
> > 	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
> > (Double-click to select)"), fg=getRcmdr("title.color"),
> > font="RcmdrTitleFont"),
> > 			labelRcmdr(packageDatasetFrame, text="   "),
> > labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-
> click to
> > select)"),
> > 					fg=getRcmdr("title.color"),
> > font="RcmdrTitleFont"), sticky="w")
> > 	tkgrid(packageBox, packageScroll, sticky="nw")
> > 	tkgrid(datasetBox, datasetScroll, sticky="nw")
> > 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
> > datasetFrame, sticky="nw")
> > 	tkgrid(packageDatasetFrame, sticky="w")
> > 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
> > sticky="w")
> > 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
> > set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
> entryDsname,
> > sticky="w")
> > 	tkgrid(enterFrame, sticky="w")
> > 	tkgrid(dataHelpButton, sticky="w")
> > 	tkgrid(buttonsFrame, sticky="ew")
> > 	tkgrid.configure(packageScroll, sticky="ns")
> > 	tkgrid.configure(datasetScroll, sticky="ns")
> > 	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
> > 	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
> > 	dialogSuffix(focus=entryDsname)
> > }
> >
> > -------- snip ----------
> >
> > Any insight into the problem would be appreciated.
> >
> > Thanks,
> > John
> >
> > -----------------------------------------------
> > John Fox, Professor
> > McMaster University
> > Hamilton, Ontario, Canada
> > http://socserv.socsci.mcmaster.ca/jfox/
> >
> >
> >
> >
> > ---
> > This email has been checked for viruses by Avast antivirus software.
> > https://www.avast.com/antivirus
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> --
> Peter Dalgaard, Professor,
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> 
> 
> 
> 
> 
> 



---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From wenchel at gmail.com  Mon Jul 13 23:36:39 2015
From: wenchel at gmail.com (Seth Wenchel)
Date: Mon, 13 Jul 2015 17:36:39 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55A41595.8070500@cognigencorp.com>
References: <55A41595.8070500@cognigencorp.com>
Message-ID: <CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>

Are you exporting the functions from pkgB and pkgC? It's hard to tell from
your table below. The easiest way is to add a comment before each of the
functions in pkgB and pkgC that you want to expose to the users.

#' @export
foo <- function(){...}

Then run roxygen::roxygenise() to build the NAMESPACE file.

HTH
Seth

On Monday, July 13, 2015, sbihorel <Sebastien.Bihorel at cognigencorp.com>
wrote:

> Hi,
>
> My group has recently upgraded from a fairly old R version (2.12) to the
> R version 3.1.2. In parallel to this upgrade, I am updating our custom
> packages to add functionality and also make them compliant to the
> requirements of the new version of R. I would like to ask your help with
> respect to warning messages I get when I check and install the packages.
> I read the latest version of the manual on writing R extensions, try to
> apply the recommendations, but somehow I am not getting things right.
> Hopefully, with your suggestions, I could setup my package correctly to
> make these messages stop.
>
> I apologize but, for confidentiality purpose, I will have to partially
> anonymize the information.
>
> So here is the situation: we have 2 custom packages (let's call them
> pkgB and pkgC). The pkgB package depends on a 3rd package (let's call it
> pkgA) that is available on CRAN. The pkgC package depends on pkgB, make
> new function available,  and "overwrites" some of the functions
> distributed as part of pkgA. The following table summarizes the content
> of the DESCRIPTION and NAMESPACE files of each of these packages.
>
> package    DESCRIPTION NAMESPACE
>             Depends                       Imports
> import                         importFrom
> pkgA       methods, lattice, grid, gam   Hmisc, survival lattice, grid,
> gam, methods    Hmisc
> pkgB       pkgA pkgA
> pkgC       methods, pkgB methods, pkgB
>
> I do not get any warning when I build, check or install pkgB in our
> linux openSuse environment.
>
> After successful building pkgC, I run R CMD check on my built for pkgC
> but I get a ton of messages under the "checking R code for possible
> problems" section. These notes are related to actual calls to pkgA
> functions (or to one of the function provided by its dependencies). Here
> is a subset for illustration and hopefully information.
>
> * checking R code for possible problems: NOTE
> pkgC_function_001: no visible global function definition
> for"pkgA_function_AAA"
> pkgC_function_001: no visible global function definition
> for"pkgA_function_AAB"
> ...
> pkgC_function_010: no visible global function definition for"xyplot"
> pkgC_function_010: no visible global function definition for"panel.xyplot"
> pkgC_function_010: no visible global function definition for"panel.abline"
> pkgC_function_010: no visible global function definition for"grid.polygon"
> pkgC_function_010: no visible global function definition for"gpar"
> ...
>
> Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
> following warnings about the content of my documentation Rd files. The
> Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>
> *** installing help indices
>    converting help for package ?kiwixposedev?
>      finding HTML links ... done
> pkgC_function_001                    html
>      pkgC_function_002                    html
> ...
> Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
> link "panel.abline"
> ...
> Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
> link "pkA_function_AAC"
> ...
>
> I think I need to somehow modify the content of the DESCRIPTION and
> NAMESPACE files for pkgC... but adding various combinations of pkA and
> its dependencies gave me others errors about redundancies and multiple
> loading of the same packages. So in short, I am kind of lost with the
> new requirements of R 3.1.2 and would greatly appreciate any help or
> suggestions
>
> Thank you in advance for your time.
>
> Sebastien Bihorel
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org <javascript:;> mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Tue Jul 14 00:32:15 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 13 Jul 2015 18:32:15 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
Message-ID: <55A43C6F.6070903@gmail.com>

On 13/07/2015 5:23 PM, John Fox wrote:
> Dear Peter,
> 
>> -----Original Message-----
>> From: peter dalgaard [mailto:pdalgd at gmail.com]
>> Sent: July-13-15 4:52 PM
>> To: John Fox
>> Cc: r-package-devel at r-project.org
>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
>>
>> Yes, there was a similar note from Alexandra Kuznetsova a couple of days
> 
> Sorry, I didn't notice that.
> 
>> ago. Look unintentional, but it is not easy to spot what triggers it. If
>> someone could cook up a minimal example, or - maybe easier given the
>> relatively short timeframe - bisect their way to the exact svn revision
>> that triggered it, it might help in getting it fixed.
> 
> I'm afraid that I'm not set up to build R-devel and I'm about to leave town
> for three weeks. I'll see if I can produce a simpler example triggering the
> error, however.

Hana Sevcikova posted a simple example.  I'll bisect on it.

Here's her example:

e <- new.env()
data("mydataset", envir=e)

I've substituted USArrests for "mydataset".

Duncan Murdoch

> 
> Thanks for this,
>  John
> 
>>
>> -pd
>>
>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
>>>
>>> Dear list members,
>>>
>>> I'm getting a new note from R-devel that I haven't seen before when
>> checking
>>> the development version of the Rcmdr package:
>>>
>>> 	* checking R code for possible problems ... NOTE
>>> 	readDataFromPackage: Error while checking: invalid 'envir' argument
>>>
>>> This note doesn't appear in R 3.2.1.
>>>
>>> My session info:
>>>
>>> -------- snip ----------
>>>
>>> R Under development (unstable) (2015-07-12 r68650)
>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>
>>> locale:
>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
>>> LC_MONETARY=English_Canada.1252
>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> loaded via a namespace (and not attached):
>>> [1] tools_3.3.0
>>>
>>> -------- snip ----------
>>>
>>> I can't even localize the problem in readDataFromPackage(). There are
>> only
>>> two places in this function where there's a function call with an
>> envir
>>> argument, and I still get the note if I comment these out. As well,
>>> readDataFromPackage() seems to work as intended -- there is no obvious
>> error
>>> in it.
>>>
>>> FWIW, here's readDataFromPackage(). The complete sources for the
>> development
>>> version of the Rcmdr package are on R-Forge.
>>>
>>> -------- snip ----------
>>>
>>> readDataFromPackage <- function() {
>>> 	env <- environment()
>>> 	datasets <- NULL
>>> 	initializeDialog(title=gettextRcmdr("Read Data From Package"))
>>> 	dsname <- tclVar("")
>>> 	package <- NULL
>>> 	enterFrame <- tkframe(top)
>>> 	entryDsname <- ttkentry(enterFrame, width="20",
>> textvariable=dsname)
>>> 	packages <- sort(.packages())
>>> 	packages <- packages[! packages %in% c("base", "stats")]
>>> 	packages <- packages[sapply(packages, function(package){
>>> 						ds <-
>>> data(package=package)$results
>>> 						if (nrow(ds) == 0)
>>> return(FALSE)
>>> 						ds <- ds[, "Item"]
>>> 						valid <- sapply(ds,
>>> is.valid.name)
>>> 						length(ds[valid]) > 0
>>> 					})]
>>> 	packageDatasetFrame <- tkframe(top)
>>> 	packageFrame <- tkframe(packageDatasetFrame)
>>> 	max.height <- getRcmdr("variable.list.height")
>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
>>> length(packages)),
>>>            exportselection="FALSE",
>>> 			selectmode="single", background="white")
>>> 	packageScroll <- ttkscrollbar(packageFrame,
>>> 			command=function(...) tkyview(packageBox, ...))
>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
>>> tkset(packageScroll, ...))
>>> 	for (p in packages) tkinsert(packageBox, "end", p)
>>> 	datasetFrame <- tkframe(packageDatasetFrame)
>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
>>> exportselection="FALSE",
>>> 			selectmode="single", background="white")
>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
>>> 			command=function(...) tkyview(datasetBox, ...))
>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
>>> tkset(datasetScroll, ...))
>>> 	onPackageSelect <- function(){
>>> 		assign("package",
>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
>>> 		datasets <<- data(package=package)$results[,3]
>>> 		valid <- sapply(datasets, is.valid.name)
>>> 		datasets <<- datasets[valid]
>>> 		tkdelete(datasetBox, "0", "end")
>>> 		for (dataset in datasets) tkinsert(datasetBox, "end",
>>> dataset)
>>> 		tkconfigure(datasetBox, height=min(max.height,
>>> length(datasets)))
>>> 		firstChar <- tolower(substr(datasets, 1, 1))
>>> 		len <- length(datasets)
>>> 		onLetter <- function(letter){
>>> 			letter <- tolower(letter)
>>> 			current <- 1 +
>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
>>> "))[1])*len)
>>> 			mat <- match(letter, firstChar[-(1:current)])
>>> 			if (is.na(mat)) return()
>>> 			tkyview.scroll(datasetBox, mat, "units")
>>> 		}
>>> 		onA <- function() onLetter("a")
>>> 		onB <- function() onLetter("b")
>>> 		onC <- function() onLetter("c")
>>> 		onD <- function() onLetter("d")
>>> 		onE <- function() onLetter("e")
>>> 		onF <- function() onLetter("f")
>>> 		onG <- function() onLetter("g")
>>> 		onH <- function() onLetter("h")
>>> 		onI <- function() onLetter("i")
>>> 		onJ <- function() onLetter("j")
>>> 		onK <- function() onLetter("k")
>>> 		onL <- function() onLetter("l")
>>> 		onM <- function() onLetter("m")
>>> 		onN <- function() onLetter("n")
>>> 		onO <- function() onLetter("o")
>>> 		onP <- function() onLetter("p")
>>> 		onQ <- function() onLetter("q")
>>> 		onR <- function() onLetter("r")
>>> 		onS <- function() onLetter("s")
>>> 		onT <- function() onLetter("t")
>>> 		onU <- function() onLetter("u")
>>> 		onV <- function() onLetter("v")
>>> 		onW <- function() onLetter("w")
>>> 		onX <- function() onLetter("x")
>>> 		onY <- function() onLetter("y")
>>> 		onZ <- function() onLetter("z")
>>> 		for (letter in c(letters, LETTERS)){
>>> 			tkbind(datasetBox, paste("<", letter, ">", sep=""),
>>> 					get(paste("on", toupper(letter),
>>> sep="")))
>>> 		}
>>> 		onClick <- function() tkfocus(datasetBox)
>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
>>> 	}
>>> 	onDatasetSelect <- function(){
>>> 		tclvalue(dsname) <-
>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>> 	}
>>> 	firstChar <- tolower(substr(packages, 1, 1))
>>> 	len <- length(packages)
>>> 	onLetter <- function(letter){
>>> 		letter <- tolower(letter)
>>> 		current <- 1 +
>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
>>> "))[1])*len)
>>> 		mat <- match(letter, firstChar[-(1:current)])
>>> 		if (is.na(mat)) return()
>>> 		tkyview.scroll(packageBox, mat, "units")
>>> 	}
>>> 	onA <- function() onLetter("a")
>>> 	onB <- function() onLetter("b")
>>> 	onC <- function() onLetter("c")
>>> 	onD <- function() onLetter("d")
>>> 	onE <- function() onLetter("e")
>>> 	onF <- function() onLetter("f")
>>> 	onG <- function() onLetter("g")
>>> 	onH <- function() onLetter("h")
>>> 	onI <- function() onLetter("i")
>>> 	onJ <- function() onLetter("j")
>>> 	onK <- function() onLetter("k")
>>> 	onL <- function() onLetter("l")
>>> 	onM <- function() onLetter("m")
>>> 	onN <- function() onLetter("n")
>>> 	onO <- function() onLetter("o")
>>> 	onP <- function() onLetter("p")
>>> 	onQ <- function() onLetter("q")
>>> 	onR <- function() onLetter("r")
>>> 	onS <- function() onLetter("s")
>>> 	onT <- function() onLetter("t")
>>> 	onU <- function() onLetter("u")
>>> 	onV <- function() onLetter("v")
>>> 	onW <- function() onLetter("w")
>>> 	onX <- function() onLetter("x")
>>> 	onY <- function() onLetter("y")
>>> 	onZ <- function() onLetter("z")
>>> 	for (letter in c(letters, LETTERS)){
>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
>>> 				get(paste("on", toupper(letter), sep="")))
>>> 	}
>>> 	onClick <- function() tkfocus(packageBox)
>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
>>> 	onOK <- function(){
>>> 		datasetName <-
>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>> 		dsnameValue <- tclvalue(dsname)
>>> 		if (dsnameValue != "" && is.null(package)){
>>> 			closeDialog()
>>> 			if (is.element(dsnameValue, listDataSets())) {
>>> 				if ("no" ==
>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
>>> 					if (GrabFocus()) tkgrab.release(top)
>>> 					tkdestroy(top)
>>> 					readDataFromPackage()
>>> 					return()
>>> 				}
>>> 			}
>>> 			save.options <- options(warn=2)
>>> 			check <- try(eval(parse(text=logger(paste("data(",
>>> dsnameValue, ")", sep=""))),
>>> 							envir=.GlobalEnv),
>>> silent=TRUE)
>>> 			options(save.options)
>>> 			if (class(check) == "try-error"){
>>> 				errorCondition(recall=readDataFromPackage,
>>>
>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
>> dsnameValue))
>>> 				return()
>>> 			}
>>> 			activeDataSet(dsnameValue)
>>> 			tkfocus(CommanderWindow())
>>> 		}
>>> 		else{
>>> 			if (is.null(package)) {
>>> 				errorCondition(recall=readDataFromPackage,
>>> message=gettextRcmdr("You must select a package."))
>>> 				return()
>>> 			}
>>> 			if (length(datasetName) == 0) {
>>> 				errorCondition(recall=readDataFromPackage,
>>> message=gettextRcmdr("You must select a data set.")    )
>>> 				return()
>>> 			}
>>> 			if (is.element(datasetName, listDataSets())) {
>>> 				if ("no" ==
>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
>>> 					if (GrabFocus()) tkgrab.release(top)
>>> 					tkdestroy(top)
>>> 					readDataFromPackage()
>>> 					return()
>>> 				}
>>> 			}
>>> 			closeDialog()
>>> 			command <- paste("data(", datasetName, ',
>>> package="', package, '")', sep="")
>>> 			result <- justDoIt(command)
>>> 			logger(command)
>>> 			if (class(result)[1] !=  "try-error")
>>> activeDataSet(datasetName)
>>> 			tkfocus(CommanderWindow())
>>> 		}
>>> 	}
>>> 	onDataHelp <- function(){
>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>> 		dsnameValue <- tclvalue(dsname)
>>> 		if (dsnameValue == "") dsnameValue <- datasetName
>>> 		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
>>> set selected."), type="warning")
>>> 		else if (is.null(package)) doItAndPrint(paste('help("',
>>> dsnameValue, '")', sep=""))
>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
>>> package="', package, '")', sep=""))
>>> 	}
>>> 	OKCancelHelp(helpSubject="data")
>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
>>> selected data set"), command=onDataHelp)
>>> 	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
>>> (Double-click to select)"), fg=getRcmdr("title.color"),
>>> font="RcmdrTitleFont"),
>>> 			labelRcmdr(packageDatasetFrame, text="   "),
>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-
>> click to
>>> select)"),
>>> 					fg=getRcmdr("title.color"),
>>> font="RcmdrTitleFont"), sticky="w")
>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
>>> datasetFrame, sticky="nw")
>>> 	tkgrid(packageDatasetFrame, sticky="w")
>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
>>> sticky="w")
>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
>> entryDsname,
>>> sticky="w")
>>> 	tkgrid(enterFrame, sticky="w")
>>> 	tkgrid(dataHelpButton, sticky="w")
>>> 	tkgrid(buttonsFrame, sticky="ew")
>>> 	tkgrid.configure(packageScroll, sticky="ns")
>>> 	tkgrid.configure(datasetScroll, sticky="ns")
>>> 	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
>>> 	dialogSuffix(focus=entryDsname)
>>> }
>>>
>>> -------- snip ----------
>>>
>>> Any insight into the problem would be appreciated.
>>>
>>> Thanks,
>>> John
>>>
>>> -----------------------------------------------
>>> John Fox, Professor
>>> McMaster University
>>> Hamilton, Ontario, Canada
>>> http://socserv.socsci.mcmaster.ca/jfox/
>>>
>>>
>>>
>>>
>>> ---
>>> This email has been checked for viruses by Avast antivirus software.
>>> https://www.avast.com/antivirus
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> --
>> Peter Dalgaard, Professor,
>> Center for Statistics, Copenhagen Business School
>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>> Phone: (+45)38153501
>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>
>>
>>
>>
>>
>>
> 
> 
> 
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From murdoch.duncan at gmail.com  Tue Jul 14 00:38:43 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 13 Jul 2015 18:38:43 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
Message-ID: <55A43DF3.4040509@gmail.com>

On 13/07/2015 5:36 PM, Seth Wenchel wrote:
> Are you exporting the functions from pkgB and pkgC? It's hard to tell from
> your table below. The easiest way is to add a comment before each of the
> functions in pkgB and pkgC that you want to expose to the users.
> 
> #' @export
> foo <- function(){...}
> 
> Then run roxygen::roxygenise() to build the NAMESPACE file.

That's very dangerous advice.  roxygen stomps on all kinds of things
besides the things you want it to touch.

Duncan Murdoch
> 
> HTH
> Seth
> 
> On Monday, July 13, 2015, sbihorel <Sebastien.Bihorel at cognigencorp.com>
> wrote:
> 
>> Hi,
>>
>> My group has recently upgraded from a fairly old R version (2.12) to the
>> R version 3.1.2. In parallel to this upgrade, I am updating our custom
>> packages to add functionality and also make them compliant to the
>> requirements of the new version of R. I would like to ask your help with
>> respect to warning messages I get when I check and install the packages.
>> I read the latest version of the manual on writing R extensions, try to
>> apply the recommendations, but somehow I am not getting things right.
>> Hopefully, with your suggestions, I could setup my package correctly to
>> make these messages stop.
>>
>> I apologize but, for confidentiality purpose, I will have to partially
>> anonymize the information.
>>
>> So here is the situation: we have 2 custom packages (let's call them
>> pkgB and pkgC). The pkgB package depends on a 3rd package (let's call it
>> pkgA) that is available on CRAN. The pkgC package depends on pkgB, make
>> new function available,  and "overwrites" some of the functions
>> distributed as part of pkgA. The following table summarizes the content
>> of the DESCRIPTION and NAMESPACE files of each of these packages.
>>
>> package    DESCRIPTION NAMESPACE
>>             Depends                       Imports
>> import                         importFrom
>> pkgA       methods, lattice, grid, gam   Hmisc, survival lattice, grid,
>> gam, methods    Hmisc
>> pkgB       pkgA pkgA
>> pkgC       methods, pkgB methods, pkgB
>>
>> I do not get any warning when I build, check or install pkgB in our
>> linux openSuse environment.
>>
>> After successful building pkgC, I run R CMD check on my built for pkgC
>> but I get a ton of messages under the "checking R code for possible
>> problems" section. These notes are related to actual calls to pkgA
>> functions (or to one of the function provided by its dependencies). Here
>> is a subset for illustration and hopefully information.
>>
>> * checking R code for possible problems: NOTE
>> pkgC_function_001: no visible global function definition
>> for"pkgA_function_AAA"
>> pkgC_function_001: no visible global function definition
>> for"pkgA_function_AAB"
>> ...
>> pkgC_function_010: no visible global function definition for"xyplot"
>> pkgC_function_010: no visible global function definition for"panel.xyplot"
>> pkgC_function_010: no visible global function definition for"panel.abline"
>> pkgC_function_010: no visible global function definition for"grid.polygon"
>> pkgC_function_010: no visible global function definition for"gpar"
>> ...
>>
>> Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>> following warnings about the content of my documentation Rd files. The
>> Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>
>> *** installing help indices
>>    converting help for package ?kiwixposedev?
>>      finding HTML links ... done
>> pkgC_function_001                    html
>>      pkgC_function_002                    html
>> ...
>> Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>> link "panel.abline"
>> ...
>> Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>> link "pkA_function_AAC"
>> ...
>>
>> I think I need to somehow modify the content of the DESCRIPTION and
>> NAMESPACE files for pkgC... but adding various combinations of pkA and
>> its dependencies gave me others errors about redundancies and multiple
>> loading of the same packages. So in short, I am kind of lost with the
>> new requirements of R 3.1.2 and would greatly appreciate any help or
>> suggestions
>>
>> Thank you in advance for your time.
>>
>> Sebastien Bihorel
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org <javascript:;> mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From jfox at mcmaster.ca  Tue Jul 14 00:47:28 2015
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 13 Jul 2015 18:47:28 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <55A43C6F.6070903@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
Message-ID: <004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>

Dear Duncan and Peter,

I've just arrived at more or less the same thing:

	foo <- function() data(package="MASS")

	bar <- function() data(package="MASS", envir=.GlobalEnv)

	baz <- function() data(package="MASS", envir=globalenv())

all trigger the note when included with the Rcmdr sources:

	* checking R code for possible problems ... NOTE
	bar: Error while checking: invalid 'envir' argument
	baz: Error while checking: invalid 'envir' argument
	foo: Error while checking: invalid 'envir' argument 

The envir argument to data() defaults to .GlobaEnv .

I hope this helps,
 John

> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: July-13-15 6:32 PM
> To: John Fox; 'peter dalgaard'
> Cc: r-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
> 
> On 13/07/2015 5:23 PM, John Fox wrote:
> > Dear Peter,
> >
> >> -----Original Message-----
> >> From: peter dalgaard [mailto:pdalgd at gmail.com]
> >> Sent: July-13-15 4:52 PM
> >> To: John Fox
> >> Cc: r-package-devel at r-project.org
> >> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> devel
> >>
> >> Yes, there was a similar note from Alexandra Kuznetsova a couple of
> days
> >
> > Sorry, I didn't notice that.
> >
> >> ago. Look unintentional, but it is not easy to spot what triggers it.
> If
> >> someone could cook up a minimal example, or - maybe easier given the
> >> relatively short timeframe - bisect their way to the exact svn
> revision
> >> that triggered it, it might help in getting it fixed.
> >
> > I'm afraid that I'm not set up to build R-devel and I'm about to leave
> town
> > for three weeks. I'll see if I can produce a simpler example
> triggering the
> > error, however.
> 
> Hana Sevcikova posted a simple example.  I'll bisect on it.
> 
> Here's her example:
> 
> e <- new.env()
> data("mydataset", envir=e)
> 
> I've substituted USArrests for "mydataset".
> 
> Duncan Murdoch
> 
> >
> > Thanks for this,
> >  John
> >
> >>
> >> -pd
> >>
> >>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
> >>>
> >>> Dear list members,
> >>>
> >>> I'm getting a new note from R-devel that I haven't seen before when
> >> checking
> >>> the development version of the Rcmdr package:
> >>>
> >>> 	* checking R code for possible problems ... NOTE
> >>> 	readDataFromPackage: Error while checking: invalid 'envir' argument
> >>>
> >>> This note doesn't appear in R 3.2.1.
> >>>
> >>> My session info:
> >>>
> >>> -------- snip ----------
> >>>
> >>> R Under development (unstable) (2015-07-12 r68650)
> >>> Platform: x86_64-w64-mingw32/x64 (64-bit)
> >>> Running under: Windows 7 x64 (build 7601) Service Pack 1
> >>>
> >>> locale:
> >>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> >>> LC_MONETARY=English_Canada.1252
> >>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
> >>>
> >>> attached base packages:
> >>> [1] stats     graphics  grDevices utils     datasets  methods   base
> >>>
> >>> loaded via a namespace (and not attached):
> >>> [1] tools_3.3.0
> >>>
> >>> -------- snip ----------
> >>>
> >>> I can't even localize the problem in readDataFromPackage(). There
> are
> >> only
> >>> two places in this function where there's a function call with an
> >> envir
> >>> argument, and I still get the note if I comment these out. As well,
> >>> readDataFromPackage() seems to work as intended -- there is no
> obvious
> >> error
> >>> in it.
> >>>
> >>> FWIW, here's readDataFromPackage(). The complete sources for the
> >> development
> >>> version of the Rcmdr package are on R-Forge.
> >>>
> >>> -------- snip ----------
> >>>
> >>> readDataFromPackage <- function() {
> >>> 	env <- environment()
> >>> 	datasets <- NULL
> >>> 	initializeDialog(title=gettextRcmdr("Read Data From Package"))
> >>> 	dsname <- tclVar("")
> >>> 	package <- NULL
> >>> 	enterFrame <- tkframe(top)
> >>> 	entryDsname <- ttkentry(enterFrame, width="20",
> >> textvariable=dsname)
> >>> 	packages <- sort(.packages())
> >>> 	packages <- packages[! packages %in% c("base", "stats")]
> >>> 	packages <- packages[sapply(packages, function(package){
> >>> 						ds <-
> >>> data(package=package)$results
> >>> 						if (nrow(ds) == 0)
> >>> return(FALSE)
> >>> 						ds <- ds[, "Item"]
> >>> 						valid <- sapply(ds,
> >>> is.valid.name)
> >>> 						length(ds[valid]) > 0
> >>> 					})]
> >>> 	packageDatasetFrame <- tkframe(top)
> >>> 	packageFrame <- tkframe(packageDatasetFrame)
> >>> 	max.height <- getRcmdr("variable.list.height")
> >>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
> >>> length(packages)),
> >>>            exportselection="FALSE",
> >>> 			selectmode="single", background="white")
> >>> 	packageScroll <- ttkscrollbar(packageFrame,
> >>> 			command=function(...) tkyview(packageBox, ...))
> >>> 	tkconfigure(packageBox, yscrollcommand=function(...)
> >>> tkset(packageScroll, ...))
> >>> 	for (p in packages) tkinsert(packageBox, "end", p)
> >>> 	datasetFrame <- tkframe(packageDatasetFrame)
> >>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
> >>> exportselection="FALSE",
> >>> 			selectmode="single", background="white")
> >>> 	datasetScroll <- ttkscrollbar(datasetFrame,
> >>> 			command=function(...) tkyview(datasetBox, ...))
> >>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
> >>> tkset(datasetScroll, ...))
> >>> 	onPackageSelect <- function(){
> >>> 		assign("package",
> >>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
> >>> 		datasets <<- data(package=package)$results[,3]
> >>> 		valid <- sapply(datasets, is.valid.name)
> >>> 		datasets <<- datasets[valid]
> >>> 		tkdelete(datasetBox, "0", "end")
> >>> 		for (dataset in datasets) tkinsert(datasetBox, "end",
> >>> dataset)
> >>> 		tkconfigure(datasetBox, height=min(max.height,
> >>> length(datasets)))
> >>> 		firstChar <- tolower(substr(datasets, 1, 1))
> >>> 		len <- length(datasets)
> >>> 		onLetter <- function(letter){
> >>> 			letter <- tolower(letter)
> >>> 			current <- 1 +
> >>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
> >>> "))[1])*len)
> >>> 			mat <- match(letter, firstChar[-(1:current)])
> >>> 			if (is.na(mat)) return()
> >>> 			tkyview.scroll(datasetBox, mat, "units")
> >>> 		}
> >>> 		onA <- function() onLetter("a")
> >>> 		onB <- function() onLetter("b")
> >>> 		onC <- function() onLetter("c")
> >>> 		onD <- function() onLetter("d")
> >>> 		onE <- function() onLetter("e")
> >>> 		onF <- function() onLetter("f")
> >>> 		onG <- function() onLetter("g")
> >>> 		onH <- function() onLetter("h")
> >>> 		onI <- function() onLetter("i")
> >>> 		onJ <- function() onLetter("j")
> >>> 		onK <- function() onLetter("k")
> >>> 		onL <- function() onLetter("l")
> >>> 		onM <- function() onLetter("m")
> >>> 		onN <- function() onLetter("n")
> >>> 		onO <- function() onLetter("o")
> >>> 		onP <- function() onLetter("p")
> >>> 		onQ <- function() onLetter("q")
> >>> 		onR <- function() onLetter("r")
> >>> 		onS <- function() onLetter("s")
> >>> 		onT <- function() onLetter("t")
> >>> 		onU <- function() onLetter("u")
> >>> 		onV <- function() onLetter("v")
> >>> 		onW <- function() onLetter("w")
> >>> 		onX <- function() onLetter("x")
> >>> 		onY <- function() onLetter("y")
> >>> 		onZ <- function() onLetter("z")
> >>> 		for (letter in c(letters, LETTERS)){
> >>> 			tkbind(datasetBox, paste("<", letter, ">", sep=""),
> >>> 					get(paste("on", toupper(letter),
> >>> sep="")))
> >>> 		}
> >>> 		onClick <- function() tkfocus(datasetBox)
> >>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
> >>> 	}
> >>> 	onDatasetSelect <- function(){
> >>> 		tclvalue(dsname) <-
> >>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>> 	}
> >>> 	firstChar <- tolower(substr(packages, 1, 1))
> >>> 	len <- length(packages)
> >>> 	onLetter <- function(letter){
> >>> 		letter <- tolower(letter)
> >>> 		current <- 1 +
> >>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
> >>> "))[1])*len)
> >>> 		mat <- match(letter, firstChar[-(1:current)])
> >>> 		if (is.na(mat)) return()
> >>> 		tkyview.scroll(packageBox, mat, "units")
> >>> 	}
> >>> 	onA <- function() onLetter("a")
> >>> 	onB <- function() onLetter("b")
> >>> 	onC <- function() onLetter("c")
> >>> 	onD <- function() onLetter("d")
> >>> 	onE <- function() onLetter("e")
> >>> 	onF <- function() onLetter("f")
> >>> 	onG <- function() onLetter("g")
> >>> 	onH <- function() onLetter("h")
> >>> 	onI <- function() onLetter("i")
> >>> 	onJ <- function() onLetter("j")
> >>> 	onK <- function() onLetter("k")
> >>> 	onL <- function() onLetter("l")
> >>> 	onM <- function() onLetter("m")
> >>> 	onN <- function() onLetter("n")
> >>> 	onO <- function() onLetter("o")
> >>> 	onP <- function() onLetter("p")
> >>> 	onQ <- function() onLetter("q")
> >>> 	onR <- function() onLetter("r")
> >>> 	onS <- function() onLetter("s")
> >>> 	onT <- function() onLetter("t")
> >>> 	onU <- function() onLetter("u")
> >>> 	onV <- function() onLetter("v")
> >>> 	onW <- function() onLetter("w")
> >>> 	onX <- function() onLetter("x")
> >>> 	onY <- function() onLetter("y")
> >>> 	onZ <- function() onLetter("z")
> >>> 	for (letter in c(letters, LETTERS)){
> >>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
> >>> 				get(paste("on", toupper(letter), sep="")))
> >>> 	}
> >>> 	onClick <- function() tkfocus(packageBox)
> >>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
> >>> 	onOK <- function(){
> >>> 		datasetName <-
> >>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>> 		dsnameValue <- tclvalue(dsname)
> >>> 		if (dsnameValue != "" && is.null(package)){
> >>> 			closeDialog()
> >>> 			if (is.element(dsnameValue, listDataSets())) {
> >>> 				if ("no" ==
> >>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
> >>> 					if (GrabFocus()) tkgrab.release(top)
> >>> 					tkdestroy(top)
> >>> 					readDataFromPackage()
> >>> 					return()
> >>> 				}
> >>> 			}
> >>> 			save.options <- options(warn=2)
> >>> 			check <- try(eval(parse(text=logger(paste("data(",
> >>> dsnameValue, ")", sep=""))),
> >>> 							envir=.GlobalEnv),
> >>> silent=TRUE)
> >>> 			options(save.options)
> >>> 			if (class(check) == "try-error"){
> >>> 				errorCondition(recall=readDataFromPackage,
> >>>
> >>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
> >> dsnameValue))
> >>> 				return()
> >>> 			}
> >>> 			activeDataSet(dsnameValue)
> >>> 			tkfocus(CommanderWindow())
> >>> 		}
> >>> 		else{
> >>> 			if (is.null(package)) {
> >>> 				errorCondition(recall=readDataFromPackage,
> >>> message=gettextRcmdr("You must select a package."))
> >>> 				return()
> >>> 			}
> >>> 			if (length(datasetName) == 0) {
> >>> 				errorCondition(recall=readDataFromPackage,
> >>> message=gettextRcmdr("You must select a data set.")    )
> >>> 				return()
> >>> 			}
> >>> 			if (is.element(datasetName, listDataSets())) {
> >>> 				if ("no" ==
> >>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
> >>> 					if (GrabFocus()) tkgrab.release(top)
> >>> 					tkdestroy(top)
> >>> 					readDataFromPackage()
> >>> 					return()
> >>> 				}
> >>> 			}
> >>> 			closeDialog()
> >>> 			command <- paste("data(", datasetName, ',
> >>> package="', package, '")', sep="")
> >>> 			result <- justDoIt(command)
> >>> 			logger(command)
> >>> 			if (class(result)[1] !=  "try-error")
> >>> activeDataSet(datasetName)
> >>> 			tkfocus(CommanderWindow())
> >>> 		}
> >>> 	}
> >>> 	onDataHelp <- function(){
> >>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) +
> 1]
> >>> 		dsnameValue <- tclvalue(dsname)
> >>> 		if (dsnameValue == "") dsnameValue <- datasetName
> >>> 		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
> >>> set selected."), type="warning")
> >>> 		else if (is.null(package)) doItAndPrint(paste('help("',
> >>> dsnameValue, '")', sep=""))
> >>> 		else doItAndPrint(paste('help("', dsnameValue, '",
> >>> package="', package, '")', sep=""))
> >>> 	}
> >>> 	OKCancelHelp(helpSubject="data")
> >>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
> >>> selected data set"), command=onDataHelp)
> >>> 	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
> >>> (Double-click to select)"), fg=getRcmdr("title.color"),
> >>> font="RcmdrTitleFont"),
> >>> 			labelRcmdr(packageDatasetFrame, text="   "),
> >>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-
> >> click to
> >>> select)"),
> >>> 					fg=getRcmdr("title.color"),
> >>> font="RcmdrTitleFont"), sticky="w")
> >>> 	tkgrid(packageBox, packageScroll, sticky="nw")
> >>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
> >>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
> >>> datasetFrame, sticky="nw")
> >>> 	tkgrid(packageDatasetFrame, sticky="w")
> >>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
> >>> sticky="w")
> >>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
> >>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
> >> entryDsname,
> >>> sticky="w")
> >>> 	tkgrid(enterFrame, sticky="w")
> >>> 	tkgrid(dataHelpButton, sticky="w")
> >>> 	tkgrid(buttonsFrame, sticky="ew")
> >>> 	tkgrid.configure(packageScroll, sticky="ns")
> >>> 	tkgrid.configure(datasetScroll, sticky="ns")
> >>> 	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
> >>> 	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
> >>> 	dialogSuffix(focus=entryDsname)
> >>> }
> >>>
> >>> -------- snip ----------
> >>>
> >>> Any insight into the problem would be appreciated.
> >>>
> >>> Thanks,
> >>> John
> >>>
> >>> -----------------------------------------------
> >>> John Fox, Professor
> >>> McMaster University
> >>> Hamilton, Ontario, Canada
> >>> http://socserv.socsci.mcmaster.ca/jfox/
> >>>
> >>>
> >>>
> >>>
> >>> ---
> >>> This email has been checked for viruses by Avast antivirus software.
> >>> https://www.avast.com/antivirus
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>
> >> --
> >> Peter Dalgaard, Professor,
> >> Center for Statistics, Copenhagen Business School
> >> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> >> Phone: (+45)38153501
> >> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> >>
> >>
> >>
> >>
> >>
> >>
> >
> >
> >
> > ---
> > This email has been checked for viruses by Avast antivirus software.
> > https://www.avast.com/antivirus
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From murdoch.duncan at gmail.com  Tue Jul 14 01:01:06 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 13 Jul 2015 19:01:06 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
Message-ID: <55A44332.4070900@gmail.com>

It happened in r68597.  In my example, I hadn't imported the data()
function from utils; when I did that, it was fixed.

Not sure why the error is complaining about the envir argument.

Duncan Murdoch

On 13/07/2015 6:47 PM, John Fox wrote:
> Dear Duncan and Peter,
> 
> I've just arrived at more or less the same thing:
> 
> 	foo <- function() data(package="MASS")
> 
> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
> 
> 	baz <- function() data(package="MASS", envir=globalenv())
> 
> all trigger the note when included with the Rcmdr sources:
> 
> 	* checking R code for possible problems ... NOTE
> 	bar: Error while checking: invalid 'envir' argument
> 	baz: Error while checking: invalid 'envir' argument
> 	foo: Error while checking: invalid 'envir' argument 
> 
> The envir argument to data() defaults to .GlobaEnv .
> 
> I hope this helps,
>  John
> 
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> Sent: July-13-15 6:32 PM
>> To: John Fox; 'peter dalgaard'
>> Cc: r-package-devel at r-project.org
>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
>>
>> On 13/07/2015 5:23 PM, John Fox wrote:
>>> Dear Peter,
>>>
>>>> -----Original Message-----
>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
>>>> Sent: July-13-15 4:52 PM
>>>> To: John Fox
>>>> Cc: r-package-devel at r-project.org
>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
>> devel
>>>>
>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
>> days
>>>
>>> Sorry, I didn't notice that.
>>>
>>>> ago. Look unintentional, but it is not easy to spot what triggers it.
>> If
>>>> someone could cook up a minimal example, or - maybe easier given the
>>>> relatively short timeframe - bisect their way to the exact svn
>> revision
>>>> that triggered it, it might help in getting it fixed.
>>>
>>> I'm afraid that I'm not set up to build R-devel and I'm about to leave
>> town
>>> for three weeks. I'll see if I can produce a simpler example
>> triggering the
>>> error, however.
>>
>> Hana Sevcikova posted a simple example.  I'll bisect on it.
>>
>> Here's her example:
>>
>> e <- new.env()
>> data("mydataset", envir=e)
>>
>> I've substituted USArrests for "mydataset".
>>
>> Duncan Murdoch
>>
>>>
>>> Thanks for this,
>>>  John
>>>
>>>>
>>>> -pd
>>>>
>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
>>>>>
>>>>> Dear list members,
>>>>>
>>>>> I'm getting a new note from R-devel that I haven't seen before when
>>>> checking
>>>>> the development version of the Rcmdr package:
>>>>>
>>>>> 	* checking R code for possible problems ... NOTE
>>>>> 	readDataFromPackage: Error while checking: invalid 'envir' argument
>>>>>
>>>>> This note doesn't appear in R 3.2.1.
>>>>>
>>>>> My session info:
>>>>>
>>>>> -------- snip ----------
>>>>>
>>>>> R Under development (unstable) (2015-07-12 r68650)
>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>
>>>>> locale:
>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
>>>>> LC_MONETARY=English_Canada.1252
>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
>>>>>
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>
>>>>> loaded via a namespace (and not attached):
>>>>> [1] tools_3.3.0
>>>>>
>>>>> -------- snip ----------
>>>>>
>>>>> I can't even localize the problem in readDataFromPackage(). There
>> are
>>>> only
>>>>> two places in this function where there's a function call with an
>>>> envir
>>>>> argument, and I still get the note if I comment these out. As well,
>>>>> readDataFromPackage() seems to work as intended -- there is no
>> obvious
>>>> error
>>>>> in it.
>>>>>
>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
>>>> development
>>>>> version of the Rcmdr package are on R-Forge.
>>>>>
>>>>> -------- snip ----------
>>>>>
>>>>> readDataFromPackage <- function() {
>>>>> 	env <- environment()
>>>>> 	datasets <- NULL
>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From Package"))
>>>>> 	dsname <- tclVar("")
>>>>> 	package <- NULL
>>>>> 	enterFrame <- tkframe(top)
>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
>>>> textvariable=dsname)
>>>>> 	packages <- sort(.packages())
>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
>>>>> 	packages <- packages[sapply(packages, function(package){
>>>>> 						ds <-
>>>>> data(package=package)$results
>>>>> 						if (nrow(ds) == 0)
>>>>> return(FALSE)
>>>>> 						ds <- ds[, "Item"]
>>>>> 						valid <- sapply(ds,
>>>>> is.valid.name)
>>>>> 						length(ds[valid]) > 0
>>>>> 					})]
>>>>> 	packageDatasetFrame <- tkframe(top)
>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
>>>>> 	max.height <- getRcmdr("variable.list.height")
>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
>>>>> length(packages)),
>>>>>            exportselection="FALSE",
>>>>> 			selectmode="single", background="white")
>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
>>>>> 			command=function(...) tkyview(packageBox, ...))
>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
>>>>> tkset(packageScroll, ...))
>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
>>>>> exportselection="FALSE",
>>>>> 			selectmode="single", background="white")
>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
>>>>> 			command=function(...) tkyview(datasetBox, ...))
>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
>>>>> tkset(datasetScroll, ...))
>>>>> 	onPackageSelect <- function(){
>>>>> 		assign("package",
>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
>>>>> 		datasets <<- data(package=package)$results[,3]
>>>>> 		valid <- sapply(datasets, is.valid.name)
>>>>> 		datasets <<- datasets[valid]
>>>>> 		tkdelete(datasetBox, "0", "end")
>>>>> 		for (dataset in datasets) tkinsert(datasetBox, "end",
>>>>> dataset)
>>>>> 		tkconfigure(datasetBox, height=min(max.height,
>>>>> length(datasets)))
>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
>>>>> 		len <- length(datasets)
>>>>> 		onLetter <- function(letter){
>>>>> 			letter <- tolower(letter)
>>>>> 			current <- 1 +
>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
>>>>> "))[1])*len)
>>>>> 			mat <- match(letter, firstChar[-(1:current)])
>>>>> 			if (is.na(mat)) return()
>>>>> 			tkyview.scroll(datasetBox, mat, "units")
>>>>> 		}
>>>>> 		onA <- function() onLetter("a")
>>>>> 		onB <- function() onLetter("b")
>>>>> 		onC <- function() onLetter("c")
>>>>> 		onD <- function() onLetter("d")
>>>>> 		onE <- function() onLetter("e")
>>>>> 		onF <- function() onLetter("f")
>>>>> 		onG <- function() onLetter("g")
>>>>> 		onH <- function() onLetter("h")
>>>>> 		onI <- function() onLetter("i")
>>>>> 		onJ <- function() onLetter("j")
>>>>> 		onK <- function() onLetter("k")
>>>>> 		onL <- function() onLetter("l")
>>>>> 		onM <- function() onLetter("m")
>>>>> 		onN <- function() onLetter("n")
>>>>> 		onO <- function() onLetter("o")
>>>>> 		onP <- function() onLetter("p")
>>>>> 		onQ <- function() onLetter("q")
>>>>> 		onR <- function() onLetter("r")
>>>>> 		onS <- function() onLetter("s")
>>>>> 		onT <- function() onLetter("t")
>>>>> 		onU <- function() onLetter("u")
>>>>> 		onV <- function() onLetter("v")
>>>>> 		onW <- function() onLetter("w")
>>>>> 		onX <- function() onLetter("x")
>>>>> 		onY <- function() onLetter("y")
>>>>> 		onZ <- function() onLetter("z")
>>>>> 		for (letter in c(letters, LETTERS)){
>>>>> 			tkbind(datasetBox, paste("<", letter, ">", sep=""),
>>>>> 					get(paste("on", toupper(letter),
>>>>> sep="")))
>>>>> 		}
>>>>> 		onClick <- function() tkfocus(datasetBox)
>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
>>>>> 	}
>>>>> 	onDatasetSelect <- function(){
>>>>> 		tclvalue(dsname) <-
>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>> 	}
>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
>>>>> 	len <- length(packages)
>>>>> 	onLetter <- function(letter){
>>>>> 		letter <- tolower(letter)
>>>>> 		current <- 1 +
>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
>>>>> "))[1])*len)
>>>>> 		mat <- match(letter, firstChar[-(1:current)])
>>>>> 		if (is.na(mat)) return()
>>>>> 		tkyview.scroll(packageBox, mat, "units")
>>>>> 	}
>>>>> 	onA <- function() onLetter("a")
>>>>> 	onB <- function() onLetter("b")
>>>>> 	onC <- function() onLetter("c")
>>>>> 	onD <- function() onLetter("d")
>>>>> 	onE <- function() onLetter("e")
>>>>> 	onF <- function() onLetter("f")
>>>>> 	onG <- function() onLetter("g")
>>>>> 	onH <- function() onLetter("h")
>>>>> 	onI <- function() onLetter("i")
>>>>> 	onJ <- function() onLetter("j")
>>>>> 	onK <- function() onLetter("k")
>>>>> 	onL <- function() onLetter("l")
>>>>> 	onM <- function() onLetter("m")
>>>>> 	onN <- function() onLetter("n")
>>>>> 	onO <- function() onLetter("o")
>>>>> 	onP <- function() onLetter("p")
>>>>> 	onQ <- function() onLetter("q")
>>>>> 	onR <- function() onLetter("r")
>>>>> 	onS <- function() onLetter("s")
>>>>> 	onT <- function() onLetter("t")
>>>>> 	onU <- function() onLetter("u")
>>>>> 	onV <- function() onLetter("v")
>>>>> 	onW <- function() onLetter("w")
>>>>> 	onX <- function() onLetter("x")
>>>>> 	onY <- function() onLetter("y")
>>>>> 	onZ <- function() onLetter("z")
>>>>> 	for (letter in c(letters, LETTERS)){
>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
>>>>> 				get(paste("on", toupper(letter), sep="")))
>>>>> 	}
>>>>> 	onClick <- function() tkfocus(packageBox)
>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
>>>>> 	onOK <- function(){
>>>>> 		datasetName <-
>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>> 		if (dsnameValue != "" && is.null(package)){
>>>>> 			closeDialog()
>>>>> 			if (is.element(dsnameValue, listDataSets())) {
>>>>> 				if ("no" ==
>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
>>>>> 					if (GrabFocus()) tkgrab.release(top)
>>>>> 					tkdestroy(top)
>>>>> 					readDataFromPackage()
>>>>> 					return()
>>>>> 				}
>>>>> 			}
>>>>> 			save.options <- options(warn=2)
>>>>> 			check <- try(eval(parse(text=logger(paste("data(",
>>>>> dsnameValue, ")", sep=""))),
>>>>> 							envir=.GlobalEnv),
>>>>> silent=TRUE)
>>>>> 			options(save.options)
>>>>> 			if (class(check) == "try-error"){
>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>>
>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
>>>> dsnameValue))
>>>>> 				return()
>>>>> 			}
>>>>> 			activeDataSet(dsnameValue)
>>>>> 			tkfocus(CommanderWindow())
>>>>> 		}
>>>>> 		else{
>>>>> 			if (is.null(package)) {
>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>> message=gettextRcmdr("You must select a package."))
>>>>> 				return()
>>>>> 			}
>>>>> 			if (length(datasetName) == 0) {
>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>> message=gettextRcmdr("You must select a data set.")    )
>>>>> 				return()
>>>>> 			}
>>>>> 			if (is.element(datasetName, listDataSets())) {
>>>>> 				if ("no" ==
>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
>>>>> 					if (GrabFocus()) tkgrab.release(top)
>>>>> 					tkdestroy(top)
>>>>> 					readDataFromPackage()
>>>>> 					return()
>>>>> 				}
>>>>> 			}
>>>>> 			closeDialog()
>>>>> 			command <- paste("data(", datasetName, ',
>>>>> package="', package, '")', sep="")
>>>>> 			result <- justDoIt(command)
>>>>> 			logger(command)
>>>>> 			if (class(result)[1] !=  "try-error")
>>>>> activeDataSet(datasetName)
>>>>> 			tkfocus(CommanderWindow())
>>>>> 		}
>>>>> 	}
>>>>> 	onDataHelp <- function(){
>>>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) +
>> 1]
>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
>>>>> 		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
>>>>> set selected."), type="warning")
>>>>> 		else if (is.null(package)) doItAndPrint(paste('help("',
>>>>> dsnameValue, '")', sep=""))
>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
>>>>> package="', package, '")', sep=""))
>>>>> 	}
>>>>> 	OKCancelHelp(helpSubject="data")
>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
>>>>> selected data set"), command=onDataHelp)
>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
>>>>> font="RcmdrTitleFont"),
>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-
>>>> click to
>>>>> select)"),
>>>>> 					fg=getRcmdr("title.color"),
>>>>> font="RcmdrTitleFont"), sticky="w")
>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
>>>>> datasetFrame, sticky="nw")
>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
>>>>> sticky="w")
>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
>>>> entryDsname,
>>>>> sticky="w")
>>>>> 	tkgrid(enterFrame, sticky="w")
>>>>> 	tkgrid(dataHelpButton, sticky="w")
>>>>> 	tkgrid(buttonsFrame, sticky="ew")
>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
>>>>> 	dialogSuffix(focus=entryDsname)
>>>>> }
>>>>>
>>>>> -------- snip ----------
>>>>>
>>>>> Any insight into the problem would be appreciated.
>>>>>
>>>>> Thanks,
>>>>> John
>>>>>
>>>>> -----------------------------------------------
>>>>> John Fox, Professor
>>>>> McMaster University
>>>>> Hamilton, Ontario, Canada
>>>>> http://socserv.socsci.mcmaster.ca/jfox/
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ---
>>>>> This email has been checked for viruses by Avast antivirus software.
>>>>> https://www.avast.com/antivirus
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> --
>>>> Peter Dalgaard, Professor,
>>>> Center for Statistics, Copenhagen Business School
>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>> Phone: (+45)38153501
>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>
>>>
>>>
>>> ---
>>> This email has been checked for viruses by Avast antivirus software.
>>> https://www.avast.com/antivirus
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
> 
> 
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
>


From jfox at mcmaster.ca  Tue Jul 14 01:35:40 2015
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 13 Jul 2015 19:35:40 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <55A44332.4070900@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
Message-ID: <004801d0bdc4$a1313260$e3939720$@mcmaster.ca>

Dear Duncan,

> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: July-13-15 7:01 PM
> To: John Fox; 'peter dalgaard'
> Cc: r-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
> 
> It happened in r68597.  In my example, I hadn't imported the data()
> function from utils; when I did that, it was fixed.
> 
> Not sure why the error is complaining about the envir argument.


Yes, importing data works for me too! It's odd that the problem didn't show
up as an undefined global symbol rather than as a note about the envir
argument. (I was fixing imports from standard packages when the problem
arose.)

Thanks for tracking this down.

John

> 
> Duncan Murdoch
> 
> On 13/07/2015 6:47 PM, John Fox wrote:
> > Dear Duncan and Peter,
> >
> > I've just arrived at more or less the same thing:
> >
> > 	foo <- function() data(package="MASS")
> >
> > 	bar <- function() data(package="MASS", envir=.GlobalEnv)
> >
> > 	baz <- function() data(package="MASS", envir=globalenv())
> >
> > all trigger the note when included with the Rcmdr sources:
> >
> > 	* checking R code for possible problems ... NOTE
> > 	bar: Error while checking: invalid 'envir' argument
> > 	baz: Error while checking: invalid 'envir' argument
> > 	foo: Error while checking: invalid 'envir' argument
> >
> > The envir argument to data() defaults to .GlobaEnv .
> >
> > I hope this helps,
> >  John
> >
> >> -----Original Message-----
> >> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >> Sent: July-13-15 6:32 PM
> >> To: John Fox; 'peter dalgaard'
> >> Cc: r-package-devel at r-project.org
> >> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> devel
> >>
> >> On 13/07/2015 5:23 PM, John Fox wrote:
> >>> Dear Peter,
> >>>
> >>>> -----Original Message-----
> >>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
> >>>> Sent: July-13-15 4:52 PM
> >>>> To: John Fox
> >>>> Cc: r-package-devel at r-project.org
> >>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> >> devel
> >>>>
> >>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
> >> days
> >>>
> >>> Sorry, I didn't notice that.
> >>>
> >>>> ago. Look unintentional, but it is not easy to spot what triggers
> it.
> >> If
> >>>> someone could cook up a minimal example, or - maybe easier given
> the
> >>>> relatively short timeframe - bisect their way to the exact svn
> >> revision
> >>>> that triggered it, it might help in getting it fixed.
> >>>
> >>> I'm afraid that I'm not set up to build R-devel and I'm about to
> leave
> >> town
> >>> for three weeks. I'll see if I can produce a simpler example
> >> triggering the
> >>> error, however.
> >>
> >> Hana Sevcikova posted a simple example.  I'll bisect on it.
> >>
> >> Here's her example:
> >>
> >> e <- new.env()
> >> data("mydataset", envir=e)
> >>
> >> I've substituted USArrests for "mydataset".
> >>
> >> Duncan Murdoch
> >>
> >>>
> >>> Thanks for this,
> >>>  John
> >>>
> >>>>
> >>>> -pd
> >>>>
> >>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
> >>>>>
> >>>>> Dear list members,
> >>>>>
> >>>>> I'm getting a new note from R-devel that I haven't seen before
> when
> >>>> checking
> >>>>> the development version of the Rcmdr package:
> >>>>>
> >>>>> 	* checking R code for possible problems ... NOTE
> >>>>> 	readDataFromPackage: Error while checking: invalid 'envir'
> argument
> >>>>>
> >>>>> This note doesn't appear in R 3.2.1.
> >>>>>
> >>>>> My session info:
> >>>>>
> >>>>> -------- snip ----------
> >>>>>
> >>>>> R Under development (unstable) (2015-07-12 r68650)
> >>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
> >>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
> >>>>>
> >>>>> locale:
> >>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> >>>>> LC_MONETARY=English_Canada.1252
> >>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
> >>>>>
> >>>>> attached base packages:
> >>>>> [1] stats     graphics  grDevices utils     datasets  methods
> base
> >>>>>
> >>>>> loaded via a namespace (and not attached):
> >>>>> [1] tools_3.3.0
> >>>>>
> >>>>> -------- snip ----------
> >>>>>
> >>>>> I can't even localize the problem in readDataFromPackage(). There
> >> are
> >>>> only
> >>>>> two places in this function where there's a function call with an
> >>>> envir
> >>>>> argument, and I still get the note if I comment these out. As
> well,
> >>>>> readDataFromPackage() seems to work as intended -- there is no
> >> obvious
> >>>> error
> >>>>> in it.
> >>>>>
> >>>>> FWIW, here's readDataFromPackage(). The complete sources for the
> >>>> development
> >>>>> version of the Rcmdr package are on R-Forge.
> >>>>>
> >>>>> -------- snip ----------
> >>>>>
> >>>>> readDataFromPackage <- function() {
> >>>>> 	env <- environment()
> >>>>> 	datasets <- NULL
> >>>>> 	initializeDialog(title=gettextRcmdr("Read Data From
> Package"))
> >>>>> 	dsname <- tclVar("")
> >>>>> 	package <- NULL
> >>>>> 	enterFrame <- tkframe(top)
> >>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
> >>>> textvariable=dsname)
> >>>>> 	packages <- sort(.packages())
> >>>>> 	packages <- packages[! packages %in% c("base", "stats")]
> >>>>> 	packages <- packages[sapply(packages, function(package){
> >>>>> 						ds <-
> >>>>> data(package=package)$results
> >>>>> 						if (nrow(ds) == 0)
> >>>>> return(FALSE)
> >>>>> 						ds <- ds[, "Item"]
> >>>>> 						valid <- sapply(ds,
> >>>>> is.valid.name)
> >>>>> 						length(ds[valid]) >
0
> >>>>> 					})]
> >>>>> 	packageDatasetFrame <- tkframe(top)
> >>>>> 	packageFrame <- tkframe(packageDatasetFrame)
> >>>>> 	max.height <- getRcmdr("variable.list.height")
> >>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
> >>>>> length(packages)),
> >>>>>            exportselection="FALSE",
> >>>>> 			selectmode="single", background="white")
> >>>>> 	packageScroll <- ttkscrollbar(packageFrame,
> >>>>> 			command=function(...) tkyview(packageBox,
...))
> >>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
> >>>>> tkset(packageScroll, ...))
> >>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
> >>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
> >>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
> >>>>> exportselection="FALSE",
> >>>>> 			selectmode="single", background="white")
> >>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
> >>>>> 			command=function(...) tkyview(datasetBox,
...))
> >>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
> >>>>> tkset(datasetScroll, ...))
> >>>>> 	onPackageSelect <- function(){
> >>>>> 		assign("package",
> >>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
> >>>>> 		datasets <<- data(package=package)$results[,3]
> >>>>> 		valid <- sapply(datasets, is.valid.name)
> >>>>> 		datasets <<- datasets[valid]
> >>>>> 		tkdelete(datasetBox, "0", "end")
> >>>>> 		for (dataset in datasets) tkinsert(datasetBox,
"end",
> >>>>> dataset)
> >>>>> 		tkconfigure(datasetBox, height=min(max.height,
> >>>>> length(datasets)))
> >>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
> >>>>> 		len <- length(datasets)
> >>>>> 		onLetter <- function(letter){
> >>>>> 			letter <- tolower(letter)
> >>>>> 			current <- 1 +
> >>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
> >>>>> "))[1])*len)
> >>>>> 			mat <- match(letter,
firstChar[-(1:current)])
> >>>>> 			if (is.na(mat)) return()
> >>>>> 			tkyview.scroll(datasetBox, mat, "units")
> >>>>> 		}
> >>>>> 		onA <- function() onLetter("a")
> >>>>> 		onB <- function() onLetter("b")
> >>>>> 		onC <- function() onLetter("c")
> >>>>> 		onD <- function() onLetter("d")
> >>>>> 		onE <- function() onLetter("e")
> >>>>> 		onF <- function() onLetter("f")
> >>>>> 		onG <- function() onLetter("g")
> >>>>> 		onH <- function() onLetter("h")
> >>>>> 		onI <- function() onLetter("i")
> >>>>> 		onJ <- function() onLetter("j")
> >>>>> 		onK <- function() onLetter("k")
> >>>>> 		onL <- function() onLetter("l")
> >>>>> 		onM <- function() onLetter("m")
> >>>>> 		onN <- function() onLetter("n")
> >>>>> 		onO <- function() onLetter("o")
> >>>>> 		onP <- function() onLetter("p")
> >>>>> 		onQ <- function() onLetter("q")
> >>>>> 		onR <- function() onLetter("r")
> >>>>> 		onS <- function() onLetter("s")
> >>>>> 		onT <- function() onLetter("t")
> >>>>> 		onU <- function() onLetter("u")
> >>>>> 		onV <- function() onLetter("v")
> >>>>> 		onW <- function() onLetter("w")
> >>>>> 		onX <- function() onLetter("x")
> >>>>> 		onY <- function() onLetter("y")
> >>>>> 		onZ <- function() onLetter("z")
> >>>>> 		for (letter in c(letters, LETTERS)){
> >>>>> 			tkbind(datasetBox, paste("<", letter, ">",
sep=""),
> >>>>> 					get(paste("on",
toupper(letter),
> >>>>> sep="")))
> >>>>> 		}
> >>>>> 		onClick <- function() tkfocus(datasetBox)
> >>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
> >>>>> 	}
> >>>>> 	onDatasetSelect <- function(){
> >>>>> 		tclvalue(dsname) <-
> >>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>> 	}
> >>>>> 	firstChar <- tolower(substr(packages, 1, 1))
> >>>>> 	len <- length(packages)
> >>>>> 	onLetter <- function(letter){
> >>>>> 		letter <- tolower(letter)
> >>>>> 		current <- 1 +
> >>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
> >>>>> "))[1])*len)
> >>>>> 		mat <- match(letter, firstChar[-(1:current)])
> >>>>> 		if (is.na(mat)) return()
> >>>>> 		tkyview.scroll(packageBox, mat, "units")
> >>>>> 	}
> >>>>> 	onA <- function() onLetter("a")
> >>>>> 	onB <- function() onLetter("b")
> >>>>> 	onC <- function() onLetter("c")
> >>>>> 	onD <- function() onLetter("d")
> >>>>> 	onE <- function() onLetter("e")
> >>>>> 	onF <- function() onLetter("f")
> >>>>> 	onG <- function() onLetter("g")
> >>>>> 	onH <- function() onLetter("h")
> >>>>> 	onI <- function() onLetter("i")
> >>>>> 	onJ <- function() onLetter("j")
> >>>>> 	onK <- function() onLetter("k")
> >>>>> 	onL <- function() onLetter("l")
> >>>>> 	onM <- function() onLetter("m")
> >>>>> 	onN <- function() onLetter("n")
> >>>>> 	onO <- function() onLetter("o")
> >>>>> 	onP <- function() onLetter("p")
> >>>>> 	onQ <- function() onLetter("q")
> >>>>> 	onR <- function() onLetter("r")
> >>>>> 	onS <- function() onLetter("s")
> >>>>> 	onT <- function() onLetter("t")
> >>>>> 	onU <- function() onLetter("u")
> >>>>> 	onV <- function() onLetter("v")
> >>>>> 	onW <- function() onLetter("w")
> >>>>> 	onX <- function() onLetter("x")
> >>>>> 	onY <- function() onLetter("y")
> >>>>> 	onZ <- function() onLetter("z")
> >>>>> 	for (letter in c(letters, LETTERS)){
> >>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
> >>>>> 				get(paste("on", toupper(letter),
sep="")))
> >>>>> 	}
> >>>>> 	onClick <- function() tkfocus(packageBox)
> >>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
> >>>>> 	onOK <- function(){
> >>>>> 		datasetName <-
> >>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>> 		if (dsnameValue != "" && is.null(package)){
> >>>>> 			closeDialog()
> >>>>> 			if (is.element(dsnameValue, listDataSets()))
{
> >>>>> 				if ("no" ==
> >>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
> >>>>> 					if (GrabFocus())
tkgrab.release(top)
> >>>>> 					tkdestroy(top)
> >>>>> 					readDataFromPackage()
> >>>>> 					return()
> >>>>> 				}
> >>>>> 			}
> >>>>> 			save.options <- options(warn=2)
> >>>>> 			check <-
try(eval(parse(text=logger(paste("data(",
> >>>>> dsnameValue, ")", sep=""))),
> >>>>>
envir=.GlobalEnv),
> >>>>> silent=TRUE)
> >>>>> 			options(save.options)
> >>>>> 			if (class(check) == "try-error"){
> >>>>>
errorCondition(recall=readDataFromPackage,
> >>>>>
> >>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
> >>>> dsnameValue))
> >>>>> 				return()
> >>>>> 			}
> >>>>> 			activeDataSet(dsnameValue)
> >>>>> 			tkfocus(CommanderWindow())
> >>>>> 		}
> >>>>> 		else{
> >>>>> 			if (is.null(package)) {
> >>>>>
errorCondition(recall=readDataFromPackage,
> >>>>> message=gettextRcmdr("You must select a package."))
> >>>>> 				return()
> >>>>> 			}
> >>>>> 			if (length(datasetName) == 0) {
> >>>>>
errorCondition(recall=readDataFromPackage,
> >>>>> message=gettextRcmdr("You must select a data set.")    )
> >>>>> 				return()
> >>>>> 			}
> >>>>> 			if (is.element(datasetName, listDataSets()))
{
> >>>>> 				if ("no" ==
> >>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
> >>>>> 					if (GrabFocus())
tkgrab.release(top)
> >>>>> 					tkdestroy(top)
> >>>>> 					readDataFromPackage()
> >>>>> 					return()
> >>>>> 				}
> >>>>> 			}
> >>>>> 			closeDialog()
> >>>>> 			command <- paste("data(", datasetName, ',
> >>>>> package="', package, '")', sep="")
> >>>>> 			result <- justDoIt(command)
> >>>>> 			logger(command)
> >>>>> 			if (class(result)[1] !=  "try-error")
> >>>>> activeDataSet(datasetName)
> >>>>> 			tkfocus(CommanderWindow())
> >>>>> 		}
> >>>>> 	}
> >>>>> 	onDataHelp <- function(){
> >>>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox))
> +
> >> 1]
> >>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
> >>>>> 		if (length(dsnameValue) == 0)
Message(gettextRcmdr("No
> data
> >>>>> set selected."), type="warning")
> >>>>> 		else if (is.null(package))
doItAndPrint(paste('help("',
> >>>>> dsnameValue, '")', sep=""))
> >>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
> >>>>> package="', package, '")', sep=""))
> >>>>> 	}
> >>>>> 	OKCancelHelp(helpSubject="data")
> >>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help
on
> >>>>> selected data set"), command=onDataHelp)
> >>>>> 	tkgrid(labelRcmdr(packageDatasetFrame,
> text=gettextRcmdr("Package
> >>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
> >>>>> font="RcmdrTitleFont"),
> >>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
> >>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set
> (Double-
> >>>> click to
> >>>>> select)"),
> >>>>> 					fg=getRcmdr("title.color"),
> >>>>> font="RcmdrTitleFont"), sticky="w")
> >>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
> >>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
> >>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="
> "),
> >>>>> datasetFrame, sticky="nw")
> >>>>> 	tkgrid(packageDatasetFrame, sticky="w")
> >>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
> >>>>> sticky="w")
> >>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name
> of data
> >>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
> >>>> entryDsname,
> >>>>> sticky="w")
> >>>>> 	tkgrid(enterFrame, sticky="w")
> >>>>> 	tkgrid(dataHelpButton, sticky="w")
> >>>>> 	tkgrid(buttonsFrame, sticky="ew")
> >>>>> 	tkgrid.configure(packageScroll, sticky="ns")
> >>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
> >>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>",
onPackageSelect)
> >>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>",
onDatasetSelect)
> >>>>> 	dialogSuffix(focus=entryDsname)
> >>>>> }
> >>>>>
> >>>>> -------- snip ----------
> >>>>>
> >>>>> Any insight into the problem would be appreciated.
> >>>>>
> >>>>> Thanks,
> >>>>> John
> >>>>>
> >>>>> -----------------------------------------------
> >>>>> John Fox, Professor
> >>>>> McMaster University
> >>>>> Hamilton, Ontario, Canada
> >>>>> http://socserv.socsci.mcmaster.ca/jfox/
> >>>>>
> >>>>>
> >>>>>
> >>>>>
> >>>>> ---
> >>>>> This email has been checked for viruses by Avast antivirus
> software.
> >>>>> https://www.avast.com/antivirus
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-package-devel at r-project.org mailing list
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>
> >>>> --
> >>>> Peter Dalgaard, Professor,
> >>>> Center for Statistics, Copenhagen Business School
> >>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> >>>> Phone: (+45)38153501
> >>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> >>>>
> >>>>
> >>>>
> >>>>
> >>>>
> >>>>
> >>>
> >>>
> >>>
> >>> ---
> >>> This email has been checked for viruses by Avast antivirus software.
> >>> https://www.avast.com/antivirus
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>
> >
> >
> > ---
> > This email has been checked for viruses by Avast antivirus software.
> > https://www.avast.com/antivirus
> >


---
This email has been checked for viruses by Avast antivirus software.
https://www.avast.com/antivirus


From murdoch.duncan at gmail.com  Tue Jul 14 02:00:02 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 13 Jul 2015 20:00:02 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <004801d0bdc4$a1313260$e3939720$@mcmaster.ca>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
	<004801d0bdc4$a1313260$e3939720$@mcmaster.ca>
Message-ID: <55A45102.7070401@gmail.com>

On 13/07/2015 7:35 PM, John Fox wrote:
> Dear Duncan,
> 
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> Sent: July-13-15 7:01 PM
>> To: John Fox; 'peter dalgaard'
>> Cc: r-package-devel at r-project.org
>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
>>
>> It happened in r68597.  In my example, I hadn't imported the data()
>> function from utils; when I did that, it was fixed.
>>
>> Not sure why the error is complaining about the envir argument.
> 
> 
> Yes, importing data works for me too! It's odd that the problem didn't show
> up as an undefined global symbol rather than as a note about the envir
> argument. (I was fixing imports from standard packages when the problem
> arose.)

I'd guess that it's finding some other private function called data();
that's probably worth fixing.

Duncan

> 
> Thanks for tracking this down.
> 
> John
> 
>>
>> Duncan Murdoch
>>
>> On 13/07/2015 6:47 PM, John Fox wrote:
>>> Dear Duncan and Peter,
>>>
>>> I've just arrived at more or less the same thing:
>>>
>>> 	foo <- function() data(package="MASS")
>>>
>>> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
>>>
>>> 	baz <- function() data(package="MASS", envir=globalenv())
>>>
>>> all trigger the note when included with the Rcmdr sources:
>>>
>>> 	* checking R code for possible problems ... NOTE
>>> 	bar: Error while checking: invalid 'envir' argument
>>> 	baz: Error while checking: invalid 'envir' argument
>>> 	foo: Error while checking: invalid 'envir' argument
>>>
>>> The envir argument to data() defaults to .GlobaEnv .
>>>
>>> I hope this helps,
>>>  John
>>>
>>>> -----Original Message-----
>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>> Sent: July-13-15 6:32 PM
>>>> To: John Fox; 'peter dalgaard'
>>>> Cc: r-package-devel at r-project.org
>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
>> devel
>>>>
>>>> On 13/07/2015 5:23 PM, John Fox wrote:
>>>>> Dear Peter,
>>>>>
>>>>>> -----Original Message-----
>>>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
>>>>>> Sent: July-13-15 4:52 PM
>>>>>> To: John Fox
>>>>>> Cc: r-package-devel at r-project.org
>>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
>>>> devel
>>>>>>
>>>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
>>>> days
>>>>>
>>>>> Sorry, I didn't notice that.
>>>>>
>>>>>> ago. Look unintentional, but it is not easy to spot what triggers
>> it.
>>>> If
>>>>>> someone could cook up a minimal example, or - maybe easier given
>> the
>>>>>> relatively short timeframe - bisect their way to the exact svn
>>>> revision
>>>>>> that triggered it, it might help in getting it fixed.
>>>>>
>>>>> I'm afraid that I'm not set up to build R-devel and I'm about to
>> leave
>>>> town
>>>>> for three weeks. I'll see if I can produce a simpler example
>>>> triggering the
>>>>> error, however.
>>>>
>>>> Hana Sevcikova posted a simple example.  I'll bisect on it.
>>>>
>>>> Here's her example:
>>>>
>>>> e <- new.env()
>>>> data("mydataset", envir=e)
>>>>
>>>> I've substituted USArrests for "mydataset".
>>>>
>>>> Duncan Murdoch
>>>>
>>>>>
>>>>> Thanks for this,
>>>>>  John
>>>>>
>>>>>>
>>>>>> -pd
>>>>>>
>>>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
>>>>>>>
>>>>>>> Dear list members,
>>>>>>>
>>>>>>> I'm getting a new note from R-devel that I haven't seen before
>> when
>>>>>> checking
>>>>>>> the development version of the Rcmdr package:
>>>>>>>
>>>>>>> 	* checking R code for possible problems ... NOTE
>>>>>>> 	readDataFromPackage: Error while checking: invalid 'envir'
>> argument
>>>>>>>
>>>>>>> This note doesn't appear in R 3.2.1.
>>>>>>>
>>>>>>> My session info:
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> R Under development (unstable) (2015-07-12 r68650)
>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>
>>>>>>> locale:
>>>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
>>>>>>> LC_MONETARY=English_Canada.1252
>>>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
>>>>>>>
>>>>>>> attached base packages:
>>>>>>> [1] stats     graphics  grDevices utils     datasets  methods
>> base
>>>>>>>
>>>>>>> loaded via a namespace (and not attached):
>>>>>>> [1] tools_3.3.0
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> I can't even localize the problem in readDataFromPackage(). There
>>>> are
>>>>>> only
>>>>>>> two places in this function where there's a function call with an
>>>>>> envir
>>>>>>> argument, and I still get the note if I comment these out. As
>> well,
>>>>>>> readDataFromPackage() seems to work as intended -- there is no
>>>> obvious
>>>>>> error
>>>>>>> in it.
>>>>>>>
>>>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
>>>>>> development
>>>>>>> version of the Rcmdr package are on R-Forge.
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> readDataFromPackage <- function() {
>>>>>>> 	env <- environment()
>>>>>>> 	datasets <- NULL
>>>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From
>> Package"))
>>>>>>> 	dsname <- tclVar("")
>>>>>>> 	package <- NULL
>>>>>>> 	enterFrame <- tkframe(top)
>>>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
>>>>>> textvariable=dsname)
>>>>>>> 	packages <- sort(.packages())
>>>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
>>>>>>> 	packages <- packages[sapply(packages, function(package){
>>>>>>> 						ds <-
>>>>>>> data(package=package)$results
>>>>>>> 						if (nrow(ds) == 0)
>>>>>>> return(FALSE)
>>>>>>> 						ds <- ds[, "Item"]
>>>>>>> 						valid <- sapply(ds,
>>>>>>> is.valid.name)
>>>>>>> 						length(ds[valid]) >
> 0
>>>>>>> 					})]
>>>>>>> 	packageDatasetFrame <- tkframe(top)
>>>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
>>>>>>> 	max.height <- getRcmdr("variable.list.height")
>>>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
>>>>>>> length(packages)),
>>>>>>>            exportselection="FALSE",
>>>>>>> 			selectmode="single", background="white")
>>>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
>>>>>>> 			command=function(...) tkyview(packageBox,
> ...))
>>>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
>>>>>>> tkset(packageScroll, ...))
>>>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
>>>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
>>>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
>>>>>>> exportselection="FALSE",
>>>>>>> 			selectmode="single", background="white")
>>>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
>>>>>>> 			command=function(...) tkyview(datasetBox,
> ...))
>>>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
>>>>>>> tkset(datasetScroll, ...))
>>>>>>> 	onPackageSelect <- function(){
>>>>>>> 		assign("package",
>>>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
>>>>>>> 		datasets <<- data(package=package)$results[,3]
>>>>>>> 		valid <- sapply(datasets, is.valid.name)
>>>>>>> 		datasets <<- datasets[valid]
>>>>>>> 		tkdelete(datasetBox, "0", "end")
>>>>>>> 		for (dataset in datasets) tkinsert(datasetBox,
> "end",
>>>>>>> dataset)
>>>>>>> 		tkconfigure(datasetBox, height=min(max.height,
>>>>>>> length(datasets)))
>>>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
>>>>>>> 		len <- length(datasets)
>>>>>>> 		onLetter <- function(letter){
>>>>>>> 			letter <- tolower(letter)
>>>>>>> 			current <- 1 +
>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
>>>>>>> "))[1])*len)
>>>>>>> 			mat <- match(letter,
> firstChar[-(1:current)])
>>>>>>> 			if (is.na(mat)) return()
>>>>>>> 			tkyview.scroll(datasetBox, mat, "units")
>>>>>>> 		}
>>>>>>> 		onA <- function() onLetter("a")
>>>>>>> 		onB <- function() onLetter("b")
>>>>>>> 		onC <- function() onLetter("c")
>>>>>>> 		onD <- function() onLetter("d")
>>>>>>> 		onE <- function() onLetter("e")
>>>>>>> 		onF <- function() onLetter("f")
>>>>>>> 		onG <- function() onLetter("g")
>>>>>>> 		onH <- function() onLetter("h")
>>>>>>> 		onI <- function() onLetter("i")
>>>>>>> 		onJ <- function() onLetter("j")
>>>>>>> 		onK <- function() onLetter("k")
>>>>>>> 		onL <- function() onLetter("l")
>>>>>>> 		onM <- function() onLetter("m")
>>>>>>> 		onN <- function() onLetter("n")
>>>>>>> 		onO <- function() onLetter("o")
>>>>>>> 		onP <- function() onLetter("p")
>>>>>>> 		onQ <- function() onLetter("q")
>>>>>>> 		onR <- function() onLetter("r")
>>>>>>> 		onS <- function() onLetter("s")
>>>>>>> 		onT <- function() onLetter("t")
>>>>>>> 		onU <- function() onLetter("u")
>>>>>>> 		onV <- function() onLetter("v")
>>>>>>> 		onW <- function() onLetter("w")
>>>>>>> 		onX <- function() onLetter("x")
>>>>>>> 		onY <- function() onLetter("y")
>>>>>>> 		onZ <- function() onLetter("z")
>>>>>>> 		for (letter in c(letters, LETTERS)){
>>>>>>> 			tkbind(datasetBox, paste("<", letter, ">",
> sep=""),
>>>>>>> 					get(paste("on",
> toupper(letter),
>>>>>>> sep="")))
>>>>>>> 		}
>>>>>>> 		onClick <- function() tkfocus(datasetBox)
>>>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
>>>>>>> 	}
>>>>>>> 	onDatasetSelect <- function(){
>>>>>>> 		tclvalue(dsname) <-
>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>>> 	}
>>>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
>>>>>>> 	len <- length(packages)
>>>>>>> 	onLetter <- function(letter){
>>>>>>> 		letter <- tolower(letter)
>>>>>>> 		current <- 1 +
>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
>>>>>>> "))[1])*len)
>>>>>>> 		mat <- match(letter, firstChar[-(1:current)])
>>>>>>> 		if (is.na(mat)) return()
>>>>>>> 		tkyview.scroll(packageBox, mat, "units")
>>>>>>> 	}
>>>>>>> 	onA <- function() onLetter("a")
>>>>>>> 	onB <- function() onLetter("b")
>>>>>>> 	onC <- function() onLetter("c")
>>>>>>> 	onD <- function() onLetter("d")
>>>>>>> 	onE <- function() onLetter("e")
>>>>>>> 	onF <- function() onLetter("f")
>>>>>>> 	onG <- function() onLetter("g")
>>>>>>> 	onH <- function() onLetter("h")
>>>>>>> 	onI <- function() onLetter("i")
>>>>>>> 	onJ <- function() onLetter("j")
>>>>>>> 	onK <- function() onLetter("k")
>>>>>>> 	onL <- function() onLetter("l")
>>>>>>> 	onM <- function() onLetter("m")
>>>>>>> 	onN <- function() onLetter("n")
>>>>>>> 	onO <- function() onLetter("o")
>>>>>>> 	onP <- function() onLetter("p")
>>>>>>> 	onQ <- function() onLetter("q")
>>>>>>> 	onR <- function() onLetter("r")
>>>>>>> 	onS <- function() onLetter("s")
>>>>>>> 	onT <- function() onLetter("t")
>>>>>>> 	onU <- function() onLetter("u")
>>>>>>> 	onV <- function() onLetter("v")
>>>>>>> 	onW <- function() onLetter("w")
>>>>>>> 	onX <- function() onLetter("x")
>>>>>>> 	onY <- function() onLetter("y")
>>>>>>> 	onZ <- function() onLetter("z")
>>>>>>> 	for (letter in c(letters, LETTERS)){
>>>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
>>>>>>> 				get(paste("on", toupper(letter),
> sep="")))
>>>>>>> 	}
>>>>>>> 	onClick <- function() tkfocus(packageBox)
>>>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
>>>>>>> 	onOK <- function(){
>>>>>>> 		datasetName <-
>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>>> 		if (dsnameValue != "" && is.null(package)){
>>>>>>> 			closeDialog()
>>>>>>> 			if (is.element(dsnameValue, listDataSets()))
> {
>>>>>>> 				if ("no" ==
>>>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
>>>>>>> 					if (GrabFocus())
> tkgrab.release(top)
>>>>>>> 					tkdestroy(top)
>>>>>>> 					readDataFromPackage()
>>>>>>> 					return()
>>>>>>> 				}
>>>>>>> 			}
>>>>>>> 			save.options <- options(warn=2)
>>>>>>> 			check <-
> try(eval(parse(text=logger(paste("data(",
>>>>>>> dsnameValue, ")", sep=""))),
>>>>>>>
> envir=.GlobalEnv),
>>>>>>> silent=TRUE)
>>>>>>> 			options(save.options)
>>>>>>> 			if (class(check) == "try-error"){
>>>>>>>
> errorCondition(recall=readDataFromPackage,
>>>>>>>
>>>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
>>>>>> dsnameValue))
>>>>>>> 				return()
>>>>>>> 			}
>>>>>>> 			activeDataSet(dsnameValue)
>>>>>>> 			tkfocus(CommanderWindow())
>>>>>>> 		}
>>>>>>> 		else{
>>>>>>> 			if (is.null(package)) {
>>>>>>>
> errorCondition(recall=readDataFromPackage,
>>>>>>> message=gettextRcmdr("You must select a package."))
>>>>>>> 				return()
>>>>>>> 			}
>>>>>>> 			if (length(datasetName) == 0) {
>>>>>>>
> errorCondition(recall=readDataFromPackage,
>>>>>>> message=gettextRcmdr("You must select a data set.")    )
>>>>>>> 				return()
>>>>>>> 			}
>>>>>>> 			if (is.element(datasetName, listDataSets()))
> {
>>>>>>> 				if ("no" ==
>>>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
>>>>>>> 					if (GrabFocus())
> tkgrab.release(top)
>>>>>>> 					tkdestroy(top)
>>>>>>> 					readDataFromPackage()
>>>>>>> 					return()
>>>>>>> 				}
>>>>>>> 			}
>>>>>>> 			closeDialog()
>>>>>>> 			command <- paste("data(", datasetName, ',
>>>>>>> package="', package, '")', sep="")
>>>>>>> 			result <- justDoIt(command)
>>>>>>> 			logger(command)
>>>>>>> 			if (class(result)[1] !=  "try-error")
>>>>>>> activeDataSet(datasetName)
>>>>>>> 			tkfocus(CommanderWindow())
>>>>>>> 		}
>>>>>>> 	}
>>>>>>> 	onDataHelp <- function(){
>>>>>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox))
>> +
>>>> 1]
>>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
>>>>>>> 		if (length(dsnameValue) == 0)
> Message(gettextRcmdr("No
>> data
>>>>>>> set selected."), type="warning")
>>>>>>> 		else if (is.null(package))
> doItAndPrint(paste('help("',
>>>>>>> dsnameValue, '")', sep=""))
>>>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
>>>>>>> package="', package, '")', sep=""))
>>>>>>> 	}
>>>>>>> 	OKCancelHelp(helpSubject="data")
>>>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help
> on
>>>>>>> selected data set"), command=onDataHelp)
>>>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame,
>> text=gettextRcmdr("Package
>>>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
>>>>>>> font="RcmdrTitleFont"),
>>>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
>>>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set
>> (Double-
>>>>>> click to
>>>>>>> select)"),
>>>>>>> 					fg=getRcmdr("title.color"),
>>>>>>> font="RcmdrTitleFont"), sticky="w")
>>>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
>>>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
>>>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="
>> "),
>>>>>>> datasetFrame, sticky="nw")
>>>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
>>>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
>>>>>>> sticky="w")
>>>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name
>> of data
>>>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
>>>>>> entryDsname,
>>>>>>> sticky="w")
>>>>>>> 	tkgrid(enterFrame, sticky="w")
>>>>>>> 	tkgrid(dataHelpButton, sticky="w")
>>>>>>> 	tkgrid(buttonsFrame, sticky="ew")
>>>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
>>>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
>>>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>",
> onPackageSelect)
>>>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>",
> onDatasetSelect)
>>>>>>> 	dialogSuffix(focus=entryDsname)
>>>>>>> }
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> Any insight into the problem would be appreciated.
>>>>>>>
>>>>>>> Thanks,
>>>>>>> John
>>>>>>>
>>>>>>> -----------------------------------------------
>>>>>>> John Fox, Professor
>>>>>>> McMaster University
>>>>>>> Hamilton, Ontario, Canada
>>>>>>> http://socserv.socsci.mcmaster.ca/jfox/
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ---
>>>>>>> This email has been checked for viruses by Avast antivirus
>> software.
>>>>>>> https://www.avast.com/antivirus
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>>> --
>>>>>> Peter Dalgaard, Professor,
>>>>>> Center for Statistics, Copenhagen Business School
>>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>>>> Phone: (+45)38153501
>>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ---
>>>>> This email has been checked for viruses by Avast antivirus software.
>>>>> https://www.avast.com/antivirus
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>
>>>
>>> ---
>>> This email has been checked for viruses by Avast antivirus software.
>>> https://www.avast.com/antivirus
>>>
> 
> 
> ---
> This email has been checked for viruses by Avast antivirus software.
> https://www.avast.com/antivirus
>


From jfox at mcmaster.ca  Tue Jul 14 03:42:26 2015
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 13 Jul 2015 21:42:26 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <55A45102.7070401@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
	<004801d0bdc4$a1313260$e3939720$@mcmaster.ca>
	<55A45102.7070401@gmail.com>
Message-ID: <web-565446548@cgpsrv2.cis.mcmaster.ca>

Dear Duncan,

On Mon, 13 Jul 2015 20:00:02 -0400
 Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 13/07/2015 7:35 PM, John Fox wrote:
> > Dear Duncan,
> > 
> >> -----Original Message-----
> >> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >> Sent: July-13-15 7:01 PM
> >> To: John Fox; 'peter dalgaard'
> >> Cc: r-package-devel at r-project.org
> >> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
> >>
> >> It happened in r68597.  In my example, I hadn't imported the data()
> >> function from utils; when I did that, it was fixed.
> >>
> >> Not sure why the error is complaining about the envir argument.
> > 
> > 
> > Yes, importing data works for me too! It's odd that the problem didn't show
> > up as an undefined global symbol rather than as a note about the envir
> > argument. (I was fixing imports from standard packages when the problem
> > arose.)
> 
> I'd guess that it's finding some other private function called data();
> that's probably worth fixing.

If you mean an unexported function named data() in the Rcmdr package, then I'm pretty sure that there is none -- and I just checked all of the many uses of the word "data" in the Rcmdr sources. Of course, I may have missed something or, more likely, misunderstood what you're suggesting.

Best,
 John

> 
> Duncan
> 
> > 
> > Thanks for tracking this down.
> > 
> > John
> > 
> >>
> >> Duncan Murdoch
> >>
> >> On 13/07/2015 6:47 PM, John Fox wrote:
> >>> Dear Duncan and Peter,
> >>>
> >>> I've just arrived at more or less the same thing:
> >>>
> >>> 	foo <- function() data(package="MASS")
> >>>
> >>> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
> >>>
> >>> 	baz <- function() data(package="MASS", envir=globalenv())
> >>>
> >>> all trigger the note when included with the Rcmdr sources:
> >>>
> >>> 	* checking R code for possible problems ... NOTE
> >>> 	bar: Error while checking: invalid 'envir' argument
> >>> 	baz: Error while checking: invalid 'envir' argument
> >>> 	foo: Error while checking: invalid 'envir' argument
> >>>
> >>> The envir argument to data() defaults to .GlobaEnv .
> >>>
> >>> I hope this helps,
> >>>  John
> >>>
> >>>> -----Original Message-----
> >>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >>>> Sent: July-13-15 6:32 PM
> >>>> To: John Fox; 'peter dalgaard'
> >>>> Cc: r-package-devel at r-project.org
> >>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> >> devel
> >>>>
> >>>> On 13/07/2015 5:23 PM, John Fox wrote:
> >>>>> Dear Peter,
> >>>>>
> >>>>>> -----Original Message-----
> >>>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
> >>>>>> Sent: July-13-15 4:52 PM
> >>>>>> To: John Fox
> >>>>>> Cc: r-package-devel at r-project.org
> >>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> >>>> devel
> >>>>>>
> >>>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
> >>>> days
> >>>>>
> >>>>> Sorry, I didn't notice that.
> >>>>>
> >>>>>> ago. Look unintentional, but it is not easy to spot what triggers
> >> it.
> >>>> If
> >>>>>> someone could cook up a minimal example, or - maybe easier given
> >> the
> >>>>>> relatively short timeframe - bisect their way to the exact svn
> >>>> revision
> >>>>>> that triggered it, it might help in getting it fixed.
> >>>>>
> >>>>> I'm afraid that I'm not set up to build R-devel and I'm about to
> >> leave
> >>>> town
> >>>>> for three weeks. I'll see if I can produce a simpler example
> >>>> triggering the
> >>>>> error, however.
> >>>>
> >>>> Hana Sevcikova posted a simple example.  I'll bisect on it.
> >>>>
> >>>> Here's her example:
> >>>>
> >>>> e <- new.env()
> >>>> data("mydataset", envir=e)
> >>>>
> >>>> I've substituted USArrests for "mydataset".
> >>>>
> >>>> Duncan Murdoch
> >>>>
> >>>>>
> >>>>> Thanks for this,
> >>>>>  John
> >>>>>
> >>>>>>
> >>>>>> -pd
> >>>>>>
> >>>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
> >>>>>>>
> >>>>>>> Dear list members,
> >>>>>>>
> >>>>>>> I'm getting a new note from R-devel that I haven't seen before
> >> when
> >>>>>> checking
> >>>>>>> the development version of the Rcmdr package:
> >>>>>>>
> >>>>>>> 	* checking R code for possible problems ... NOTE
> >>>>>>> 	readDataFromPackage: Error while checking: invalid 'envir'
> >> argument
> >>>>>>>
> >>>>>>> This note doesn't appear in R 3.2.1.
> >>>>>>>
> >>>>>>> My session info:
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> R Under development (unstable) (2015-07-12 r68650)
> >>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
> >>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
> >>>>>>>
> >>>>>>> locale:
> >>>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> >>>>>>> LC_MONETARY=English_Canada.1252
> >>>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
> >>>>>>>
> >>>>>>> attached base packages:
> >>>>>>> [1] stats     graphics  grDevices utils     datasets  methods
> >> base
> >>>>>>>
> >>>>>>> loaded via a namespace (and not attached):
> >>>>>>> [1] tools_3.3.0
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> I can't even localize the problem in readDataFromPackage(). There
> >>>> are
> >>>>>> only
> >>>>>>> two places in this function where there's a function call with an
> >>>>>> envir
> >>>>>>> argument, and I still get the note if I comment these out. As
> >> well,
> >>>>>>> readDataFromPackage() seems to work as intended -- there is no
> >>>> obvious
> >>>>>> error
> >>>>>>> in it.
> >>>>>>>
> >>>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
> >>>>>> development
> >>>>>>> version of the Rcmdr package are on R-Forge.
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> readDataFromPackage <- function() {
> >>>>>>> 	env <- environment()
> >>>>>>> 	datasets <- NULL
> >>>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From
> >> Package"))
> >>>>>>> 	dsname <- tclVar("")
> >>>>>>> 	package <- NULL
> >>>>>>> 	enterFrame <- tkframe(top)
> >>>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
> >>>>>> textvariable=dsname)
> >>>>>>> 	packages <- sort(.packages())
> >>>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
> >>>>>>> 	packages <- packages[sapply(packages, function(package){
> >>>>>>> 						ds <-
> >>>>>>> data(package=package)$results
> >>>>>>> 						if (nrow(ds) == 0)
> >>>>>>> return(FALSE)
> >>>>>>> 						ds <- ds[, "Item"]
> >>>>>>> 						valid <- sapply(ds,
> >>>>>>> is.valid.name)
> >>>>>>> 						length(ds[valid]) >
> > 0
> >>>>>>> 					})]
> >>>>>>> 	packageDatasetFrame <- tkframe(top)
> >>>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
> >>>>>>> 	max.height <- getRcmdr("variable.list.height")
> >>>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
> >>>>>>> length(packages)),
> >>>>>>>            exportselection="FALSE",
> >>>>>>> 			selectmode="single", background="white")
> >>>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
> >>>>>>> 			command=function(...) tkyview(packageBox,
> > ...))
> >>>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
> >>>>>>> tkset(packageScroll, ...))
> >>>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
> >>>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
> >>>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
> >>>>>>> exportselection="FALSE",
> >>>>>>> 			selectmode="single", background="white")
> >>>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
> >>>>>>> 			command=function(...) tkyview(datasetBox,
> > ...))
> >>>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
> >>>>>>> tkset(datasetScroll, ...))
> >>>>>>> 	onPackageSelect <- function(){
> >>>>>>> 		assign("package",
> >>>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
> >>>>>>> 		datasets <<- data(package=package)$results[,3]
> >>>>>>> 		valid <- sapply(datasets, is.valid.name)
> >>>>>>> 		datasets <<- datasets[valid]
> >>>>>>> 		tkdelete(datasetBox, "0", "end")
> >>>>>>> 		for (dataset in datasets) tkinsert(datasetBox,
> > "end",
> >>>>>>> dataset)
> >>>>>>> 		tkconfigure(datasetBox, height=min(max.height,
> >>>>>>> length(datasets)))
> >>>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
> >>>>>>> 		len <- length(datasets)
> >>>>>>> 		onLetter <- function(letter){
> >>>>>>> 			letter <- tolower(letter)
> >>>>>>> 			current <- 1 +
> >>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
> >>>>>>> "))[1])*len)
> >>>>>>> 			mat <- match(letter,
> > firstChar[-(1:current)])
> >>>>>>> 			if (is.na(mat)) return()
> >>>>>>> 			tkyview.scroll(datasetBox, mat, "units")
> >>>>>>> 		}
> >>>>>>> 		onA <- function() onLetter("a")
> >>>>>>> 		onB <- function() onLetter("b")
> >>>>>>> 		onC <- function() onLetter("c")
> >>>>>>> 		onD <- function() onLetter("d")
> >>>>>>> 		onE <- function() onLetter("e")
> >>>>>>> 		onF <- function() onLetter("f")
> >>>>>>> 		onG <- function() onLetter("g")
> >>>>>>> 		onH <- function() onLetter("h")
> >>>>>>> 		onI <- function() onLetter("i")
> >>>>>>> 		onJ <- function() onLetter("j")
> >>>>>>> 		onK <- function() onLetter("k")
> >>>>>>> 		onL <- function() onLetter("l")
> >>>>>>> 		onM <- function() onLetter("m")
> >>>>>>> 		onN <- function() onLetter("n")
> >>>>>>> 		onO <- function() onLetter("o")
> >>>>>>> 		onP <- function() onLetter("p")
> >>>>>>> 		onQ <- function() onLetter("q")
> >>>>>>> 		onR <- function() onLetter("r")
> >>>>>>> 		onS <- function() onLetter("s")
> >>>>>>> 		onT <- function() onLetter("t")
> >>>>>>> 		onU <- function() onLetter("u")
> >>>>>>> 		onV <- function() onLetter("v")
> >>>>>>> 		onW <- function() onLetter("w")
> >>>>>>> 		onX <- function() onLetter("x")
> >>>>>>> 		onY <- function() onLetter("y")
> >>>>>>> 		onZ <- function() onLetter("z")
> >>>>>>> 		for (letter in c(letters, LETTERS)){
> >>>>>>> 			tkbind(datasetBox, paste("<", letter, ">",
> > sep=""),
> >>>>>>> 					get(paste("on",
> > toupper(letter),
> >>>>>>> sep="")))
> >>>>>>> 		}
> >>>>>>> 		onClick <- function() tkfocus(datasetBox)
> >>>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
> >>>>>>> 	}
> >>>>>>> 	onDatasetSelect <- function(){
> >>>>>>> 		tclvalue(dsname) <-
> >>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>>>> 	}
> >>>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
> >>>>>>> 	len <- length(packages)
> >>>>>>> 	onLetter <- function(letter){
> >>>>>>> 		letter <- tolower(letter)
> >>>>>>> 		current <- 1 +
> >>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
> >>>>>>> "))[1])*len)
> >>>>>>> 		mat <- match(letter, firstChar[-(1:current)])
> >>>>>>> 		if (is.na(mat)) return()
> >>>>>>> 		tkyview.scroll(packageBox, mat, "units")
> >>>>>>> 	}
> >>>>>>> 	onA <- function() onLetter("a")
> >>>>>>> 	onB <- function() onLetter("b")
> >>>>>>> 	onC <- function() onLetter("c")
> >>>>>>> 	onD <- function() onLetter("d")
> >>>>>>> 	onE <- function() onLetter("e")
> >>>>>>> 	onF <- function() onLetter("f")
> >>>>>>> 	onG <- function() onLetter("g")
> >>>>>>> 	onH <- function() onLetter("h")
> >>>>>>> 	onI <- function() onLetter("i")
> >>>>>>> 	onJ <- function() onLetter("j")
> >>>>>>> 	onK <- function() onLetter("k")
> >>>>>>> 	onL <- function() onLetter("l")
> >>>>>>> 	onM <- function() onLetter("m")
> >>>>>>> 	onN <- function() onLetter("n")
> >>>>>>> 	onO <- function() onLetter("o")
> >>>>>>> 	onP <- function() onLetter("p")
> >>>>>>> 	onQ <- function() onLetter("q")
> >>>>>>> 	onR <- function() onLetter("r")
> >>>>>>> 	onS <- function() onLetter("s")
> >>>>>>> 	onT <- function() onLetter("t")
> >>>>>>> 	onU <- function() onLetter("u")
> >>>>>>> 	onV <- function() onLetter("v")
> >>>>>>> 	onW <- function() onLetter("w")
> >>>>>>> 	onX <- function() onLetter("x")
> >>>>>>> 	onY <- function() onLetter("y")
> >>>>>>> 	onZ <- function() onLetter("z")
> >>>>>>> 	for (letter in c(letters, LETTERS)){
> >>>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
> >>>>>>> 				get(paste("on", toupper(letter),
> > sep="")))
> >>>>>>> 	}
> >>>>>>> 	onClick <- function() tkfocus(packageBox)
> >>>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
> >>>>>>> 	onOK <- function(){
> >>>>>>> 		datasetName <-
> >>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>>>> 		if (dsnameValue != "" && is.null(package)){
> >>>>>>> 			closeDialog()
> >>>>>>> 			if (is.element(dsnameValue, listDataSets()))
> > {
> >>>>>>> 				if ("no" ==
> >>>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
> >>>>>>> 					if (GrabFocus())
> > tkgrab.release(top)
> >>>>>>> 					tkdestroy(top)
> >>>>>>> 					readDataFromPackage()
> >>>>>>> 					return()
> >>>>>>> 				}
> >>>>>>> 			}
> >>>>>>> 			save.options <- options(warn=2)
> >>>>>>> 			check <-
> > try(eval(parse(text=logger(paste("data(",
> >>>>>>> dsnameValue, ")", sep=""))),
> >>>>>>>
> > envir=.GlobalEnv),
> >>>>>>> silent=TRUE)
> >>>>>>> 			options(save.options)
> >>>>>>> 			if (class(check) == "try-error"){
> >>>>>>>
> > errorCondition(recall=readDataFromPackage,
> >>>>>>>
> >>>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
> >>>>>> dsnameValue))
> >>>>>>> 				return()
> >>>>>>> 			}
> >>>>>>> 			activeDataSet(dsnameValue)
> >>>>>>> 			tkfocus(CommanderWindow())
> >>>>>>> 		}
> >>>>>>> 		else{
> >>>>>>> 			if (is.null(package)) {
> >>>>>>>
> > errorCondition(recall=readDataFromPackage,
> >>>>>>> message=gettextRcmdr("You must select a package."))
> >>>>>>> 				return()
> >>>>>>> 			}
> >>>>>>> 			if (length(datasetName) == 0) {
> >>>>>>>
> > errorCondition(recall=readDataFromPackage,
> >>>>>>> message=gettextRcmdr("You must select a data set.")    )
> >>>>>>> 				return()
> >>>>>>> 			}
> >>>>>>> 			if (is.element(datasetName, listDataSets()))
> > {
> >>>>>>> 				if ("no" ==
> >>>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
> >>>>>>> 					if (GrabFocus())
> > tkgrab.release(top)
> >>>>>>> 					tkdestroy(top)
> >>>>>>> 					readDataFromPackage()
> >>>>>>> 					return()
> >>>>>>> 				}
> >>>>>>> 			}
> >>>>>>> 			closeDialog()
> >>>>>>> 			command <- paste("data(", datasetName, ',
> >>>>>>> package="', package, '")', sep="")
> >>>>>>> 			result <- justDoIt(command)
> >>>>>>> 			logger(command)
> >>>>>>> 			if (class(result)[1] !=  "try-error")
> >>>>>>> activeDataSet(datasetName)
> >>>>>>> 			tkfocus(CommanderWindow())
> >>>>>>> 		}
> >>>>>>> 	}
> >>>>>>> 	onDataHelp <- function(){
> >>>>>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox))
> >> +
> >>>> 1]
> >>>>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
> >>>>>>> 		if (length(dsnameValue) == 0)
> > Message(gettextRcmdr("No
> >> data
> >>>>>>> set selected."), type="warning")
> >>>>>>> 		else if (is.null(package))
> > doItAndPrint(paste('help("',
> >>>>>>> dsnameValue, '")', sep=""))
> >>>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
> >>>>>>> package="', package, '")', sep=""))
> >>>>>>> 	}
> >>>>>>> 	OKCancelHelp(helpSubject="data")
> >>>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help
> > on
> >>>>>>> selected data set"), command=onDataHelp)
> >>>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame,
> >> text=gettextRcmdr("Package
> >>>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
> >>>>>>> font="RcmdrTitleFont"),
> >>>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
> >>>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set
> >> (Double-
> >>>>>> click to
> >>>>>>> select)"),
> >>>>>>> 					fg=getRcmdr("title.color"),
> >>>>>>> font="RcmdrTitleFont"), sticky="w")
> >>>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
> >>>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
> >>>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="
> >> "),
> >>>>>>> datasetFrame, sticky="nw")
> >>>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
> >>>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
> >>>>>>> sticky="w")
> >>>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name
> >> of data
> >>>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
> >>>>>> entryDsname,
> >>>>>>> sticky="w")
> >>>>>>> 	tkgrid(enterFrame, sticky="w")
> >>>>>>> 	tkgrid(dataHelpButton, sticky="w")
> >>>>>>> 	tkgrid(buttonsFrame, sticky="ew")
> >>>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
> >>>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
> >>>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>",
> > onPackageSelect)
> >>>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>",
> > onDatasetSelect)
> >>>>>>> 	dialogSuffix(focus=entryDsname)
> >>>>>>> }
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> Any insight into the problem would be appreciated.
> >>>>>>>
> >>>>>>> Thanks,
> >>>>>>> John
> >>>>>>>
> >>>>>>> -----------------------------------------------
> >>>>>>> John Fox, Professor
> >>>>>>> McMaster University
> >>>>>>> Hamilton, Ontario, Canada
> >>>>>>> http://socserv.socsci.mcmaster.ca/jfox/
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>> ---
> >>>>>>> This email has been checked for viruses by Avast antivirus
> >> software.
> >>>>>>> https://www.avast.com/antivirus
> >>>>>>>
> >>>>>>> ______________________________________________
> >>>>>>> R-package-devel at r-project.org mailing list
> >>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>>
> >>>>>> --
> >>>>>> Peter Dalgaard, Professor,
> >>>>>> Center for Statistics, Copenhagen Business School
> >>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> >>>>>> Phone: (+45)38153501
> >>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>
> >>>>>
> >>>>>
> >>>>> ---
> >>>>> This email has been checked for viruses by Avast antivirus software.
> >>>>> https://www.avast.com/antivirus
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-package-devel at r-project.org mailing list
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>
> >>>
> >>>
> >>> ---
> >>> This email has been checked for viruses by Avast antivirus software.
> >>> https://www.avast.com/antivirus
> >>>
> > 
> > 
> > ---
> > This email has been checked for viruses by Avast antivirus software.
> > https://www.avast.com/antivirus
> > 
> 

------------------------------------------------
John Fox, Professor
McMaster University
Hamilton, Ontario, Canada
http://socserv.mcmaster.ca/jfox/


From Sebastien.Bihorel at cognigencorp.com  Tue Jul 14 03:42:55 2015
From: Sebastien.Bihorel at cognigencorp.com (sbihorel)
Date: Mon, 13 Jul 2015 21:42:55 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
Message-ID: <55A4691F.4070200@cognigencorp.com>

Hi,

Sorry about the table. It looked good when displayed using a fixed width 
font. Let me try to linearize it:

  * pkgA
      o DESCRIPTION:
          + Depends: methods, lattice, grid, gam
          + Imports: Hmisc, survival
      o NAMESPACE:
          + import: lattice, grid, gam, methods
          + importFrom: Hmisc (one function)
  * pkgB
      o DESCRIPTION:
          + Depends: pkgA
          + Imports: <nothing>
      o NAMESPACE:
          + import: pkgA
          + importFrom: <nothing
  * pkgC
      o DESCRIPTION:
          + Depends: methods, pkgB
          + Imports: <nothing>
      o NAMESPACE:
          + import: methods, pkgB
          + importFrom: <nothing

Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include: 
exportPattern("^[^\\.]").

Sebastien


On 7/13/2015 5:36 PM, Seth Wenchel wrote:
> Are you exporting the functions from pkgB and pkgC? It's hard to tell 
> from your table below. The easiest way is to add a comment before each 
> of the functions in pkgB and pkgC that you want to expose to the users.
>
> #' @export
> foo <- function(){...}
>
> Then run roxygen::roxygenise() to build the NAMESPACE file.
>
> HTH
> Seth
>
> On Monday, July 13, 2015, sbihorel <Sebastien.Bihorel at cognigencorp.com 
> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>
>     Hi,
>
>     My group has recently upgraded from a fairly old R version (2.12)
>     to the
>     R version 3.1.2. In parallel to this upgrade, I am updating our custom
>     packages to add functionality and also make them compliant to the
>     requirements of the new version of R. I would like to ask your
>     help with
>     respect to warning messages I get when I check and install the
>     packages.
>     I read the latest version of the manual on writing R extensions,
>     try to
>     apply the recommendations, but somehow I am not getting things right.
>     Hopefully, with your suggestions, I could setup my package
>     correctly to
>     make these messages stop.
>
>     I apologize but, for confidentiality purpose, I will have to partially
>     anonymize the information.
>
>     So here is the situation: we have 2 custom packages (let's call them
>     pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>     call it
>     pkgA) that is available on CRAN. The pkgC package depends on pkgB,
>     make
>     new function available,  and "overwrites" some of the functions
>     distributed as part of pkgA. The following table summarizes the
>     content
>     of the DESCRIPTION and NAMESPACE files of each of these packages.
>
>     package    DESCRIPTION NAMESPACE
>                 Depends                       Imports
>     import                         importFrom
>     pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>     grid,
>     gam, methods    Hmisc
>     pkgB       pkgA pkgA
>     pkgC       methods, pkgB methods, pkgB
>
>     I do not get any warning when I build, check or install pkgB in our
>     linux openSuse environment.
>
>     After successful building pkgC, I run R CMD check on my built for pkgC
>     but I get a ton of messages under the "checking R code for possible
>     problems" section. These notes are related to actual calls to pkgA
>     functions (or to one of the function provided by its
>     dependencies). Here
>     is a subset for illustration and hopefully information.
>
>     * checking R code for possible problems: NOTE
>     pkgC_function_001: no visible global function definition
>     for"pkgA_function_AAA"
>     pkgC_function_001: no visible global function definition
>     for"pkgA_function_AAB"
>     ...
>     pkgC_function_010: no visible global function definition for"xyplot"
>     pkgC_function_010: no visible global function definition
>     for"panel.xyplot"
>     pkgC_function_010: no visible global function definition
>     for"panel.abline"
>     pkgC_function_010: no visible global function definition
>     for"grid.polygon"
>     pkgC_function_010: no visible global function definition for"gpar"
>     ...
>
>     Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>     following warnings about the content of my documentation Rd files. The
>     Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>
>     *** installing help indices
>        converting help for package ?kiwixposedev?
>          finding HTML links ... done
>     pkgC_function_001                    html
>          pkgC_function_002                    html
>     ...
>     Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>     link "panel.abline"
>     ...
>     Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>     link "pkA_function_AAC"
>     ...
>
>     I think I need to somehow modify the content of the DESCRIPTION and
>     NAMESPACE files for pkgC... but adding various combinations of pkA and
>     its dependencies gave me others errors about redundancies and multiple
>     loading of the same packages. So in short, I am kind of lost with the
>     new requirements of R 3.1.2 and would greatly appreciate any help or
>     suggestions
>
>     Thank you in advance for your time.
>
>     Sebastien Bihorel
>
>
>             [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org <javascript:;> mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


	[[alternative HTML version deleted]]


From jfox at mcmaster.ca  Tue Jul 14 04:38:32 2015
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 13 Jul 2015 22:38:32 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <55A45102.7070401@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
	<004801d0bdc4$a1313260$e3939720$@mcmaster.ca>
	<55A45102.7070401@gmail.com>
Message-ID: <web-565448419@cgpsrv2.cis.mcmaster.ca>

Dear Duncan,

Further to my last message, and in case it's relevant, with the development version of the Rcmdr package loaded, I get

> getAnywhere("data")
A single object matching 'data' was found
It was found in the following places
  package:utils
  namespace:utils
with value . . .

Best,
 John

On Mon, 13 Jul 2015 20:00:02 -0400
 Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 13/07/2015 7:35 PM, John Fox wrote:
> > Dear Duncan,
> > 
> >> -----Original Message-----
> >> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >> Sent: July-13-15 7:01 PM
> >> To: John Fox; 'peter dalgaard'
> >> Cc: r-package-devel at r-project.org
> >> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
> >>
> >> It happened in r68597.  In my example, I hadn't imported the data()
> >> function from utils; when I did that, it was fixed.
> >>
> >> Not sure why the error is complaining about the envir argument.
> > 
> > 
> > Yes, importing data works for me too! It's odd that the problem didn't show
> > up as an undefined global symbol rather than as a note about the envir
> > argument. (I was fixing imports from standard packages when the problem
> > arose.)
> 
> I'd guess that it's finding some other private function called data();
> that's probably worth fixing.
> 
> Duncan
> 
> > 
> > Thanks for tracking this down.
> > 
> > John
> > 
> >>
> >> Duncan Murdoch
> >>
> >> On 13/07/2015 6:47 PM, John Fox wrote:
> >>> Dear Duncan and Peter,
> >>>
> >>> I've just arrived at more or less the same thing:
> >>>
> >>> 	foo <- function() data(package="MASS")
> >>>
> >>> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
> >>>
> >>> 	baz <- function() data(package="MASS", envir=globalenv())
> >>>
> >>> all trigger the note when included with the Rcmdr sources:
> >>>
> >>> 	* checking R code for possible problems ... NOTE
> >>> 	bar: Error while checking: invalid 'envir' argument
> >>> 	baz: Error while checking: invalid 'envir' argument
> >>> 	foo: Error while checking: invalid 'envir' argument
> >>>
> >>> The envir argument to data() defaults to .GlobaEnv .
> >>>
> >>> I hope this helps,
> >>>  John
> >>>
> >>>> -----Original Message-----
> >>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >>>> Sent: July-13-15 6:32 PM
> >>>> To: John Fox; 'peter dalgaard'
> >>>> Cc: r-package-devel at r-project.org
> >>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> >> devel
> >>>>
> >>>> On 13/07/2015 5:23 PM, John Fox wrote:
> >>>>> Dear Peter,
> >>>>>
> >>>>>> -----Original Message-----
> >>>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
> >>>>>> Sent: July-13-15 4:52 PM
> >>>>>> To: John Fox
> >>>>>> Cc: r-package-devel at r-project.org
> >>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> >>>> devel
> >>>>>>
> >>>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
> >>>> days
> >>>>>
> >>>>> Sorry, I didn't notice that.
> >>>>>
> >>>>>> ago. Look unintentional, but it is not easy to spot what triggers
> >> it.
> >>>> If
> >>>>>> someone could cook up a minimal example, or - maybe easier given
> >> the
> >>>>>> relatively short timeframe - bisect their way to the exact svn
> >>>> revision
> >>>>>> that triggered it, it might help in getting it fixed.
> >>>>>
> >>>>> I'm afraid that I'm not set up to build R-devel and I'm about to
> >> leave
> >>>> town
> >>>>> for three weeks. I'll see if I can produce a simpler example
> >>>> triggering the
> >>>>> error, however.
> >>>>
> >>>> Hana Sevcikova posted a simple example.  I'll bisect on it.
> >>>>
> >>>> Here's her example:
> >>>>
> >>>> e <- new.env()
> >>>> data("mydataset", envir=e)
> >>>>
> >>>> I've substituted USArrests for "mydataset".
> >>>>
> >>>> Duncan Murdoch
> >>>>
> >>>>>
> >>>>> Thanks for this,
> >>>>>  John
> >>>>>
> >>>>>>
> >>>>>> -pd
> >>>>>>
> >>>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
> >>>>>>>
> >>>>>>> Dear list members,
> >>>>>>>
> >>>>>>> I'm getting a new note from R-devel that I haven't seen before
> >> when
> >>>>>> checking
> >>>>>>> the development version of the Rcmdr package:
> >>>>>>>
> >>>>>>> 	* checking R code for possible problems ... NOTE
> >>>>>>> 	readDataFromPackage: Error while checking: invalid 'envir'
> >> argument
> >>>>>>>
> >>>>>>> This note doesn't appear in R 3.2.1.
> >>>>>>>
> >>>>>>> My session info:
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> R Under development (unstable) (2015-07-12 r68650)
> >>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
> >>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
> >>>>>>>
> >>>>>>> locale:
> >>>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> >>>>>>> LC_MONETARY=English_Canada.1252
> >>>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
> >>>>>>>
> >>>>>>> attached base packages:
> >>>>>>> [1] stats     graphics  grDevices utils     datasets  methods
> >> base
> >>>>>>>
> >>>>>>> loaded via a namespace (and not attached):
> >>>>>>> [1] tools_3.3.0
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> I can't even localize the problem in readDataFromPackage(). There
> >>>> are
> >>>>>> only
> >>>>>>> two places in this function where there's a function call with an
> >>>>>> envir
> >>>>>>> argument, and I still get the note if I comment these out. As
> >> well,
> >>>>>>> readDataFromPackage() seems to work as intended -- there is no
> >>>> obvious
> >>>>>> error
> >>>>>>> in it.
> >>>>>>>
> >>>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
> >>>>>> development
> >>>>>>> version of the Rcmdr package are on R-Forge.
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> readDataFromPackage <- function() {
> >>>>>>> 	env <- environment()
> >>>>>>> 	datasets <- NULL
> >>>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From
> >> Package"))
> >>>>>>> 	dsname <- tclVar("")
> >>>>>>> 	package <- NULL
> >>>>>>> 	enterFrame <- tkframe(top)
> >>>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
> >>>>>> textvariable=dsname)
> >>>>>>> 	packages <- sort(.packages())
> >>>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
> >>>>>>> 	packages <- packages[sapply(packages, function(package){
> >>>>>>> 						ds <-
> >>>>>>> data(package=package)$results
> >>>>>>> 						if (nrow(ds) == 0)
> >>>>>>> return(FALSE)
> >>>>>>> 						ds <- ds[, "Item"]
> >>>>>>> 						valid <- sapply(ds,
> >>>>>>> is.valid.name)
> >>>>>>> 						length(ds[valid]) >
> > 0
> >>>>>>> 					})]
> >>>>>>> 	packageDatasetFrame <- tkframe(top)
> >>>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
> >>>>>>> 	max.height <- getRcmdr("variable.list.height")
> >>>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
> >>>>>>> length(packages)),
> >>>>>>>            exportselection="FALSE",
> >>>>>>> 			selectmode="single", background="white")
> >>>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
> >>>>>>> 			command=function(...) tkyview(packageBox,
> > ...))
> >>>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
> >>>>>>> tkset(packageScroll, ...))
> >>>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
> >>>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
> >>>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
> >>>>>>> exportselection="FALSE",
> >>>>>>> 			selectmode="single", background="white")
> >>>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
> >>>>>>> 			command=function(...) tkyview(datasetBox,
> > ...))
> >>>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
> >>>>>>> tkset(datasetScroll, ...))
> >>>>>>> 	onPackageSelect <- function(){
> >>>>>>> 		assign("package",
> >>>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
> >>>>>>> 		datasets <<- data(package=package)$results[,3]
> >>>>>>> 		valid <- sapply(datasets, is.valid.name)
> >>>>>>> 		datasets <<- datasets[valid]
> >>>>>>> 		tkdelete(datasetBox, "0", "end")
> >>>>>>> 		for (dataset in datasets) tkinsert(datasetBox,
> > "end",
> >>>>>>> dataset)
> >>>>>>> 		tkconfigure(datasetBox, height=min(max.height,
> >>>>>>> length(datasets)))
> >>>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
> >>>>>>> 		len <- length(datasets)
> >>>>>>> 		onLetter <- function(letter){
> >>>>>>> 			letter <- tolower(letter)
> >>>>>>> 			current <- 1 +
> >>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
> >>>>>>> "))[1])*len)
> >>>>>>> 			mat <- match(letter,
> > firstChar[-(1:current)])
> >>>>>>> 			if (is.na(mat)) return()
> >>>>>>> 			tkyview.scroll(datasetBox, mat, "units")
> >>>>>>> 		}
> >>>>>>> 		onA <- function() onLetter("a")
> >>>>>>> 		onB <- function() onLetter("b")
> >>>>>>> 		onC <- function() onLetter("c")
> >>>>>>> 		onD <- function() onLetter("d")
> >>>>>>> 		onE <- function() onLetter("e")
> >>>>>>> 		onF <- function() onLetter("f")
> >>>>>>> 		onG <- function() onLetter("g")
> >>>>>>> 		onH <- function() onLetter("h")
> >>>>>>> 		onI <- function() onLetter("i")
> >>>>>>> 		onJ <- function() onLetter("j")
> >>>>>>> 		onK <- function() onLetter("k")
> >>>>>>> 		onL <- function() onLetter("l")
> >>>>>>> 		onM <- function() onLetter("m")
> >>>>>>> 		onN <- function() onLetter("n")
> >>>>>>> 		onO <- function() onLetter("o")
> >>>>>>> 		onP <- function() onLetter("p")
> >>>>>>> 		onQ <- function() onLetter("q")
> >>>>>>> 		onR <- function() onLetter("r")
> >>>>>>> 		onS <- function() onLetter("s")
> >>>>>>> 		onT <- function() onLetter("t")
> >>>>>>> 		onU <- function() onLetter("u")
> >>>>>>> 		onV <- function() onLetter("v")
> >>>>>>> 		onW <- function() onLetter("w")
> >>>>>>> 		onX <- function() onLetter("x")
> >>>>>>> 		onY <- function() onLetter("y")
> >>>>>>> 		onZ <- function() onLetter("z")
> >>>>>>> 		for (letter in c(letters, LETTERS)){
> >>>>>>> 			tkbind(datasetBox, paste("<", letter, ">",
> > sep=""),
> >>>>>>> 					get(paste("on",
> > toupper(letter),
> >>>>>>> sep="")))
> >>>>>>> 		}
> >>>>>>> 		onClick <- function() tkfocus(datasetBox)
> >>>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
> >>>>>>> 	}
> >>>>>>> 	onDatasetSelect <- function(){
> >>>>>>> 		tclvalue(dsname) <-
> >>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>>>> 	}
> >>>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
> >>>>>>> 	len <- length(packages)
> >>>>>>> 	onLetter <- function(letter){
> >>>>>>> 		letter <- tolower(letter)
> >>>>>>> 		current <- 1 +
> >>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
> >>>>>>> "))[1])*len)
> >>>>>>> 		mat <- match(letter, firstChar[-(1:current)])
> >>>>>>> 		if (is.na(mat)) return()
> >>>>>>> 		tkyview.scroll(packageBox, mat, "units")
> >>>>>>> 	}
> >>>>>>> 	onA <- function() onLetter("a")
> >>>>>>> 	onB <- function() onLetter("b")
> >>>>>>> 	onC <- function() onLetter("c")
> >>>>>>> 	onD <- function() onLetter("d")
> >>>>>>> 	onE <- function() onLetter("e")
> >>>>>>> 	onF <- function() onLetter("f")
> >>>>>>> 	onG <- function() onLetter("g")
> >>>>>>> 	onH <- function() onLetter("h")
> >>>>>>> 	onI <- function() onLetter("i")
> >>>>>>> 	onJ <- function() onLetter("j")
> >>>>>>> 	onK <- function() onLetter("k")
> >>>>>>> 	onL <- function() onLetter("l")
> >>>>>>> 	onM <- function() onLetter("m")
> >>>>>>> 	onN <- function() onLetter("n")
> >>>>>>> 	onO <- function() onLetter("o")
> >>>>>>> 	onP <- function() onLetter("p")
> >>>>>>> 	onQ <- function() onLetter("q")
> >>>>>>> 	onR <- function() onLetter("r")
> >>>>>>> 	onS <- function() onLetter("s")
> >>>>>>> 	onT <- function() onLetter("t")
> >>>>>>> 	onU <- function() onLetter("u")
> >>>>>>> 	onV <- function() onLetter("v")
> >>>>>>> 	onW <- function() onLetter("w")
> >>>>>>> 	onX <- function() onLetter("x")
> >>>>>>> 	onY <- function() onLetter("y")
> >>>>>>> 	onZ <- function() onLetter("z")
> >>>>>>> 	for (letter in c(letters, LETTERS)){
> >>>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
> >>>>>>> 				get(paste("on", toupper(letter),
> > sep="")))
> >>>>>>> 	}
> >>>>>>> 	onClick <- function() tkfocus(packageBox)
> >>>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
> >>>>>>> 	onOK <- function(){
> >>>>>>> 		datasetName <-
> >>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>>>> 		if (dsnameValue != "" && is.null(package)){
> >>>>>>> 			closeDialog()
> >>>>>>> 			if (is.element(dsnameValue, listDataSets()))
> > {
> >>>>>>> 				if ("no" ==
> >>>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
> >>>>>>> 					if (GrabFocus())
> > tkgrab.release(top)
> >>>>>>> 					tkdestroy(top)
> >>>>>>> 					readDataFromPackage()
> >>>>>>> 					return()
> >>>>>>> 				}
> >>>>>>> 			}
> >>>>>>> 			save.options <- options(warn=2)
> >>>>>>> 			check <-
> > try(eval(parse(text=logger(paste("data(",
> >>>>>>> dsnameValue, ")", sep=""))),
> >>>>>>>
> > envir=.GlobalEnv),
> >>>>>>> silent=TRUE)
> >>>>>>> 			options(save.options)
> >>>>>>> 			if (class(check) == "try-error"){
> >>>>>>>
> > errorCondition(recall=readDataFromPackage,
> >>>>>>>
> >>>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
> >>>>>> dsnameValue))
> >>>>>>> 				return()
> >>>>>>> 			}
> >>>>>>> 			activeDataSet(dsnameValue)
> >>>>>>> 			tkfocus(CommanderWindow())
> >>>>>>> 		}
> >>>>>>> 		else{
> >>>>>>> 			if (is.null(package)) {
> >>>>>>>
> > errorCondition(recall=readDataFromPackage,
> >>>>>>> message=gettextRcmdr("You must select a package."))
> >>>>>>> 				return()
> >>>>>>> 			}
> >>>>>>> 			if (length(datasetName) == 0) {
> >>>>>>>
> > errorCondition(recall=readDataFromPackage,
> >>>>>>> message=gettextRcmdr("You must select a data set.")    )
> >>>>>>> 				return()
> >>>>>>> 			}
> >>>>>>> 			if (is.element(datasetName, listDataSets()))
> > {
> >>>>>>> 				if ("no" ==
> >>>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
> >>>>>>> 					if (GrabFocus())
> > tkgrab.release(top)
> >>>>>>> 					tkdestroy(top)
> >>>>>>> 					readDataFromPackage()
> >>>>>>> 					return()
> >>>>>>> 				}
> >>>>>>> 			}
> >>>>>>> 			closeDialog()
> >>>>>>> 			command <- paste("data(", datasetName, ',
> >>>>>>> package="', package, '")', sep="")
> >>>>>>> 			result <- justDoIt(command)
> >>>>>>> 			logger(command)
> >>>>>>> 			if (class(result)[1] !=  "try-error")
> >>>>>>> activeDataSet(datasetName)
> >>>>>>> 			tkfocus(CommanderWindow())
> >>>>>>> 		}
> >>>>>>> 	}
> >>>>>>> 	onDataHelp <- function(){
> >>>>>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox))
> >> +
> >>>> 1]
> >>>>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
> >>>>>>> 		if (length(dsnameValue) == 0)
> > Message(gettextRcmdr("No
> >> data
> >>>>>>> set selected."), type="warning")
> >>>>>>> 		else if (is.null(package))
> > doItAndPrint(paste('help("',
> >>>>>>> dsnameValue, '")', sep=""))
> >>>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
> >>>>>>> package="', package, '")', sep=""))
> >>>>>>> 	}
> >>>>>>> 	OKCancelHelp(helpSubject="data")
> >>>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help
> > on
> >>>>>>> selected data set"), command=onDataHelp)
> >>>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame,
> >> text=gettextRcmdr("Package
> >>>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
> >>>>>>> font="RcmdrTitleFont"),
> >>>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
> >>>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set
> >> (Double-
> >>>>>> click to
> >>>>>>> select)"),
> >>>>>>> 					fg=getRcmdr("title.color"),
> >>>>>>> font="RcmdrTitleFont"), sticky="w")
> >>>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
> >>>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
> >>>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="
> >> "),
> >>>>>>> datasetFrame, sticky="nw")
> >>>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
> >>>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
> >>>>>>> sticky="w")
> >>>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name
> >> of data
> >>>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
> >>>>>> entryDsname,
> >>>>>>> sticky="w")
> >>>>>>> 	tkgrid(enterFrame, sticky="w")
> >>>>>>> 	tkgrid(dataHelpButton, sticky="w")
> >>>>>>> 	tkgrid(buttonsFrame, sticky="ew")
> >>>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
> >>>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
> >>>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>",
> > onPackageSelect)
> >>>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>",
> > onDatasetSelect)
> >>>>>>> 	dialogSuffix(focus=entryDsname)
> >>>>>>> }
> >>>>>>>
> >>>>>>> -------- snip ----------
> >>>>>>>
> >>>>>>> Any insight into the problem would be appreciated.
> >>>>>>>
> >>>>>>> Thanks,
> >>>>>>> John
> >>>>>>>
> >>>>>>> -----------------------------------------------
> >>>>>>> John Fox, Professor
> >>>>>>> McMaster University
> >>>>>>> Hamilton, Ontario, Canada
> >>>>>>> http://socserv.socsci.mcmaster.ca/jfox/
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>> ---
> >>>>>>> This email has been checked for viruses by Avast antivirus
> >> software.
> >>>>>>> https://www.avast.com/antivirus
> >>>>>>>
> >>>>>>> ______________________________________________
> >>>>>>> R-package-devel at r-project.org mailing list
> >>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>>
> >>>>>> --
> >>>>>> Peter Dalgaard, Professor,
> >>>>>> Center for Statistics, Copenhagen Business School
> >>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> >>>>>> Phone: (+45)38153501
> >>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>
> >>>>>
> >>>>>
> >>>>> ---
> >>>>> This email has been checked for viruses by Avast antivirus software.
> >>>>> https://www.avast.com/antivirus
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-package-devel at r-project.org mailing list
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>
> >>>
> >>>
> >>> ---
> >>> This email has been checked for viruses by Avast antivirus software.
> >>> https://www.avast.com/antivirus
> >>>
> > 
> > 
> > ---
> > This email has been checked for viruses by Avast antivirus software.
> > https://www.avast.com/antivirus
> >


From pdalgd at gmail.com  Tue Jul 14 09:40:42 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 14 Jul 2015 09:40:42 +0200
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <55A44332.4070900@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
Message-ID: <5750F2A3-B37A-48B7-BB56-D0955767C60F@gmail.com>

The danger of minimal examples is that you risk working around only one aspect. 

The ones Alexandra had (from the sensR package) didn't (all?) involve data(). A couple of them were like the one below, in which the FORTRANesque style of naming the function the same as the variable with the eventual return value is a bit curious, but hardly illegal.

Then again, the version of sensR that she linked to hadn't had the namespace issues sorted, so there was quite a bit of "no visible global" messages as well. 

twoAFC <- function() {
  twoAFC <- binomial()
  twoAFC$link <- "Link for the 2-AFC test"
  twoAFC$linkinv <- function(eta) {
    ok <- eta > 0
    eta[!ok] <- 0.5
    eta[ok] <- pnorm(eta[ok] / sqrt(2))
    pmin(pmax(eta, 0.5), 1) ## restrict to [0.5, 1] - just to be sure
  }
  twoAFC$mu.eta <- function(eta) {
    ok <- eta >= 0
    eta[!ok] <- 0
    if(any(ok)) {
      sqrt.2 <- sqrt(1/2)
      eta[ok] <- dnorm(eta[ok] * sqrt.2) * sqrt.2
    }
    pmax(eta, 0) ## gradient cannot be negative.
  }
  twoAFC$linkfun <- function(mu) {
    ok <- mu > 0.5 & mu < 1
    mu[mu <= 0.5] <- 0
    mu[mu >= 1] <- Inf
    mu[ok] <- sqrt(2) * qnorm(mu[ok])
    pmax(mu, 0) ## delta cannot be negative
  }
  twoAFC
}

-pd

(In a hotel room in Aarhus, so not going to spend time on this for a couple of days.)


> On 14 Jul 2015, at 01:01 , Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> It happened in r68597.  In my example, I hadn't imported the data()
> function from utils; when I did that, it was fixed.
> 
> Not sure why the error is complaining about the envir argument.
> 
> Duncan Murdoch
> 
> On 13/07/2015 6:47 PM, John Fox wrote:
>> Dear Duncan and Peter,
>> 
>> I've just arrived at more or less the same thing:
>> 
>> 	foo <- function() data(package="MASS")
>> 
>> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
>> 
>> 	baz <- function() data(package="MASS", envir=globalenv())
>> 
>> all trigger the note when included with the Rcmdr sources:
>> 
>> 	* checking R code for possible problems ... NOTE
>> 	bar: Error while checking: invalid 'envir' argument
>> 	baz: Error while checking: invalid 'envir' argument
>> 	foo: Error while checking: invalid 'envir' argument 
>> 
>> The envir argument to data() defaults to .GlobaEnv .
>> 
>> I hope this helps,
>> John
>> 
>>> -----Original Message-----
>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>> Sent: July-13-15 6:32 PM
>>> To: John Fox; 'peter dalgaard'
>>> Cc: r-package-devel at r-project.org
>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
>>> 
>>> On 13/07/2015 5:23 PM, John Fox wrote:
>>>> Dear Peter,
>>>> 
>>>>> -----Original Message-----
>>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
>>>>> Sent: July-13-15 4:52 PM
>>>>> To: John Fox
>>>>> Cc: r-package-devel at r-project.org
>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
>>> devel
>>>>> 
>>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
>>> days
>>>> 
>>>> Sorry, I didn't notice that.
>>>> 
>>>>> ago. Look unintentional, but it is not easy to spot what triggers it.
>>> If
>>>>> someone could cook up a minimal example, or - maybe easier given the
>>>>> relatively short timeframe - bisect their way to the exact svn
>>> revision
>>>>> that triggered it, it might help in getting it fixed.
>>>> 
>>>> I'm afraid that I'm not set up to build R-devel and I'm about to leave
>>> town
>>>> for three weeks. I'll see if I can produce a simpler example
>>> triggering the
>>>> error, however.
>>> 
>>> Hana Sevcikova posted a simple example.  I'll bisect on it.
>>> 
>>> Here's her example:
>>> 
>>> e <- new.env()
>>> data("mydataset", envir=e)
>>> 
>>> I've substituted USArrests for "mydataset".
>>> 
>>> Duncan Murdoch
>>> 
>>>> 
>>>> Thanks for this,
>>>> John
>>>> 
>>>>> 
>>>>> -pd
>>>>> 
>>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
>>>>>> 
>>>>>> Dear list members,
>>>>>> 
>>>>>> I'm getting a new note from R-devel that I haven't seen before when
>>>>> checking
>>>>>> the development version of the Rcmdr package:
>>>>>> 
>>>>>> 	* checking R code for possible problems ... NOTE
>>>>>> 	readDataFromPackage: Error while checking: invalid 'envir' argument
>>>>>> 
>>>>>> This note doesn't appear in R 3.2.1.
>>>>>> 
>>>>>> My session info:
>>>>>> 
>>>>>> -------- snip ----------
>>>>>> 
>>>>>> R Under development (unstable) (2015-07-12 r68650)
>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>> 
>>>>>> locale:
>>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
>>>>>> LC_MONETARY=English_Canada.1252
>>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
>>>>>> 
>>>>>> attached base packages:
>>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>> 
>>>>>> loaded via a namespace (and not attached):
>>>>>> [1] tools_3.3.0
>>>>>> 
>>>>>> -------- snip ----------
>>>>>> 
>>>>>> I can't even localize the problem in readDataFromPackage(). There
>>> are
>>>>> only
>>>>>> two places in this function where there's a function call with an
>>>>> envir
>>>>>> argument, and I still get the note if I comment these out. As well,
>>>>>> readDataFromPackage() seems to work as intended -- there is no
>>> obvious
>>>>> error
>>>>>> in it.
>>>>>> 
>>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
>>>>> development
>>>>>> version of the Rcmdr package are on R-Forge.
>>>>>> 
>>>>>> -------- snip ----------
>>>>>> 
>>>>>> readDataFromPackage <- function() {
>>>>>> 	env <- environment()
>>>>>> 	datasets <- NULL
>>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From Package"))
>>>>>> 	dsname <- tclVar("")
>>>>>> 	package <- NULL
>>>>>> 	enterFrame <- tkframe(top)
>>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
>>>>> textvariable=dsname)
>>>>>> 	packages <- sort(.packages())
>>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
>>>>>> 	packages <- packages[sapply(packages, function(package){
>>>>>> 						ds <-
>>>>>> data(package=package)$results
>>>>>> 						if (nrow(ds) == 0)
>>>>>> return(FALSE)
>>>>>> 						ds <- ds[, "Item"]
>>>>>> 						valid <- sapply(ds,
>>>>>> is.valid.name)
>>>>>> 						length(ds[valid]) > 0
>>>>>> 					})]
>>>>>> 	packageDatasetFrame <- tkframe(top)
>>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
>>>>>> 	max.height <- getRcmdr("variable.list.height")
>>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
>>>>>> length(packages)),
>>>>>>           exportselection="FALSE",
>>>>>> 			selectmode="single", background="white")
>>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
>>>>>> 			command=function(...) tkyview(packageBox, ...))
>>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
>>>>>> tkset(packageScroll, ...))
>>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
>>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
>>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
>>>>>> exportselection="FALSE",
>>>>>> 			selectmode="single", background="white")
>>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
>>>>>> 			command=function(...) tkyview(datasetBox, ...))
>>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
>>>>>> tkset(datasetScroll, ...))
>>>>>> 	onPackageSelect <- function(){
>>>>>> 		assign("package",
>>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
>>>>>> 		datasets <<- data(package=package)$results[,3]
>>>>>> 		valid <- sapply(datasets, is.valid.name)
>>>>>> 		datasets <<- datasets[valid]
>>>>>> 		tkdelete(datasetBox, "0", "end")
>>>>>> 		for (dataset in datasets) tkinsert(datasetBox, "end",
>>>>>> dataset)
>>>>>> 		tkconfigure(datasetBox, height=min(max.height,
>>>>>> length(datasets)))
>>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
>>>>>> 		len <- length(datasets)
>>>>>> 		onLetter <- function(letter){
>>>>>> 			letter <- tolower(letter)
>>>>>> 			current <- 1 +
>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
>>>>>> "))[1])*len)
>>>>>> 			mat <- match(letter, firstChar[-(1:current)])
>>>>>> 			if (is.na(mat)) return()
>>>>>> 			tkyview.scroll(datasetBox, mat, "units")
>>>>>> 		}
>>>>>> 		onA <- function() onLetter("a")
>>>>>> 		onB <- function() onLetter("b")
>>>>>> 		onC <- function() onLetter("c")
>>>>>> 		onD <- function() onLetter("d")
>>>>>> 		onE <- function() onLetter("e")
>>>>>> 		onF <- function() onLetter("f")
>>>>>> 		onG <- function() onLetter("g")
>>>>>> 		onH <- function() onLetter("h")
>>>>>> 		onI <- function() onLetter("i")
>>>>>> 		onJ <- function() onLetter("j")
>>>>>> 		onK <- function() onLetter("k")
>>>>>> 		onL <- function() onLetter("l")
>>>>>> 		onM <- function() onLetter("m")
>>>>>> 		onN <- function() onLetter("n")
>>>>>> 		onO <- function() onLetter("o")
>>>>>> 		onP <- function() onLetter("p")
>>>>>> 		onQ <- function() onLetter("q")
>>>>>> 		onR <- function() onLetter("r")
>>>>>> 		onS <- function() onLetter("s")
>>>>>> 		onT <- function() onLetter("t")
>>>>>> 		onU <- function() onLetter("u")
>>>>>> 		onV <- function() onLetter("v")
>>>>>> 		onW <- function() onLetter("w")
>>>>>> 		onX <- function() onLetter("x")
>>>>>> 		onY <- function() onLetter("y")
>>>>>> 		onZ <- function() onLetter("z")
>>>>>> 		for (letter in c(letters, LETTERS)){
>>>>>> 			tkbind(datasetBox, paste("<", letter, ">", sep=""),
>>>>>> 					get(paste("on", toupper(letter),
>>>>>> sep="")))
>>>>>> 		}
>>>>>> 		onClick <- function() tkfocus(datasetBox)
>>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
>>>>>> 	}
>>>>>> 	onDatasetSelect <- function(){
>>>>>> 		tclvalue(dsname) <-
>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>> 	}
>>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
>>>>>> 	len <- length(packages)
>>>>>> 	onLetter <- function(letter){
>>>>>> 		letter <- tolower(letter)
>>>>>> 		current <- 1 +
>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
>>>>>> "))[1])*len)
>>>>>> 		mat <- match(letter, firstChar[-(1:current)])
>>>>>> 		if (is.na(mat)) return()
>>>>>> 		tkyview.scroll(packageBox, mat, "units")
>>>>>> 	}
>>>>>> 	onA <- function() onLetter("a")
>>>>>> 	onB <- function() onLetter("b")
>>>>>> 	onC <- function() onLetter("c")
>>>>>> 	onD <- function() onLetter("d")
>>>>>> 	onE <- function() onLetter("e")
>>>>>> 	onF <- function() onLetter("f")
>>>>>> 	onG <- function() onLetter("g")
>>>>>> 	onH <- function() onLetter("h")
>>>>>> 	onI <- function() onLetter("i")
>>>>>> 	onJ <- function() onLetter("j")
>>>>>> 	onK <- function() onLetter("k")
>>>>>> 	onL <- function() onLetter("l")
>>>>>> 	onM <- function() onLetter("m")
>>>>>> 	onN <- function() onLetter("n")
>>>>>> 	onO <- function() onLetter("o")
>>>>>> 	onP <- function() onLetter("p")
>>>>>> 	onQ <- function() onLetter("q")
>>>>>> 	onR <- function() onLetter("r")
>>>>>> 	onS <- function() onLetter("s")
>>>>>> 	onT <- function() onLetter("t")
>>>>>> 	onU <- function() onLetter("u")
>>>>>> 	onV <- function() onLetter("v")
>>>>>> 	onW <- function() onLetter("w")
>>>>>> 	onX <- function() onLetter("x")
>>>>>> 	onY <- function() onLetter("y")
>>>>>> 	onZ <- function() onLetter("z")
>>>>>> 	for (letter in c(letters, LETTERS)){
>>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
>>>>>> 				get(paste("on", toupper(letter), sep="")))
>>>>>> 	}
>>>>>> 	onClick <- function() tkfocus(packageBox)
>>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
>>>>>> 	onOK <- function(){
>>>>>> 		datasetName <-
>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>> 		if (dsnameValue != "" && is.null(package)){
>>>>>> 			closeDialog()
>>>>>> 			if (is.element(dsnameValue, listDataSets())) {
>>>>>> 				if ("no" ==
>>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
>>>>>> 					if (GrabFocus()) tkgrab.release(top)
>>>>>> 					tkdestroy(top)
>>>>>> 					readDataFromPackage()
>>>>>> 					return()
>>>>>> 				}
>>>>>> 			}
>>>>>> 			save.options <- options(warn=2)
>>>>>> 			check <- try(eval(parse(text=logger(paste("data(",
>>>>>> dsnameValue, ")", sep=""))),
>>>>>> 							envir=.GlobalEnv),
>>>>>> silent=TRUE)
>>>>>> 			options(save.options)
>>>>>> 			if (class(check) == "try-error"){
>>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>>> 
>>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
>>>>> dsnameValue))
>>>>>> 				return()
>>>>>> 			}
>>>>>> 			activeDataSet(dsnameValue)
>>>>>> 			tkfocus(CommanderWindow())
>>>>>> 		}
>>>>>> 		else{
>>>>>> 			if (is.null(package)) {
>>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>>> message=gettextRcmdr("You must select a package."))
>>>>>> 				return()
>>>>>> 			}
>>>>>> 			if (length(datasetName) == 0) {
>>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>>> message=gettextRcmdr("You must select a data set.")    )
>>>>>> 				return()
>>>>>> 			}
>>>>>> 			if (is.element(datasetName, listDataSets())) {
>>>>>> 				if ("no" ==
>>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
>>>>>> 					if (GrabFocus()) tkgrab.release(top)
>>>>>> 					tkdestroy(top)
>>>>>> 					readDataFromPackage()
>>>>>> 					return()
>>>>>> 				}
>>>>>> 			}
>>>>>> 			closeDialog()
>>>>>> 			command <- paste("data(", datasetName, ',
>>>>>> package="', package, '")', sep="")
>>>>>> 			result <- justDoIt(command)
>>>>>> 			logger(command)
>>>>>> 			if (class(result)[1] !=  "try-error")
>>>>>> activeDataSet(datasetName)
>>>>>> 			tkfocus(CommanderWindow())
>>>>>> 		}
>>>>>> 	}
>>>>>> 	onDataHelp <- function(){
>>>>>>   datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) +
>>> 1]
>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
>>>>>> 		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
>>>>>> set selected."), type="warning")
>>>>>> 		else if (is.null(package)) doItAndPrint(paste('help("',
>>>>>> dsnameValue, '")', sep=""))
>>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
>>>>>> package="', package, '")', sep=""))
>>>>>> 	}
>>>>>> 	OKCancelHelp(helpSubject="data")
>>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
>>>>>> selected data set"), command=onDataHelp)
>>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
>>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
>>>>>> font="RcmdrTitleFont"),
>>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
>>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-
>>>>> click to
>>>>>> select)"),
>>>>>> 					fg=getRcmdr("title.color"),
>>>>>> font="RcmdrTitleFont"), sticky="w")
>>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
>>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
>>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
>>>>>> datasetFrame, sticky="nw")
>>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
>>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
>>>>>> sticky="w")
>>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
>>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
>>>>> entryDsname,
>>>>>> sticky="w")
>>>>>> 	tkgrid(enterFrame, sticky="w")
>>>>>> 	tkgrid(dataHelpButton, sticky="w")
>>>>>> 	tkgrid(buttonsFrame, sticky="ew")
>>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
>>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
>>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
>>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
>>>>>> 	dialogSuffix(focus=entryDsname)
>>>>>> }
>>>>>> 
>>>>>> -------- snip ----------
>>>>>> 
>>>>>> Any insight into the problem would be appreciated.
>>>>>> 
>>>>>> Thanks,
>>>>>> John
>>>>>> 
>>>>>> -----------------------------------------------
>>>>>> John Fox, Professor
>>>>>> McMaster University
>>>>>> Hamilton, Ontario, Canada
>>>>>> http://socserv.socsci.mcmaster.ca/jfox/
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> ---
>>>>>> This email has been checked for viruses by Avast antivirus software.
>>>>>> https://www.avast.com/antivirus
>>>>>> 
>>>>>> ______________________________________________
>>>>>> R-package-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>> 
>>>>> --
>>>>> Peter Dalgaard, Professor,
>>>>> Center for Statistics, Copenhagen Business School
>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>>> Phone: (+45)38153501
>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>> 
>>>> 
>>>> 
>>>> ---
>>>> This email has been checked for viruses by Avast antivirus software.
>>>> https://www.avast.com/antivirus
>>>> 
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>> 
>> 
>> 
>> ---
>> This email has been checked for viruses by Avast antivirus software.
>> https://www.avast.com/antivirus
>> 
> 

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From murdoch.duncan at gmail.com  Tue Jul 14 13:22:21 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 14 Jul 2015 07:22:21 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <web-565446548@cgpsrv2.cis.mcmaster.ca>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
	<004801d0bdc4$a1313260$e3939720$@mcmaster.ca>
	<55A45102.7070401@gmail.com>
	<web-565446548@cgpsrv2.cis.mcmaster.ca>
Message-ID: <55A4F0ED.8070708@gmail.com>

On 13/07/2015 9:42 PM, John Fox wrote:
> Dear Duncan,
> 
> On Mon, 13 Jul 2015 20:00:02 -0400
>  Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 13/07/2015 7:35 PM, John Fox wrote:
>>> Dear Duncan,
>>>
>>>> -----Original Message-----
>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>> Sent: July-13-15 7:01 PM
>>>> To: John Fox; 'peter dalgaard'
>>>> Cc: r-package-devel at r-project.org
>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
>>>>
>>>> It happened in r68597.  In my example, I hadn't imported the data()
>>>> function from utils; when I did that, it was fixed.
>>>>
>>>> Not sure why the error is complaining about the envir argument.
>>>
>>>
>>> Yes, importing data works for me too! It's odd that the problem didn't show
>>> up as an undefined global symbol rather than as a note about the envir
>>> argument. (I was fixing imports from standard packages when the problem
>>> arose.)
>>
>> I'd guess that it's finding some other private function called data();
>> that's probably worth fixing.
> 
> If you mean an unexported function named data() in the Rcmdr package, then I'm pretty sure that there is none -- and I just checked all of the many uses of the word "data" in the Rcmdr sources. Of course, I may have missed something or, more likely, misunderstood what you're suggesting.

I tracked it down to a bug in codetools.  The "envir" it is talking
about is an argument to a different function, nothing to do with the
argument to data().

I've passed it on to Luke Tierney, author of codetools.

Duncan Murdoch

> Best,
>  John
> 
>>
>> Duncan
>>
>>>
>>> Thanks for tracking this down.
>>>
>>> John
>>>
>>>>
>>>> Duncan Murdoch
>>>>
>>>> On 13/07/2015 6:47 PM, John Fox wrote:
>>>>> Dear Duncan and Peter,
>>>>>
>>>>> I've just arrived at more or less the same thing:
>>>>>
>>>>> 	foo <- function() data(package="MASS")
>>>>>
>>>>> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
>>>>>
>>>>> 	baz <- function() data(package="MASS", envir=globalenv())
>>>>>
>>>>> all trigger the note when included with the Rcmdr sources:
>>>>>
>>>>> 	* checking R code for possible problems ... NOTE
>>>>> 	bar: Error while checking: invalid 'envir' argument
>>>>> 	baz: Error while checking: invalid 'envir' argument
>>>>> 	foo: Error while checking: invalid 'envir' argument
>>>>>
>>>>> The envir argument to data() defaults to .GlobaEnv .
>>>>>
>>>>> I hope this helps,
>>>>>  John
>>>>>
>>>>>> -----Original Message-----
>>>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>>>> Sent: July-13-15 6:32 PM
>>>>>> To: John Fox; 'peter dalgaard'
>>>>>> Cc: r-package-devel at r-project.org
>>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
>>>> devel
>>>>>>
>>>>>> On 13/07/2015 5:23 PM, John Fox wrote:
>>>>>>> Dear Peter,
>>>>>>>
>>>>>>>> -----Original Message-----
>>>>>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
>>>>>>>> Sent: July-13-15 4:52 PM
>>>>>>>> To: John Fox
>>>>>>>> Cc: r-package-devel at r-project.org
>>>>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
>>>>>> devel
>>>>>>>>
>>>>>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
>>>>>> days
>>>>>>>
>>>>>>> Sorry, I didn't notice that.
>>>>>>>
>>>>>>>> ago. Look unintentional, but it is not easy to spot what triggers
>>>> it.
>>>>>> If
>>>>>>>> someone could cook up a minimal example, or - maybe easier given
>>>> the
>>>>>>>> relatively short timeframe - bisect their way to the exact svn
>>>>>> revision
>>>>>>>> that triggered it, it might help in getting it fixed.
>>>>>>>
>>>>>>> I'm afraid that I'm not set up to build R-devel and I'm about to
>>>> leave
>>>>>> town
>>>>>>> for three weeks. I'll see if I can produce a simpler example
>>>>>> triggering the
>>>>>>> error, however.
>>>>>>
>>>>>> Hana Sevcikova posted a simple example.  I'll bisect on it.
>>>>>>
>>>>>> Here's her example:
>>>>>>
>>>>>> e <- new.env()
>>>>>> data("mydataset", envir=e)
>>>>>>
>>>>>> I've substituted USArrests for "mydataset".
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>>
>>>>>>> Thanks for this,
>>>>>>>  John
>>>>>>>
>>>>>>>>
>>>>>>>> -pd
>>>>>>>>
>>>>>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
>>>>>>>>>
>>>>>>>>> Dear list members,
>>>>>>>>>
>>>>>>>>> I'm getting a new note from R-devel that I haven't seen before
>>>> when
>>>>>>>> checking
>>>>>>>>> the development version of the Rcmdr package:
>>>>>>>>>
>>>>>>>>> 	* checking R code for possible problems ... NOTE
>>>>>>>>> 	readDataFromPackage: Error while checking: invalid 'envir'
>>>> argument
>>>>>>>>>
>>>>>>>>> This note doesn't appear in R 3.2.1.
>>>>>>>>>
>>>>>>>>> My session info:
>>>>>>>>>
>>>>>>>>> -------- snip ----------
>>>>>>>>>
>>>>>>>>> R Under development (unstable) (2015-07-12 r68650)
>>>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>>>
>>>>>>>>> locale:
>>>>>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
>>>>>>>>> LC_MONETARY=English_Canada.1252
>>>>>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
>>>>>>>>>
>>>>>>>>> attached base packages:
>>>>>>>>> [1] stats     graphics  grDevices utils     datasets  methods
>>>> base
>>>>>>>>>
>>>>>>>>> loaded via a namespace (and not attached):
>>>>>>>>> [1] tools_3.3.0
>>>>>>>>>
>>>>>>>>> -------- snip ----------
>>>>>>>>>
>>>>>>>>> I can't even localize the problem in readDataFromPackage(). There
>>>>>> are
>>>>>>>> only
>>>>>>>>> two places in this function where there's a function call with an
>>>>>>>> envir
>>>>>>>>> argument, and I still get the note if I comment these out. As
>>>> well,
>>>>>>>>> readDataFromPackage() seems to work as intended -- there is no
>>>>>> obvious
>>>>>>>> error
>>>>>>>>> in it.
>>>>>>>>>
>>>>>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
>>>>>>>> development
>>>>>>>>> version of the Rcmdr package are on R-Forge.
>>>>>>>>>
>>>>>>>>> -------- snip ----------
>>>>>>>>>
>>>>>>>>> readDataFromPackage <- function() {
>>>>>>>>> 	env <- environment()
>>>>>>>>> 	datasets <- NULL
>>>>>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From
>>>> Package"))
>>>>>>>>> 	dsname <- tclVar("")
>>>>>>>>> 	package <- NULL
>>>>>>>>> 	enterFrame <- tkframe(top)
>>>>>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
>>>>>>>> textvariable=dsname)
>>>>>>>>> 	packages <- sort(.packages())
>>>>>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
>>>>>>>>> 	packages <- packages[sapply(packages, function(package){
>>>>>>>>> 						ds <-
>>>>>>>>> data(package=package)$results
>>>>>>>>> 						if (nrow(ds) == 0)
>>>>>>>>> return(FALSE)
>>>>>>>>> 						ds <- ds[, "Item"]
>>>>>>>>> 						valid <- sapply(ds,
>>>>>>>>> is.valid.name)
>>>>>>>>> 						length(ds[valid]) >
>>> 0
>>>>>>>>> 					})]
>>>>>>>>> 	packageDatasetFrame <- tkframe(top)
>>>>>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
>>>>>>>>> 	max.height <- getRcmdr("variable.list.height")
>>>>>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
>>>>>>>>> length(packages)),
>>>>>>>>>            exportselection="FALSE",
>>>>>>>>> 			selectmode="single", background="white")
>>>>>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
>>>>>>>>> 			command=function(...) tkyview(packageBox,
>>> ...))
>>>>>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
>>>>>>>>> tkset(packageScroll, ...))
>>>>>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
>>>>>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
>>>>>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
>>>>>>>>> exportselection="FALSE",
>>>>>>>>> 			selectmode="single", background="white")
>>>>>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
>>>>>>>>> 			command=function(...) tkyview(datasetBox,
>>> ...))
>>>>>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
>>>>>>>>> tkset(datasetScroll, ...))
>>>>>>>>> 	onPackageSelect <- function(){
>>>>>>>>> 		assign("package",
>>>>>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
>>>>>>>>> 		datasets <<- data(package=package)$results[,3]
>>>>>>>>> 		valid <- sapply(datasets, is.valid.name)
>>>>>>>>> 		datasets <<- datasets[valid]
>>>>>>>>> 		tkdelete(datasetBox, "0", "end")
>>>>>>>>> 		for (dataset in datasets) tkinsert(datasetBox,
>>> "end",
>>>>>>>>> dataset)
>>>>>>>>> 		tkconfigure(datasetBox, height=min(max.height,
>>>>>>>>> length(datasets)))
>>>>>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
>>>>>>>>> 		len <- length(datasets)
>>>>>>>>> 		onLetter <- function(letter){
>>>>>>>>> 			letter <- tolower(letter)
>>>>>>>>> 			current <- 1 +
>>>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
>>>>>>>>> "))[1])*len)
>>>>>>>>> 			mat <- match(letter,
>>> firstChar[-(1:current)])
>>>>>>>>> 			if (is.na(mat)) return()
>>>>>>>>> 			tkyview.scroll(datasetBox, mat, "units")
>>>>>>>>> 		}
>>>>>>>>> 		onA <- function() onLetter("a")
>>>>>>>>> 		onB <- function() onLetter("b")
>>>>>>>>> 		onC <- function() onLetter("c")
>>>>>>>>> 		onD <- function() onLetter("d")
>>>>>>>>> 		onE <- function() onLetter("e")
>>>>>>>>> 		onF <- function() onLetter("f")
>>>>>>>>> 		onG <- function() onLetter("g")
>>>>>>>>> 		onH <- function() onLetter("h")
>>>>>>>>> 		onI <- function() onLetter("i")
>>>>>>>>> 		onJ <- function() onLetter("j")
>>>>>>>>> 		onK <- function() onLetter("k")
>>>>>>>>> 		onL <- function() onLetter("l")
>>>>>>>>> 		onM <- function() onLetter("m")
>>>>>>>>> 		onN <- function() onLetter("n")
>>>>>>>>> 		onO <- function() onLetter("o")
>>>>>>>>> 		onP <- function() onLetter("p")
>>>>>>>>> 		onQ <- function() onLetter("q")
>>>>>>>>> 		onR <- function() onLetter("r")
>>>>>>>>> 		onS <- function() onLetter("s")
>>>>>>>>> 		onT <- function() onLetter("t")
>>>>>>>>> 		onU <- function() onLetter("u")
>>>>>>>>> 		onV <- function() onLetter("v")
>>>>>>>>> 		onW <- function() onLetter("w")
>>>>>>>>> 		onX <- function() onLetter("x")
>>>>>>>>> 		onY <- function() onLetter("y")
>>>>>>>>> 		onZ <- function() onLetter("z")
>>>>>>>>> 		for (letter in c(letters, LETTERS)){
>>>>>>>>> 			tkbind(datasetBox, paste("<", letter, ">",
>>> sep=""),
>>>>>>>>> 					get(paste("on",
>>> toupper(letter),
>>>>>>>>> sep="")))
>>>>>>>>> 		}
>>>>>>>>> 		onClick <- function() tkfocus(datasetBox)
>>>>>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
>>>>>>>>> 	}
>>>>>>>>> 	onDatasetSelect <- function(){
>>>>>>>>> 		tclvalue(dsname) <-
>>>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>>>>> 	}
>>>>>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
>>>>>>>>> 	len <- length(packages)
>>>>>>>>> 	onLetter <- function(letter){
>>>>>>>>> 		letter <- tolower(letter)
>>>>>>>>> 		current <- 1 +
>>>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
>>>>>>>>> "))[1])*len)
>>>>>>>>> 		mat <- match(letter, firstChar[-(1:current)])
>>>>>>>>> 		if (is.na(mat)) return()
>>>>>>>>> 		tkyview.scroll(packageBox, mat, "units")
>>>>>>>>> 	}
>>>>>>>>> 	onA <- function() onLetter("a")
>>>>>>>>> 	onB <- function() onLetter("b")
>>>>>>>>> 	onC <- function() onLetter("c")
>>>>>>>>> 	onD <- function() onLetter("d")
>>>>>>>>> 	onE <- function() onLetter("e")
>>>>>>>>> 	onF <- function() onLetter("f")
>>>>>>>>> 	onG <- function() onLetter("g")
>>>>>>>>> 	onH <- function() onLetter("h")
>>>>>>>>> 	onI <- function() onLetter("i")
>>>>>>>>> 	onJ <- function() onLetter("j")
>>>>>>>>> 	onK <- function() onLetter("k")
>>>>>>>>> 	onL <- function() onLetter("l")
>>>>>>>>> 	onM <- function() onLetter("m")
>>>>>>>>> 	onN <- function() onLetter("n")
>>>>>>>>> 	onO <- function() onLetter("o")
>>>>>>>>> 	onP <- function() onLetter("p")
>>>>>>>>> 	onQ <- function() onLetter("q")
>>>>>>>>> 	onR <- function() onLetter("r")
>>>>>>>>> 	onS <- function() onLetter("s")
>>>>>>>>> 	onT <- function() onLetter("t")
>>>>>>>>> 	onU <- function() onLetter("u")
>>>>>>>>> 	onV <- function() onLetter("v")
>>>>>>>>> 	onW <- function() onLetter("w")
>>>>>>>>> 	onX <- function() onLetter("x")
>>>>>>>>> 	onY <- function() onLetter("y")
>>>>>>>>> 	onZ <- function() onLetter("z")
>>>>>>>>> 	for (letter in c(letters, LETTERS)){
>>>>>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
>>>>>>>>> 				get(paste("on", toupper(letter),
>>> sep="")))
>>>>>>>>> 	}
>>>>>>>>> 	onClick <- function() tkfocus(packageBox)
>>>>>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
>>>>>>>>> 	onOK <- function(){
>>>>>>>>> 		datasetName <-
>>>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>>>>> 		if (dsnameValue != "" && is.null(package)){
>>>>>>>>> 			closeDialog()
>>>>>>>>> 			if (is.element(dsnameValue, listDataSets()))
>>> {
>>>>>>>>> 				if ("no" ==
>>>>>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
>>>>>>>>> 					if (GrabFocus())
>>> tkgrab.release(top)
>>>>>>>>> 					tkdestroy(top)
>>>>>>>>> 					readDataFromPackage()
>>>>>>>>> 					return()
>>>>>>>>> 				}
>>>>>>>>> 			}
>>>>>>>>> 			save.options <- options(warn=2)
>>>>>>>>> 			check <-
>>> try(eval(parse(text=logger(paste("data(",
>>>>>>>>> dsnameValue, ")", sep=""))),
>>>>>>>>>
>>> envir=.GlobalEnv),
>>>>>>>>> silent=TRUE)
>>>>>>>>> 			options(save.options)
>>>>>>>>> 			if (class(check) == "try-error"){
>>>>>>>>>
>>> errorCondition(recall=readDataFromPackage,
>>>>>>>>>
>>>>>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
>>>>>>>> dsnameValue))
>>>>>>>>> 				return()
>>>>>>>>> 			}
>>>>>>>>> 			activeDataSet(dsnameValue)
>>>>>>>>> 			tkfocus(CommanderWindow())
>>>>>>>>> 		}
>>>>>>>>> 		else{
>>>>>>>>> 			if (is.null(package)) {
>>>>>>>>>
>>> errorCondition(recall=readDataFromPackage,
>>>>>>>>> message=gettextRcmdr("You must select a package."))
>>>>>>>>> 				return()
>>>>>>>>> 			}
>>>>>>>>> 			if (length(datasetName) == 0) {
>>>>>>>>>
>>> errorCondition(recall=readDataFromPackage,
>>>>>>>>> message=gettextRcmdr("You must select a data set.")    )
>>>>>>>>> 				return()
>>>>>>>>> 			}
>>>>>>>>> 			if (is.element(datasetName, listDataSets()))
>>> {
>>>>>>>>> 				if ("no" ==
>>>>>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
>>>>>>>>> 					if (GrabFocus())
>>> tkgrab.release(top)
>>>>>>>>> 					tkdestroy(top)
>>>>>>>>> 					readDataFromPackage()
>>>>>>>>> 					return()
>>>>>>>>> 				}
>>>>>>>>> 			}
>>>>>>>>> 			closeDialog()
>>>>>>>>> 			command <- paste("data(", datasetName, ',
>>>>>>>>> package="', package, '")', sep="")
>>>>>>>>> 			result <- justDoIt(command)
>>>>>>>>> 			logger(command)
>>>>>>>>> 			if (class(result)[1] !=  "try-error")
>>>>>>>>> activeDataSet(datasetName)
>>>>>>>>> 			tkfocus(CommanderWindow())
>>>>>>>>> 		}
>>>>>>>>> 	}
>>>>>>>>> 	onDataHelp <- function(){
>>>>>>>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox))
>>>> +
>>>>>> 1]
>>>>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
>>>>>>>>> 		if (length(dsnameValue) == 0)
>>> Message(gettextRcmdr("No
>>>> data
>>>>>>>>> set selected."), type="warning")
>>>>>>>>> 		else if (is.null(package))
>>> doItAndPrint(paste('help("',
>>>>>>>>> dsnameValue, '")', sep=""))
>>>>>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
>>>>>>>>> package="', package, '")', sep=""))
>>>>>>>>> 	}
>>>>>>>>> 	OKCancelHelp(helpSubject="data")
>>>>>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help
>>> on
>>>>>>>>> selected data set"), command=onDataHelp)
>>>>>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame,
>>>> text=gettextRcmdr("Package
>>>>>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
>>>>>>>>> font="RcmdrTitleFont"),
>>>>>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
>>>>>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set
>>>> (Double-
>>>>>>>> click to
>>>>>>>>> select)"),
>>>>>>>>> 					fg=getRcmdr("title.color"),
>>>>>>>>> font="RcmdrTitleFont"), sticky="w")
>>>>>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
>>>>>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
>>>>>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="
>>>> "),
>>>>>>>>> datasetFrame, sticky="nw")
>>>>>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
>>>>>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
>>>>>>>>> sticky="w")
>>>>>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name
>>>> of data
>>>>>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
>>>>>>>> entryDsname,
>>>>>>>>> sticky="w")
>>>>>>>>> 	tkgrid(enterFrame, sticky="w")
>>>>>>>>> 	tkgrid(dataHelpButton, sticky="w")
>>>>>>>>> 	tkgrid(buttonsFrame, sticky="ew")
>>>>>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
>>>>>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
>>>>>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>",
>>> onPackageSelect)
>>>>>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>",
>>> onDatasetSelect)
>>>>>>>>> 	dialogSuffix(focus=entryDsname)
>>>>>>>>> }
>>>>>>>>>
>>>>>>>>> -------- snip ----------
>>>>>>>>>
>>>>>>>>> Any insight into the problem would be appreciated.
>>>>>>>>>
>>>>>>>>> Thanks,
>>>>>>>>> John
>>>>>>>>>
>>>>>>>>> -----------------------------------------------
>>>>>>>>> John Fox, Professor
>>>>>>>>> McMaster University
>>>>>>>>> Hamilton, Ontario, Canada
>>>>>>>>> http://socserv.socsci.mcmaster.ca/jfox/
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> ---
>>>>>>>>> This email has been checked for viruses by Avast antivirus
>>>> software.
>>>>>>>>> https://www.avast.com/antivirus
>>>>>>>>>
>>>>>>>>> ______________________________________________
>>>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>>>
>>>>>>>> --
>>>>>>>> Peter Dalgaard, Professor,
>>>>>>>> Center for Statistics, Copenhagen Business School
>>>>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>>>>>> Phone: (+45)38153501
>>>>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ---
>>>>>>> This email has been checked for viruses by Avast antivirus software.
>>>>>>> https://www.avast.com/antivirus
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>>
>>>>>
>>>>>
>>>>> ---
>>>>> This email has been checked for viruses by Avast antivirus software.
>>>>> https://www.avast.com/antivirus
>>>>>
>>>
>>>
>>> ---
>>> This email has been checked for viruses by Avast antivirus software.
>>> https://www.avast.com/antivirus
>>>
>>
> 
> ------------------------------------------------
> John Fox, Professor
> McMaster University
> Hamilton, Ontario, Canada
> http://socserv.mcmaster.ca/jfox/
> 	
> 	
> 	
>


From jfox at mcmaster.ca  Tue Jul 14 13:24:18 2015
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 14 Jul 2015 07:24:18 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <55A4F0ED.8070708@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
	<004801d0bdc4$a1313260$e3939720$@mcmaster.ca>
	<55A45102.7070401@gmail.com>
	<web-565446548@cgpsrv2.cis.mcmaster.ca>
	<55A4F0ED.8070708@gmail.com>
Message-ID: <web-565462324@cgpsrv2.cis.mcmaster.ca>

Dear Duncan,

Thank you for tracking down the source of this error.

Best,
 John

On Tue, 14 Jul 2015 07:22:21 -0400
 Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 13/07/2015 9:42 PM, John Fox wrote:
> > Dear Duncan,
> > 
> > On Mon, 13 Jul 2015 20:00:02 -0400
> >  Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> >> On 13/07/2015 7:35 PM, John Fox wrote:
> >>> Dear Duncan,
> >>>
> >>>> -----Original Message-----
> >>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >>>> Sent: July-13-15 7:01 PM
> >>>> To: John Fox; 'peter dalgaard'
> >>>> Cc: r-package-devel at r-project.org
> >>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
> >>>>
> >>>> It happened in r68597.  In my example, I hadn't imported the data()
> >>>> function from utils; when I did that, it was fixed.
> >>>>
> >>>> Not sure why the error is complaining about the envir argument.
> >>>
> >>>
> >>> Yes, importing data works for me too! It's odd that the problem didn't show
> >>> up as an undefined global symbol rather than as a note about the envir
> >>> argument. (I was fixing imports from standard packages when the problem
> >>> arose.)
> >>
> >> I'd guess that it's finding some other private function called data();
> >> that's probably worth fixing.
> > 
> > If you mean an unexported function named data() in the Rcmdr package, then I'm pretty sure that there is none -- and I just checked all of the many uses of the word "data" in the Rcmdr sources. Of course, I may have missed something or, more likely, misunderstood what you're suggesting.
> 
> I tracked it down to a bug in codetools.  The "envir" it is talking
> about is an argument to a different function, nothing to do with the
> argument to data().
> 
> I've passed it on to Luke Tierney, author of codetools.
> 
> Duncan Murdoch
> 
> > Best,
> >  John
> > 
> >>
> >> Duncan
> >>
> >>>
> >>> Thanks for tracking this down.
> >>>
> >>> John
> >>>
> >>>>
> >>>> Duncan Murdoch
> >>>>
> >>>> On 13/07/2015 6:47 PM, John Fox wrote:
> >>>>> Dear Duncan and Peter,
> >>>>>
> >>>>> I've just arrived at more or less the same thing:
> >>>>>
> >>>>> 	foo <- function() data(package="MASS")
> >>>>>
> >>>>> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
> >>>>>
> >>>>> 	baz <- function() data(package="MASS", envir=globalenv())
> >>>>>
> >>>>> all trigger the note when included with the Rcmdr sources:
> >>>>>
> >>>>> 	* checking R code for possible problems ... NOTE
> >>>>> 	bar: Error while checking: invalid 'envir' argument
> >>>>> 	baz: Error while checking: invalid 'envir' argument
> >>>>> 	foo: Error while checking: invalid 'envir' argument
> >>>>>
> >>>>> The envir argument to data() defaults to .GlobaEnv .
> >>>>>
> >>>>> I hope this helps,
> >>>>>  John
> >>>>>
> >>>>>> -----Original Message-----
> >>>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >>>>>> Sent: July-13-15 6:32 PM
> >>>>>> To: John Fox; 'peter dalgaard'
> >>>>>> Cc: r-package-devel at r-project.org
> >>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> >>>> devel
> >>>>>>
> >>>>>> On 13/07/2015 5:23 PM, John Fox wrote:
> >>>>>>> Dear Peter,
> >>>>>>>
> >>>>>>>> -----Original Message-----
> >>>>>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
> >>>>>>>> Sent: July-13-15 4:52 PM
> >>>>>>>> To: John Fox
> >>>>>>>> Cc: r-package-devel at r-project.org
> >>>>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
> >>>>>> devel
> >>>>>>>>
> >>>>>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
> >>>>>> days
> >>>>>>>
> >>>>>>> Sorry, I didn't notice that.
> >>>>>>>
> >>>>>>>> ago. Look unintentional, but it is not easy to spot what triggers
> >>>> it.
> >>>>>> If
> >>>>>>>> someone could cook up a minimal example, or - maybe easier given
> >>>> the
> >>>>>>>> relatively short timeframe - bisect their way to the exact svn
> >>>>>> revision
> >>>>>>>> that triggered it, it might help in getting it fixed.
> >>>>>>>
> >>>>>>> I'm afraid that I'm not set up to build R-devel and I'm about to
> >>>> leave
> >>>>>> town
> >>>>>>> for three weeks. I'll see if I can produce a simpler example
> >>>>>> triggering the
> >>>>>>> error, however.
> >>>>>>
> >>>>>> Hana Sevcikova posted a simple example.  I'll bisect on it.
> >>>>>>
> >>>>>> Here's her example:
> >>>>>>
> >>>>>> e <- new.env()
> >>>>>> data("mydataset", envir=e)
> >>>>>>
> >>>>>> I've substituted USArrests for "mydataset".
> >>>>>>
> >>>>>> Duncan Murdoch
> >>>>>>
> >>>>>>>
> >>>>>>> Thanks for this,
> >>>>>>>  John
> >>>>>>>
> >>>>>>>>
> >>>>>>>> -pd
> >>>>>>>>
> >>>>>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
> >>>>>>>>>
> >>>>>>>>> Dear list members,
> >>>>>>>>>
> >>>>>>>>> I'm getting a new note from R-devel that I haven't seen before
> >>>> when
> >>>>>>>> checking
> >>>>>>>>> the development version of the Rcmdr package:
> >>>>>>>>>
> >>>>>>>>> 	* checking R code for possible problems ... NOTE
> >>>>>>>>> 	readDataFromPackage: Error while checking: invalid 'envir'
> >>>> argument
> >>>>>>>>>
> >>>>>>>>> This note doesn't appear in R 3.2.1.
> >>>>>>>>>
> >>>>>>>>> My session info:
> >>>>>>>>>
> >>>>>>>>> -------- snip ----------
> >>>>>>>>>
> >>>>>>>>> R Under development (unstable) (2015-07-12 r68650)
> >>>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
> >>>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
> >>>>>>>>>
> >>>>>>>>> locale:
> >>>>>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
> >>>>>>>>> LC_MONETARY=English_Canada.1252
> >>>>>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
> >>>>>>>>>
> >>>>>>>>> attached base packages:
> >>>>>>>>> [1] stats     graphics  grDevices utils     datasets  methods
> >>>> base
> >>>>>>>>>
> >>>>>>>>> loaded via a namespace (and not attached):
> >>>>>>>>> [1] tools_3.3.0
> >>>>>>>>>
> >>>>>>>>> -------- snip ----------
> >>>>>>>>>
> >>>>>>>>> I can't even localize the problem in readDataFromPackage(). There
> >>>>>> are
> >>>>>>>> only
> >>>>>>>>> two places in this function where there's a function call with an
> >>>>>>>> envir
> >>>>>>>>> argument, and I still get the note if I comment these out. As
> >>>> well,
> >>>>>>>>> readDataFromPackage() seems to work as intended -- there is no
> >>>>>> obvious
> >>>>>>>> error
> >>>>>>>>> in it.
> >>>>>>>>>
> >>>>>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
> >>>>>>>> development
> >>>>>>>>> version of the Rcmdr package are on R-Forge.
> >>>>>>>>>
> >>>>>>>>> -------- snip ----------
> >>>>>>>>>
> >>>>>>>>> readDataFromPackage <- function() {
> >>>>>>>>> 	env <- environment()
> >>>>>>>>> 	datasets <- NULL
> >>>>>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From
> >>>> Package"))
> >>>>>>>>> 	dsname <- tclVar("")
> >>>>>>>>> 	package <- NULL
> >>>>>>>>> 	enterFrame <- tkframe(top)
> >>>>>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
> >>>>>>>> textvariable=dsname)
> >>>>>>>>> 	packages <- sort(.packages())
> >>>>>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
> >>>>>>>>> 	packages <- packages[sapply(packages, function(package){
> >>>>>>>>> 						ds <-
> >>>>>>>>> data(package=package)$results
> >>>>>>>>> 						if (nrow(ds) == 0)
> >>>>>>>>> return(FALSE)
> >>>>>>>>> 						ds <- ds[, "Item"]
> >>>>>>>>> 						valid <- sapply(ds,
> >>>>>>>>> is.valid.name)
> >>>>>>>>> 						length(ds[valid]) >
> >>> 0
> >>>>>>>>> 					})]
> >>>>>>>>> 	packageDatasetFrame <- tkframe(top)
> >>>>>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
> >>>>>>>>> 	max.height <- getRcmdr("variable.list.height")
> >>>>>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
> >>>>>>>>> length(packages)),
> >>>>>>>>>            exportselection="FALSE",
> >>>>>>>>> 			selectmode="single", background="white")
> >>>>>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
> >>>>>>>>> 			command=function(...) tkyview(packageBox,
> >>> ...))
> >>>>>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
> >>>>>>>>> tkset(packageScroll, ...))
> >>>>>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
> >>>>>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
> >>>>>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
> >>>>>>>>> exportselection="FALSE",
> >>>>>>>>> 			selectmode="single", background="white")
> >>>>>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
> >>>>>>>>> 			command=function(...) tkyview(datasetBox,
> >>> ...))
> >>>>>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
> >>>>>>>>> tkset(datasetScroll, ...))
> >>>>>>>>> 	onPackageSelect <- function(){
> >>>>>>>>> 		assign("package",
> >>>>>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
> >>>>>>>>> 		datasets <<- data(package=package)$results[,3]
> >>>>>>>>> 		valid <- sapply(datasets, is.valid.name)
> >>>>>>>>> 		datasets <<- datasets[valid]
> >>>>>>>>> 		tkdelete(datasetBox, "0", "end")
> >>>>>>>>> 		for (dataset in datasets) tkinsert(datasetBox,
> >>> "end",
> >>>>>>>>> dataset)
> >>>>>>>>> 		tkconfigure(datasetBox, height=min(max.height,
> >>>>>>>>> length(datasets)))
> >>>>>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
> >>>>>>>>> 		len <- length(datasets)
> >>>>>>>>> 		onLetter <- function(letter){
> >>>>>>>>> 			letter <- tolower(letter)
> >>>>>>>>> 			current <- 1 +
> >>>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
> >>>>>>>>> "))[1])*len)
> >>>>>>>>> 			mat <- match(letter,
> >>> firstChar[-(1:current)])
> >>>>>>>>> 			if (is.na(mat)) return()
> >>>>>>>>> 			tkyview.scroll(datasetBox, mat, "units")
> >>>>>>>>> 		}
> >>>>>>>>> 		onA <- function() onLetter("a")
> >>>>>>>>> 		onB <- function() onLetter("b")
> >>>>>>>>> 		onC <- function() onLetter("c")
> >>>>>>>>> 		onD <- function() onLetter("d")
> >>>>>>>>> 		onE <- function() onLetter("e")
> >>>>>>>>> 		onF <- function() onLetter("f")
> >>>>>>>>> 		onG <- function() onLetter("g")
> >>>>>>>>> 		onH <- function() onLetter("h")
> >>>>>>>>> 		onI <- function() onLetter("i")
> >>>>>>>>> 		onJ <- function() onLetter("j")
> >>>>>>>>> 		onK <- function() onLetter("k")
> >>>>>>>>> 		onL <- function() onLetter("l")
> >>>>>>>>> 		onM <- function() onLetter("m")
> >>>>>>>>> 		onN <- function() onLetter("n")
> >>>>>>>>> 		onO <- function() onLetter("o")
> >>>>>>>>> 		onP <- function() onLetter("p")
> >>>>>>>>> 		onQ <- function() onLetter("q")
> >>>>>>>>> 		onR <- function() onLetter("r")
> >>>>>>>>> 		onS <- function() onLetter("s")
> >>>>>>>>> 		onT <- function() onLetter("t")
> >>>>>>>>> 		onU <- function() onLetter("u")
> >>>>>>>>> 		onV <- function() onLetter("v")
> >>>>>>>>> 		onW <- function() onLetter("w")
> >>>>>>>>> 		onX <- function() onLetter("x")
> >>>>>>>>> 		onY <- function() onLetter("y")
> >>>>>>>>> 		onZ <- function() onLetter("z")
> >>>>>>>>> 		for (letter in c(letters, LETTERS)){
> >>>>>>>>> 			tkbind(datasetBox, paste("<", letter, ">",
> >>> sep=""),
> >>>>>>>>> 					get(paste("on",
> >>> toupper(letter),
> >>>>>>>>> sep="")))
> >>>>>>>>> 		}
> >>>>>>>>> 		onClick <- function() tkfocus(datasetBox)
> >>>>>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
> >>>>>>>>> 	}
> >>>>>>>>> 	onDatasetSelect <- function(){
> >>>>>>>>> 		tclvalue(dsname) <-
> >>>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>>>>>> 	}
> >>>>>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
> >>>>>>>>> 	len <- length(packages)
> >>>>>>>>> 	onLetter <- function(letter){
> >>>>>>>>> 		letter <- tolower(letter)
> >>>>>>>>> 		current <- 1 +
> >>>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
> >>>>>>>>> "))[1])*len)
> >>>>>>>>> 		mat <- match(letter, firstChar[-(1:current)])
> >>>>>>>>> 		if (is.na(mat)) return()
> >>>>>>>>> 		tkyview.scroll(packageBox, mat, "units")
> >>>>>>>>> 	}
> >>>>>>>>> 	onA <- function() onLetter("a")
> >>>>>>>>> 	onB <- function() onLetter("b")
> >>>>>>>>> 	onC <- function() onLetter("c")
> >>>>>>>>> 	onD <- function() onLetter("d")
> >>>>>>>>> 	onE <- function() onLetter("e")
> >>>>>>>>> 	onF <- function() onLetter("f")
> >>>>>>>>> 	onG <- function() onLetter("g")
> >>>>>>>>> 	onH <- function() onLetter("h")
> >>>>>>>>> 	onI <- function() onLetter("i")
> >>>>>>>>> 	onJ <- function() onLetter("j")
> >>>>>>>>> 	onK <- function() onLetter("k")
> >>>>>>>>> 	onL <- function() onLetter("l")
> >>>>>>>>> 	onM <- function() onLetter("m")
> >>>>>>>>> 	onN <- function() onLetter("n")
> >>>>>>>>> 	onO <- function() onLetter("o")
> >>>>>>>>> 	onP <- function() onLetter("p")
> >>>>>>>>> 	onQ <- function() onLetter("q")
> >>>>>>>>> 	onR <- function() onLetter("r")
> >>>>>>>>> 	onS <- function() onLetter("s")
> >>>>>>>>> 	onT <- function() onLetter("t")
> >>>>>>>>> 	onU <- function() onLetter("u")
> >>>>>>>>> 	onV <- function() onLetter("v")
> >>>>>>>>> 	onW <- function() onLetter("w")
> >>>>>>>>> 	onX <- function() onLetter("x")
> >>>>>>>>> 	onY <- function() onLetter("y")
> >>>>>>>>> 	onZ <- function() onLetter("z")
> >>>>>>>>> 	for (letter in c(letters, LETTERS)){
> >>>>>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
> >>>>>>>>> 				get(paste("on", toupper(letter),
> >>> sep="")))
> >>>>>>>>> 	}
> >>>>>>>>> 	onClick <- function() tkfocus(packageBox)
> >>>>>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
> >>>>>>>>> 	onOK <- function(){
> >>>>>>>>> 		datasetName <-
> >>>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
> >>>>>>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>>>>>> 		if (dsnameValue != "" && is.null(package)){
> >>>>>>>>> 			closeDialog()
> >>>>>>>>> 			if (is.element(dsnameValue, listDataSets()))
> >>> {
> >>>>>>>>> 				if ("no" ==
> >>>>>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
> >>>>>>>>> 					if (GrabFocus())
> >>> tkgrab.release(top)
> >>>>>>>>> 					tkdestroy(top)
> >>>>>>>>> 					readDataFromPackage()
> >>>>>>>>> 					return()
> >>>>>>>>> 				}
> >>>>>>>>> 			}
> >>>>>>>>> 			save.options <- options(warn=2)
> >>>>>>>>> 			check <-
> >>> try(eval(parse(text=logger(paste("data(",
> >>>>>>>>> dsnameValue, ")", sep=""))),
> >>>>>>>>>
> >>> envir=.GlobalEnv),
> >>>>>>>>> silent=TRUE)
> >>>>>>>>> 			options(save.options)
> >>>>>>>>> 			if (class(check) == "try-error"){
> >>>>>>>>>
> >>> errorCondition(recall=readDataFromPackage,
> >>>>>>>>>
> >>>>>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
> >>>>>>>> dsnameValue))
> >>>>>>>>> 				return()
> >>>>>>>>> 			}
> >>>>>>>>> 			activeDataSet(dsnameValue)
> >>>>>>>>> 			tkfocus(CommanderWindow())
> >>>>>>>>> 		}
> >>>>>>>>> 		else{
> >>>>>>>>> 			if (is.null(package)) {
> >>>>>>>>>
> >>> errorCondition(recall=readDataFromPackage,
> >>>>>>>>> message=gettextRcmdr("You must select a package."))
> >>>>>>>>> 				return()
> >>>>>>>>> 			}
> >>>>>>>>> 			if (length(datasetName) == 0) {
> >>>>>>>>>
> >>> errorCondition(recall=readDataFromPackage,
> >>>>>>>>> message=gettextRcmdr("You must select a data set.")    )
> >>>>>>>>> 				return()
> >>>>>>>>> 			}
> >>>>>>>>> 			if (is.element(datasetName, listDataSets()))
> >>> {
> >>>>>>>>> 				if ("no" ==
> >>>>>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
> >>>>>>>>> 					if (GrabFocus())
> >>> tkgrab.release(top)
> >>>>>>>>> 					tkdestroy(top)
> >>>>>>>>> 					readDataFromPackage()
> >>>>>>>>> 					return()
> >>>>>>>>> 				}
> >>>>>>>>> 			}
> >>>>>>>>> 			closeDialog()
> >>>>>>>>> 			command <- paste("data(", datasetName, ',
> >>>>>>>>> package="', package, '")', sep="")
> >>>>>>>>> 			result <- justDoIt(command)
> >>>>>>>>> 			logger(command)
> >>>>>>>>> 			if (class(result)[1] !=  "try-error")
> >>>>>>>>> activeDataSet(datasetName)
> >>>>>>>>> 			tkfocus(CommanderWindow())
> >>>>>>>>> 		}
> >>>>>>>>> 	}
> >>>>>>>>> 	onDataHelp <- function(){
> >>>>>>>>>    datasetName <- datasets[as.numeric(tkcurselection(datasetBox))
> >>>> +
> >>>>>> 1]
> >>>>>>>>> 		dsnameValue <- tclvalue(dsname)
> >>>>>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
> >>>>>>>>> 		if (length(dsnameValue) == 0)
> >>> Message(gettextRcmdr("No
> >>>> data
> >>>>>>>>> set selected."), type="warning")
> >>>>>>>>> 		else if (is.null(package))
> >>> doItAndPrint(paste('help("',
> >>>>>>>>> dsnameValue, '")', sep=""))
> >>>>>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
> >>>>>>>>> package="', package, '")', sep=""))
> >>>>>>>>> 	}
> >>>>>>>>> 	OKCancelHelp(helpSubject="data")
> >>>>>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help
> >>> on
> >>>>>>>>> selected data set"), command=onDataHelp)
> >>>>>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame,
> >>>> text=gettextRcmdr("Package
> >>>>>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
> >>>>>>>>> font="RcmdrTitleFont"),
> >>>>>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
> >>>>>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set
> >>>> (Double-
> >>>>>>>> click to
> >>>>>>>>> select)"),
> >>>>>>>>> 					fg=getRcmdr("title.color"),
> >>>>>>>>> font="RcmdrTitleFont"), sticky="w")
> >>>>>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
> >>>>>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
> >>>>>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="
> >>>> "),
> >>>>>>>>> datasetFrame, sticky="nw")
> >>>>>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
> >>>>>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
> >>>>>>>>> sticky="w")
> >>>>>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name
> >>>> of data
> >>>>>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
> >>>>>>>> entryDsname,
> >>>>>>>>> sticky="w")
> >>>>>>>>> 	tkgrid(enterFrame, sticky="w")
> >>>>>>>>> 	tkgrid(dataHelpButton, sticky="w")
> >>>>>>>>> 	tkgrid(buttonsFrame, sticky="ew")
> >>>>>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
> >>>>>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
> >>>>>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>",
> >>> onPackageSelect)
> >>>>>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>",
> >>> onDatasetSelect)
> >>>>>>>>> 	dialogSuffix(focus=entryDsname)
> >>>>>>>>> }
> >>>>>>>>>
> >>>>>>>>> -------- snip ----------
> >>>>>>>>>
> >>>>>>>>> Any insight into the problem would be appreciated.
> >>>>>>>>>
> >>>>>>>>> Thanks,
> >>>>>>>>> John
> >>>>>>>>>
> >>>>>>>>> -----------------------------------------------
> >>>>>>>>> John Fox, Professor
> >>>>>>>>> McMaster University
> >>>>>>>>> Hamilton, Ontario, Canada
> >>>>>>>>> http://socserv.socsci.mcmaster.ca/jfox/
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>> ---
> >>>>>>>>> This email has been checked for viruses by Avast antivirus
> >>>> software.
> >>>>>>>>> https://www.avast.com/antivirus
> >>>>>>>>>
> >>>>>>>>> ______________________________________________
> >>>>>>>>> R-package-devel at r-project.org mailing list
> >>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>>>>
> >>>>>>>> --
> >>>>>>>> Peter Dalgaard, Professor,
> >>>>>>>> Center for Statistics, Copenhagen Business School
> >>>>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> >>>>>>>> Phone: (+45)38153501
> >>>>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>> ---
> >>>>>>> This email has been checked for viruses by Avast antivirus software.
> >>>>>>> https://www.avast.com/antivirus
> >>>>>>>
> >>>>>>> ______________________________________________
> >>>>>>> R-package-devel at r-project.org mailing list
> >>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>>>
> >>>>>
> >>>>>
> >>>>> ---
> >>>>> This email has been checked for viruses by Avast antivirus software.
> >>>>> https://www.avast.com/antivirus
> >>>>>
> >>>
> >>>
> >>> ---
> >>> This email has been checked for viruses by Avast antivirus software.
> >>> https://www.avast.com/antivirus
> >>>
> >>
> > 
> > ------------------------------------------------
> > John Fox, Professor
> > McMaster University
> > Hamilton, Ontario, Canada
> > http://socserv.mcmaster.ca/jfox/
> > 	
> > 	
> > 	
> > 
>


From murdoch.duncan at gmail.com  Tue Jul 14 14:06:57 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 14 Jul 2015 08:06:57 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <5750F2A3-B37A-48B7-BB56-D0955767C60F@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
	<5750F2A3-B37A-48B7-BB56-D0955767C60F@gmail.com>
Message-ID: <55A4FB61.7030901@gmail.com>

It looks like a bug in codetools.  It handles a number of functions
specially; data() is one, binomial() is another.  I think there are some
implicit assumptions in it that stats and utils are on the search path,
but in the new tests, they aren't.

Duncan Murdoch

On 14/07/2015 3:40 AM, peter dalgaard wrote:
> The danger of minimal examples is that you risk working around only one aspect. 
> 
> The ones Alexandra had (from the sensR package) didn't (all?) involve data(). A couple of them were like the one below, in which the FORTRANesque style of naming the function the same as the variable with the eventual return value is a bit curious, but hardly illegal.
> 
> Then again, the version of sensR that she linked to hadn't had the namespace issues sorted, so there was quite a bit of "no visible global" messages as well. 
> 
> twoAFC <- function() {
>   twoAFC <- binomial()
>   twoAFC$link <- "Link for the 2-AFC test"
>   twoAFC$linkinv <- function(eta) {
>     ok <- eta > 0
>     eta[!ok] <- 0.5
>     eta[ok] <- pnorm(eta[ok] / sqrt(2))
>     pmin(pmax(eta, 0.5), 1) ## restrict to [0.5, 1] - just to be sure
>   }
>   twoAFC$mu.eta <- function(eta) {
>     ok <- eta >= 0
>     eta[!ok] <- 0
>     if(any(ok)) {
>       sqrt.2 <- sqrt(1/2)
>       eta[ok] <- dnorm(eta[ok] * sqrt.2) * sqrt.2
>     }
>     pmax(eta, 0) ## gradient cannot be negative.
>   }
>   twoAFC$linkfun <- function(mu) {
>     ok <- mu > 0.5 & mu < 1
>     mu[mu <= 0.5] <- 0
>     mu[mu >= 1] <- Inf
>     mu[ok] <- sqrt(2) * qnorm(mu[ok])
>     pmax(mu, 0) ## delta cannot be negative
>   }
>   twoAFC
> }
> 
> -pd
> 
> (In a hotel room in Aarhus, so not going to spend time on this for a couple of days.)
> 
> 
>> On 14 Jul 2015, at 01:01 , Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> It happened in r68597.  In my example, I hadn't imported the data()
>> function from utils; when I did that, it was fixed.
>>
>> Not sure why the error is complaining about the envir argument.
>>
>> Duncan Murdoch
>>
>> On 13/07/2015 6:47 PM, John Fox wrote:
>>> Dear Duncan and Peter,
>>>
>>> I've just arrived at more or less the same thing:
>>>
>>> 	foo <- function() data(package="MASS")
>>>
>>> 	bar <- function() data(package="MASS", envir=.GlobalEnv)
>>>
>>> 	baz <- function() data(package="MASS", envir=globalenv())
>>>
>>> all trigger the note when included with the Rcmdr sources:
>>>
>>> 	* checking R code for possible problems ... NOTE
>>> 	bar: Error while checking: invalid 'envir' argument
>>> 	baz: Error while checking: invalid 'envir' argument
>>> 	foo: Error while checking: invalid 'envir' argument 
>>>
>>> The envir argument to data() defaults to .GlobaEnv .
>>>
>>> I hope this helps,
>>> John
>>>
>>>> -----Original Message-----
>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>> Sent: July-13-15 6:32 PM
>>>> To: John Fox; 'peter dalgaard'
>>>> Cc: r-package-devel at r-project.org
>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
>>>>
>>>> On 13/07/2015 5:23 PM, John Fox wrote:
>>>>> Dear Peter,
>>>>>
>>>>>> -----Original Message-----
>>>>>> From: peter dalgaard [mailto:pdalgd at gmail.com]
>>>>>> Sent: July-13-15 4:52 PM
>>>>>> To: John Fox
>>>>>> Cc: r-package-devel at r-project.org
>>>>>> Subject: Re: [R-pkg-devel] "invalid 'envir' argument" note from R-
>>>> devel
>>>>>>
>>>>>> Yes, there was a similar note from Alexandra Kuznetsova a couple of
>>>> days
>>>>>
>>>>> Sorry, I didn't notice that.
>>>>>
>>>>>> ago. Look unintentional, but it is not easy to spot what triggers it.
>>>> If
>>>>>> someone could cook up a minimal example, or - maybe easier given the
>>>>>> relatively short timeframe - bisect their way to the exact svn
>>>> revision
>>>>>> that triggered it, it might help in getting it fixed.
>>>>>
>>>>> I'm afraid that I'm not set up to build R-devel and I'm about to leave
>>>> town
>>>>> for three weeks. I'll see if I can produce a simpler example
>>>> triggering the
>>>>> error, however.
>>>>
>>>> Hana Sevcikova posted a simple example.  I'll bisect on it.
>>>>
>>>> Here's her example:
>>>>
>>>> e <- new.env()
>>>> data("mydataset", envir=e)
>>>>
>>>> I've substituted USArrests for "mydataset".
>>>>
>>>> Duncan Murdoch
>>>>
>>>>>
>>>>> Thanks for this,
>>>>> John
>>>>>
>>>>>>
>>>>>> -pd
>>>>>>
>>>>>>> On 13 Jul 2015, at 22:31 , John Fox <jfox at mcmaster.ca> wrote:
>>>>>>>
>>>>>>> Dear list members,
>>>>>>>
>>>>>>> I'm getting a new note from R-devel that I haven't seen before when
>>>>>> checking
>>>>>>> the development version of the Rcmdr package:
>>>>>>>
>>>>>>> 	* checking R code for possible problems ... NOTE
>>>>>>> 	readDataFromPackage: Error while checking: invalid 'envir' argument
>>>>>>>
>>>>>>> This note doesn't appear in R 3.2.1.
>>>>>>>
>>>>>>> My session info:
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> R Under development (unstable) (2015-07-12 r68650)
>>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>>> Running under: Windows 7 x64 (build 7601) Service Pack 1
>>>>>>>
>>>>>>> locale:
>>>>>>> [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252
>>>>>>> LC_MONETARY=English_Canada.1252
>>>>>>> [4] LC_NUMERIC=C                    LC_TIME=English_Canada.1252
>>>>>>>
>>>>>>> attached base packages:
>>>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>>>
>>>>>>> loaded via a namespace (and not attached):
>>>>>>> [1] tools_3.3.0
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> I can't even localize the problem in readDataFromPackage(). There
>>>> are
>>>>>> only
>>>>>>> two places in this function where there's a function call with an
>>>>>> envir
>>>>>>> argument, and I still get the note if I comment these out. As well,
>>>>>>> readDataFromPackage() seems to work as intended -- there is no
>>>> obvious
>>>>>> error
>>>>>>> in it.
>>>>>>>
>>>>>>> FWIW, here's readDataFromPackage(). The complete sources for the
>>>>>> development
>>>>>>> version of the Rcmdr package are on R-Forge.
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> readDataFromPackage <- function() {
>>>>>>> 	env <- environment()
>>>>>>> 	datasets <- NULL
>>>>>>> 	initializeDialog(title=gettextRcmdr("Read Data From Package"))
>>>>>>> 	dsname <- tclVar("")
>>>>>>> 	package <- NULL
>>>>>>> 	enterFrame <- tkframe(top)
>>>>>>> 	entryDsname <- ttkentry(enterFrame, width="20",
>>>>>> textvariable=dsname)
>>>>>>> 	packages <- sort(.packages())
>>>>>>> 	packages <- packages[! packages %in% c("base", "stats")]
>>>>>>> 	packages <- packages[sapply(packages, function(package){
>>>>>>> 						ds <-
>>>>>>> data(package=package)$results
>>>>>>> 						if (nrow(ds) == 0)
>>>>>>> return(FALSE)
>>>>>>> 						ds <- ds[, "Item"]
>>>>>>> 						valid <- sapply(ds,
>>>>>>> is.valid.name)
>>>>>>> 						length(ds[valid]) > 0
>>>>>>> 					})]
>>>>>>> 	packageDatasetFrame <- tkframe(top)
>>>>>>> 	packageFrame <- tkframe(packageDatasetFrame)
>>>>>>> 	max.height <- getRcmdr("variable.list.height")
>>>>>>> 	packageBox <- tklistbox(packageFrame, height=min(max.height,
>>>>>>> length(packages)),
>>>>>>>           exportselection="FALSE",
>>>>>>> 			selectmode="single", background="white")
>>>>>>> 	packageScroll <- ttkscrollbar(packageFrame,
>>>>>>> 			command=function(...) tkyview(packageBox, ...))
>>>>>>> 	tkconfigure(packageBox, yscrollcommand=function(...)
>>>>>>> tkset(packageScroll, ...))
>>>>>>> 	for (p in packages) tkinsert(packageBox, "end", p)
>>>>>>> 	datasetFrame <- tkframe(packageDatasetFrame)
>>>>>>> 	datasetBox <- tklistbox(datasetFrame, height=max.height,
>>>>>>> exportselection="FALSE",
>>>>>>> 			selectmode="single", background="white")
>>>>>>> 	datasetScroll <- ttkscrollbar(datasetFrame,
>>>>>>> 			command=function(...) tkyview(datasetBox, ...))
>>>>>>> 	tkconfigure(datasetBox, yscrollcommand=function(...)
>>>>>>> tkset(datasetScroll, ...))
>>>>>>> 	onPackageSelect <- function(){
>>>>>>> 		assign("package",
>>>>>>> packages[as.numeric(tkcurselection(packageBox)) + 1], envir=env)
>>>>>>> 		datasets <<- data(package=package)$results[,3]
>>>>>>> 		valid <- sapply(datasets, is.valid.name)
>>>>>>> 		datasets <<- datasets[valid]
>>>>>>> 		tkdelete(datasetBox, "0", "end")
>>>>>>> 		for (dataset in datasets) tkinsert(datasetBox, "end",
>>>>>>> dataset)
>>>>>>> 		tkconfigure(datasetBox, height=min(max.height,
>>>>>>> length(datasets)))
>>>>>>> 		firstChar <- tolower(substr(datasets, 1, 1))
>>>>>>> 		len <- length(datasets)
>>>>>>> 		onLetter <- function(letter){
>>>>>>> 			letter <- tolower(letter)
>>>>>>> 			current <- 1 +
>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(datasetBox) ), "
>>>>>>> "))[1])*len)
>>>>>>> 			mat <- match(letter, firstChar[-(1:current)])
>>>>>>> 			if (is.na(mat)) return()
>>>>>>> 			tkyview.scroll(datasetBox, mat, "units")
>>>>>>> 		}
>>>>>>> 		onA <- function() onLetter("a")
>>>>>>> 		onB <- function() onLetter("b")
>>>>>>> 		onC <- function() onLetter("c")
>>>>>>> 		onD <- function() onLetter("d")
>>>>>>> 		onE <- function() onLetter("e")
>>>>>>> 		onF <- function() onLetter("f")
>>>>>>> 		onG <- function() onLetter("g")
>>>>>>> 		onH <- function() onLetter("h")
>>>>>>> 		onI <- function() onLetter("i")
>>>>>>> 		onJ <- function() onLetter("j")
>>>>>>> 		onK <- function() onLetter("k")
>>>>>>> 		onL <- function() onLetter("l")
>>>>>>> 		onM <- function() onLetter("m")
>>>>>>> 		onN <- function() onLetter("n")
>>>>>>> 		onO <- function() onLetter("o")
>>>>>>> 		onP <- function() onLetter("p")
>>>>>>> 		onQ <- function() onLetter("q")
>>>>>>> 		onR <- function() onLetter("r")
>>>>>>> 		onS <- function() onLetter("s")
>>>>>>> 		onT <- function() onLetter("t")
>>>>>>> 		onU <- function() onLetter("u")
>>>>>>> 		onV <- function() onLetter("v")
>>>>>>> 		onW <- function() onLetter("w")
>>>>>>> 		onX <- function() onLetter("x")
>>>>>>> 		onY <- function() onLetter("y")
>>>>>>> 		onZ <- function() onLetter("z")
>>>>>>> 		for (letter in c(letters, LETTERS)){
>>>>>>> 			tkbind(datasetBox, paste("<", letter, ">", sep=""),
>>>>>>> 					get(paste("on", toupper(letter),
>>>>>>> sep="")))
>>>>>>> 		}
>>>>>>> 		onClick <- function() tkfocus(datasetBox)
>>>>>>> 		tkbind(datasetBox, "<ButtonPress-1>", onClick)
>>>>>>> 	}
>>>>>>> 	onDatasetSelect <- function(){
>>>>>>> 		tclvalue(dsname) <-
>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>>> 	}
>>>>>>> 	firstChar <- tolower(substr(packages, 1, 1))
>>>>>>> 	len <- length(packages)
>>>>>>> 	onLetter <- function(letter){
>>>>>>> 		letter <- tolower(letter)
>>>>>>> 		current <- 1 +
>>>>>>> round(as.numeric(unlist(strsplit(tclvalue(tkyview(packageBox) ), "
>>>>>>> "))[1])*len)
>>>>>>> 		mat <- match(letter, firstChar[-(1:current)])
>>>>>>> 		if (is.na(mat)) return()
>>>>>>> 		tkyview.scroll(packageBox, mat, "units")
>>>>>>> 	}
>>>>>>> 	onA <- function() onLetter("a")
>>>>>>> 	onB <- function() onLetter("b")
>>>>>>> 	onC <- function() onLetter("c")
>>>>>>> 	onD <- function() onLetter("d")
>>>>>>> 	onE <- function() onLetter("e")
>>>>>>> 	onF <- function() onLetter("f")
>>>>>>> 	onG <- function() onLetter("g")
>>>>>>> 	onH <- function() onLetter("h")
>>>>>>> 	onI <- function() onLetter("i")
>>>>>>> 	onJ <- function() onLetter("j")
>>>>>>> 	onK <- function() onLetter("k")
>>>>>>> 	onL <- function() onLetter("l")
>>>>>>> 	onM <- function() onLetter("m")
>>>>>>> 	onN <- function() onLetter("n")
>>>>>>> 	onO <- function() onLetter("o")
>>>>>>> 	onP <- function() onLetter("p")
>>>>>>> 	onQ <- function() onLetter("q")
>>>>>>> 	onR <- function() onLetter("r")
>>>>>>> 	onS <- function() onLetter("s")
>>>>>>> 	onT <- function() onLetter("t")
>>>>>>> 	onU <- function() onLetter("u")
>>>>>>> 	onV <- function() onLetter("v")
>>>>>>> 	onW <- function() onLetter("w")
>>>>>>> 	onX <- function() onLetter("x")
>>>>>>> 	onY <- function() onLetter("y")
>>>>>>> 	onZ <- function() onLetter("z")
>>>>>>> 	for (letter in c(letters, LETTERS)){
>>>>>>> 		tkbind(packageBox, paste("<", letter, ">", sep=""),
>>>>>>> 				get(paste("on", toupper(letter), sep="")))
>>>>>>> 	}
>>>>>>> 	onClick <- function() tkfocus(packageBox)
>>>>>>> 	tkbind(packageBox, "<ButtonPress-1>", onClick)
>>>>>>> 	onOK <- function(){
>>>>>>> 		datasetName <-
>>>>>>> datasets[as.numeric(tkcurselection(datasetBox)) + 1]
>>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>>> 		if (dsnameValue != "" && is.null(package)){
>>>>>>> 			closeDialog()
>>>>>>> 			if (is.element(dsnameValue, listDataSets())) {
>>>>>>> 				if ("no" ==
>>>>>>> tclvalue(checkReplace(dsnameValue, gettextRcmdr("Data set")))){
>>>>>>> 					if (GrabFocus()) tkgrab.release(top)
>>>>>>> 					tkdestroy(top)
>>>>>>> 					readDataFromPackage()
>>>>>>> 					return()
>>>>>>> 				}
>>>>>>> 			}
>>>>>>> 			save.options <- options(warn=2)
>>>>>>> 			check <- try(eval(parse(text=logger(paste("data(",
>>>>>>> dsnameValue, ")", sep=""))),
>>>>>>> 							envir=.GlobalEnv),
>>>>>>> silent=TRUE)
>>>>>>> 			options(save.options)
>>>>>>> 			if (class(check) == "try-error"){
>>>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>>>>
>>>>>>> message=sprintf(gettextRcmdr("Data set %s does not exit"),
>>>>>> dsnameValue))
>>>>>>> 				return()
>>>>>>> 			}
>>>>>>> 			activeDataSet(dsnameValue)
>>>>>>> 			tkfocus(CommanderWindow())
>>>>>>> 		}
>>>>>>> 		else{
>>>>>>> 			if (is.null(package)) {
>>>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>>>> message=gettextRcmdr("You must select a package."))
>>>>>>> 				return()
>>>>>>> 			}
>>>>>>> 			if (length(datasetName) == 0) {
>>>>>>> 				errorCondition(recall=readDataFromPackage,
>>>>>>> message=gettextRcmdr("You must select a data set.")    )
>>>>>>> 				return()
>>>>>>> 			}
>>>>>>> 			if (is.element(datasetName, listDataSets())) {
>>>>>>> 				if ("no" ==
>>>>>>> tclvalue(checkReplace(datasetName, gettextRcmdr("Data set")))){
>>>>>>> 					if (GrabFocus()) tkgrab.release(top)
>>>>>>> 					tkdestroy(top)
>>>>>>> 					readDataFromPackage()
>>>>>>> 					return()
>>>>>>> 				}
>>>>>>> 			}
>>>>>>> 			closeDialog()
>>>>>>> 			command <- paste("data(", datasetName, ',
>>>>>>> package="', package, '")', sep="")
>>>>>>> 			result <- justDoIt(command)
>>>>>>> 			logger(command)
>>>>>>> 			if (class(result)[1] !=  "try-error")
>>>>>>> activeDataSet(datasetName)
>>>>>>> 			tkfocus(CommanderWindow())
>>>>>>> 		}
>>>>>>> 	}
>>>>>>> 	onDataHelp <- function(){
>>>>>>>   datasetName <- datasets[as.numeric(tkcurselection(datasetBox)) +
>>>> 1]
>>>>>>> 		dsnameValue <- tclvalue(dsname)
>>>>>>> 		if (dsnameValue == "") dsnameValue <- datasetName
>>>>>>> 		if (length(dsnameValue) == 0) Message(gettextRcmdr("No data
>>>>>>> set selected."), type="warning")
>>>>>>> 		else if (is.null(package)) doItAndPrint(paste('help("',
>>>>>>> dsnameValue, '")', sep=""))
>>>>>>> 		else doItAndPrint(paste('help("', dsnameValue, '",
>>>>>>> package="', package, '")', sep=""))
>>>>>>> 	}
>>>>>>> 	OKCancelHelp(helpSubject="data")
>>>>>>> 	dataHelpButton <- buttonRcmdr(top, text=gettextRcmdr("Help on
>>>>>>> selected data set"), command=onDataHelp)
>>>>>>> 	tkgrid(labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Package
>>>>>>> (Double-click to select)"), fg=getRcmdr("title.color"),
>>>>>>> font="RcmdrTitleFont"),
>>>>>>> 			labelRcmdr(packageDatasetFrame, text="   "),
>>>>>>> labelRcmdr(packageDatasetFrame, text=gettextRcmdr("Data set (Double-
>>>>>> click to
>>>>>>> select)"),
>>>>>>> 					fg=getRcmdr("title.color"),
>>>>>>> font="RcmdrTitleFont"), sticky="w")
>>>>>>> 	tkgrid(packageBox, packageScroll, sticky="nw")
>>>>>>> 	tkgrid(datasetBox, datasetScroll, sticky="nw")
>>>>>>> 	tkgrid(packageFrame, labelRcmdr(packageDatasetFrame, text="   "),
>>>>>>> datasetFrame, sticky="nw")
>>>>>>> 	tkgrid(packageDatasetFrame, sticky="w")
>>>>>>> 	tkgrid(labelRcmdr(top, text=gettextRcmdr("OR"), fg="red"),
>>>>>>> sticky="w")
>>>>>>> 	tkgrid(labelRcmdr(enterFrame, text=gettextRcmdr("Enter name of data
>>>>>>> set:  "), fg=getRcmdr("title.color"), font="RcmdrTitleFont"),
>>>>>> entryDsname,
>>>>>>> sticky="w")
>>>>>>> 	tkgrid(enterFrame, sticky="w")
>>>>>>> 	tkgrid(dataHelpButton, sticky="w")
>>>>>>> 	tkgrid(buttonsFrame, sticky="ew")
>>>>>>> 	tkgrid.configure(packageScroll, sticky="ns")
>>>>>>> 	tkgrid.configure(datasetScroll, sticky="ns")
>>>>>>> 	tkbind(packageBox, "<Double-ButtonPress-1>", onPackageSelect)
>>>>>>> 	tkbind(datasetBox, "<Double-ButtonPress-1>", onDatasetSelect)
>>>>>>> 	dialogSuffix(focus=entryDsname)
>>>>>>> }
>>>>>>>
>>>>>>> -------- snip ----------
>>>>>>>
>>>>>>> Any insight into the problem would be appreciated.
>>>>>>>
>>>>>>> Thanks,
>>>>>>> John
>>>>>>>
>>>>>>> -----------------------------------------------
>>>>>>> John Fox, Professor
>>>>>>> McMaster University
>>>>>>> Hamilton, Ontario, Canada
>>>>>>> http://socserv.socsci.mcmaster.ca/jfox/
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ---
>>>>>>> This email has been checked for viruses by Avast antivirus software.
>>>>>>> https://www.avast.com/antivirus
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>>> --
>>>>>> Peter Dalgaard, Professor,
>>>>>> Center for Statistics, Copenhagen Business School
>>>>>> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
>>>>>> Phone: (+45)38153501
>>>>>> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ---
>>>>> This email has been checked for viruses by Avast antivirus software.
>>>>> https://www.avast.com/antivirus
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>
>>>
>>> ---
>>> This email has been checked for viruses by Avast antivirus software.
>>> https://www.avast.com/antivirus
>>>
>>
>


From Sebastien.Bihorel at cognigencorp.com  Wed Jul 15 15:07:37 2015
From: Sebastien.Bihorel at cognigencorp.com (sbihorel)
Date: Wed, 15 Jul 2015 09:07:37 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55A4691F.4070200@cognigencorp.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
Message-ID: <55A65B19.8080500@cognigencorp.com>

Hi,

I saw a few recent posts on topics related to mine (eg 
https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It 
looks like I need to import more packages in my NAMESPACE, correct?

However, I thought that imports would be recursive, ie imports would 
also get the info from dependent packages.

Sebastien


On 7/13/2015 9:42 PM, sbihorel wrote:
> Hi,
>
> Sorry about the table. It looked good when displayed using a fixed 
> width font. Let me try to linearize it:
>
>   * pkgA
>       o DESCRIPTION:
>           + Depends: methods, lattice, grid, gam
>           + Imports: Hmisc, survival
>       o NAMESPACE:
>           + import: lattice, grid, gam, methods
>           + importFrom: Hmisc (one function)
>   * pkgB
>       o DESCRIPTION:
>           + Depends: pkgA
>           + Imports: <nothing>
>       o NAMESPACE:
>           + import: pkgA
>           + importFrom: <nothing
>   * pkgC
>       o DESCRIPTION:
>           + Depends: methods, pkgB
>           + Imports: <nothing>
>       o NAMESPACE:
>           + import: methods, pkgB
>           + importFrom: <nothing
>
> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include: 
> exportPattern("^[^\\.]").
>
> Sebastien
>
>
> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>> Are you exporting the functions from pkgB and pkgC? It's hard to tell 
>> from your table below. The easiest way is to add a comment before 
>> each of the functions in pkgB and pkgC that you want to expose to the 
>> users.
>>
>> #' @export
>> foo <- function(){...}
>>
>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>>
>> HTH
>> Seth
>>
>> On Monday, July 13, 2015, sbihorel 
>> <Sebastien.Bihorel at cognigencorp.com 
>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>
>>     Hi,
>>
>>     My group has recently upgraded from a fairly old R version (2.12)
>>     to the
>>     R version 3.1.2. In parallel to this upgrade, I am updating our
>>     custom
>>     packages to add functionality and also make them compliant to the
>>     requirements of the new version of R. I would like to ask your
>>     help with
>>     respect to warning messages I get when I check and install the
>>     packages.
>>     I read the latest version of the manual on writing R extensions,
>>     try to
>>     apply the recommendations, but somehow I am not getting things right.
>>     Hopefully, with your suggestions, I could setup my package
>>     correctly to
>>     make these messages stop.
>>
>>     I apologize but, for confidentiality purpose, I will have to
>>     partially
>>     anonymize the information.
>>
>>     So here is the situation: we have 2 custom packages (let's call them
>>     pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>     call it
>>     pkgA) that is available on CRAN. The pkgC package depends on
>>     pkgB, make
>>     new function available,  and "overwrites" some of the functions
>>     distributed as part of pkgA. The following table summarizes the
>>     content
>>     of the DESCRIPTION and NAMESPACE files of each of these packages.
>>
>>     package    DESCRIPTION NAMESPACE
>>                 Depends                       Imports
>>     import                         importFrom
>>     pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>     grid,
>>     gam, methods    Hmisc
>>     pkgB       pkgA pkgA
>>     pkgC       methods, pkgB methods, pkgB
>>
>>     I do not get any warning when I build, check or install pkgB in our
>>     linux openSuse environment.
>>
>>     After successful building pkgC, I run R CMD check on my built for
>>     pkgC
>>     but I get a ton of messages under the "checking R code for possible
>>     problems" section. These notes are related to actual calls to pkgA
>>     functions (or to one of the function provided by its
>>     dependencies). Here
>>     is a subset for illustration and hopefully information.
>>
>>     * checking R code for possible problems: NOTE
>>     pkgC_function_001: no visible global function definition
>>     for"pkgA_function_AAA"
>>     pkgC_function_001: no visible global function definition
>>     for"pkgA_function_AAB"
>>     ...
>>     pkgC_function_010: no visible global function definition for"xyplot"
>>     pkgC_function_010: no visible global function definition
>>     for"panel.xyplot"
>>     pkgC_function_010: no visible global function definition
>>     for"panel.abline"
>>     pkgC_function_010: no visible global function definition
>>     for"grid.polygon"
>>     pkgC_function_010: no visible global function definition for"gpar"
>>     ...
>>
>>     Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>     following warnings about the content of my documentation Rd
>>     files. The
>>     Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>
>>     *** installing help indices
>>        converting help for package ?kiwixposedev?
>>          finding HTML links ... done
>>     pkgC_function_001                    html
>>          pkgC_function_002                    html
>>     ...
>>     Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>     link "panel.abline"
>>     ...
>>     Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>     link "pkA_function_AAC"
>>     ...
>>
>>     I think I need to somehow modify the content of the DESCRIPTION and
>>     NAMESPACE files for pkgC... but adding various combinations of
>>     pkA and
>>     its dependencies gave me others errors about redundancies and
>>     multiple
>>     loading of the same packages. So in short, I am kind of lost with the
>>     new requirements of R 3.1.2 and would greatly appreciate any help or
>>     suggestions
>>
>>     Thank you in advance for your time.
>>
>>     Sebastien Bihorel
>>
>>
>>             [[alternative HTML version deleted]]
>>
>>     ______________________________________________
>>     R-package-devel at r-project.org <javascript:;> mailing list
>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>


	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Wed Jul 15 15:24:01 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 15 Jul 2015 09:24:01 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55A65B19.8080500@cognigencorp.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com>
Message-ID: <55A65EF1.3010700@gmail.com>

On 15/07/2015 9:07 AM, sbihorel wrote:
> Hi,
> 
> I saw a few recent posts on topics related to mine (eg
> https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It
> looks like I need to import more packages in my NAMESPACE, correct?
> 
> However, I thought that imports would be recursive, ie imports would
> also get the info from dependent packages.

I haven't been following this thread, but the 2nd para above makes it
sound as though an explanation of the NAMESPACE directives would be helpful.

If you say

 importFrom(Hmisc, latex)

it acts as though you have made a copy of the Hmisc::latex function
within your package environment.  (It isn't exported, unless you ask to
export it.)

If you say

 import(Hmisc)

it acts as though you have made copies of every exported function from
Hmisc within your package environment.  This is why we recommend
importing only the functions you need; otherwise your package
environment gets bloated.

No recursive copies are made, unless Hmisc happens to import something
and re-exports it.

When I say "acts as though", I don't mean it literally makes copies; it
implements this in a more efficient way, basically only copying pointers
to those functions -- but from a user point of view, you shouldn't be
able to tell the difference, since you're not allowed to modify
Hmisc::latex.

Duncan Murdoch


> 
> Sebastien
> 
> 
> On 7/13/2015 9:42 PM, sbihorel wrote:
>> Hi,
>>
>> Sorry about the table. It looked good when displayed using a fixed
>> width font. Let me try to linearize it:
>>
>>   * pkgA
>>       o DESCRIPTION:
>>           + Depends: methods, lattice, grid, gam
>>           + Imports: Hmisc, survival
>>       o NAMESPACE:
>>           + import: lattice, grid, gam, methods
>>           + importFrom: Hmisc (one function)
>>   * pkgB
>>       o DESCRIPTION:
>>           + Depends: pkgA
>>           + Imports: <nothing>
>>       o NAMESPACE:
>>           + import: pkgA
>>           + importFrom: <nothing
>>   * pkgC
>>       o DESCRIPTION:
>>           + Depends: methods, pkgB
>>           + Imports: <nothing>
>>       o NAMESPACE:
>>           + import: methods, pkgB
>>           + importFrom: <nothing
>>
>> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include:
>> exportPattern("^[^\\.]").
>>
>> Sebastien
>>
>>
>> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>>> Are you exporting the functions from pkgB and pkgC? It's hard to tell
>>> from your table below. The easiest way is to add a comment before
>>> each of the functions in pkgB and pkgC that you want to expose to the
>>> users.
>>>
>>> #' @export
>>> foo <- function(){...}
>>>
>>> Then run roxygen::roxygenise() to build the NAMESPACE file. 
>>>
>>> HTH
>>> Seth
>>>
>>> On Monday, July 13, 2015, sbihorel
>>> <Sebastien.Bihorel at cognigencorp.com
>>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>>
>>>     Hi,
>>>
>>>     My group has recently upgraded from a fairly old R version (2.12)
>>>     to the
>>>     R version 3.1.2. In parallel to this upgrade, I am updating our
>>>     custom
>>>     packages to add functionality and also make them compliant to the
>>>     requirements of the new version of R. I would like to ask your
>>>     help with
>>>     respect to warning messages I get when I check and install the
>>>     packages.
>>>     I read the latest version of the manual on writing R extensions,
>>>     try to
>>>     apply the recommendations, but somehow I am not getting things right.
>>>     Hopefully, with your suggestions, I could setup my package
>>>     correctly to
>>>     make these messages stop.
>>>
>>>     I apologize but, for confidentiality purpose, I will have to
>>>     partially
>>>     anonymize the information.
>>>
>>>     So here is the situation: we have 2 custom packages (let's call them
>>>     pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>>     call it
>>>     pkgA) that is available on CRAN. The pkgC package depends on
>>>     pkgB, make
>>>     new function available,  and "overwrites" some of the functions
>>>     distributed as part of pkgA. The following table summarizes the
>>>     content
>>>     of the DESCRIPTION and NAMESPACE files of each of these packages.
>>>
>>>     package    DESCRIPTION NAMESPACE
>>>                 Depends                       Imports
>>>     import                         importFrom
>>>     pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>>     grid,
>>>     gam, methods    Hmisc
>>>     pkgB       pkgA pkgA
>>>     pkgC       methods, pkgB methods, pkgB
>>>
>>>     I do not get any warning when I build, check or install pkgB in our
>>>     linux openSuse environment.
>>>
>>>     After successful building pkgC, I run R CMD check on my built for
>>>     pkgC
>>>     but I get a ton of messages under the "checking R code for possible
>>>     problems" section. These notes are related to actual calls to pkgA
>>>     functions (or to one of the function provided by its
>>>     dependencies). Here
>>>     is a subset for illustration and hopefully information.
>>>
>>>     * checking R code for possible problems: NOTE
>>>     pkgC_function_001: no visible global function definition
>>>     for"pkgA_function_AAA"
>>>     pkgC_function_001: no visible global function definition
>>>     for"pkgA_function_AAB"
>>>     ...
>>>     pkgC_function_010: no visible global function definition for"xyplot"
>>>     pkgC_function_010: no visible global function definition
>>>     for"panel.xyplot"
>>>     pkgC_function_010: no visible global function definition
>>>     for"panel.abline"
>>>     pkgC_function_010: no visible global function definition
>>>     for"grid.polygon"
>>>     pkgC_function_010: no visible global function definition for"gpar"
>>>     ...
>>>
>>>     Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>>     following warnings about the content of my documentation Rd
>>>     files. The
>>>     Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>>
>>>     *** installing help indices
>>>        converting help for package ?kiwixposedev?
>>>          finding HTML links ... done
>>>     pkgC_function_001                    html
>>>          pkgC_function_002                    html
>>>     ...
>>>     Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>>     link "panel.abline"
>>>     ...
>>>     Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>>     link "pkA_function_AAC"
>>>     ...
>>>
>>>     I think I need to somehow modify the content of the DESCRIPTION and
>>>     NAMESPACE files for pkgC... but adding various combinations of
>>>     pkA and
>>>     its dependencies gave me others errors about redundancies and
>>>     multiple
>>>     loading of the same packages. So in short, I am kind of lost with the
>>>     new requirements of R 3.1.2 and would greatly appreciate any help or
>>>     suggestions
>>>
>>>     Thank you in advance for your time.
>>>
>>>     Sebastien Bihorel
>>>
>>>
>>>             [[alternative HTML version deleted]]
>>>
>>>     ______________________________________________
>>>     R-package-devel at r-project.org <javascript:;> mailing list
>>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>


From Sebastien.Bihorel at cognigencorp.com  Wed Jul 15 15:30:44 2015
From: Sebastien.Bihorel at cognigencorp.com (sbihorel)
Date: Wed, 15 Jul 2015 09:30:44 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55A65EF1.3010700@gmail.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com> <55A65EF1.3010700@gmail.com>
Message-ID: <55A66084.3000704@cognigencorp.com>

Hi Duncan,

So if the NAMESPACE of a package contains exportPattern("^[^\\.]"), does 
this mean that only the functions created within the package are 
exported and that the functions that were imported are not exported?

On 7/15/2015 9:24 AM, Duncan Murdoch wrote:
> On 15/07/2015 9:07 AM, sbihorel wrote:
>> Hi,
>>
>> I saw a few recent posts on topics related to mine (eg
>> https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It
>> looks like I need to import more packages in my NAMESPACE, correct?
>>
>> However, I thought that imports would be recursive, ie imports would
>> also get the info from dependent packages.
> I haven't been following this thread, but the 2nd para above makes it
> sound as though an explanation of the NAMESPACE directives would be helpful.
>
> If you say
>
>   importFrom(Hmisc, latex)
>
> it acts as though you have made a copy of the Hmisc::latex function
> within your package environment.  (It isn't exported, unless you ask to
> export it.)
>
> If you say
>
>   import(Hmisc)
>
> it acts as though you have made copies of every exported function from
> Hmisc within your package environment.  This is why we recommend
> importing only the functions you need; otherwise your package
> environment gets bloated.
>
> No recursive copies are made, unless Hmisc happens to import something
> and re-exports it.
>
> When I say "acts as though", I don't mean it literally makes copies; it
> implements this in a more efficient way, basically only copying pointers
> to those functions -- but from a user point of view, you shouldn't be
> able to tell the difference, since you're not allowed to modify
> Hmisc::latex.
>
> Duncan Murdoch
>
>
>> Sebastien
>>
>>
>> On 7/13/2015 9:42 PM, sbihorel wrote:
>>> Hi,
>>>
>>> Sorry about the table. It looked good when displayed using a fixed
>>> width font. Let me try to linearize it:
>>>
>>>    * pkgA
>>>        o DESCRIPTION:
>>>            + Depends: methods, lattice, grid, gam
>>>            + Imports: Hmisc, survival
>>>        o NAMESPACE:
>>>            + import: lattice, grid, gam, methods
>>>            + importFrom: Hmisc (one function)
>>>    * pkgB
>>>        o DESCRIPTION:
>>>            + Depends: pkgA
>>>            + Imports: <nothing>
>>>        o NAMESPACE:
>>>            + import: pkgA
>>>            + importFrom: <nothing
>>>    * pkgC
>>>        o DESCRIPTION:
>>>            + Depends: methods, pkgB
>>>            + Imports: <nothing>
>>>        o NAMESPACE:
>>>            + import: methods, pkgB
>>>            + importFrom: <nothing
>>>
>>> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include:
>>> exportPattern("^[^\\.]").
>>>
>>> Sebastien
>>>
>>>
>>> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>>>> Are you exporting the functions from pkgB and pkgC? It's hard to tell
>>>> from your table below. The easiest way is to add a comment before
>>>> each of the functions in pkgB and pkgC that you want to expose to the
>>>> users.
>>>>
>>>> #' @export
>>>> foo <- function(){...}
>>>>
>>>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>>>>
>>>> HTH
>>>> Seth
>>>>
>>>> On Monday, July 13, 2015, sbihorel
>>>> <Sebastien.Bihorel at cognigencorp.com
>>>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>>>
>>>>      Hi,
>>>>
>>>>      My group has recently upgraded from a fairly old R version (2.12)
>>>>      to the
>>>>      R version 3.1.2. In parallel to this upgrade, I am updating our
>>>>      custom
>>>>      packages to add functionality and also make them compliant to the
>>>>      requirements of the new version of R. I would like to ask your
>>>>      help with
>>>>      respect to warning messages I get when I check and install the
>>>>      packages.
>>>>      I read the latest version of the manual on writing R extensions,
>>>>      try to
>>>>      apply the recommendations, but somehow I am not getting things right.
>>>>      Hopefully, with your suggestions, I could setup my package
>>>>      correctly to
>>>>      make these messages stop.
>>>>
>>>>      I apologize but, for confidentiality purpose, I will have to
>>>>      partially
>>>>      anonymize the information.
>>>>
>>>>      So here is the situation: we have 2 custom packages (let's call them
>>>>      pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>>>      call it
>>>>      pkgA) that is available on CRAN. The pkgC package depends on
>>>>      pkgB, make
>>>>      new function available,  and "overwrites" some of the functions
>>>>      distributed as part of pkgA. The following table summarizes the
>>>>      content
>>>>      of the DESCRIPTION and NAMESPACE files of each of these packages.
>>>>
>>>>      package    DESCRIPTION NAMESPACE
>>>>                  Depends                       Imports
>>>>      import                         importFrom
>>>>      pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>>>      grid,
>>>>      gam, methods    Hmisc
>>>>      pkgB       pkgA pkgA
>>>>      pkgC       methods, pkgB methods, pkgB
>>>>
>>>>      I do not get any warning when I build, check or install pkgB in our
>>>>      linux openSuse environment.
>>>>
>>>>      After successful building pkgC, I run R CMD check on my built for
>>>>      pkgC
>>>>      but I get a ton of messages under the "checking R code for possible
>>>>      problems" section. These notes are related to actual calls to pkgA
>>>>      functions (or to one of the function provided by its
>>>>      dependencies). Here
>>>>      is a subset for illustration and hopefully information.
>>>>
>>>>      * checking R code for possible problems: NOTE
>>>>      pkgC_function_001: no visible global function definition
>>>>      for"pkgA_function_AAA"
>>>>      pkgC_function_001: no visible global function definition
>>>>      for"pkgA_function_AAB"
>>>>      ...
>>>>      pkgC_function_010: no visible global function definition for"xyplot"
>>>>      pkgC_function_010: no visible global function definition
>>>>      for"panel.xyplot"
>>>>      pkgC_function_010: no visible global function definition
>>>>      for"panel.abline"
>>>>      pkgC_function_010: no visible global function definition
>>>>      for"grid.polygon"
>>>>      pkgC_function_010: no visible global function definition for"gpar"
>>>>      ...
>>>>
>>>>      Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>>>      following warnings about the content of my documentation Rd
>>>>      files. The
>>>>      Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>>>
>>>>      *** installing help indices
>>>>         converting help for package ?kiwixposedev?
>>>>           finding HTML links ... done
>>>>      pkgC_function_001                    html
>>>>           pkgC_function_002                    html
>>>>      ...
>>>>      Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>>>      link "panel.abline"
>>>>      ...
>>>>      Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>>>      link "pkA_function_AAC"
>>>>      ...
>>>>
>>>>      I think I need to somehow modify the content of the DESCRIPTION and
>>>>      NAMESPACE files for pkgC... but adding various combinations of
>>>>      pkA and
>>>>      its dependencies gave me others errors about redundancies and
>>>>      multiple
>>>>      loading of the same packages. So in short, I am kind of lost with the
>>>>      new requirements of R 3.1.2 and would greatly appreciate any help or
>>>>      suggestions
>>>>
>>>>      Thank you in advance for your time.
>>>>
>>>>      Sebastien Bihorel
>>>>
>>>>
>>>>              [[alternative HTML version deleted]]
>>>>
>>>>      ______________________________________________
>>>>      R-package-devel at r-project.org <javascript:;> mailing list
>>>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>


From edd at debian.org  Wed Jul 15 15:42:39 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 15 Jul 2015 08:42:39 -0500
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55A65B19.8080500@cognigencorp.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com>
Message-ID: <21926.25423.924502.326377@max.nulle.part>


On 15 July 2015 at 09:07, sbihorel wrote:
| I saw a few recent posts on topics related to mine (eg 
| https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It 
| looks like I need to import more packages in my NAMESPACE, correct?

Yes.
 
| However, I thought that imports would be recursive, ie imports would 
| also get the info from dependent packages.

As we sometimes say about R issues: "Wishing aline alone doesn't make it so."

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd at debian.org  Wed Jul 15 15:43:29 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 15 Jul 2015 08:43:29 -0500
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <55A4FB61.7030901@gmail.com>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>
	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>
	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>
	<55A43C6F.6070903@gmail.com>
	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>
	<55A44332.4070900@gmail.com>
	<5750F2A3-B37A-48B7-BB56-D0955767C60F@gmail.com>
	<55A4FB61.7030901@gmail.com>
Message-ID: <21926.25473.187780.286920@max.nulle.part>


On 14 July 2015 at 08:06, Duncan Murdoch wrote:
| It looks like a bug in codetools.  It handles a number of functions
| specially; data() is one, binomial() is another.  I think there are some
| implicit assumptions in it that stats and utils are on the search path,
| but in the new tests, they aren't.

And as of this morning, CRANberries reports a new codetools version. Maybe
the issue is already fixed?

http://dirk.eddelbuettel.com/cranberries/2015/07/15#codetools_0.2-14

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch.duncan at gmail.com  Wed Jul 15 15:47:53 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 15 Jul 2015 09:47:53 -0400
Subject: [R-pkg-devel] "invalid 'envir' argument" note from R-devel
In-Reply-To: <21926.25473.187780.286920@max.nulle.part>
References: <003e01d0bdaa$ebabcfe0$c3036fa0$@mcmaster.ca>	<C13D018C-7C69-46E3-A856-8559D4E9257D@gmail.com>	<003f01d0bdb2$3a1e0a60$ae5a1f20$@mcmaster.ca>	<55A43C6F.6070903@gmail.com>	<004401d0bdbd$e58ebd30$b0ac3790$@mcmaster.ca>	<55A44332.4070900@gmail.com>	<5750F2A3-B37A-48B7-BB56-D0955767C60F@gmail.com>	<55A4FB61.7030901@gmail.com>
	<21926.25473.187780.286920@max.nulle.part>
Message-ID: <55A66489.5080304@gmail.com>

On 15/07/2015 9:43 AM, Dirk Eddelbuettel wrote:
> 
> On 14 July 2015 at 08:06, Duncan Murdoch wrote:
> | It looks like a bug in codetools.  It handles a number of functions
> | specially; data() is one, binomial() is another.  I think there are some
> | implicit assumptions in it that stats and utils are on the search path,
> | but in the new tests, they aren't.
> 
> And as of this morning, CRANberries reports a new codetools version. Maybe
> the issue is already fixed?
> 
> http://dirk.eddelbuettel.com/cranberries/2015/07/15#codetools_0.2-14

Testing is ongoing, but it looks as though it is.

Duncan Murdoch


From jonathan at mazamascience.com  Mon Jul 20 00:19:36 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Sun, 19 Jul 2015 15:19:36 -0700
Subject: [R-pkg-devel] renaming a package
Message-ID: <CAPjNR=SHOnHPV=NVuRGLT5SEyo8JFj_kFsn6VDmaH+9bjSpRhw@mail.gmail.com>

We are developing a suite of three packages related to seismology. As I was
dealing with 64 bit compilation issues that became apparent from a previous
submission attempt, another package with the name 'seismic' was accepted to
CRAN.

This brings up two issues:

1) CRAN might wish to have better package naming guidelines than "short and
sweet, first come, first served".

As the number of packages continues to rise, it might be useful to have
java style *OrganizationPackage* naming. In our case, we are now going to
release the core seismic data package as 'IRISSeismic'.

2) What is the best practice for renaming a package that has already been
accepted to CRAN?

We had previously released a 'seismicRoll' package that we may now wish to
rename 'IRISSeismicRoll'.

Thanks,

Jon

-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Mon Jul 20 00:53:44 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 19 Jul 2015 18:53:44 -0400
Subject: [R-pkg-devel] renaming a package
In-Reply-To: <CAPjNR=SHOnHPV=NVuRGLT5SEyo8JFj_kFsn6VDmaH+9bjSpRhw@mail.gmail.com>
References: <CAPjNR=SHOnHPV=NVuRGLT5SEyo8JFj_kFsn6VDmaH+9bjSpRhw@mail.gmail.com>
Message-ID: <55AC2A78.6090908@gmail.com>

On 19/07/2015 6:19 PM, Jonathan Callahan wrote:
> We are developing a suite of three packages related to seismology. As I was
> dealing with 64 bit compilation issues that became apparent from a previous
> submission attempt, another package with the name 'seismic' was accepted to
> CRAN.
> 
> This brings up two issues:
> 
> 1) CRAN might wish to have better package naming guidelines than "short and
> sweet, first come, first served".
> 
> As the number of packages continues to rise, it might be useful to have
> java style *OrganizationPackage* naming. In our case, we are now going to
> release the core seismic data package as 'IRISSeismic'.

I don't see a need for this.  If you want to do it for your packages, go
ahead.

> 
> 2) What is the best practice for renaming a package that has already been
> accepted to CRAN?
> 
> We had previously released a 'seismicRoll' package that we may now wish to
> rename 'IRISSeismicRoll'.

Rename it and submit it.  In your message to CRAN, mention that you are
renaming it from seismicRoll, and say why the name seismicRoll is no
longer appropriate.

Don't do this too often, but there's no problem doing it occasionally,
when there's a good reason to do so.

Duncan Murdoch


From ligges at statistik.tu-dortmund.de  Mon Jul 20 03:24:57 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 20 Jul 2015 03:24:57 +0200
Subject: [R-pkg-devel] renaming a package
In-Reply-To: <55AC2A78.6090908@gmail.com>
References: <CAPjNR=SHOnHPV=NVuRGLT5SEyo8JFj_kFsn6VDmaH+9bjSpRhw@mail.gmail.com>
	<55AC2A78.6090908@gmail.com>
Message-ID: <55AC4DE9.5000405@statistik.tu-dortmund.de>



On 20.07.2015 00:53, Duncan Murdoch wrote:
> On 19/07/2015 6:19 PM, Jonathan Callahan wrote:
>> We are developing a suite of three packages related to seismology. As I was
>> dealing with 64 bit compilation issues that became apparent from a previous
>> submission attempt, another package with the name 'seismic' was accepted to
>> CRAN.
>>
>> This brings up two issues:
>>
>> 1) CRAN might wish to have better package naming guidelines than "short and
>> sweet, first come, first served".
>>
>> As the number of packages continues to rise, it might be useful to have
>> java style *OrganizationPackage* naming. In our case, we are now going to
>> release the core seismic data package as 'IRISSeismic'.
>
> I don't see a need for this.  If you want to do it for your packages, go
> ahead.
>
>>
>> 2) What is the best practice for renaming a package that has already been
>> accepted to CRAN?
>>
>> We had previously released a 'seismicRoll' package that we may now wish to
>> rename 'IRISSeismicRoll'.
>
> Rename it and submit it.  In your message to CRAN, mention that you are
> renaming it from seismicRoll, and say why the name seismicRoll is no
> longer appropriate.
>
> Don't do this too often, but there's no problem doing it occasionally,
> when there's a good reason to do so.


Thanks, and yes, CRAN will allow renaming in case there is a really good 
reason.

Note that package names, once a package got renamed, cannot be used by 
others any more, hence we are allowing such a change only in rare cases 
with very good reasons...
In the past not many maintainers succeeded to get us convinced...

Best,
Uwe Ligges



>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From ajsaez at ujaen.es  Mon Jul 20 07:36:45 2015
From: ajsaez at ujaen.es (=?UTF-8?Q?Antonio_Jos=C3=A9_Saez_Castillo?=)
Date: Mon, 20 Jul 2015 07:36:45 +0200
Subject: [R-pkg-devel] Note about "No repository set,
	so cyclic dependency check skipped"
Message-ID: <CAD+ZfS5scUFARL7QK7wxeeLHSavHd7uTBTj0NYk9-HuDZA6-xQ@mail.gmail.com>

When checking a package I am getting

* checking package dependencies ... NOTE
   No repository set, so cyclic dependency check skipped

This is an old source of discussion and I've found a lot of suggestions,
but none of them work for me (.Rprofile and/or Rprofile.site edition and
so). What is more worrying is that I'm also getting this note when I check
in R-devel on win-builder site (win-builder.r-project.org). There is
another similar topic in relation to that (
http://r.789695.n4.nabble.com/No-repository-set-so-cyclic-dependency-check-skipped-td4684184.html),
but I don't know if it is the same problem.

How can I avoid this note?







*Dr. Antonio Jos? S?ez-Castillo*Department of Statistics and
Operational Research
Escuela Polit?cnica Superior de Linares
UNIVERSIDAD DE JA?N
C/ Alfonso X el Sabio, 28
23700 Linares (Ja?n)
Tel?fono: +34 953 64 85 78
e-mail: ajsaez at ujaen.es
 <https://www.researchgate.net/profile/Antonio_Saez-Castillo>
<http://twitter.com/ajsaezUJA>

	[[alternative HTML version deleted]]


From plummerm at iarc.fr  Mon Jul 20 10:53:58 2015
From: plummerm at iarc.fr (Martyn Plummer)
Date: Mon, 20 Jul 2015 08:53:58 +0000
Subject: [R-pkg-devel] Note about "No repository set,
 so cyclic dependency check skipped"
In-Reply-To: <CAD+ZfS5scUFARL7QK7wxeeLHSavHd7uTBTj0NYk9-HuDZA6-xQ@mail.gmail.com>
References: <CAD+ZfS5scUFARL7QK7wxeeLHSavHd7uTBTj0NYk9-HuDZA6-xQ@mail.gmail.com>
Message-ID: <1437382437.15702.10.camel@iarc.fr>

On Mon, 2015-07-20 at 07:36 +0200, Antonio Jos? Saez Castillo wrote:
> When checking a package I am getting
> 
> * checking package dependencies ... NOTE
>    No repository set, so cyclic dependency check skipped
> 
> This is an old source of discussion and I've found a lot of suggestions,
> but none of them work for me (.Rprofile and/or Rprofile.site edition and
> so). What is more worrying is that I'm also getting this note when I check
> in R-devel on win-builder site (win-builder.r-project.org). There is
> another similar topic in relation to that (
> http://r.789695.n4.nabble.com/No-repository-set-so-cyclic-dependency-check-skipped-td4684184.html),
> but I don't know if it is the same problem.
> 
> How can I avoid this note?

This is covered in the Writing R Extensions manual (page 32), but if you
tried creating a .Rprofile file and it didn't work then the problem
might be that it is in the wrong place. On my Windows 7 desktop, R opens
in my "Documents" folder rather than my home directory, so my .Rprofile
folder has to go into "Documents".

Martyn

> 
> 
> 
> 
> *Dr. Antonio Jos? S?ez-Castillo*Department of Statistics and
> Operational Research
> Escuela Polit?cnica Superior de Linares
> UNIVERSIDAD DE JA?N
> C/ Alfonso X el Sabio, 28
> 23700 Linares (Ja?n)
> Tel?fono: +34 953 64 85 78
> e-mail: ajsaez at ujaen.es
>  <https://www.researchgate.net/profile/Antonio_Saez-Castillo>
> <http://twitter.com/ajsaezUJA>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From edd at debian.org  Mon Jul 20 12:25:26 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 20 Jul 2015 05:25:26 -0500
Subject: [R-pkg-devel] Note about "No repository set,
 so cyclic dependency check skipped"
In-Reply-To: <1437382437.15702.10.camel@iarc.fr>
References: <CAD+ZfS5scUFARL7QK7wxeeLHSavHd7uTBTj0NYk9-HuDZA6-xQ@mail.gmail.com>
	<1437382437.15702.10.camel@iarc.fr>
Message-ID: <21932.52374.191560.201682@max.nulle.part>


On 20 July 2015 at 08:53, Martyn Plummer wrote:
| On Mon, 2015-07-20 at 07:36 +0200, Antonio Jos? Saez Castillo wrote:
| > When checking a package I am getting
| > 
| > * checking package dependencies ... NOTE
| >    No repository set, so cyclic dependency check skipped
| > 
| > This is an old source of discussion and I've found a lot of suggestions,
| > but none of them work for me (.Rprofile and/or Rprofile.site edition and
| > so). What is more worrying is that I'm also getting this note when I check
| > in R-devel on win-builder site (win-builder.r-project.org). There is
| > another similar topic in relation to that (
| > http://r.789695.n4.nabble.com/No-repository-set-so-cyclic-dependency-check-skipped-td4684184.html),
| > but I don't know if it is the same problem.
| > 
| > How can I avoid this note?
| 
| This is covered in the Writing R Extensions manual (page 32), but if you
| tried creating a .Rprofile file and it didn't work then the problem
| might be that it is in the wrong place. On my Windows 7 desktop, R opens
| in my "Documents" folder rather than my home directory, so my .Rprofile
| folder has to go into "Documents".

If I recall correctly, setting the environment variable HOME (which is not
standard under Window) allows you to control that.  Files such as ~/.Rprofile
will then be searched in the directory pointed to by the value assigned to
HOME.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jonathan at mazamascience.com  Mon Jul 20 19:50:48 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Mon, 20 Jul 2015 10:50:48 -0700
Subject: [R-pkg-devel] recreating CRAN Testing environment
Message-ID: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>

I am (hopefully) at the end of a series of back-and-forth submissions of a
package to the CRAN upload site.

I have done my best to test things by:

   - using devtools
   - running "R CMD check --as-cran" on the command line
   - checking my package on OSX, win-builder.R and various 32 and 64 bit
   linux virtual machines at DigitalOcean

But I have never managed to recreate all of the notes and warning messages
that the CRAN testing comes up with.

In an effort to save time and effort on both ends, can anyone advise on
what I need to do to generate ALL the warning messages that the CRAN
testing will find?



-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From bbolker at gmail.com  Mon Jul 20 19:59:46 2015
From: bbolker at gmail.com (Ben Bolker)
Date: Mon, 20 Jul 2015 13:59:46 -0400
Subject: [R-pkg-devel] recreating CRAN Testing environment
In-Reply-To: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
References: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
Message-ID: <55AD3712.200@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15-07-20 01:50 PM, Jonathan Callahan wrote:
> I am (hopefully) at the end of a series of back-and-forth
> submissions of a package to the CRAN upload site.
> 
> I have done my best to test things by:
> 
> - using devtools - running "R CMD check --as-cran" on the command
> line - checking my package on OSX, win-builder.R and various 32 and
> 64 bit linux virtual machines at DigitalOcean
> 
> But I have never managed to recreate all of the notes and warning
> messages that the CRAN testing comes up with.
> 
> In an effort to save time and effort on both ends, can anyone
> advise on what I need to do to generate ALL the warning messages
> that the CRAN testing will find?

   The most important thing that you haven't explicitly mentioned is
to test on the most recent development version of R (check out via
Subversion/configure/make/make install from scratch).  Can you adjust
your DigitalOcean settings accordingly?

  Ben Bolker


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQEcBAEBAgAGBQJVrTcSAAoJEOCV5YRblxUHNqUIAKMpuDZ5viQSBlyXpIqjtjEW
Na6LhC5O/XcjmmrZHDftXAat2gTrRM0OJAn0cfzSZttdcJKowbMYfJzDWe/5oBCE
QRQ0zwxbJY1cFHFyYR6r1zCe4ah4SzoGt+FmBYjtAKefvjm12tfQubhQlxPxZ1kV
XFIfYTWHmHWNGlhZuokPE/GtdXK5/4MNF/32HxseNBRzc2SWqP3i6VKPnbN7LFgl
xrjXsHQdqU3UaY37D44mInl+qm5y5reRSUi6NO0SrSh2WcVWTnqZ3HsUkFPND5tM
NyzrfhtGN2wISsFq1J+dC87ajyeh6D8LTYBiokUnWQFOj8tPi1Zhff0LuTJi7Vc=
=gytX
-----END PGP SIGNATURE-----


From avraham.adler at gmail.com  Mon Jul 20 20:15:23 2015
From: avraham.adler at gmail.com (Avraham Adler)
Date: Mon, 20 Jul 2015 14:15:23 -0400
Subject: [R-pkg-devel] recreating CRAN Testing environment
In-Reply-To: <55AD3712.200@gmail.com>
References: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
	<55AD3712.200@gmail.com>
Message-ID: <CAL6gwnK6AbDOP6Hb1=7KuFEoA0iYLf9CjatTq_ziK1aF1-wP6w@mail.gmail.com>

Even if you don't use Windows, it pays to submit your package to the
Winbuilder test of buth R-release and R-devel. The error reports, if any,
are often not-OS dependant and will serve as a good gaage as to how the
real CRAN will respond.

Avi

On Mon, Jul 20, 2015 at 1:59 PM, Ben Bolker <bbolker at gmail.com> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 15-07-20 01:50 PM, Jonathan Callahan wrote:
> > I am (hopefully) at the end of a series of back-and-forth
> > submissions of a package to the CRAN upload site.
> >
> > I have done my best to test things by:
> >
> > - using devtools - running "R CMD check --as-cran" on the command
> > line - checking my package on OSX, win-builder.R and various 32 and
> > 64 bit linux virtual machines at DigitalOcean
> >
> > But I have never managed to recreate all of the notes and warning
> > messages that the CRAN testing comes up with.
> >
> > In an effort to save time and effort on both ends, can anyone
> > advise on what I need to do to generate ALL the warning messages
> > that the CRAN testing will find?
>
>    The most important thing that you haven't explicitly mentioned is
> to test on the most recent development version of R (check out via
> Subversion/configure/make/make install from scratch).  Can you adjust
> your DigitalOcean settings accordingly?
>
>   Ben Bolker
>
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.11 (GNU/Linux)
>
> iQEcBAEBAgAGBQJVrTcSAAoJEOCV5YRblxUHNqUIAKMpuDZ5viQSBlyXpIqjtjEW
> Na6LhC5O/XcjmmrZHDftXAat2gTrRM0OJAn0cfzSZttdcJKowbMYfJzDWe/5oBCE
> QRQ0zwxbJY1cFHFyYR6r1zCe4ah4SzoGt+FmBYjtAKefvjm12tfQubhQlxPxZ1kV
> XFIfYTWHmHWNGlhZuokPE/GtdXK5/4MNF/32HxseNBRzc2SWqP3i6VKPnbN7LFgl
> xrjXsHQdqU3UaY37D44mInl+qm5y5reRSUi6NO0SrSh2WcVWTnqZ3HsUkFPND5tM
> NyzrfhtGN2wISsFq1J+dC87ajyeh6D8LTYBiokUnWQFOj8tPi1Zhff0LuTJi7Vc=
> =gytX
> -----END PGP SIGNATURE-----
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From edd at debian.org  Mon Jul 20 20:16:32 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 20 Jul 2015 13:16:32 -0500
Subject: [R-pkg-devel] recreating CRAN Testing environment
In-Reply-To: <55AD3712.200@gmail.com>
References: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
	<55AD3712.200@gmail.com>
Message-ID: <21933.15104.903340.2181@max.nulle.part>


Jonathan,

On 20 July 2015 at 13:59, Ben Bolker wrote:
| On 15-07-20 01:50 PM, Jonathan Callahan wrote:
| > In an effort to save time and effort on both ends, can anyone
| > advise on what I need to do to generate ALL the warning messages
| > that the CRAN testing will find?
| 
|    The most important thing that you haven't explicitly mentioned is
| to test on the most recent development version of R (check out via
| Subversion/configure/make/make install from scratch).  Can you adjust
| your DigitalOcean settings accordingly?

Seconded.

Recipes how to build R-devel from source have circulated for years. [1] "As
it works for me" I still keep a svn checkout which I update maybe once a week
(or whenever I become aware of a new issue) to rebuild.

For those familiar with Docker, Carl and I also provide both a small image for
Rocker ('drd' for daily r-devel) and a larger one ('r-devel', still contains
development libraies). [2]  Use of those should be straightforward on eg
digital ocean.

For what it is worth, I had about five different packages go onto CRAN in the
last week. None required a second iteration -- but testing with R-devel is a
key part of the process.

Dirk


[1] Here is one which Google just found for me. I may have posted this
    earlier too:
    https://stat.ethz.ch/pipermail/r-sig-debian/2012-August/001935.html

[2] https://github.com/rocker-org/rocker on GitHub and
    https://registry.hub.docker.com/repos/rocker/ at Docker
    
-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From csardi.gabor at gmail.com  Mon Jul 20 20:18:50 2015
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Mon, 20 Jul 2015 14:18:50 -0400
Subject: [R-pkg-devel] recreating CRAN Testing environment
In-Reply-To: <55AD3712.200@gmail.com>
References: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
	<55AD3712.200@gmail.com>
Message-ID: <CABtg=K=Bzbvtqwh_1vL+fN+u19Dr9OXiHWMsLT6UeoUe-P426Q@mail.gmail.com>

On Mon, Jul 20, 2015 at 1:59 PM, Ben Bolker <bbolker at gmail.com> wrote:
[...]
>    The most important thing that you haven't explicitly mentioned is
> to test on the most recent development version of R (check out via
> Subversion/configure/make/make install from scratch).  Can you adjust
> your DigitalOcean settings accordingly?

If you want an easy way to build and check your package with R-devel,
and your package is on GitHub, consider using
https://github.com/metacran/r-builder

By default it builds and checks your package with R-oldrel, R-release
and R-devel, on Travis CI.

win-builder.r-project.org is another possibility, somewhat complementary.

Disclaimer: r-builder is my project, and I have no financial interests in it.

Best,
Gabor

>   Ben Bolker

[...]


From jonathan at mazamascience.com  Mon Jul 20 20:53:05 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Mon, 20 Jul 2015 11:53:05 -0700
Subject: [R-pkg-devel] recreating CRAN Testing environment
In-Reply-To: <CABtg=K=Bzbvtqwh_1vL+fN+u19Dr9OXiHWMsLT6UeoUe-P426Q@mail.gmail.com>
References: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
	<55AD3712.200@gmail.com>
	<CABtg=K=Bzbvtqwh_1vL+fN+u19Dr9OXiHWMsLT6UeoUe-P426Q@mail.gmail.com>
Message-ID: <CAPjNR=RjasqiR5-SKg5P+pirxGsCwyHdAuPgRa3=9WNFTXYg_g@mail.gmail.com>

Thanks to all so far for excellent suggestions!

On Mon, Jul 20, 2015 at 11:18 AM, G?bor Cs?rdi <csardi.gabor at gmail.com>
wrote:

> On Mon, Jul 20, 2015 at 1:59 PM, Ben Bolker <bbolker at gmail.com> wrote:
> [...]
> >    The most important thing that you haven't explicitly mentioned is
> > to test on the most recent development version of R (check out via
> > Subversion/configure/make/make install from scratch).  Can you adjust
> > your DigitalOcean settings accordingly?
>
> If you want an easy way to build and check your package with R-devel,
> and your package is on GitHub, consider using
> https://github.com/metacran/r-builder
>
> By default it builds and checks your package with R-oldrel, R-release
> and R-devel, on Travis CI.
>
> win-builder.r-project.org is another possibility, somewhat complementary.
>
> Disclaimer: r-builder is my project, and I have no financial interests in
> it.
>
> Best,
> Gabor
>
> >   Ben Bolker
>
> [...]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From Sebastien.Bihorel at cognigencorp.com  Mon Jul 20 23:05:34 2015
From: Sebastien.Bihorel at cognigencorp.com (sbihorel)
Date: Mon, 20 Jul 2015 17:05:34 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55A65EF1.3010700@gmail.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com> <55A65EF1.3010700@gmail.com>
Message-ID: <55AD629E.1070204@cognigencorp.com>

Hi,

Thanks to your suggestions and those of other responders, I was able to 
get rid of the warning messages returned during R CMD check.

However I am still confused by the .Rd file-related warnings I get when 
we install the packages. For instance:

Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file 
link "panel.abline"

I typed: \code{\link[lattice]{panel.abline}} on line 21 for the Rd file.

My NAMESPACE file includes:

  importFrom(lattice,panel.abline)

Surprisingly, other cross-references to lattice functions also imported 
using importFrom do not generate warning upon installation.

When I consider the full list of function links that generate warnings, 
it looks like all of them are associated with alias rather than name 
tags in the target .Rd file (for instance, panel.abline is documented in 
a .Rd file with \name{panel.functions}).

The CRAN manual is not clear on this point. Is there a specific syntax 
to use to document this types of links?

Thank you again for your time

Sebastien


On 7/15/2015 9:24 AM, Duncan Murdoch wrote:
> On 15/07/2015 9:07 AM, sbihorel wrote:
>> Hi,
>>
>> I saw a few recent posts on topics related to mine (eg
>> https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It
>> looks like I need to import more packages in my NAMESPACE, correct?
>>
>> However, I thought that imports would be recursive, ie imports would
>> also get the info from dependent packages.
> I haven't been following this thread, but the 2nd para above makes it
> sound as though an explanation of the NAMESPACE directives would be helpful.
>
> If you say
>
>   importFrom(Hmisc, latex)
>
> it acts as though you have made a copy of the Hmisc::latex function
> within your package environment.  (It isn't exported, unless you ask to
> export it.)
>
> If you say
>
>   import(Hmisc)
>
> it acts as though you have made copies of every exported function from
> Hmisc within your package environment.  This is why we recommend
> importing only the functions you need; otherwise your package
> environment gets bloated.
>
> No recursive copies are made, unless Hmisc happens to import something
> and re-exports it.
>
> When I say "acts as though", I don't mean it literally makes copies; it
> implements this in a more efficient way, basically only copying pointers
> to those functions -- but from a user point of view, you shouldn't be
> able to tell the difference, since you're not allowed to modify
> Hmisc::latex.
>
> Duncan Murdoch
>
>
>> Sebastien
>>
>>
>> On 7/13/2015 9:42 PM, sbihorel wrote:
>>> Hi,
>>>
>>> Sorry about the table. It looked good when displayed using a fixed
>>> width font. Let me try to linearize it:
>>>
>>>    * pkgA
>>>        o DESCRIPTION:
>>>            + Depends: methods, lattice, grid, gam
>>>            + Imports: Hmisc, survival
>>>        o NAMESPACE:
>>>            + import: lattice, grid, gam, methods
>>>            + importFrom: Hmisc (one function)
>>>    * pkgB
>>>        o DESCRIPTION:
>>>            + Depends: pkgA
>>>            + Imports: <nothing>
>>>        o NAMESPACE:
>>>            + import: pkgA
>>>            + importFrom: <nothing
>>>    * pkgC
>>>        o DESCRIPTION:
>>>            + Depends: methods, pkgB
>>>            + Imports: <nothing>
>>>        o NAMESPACE:
>>>            + import: methods, pkgB
>>>            + importFrom: <nothing
>>>
>>> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include:
>>> exportPattern("^[^\\.]").
>>>
>>> Sebastien
>>>
>>>
>>> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>>>> Are you exporting the functions from pkgB and pkgC? It's hard to tell
>>>> from your table below. The easiest way is to add a comment before
>>>> each of the functions in pkgB and pkgC that you want to expose to the
>>>> users.
>>>>
>>>> #' @export
>>>> foo <- function(){...}
>>>>
>>>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>>>>
>>>> HTH
>>>> Seth
>>>>
>>>> On Monday, July 13, 2015, sbihorel
>>>> <Sebastien.Bihorel at cognigencorp.com
>>>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>>>
>>>>      Hi,
>>>>
>>>>      My group has recently upgraded from a fairly old R version (2.12)
>>>>      to the
>>>>      R version 3.1.2. In parallel to this upgrade, I am updating our
>>>>      custom
>>>>      packages to add functionality and also make them compliant to the
>>>>      requirements of the new version of R. I would like to ask your
>>>>      help with
>>>>      respect to warning messages I get when I check and install the
>>>>      packages.
>>>>      I read the latest version of the manual on writing R extensions,
>>>>      try to
>>>>      apply the recommendations, but somehow I am not getting things right.
>>>>      Hopefully, with your suggestions, I could setup my package
>>>>      correctly to
>>>>      make these messages stop.
>>>>
>>>>      I apologize but, for confidentiality purpose, I will have to
>>>>      partially
>>>>      anonymize the information.
>>>>
>>>>      So here is the situation: we have 2 custom packages (let's call them
>>>>      pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>>>      call it
>>>>      pkgA) that is available on CRAN. The pkgC package depends on
>>>>      pkgB, make
>>>>      new function available,  and "overwrites" some of the functions
>>>>      distributed as part of pkgA. The following table summarizes the
>>>>      content
>>>>      of the DESCRIPTION and NAMESPACE files of each of these packages.
>>>>
>>>>      package    DESCRIPTION NAMESPACE
>>>>                  Depends                       Imports
>>>>      import                         importFrom
>>>>      pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>>>      grid,
>>>>      gam, methods    Hmisc
>>>>      pkgB       pkgA pkgA
>>>>      pkgC       methods, pkgB methods, pkgB
>>>>
>>>>      I do not get any warning when I build, check or install pkgB in our
>>>>      linux openSuse environment.
>>>>
>>>>      After successful building pkgC, I run R CMD check on my built for
>>>>      pkgC
>>>>      but I get a ton of messages under the "checking R code for possible
>>>>      problems" section. These notes are related to actual calls to pkgA
>>>>      functions (or to one of the function provided by its
>>>>      dependencies). Here
>>>>      is a subset for illustration and hopefully information.
>>>>
>>>>      * checking R code for possible problems: NOTE
>>>>      pkgC_function_001: no visible global function definition
>>>>      for"pkgA_function_AAA"
>>>>      pkgC_function_001: no visible global function definition
>>>>      for"pkgA_function_AAB"
>>>>      ...
>>>>      pkgC_function_010: no visible global function definition for"xyplot"
>>>>      pkgC_function_010: no visible global function definition
>>>>      for"panel.xyplot"
>>>>      pkgC_function_010: no visible global function definition
>>>>      for"panel.abline"
>>>>      pkgC_function_010: no visible global function definition
>>>>      for"grid.polygon"
>>>>      pkgC_function_010: no visible global function definition for"gpar"
>>>>      ...
>>>>
>>>>      Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>>>      following warnings about the content of my documentation Rd
>>>>      files. The
>>>>      Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>>>
>>>>      *** installing help indices
>>>>         converting help for package ?kiwixposedev?
>>>>           finding HTML links ... done
>>>>      pkgC_function_001                    html
>>>>           pkgC_function_002                    html
>>>>      ...
>>>>      Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>>>      link "panel.abline"
>>>>      ...
>>>>      Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>>>      link "pkA_function_AAC"
>>>>      ...
>>>>
>>>>      I think I need to somehow modify the content of the DESCRIPTION and
>>>>      NAMESPACE files for pkgC... but adding various combinations of
>>>>      pkA and
>>>>      its dependencies gave me others errors about redundancies and
>>>>      multiple
>>>>      loading of the same packages. So in short, I am kind of lost with the
>>>>      new requirements of R 3.1.2 and would greatly appreciate any help or
>>>>      suggestions
>>>>
>>>>      Thank you in advance for your time.
>>>>
>>>>      Sebastien Bihorel
>>>>
>>>>
>>>>              [[alternative HTML version deleted]]
>>>>
>>>>      ______________________________________________
>>>>      R-package-devel at r-project.org <javascript:;> mailing list
>>>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>


From h.wickham at gmail.com  Mon Jul 20 23:09:16 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 20 Jul 2015 16:09:16 -0500
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55A43DF3.4040509@gmail.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A43DF3.4040509@gmail.com>
Message-ID: <CABdHhvG7Q55Aw=WLZ63J26FfBMiYqwxQA4MhCEyiZT2nY0gJfw@mail.gmail.com>

On Mon, Jul 13, 2015 at 5:38 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 13/07/2015 5:36 PM, Seth Wenchel wrote:
>> Are you exporting the functions from pkgB and pkgC? It's hard to tell from
>> your table below. The easiest way is to add a comment before each of the
>> functions in pkgB and pkgC that you want to expose to the users.
>>
>> #' @export
>> foo <- function(){...}
>>
>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>
> That's very dangerous advice.  roxygen stomps on all kinds of things
> besides the things you want it to touch.

It used to, but it doesn't any more. (As far as I know - of course
there may be bugs)

Hadley

-- 
http://had.co.nz/


From mauricio.zambrano at ufrontera.cl  Mon Jul 20 23:05:05 2015
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Mon, 20 Jul 2015 18:05:05 -0300
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
Message-ID: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>

Dear list,

I'm trying to set up the development version of R (R-devel ) for
testing some packages before submitting them to CRAN. I'm using Linux
Mint 17.1 64-bit, which is an Ubuntu-based distro.

I followed the advice of Dirk on
https://stat.ethz.ch/pipermail/r-sig-debian/2012-August/001935.html


Everything seems to run fine until .configure:

R is now configured for x86_64-unknown-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local/lib/R-devel

  C compiler:                ccache gcc -std=gnu99  -g -O2
  Fortran 77 compiler:       gfortran  -g -O2

  C++ compiler:              ccache g++  -g -O2
  C++11 compiler:            ccache g++  -std=c++11 -g -O2
  Fortran 90/95 compiler:    gfortran -g -O2
  Obj-C compiler:

  Interfaces supported:      X11, tcltk
  External libraries:        readline, BLAS(generic), LAPACK(generic), curl
  Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo, ICU
  Options enabled:           shared R library, R profiling

  Capabilities skipped:
  Options not enabled:       shared BLAS, memory profiling

  Recommended packages:      no


However, when running make, I got an error saying:

"/usr/bin/ld: ../appl/dchdc.o: relocation R_X86_64_32 against
`.rodata' can not be used when making a shared object; recompile with
-fPIC"


I would highly appreciate any advice on how to solve this issue (or
what should I  recompile with -fPIC and how).


The full output of make was:


 $ make
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
make[1]: Nothing to be done for `front-matter'.
make[1]: Nothing to be done for `html-non-svn'.
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
SVN-REVISION is unchanged
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/m4'
make[1]: Nothing to be done for `R'.
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/m4'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/tools'
make[1]: Nothing to be done for `R'.
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/tools'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
make[2]: Nothing to be done for `R'.
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/etc'
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/etc'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/share'
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/share'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include'
Rmath.h is unchanged
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
make[3]: Nothing to be done for `R'.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: `Makedeps' is up to date.
make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: `libtre.a' is up to date.
make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[3]: `libappl.a' is up to date.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[3]: `libnmath.a' is up to date.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[3]: `libunix.a' is up to date.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
ccache gcc -std=gnu99 -I. -I../../src/include -I../../src/include
-I/usr/local/include -DHAVE_CONFIG_H   -fopenmp -fpic  -g -O2
-L/usr/local/lib -DR_HOME='"/home/hzambran/SVN/R-devel/trunk"' \
 -o Rscript ./Rscript.c
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
ccache gcc -std=gnu99 -shared -fopenmp -L/usr/local/lib  -o libR.so
CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o
arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o
colors.o complex.o connections.o context.o cum.o dcf.o datetime.o
debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o
edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o
gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o
iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o
match.o memory.o names.o objects.o options.o paste.o platform.o plot.o
plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o
qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o
scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o
subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o
util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o
xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`
../extra/tre/libtre.a    -lblas -lgfortran -lm -lquadmath   -lreadline
 -lpcre -llzma -lbz2 -lz -lrt -ldl -lm -licuuc -licui18n
/usr/bin/ld: ../appl/dchdc.o: relocation R_X86_64_32 against `.rodata'
can not be used when making a shared object; recompile with -fPIC
../appl/dchdc.o: error adding symbols: Bad value
collect2: error: ld returned 1 exit status
make[3]: *** [libR.so] Error 1
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
make[2]: *** [R] Error 2
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src'
make: *** [R] Error 1


Kind regards,

Mauricio Zambrano-Bigiarini, PhD

=====================================
Dept. of Civil Engineering
Faculty of Engineering and Sciences
Universidad de La Frontera
PO Box 54-D, Temuco, Chile
=====================================
mailto     : mauricio.zambrano at ufrontera.cl
work-phone : +56 45 259 2812
http://ingenieriacivil.ufro.cl/
=====================================
"When the pupil is ready, the master arrives."
(Zen proverb)
=====================================
Linux user #454569 -- Linux Mint user


From edd at debian.org  Mon Jul 20 23:35:21 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 20 Jul 2015 16:35:21 -0500
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
In-Reply-To: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
References: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
Message-ID: <21933.27033.110866.890791@max.nulle.part>


On 20 July 2015 at 18:05, MAURICIO ZAMBRANO BIGIARINI wrote:
| Dear list,
| 
| I'm trying to set up the development version of R (R-devel ) for
| testing some packages before submitting them to CRAN. I'm using Linux
| Mint 17.1 64-bit, which is an Ubuntu-based distro.
| 
| I followed the advice of Dirk on
| https://stat.ethz.ch/pipermail/r-sig-debian/2012-August/001935.html
| 
| 
| Everything seems to run fine until .configure:
| 
| R is now configured for x86_64-unknown-linux-gnu
| 
|   Source directory:          .
|   Installation directory:    /usr/local/lib/R-devel
| 
|   C compiler:                ccache gcc -std=gnu99  -g -O2
|   Fortran 77 compiler:       gfortran  -g -O2
| 
|   C++ compiler:              ccache g++  -g -O2
|   C++11 compiler:            ccache g++  -std=c++11 -g -O2
|   Fortran 90/95 compiler:    gfortran -g -O2
|   Obj-C compiler:
| 
|   Interfaces supported:      X11, tcltk
|   External libraries:        readline, BLAS(generic), LAPACK(generic), curl
|   Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo, ICU
|   Options enabled:           shared R library, R profiling
| 
|   Capabilities skipped:
|   Options not enabled:       shared BLAS, memory profiling
| 
|   Recommended packages:      no

Looks good but ...
| 
| 
| However, when running make, I got an error saying:
| 
| "/usr/bin/ld: ../appl/dchdc.o: relocation R_X86_64_32 against
| `.rodata' can not be used when making a shared object; recompile with
| -fPIC"
| 
| 
| I would highly appreciate any advice on how to solve this issue (or
| what should I  recompile with -fPIC and how).

... naybe your R was built without shared library support?  The binaries
resulting from my configuration (ie the Debian or Ubuntu packages obtained
either from the distro themselves or the CRAN mirrors) have 'pic' set:

edd at max:~$ grep -i pic /etc/R/Makeconf 
CPICFLAGS = -fpic
CXXPICFLAGS = -fpic
CXX1XPICFLAGS = -fpic
DYLIB_LDFLAGS = -shared -fopenmp# $(CFLAGS) $(CPICFLAGS)
FCPICFLAGS = -fpic
FPICFLAGS = -fpic
SHLIB_LDFLAGS = -shared# $(CFLAGS) $(CPICFLAGS)
## We want to ensure libR is picked up from $(R_HOME)/lib
ALL_CFLAGS = $(R_XTRA_CFLAGS) $(PKG_CFLAGS) $(CPICFLAGS) $(SHLIB_CFLAGS) $(CFLAGS)
ALL_CXXFLAGS = $(R_XTRA_CXXFLAGS) $(PKG_CXXFLAGS) $(CXXPICFLAGS) $(SHLIB_CXXFLAGS) $(CXXFLAGS)
ALL_OBJCFLAGS = $(PKG_OBJCFLAGS) $(CPICFLAGS) $(SHLIB_CFLAGS) $(OBJCFLAGS)
ALL_OBJCXXFLAGS = $(PKG_OBJCXXFLAGS) $(CXXPICFLAGS) $(SHLIB_CXXFLAGS) $(OBJCXXFLAGS)
ALL_FFLAGS = $(R_XTRA_FFLAGS) $(PKG_FFLAGS) $(FPICFLAGS) $(SHLIB_FFLAGS) $(FFLAGS)
	$(FC) $(PKG_FCFLAGS) $(FCPICFLAGS) $(FCFLAGS) -c  $< -o $@
	$(FC) $(PKG_FCFLAGS) $(FCPICFLAGS) $(FCFLAGS) -c  $< -o $@
edd at max:~$

Here /etc/R/Makefonf is just a convenient link to $(R_HOME)/etc/Makeconf.

Dirk


-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jenny at stat.ubc.ca  Mon Jul 20 23:45:41 2015
From: jenny at stat.ubc.ca (Jennifer Bryan)
Date: Mon, 20 Jul 2015 14:45:41 -0700
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55AD629E.1070204@cognigencorp.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com> <55A65EF1.3010700@gmail.com>
	<55AD629E.1070204@cognigencorp.com>
Message-ID: <BDE283C7-81EC-4FD8-9417-5477899FE712@stat.ubc.ca>

Hi Sebastien,

This note about Rd warnings reminded me that I recently had the same problem. So I recreated it and, I think, have found a solution.

I will explain in my specific example to be clear.

I need to link to the docs for the Token2.0 class from the httr package. First thing you try:

\code{\link[httr]{Token2.0}}

but then you get the warnings you describe upon installation. As in your case, the Token2.0 class doesn?t have it?s own .Rd file but is, rather, documented in the topic titled ?Token-class?.

Next thing you try:

\code{\link[httr]{Token-class}}

which works, but I don?t like this display text ? it doesn?t really make sense in the context of *my* documentation.

Finally you do this:

\code{\link[=Token-class]{Token2.0}}

to link to the correct topic but get the desired display text. However, I am no longer specifying that this topic is from the httr package, but it seems to work.

Maybe someone else can weigh in with more insight about the need / desirability of specifying the associated package.

? Jenny

> On Jul 20, 2015, at 2:05 PM, sbihorel <Sebastien.Bihorel at cognigencorp.com> wrote:
> 
> Hi,
> 
> Thanks to your suggestions and those of other responders, I was able to get rid of the warning messages returned during R CMD check.
> 
> However I am still confused by the .Rd file-related warnings I get when we install the packages. For instance:
> 
> Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file link "panel.abline"
> 
> I typed: \code{\link[lattice]{panel.abline}} on line 21 for the Rd file.
> 
> My NAMESPACE file includes:
> 
> importFrom(lattice,panel.abline)
> 
> Surprisingly, other cross-references to lattice functions also imported using importFrom do not generate warning upon installation.
> 
> When I consider the full list of function links that generate warnings, it looks like all of them are associated with alias rather than name tags in the target .Rd file (for instance, panel.abline is documented in a .Rd file with \name{panel.functions}).
> 
> The CRAN manual is not clear on this point. Is there a specific syntax to use to document this types of links?
> 
> Thank you again for your time
> 
> Sebastien
> 
> 
> On 7/15/2015 9:24 AM, Duncan Murdoch wrote:
>> On 15/07/2015 9:07 AM, sbihorel wrote:
>>> Hi,
>>> 
>>> I saw a few recent posts on topics related to mine (eg
>>> https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It
>>> looks like I need to import more packages in my NAMESPACE, correct?
>>> 
>>> However, I thought that imports would be recursive, ie imports would
>>> also get the info from dependent packages.
>> I haven't been following this thread, but the 2nd para above makes it
>> sound as though an explanation of the NAMESPACE directives would be helpful.
>> 
>> If you say
>> 
>>  importFrom(Hmisc, latex)
>> 
>> it acts as though you have made a copy of the Hmisc::latex function
>> within your package environment.  (It isn't exported, unless you ask to
>> export it.)
>> 
>> If you say
>> 
>>  import(Hmisc)
>> 
>> it acts as though you have made copies of every exported function from
>> Hmisc within your package environment.  This is why we recommend
>> importing only the functions you need; otherwise your package
>> environment gets bloated.
>> 
>> No recursive copies are made, unless Hmisc happens to import something
>> and re-exports it.
>> 
>> When I say "acts as though", I don't mean it literally makes copies; it
>> implements this in a more efficient way, basically only copying pointers
>> to those functions -- but from a user point of view, you shouldn't be
>> able to tell the difference, since you're not allowed to modify
>> Hmisc::latex.
>> 
>> Duncan Murdoch
>> 
>> 
>>> Sebastien
>>> 
>>> 
>>> On 7/13/2015 9:42 PM, sbihorel wrote:
>>>> Hi,
>>>> 
>>>> Sorry about the table. It looked good when displayed using a fixed
>>>> width font. Let me try to linearize it:
>>>> 
>>>>   * pkgA
>>>>       o DESCRIPTION:
>>>>           + Depends: methods, lattice, grid, gam
>>>>           + Imports: Hmisc, survival
>>>>       o NAMESPACE:
>>>>           + import: lattice, grid, gam, methods
>>>>           + importFrom: Hmisc (one function)
>>>>   * pkgB
>>>>       o DESCRIPTION:
>>>>           + Depends: pkgA
>>>>           + Imports: <nothing>
>>>>       o NAMESPACE:
>>>>           + import: pkgA
>>>>           + importFrom: <nothing
>>>>   * pkgC
>>>>       o DESCRIPTION:
>>>>           + Depends: methods, pkgB
>>>>           + Imports: <nothing>
>>>>       o NAMESPACE:
>>>>           + import: methods, pkgB
>>>>           + importFrom: <nothing
>>>> 
>>>> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include:
>>>> exportPattern("^[^\\.]").
>>>> 
>>>> Sebastien
>>>> 
>>>> 
>>>> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>>>>> Are you exporting the functions from pkgB and pkgC? It's hard to tell
>>>>> from your table below. The easiest way is to add a comment before
>>>>> each of the functions in pkgB and pkgC that you want to expose to the
>>>>> users.
>>>>> 
>>>>> #' @export
>>>>> foo <- function(){...}
>>>>> 
>>>>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>>>>> 
>>>>> HTH
>>>>> Seth
>>>>> 
>>>>> On Monday, July 13, 2015, sbihorel
>>>>> <Sebastien.Bihorel at cognigencorp.com
>>>>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>>>> 
>>>>>     Hi,
>>>>> 
>>>>>     My group has recently upgraded from a fairly old R version (2.12)
>>>>>     to the
>>>>>     R version 3.1.2. In parallel to this upgrade, I am updating our
>>>>>     custom
>>>>>     packages to add functionality and also make them compliant to the
>>>>>     requirements of the new version of R. I would like to ask your
>>>>>     help with
>>>>>     respect to warning messages I get when I check and install the
>>>>>     packages.
>>>>>     I read the latest version of the manual on writing R extensions,
>>>>>     try to
>>>>>     apply the recommendations, but somehow I am not getting things right.
>>>>>     Hopefully, with your suggestions, I could setup my package
>>>>>     correctly to
>>>>>     make these messages stop.
>>>>> 
>>>>>     I apologize but, for confidentiality purpose, I will have to
>>>>>     partially
>>>>>     anonymize the information.
>>>>> 
>>>>>     So here is the situation: we have 2 custom packages (let's call them
>>>>>     pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>>>>     call it
>>>>>     pkgA) that is available on CRAN. The pkgC package depends on
>>>>>     pkgB, make
>>>>>     new function available,  and "overwrites" some of the functions
>>>>>     distributed as part of pkgA. The following table summarizes the
>>>>>     content
>>>>>     of the DESCRIPTION and NAMESPACE files of each of these packages.
>>>>> 
>>>>>     package    DESCRIPTION NAMESPACE
>>>>>                 Depends                       Imports
>>>>>     import                         importFrom
>>>>>     pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>>>>     grid,
>>>>>     gam, methods    Hmisc
>>>>>     pkgB       pkgA pkgA
>>>>>     pkgC       methods, pkgB methods, pkgB
>>>>> 
>>>>>     I do not get any warning when I build, check or install pkgB in our
>>>>>     linux openSuse environment.
>>>>> 
>>>>>     After successful building pkgC, I run R CMD check on my built for
>>>>>     pkgC
>>>>>     but I get a ton of messages under the "checking R code for possible
>>>>>     problems" section. These notes are related to actual calls to pkgA
>>>>>     functions (or to one of the function provided by its
>>>>>     dependencies). Here
>>>>>     is a subset for illustration and hopefully information.
>>>>> 
>>>>>     * checking R code for possible problems: NOTE
>>>>>     pkgC_function_001: no visible global function definition
>>>>>     for"pkgA_function_AAA"
>>>>>     pkgC_function_001: no visible global function definition
>>>>>     for"pkgA_function_AAB"
>>>>>     ...
>>>>>     pkgC_function_010: no visible global function definition for"xyplot"
>>>>>     pkgC_function_010: no visible global function definition
>>>>>     for"panel.xyplot"
>>>>>     pkgC_function_010: no visible global function definition
>>>>>     for"panel.abline"
>>>>>     pkgC_function_010: no visible global function definition
>>>>>     for"grid.polygon"
>>>>>     pkgC_function_010: no visible global function definition for"gpar"
>>>>>     ...
>>>>> 
>>>>>     Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>>>>     following warnings about the content of my documentation Rd
>>>>>     files. The
>>>>>     Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>>>> 
>>>>>     *** installing help indices
>>>>>        converting help for package ?kiwixposedev?
>>>>>          finding HTML links ... done
>>>>>     pkgC_function_001                    html
>>>>>          pkgC_function_002                    html
>>>>>     ...
>>>>>     Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>>>>     link "panel.abline"
>>>>>     ...
>>>>>     Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>>>>     link "pkA_function_AAC"
>>>>>     ...
>>>>> 
>>>>>     I think I need to somehow modify the content of the DESCRIPTION and
>>>>>     NAMESPACE files for pkgC... but adding various combinations of
>>>>>     pkA and
>>>>>     its dependencies gave me others errors about redundancies and
>>>>>     multiple
>>>>>     loading of the same packages. So in short, I am kind of lost with the
>>>>>     new requirements of R 3.1.2 and would greatly appreciate any help or
>>>>>     suggestions
>>>>> 
>>>>>     Thank you in advance for your time.
>>>>> 
>>>>>     Sebastien Bihorel
>>>>> 
>>>>> 
>>>>>             [[alternative HTML version deleted]]
>>>>> 
>>>>>     ______________________________________________
>>>>>     R-package-devel at r-project.org <javascript:;> mailing list
>>>>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From mauricio.zambrano at ufrontera.cl  Mon Jul 20 23:56:04 2015
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Mon, 20 Jul 2015 18:56:04 -0300
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
In-Reply-To: <21933.27033.110866.890791@max.nulle.part>
References: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
	<21933.27033.110866.890791@max.nulle.part>
Message-ID: <CAP6Varv1DJE7zR3M5XYG79AVzGxcp1wpR7AgsfS5UOvVmsFavg@mail.gmail.com>

=====================================
"When the pupil is ready, the master arrives."
(Zen proverb)
=====================================
Linux user #454569 -- Linux Mint user


On 20 July 2015 at 18:35, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> On 20 July 2015 at 18:05, MAURICIO ZAMBRANO BIGIARINI wrote:
> | Dear list,
> |
> | I'm trying to set up the development version of R (R-devel ) for
> | testing some packages before submitting them to CRAN. I'm using Linux
> | Mint 17.1 64-bit, which is an Ubuntu-based distro.
> |
> | I followed the advice of Dirk on
> | https://stat.ethz.ch/pipermail/r-sig-debian/2012-August/001935.html
> |
> |
> | Everything seems to run fine until .configure:
> |
> | R is now configured for x86_64-unknown-linux-gnu
> |
> |   Source directory:          .
> |   Installation directory:    /usr/local/lib/R-devel
> |
> |   C compiler:                ccache gcc -std=gnu99  -g -O2
> |   Fortran 77 compiler:       gfortran  -g -O2
> |
> |   C++ compiler:              ccache g++  -g -O2
> |   C++11 compiler:            ccache g++  -std=c++11 -g -O2
> |   Fortran 90/95 compiler:    gfortran -g -O2
> |   Obj-C compiler:
> |
> |   Interfaces supported:      X11, tcltk
> |   External libraries:        readline, BLAS(generic), LAPACK(generic), curl
> |   Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo, ICU
> |   Options enabled:           shared R library, R profiling
> |
> |   Capabilities skipped:
> |   Options not enabled:       shared BLAS, memory profiling
> |
> |   Recommended packages:      no
>
> Looks good but ...
> |
> |
> | However, when running make, I got an error saying:
> |
> | "/usr/bin/ld: ../appl/dchdc.o: relocation R_X86_64_32 against
> | `.rodata' can not be used when making a shared object; recompile with
> | -fPIC"
> |
> |
> | I would highly appreciate any advice on how to solve this issue (or
> | what should I  recompile with -fPIC and how).
>
> ... naybe your R was built without shared library support?  The binaries
> resulting from my configuration (ie the Debian or Ubuntu packages obtained
> either from the distro themselves or the CRAN mirrors) have 'pic' set:
>
> edd at max:~$ grep -i pic /etc/R/Makeconf
> CPICFLAGS = -fpic
> CXXPICFLAGS = -fpic
> CXX1XPICFLAGS = -fpic
> DYLIB_LDFLAGS = -shared -fopenmp# $(CFLAGS) $(CPICFLAGS)
> FCPICFLAGS = -fpic
> FPICFLAGS = -fpic
> SHLIB_LDFLAGS = -shared# $(CFLAGS) $(CPICFLAGS)
> ## We want to ensure libR is picked up from $(R_HOME)/lib
> ALL_CFLAGS = $(R_XTRA_CFLAGS) $(PKG_CFLAGS) $(CPICFLAGS) $(SHLIB_CFLAGS) $(CFLAGS)
> ALL_CXXFLAGS = $(R_XTRA_CXXFLAGS) $(PKG_CXXFLAGS) $(CXXPICFLAGS) $(SHLIB_CXXFLAGS) $(CXXFLAGS)
> ALL_OBJCFLAGS = $(PKG_OBJCFLAGS) $(CPICFLAGS) $(SHLIB_CFLAGS) $(OBJCFLAGS)
> ALL_OBJCXXFLAGS = $(PKG_OBJCXXFLAGS) $(CXXPICFLAGS) $(SHLIB_CXXFLAGS) $(OBJCXXFLAGS)
> ALL_FFLAGS = $(R_XTRA_FFLAGS) $(PKG_FFLAGS) $(FPICFLAGS) $(SHLIB_FFLAGS) $(FFLAGS)
>         $(FC) $(PKG_FCFLAGS) $(FCPICFLAGS) $(FCFLAGS) -c  $< -o $@
>         $(FC) $(PKG_FCFLAGS) $(FCPICFLAGS) $(FCFLAGS) -c  $< -o $@
> edd at max:~$
>
> Here /etc/R/Makefonf is just a convenient link to $(R_HOME)/etc/Makeconf.
>
> Dirk
>

Thank you very much Dirk, but I forgot to mention that this is my very
first time trying to set up R-devel.


In my ~/SVN/R-devel/trunk/Makeconf file I currently don't have the
first two lines you mentioned:

 CPICFLAGS = -fpic
 CXXPICFLAGS = -fpic

and instead of

SHLIB_LDFLAGS = -shared# $(CFLAGS) $(CPICFLAGS)

I have

DYLIB_LDFLAGS = -shared -fopenmp# $(DYLIBS_LTO)

how can I be sure that I I enabled the shared library support ?


Mauricio


From edd at debian.org  Tue Jul 21 00:21:36 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 20 Jul 2015 17:21:36 -0500
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
In-Reply-To: <CAP6Varv1DJE7zR3M5XYG79AVzGxcp1wpR7AgsfS5UOvVmsFavg@mail.gmail.com>
References: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
	<21933.27033.110866.890791@max.nulle.part>
	<CAP6Varv1DJE7zR3M5XYG79AVzGxcp1wpR7AgsfS5UOvVmsFavg@mail.gmail.com>
Message-ID: <21933.29808.631915.278236@max.nulle.part>


On 20 July 2015 at 18:56, MAURICIO ZAMBRANO BIGIARINI wrote:
| how can I be sure that I I enabled the shared library support ?

edd at max:~/svn/r-devel$ ./configure --help | grep enable-R-sh
  --enable-R-shlib        build the shared/dynamic library 'libR' [no]
edd at max:~/svn/r-devel$

Make sure you set --enable-R-shlib.

It is in the script which you linked to in your previous email.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From mauricio.zambrano at ufrontera.cl  Tue Jul 21 00:49:59 2015
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Mon, 20 Jul 2015 19:49:59 -0300
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
In-Reply-To: <21933.29808.631915.278236@max.nulle.part>
References: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
	<21933.27033.110866.890791@max.nulle.part>
	<CAP6Varv1DJE7zR3M5XYG79AVzGxcp1wpR7AgsfS5UOvVmsFavg@mail.gmail.com>
	<21933.29808.631915.278236@max.nulle.part>
Message-ID: <CAP6VarsWxDAjKOvsXV0Vt14yN5bN1+EnN=aO6X+DcHMusXGfig@mail.gmail.com>

---------- Forwarded message ----------
From: Dirk Eddelbuettel <edd at debian.org>
Date: 20 July 2015 at 19:21
Subject: Re: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
To: MAURICIO ZAMBRANO BIGIARINI <mauricio.zambrano at ufrontera.cl>
Cc: Dirk Eddelbuettel <edd at debian.org>, r-package-devel at r-project.org



On 20 July 2015 at 18:56, MAURICIO ZAMBRANO BIGIARINI wrote:
| how can I be sure that I I enabled the shared library support ?

edd at max:~/svn/r-devel$ ./configure --help | grep enable-R-sh
  --enable-R-shlib        build the shared/dynamic library 'libR' [no]
edd at max:~/svn/r-devel$

Make sure you set --enable-R-shlib.

It is in the script which you linked to in your previous email.


I thought I did it already when running configure:

./configure --prefix=/usr/local/lib/R-devel --enable-R-shlib
--with-blas --with-lapack --with-readline
--without-recommended-packages



I just tried to run again your script (mentioned in my previous
e-mail) from scratch and I'm still getting an error:

R is now configured for x86_64-unknown-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local/lib/R-devel

  C compiler:                ccache gcc  -ggdb -pipe -std=gnu99 -Wall -pedantic
  Fortran 77 compiler:       ccache gfortran  -g -O2

  C++ compiler:              ccache g++  -ggdb -pipe -Wall -pedantic
  C++11 compiler:            ccache g++  -std=c++11 -ggdb -pipe -Wall -pedantic
  Fortran 90/95 compiler:    ccache gfortran -g -O2
  Obj-C compiler:

  Interfaces supported:      X11, tcltk
  External libraries:        readline, BLAS(generic), LAPACK(generic), curl
  Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo, ICU
  Options enabled:           shared R library, R profiling

  Capabilities skipped:
  Options not enabled:       shared BLAS, memory profiling

  Recommended packages:      no

make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
make[1]: Nothing to be done for `front-matter'.
make[1]: Nothing to be done for `html-non-svn'.
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
SVN-REVISION is unchanged
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/m4'
make[1]: Nothing to be done for `R'.
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/m4'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/tools'
make[1]: Nothing to be done for `R'.
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/tools'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
make[2]: Nothing to be done for `R'.
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/etc'
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/etc'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/share'
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/share'
make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
creating src/scripts/R.fe
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include'
config.status: creating src/include/config.h
config.status: src/include/config.h is unchanged
Rmath.h is unchanged
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
make[3]: Nothing to be done for `R'.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[4]: `libtre.a' is up to date.
make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[3]: `libappl.a' is up to date.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[3]: `libnmath.a' is up to date.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[3]: `libunix.a' is up to date.
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
ccache gcc -I. -I../../src/include -I../../src/include
-I/usr/local/include -DHAVE_CONFIG_H   -fopenmp -fpic  -ggdb -pipe
-std=gnu99 -Wall -pedantic  -L/usr/local/lib
-DR_HOME='"/home/hzambran/SVN/R-devel/trunk"' \
 -o Rscript ./Rscript.c
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
ccache gcc -shared -fopenmp -L/usr/local/lib  -o libR.so
CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o
arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o
colors.o complex.o connections.o context.o cum.o dcf.o datetime.o
debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o
edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o
gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o
iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o
match.o memory.o names.o objects.o options.o paste.o platform.o plot.o
plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o
qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o
scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o
subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o
util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o
xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`
../extra/tre/libtre.a    -lblas -lgfortran -lm -lquadmath   -lreadline
 -lpcre -llzma -lbz2 -lz -lrt -ldl -lm -licuuc -licui18n
/usr/bin/ld: ../appl/dchdc.o: relocation R_X86_64_32 against `.rodata'
can not be used when making a shared object; recompile with -fPIC
../appl/dchdc.o: error adding symbols: Bad value
collect2: error: ld returned 1 exit status
make[3]: *** [libR.so] Error 1
make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
make[2]: *** [R] Error 2
make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src'
make: *** [R] Error 1
*** Done -- now run 'make install'


Any thoughts what I'm doing wrong ?


Mauricio


From pdalgd at gmail.com  Tue Jul 21 01:29:56 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 21 Jul 2015 01:29:56 +0200
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
In-Reply-To: <CAP6VarsWxDAjKOvsXV0Vt14yN5bN1+EnN=aO6X+DcHMusXGfig@mail.gmail.com>
References: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
	<21933.27033.110866.890791@max.nulle.part>
	<CAP6Varv1DJE7zR3M5XYG79AVzGxcp1wpR7AgsfS5UOvVmsFavg@mail.gmail.com>
	<21933.29808.631915.278236@max.nulle.part>
	<CAP6VarsWxDAjKOvsXV0Vt14yN5bN1+EnN=aO6X+DcHMusXGfig@mail.gmail.com>
Message-ID: <EDCE984C-28F0-484E-A911-4073FD9B2D8E@gmail.com>

Oi!

Could you guys move to r-devel? This has nothing to do with _package_ development.

-Peter D

> On 21 Jul 2015, at 00:49 , MAURICIO ZAMBRANO BIGIARINI <mauricio.zambrano at ufrontera.cl> wrote:
> 
> ---------- Forwarded message ----------
> From: Dirk Eddelbuettel <edd at debian.org>
> Date: 20 July 2015 at 19:21
> Subject: Re: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
> To: MAURICIO ZAMBRANO BIGIARINI <mauricio.zambrano at ufrontera.cl>
> Cc: Dirk Eddelbuettel <edd at debian.org>, r-package-devel at r-project.org
> 
> 
> 
> On 20 July 2015 at 18:56, MAURICIO ZAMBRANO BIGIARINI wrote:
> | how can I be sure that I I enabled the shared library support ?
> 
> edd at max:~/svn/r-devel$ ./configure --help | grep enable-R-sh
>  --enable-R-shlib        build the shared/dynamic library 'libR' [no]
> edd at max:~/svn/r-devel$
> 
> Make sure you set --enable-R-shlib.
> 
> It is in the script which you linked to in your previous email.
> 
> 
> I thought I did it already when running configure:
> 
> ./configure --prefix=/usr/local/lib/R-devel --enable-R-shlib
> --with-blas --with-lapack --with-readline
> --without-recommended-packages
> 
> 
> 
> I just tried to run again your script (mentioned in my previous
> e-mail) from scratch and I'm still getting an error:
> 
> R is now configured for x86_64-unknown-linux-gnu
> 
>  Source directory:          .
>  Installation directory:    /usr/local/lib/R-devel
> 
>  C compiler:                ccache gcc  -ggdb -pipe -std=gnu99 -Wall -pedantic
>  Fortran 77 compiler:       ccache gfortran  -g -O2
> 
>  C++ compiler:              ccache g++  -ggdb -pipe -Wall -pedantic
>  C++11 compiler:            ccache g++  -std=c++11 -ggdb -pipe -Wall -pedantic
>  Fortran 90/95 compiler:    ccache gfortran -g -O2
>  Obj-C compiler:
> 
>  Interfaces supported:      X11, tcltk
>  External libraries:        readline, BLAS(generic), LAPACK(generic), curl
>  Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo, ICU
>  Options enabled:           shared R library, R profiling
> 
>  Capabilities skipped:
>  Options not enabled:       shared BLAS, memory profiling
> 
>  Recommended packages:      no
> 
> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
> make[1]: Nothing to be done for `front-matter'.
> make[1]: Nothing to be done for `html-non-svn'.
> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
> SVN-REVISION is unchanged
> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/m4'
> make[1]: Nothing to be done for `R'.
> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/m4'
> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/tools'
> make[1]: Nothing to be done for `R'.
> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/tools'
> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
> make[2]: Nothing to be done for `R'.
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc'
> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/etc'
> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/etc'
> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/share'
> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/share'
> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
> creating src/scripts/R.fe
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include'
> config.status: creating src/include/config.h
> config.status: src/include/config.h is unchanged
> Rmath.h is unchanged
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
> make[3]: Nothing to be done for `R'.
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
> make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
> make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
> make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
> make[4]: `libtre.a' is up to date.
> make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
> make[3]: `libappl.a' is up to date.
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
> make[3]: `libnmath.a' is up to date.
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
> make[3]: `libunix.a' is up to date.
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
> ccache gcc -I. -I../../src/include -I../../src/include
> -I/usr/local/include -DHAVE_CONFIG_H   -fopenmp -fpic  -ggdb -pipe
> -std=gnu99 -Wall -pedantic  -L/usr/local/lib
> -DR_HOME='"/home/hzambran/SVN/R-devel/trunk"' \
> -o Rscript ./Rscript.c
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
> ccache gcc -shared -fopenmp -L/usr/local/lib  -o libR.so
> CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o
> arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o
> colors.o complex.o connections.o context.o cum.o dcf.o datetime.o
> debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o
> edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o
> gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o
> iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o
> match.o memory.o names.o objects.o options.o paste.o platform.o plot.o
> plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o
> qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o
> scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o
> subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o
> util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o
> xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`
> ../extra/tre/libtre.a    -lblas -lgfortran -lm -lquadmath   -lreadline
> -lpcre -llzma -lbz2 -lz -lrt -ldl -lm -licuuc -licui18n
> /usr/bin/ld: ../appl/dchdc.o: relocation R_X86_64_32 against `.rodata'
> can not be used when making a shared object; recompile with -fPIC
> ../appl/dchdc.o: error adding symbols: Bad value
> collect2: error: ld returned 1 exit status
> make[3]: *** [libR.so] Error 1
> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
> make[2]: *** [R] Error 2
> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src'
> make: *** [R] Error 1
> *** Done -- now run 'make install'
> 
> 
> Any thoughts what I'm doing wrong ?
> 
> 
> Mauricio
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ligges at statistik.tu-dortmund.de  Tue Jul 21 03:39:58 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 21 Jul 2015 03:39:58 +0200
Subject: [R-pkg-devel] recreating CRAN Testing environment
In-Reply-To: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
References: <CAPjNR=Qja27ywntJ0CDLsefKNyau=J2W7tcsn19KYhkm3qceaA@mail.gmail.com>
Message-ID: <55ADA2EE.3030508@statistik.tu-dortmund.de>



On 20.07.2015 19:50, Jonathan Callahan wrote:
> I am (hopefully) at the end of a series of back-and-forth submissions of a
> package to the CRAN upload site.
>
> I have done my best to test things by:
>
>     - using devtools

Not needed at all.

>     - running "R CMD check --as-cran" on the command line

Perfect.

But the R version should be a recent version of R-devel.

Best,
Uwe Ligges


>     - checking my package on OSX, win-builder.R and various 32 and 64 bit
>     linux virtual machines at DigitalOcean
>
> But I have never managed to recreate all of the notes and warning messages
> that the CRAN testing comes up with.
>
> In an effort to save time and effort on both ends, can anyone advise on
> what I need to do to generate ALL the warning messages that the CRAN
> testing will find?
>
>
>


From mauricio.zambrano at ufrontera.cl  Tue Jul 21 04:57:55 2015
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Mon, 20 Jul 2015 23:57:55 -0300
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
In-Reply-To: <EDCE984C-28F0-484E-A911-4073FD9B2D8E@gmail.com>
References: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
	<21933.27033.110866.890791@max.nulle.part>
	<CAP6Varv1DJE7zR3M5XYG79AVzGxcp1wpR7AgsfS5UOvVmsFavg@mail.gmail.com>
	<21933.29808.631915.278236@max.nulle.part>
	<CAP6VarsWxDAjKOvsXV0Vt14yN5bN1+EnN=aO6X+DcHMusXGfig@mail.gmail.com>
	<EDCE984C-28F0-484E-A911-4073FD9B2D8E@gmail.com>
Message-ID: <CAP6VarsHA-m7r4AoL1Fdh5D=BtRacHoYU2RO5hhp_a54Khk1tQ@mail.gmail.com>

On 20 July 2015 at 20:29, peter dalgaard <pdalgd at gmail.com> wrote:
> Oi!
>
> Could you guys move to r-devel? This has nothing to do with _package_ development.

Thanks for the advice. I was not sure about the list I should have
submitted this message, but looking at
http://www.r-project.org/mail.html:

R-package-devel
is to get help about package development in R,...
If you are having problems developing a package or passing R CMD
check, this is the place to ask!
....

R-devel:
This list is intended for questions and discussion about code
development in R.  ...
The list is also for proposals of new functionality for R, and
pre-testing of new versions. It is meant particularly for those who
maintain an active position in the development of R.


and as my original intend was to passing R CMD check--as-cran using
the development version of R, I chose r-package-devel.


I'll create a shorten version of this message in r-devel (not sure if
this is the right way of moving a message from one mailing list to
another).

Mauricio

>
> -Peter D
>
>> On 21 Jul 2015, at 00:49 , MAURICIO ZAMBRANO BIGIARINI <mauricio.zambrano at ufrontera.cl> wrote:
>>
>> ---------- Forwarded message ----------
>> From: Dirk Eddelbuettel <edd at debian.org>
>> Date: 20 July 2015 at 19:21
>> Subject: Re: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
>> To: MAURICIO ZAMBRANO BIGIARINI <mauricio.zambrano at ufrontera.cl>
>> Cc: Dirk Eddelbuettel <edd at debian.org>, r-package-devel at r-project.org
>>
>>
>>
>> On 20 July 2015 at 18:56, MAURICIO ZAMBRANO BIGIARINI wrote:
>> | how can I be sure that I I enabled the shared library support ?
>>
>> edd at max:~/svn/r-devel$ ./configure --help | grep enable-R-sh
>>  --enable-R-shlib        build the shared/dynamic library 'libR' [no]
>> edd at max:~/svn/r-devel$
>>
>> Make sure you set --enable-R-shlib.
>>
>> It is in the script which you linked to in your previous email.
>>
>>
>> I thought I did it already when running configure:
>>
>> ./configure --prefix=/usr/local/lib/R-devel --enable-R-shlib
>> --with-blas --with-lapack --with-readline
>> --without-recommended-packages
>>
>>
>>
>> I just tried to run again your script (mentioned in my previous
>> e-mail) from scratch and I'm still getting an error:
>>
>> R is now configured for x86_64-unknown-linux-gnu
>>
>>  Source directory:          .
>>  Installation directory:    /usr/local/lib/R-devel
>>
>>  C compiler:                ccache gcc  -ggdb -pipe -std=gnu99 -Wall -pedantic
>>  Fortran 77 compiler:       ccache gfortran  -g -O2
>>
>>  C++ compiler:              ccache g++  -ggdb -pipe -Wall -pedantic
>>  C++11 compiler:            ccache g++  -std=c++11 -ggdb -pipe -Wall -pedantic
>>  Fortran 90/95 compiler:    ccache gfortran -g -O2
>>  Obj-C compiler:
>>
>>  Interfaces supported:      X11, tcltk
>>  External libraries:        readline, BLAS(generic), LAPACK(generic), curl
>>  Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo, ICU
>>  Options enabled:           shared R library, R profiling
>>
>>  Capabilities skipped:
>>  Options not enabled:       shared BLAS, memory profiling
>>
>>  Recommended packages:      no
>>
>> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
>> make[1]: Nothing to be done for `front-matter'.
>> make[1]: Nothing to be done for `html-non-svn'.
>> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
>> SVN-REVISION is unchanged
>> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/m4'
>> make[1]: Nothing to be done for `R'.
>> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/m4'
>> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/tools'
>> make[1]: Nothing to be done for `R'.
>> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/tools'
>> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/html'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
>> make[2]: Nothing to be done for `R'.
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc/manual'
>> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/doc'
>> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/etc'
>> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/etc'
>> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/share'
>> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/share'
>> make[1]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
>> creating src/scripts/R.fe
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/scripts'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include'
>> config.status: creating src/include/config.h
>> config.status: src/include/config.h is unchanged
>> Rmath.h is unchanged
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
>> make[3]: Nothing to be done for `R'.
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include/R_ext'
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/include'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
>> make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
>> make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
>> make[4]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
>> make[4]: `libtre.a' is up to date.
>> make[4]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra/tre'
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/extra'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
>> make[3]: `libappl.a' is up to date.
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/appl'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
>> make[3]: `libnmath.a' is up to date.
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/nmath'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
>> make[3]: `libunix.a' is up to date.
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
>> ccache gcc -I. -I../../src/include -I../../src/include
>> -I/usr/local/include -DHAVE_CONFIG_H   -fopenmp -fpic  -ggdb -pipe
>> -std=gnu99 -Wall -pedantic  -L/usr/local/lib
>> -DR_HOME='"/home/hzambran/SVN/R-devel/trunk"' \
>> -o Rscript ./Rscript.c
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/unix'
>> make[2]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
>> make[3]: Entering directory `/home/hzambran/SVN/R-devel/trunk/src/main'
>> ccache gcc -shared -fopenmp -L/usr/local/lib  -o libR.so
>> CommandLineArgs.o Rdynload.o Renviron.o RNG.o agrep.o apply.o
>> arithmetic.o array.o attrib.o bind.o builtin.o character.o coerce.o
>> colors.o complex.o connections.o context.o cum.o dcf.o datetime.o
>> debug.o deparse.o devices.o dotcode.o dounzip.o dstruct.o duplicate.o
>> edit.o engine.o envir.o errors.o eval.o format.o gevents.o gram.o
>> gram-ex.o graphics.o grep.o identical.o inlined.o inspect.o internet.o
>> iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o
>> match.o memory.o names.o objects.o options.o paste.o platform.o plot.o
>> plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o
>> qsort.o random.o raw.o registration.o relop.o rlocale.o saveload.o
>> scan.o seq.o serialize.o sort.o source.o split.o sprintf.o startup.o
>> subassign.o subscript.o subset.o summary.o sysutils.o times.o unique.o
>> util.o version.o g_alab_her.o g_cntrlify.o g_fontdb.o g_her_glyph.o
>> xxxpr.o   `ls ../unix/*.o ../appl/*.o ../nmath/*.o`
>> ../extra/tre/libtre.a    -lblas -lgfortran -lm -lquadmath   -lreadline
>> -lpcre -llzma -lbz2 -lz -lrt -ldl -lm -licuuc -licui18n
>> /usr/bin/ld: ../appl/dchdc.o: relocation R_X86_64_32 against `.rodata'
>> can not be used when making a shared object; recompile with -fPIC
>> ../appl/dchdc.o: error adding symbols: Bad value
>> collect2: error: ld returned 1 exit status
>> make[3]: *** [libR.so] Error 1
>> make[3]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
>> make[2]: *** [R] Error 2
>> make[2]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src/main'
>> make[1]: *** [R] Error 1
>> make[1]: Leaving directory `/home/hzambran/SVN/R-devel/trunk/src'
>> make: *** [R] Error 1
>> *** Done -- now run 'make install'
>>
>>
>> Any thoughts what I'm doing wrong ?
>>
>>
>> Mauricio
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> Peter Dalgaard, Professor,
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>
>
>
>
>
>
>
>


From ajsaez at ujaen.es  Tue Jul 21 06:23:29 2015
From: ajsaez at ujaen.es (=?UTF-8?Q?Antonio_Jos=C3=A9_Saez_Castillo?=)
Date: Tue, 21 Jul 2015 06:23:29 +0200
Subject: [R-pkg-devel] Note about "No repository set,
 so cyclic dependency check skipped"
Message-ID: <CAD+ZfS7k+KFa-e=8NRS2+_OXifZHj_SW5jOff91rPsCTNJCEDA@mail.gmail.com>

All my attempts to do that have failed. That is because I tried to check in
R-devel on win-builder site (win-builder.r-project.org), far from my local
computer, and it got the same note. So, I think it may be not a problem
only in my own PC.

2015-07-20 12:25 GMT+02:00 Dirk Eddelbuettel <edd at debian.org>:

>
> On 20 July 2015 at 08:53, Martyn Plummer wrote:
> | On Mon, 2015-07-20 at 07:36 +0200, Antonio Jos? Saez Castillo wrote:
> | > When checking a package I am getting
> | >
> | > * checking package dependencies ... NOTE
> | >    No repository set, so cyclic dependency check skipped
> | >
> | > This is an old source of discussion and I've found a lot of
> suggestions,
> | > but none of them work for me (.Rprofile and/or Rprofile.site edition
> and
> | > so). What is more worrying is that I'm also getting this note when I
> check
> | > in R-devel on win-builder site (win-builder.r-project.org). There is
> | > another similar topic in relation to that (
> | >
> http://r.789695.n4.nabble.com/No-repository-set-so-cyclic-dependency-check-skipped-td4684184.html
> ),
> | > but I don't know if it is the same problem.
> | >
> | > How can I avoid this note?
> |
> | This is covered in the Writing R Extensions manual (page 32), but if you
> | tried creating a .Rprofile file and it didn't work then the problem
> | might be that it is in the wrong place. On my Windows 7 desktop, R opens
> | in my "Documents" folder rather than my home directory, so my .Rprofile
> | folder has to go into "Documents".
>
> If I recall correctly, setting the environment variable HOME (which is not
> standard under Window) allows you to control that.  Files such as
> ~/.Rprofile
> will then be searched in the directory pointed to by the value assigned to
> HOME.
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From ligges at statistik.tu-dortmund.de  Tue Jul 21 08:06:56 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 21 Jul 2015 08:06:56 +0200
Subject: [R-pkg-devel] Note about "No repository set,
 so cyclic dependency check skipped"
In-Reply-To: <CAD+ZfS7k+KFa-e=8NRS2+_OXifZHj_SW5jOff91rPsCTNJCEDA@mail.gmail.com>
References: <CAD+ZfS7k+KFa-e=8NRS2+_OXifZHj_SW5jOff91rPsCTNJCEDA@mail.gmail.com>
Message-ID: <55ADE180.80007@statistik.tu-dortmund.de>

winbuilder will be fixed soon.

Best,
Uwe Ligges


On 21.07.2015 06:23, Antonio Jos? Saez Castillo wrote:
> All my attempts to do that have failed. That is because I tried to check in
> R-devel on win-builder site (win-builder.r-project.org), far from my local
> computer, and it got the same note. So, I think it may be not a problem
> only in my own PC.
>
> 2015-07-20 12:25 GMT+02:00 Dirk Eddelbuettel <edd at debian.org>:
>
>>
>> On 20 July 2015 at 08:53, Martyn Plummer wrote:
>> | On Mon, 2015-07-20 at 07:36 +0200, Antonio Jos? Saez Castillo wrote:
>> | > When checking a package I am getting
>> | >
>> | > * checking package dependencies ... NOTE
>> | >    No repository set, so cyclic dependency check skipped
>> | >
>> | > This is an old source of discussion and I've found a lot of
>> suggestions,
>> | > but none of them work for me (.Rprofile and/or Rprofile.site edition
>> and
>> | > so). What is more worrying is that I'm also getting this note when I
>> check
>> | > in R-devel on win-builder site (win-builder.r-project.org). There is
>> | > another similar topic in relation to that (
>> | >
>> http://r.789695.n4.nabble.com/No-repository-set-so-cyclic-dependency-check-skipped-td4684184.html
>> ),
>> | > but I don't know if it is the same problem.
>> | >
>> | > How can I avoid this note?
>> |
>> | This is covered in the Writing R Extensions manual (page 32), but if you
>> | tried creating a .Rprofile file and it didn't work then the problem
>> | might be that it is in the wrong place. On my Windows 7 desktop, R opens
>> | in my "Documents" folder rather than my home directory, so my .Rprofile
>> | folder has to go into "Documents".
>>
>> If I recall correctly, setting the environment variable HOME (which is not
>> standard under Window) allows you to control that.  Files such as
>> ~/.Rprofile
>> will then be searched in the directory pointed to by the value assigned to
>> HOME.
>>
>> Dirk
>>
>> --
>> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From pdalgd at gmail.com  Tue Jul 21 09:33:22 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 21 Jul 2015 09:33:22 +0200
Subject: [R-pkg-devel] Setting up R-devel in Linux Mint 17.1 64-bit
In-Reply-To: <2828544.K6gJLKHNKR@tux>
References: <CAP6VartT2OCSyO-qqU8YsyqC0cYv6o9GxWbu7hq4NatH-KmbtQ@mail.gmail.com>
	<EDCE984C-28F0-484E-A911-4073FD9B2D8E@gmail.com>
	<CAP6VarsHA-m7r4AoL1Fdh5D=BtRacHoYU2RO5hhp_a54Khk1tQ@mail.gmail.com>
	<2828544.K6gJLKHNKR@tux>
Message-ID: <798AF1B9-5998-40ED-A372-AD8175BE36CA@gmail.com>


> On 21 Jul 2015, at 08:12 , Johannes Ranke <jranke at uni-bremen.de> wrote:
> 
>>> 
>>> Could you guys move to r-devel? This has nothing to do with _package_
>>> development.
> 
> OK, the details of how to configure a build are maybe a bit too far off... But 
> in general, testing with a recent development build is an important part of 
> submitting packages to CRAN, so it seems to me that this list may serve to 
> collect information on how this can be done?

In a word: No.

So is getting R installed in the first place, running it on a Mac, sorting out library dependencies, etc. All of these things have their own mailing lists, full of people that know about stuff. We do not want to duplicate their content here, possibly with lesser competence. Plus, it clogs up the archives of _this_ list.

-pd

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From Sebastien.Bihorel at cognigencorp.com  Tue Jul 21 14:59:19 2015
From: Sebastien.Bihorel at cognigencorp.com (sbihorel)
Date: Tue, 21 Jul 2015 08:59:19 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <BDE283C7-81EC-4FD8-9417-5477899FE712@stat.ubc.ca>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com> <55A65EF1.3010700@gmail.com>
	<55AD629E.1070204@cognigencorp.com>
	<BDE283C7-81EC-4FD8-9417-5477899FE712@stat.ubc.ca>
Message-ID: <55AE4227.1070305@cognigencorp.com>

Hi Jennifer,

Following your suggestions and after a couple of trial-and-error steps, 
I believe the syntax is the following:

\code{\link[name_of_package:name_of_Rd_file]{alias_or_text}}

For instance, to link to panel.abline or strip.custom from the lattice 
package, I used:

\code{\link[lattice:panel.functions]{panel.abline}}
\code{\link[lattice:strip.default]{panel.custom}}

Using this notation I was able to make all warnings disappear upon 
installation of my package.

Typically, you can extract the name of the Rd file from the ? help page 
(upper left corner info). But this is not 100% reliable if the 
maintainer of the package is not consistent in the way (s)he documents 
the package.

Thanks a lot for your help.

Sebastien


On 7/20/2015 5:45 PM, Jennifer Bryan wrote:
> Hi Sebastien,
>
> This note about Rd warnings reminded me that I recently had the same problem. So I recreated it and, I think, have found a solution.
>
> I will explain in my specific example to be clear.
>
> I need to link to the docs for the Token2.0 class from the httr package. First thing you try:
>
> \code{\link[httr]{Token2.0}}
>
> but then you get the warnings you describe upon installation. As in your case, the Token2.0 class doesn?t have it?s own .Rd file but is, rather, documented in the topic titled ?Token-class?.
>
> Next thing you try:
>
> \code{\link[httr]{Token-class}}
>
> which works, but I don?t like this display text ? it doesn?t really make sense in the context of *my* documentation.
>
> Finally you do this:
>
> \code{\link[=Token-class]{Token2.0}}
>
> to link to the correct topic but get the desired display text. However, I am no longer specifying that this topic is from the httr package, but it seems to work.
>
> Maybe someone else can weigh in with more insight about the need / desirability of specifying the associated package.
>
> ? Jenny
>
>> On Jul 20, 2015, at 2:05 PM, sbihorel <Sebastien.Bihorel at cognigencorp.com> wrote:
>>
>> Hi,
>>
>> Thanks to your suggestions and those of other responders, I was able to get rid of the warning messages returned during R CMD check.
>>
>> However I am still confused by the .Rd file-related warnings I get when we install the packages. For instance:
>>
>> Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file link "panel.abline"
>>
>> I typed: \code{\link[lattice]{panel.abline}} on line 21 for the Rd file.
>>
>> My NAMESPACE file includes:
>>
>> importFrom(lattice,panel.abline)
>>
>> Surprisingly, other cross-references to lattice functions also imported using importFrom do not generate warning upon installation.
>>
>> When I consider the full list of function links that generate warnings, it looks like all of them are associated with alias rather than name tags in the target .Rd file (for instance, panel.abline is documented in a .Rd file with \name{panel.functions}).
>>
>> The CRAN manual is not clear on this point. Is there a specific syntax to use to document this types of links?
>>
>> Thank you again for your time
>>
>> Sebastien
>>
>>
>> On 7/15/2015 9:24 AM, Duncan Murdoch wrote:
>>> On 15/07/2015 9:07 AM, sbihorel wrote:
>>>> Hi,
>>>>
>>>> I saw a few recent posts on topics related to mine (eg
>>>> https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It
>>>> looks like I need to import more packages in my NAMESPACE, correct?
>>>>
>>>> However, I thought that imports would be recursive, ie imports would
>>>> also get the info from dependent packages.
>>> I haven't been following this thread, but the 2nd para above makes it
>>> sound as though an explanation of the NAMESPACE directives would be helpful.
>>>
>>> If you say
>>>
>>>   importFrom(Hmisc, latex)
>>>
>>> it acts as though you have made a copy of the Hmisc::latex function
>>> within your package environment.  (It isn't exported, unless you ask to
>>> export it.)
>>>
>>> If you say
>>>
>>>   import(Hmisc)
>>>
>>> it acts as though you have made copies of every exported function from
>>> Hmisc within your package environment.  This is why we recommend
>>> importing only the functions you need; otherwise your package
>>> environment gets bloated.
>>>
>>> No recursive copies are made, unless Hmisc happens to import something
>>> and re-exports it.
>>>
>>> When I say "acts as though", I don't mean it literally makes copies; it
>>> implements this in a more efficient way, basically only copying pointers
>>> to those functions -- but from a user point of view, you shouldn't be
>>> able to tell the difference, since you're not allowed to modify
>>> Hmisc::latex.
>>>
>>> Duncan Murdoch
>>>
>>>
>>>> Sebastien
>>>>
>>>>
>>>> On 7/13/2015 9:42 PM, sbihorel wrote:
>>>>> Hi,
>>>>>
>>>>> Sorry about the table. It looked good when displayed using a fixed
>>>>> width font. Let me try to linearize it:
>>>>>
>>>>>    * pkgA
>>>>>        o DESCRIPTION:
>>>>>            + Depends: methods, lattice, grid, gam
>>>>>            + Imports: Hmisc, survival
>>>>>        o NAMESPACE:
>>>>>            + import: lattice, grid, gam, methods
>>>>>            + importFrom: Hmisc (one function)
>>>>>    * pkgB
>>>>>        o DESCRIPTION:
>>>>>            + Depends: pkgA
>>>>>            + Imports: <nothing>
>>>>>        o NAMESPACE:
>>>>>            + import: pkgA
>>>>>            + importFrom: <nothing
>>>>>    * pkgC
>>>>>        o DESCRIPTION:
>>>>>            + Depends: methods, pkgB
>>>>>            + Imports: <nothing>
>>>>>        o NAMESPACE:
>>>>>            + import: methods, pkgB
>>>>>            + importFrom: <nothing
>>>>>
>>>>> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include:
>>>>> exportPattern("^[^\\.]").
>>>>>
>>>>> Sebastien
>>>>>
>>>>>
>>>>> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>>>>>> Are you exporting the functions from pkgB and pkgC? It's hard to tell
>>>>>> from your table below. The easiest way is to add a comment before
>>>>>> each of the functions in pkgB and pkgC that you want to expose to the
>>>>>> users.
>>>>>>
>>>>>> #' @export
>>>>>> foo <- function(){...}
>>>>>>
>>>>>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>>>>>>
>>>>>> HTH
>>>>>> Seth
>>>>>>
>>>>>> On Monday, July 13, 2015, sbihorel
>>>>>> <Sebastien.Bihorel at cognigencorp.com
>>>>>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>>>>>
>>>>>>      Hi,
>>>>>>
>>>>>>      My group has recently upgraded from a fairly old R version (2.12)
>>>>>>      to the
>>>>>>      R version 3.1.2. In parallel to this upgrade, I am updating our
>>>>>>      custom
>>>>>>      packages to add functionality and also make them compliant to the
>>>>>>      requirements of the new version of R. I would like to ask your
>>>>>>      help with
>>>>>>      respect to warning messages I get when I check and install the
>>>>>>      packages.
>>>>>>      I read the latest version of the manual on writing R extensions,
>>>>>>      try to
>>>>>>      apply the recommendations, but somehow I am not getting things right.
>>>>>>      Hopefully, with your suggestions, I could setup my package
>>>>>>      correctly to
>>>>>>      make these messages stop.
>>>>>>
>>>>>>      I apologize but, for confidentiality purpose, I will have to
>>>>>>      partially
>>>>>>      anonymize the information.
>>>>>>
>>>>>>      So here is the situation: we have 2 custom packages (let's call them
>>>>>>      pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>>>>>      call it
>>>>>>      pkgA) that is available on CRAN. The pkgC package depends on
>>>>>>      pkgB, make
>>>>>>      new function available,  and "overwrites" some of the functions
>>>>>>      distributed as part of pkgA. The following table summarizes the
>>>>>>      content
>>>>>>      of the DESCRIPTION and NAMESPACE files of each of these packages.
>>>>>>
>>>>>>      package    DESCRIPTION NAMESPACE
>>>>>>                  Depends                       Imports
>>>>>>      import                         importFrom
>>>>>>      pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>>>>>      grid,
>>>>>>      gam, methods    Hmisc
>>>>>>      pkgB       pkgA pkgA
>>>>>>      pkgC       methods, pkgB methods, pkgB
>>>>>>
>>>>>>      I do not get any warning when I build, check or install pkgB in our
>>>>>>      linux openSuse environment.
>>>>>>
>>>>>>      After successful building pkgC, I run R CMD check on my built for
>>>>>>      pkgC
>>>>>>      but I get a ton of messages under the "checking R code for possible
>>>>>>      problems" section. These notes are related to actual calls to pkgA
>>>>>>      functions (or to one of the function provided by its
>>>>>>      dependencies). Here
>>>>>>      is a subset for illustration and hopefully information.
>>>>>>
>>>>>>      * checking R code for possible problems: NOTE
>>>>>>      pkgC_function_001: no visible global function definition
>>>>>>      for"pkgA_function_AAA"
>>>>>>      pkgC_function_001: no visible global function definition
>>>>>>      for"pkgA_function_AAB"
>>>>>>      ...
>>>>>>      pkgC_function_010: no visible global function definition for"xyplot"
>>>>>>      pkgC_function_010: no visible global function definition
>>>>>>      for"panel.xyplot"
>>>>>>      pkgC_function_010: no visible global function definition
>>>>>>      for"panel.abline"
>>>>>>      pkgC_function_010: no visible global function definition
>>>>>>      for"grid.polygon"
>>>>>>      pkgC_function_010: no visible global function definition for"gpar"
>>>>>>      ...
>>>>>>
>>>>>>      Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>>>>>      following warnings about the content of my documentation Rd
>>>>>>      files. The
>>>>>>      Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>>>>>
>>>>>>      *** installing help indices
>>>>>>         converting help for package ?kiwixposedev?
>>>>>>           finding HTML links ... done
>>>>>>      pkgC_function_001                    html
>>>>>>           pkgC_function_002                    html
>>>>>>      ...
>>>>>>      Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>>>>>      link "panel.abline"
>>>>>>      ...
>>>>>>      Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>>>>>      link "pkA_function_AAC"
>>>>>>      ...
>>>>>>
>>>>>>      I think I need to somehow modify the content of the DESCRIPTION and
>>>>>>      NAMESPACE files for pkgC... but adding various combinations of
>>>>>>      pkA and
>>>>>>      its dependencies gave me others errors about redundancies and
>>>>>>      multiple
>>>>>>      loading of the same packages. So in short, I am kind of lost with the
>>>>>>      new requirements of R 3.1.2 and would greatly appreciate any help or
>>>>>>      suggestions
>>>>>>
>>>>>>      Thank you in advance for your time.
>>>>>>
>>>>>>      Sebastien Bihorel
>>>>>>
>>>>>>
>>>>>>              [[alternative HTML version deleted]]
>>>>>>
>>>>>>      ______________________________________________
>>>>>>      R-package-devel at r-project.org <javascript:;> mailing list
>>>>>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From profjcnash at gmail.com  Tue Jul 21 15:01:45 2015
From: profjcnash at gmail.com (ProfJCNash)
Date: Tue, 21 Jul 2015 09:01:45 -0400
Subject: [R-pkg-devel] Appropriate place to post about CRAN check
	environments etc.
In-Reply-To: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>
References: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>
Message-ID: <55AE42B9.8020502@gmail.com>


There has been some disagreement on where it is appropriate to post
questions about package checking procedures, including the building of
the environment e.g., R-devel under Linux Mint.

In looking at https://www.r-project.org/mail.html, it seems to me that
the procedures belong with r-package-devel, but there doesn't seem to be
a good home for the consequent need to build R-devel to do this. Have I
missed the appropriate list?

It seems to me that the volume of queries of this sort, and the success
of WinBuilder, suggest we could seriously use similar a Linbuilder and
MacBuilder (and possibly others). There's a lot of duplicated effort
being wasted on the R-devel side in particular.

Is there sufficient interest to
- make the effort to emulate Winbuilder for Linux and/or Mac
- coordinate the volunteer effort
- fund/support the necessary infrastructure (it could be worth a modest
contribution to save effort)?

For the record, I'm willing to participate. I've managed to set up Linux
Mint VirtualBox instances that run R current and R devel for testing,
though I find I must do more work than I'd like to maintain things,
likely as a result of my own limited skills.

JN


From murdoch.duncan at gmail.com  Tue Jul 21 16:46:46 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 21 Jul 2015 10:46:46 -0400
Subject: [R-pkg-devel] Appropriate place to post about CRAN check
 environments etc.
In-Reply-To: <55AE42B9.8020502@gmail.com>
References: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>
	<55AE42B9.8020502@gmail.com>
Message-ID: <55AE5B56.70201@gmail.com>

On 21/07/2015 9:01 AM, ProfJCNash wrote:
> 
> There has been some disagreement on where it is appropriate to post
> questions about package checking procedures, including the building of
> the environment e.g., R-devel under Linux Mint.
> 
> In looking at https://www.r-project.org/mail.html, it seems to me that
> the procedures belong with r-package-devel, but there doesn't seem to be
> a good home for the consequent need to build R-devel to do this. Have I
> missed the appropriate list?
> 
> It seems to me that the volume of queries of this sort, and the success
> of WinBuilder, suggest we could seriously use similar a Linbuilder and
> MacBuilder (and possibly others). There's a lot of duplicated effort
> being wasted on the R-devel side in particular.
> 
> Is there sufficient interest to
> - make the effort to emulate Winbuilder for Linux and/or Mac
> - coordinate the volunteer effort
> - fund/support the necessary infrastructure (it could be worth a modest
> contribution to save effort)?
> 
> For the record, I'm willing to participate. I've managed to set up Linux
> Mint VirtualBox instances that run R current and R devel for testing,
> though I find I must do more work than I'd like to maintain things,
> likely as a result of my own limited skills.

That sounds like the sort of project the R Consortium would support.
They are just getting started, but soon they will have a committee set
up to decide on projects, and presumably soon after that will have a
process in place to solicit them.

Duncan Murdoch


From mauricio.zambrano at ufrontera.cl  Tue Jul 21 17:04:46 2015
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Tue, 21 Jul 2015 12:04:46 -0300
Subject: [R-pkg-devel] Appropriate place to post about CRAN check
 environments etc.
In-Reply-To: <55AE5B56.70201@gmail.com>
References: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>
	<55AE42B9.8020502@gmail.com> <55AE5B56.70201@gmail.com>
Message-ID: <CAP6VaruDEfP4K=_V=fD3Fa7i7TVyy2N4i+JU-32rdFG9BgeTZw@mail.gmail.com>

On 21 July 2015 at 11:46, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 21/07/2015 9:01 AM, ProfJCNash wrote:
>>
>> There has been some disagreement on where it is appropriate to post
>> questions about package checking procedures, including the building of
>> the environment e.g., R-devel under Linux Mint.
>>
>> In looking at https://www.r-project.org/mail.html, it seems to me that
>> the procedures belong with r-package-devel, but there doesn't seem to be
>> a good home for the consequent need to build R-devel to do this. Have I
>> missed the appropriate list?
>>
>> It seems to me that the volume of queries of this sort, and the success
>> of WinBuilder, suggest we could seriously use similar a Linbuilder and
>> MacBuilder (and possibly others). There's a lot of duplicated effort
>> being wasted on the R-devel side in particular.
>>
>> Is there sufficient interest to
>> - make the effort to emulate Winbuilder for Linux and/or Mac
>> - coordinate the volunteer effort
>> - fund/support the necessary infrastructure (it could be worth a modest
>> contribution to save effort)?
>>
>> For the record, I'm willing to participate. I've managed to set up Linux
>> Mint VirtualBox instances that run R current and R devel for testing,
>> though I find I must do more work than I'd like to maintain things,
>> likely as a result of my own limited skills.
>
> That sounds like the sort of project the R Consortium would support.
> They are just getting started, but soon they will have a committee set
> up to decide on projects, and presumably soon after that will have a
> process in place to solicit them.
>
> Duncan Murdoch

In my humble opinion, such a project could be of great utility to
several people that is starting to migrate to GNU/Linux, or to people
willing to test their packages with the latest development version of
R but without all the knowledge to properly set up the environment on
their local machines.

If I can contribute to a "LinBuilder" (e.g., testing), I would be
willing to do it.

Kind regards,


Mauricio Zambrano-Bigiarini, PhD

=====================================
Dept. of Civil Engineering
Faculty of Engineering and Sciences
Universidad de La Frontera
PO Box 54-D, Temuco, Chile
=====================================
mailto     : mauricio.zambrano at ufrontera.cl
work-phone : +56 45 259 2812
http://ingenieriacivil.ufro.cl/
=====================================
"When the pupil is ready, the master arrives."
(Zen proverb)
=====================================
Linux user #454569 -- Linux Mint user

>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jenny at stat.ubc.ca  Tue Jul 21 20:08:39 2015
From: jenny at stat.ubc.ca (Jennifer Bryan)
Date: Tue, 21 Jul 2015 11:08:39 -0700
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <55AE4227.1070305@cognigencorp.com>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com> <55A65EF1.3010700@gmail.com>
	<55AD629E.1070204@cognigencorp.com>
	<BDE283C7-81EC-4FD8-9417-5477899FE712@stat.ubc.ca>
	<55AE4227.1070305@cognigencorp.com>
Message-ID: <1E3992D0-3A40-40A8-8635-D7BEB0E79CB8@stat.ubc.ca>

Sebastien: thanks for sharing the definitive solution!

To the people on this list with the power to edit "Writing R Extensions":

When a discussion here suggests a specific improvement, what is the best way for the community to propose a revision? So that knowledge gets transferred from this list to the relevant reference document and heads off future questions.

In this thread, we converged on cross-reference via \link[pkg:bar]{foo}. Section ?2.5 Cross-references? in "Writing R Extensions? describes this type of cross-reference like so:

"These are rarely needed, perhaps to refer to not-yet-installed packages or in the normally undesirable event that more than one package offers help on a topic.?

But it can also be necessary when the author of package ?pkg" has documented multiple things, including ?foo?, in a single file, such as ?bar?. This seems to be a sufficiently distinct and common scenario to merit a mention.

? Jenny

> On Jul 21, 2015, at 5:59 AM, sbihorel <Sebastien.Bihorel at cognigencorp.com> wrote:
> 
> Hi Jennifer,
> 
> Following your suggestions and after a couple of trial-and-error steps, I believe the syntax is the following:
> 
> \code{\link[name_of_package:name_of_Rd_file]{alias_or_text}}
> 
> For instance, to link to panel.abline or strip.custom from the lattice package, I used:
> 
> \code{\link[lattice:panel.functions]{panel.abline}}
> \code{\link[lattice:strip.default]{panel.custom}}
> 
> Using this notation I was able to make all warnings disappear upon installation of my package.
> 
> Typically, you can extract the name of the Rd file from the ? help page (upper left corner info). But this is not 100% reliable if the maintainer of the package is not consistent in the way (s)he documents the package.
> 
> Thanks a lot for your help.
> 
> Sebastien
> 
> 
> On 7/20/2015 5:45 PM, Jennifer Bryan wrote:
>> Hi Sebastien,
>> 
>> This note about Rd warnings reminded me that I recently had the same problem. So I recreated it and, I think, have found a solution.
>> 
>> I will explain in my specific example to be clear.
>> 
>> I need to link to the docs for the Token2.0 class from the httr package. First thing you try:
>> 
>> \code{\link[httr]{Token2.0}}
>> 
>> but then you get the warnings you describe upon installation. As in your case, the Token2.0 class doesn?t have it?s own .Rd file but is, rather, documented in the topic titled ?Token-class?.
>> 
>> Next thing you try:
>> 
>> \code{\link[httr]{Token-class}}
>> 
>> which works, but I don?t like this display text ? it doesn?t really make sense in the context of *my* documentation.
>> 
>> Finally you do this:
>> 
>> \code{\link[=Token-class]{Token2.0}}
>> 
>> to link to the correct topic but get the desired display text. However, I am no longer specifying that this topic is from the httr package, but it seems to work.
>> 
>> Maybe someone else can weigh in with more insight about the need / desirability of specifying the associated package.
>> 
>> ? Jenny
>> 
>>> On Jul 20, 2015, at 2:05 PM, sbihorel <Sebastien.Bihorel at cognigencorp.com> wrote:
>>> 
>>> Hi,
>>> 
>>> Thanks to your suggestions and those of other responders, I was able to get rid of the warning messages returned during R CMD check.
>>> 
>>> However I am still confused by the .Rd file-related warnings I get when we install the packages. For instance:
>>> 
>>> Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file link "panel.abline"
>>> 
>>> I typed: \code{\link[lattice]{panel.abline}} on line 21 for the Rd file.
>>> 
>>> My NAMESPACE file includes:
>>> 
>>> importFrom(lattice,panel.abline)
>>> 
>>> Surprisingly, other cross-references to lattice functions also imported using importFrom do not generate warning upon installation.
>>> 
>>> When I consider the full list of function links that generate warnings, it looks like all of them are associated with alias rather than name tags in the target .Rd file (for instance, panel.abline is documented in a .Rd file with \name{panel.functions}).
>>> 
>>> The CRAN manual is not clear on this point. Is there a specific syntax to use to document this types of links?
>>> 
>>> Thank you again for your time
>>> 
>>> Sebastien
>>> 
>>> 
>>> On 7/15/2015 9:24 AM, Duncan Murdoch wrote:
>>>> On 15/07/2015 9:07 AM, sbihorel wrote:
>>>>> Hi,
>>>>> 
>>>>> I saw a few recent posts on topics related to mine (eg
>>>>> https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It
>>>>> looks like I need to import more packages in my NAMESPACE, correct?
>>>>> 
>>>>> However, I thought that imports would be recursive, ie imports would
>>>>> also get the info from dependent packages.
>>>> I haven't been following this thread, but the 2nd para above makes it
>>>> sound as though an explanation of the NAMESPACE directives would be helpful.
>>>> 
>>>> If you say
>>>> 
>>>>  importFrom(Hmisc, latex)
>>>> 
>>>> it acts as though you have made a copy of the Hmisc::latex function
>>>> within your package environment.  (It isn't exported, unless you ask to
>>>> export it.)
>>>> 
>>>> If you say
>>>> 
>>>>  import(Hmisc)
>>>> 
>>>> it acts as though you have made copies of every exported function from
>>>> Hmisc within your package environment.  This is why we recommend
>>>> importing only the functions you need; otherwise your package
>>>> environment gets bloated.
>>>> 
>>>> No recursive copies are made, unless Hmisc happens to import something
>>>> and re-exports it.
>>>> 
>>>> When I say "acts as though", I don't mean it literally makes copies; it
>>>> implements this in a more efficient way, basically only copying pointers
>>>> to those functions -- but from a user point of view, you shouldn't be
>>>> able to tell the difference, since you're not allowed to modify
>>>> Hmisc::latex.
>>>> 
>>>> Duncan Murdoch
>>>> 
>>>> 
>>>>> Sebastien
>>>>> 
>>>>> 
>>>>> On 7/13/2015 9:42 PM, sbihorel wrote:
>>>>>> Hi,
>>>>>> 
>>>>>> Sorry about the table. It looked good when displayed using a fixed
>>>>>> width font. Let me try to linearize it:
>>>>>> 
>>>>>>   * pkgA
>>>>>>       o DESCRIPTION:
>>>>>>           + Depends: methods, lattice, grid, gam
>>>>>>           + Imports: Hmisc, survival
>>>>>>       o NAMESPACE:
>>>>>>           + import: lattice, grid, gam, methods
>>>>>>           + importFrom: Hmisc (one function)
>>>>>>   * pkgB
>>>>>>       o DESCRIPTION:
>>>>>>           + Depends: pkgA
>>>>>>           + Imports: <nothing>
>>>>>>       o NAMESPACE:
>>>>>>           + import: pkgA
>>>>>>           + importFrom: <nothing
>>>>>>   * pkgC
>>>>>>       o DESCRIPTION:
>>>>>>           + Depends: methods, pkgB
>>>>>>           + Imports: <nothing>
>>>>>>       o NAMESPACE:
>>>>>>           + import: methods, pkgB
>>>>>>           + importFrom: <nothing
>>>>>> 
>>>>>> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include:
>>>>>> exportPattern("^[^\\.]").
>>>>>> 
>>>>>> Sebastien
>>>>>> 
>>>>>> 
>>>>>> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>>>>>>> Are you exporting the functions from pkgB and pkgC? It's hard to tell
>>>>>>> from your table below. The easiest way is to add a comment before
>>>>>>> each of the functions in pkgB and pkgC that you want to expose to the
>>>>>>> users.
>>>>>>> 
>>>>>>> #' @export
>>>>>>> foo <- function(){...}
>>>>>>> 
>>>>>>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>>>>>>> 
>>>>>>> HTH
>>>>>>> Seth
>>>>>>> 
>>>>>>> On Monday, July 13, 2015, sbihorel
>>>>>>> <Sebastien.Bihorel at cognigencorp.com
>>>>>>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>>>>>> 
>>>>>>>     Hi,
>>>>>>> 
>>>>>>>     My group has recently upgraded from a fairly old R version (2.12)
>>>>>>>     to the
>>>>>>>     R version 3.1.2. In parallel to this upgrade, I am updating our
>>>>>>>     custom
>>>>>>>     packages to add functionality and also make them compliant to the
>>>>>>>     requirements of the new version of R. I would like to ask your
>>>>>>>     help with
>>>>>>>     respect to warning messages I get when I check and install the
>>>>>>>     packages.
>>>>>>>     I read the latest version of the manual on writing R extensions,
>>>>>>>     try to
>>>>>>>     apply the recommendations, but somehow I am not getting things right.
>>>>>>>     Hopefully, with your suggestions, I could setup my package
>>>>>>>     correctly to
>>>>>>>     make these messages stop.
>>>>>>> 
>>>>>>>     I apologize but, for confidentiality purpose, I will have to
>>>>>>>     partially
>>>>>>>     anonymize the information.
>>>>>>> 
>>>>>>>     So here is the situation: we have 2 custom packages (let's call them
>>>>>>>     pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>>>>>>     call it
>>>>>>>     pkgA) that is available on CRAN. The pkgC package depends on
>>>>>>>     pkgB, make
>>>>>>>     new function available,  and "overwrites" some of the functions
>>>>>>>     distributed as part of pkgA. The following table summarizes the
>>>>>>>     content
>>>>>>>     of the DESCRIPTION and NAMESPACE files of each of these packages.
>>>>>>> 
>>>>>>>     package    DESCRIPTION NAMESPACE
>>>>>>>                 Depends                       Imports
>>>>>>>     import                         importFrom
>>>>>>>     pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>>>>>>     grid,
>>>>>>>     gam, methods    Hmisc
>>>>>>>     pkgB       pkgA pkgA
>>>>>>>     pkgC       methods, pkgB methods, pkgB
>>>>>>> 
>>>>>>>     I do not get any warning when I build, check or install pkgB in our
>>>>>>>     linux openSuse environment.
>>>>>>> 
>>>>>>>     After successful building pkgC, I run R CMD check on my built for
>>>>>>>     pkgC
>>>>>>>     but I get a ton of messages under the "checking R code for possible
>>>>>>>     problems" section. These notes are related to actual calls to pkgA
>>>>>>>     functions (or to one of the function provided by its
>>>>>>>     dependencies). Here
>>>>>>>     is a subset for illustration and hopefully information.
>>>>>>> 
>>>>>>>     * checking R code for possible problems: NOTE
>>>>>>>     pkgC_function_001: no visible global function definition
>>>>>>>     for"pkgA_function_AAA"
>>>>>>>     pkgC_function_001: no visible global function definition
>>>>>>>     for"pkgA_function_AAB"
>>>>>>>     ...
>>>>>>>     pkgC_function_010: no visible global function definition for"xyplot"
>>>>>>>     pkgC_function_010: no visible global function definition
>>>>>>>     for"panel.xyplot"
>>>>>>>     pkgC_function_010: no visible global function definition
>>>>>>>     for"panel.abline"
>>>>>>>     pkgC_function_010: no visible global function definition
>>>>>>>     for"grid.polygon"
>>>>>>>     pkgC_function_010: no visible global function definition for"gpar"
>>>>>>>     ...
>>>>>>> 
>>>>>>>     Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>>>>>>     following warnings about the content of my documentation Rd
>>>>>>>     files. The
>>>>>>>     Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>>>>>> 
>>>>>>>     *** installing help indices
>>>>>>>        converting help for package ?kiwixposedev?
>>>>>>>          finding HTML links ... done
>>>>>>>     pkgC_function_001                    html
>>>>>>>          pkgC_function_002                    html
>>>>>>>     ...
>>>>>>>     Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>>>>>>     link "panel.abline"
>>>>>>>     ...
>>>>>>>     Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>>>>>>     link "pkA_function_AAC"
>>>>>>>     ...
>>>>>>> 
>>>>>>>     I think I need to somehow modify the content of the DESCRIPTION and
>>>>>>>     NAMESPACE files for pkgC... but adding various combinations of
>>>>>>>     pkA and
>>>>>>>     its dependencies gave me others errors about redundancies and
>>>>>>>     multiple
>>>>>>>     loading of the same packages. So in short, I am kind of lost with the
>>>>>>>     new requirements of R 3.1.2 and would greatly appreciate any help or
>>>>>>>     suggestions
>>>>>>> 
>>>>>>>     Thank you in advance for your time.
>>>>>>> 
>>>>>>>     Sebastien Bihorel
>>>>>>> 
>>>>>>> 
>>>>>>>             [[alternative HTML version deleted]]
>>>>>>> 
>>>>>>>     ______________________________________________
>>>>>>>     R-package-devel at r-project.org <javascript:;> mailing list
>>>>>>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>> 
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ucfagls at gmail.com  Tue Jul 21 20:35:22 2015
From: ucfagls at gmail.com (Gavin Simpson)
Date: Tue, 21 Jul 2015 12:35:22 -0600
Subject: [R-pkg-devel] Appropriate place to post about CRAN check
 environments etc.
In-Reply-To: <CAP6VaruDEfP4K=_V=fD3Fa7i7TVyy2N4i+JU-32rdFG9BgeTZw@mail.gmail.com>
References: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>
	<55AE42B9.8020502@gmail.com> <55AE5B56.70201@gmail.com>
	<CAP6VaruDEfP4K=_V=fD3Fa7i7TVyy2N4i+JU-32rdFG9BgeTZw@mail.gmail.com>
Message-ID: <CAAHES9xkq7S6xrPW2=DNFMztkgkCvmy+Xf1Zehmjcr-TVbSvyg@mail.gmail.com>

Perhaps I have missed some detail, but would Gabor Csardi's r-builder code
not provide this (or something close to it) for Linux at least? See:
https://github.com/metacran/r-builder

This builds on the R support for Travis CI, and allows for testing against
R-release and R-devel (plus R-oldrelease IIRC)

It's pretty trivial to set-up but you do need your code in a github repo
(for the Travis deployment - I don't know anything about Semaphore, the
other option r-builder allows for).

G

On 21 July 2015 at 09:04, MAURICIO ZAMBRANO BIGIARINI <
mauricio.zambrano at ufrontera.cl> wrote:

> On 21 July 2015 at 11:46, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> > On 21/07/2015 9:01 AM, ProfJCNash wrote:
> >>
> >> There has been some disagreement on where it is appropriate to post
> >> questions about package checking procedures, including the building of
> >> the environment e.g., R-devel under Linux Mint.
> >>
> >> In looking at https://www.r-project.org/mail.html, it seems to me that
> >> the procedures belong with r-package-devel, but there doesn't seem to be
> >> a good home for the consequent need to build R-devel to do this. Have I
> >> missed the appropriate list?
> >>
> >> It seems to me that the volume of queries of this sort, and the success
> >> of WinBuilder, suggest we could seriously use similar a Linbuilder and
> >> MacBuilder (and possibly others). There's a lot of duplicated effort
> >> being wasted on the R-devel side in particular.
> >>
> >> Is there sufficient interest to
> >> - make the effort to emulate Winbuilder for Linux and/or Mac
> >> - coordinate the volunteer effort
> >> - fund/support the necessary infrastructure (it could be worth a modest
> >> contribution to save effort)?
> >>
> >> For the record, I'm willing to participate. I've managed to set up Linux
> >> Mint VirtualBox instances that run R current and R devel for testing,
> >> though I find I must do more work than I'd like to maintain things,
> >> likely as a result of my own limited skills.
> >
> > That sounds like the sort of project the R Consortium would support.
> > They are just getting started, but soon they will have a committee set
> > up to decide on projects, and presumably soon after that will have a
> > process in place to solicit them.
> >
> > Duncan Murdoch
>
> In my humble opinion, such a project could be of great utility to
> several people that is starting to migrate to GNU/Linux, or to people
> willing to test their packages with the latest development version of
> R but without all the knowledge to properly set up the environment on
> their local machines.
>
> If I can contribute to a "LinBuilder" (e.g., testing), I would be
> willing to do it.
>
> Kind regards,
>
>
> Mauricio Zambrano-Bigiarini, PhD
>
> =====================================
> Dept. of Civil Engineering
> Faculty of Engineering and Sciences
> Universidad de La Frontera
> PO Box 54-D, Temuco, Chile
> =====================================
> mailto     : mauricio.zambrano at ufrontera.cl
> work-phone : +56 45 259 2812
> http://ingenieriacivil.ufro.cl/
> =====================================
> "When the pupil is ready, the master arrives."
> (Zen proverb)
> =====================================
> Linux user #454569 -- Linux Mint user
>
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



-- 
Gavin Simpson, PhD

	[[alternative HTML version deleted]]


From csardi.gabor at gmail.com  Tue Jul 21 20:45:18 2015
From: csardi.gabor at gmail.com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Tue, 21 Jul 2015 14:45:18 -0400
Subject: [R-pkg-devel] Appropriate place to post about CRAN check
 environments etc.
In-Reply-To: <CAAHES9xkq7S6xrPW2=DNFMztkgkCvmy+Xf1Zehmjcr-TVbSvyg@mail.gmail.com>
References: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>
	<55AE42B9.8020502@gmail.com> <55AE5B56.70201@gmail.com>
	<CAP6VaruDEfP4K=_V=fD3Fa7i7TVyy2N4i+JU-32rdFG9BgeTZw@mail.gmail.com>
	<CAAHES9xkq7S6xrPW2=DNFMztkgkCvmy+Xf1Zehmjcr-TVbSvyg@mail.gmail.com>
Message-ID: <CABtg=KmOmKnvPDx8_NZheR0jraWwwZdkSkDAfwSuBM1ssSRrrg@mail.gmail.com>

On Tue, Jul 21, 2015 at 2:35 PM, Gavin Simpson <ucfagls at gmail.com> wrote:
> Perhaps I have missed some detail, but would Gabor Csardi's r-builder code
> not provide this (or something close to it) for Linux at least? See:
> https://github.com/metacran/r-builder

It does, although it only does Ubuntu 12.04 if you use Travis, because
that's what Travis has. IMHO this does not really matter for 95% of
the packages, and having R-devel in addition to R-release and R-oldrel
is more important.

> This builds on the R support for Travis CI, and allows for testing against
> R-release and R-devel (plus R-oldrelease IIRC)

It actually does not build on R support for Travis CI. Since it needs
its own R installations, it does not make much sense to use the
built-in R support.

> It's pretty trivial to set-up but you do need your code in a github repo
> (for the Travis deployment - I don't know anything about Semaphore, the
> other option r-builder allows for).

Yeah, it needs to be on GitHub.

Gabor

> G
>
> On 21 July 2015 at 09:04, MAURICIO ZAMBRANO BIGIARINI <
> mauricio.zambrano at ufrontera.cl> wrote:
>
>> On 21 July 2015 at 11:46, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> > On 21/07/2015 9:01 AM, ProfJCNash wrote:
>> >>
>> >> There has been some disagreement on where it is appropriate to post
>> >> questions about package checking procedures, including the building of
>> >> the environment e.g., R-devel under Linux Mint.
>> >>
>> >> In looking at https://www.r-project.org/mail.html, it seems to me that
>> >> the procedures belong with r-package-devel, but there doesn't seem to be
>> >> a good home for the consequent need to build R-devel to do this. Have I
>> >> missed the appropriate list?
>> >>
>> >> It seems to me that the volume of queries of this sort, and the success
>> >> of WinBuilder, suggest we could seriously use similar a Linbuilder and
>> >> MacBuilder (and possibly others). There's a lot of duplicated effort
>> >> being wasted on the R-devel side in particular.
>> >>
>> >> Is there sufficient interest to
>> >> - make the effort to emulate Winbuilder for Linux and/or Mac
>> >> - coordinate the volunteer effort
>> >> - fund/support the necessary infrastructure (it could be worth a modest
>> >> contribution to save effort)?
>> >>
>> >> For the record, I'm willing to participate. I've managed to set up Linux
>> >> Mint VirtualBox instances that run R current and R devel for testing,
>> >> though I find I must do more work than I'd like to maintain things,
>> >> likely as a result of my own limited skills.
>> >
>> > That sounds like the sort of project the R Consortium would support.
>> > They are just getting started, but soon they will have a committee set
>> > up to decide on projects, and presumably soon after that will have a
>> > process in place to solicit them.
>> >
>> > Duncan Murdoch
>>
>> In my humble opinion, such a project could be of great utility to
>> several people that is starting to migrate to GNU/Linux, or to people
>> willing to test their packages with the latest development version of
>> R but without all the knowledge to properly set up the environment on
>> their local machines.
>>
>> If I can contribute to a "LinBuilder" (e.g., testing), I would be
>> willing to do it.
>>
>> Kind regards,
>>
>>
>> Mauricio Zambrano-Bigiarini, PhD
>>
>> =====================================
>> Dept. of Civil Engineering
>> Faculty of Engineering and Sciences
>> Universidad de La Frontera
>> PO Box 54-D, Temuco, Chile
>> =====================================
>> mailto     : mauricio.zambrano at ufrontera.cl
>> work-phone : +56 45 259 2812
>> http://ingenieriacivil.ufro.cl/
>> =====================================
>> "When the pupil is ready, the master arrives."
>> (Zen proverb)
>> =====================================
>> Linux user #454569 -- Linux Mint user
>>
>> >
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
>
>
> --
> Gavin Simpson, PhD
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch.duncan at gmail.com  Tue Jul 21 21:48:50 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 21 Jul 2015 15:48:50 -0400
Subject: [R-pkg-devel] Help needed to setting custom packages for R 3.1.2
In-Reply-To: <1E3992D0-3A40-40A8-8635-D7BEB0E79CB8@stat.ubc.ca>
References: <55A41595.8070500@cognigencorp.com>
	<CAEFOC2+8+ecPZPzdqji_wER=ho6P1b1EtS0oQeqOBBjfSTNDwA@mail.gmail.com>
	<55A4691F.4070200@cognigencorp.com>
	<55A65B19.8080500@cognigencorp.com> <55A65EF1.3010700@gmail.com>
	<55AD629E.1070204@cognigencorp.com>
	<BDE283C7-81EC-4FD8-9417-5477899FE712@stat.ubc.ca>
	<55AE4227.1070305@cognigencorp.com>
	<1E3992D0-3A40-40A8-8635-D7BEB0E79CB8@stat.ubc.ca>
Message-ID: <55AEA222.6060805@gmail.com>

On 21/07/2015 2:08 PM, Jennifer Bryan wrote:
> Sebastien: thanks for sharing the definitive solution!
> 
> To the people on this list with the power to edit "Writing R Extensions":
> 
> When a discussion here suggests a specific improvement, what is the best way for the community to propose a revision? So that knowledge gets transferred from this list to the relevant reference document and heads off future questions.

The best way is to use svn to get a copy of the manual from R-devel,
make the change yourself and test it, and use "svn diff" to produce a
patch file.  Post a description of why you made the change and include a
copy of the patch to the R-devel list.  The source for WRE is in

https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi

Nearly as good is to just grab the source and make the change, using
some other diff method, and post about it on R-devel.  But then the
change should be very simple.

Also good from your point of view is to convince someone with write
access that the change is a good idea and get them to do all the work,
but you'd be surprised how hard that is.

Duncan Murdoch

> In this thread, we converged on cross-reference via \link[pkg:bar]{foo}. Section ?2.5 Cross-references? in "Writing R Extensions? describes this type of cross-reference like so:
> 
> "These are rarely needed, perhaps to refer to not-yet-installed packages or in the normally undesirable event that more than one package offers help on a topic.?
> 
> But it can also be necessary when the author of package ?pkg" has documented multiple things, including ?foo?, in a single file, such as ?bar?. This seems to be a sufficiently distinct and common scenario to merit a mention.
> 
> ? Jenny
> 
>> On Jul 21, 2015, at 5:59 AM, sbihorel <Sebastien.Bihorel at cognigencorp.com> wrote:
>>
>> Hi Jennifer,
>>
>> Following your suggestions and after a couple of trial-and-error steps, I believe the syntax is the following:
>>
>> \code{\link[name_of_package:name_of_Rd_file]{alias_or_text}}
>>
>> For instance, to link to panel.abline or strip.custom from the lattice package, I used:
>>
>> \code{\link[lattice:panel.functions]{panel.abline}}
>> \code{\link[lattice:strip.default]{panel.custom}}
>>
>> Using this notation I was able to make all warnings disappear upon installation of my package.
>>
>> Typically, you can extract the name of the Rd file from the ? help page (upper left corner info). But this is not 100% reliable if the maintainer of the package is not consistent in the way (s)he documents the package.
>>
>> Thanks a lot for your help.
>>
>> Sebastien
>>
>>
>> On 7/20/2015 5:45 PM, Jennifer Bryan wrote:
>>> Hi Sebastien,
>>>
>>> This note about Rd warnings reminded me that I recently had the same problem. So I recreated it and, I think, have found a solution.
>>>
>>> I will explain in my specific example to be clear.
>>>
>>> I need to link to the docs for the Token2.0 class from the httr package. First thing you try:
>>>
>>> \code{\link[httr]{Token2.0}}
>>>
>>> but then you get the warnings you describe upon installation. As in your case, the Token2.0 class doesn?t have it?s own .Rd file but is, rather, documented in the topic titled ?Token-class?.
>>>
>>> Next thing you try:
>>>
>>> \code{\link[httr]{Token-class}}
>>>
>>> which works, but I don?t like this display text ? it doesn?t really make sense in the context of *my* documentation.
>>>
>>> Finally you do this:
>>>
>>> \code{\link[=Token-class]{Token2.0}}
>>>
>>> to link to the correct topic but get the desired display text. However, I am no longer specifying that this topic is from the httr package, but it seems to work.
>>>
>>> Maybe someone else can weigh in with more insight about the need / desirability of specifying the associated package.
>>>
>>> ? Jenny
>>>
>>>> On Jul 20, 2015, at 2:05 PM, sbihorel <Sebastien.Bihorel at cognigencorp.com> wrote:
>>>>
>>>> Hi,
>>>>
>>>> Thanks to your suggestions and those of other responders, I was able to get rid of the warning messages returned during R CMD check.
>>>>
>>>> However I am still confused by the .Rd file-related warnings I get when we install the packages. For instance:
>>>>
>>>> Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file link "panel.abline"
>>>>
>>>> I typed: \code{\link[lattice]{panel.abline}} on line 21 for the Rd file.
>>>>
>>>> My NAMESPACE file includes:
>>>>
>>>> importFrom(lattice,panel.abline)
>>>>
>>>> Surprisingly, other cross-references to lattice functions also imported using importFrom do not generate warning upon installation.
>>>>
>>>> When I consider the full list of function links that generate warnings, it looks like all of them are associated with alias rather than name tags in the target .Rd file (for instance, panel.abline is documented in a .Rd file with \name{panel.functions}).
>>>>
>>>> The CRAN manual is not clear on this point. Is there a specific syntax to use to document this types of links?
>>>>
>>>> Thank you again for your time
>>>>
>>>> Sebastien
>>>>
>>>>
>>>> On 7/15/2015 9:24 AM, Duncan Murdoch wrote:
>>>>> On 15/07/2015 9:07 AM, sbihorel wrote:
>>>>>> Hi,
>>>>>>
>>>>>> I saw a few recent posts on topics related to mine (eg
>>>>>> https://stat.ethz.ch/pipermail/r-package-devel/2015q3/000238.html). It
>>>>>> looks like I need to import more packages in my NAMESPACE, correct?
>>>>>>
>>>>>> However, I thought that imports would be recursive, ie imports would
>>>>>> also get the info from dependent packages.
>>>>> I haven't been following this thread, but the 2nd para above makes it
>>>>> sound as though an explanation of the NAMESPACE directives would be helpful.
>>>>>
>>>>> If you say
>>>>>
>>>>>  importFrom(Hmisc, latex)
>>>>>
>>>>> it acts as though you have made a copy of the Hmisc::latex function
>>>>> within your package environment.  (It isn't exported, unless you ask to
>>>>> export it.)
>>>>>
>>>>> If you say
>>>>>
>>>>>  import(Hmisc)
>>>>>
>>>>> it acts as though you have made copies of every exported function from
>>>>> Hmisc within your package environment.  This is why we recommend
>>>>> importing only the functions you need; otherwise your package
>>>>> environment gets bloated.
>>>>>
>>>>> No recursive copies are made, unless Hmisc happens to import something
>>>>> and re-exports it.
>>>>>
>>>>> When I say "acts as though", I don't mean it literally makes copies; it
>>>>> implements this in a more efficient way, basically only copying pointers
>>>>> to those functions -- but from a user point of view, you shouldn't be
>>>>> able to tell the difference, since you're not allowed to modify
>>>>> Hmisc::latex.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>
>>>>>> Sebastien
>>>>>>
>>>>>>
>>>>>> On 7/13/2015 9:42 PM, sbihorel wrote:
>>>>>>> Hi,
>>>>>>>
>>>>>>> Sorry about the table. It looked good when displayed using a fixed
>>>>>>> width font. Let me try to linearize it:
>>>>>>>
>>>>>>>   * pkgA
>>>>>>>       o DESCRIPTION:
>>>>>>>           + Depends: methods, lattice, grid, gam
>>>>>>>           + Imports: Hmisc, survival
>>>>>>>       o NAMESPACE:
>>>>>>>           + import: lattice, grid, gam, methods
>>>>>>>           + importFrom: Hmisc (one function)
>>>>>>>   * pkgB
>>>>>>>       o DESCRIPTION:
>>>>>>>           + Depends: pkgA
>>>>>>>           + Imports: <nothing>
>>>>>>>       o NAMESPACE:
>>>>>>>           + import: pkgA
>>>>>>>           + importFrom: <nothing
>>>>>>>   * pkgC
>>>>>>>       o DESCRIPTION:
>>>>>>>           + Depends: methods, pkgB
>>>>>>>           + Imports: <nothing>
>>>>>>>       o NAMESPACE:
>>>>>>>           + import: methods, pkgB
>>>>>>>           + importFrom: <nothing
>>>>>>>
>>>>>>> Regarding the export, pkgA, pkgB, and pkgC NAMESPACE files include:
>>>>>>> exportPattern("^[^\\.]").
>>>>>>>
>>>>>>> Sebastien
>>>>>>>
>>>>>>>
>>>>>>> On 7/13/2015 5:36 PM, Seth Wenchel wrote:
>>>>>>>> Are you exporting the functions from pkgB and pkgC? It's hard to tell
>>>>>>>> from your table below. The easiest way is to add a comment before
>>>>>>>> each of the functions in pkgB and pkgC that you want to expose to the
>>>>>>>> users.
>>>>>>>>
>>>>>>>> #' @export
>>>>>>>> foo <- function(){...}
>>>>>>>>
>>>>>>>> Then run roxygen::roxygenise() to build the NAMESPACE file.
>>>>>>>>
>>>>>>>> HTH
>>>>>>>> Seth
>>>>>>>>
>>>>>>>> On Monday, July 13, 2015, sbihorel
>>>>>>>> <Sebastien.Bihorel at cognigencorp.com
>>>>>>>> <mailto:Sebastien.Bihorel at cognigencorp.com>> wrote:
>>>>>>>>
>>>>>>>>     Hi,
>>>>>>>>
>>>>>>>>     My group has recently upgraded from a fairly old R version (2.12)
>>>>>>>>     to the
>>>>>>>>     R version 3.1.2. In parallel to this upgrade, I am updating our
>>>>>>>>     custom
>>>>>>>>     packages to add functionality and also make them compliant to the
>>>>>>>>     requirements of the new version of R. I would like to ask your
>>>>>>>>     help with
>>>>>>>>     respect to warning messages I get when I check and install the
>>>>>>>>     packages.
>>>>>>>>     I read the latest version of the manual on writing R extensions,
>>>>>>>>     try to
>>>>>>>>     apply the recommendations, but somehow I am not getting things right.
>>>>>>>>     Hopefully, with your suggestions, I could setup my package
>>>>>>>>     correctly to
>>>>>>>>     make these messages stop.
>>>>>>>>
>>>>>>>>     I apologize but, for confidentiality purpose, I will have to
>>>>>>>>     partially
>>>>>>>>     anonymize the information.
>>>>>>>>
>>>>>>>>     So here is the situation: we have 2 custom packages (let's call them
>>>>>>>>     pkgB and pkgC). The pkgB package depends on a 3rd package (let's
>>>>>>>>     call it
>>>>>>>>     pkgA) that is available on CRAN. The pkgC package depends on
>>>>>>>>     pkgB, make
>>>>>>>>     new function available,  and "overwrites" some of the functions
>>>>>>>>     distributed as part of pkgA. The following table summarizes the
>>>>>>>>     content
>>>>>>>>     of the DESCRIPTION and NAMESPACE files of each of these packages.
>>>>>>>>
>>>>>>>>     package    DESCRIPTION NAMESPACE
>>>>>>>>                 Depends                       Imports
>>>>>>>>     import                         importFrom
>>>>>>>>     pkgA       methods, lattice, grid, gam   Hmisc, survival lattice,
>>>>>>>>     grid,
>>>>>>>>     gam, methods    Hmisc
>>>>>>>>     pkgB       pkgA pkgA
>>>>>>>>     pkgC       methods, pkgB methods, pkgB
>>>>>>>>
>>>>>>>>     I do not get any warning when I build, check or install pkgB in our
>>>>>>>>     linux openSuse environment.
>>>>>>>>
>>>>>>>>     After successful building pkgC, I run R CMD check on my built for
>>>>>>>>     pkgC
>>>>>>>>     but I get a ton of messages under the "checking R code for possible
>>>>>>>>     problems" section. These notes are related to actual calls to pkgA
>>>>>>>>     functions (or to one of the function provided by its
>>>>>>>>     dependencies). Here
>>>>>>>>     is a subset for illustration and hopefully information.
>>>>>>>>
>>>>>>>>     * checking R code for possible problems: NOTE
>>>>>>>>     pkgC_function_001: no visible global function definition
>>>>>>>>     for"pkgA_function_AAA"
>>>>>>>>     pkgC_function_001: no visible global function definition
>>>>>>>>     for"pkgA_function_AAB"
>>>>>>>>     ...
>>>>>>>>     pkgC_function_010: no visible global function definition for"xyplot"
>>>>>>>>     pkgC_function_010: no visible global function definition
>>>>>>>>     for"panel.xyplot"
>>>>>>>>     pkgC_function_010: no visible global function definition
>>>>>>>>     for"panel.abline"
>>>>>>>>     pkgC_function_010: no visible global function definition
>>>>>>>>     for"grid.polygon"
>>>>>>>>     pkgC_function_010: no visible global function definition for"gpar"
>>>>>>>>     ...
>>>>>>>>
>>>>>>>>     Now when I try to install the pkgC_0.0.1.tar.gz package, I get the
>>>>>>>>     following warnings about the content of my documentation Rd
>>>>>>>>     files. The
>>>>>>>>     Rd files of pkgC includes links to lattice, grid, or pkgA functions.
>>>>>>>>
>>>>>>>>     *** installing help indices
>>>>>>>>        converting help for package ?kiwixposedev?
>>>>>>>>          finding HTML links ... done
>>>>>>>>     pkgC_function_001                    html
>>>>>>>>          pkgC_function_002                    html
>>>>>>>>     ...
>>>>>>>>     Rd warning: /tmp/some/path/man/pkgC_function_009.Rd:21: missing file
>>>>>>>>     link "panel.abline"
>>>>>>>>     ...
>>>>>>>>     Rd warning: /tmp/some/path/man/pkgC_function_015.Rd:64: missing file
>>>>>>>>     link "pkA_function_AAC"
>>>>>>>>     ...
>>>>>>>>
>>>>>>>>     I think I need to somehow modify the content of the DESCRIPTION and
>>>>>>>>     NAMESPACE files for pkgC... but adding various combinations of
>>>>>>>>     pkA and
>>>>>>>>     its dependencies gave me others errors about redundancies and
>>>>>>>>     multiple
>>>>>>>>     loading of the same packages. So in short, I am kind of lost with the
>>>>>>>>     new requirements of R 3.1.2 and would greatly appreciate any help or
>>>>>>>>     suggestions
>>>>>>>>
>>>>>>>>     Thank you in advance for your time.
>>>>>>>>
>>>>>>>>     Sebastien Bihorel
>>>>>>>>
>>>>>>>>
>>>>>>>>             [[alternative HTML version deleted]]
>>>>>>>>
>>>>>>>>     ______________________________________________
>>>>>>>>     R-package-devel at r-project.org <javascript:;> mailing list
>>>>>>>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From mauricio.zambrano at ufrontera.cl  Wed Jul 22 00:39:24 2015
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Tue, 21 Jul 2015 19:39:24 -0300
Subject: [R-pkg-devel] Appropriate place to post about CRAN check
 environments etc.
In-Reply-To: <CABtg=KmOmKnvPDx8_NZheR0jraWwwZdkSkDAfwSuBM1ssSRrrg@mail.gmail.com>
References: <CAC2h7usFhVRxbQD0QCuuwi=-h5U5UMTY4SvKnaMyCSG16=TmXw@mail.gmail.com>
	<55AE42B9.8020502@gmail.com> <55AE5B56.70201@gmail.com>
	<CAP6VaruDEfP4K=_V=fD3Fa7i7TVyy2N4i+JU-32rdFG9BgeTZw@mail.gmail.com>
	<CAAHES9xkq7S6xrPW2=DNFMztkgkCvmy+Xf1Zehmjcr-TVbSvyg@mail.gmail.com>
	<CABtg=KmOmKnvPDx8_NZheR0jraWwwZdkSkDAfwSuBM1ssSRrrg@mail.gmail.com>
Message-ID: <CAP6VarsXdTsqUvVO+BX4KuNU1cMBQWN4ank1vJjPAG4PWs4L=g@mail.gmail.com>

Probably I'm too distrustful, but yesterday I tried to use Travis CI
and at the end I didn't do it, because of the permissions you're
requested to give to the application:

Review permissions:

Personal user data                         : Email addresses (read-only)
Repository webhooks and services: Read and write access
Commit statuses                             : Read and write access
Deployments                                   : Manage deployments and
deployment status
Organizations and teams                : Read-only access


Mauricio

=====================================
"When the pupil is ready, the master arrives."
(Zen proverb)
=====================================
Linux user #454569 -- Linux Mint user


On 21 July 2015 at 15:45, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
> On Tue, Jul 21, 2015 at 2:35 PM, Gavin Simpson <ucfagls at gmail.com> wrote:
>> Perhaps I have missed some detail, but would Gabor Csardi's r-builder code
>> not provide this (or something close to it) for Linux at least? See:
>> https://github.com/metacran/r-builder
>
> It does, although it only does Ubuntu 12.04 if you use Travis, because
> that's what Travis has. IMHO this does not really matter for 95% of
> the packages, and having R-devel in addition to R-release and R-oldrel
> is more important.
>
>> This builds on the R support for Travis CI, and allows for testing against
>> R-release and R-devel (plus R-oldrelease IIRC)
>
> It actually does not build on R support for Travis CI. Since it needs
> its own R installations, it does not make much sense to use the
> built-in R support.
>
>> It's pretty trivial to set-up but you do need your code in a github repo
>> (for the Travis deployment - I don't know anything about Semaphore, the
>> other option r-builder allows for).
>
> Yeah, it needs to be on GitHub.
>
> Gabor
>
>> G
>>
>> On 21 July 2015 at 09:04, MAURICIO ZAMBRANO BIGIARINI <
>> mauricio.zambrano at ufrontera.cl> wrote:
>>
>>> On 21 July 2015 at 11:46, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>> > On 21/07/2015 9:01 AM, ProfJCNash wrote:
>>> >>
>>> >> There has been some disagreement on where it is appropriate to post
>>> >> questions about package checking procedures, including the building of
>>> >> the environment e.g., R-devel under Linux Mint.
>>> >>
>>> >> In looking at https://www.r-project.org/mail.html, it seems to me that
>>> >> the procedures belong with r-package-devel, but there doesn't seem to be
>>> >> a good home for the consequent need to build R-devel to do this. Have I
>>> >> missed the appropriate list?
>>> >>
>>> >> It seems to me that the volume of queries of this sort, and the success
>>> >> of WinBuilder, suggest we could seriously use similar a Linbuilder and
>>> >> MacBuilder (and possibly others). There's a lot of duplicated effort
>>> >> being wasted on the R-devel side in particular.
>>> >>
>>> >> Is there sufficient interest to
>>> >> - make the effort to emulate Winbuilder for Linux and/or Mac
>>> >> - coordinate the volunteer effort
>>> >> - fund/support the necessary infrastructure (it could be worth a modest
>>> >> contribution to save effort)?
>>> >>
>>> >> For the record, I'm willing to participate. I've managed to set up Linux
>>> >> Mint VirtualBox instances that run R current and R devel for testing,
>>> >> though I find I must do more work than I'd like to maintain things,
>>> >> likely as a result of my own limited skills.
>>> >
>>> > That sounds like the sort of project the R Consortium would support.
>>> > They are just getting started, but soon they will have a committee set
>>> > up to decide on projects, and presumably soon after that will have a
>>> > process in place to solicit them.
>>> >
>>> > Duncan Murdoch
>>>
>>> In my humble opinion, such a project could be of great utility to
>>> several people that is starting to migrate to GNU/Linux, or to people
>>> willing to test their packages with the latest development version of
>>> R but without all the knowledge to properly set up the environment on
>>> their local machines.
>>>
>>> If I can contribute to a "LinBuilder" (e.g., testing), I would be
>>> willing to do it.
>>>
>>> Kind regards,
>>>
>>>
>>> Mauricio Zambrano-Bigiarini, PhD
>>>
>>> =====================================
>>> Dept. of Civil Engineering
>>> Faculty of Engineering and Sciences
>>> Universidad de La Frontera
>>> PO Box 54-D, Temuco, Chile
>>> =====================================
>>> mailto     : mauricio.zambrano at ufrontera.cl
>>> work-phone : +56 45 259 2812
>>> http://ingenieriacivil.ufro.cl/
>>> =====================================
>>> "When the pupil is ready, the master arrives."
>>> (Zen proverb)
>>> =====================================
>>> Linux user #454569 -- Linux Mint user
>>>
>>> >
>>> > ______________________________________________
>>> > R-package-devel at r-project.org mailing list
>>> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>>
>>
>> --
>> Gavin Simpson, PhD
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From francois.michonneau at gmail.com  Wed Jul 22 01:10:26 2015
From: francois.michonneau at gmail.com (=?UTF-8?Q?Fran=C3=A7ois_Michonneau?=)
Date: Tue, 21 Jul 2015 19:10:26 -0400
Subject: [R-pkg-devel] Packages from other maintainers with win-builder
Message-ID: <CAKL30wUcbdTF3WyKihTzqr=xX1+3FiUK8Vsxk9ZHWZqSvC==WA@mail.gmail.com>

Hello all,

  As I can only easily access computers with Linux, I am very grateful
for the existence of win-builder to test my packages with Windows.

  Today I encountered an issue with win-builder that took me a while
to figure out. My package was failing unit tests on win-builder but I
couldn't reproduce the problem with my setup. It turned out that
win-builder was using an unstable version of a package (with a bug) my
package depended on that must have been uploaded by its maintainer
recently.

  I realize that it's the side effect of the very useful feature of
being able to upload packages serially. However, I am wondering if it
would be possible to implement a way to avoid this kind of situation
and to have an option to ask win-builder to only use the CRAN version
of the packages listed in DESCRIPTION?

  Thanks,
  -- Fran?ois


From ligges at statistik.tu-dortmund.de  Wed Jul 22 03:07:27 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 22 Jul 2015 03:07:27 +0200
Subject: [R-pkg-devel] Packages from other maintainers with win-builder
In-Reply-To: <CAKL30wUcbdTF3WyKihTzqr=xX1+3FiUK8Vsxk9ZHWZqSvC==WA@mail.gmail.com>
References: <CAKL30wUcbdTF3WyKihTzqr=xX1+3FiUK8Vsxk9ZHWZqSvC==WA@mail.gmail.com>
Message-ID: <55AEECCF.8060506@statistik.tu-dortmund.de>

Sounds like a good proposal, but currently this is not implemented.

Best,
Uwe Ligges


On 22.07.2015 01:10, Fran?ois Michonneau wrote:
> Hello all,
>
>    As I can only easily access computers with Linux, I am very grateful
> for the existence of win-builder to test my packages with Windows.
>
>    Today I encountered an issue with win-builder that took me a while
> to figure out. My package was failing unit tests on win-builder but I
> couldn't reproduce the problem with my setup. It turned out that
> win-builder was using an unstable version of a package (with a bug) my
> package depended on that must have been uploaded by its maintainer
> recently.
>
>    I realize that it's the side effect of the very useful feature of
> being able to upload packages serially. However, I am wondering if it
> would be possible to implement a way to avoid this kind of situation
> and to have an option to ask win-builder to only use the CRAN version
> of the packages listed in DESCRIPTION?
>
>    Thanks,
>    -- Fran?ois
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From jonathan at mazamascience.com  Thu Jul 23 00:45:06 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Wed, 22 Jul 2015 15:45:06 -0700
Subject: [R-pkg-devel] DigitalOcean Makefiles for compiling R-devel
Message-ID: <CAPjNR=QjXa4e7MZmu-imwxHUEgdkPw3k6JGnLQsFFLsz5gODag@mail.gmail.com>

All,

We have (finally) started testing our packages with r-revel on Digital
Ocean virtual machines.

To automate the initial setup, we have started creating Makefiles to help
get a clean VM set up with all of the libraries and packages needed to
build and check our own packages with R-devel.

https://github.com/jonathancallahan/DigitalOcean-R-setup

So far, only the Debian 7.0 and 8.1 Makefiles are fully set up for R-devel.

I hope that these Makefiles may help others harness DigitalOcean to
thoroughly test packages before submitting them to CRAN.

Best,

Jon

-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From bob at rudis.net  Thu Jul 23 03:10:21 2015
From: bob at rudis.net (boB Rudis)
Date: Wed, 22 Jul 2015 21:10:21 -0400
Subject: [R-pkg-devel] DigitalOcean Makefiles for compiling R-devel
In-Reply-To: <CAPjNR=QjXa4e7MZmu-imwxHUEgdkPw3k6JGnLQsFFLsz5gODag@mail.gmail.com>
References: <CAPjNR=QjXa4e7MZmu-imwxHUEgdkPw3k6JGnLQsFFLsz5gODag@mail.gmail.com>
Message-ID: <CAJ4QxaOMMvLJG--Bz-b8UNMZqFut-WtB6ZPDed2QJCLJT0g1+Q@mail.gmail.com>

I've got a Vagrant setup (I dislike Docker on OS X) that I'm nearly
ready to push to github as well. Will post here once done.

On Wed, Jul 22, 2015 at 6:45 PM, Jonathan Callahan
<jonathan at mazamascience.com> wrote:
> All,
>
> We have (finally) started testing our packages with r-revel on Digital
> Ocean virtual machines.
>
> To automate the initial setup, we have started creating Makefiles to help
> get a clean VM set up with all of the libraries and packages needed to
> build and check our own packages with R-devel.
>
> https://github.com/jonathancallahan/DigitalOcean-R-setup
>
> So far, only the Debian 7.0 and 8.1 Makefiles are fully set up for R-devel.
>
> I hope that these Makefiles may help others harness DigitalOcean to
> thoroughly test packages before submitting them to CRAN.
>
> Best,
>
> Jon
>
> --
> Jonathan Callahan, PhD
> Mazama Science
> 206-708-5028
> mazamascience.com
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From dmarcelino at live.com  Thu Jul 23 23:21:27 2015
From: dmarcelino at live.com (Daniel Marcelino)
Date: Thu, 23 Jul 2015 19:21:27 -0200
Subject: [R-pkg-devel] =?windows-1256?q?checking_S3_generic/method_consist?=
 =?windows-1256?b?ZW5jeSAuLi4gTk9URf4=?=
Message-ID: <SNT146-W280FB3B9ABBB13E943BC06BB820@phx.gbl>

Hi, I would like to know how you are calming?down the?R check. I've an issue with the `head` method. I'm incorporating ?a head for data base, but nothing that I add ?in the function file seems to be able to silence the R check. Below is what I have:
?
checking S3 generic/method consistency ... NOTE
Found the following apparent S3 methods exported but not registered:
?head.SQLiteConnection


#' Return the first n elements of a SQLiteConnection object
#'
#' If a database connection is selected, returns a dataframe of table names.
#' If a table name is also supplied, the first n rows from the table are returned.
#'
#' @param x A database connection object or a table name.
#' @param \dots Additional arguments
#' @param table character specifying a table
#' @param n integer: Number of rows to output
#' @param temp logical should the function list the temp tables
#'
#' @export head.SQLiteConnection
#' @method head SQLiteConnection
#' @importFrom RSQLite dbGetQuery
#' @importFrom utils head
#' @rdname head
head.SQLiteConnection <- function(x, table = NULL, n = 10L, temp = FALSE, ...){
? if(is.null(table)){
? ? if(temp){
? ? ? RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM sqlite_temp_master;", ...)
? ? } else RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM sqlite_master;", ...)

? } else {
? ? RSQLite::dbGetQuery(x, sprintf("SELECT * FROM %s LIMIT %d;", table, n), ...)
? }
}



Daniel? 		 	   		  

From ligges at statistik.tu-dortmund.de  Fri Jul 24 00:18:10 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 24 Jul 2015 00:18:10 +0200
Subject: [R-pkg-devel]
 =?utf-8?q?checking_S3_generic/method_consistency_?=
 =?utf-8?b?Li4uIE5PVEXigI8=?=
In-Reply-To: <SNT146-W280FB3B9ABBB13E943BC06BB820@phx.gbl>
References: <SNT146-W280FB3B9ABBB13E943BC06BB820@phx.gbl>
Message-ID: <55B16822.6040609@statistik.tu-dortmund.de>



On 23.07.2015 23:21, Daniel Marcelino wrote:
> Hi, I would like to know how you are calming down the R check. I've an issue with the `head` method. I'm incorporating  a head for data base, but nothing that I add  in the function file seems to be able to silence the R check. Below is what I have:
>
> checking S3 generic/method consistency ... NOTE
> Found the following apparent S3 methods exported but not registered:
>   head.SQLiteConnection


So register it as an S3 method in your NAMESPACE file.

Best,
Uwe Ligges


>
>
> #' Return the first n elements of a SQLiteConnection object
> #'
> #' If a database connection is selected, returns a dataframe of table names.
> #' If a table name is also supplied, the first n rows from the table are returned.
> #'
> #' @param x A database connection object or a table name.
> #' @param \dots Additional arguments
> #' @param table character specifying a table
> #' @param n integer: Number of rows to output
> #' @param temp logical should the function list the temp tables
> #'
> #' @export head.SQLiteConnection
> #' @method head SQLiteConnection
> #' @importFrom RSQLite dbGetQuery
> #' @importFrom utils head
> #' @rdname head
> head.SQLiteConnection <- function(x, table = NULL, n = 10L, temp = FALSE, ...){
>    if(is.null(table)){
>      if(temp){
>        RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM sqlite_temp_master;", ...)
>      } else RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM sqlite_master;", ...)
>
>    } else {
>      RSQLite::dbGetQuery(x, sprintf("SELECT * FROM %s LIMIT %d;", table, n), ...)
>    }
> }
>
>
>
> Daniel  		 	   		
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From ucfagls at gmail.com  Fri Jul 24 00:41:37 2015
From: ucfagls at gmail.com (Gavin Simpson)
Date: Thu, 23 Jul 2015 16:41:37 -0600
Subject: [R-pkg-devel]
	=?utf-8?q?checking_S3_generic/method_consistency_?=
	=?utf-8?b?Li4uIE5PVEXigI8=?=
In-Reply-To: <SNT146-W280FB3B9ABBB13E943BC06BB820@phx.gbl>
References: <SNT146-W280FB3B9ABBB13E943BC06BB820@phx.gbl>
Message-ID: <CAAHES9wNrYoU3PK+LAqmxuOTQ8Dy9xR4fkoR0nMaQrkc7k5ZwQ@mail.gmail.com>

Hi Daniel

You should only neee

#' @export

in your roxygen markup as roxygen (well recent versions anyway) are able to
do the right thing and work out what needs to go into the NAMESPACE file.
You don't need @method now, except in cases where there is ambiguity about
the method/class, which shouldn;t be the case here.

See: http://r-pkgs.had.co.nz/namespace.html#exports

HTH

G

On 23 July 2015 at 15:21, Daniel Marcelino <dmarcelino at live.com> wrote:

> Hi, I would like to know how you are calming down the R check. I've an
> issue with the `head` method. I'm incorporating  a head for data base, but
> nothing that I add  in the function file seems to be able to silence the R
> check. Below is what I have:
>
> checking S3 generic/method consistency ... NOTE
> Found the following apparent S3 methods exported but not registered:
>  head.SQLiteConnection
>
>
> #' Return the first n elements of a SQLiteConnection object
> #'
> #' If a database connection is selected, returns a dataframe of table
> names.
> #' If a table name is also supplied, the first n rows from the table are
> returned.
> #'
> #' @param x A database connection object or a table name.
> #' @param \dots Additional arguments
> #' @param table character specifying a table
> #' @param n integer: Number of rows to output
> #' @param temp logical should the function list the temp tables
> #'
> #' @export head.SQLiteConnection
> #' @method head SQLiteConnection
> #' @importFrom RSQLite dbGetQuery
> #' @importFrom utils head
> #' @rdname head
> head.SQLiteConnection <- function(x, table = NULL, n = 10L, temp = FALSE,
> ...){
>   if(is.null(table)){
>     if(temp){
>       RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM
> sqlite_temp_master;", ...)
>     } else RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM
> sqlite_master;", ...)
>
>   } else {
>     RSQLite::dbGetQuery(x, sprintf("SELECT * FROM %s LIMIT %d;", table,
> n), ...)
>   }
> }
>
>
>
> Daniel
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



-- 
Gavin Simpson, PhD

	[[alternative HTML version deleted]]


From dmarcelino at live.com  Fri Jul 24 02:21:42 2015
From: dmarcelino at live.com (Daniel Marcelino)
Date: Thu, 23 Jul 2015 22:21:42 -0200
Subject: [R-pkg-devel]
 =?windows-1256?q?checking_S3_generic/method_consist?=
 =?windows-1256?b?ZW5jeSAuLi4gTk9URf4=?=
In-Reply-To: <CAAHES9wNrYoU3PK+LAqmxuOTQ8Dy9xR4fkoR0nMaQrkc7k5ZwQ@mail.gmail.com>
References: <SNT146-W280FB3B9ABBB13E943BC06BB820@phx.gbl>,
	<CAAHES9wNrYoU3PK+LAqmxuOTQ8Dy9xR4fkoR0nMaQrkc7k5ZwQ@mail.gmail.com>
Message-ID: <SNT146-W83498D554AFD5145183986BB810@phx.gbl>

That should work then, I confused myself how to properly document S3 methods using Roxygen. Thanks for this.?

Daniel
________________________________
> Date: Thu, 23 Jul 2015 16:41:37 -0600 
> Subject: Re: [R-pkg-devel] checking S3 generic/method consistency ... NOTE? 
> From: ucfagls at gmail.com 
> To: dmarcelino at live.com 
> CC: r-package-devel at r-project.org 
> 
> Hi Daniel 
> 
> You should only neee 
> 
> #' @export 
> 
> in your roxygen markup as roxygen (well recent versions anyway) are 
> able to do the right thing and work out what needs to go into the 
> NAMESPACE file. You don't need @method now, except in cases where there 
> is ambiguity about the method/class, which shouldn;t be the case here. 
> 
> See: http://r-pkgs.had.co.nz/namespace.html#exports 
> 
> HTH 
> 
> G 
> 
> On 23 July 2015 at 15:21, Daniel Marcelino 
> <dmarcelino at live.com<mailto:dmarcelino at live.com>> wrote: 
> Hi, I would like to know how you are calming down the R check. I've an 
> issue with the `head` method. I'm incorporating a head for data base, 
> but nothing that I add in the function file seems to be able to 
> silence the R check. Below is what I have: 
> 
> checking S3 generic/method consistency ... NOTE 
> Found the following apparent S3 methods exported but not registered: 
> head.SQLiteConnection 
> 
> 
> #' Return the first n elements of a SQLiteConnection object 
> #' 
> #' If a database connection is selected, returns a dataframe of table names. 
> #' If a table name is also supplied, the first n rows from the table 
> are returned. 
> #' 
> #' @param x A database connection object or a table name. 
> #' @param \dots Additional arguments 
> #' @param table character specifying a table 
> #' @param n integer: Number of rows to output 
> #' @param temp logical should the function list the temp tables 
> #' 
> #' @export head.SQLiteConnection 
> #' @method head SQLiteConnection 
> #' @importFrom RSQLite dbGetQuery 
> #' @importFrom utils head 
> #' @rdname head 
> head.SQLiteConnection <- function(x, table = NULL, n = 10L, temp = 
> FALSE, ...){ 
> if(is.null(table)){ 
> if(temp){ 
> RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM 
> sqlite_temp_master;", ...) 
> } else RSQLite::dbGetQuery(x, "SELECT type, name, tbl_name FROM 
> sqlite_master;", ...) 
> 
> } else { 
> RSQLite::dbGetQuery(x, sprintf("SELECT * FROM %s LIMIT %d;", table, 
> n), ...) 
> } 
> } 
> 
> 
> 
> Daniel 
> ______________________________________________ 
> R-package-devel at r-project.org<mailto:R-package-devel at r-project.org> 
> mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-package-devel 
> 
> 
> 
> -- 
> Gavin Simpson, PhD 
 		 	   		  

From russell-lenth at uiowa.edu  Sun Jul 26 20:42:46 2015
From: russell-lenth at uiowa.edu (Lenth, Russell V)
Date: Sun, 26 Jul 2015 18:42:46 +0000
Subject: [R-pkg-devel] Best practices for vignettes
Message-ID: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>

Yesterday, I submitted a package to CRAN that I had previously built using `R CMD build' (no extra arguments), and checked with 'R-devel CMD check --as-cran' (R-devel is my installation of the latest development version). No errors were reported in either of these steps. 

However, the submitted package contained a LaTeX error in one of the vignettes -- it had \paragaph{} instead of \paragraph{}. And the submission bounced back from CRAN because their checking DID catch the error.

So I have two questions...

1. How could a LaTeX error in a vignette possibly get past either R CMD build or R CMD check --as-cran without errors being reported? (I'll mention that subsequently I manually ran Sweave and pdflatex on the vignette and it did report the error -- confirming that I don't have a \paragaph macro defined somewhere on my own system.) FWIW, this IS system-dependent, as I do get error messages if I try to build the package on a Mac Pro. But I don't use that as my primary machine, as it is old, slow, and a laptop. I have a Windows 7 Pro system, service pack 1,
MiKTeX-pdfTeX 2.9.5496 (1.40.15) (MiKTeX 2.9 64-bit). Perhaps there's something different about error flags returned by MiKTeX and how they interact with R.

2. I have struggled previously with vignettes, as they sometimes have not been re-built when I wanted them to be. So I have finally settled on just putting the source file and nothing else in the vignettes directory. But that's what messed me up, because I made a minor change and incorrectly trusted the build process with detecting any errors. Clearly, I don't fully understand how vignettes are handled. What's the best way to manage vignettes?

Thanks

Russ

Russell V. Lenth  -  Professor Emeritus
Department of Statistics and Actuarial Science   
The University of Iowa  -  Iowa City, IA 52242  USA   
Voice (319)335-0712 (Dept. office)  -  FAX (319)335-3017


From edd at debian.org  Sun Jul 26 21:22:53 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 26 Jul 2015 14:22:53 -0500
Subject: [R-pkg-devel] Best practices for vignettes
In-Reply-To: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>
References: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>
Message-ID: <21941.13197.155891.302153@max.nulle.part>


On 26 July 2015 at 18:42, Lenth, Russell V wrote:
| What's the best way to manage vignettes?

All the young ones will of course tell you to use Markdown :)

I still use Sweave / LaTeX as well, along with a custom driver: highlight, as
we once figured out how to make it create pretty shaded boxen with code (as
seen in the various Rcpp vignettes).

So for that I often keep a five-line script 'buildVignette.r' in the vignette
directory.  With DESCRIPTION set up right (for the added vignette driver)
this then works in the package when it works manually for the tests.

And during the R CMD build ... ; R CMD INSTALL ... steps the vignette does
get rebuild.

Oh, but did I mention that markdown is easier?  ;-)   Earlier this year I
converted to writing my LateX Beamer presentation in RMarkdown (which
rmarkdown::render() then converts to LaTeX). I may, time permitting, look
into converting vignetts.  But why mess with a working setup...

Dirk


PS buildVignette.r from an older package I am currently working on

#!/usr/bin/Rscript

## use given argument(s) as target files, or else default to .Rnw files in directory
files <- if (length(commandArgs(TRUE)) == 0) dir(pattern="*.Rnw") else commandArgs(TRUE)

## convert all files from Rnw to pdf using the highlight driver
invisible(sapply(files, function(srcfile) {
    Sweave(srcfile, driver=highlight::HighlightWeaveLatex(boxes=TRUE))
    tools::texi2pdf(gsub(".Rnw", ".tex", srcfile))
}))


-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd at debian.org  Sun Jul 26 21:31:02 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 26 Jul 2015 14:31:02 -0500
Subject: [R-pkg-devel] Best practices for vignettes
In-Reply-To: <21941.13197.155891.302153@max.nulle.part>
References: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>
	<21941.13197.155891.302153@max.nulle.part>
Message-ID: <21941.13686.234964.405959@max.nulle.part>


On 26 July 2015 at 14:22, Dirk Eddelbuettel wrote:
| 
| On 26 July 2015 at 18:42, Lenth, Russell V wrote:
| | What's the best way to manage vignettes?
| 
| All the young ones will of course tell you to use Markdown :)
| 
| I still use Sweave / LaTeX as well, along with a custom driver: highlight, as
| we once figured out how to make it create pretty shaded boxen with code (as
| seen in the various Rcpp vignettes).
| 
| So for that I often keep a five-line script 'buildVignette.r' in the vignette
| directory.  With DESCRIPTION set up right (for the added vignette driver)
| this then works in the package when it works manually for the tests.

I was rambling here.  What I meant to say is

 - buildVignette.r as shown below allows me to build the vignette on the spot
   outside of package builds -- ie when I am in "vignette writing mode"

 - if the vignette builds during the manual builds, which by their design
   mock what the package build process does, then I am reasonably confident
   that the R CMD ... process works too.

Hope this clarifies.

Dirk

| 
| And during the R CMD build ... ; R CMD INSTALL ... steps the vignette does
| get rebuild.
| 
| Oh, but did I mention that markdown is easier?  ;-)   Earlier this year I
| converted to writing my LateX Beamer presentation in RMarkdown (which
| rmarkdown::render() then converts to LaTeX). I may, time permitting, look
| into converting vignetts.  But why mess with a working setup...
| 
| Dirk
| 
| 
| PS buildVignette.r from an older package I am currently working on
| 
| #!/usr/bin/Rscript
| 
| ## use given argument(s) as target files, or else default to .Rnw files in directory
| files <- if (length(commandArgs(TRUE)) == 0) dir(pattern="*.Rnw") else commandArgs(TRUE)
| 
| ## convert all files from Rnw to pdf using the highlight driver
| invisible(sapply(files, function(srcfile) {
|     Sweave(srcfile, driver=highlight::HighlightWeaveLatex(boxes=TRUE))
|     tools::texi2pdf(gsub(".Rnw", ".tex", srcfile))
| }))
| 
| 
| -- 
| http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From russell-lenth at uiowa.edu  Mon Jul 27 01:31:19 2015
From: russell-lenth at uiowa.edu (Lenth, Russell V)
Date: Sun, 26 Jul 2015 23:31:19 +0000
Subject: [R-pkg-devel] Best practices for vignettes
In-Reply-To: <21941.13686.234964.405959@max.nulle.part>
References: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>
	<21941.13197.155891.302153@max.nulle.part>
	<21941.13686.234964.405959@max.nulle.part>
Message-ID: <51F0C7C54B032A42A23B74A088E7141C44195BD8@itsnt443.iowa.uiowa.edu>

Thanks, Dirk. Well, I tried this (after suitable modification), and what it does is create all the intermediate files, graphics files, an .Rout file, etc. in the vignette directory. And even then, for some reason it didn't build the pdfs correctly. So I had a mess to clean up.

I've tried Markdown a few times, and technically, I guess it works. But I always find myself abandoning it later because it gives me what it wants instead of what I want. I suppose I could learn more of its refinements, but even then it doesn't seem very promising. I'm not too old to learn new things, but at my age, I think I am empowered to choose what I want to learn -- and expertise on Markdown is just not a big priority.

Russ

-----Original Message-----
From: Dirk Eddelbuettel [mailto:edd at debian.org] 
Sent: Sunday, July 26, 2015 2:31 PM
To: Dirk Eddelbuettel <edd at debian.org>
Cc: Lenth, Russell V <russell-lenth at uiowa.edu>; r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] Best practices for vignettes


On 26 July 2015 at 14:22, Dirk Eddelbuettel wrote:
| 
| On 26 July 2015 at 18:42, Lenth, Russell V wrote:
| | What's the best way to manage vignettes?
| 
| All the young ones will of course tell you to use Markdown :)
| 
| I still use Sweave / LaTeX as well, along with a custom driver: 
| highlight, as we once figured out how to make it create pretty shaded 
| boxen with code (as seen in the various Rcpp vignettes).
| 
| So for that I often keep a five-line script 'buildVignette.r' in the 
| vignette directory.  With DESCRIPTION set up right (for the added 
| vignette driver) this then works in the package when it works manually for the tests.

I was rambling here.  What I meant to say is

 - buildVignette.r as shown below allows me to build the vignette on the spot
   outside of package builds -- ie when I am in "vignette writing mode"

 - if the vignette builds during the manual builds, which by their design
   mock what the package build process does, then I am reasonably confident
   that the R CMD ... process works too.

Hope this clarifies.

Dirk


From henrik.bengtsson at ucsf.edu  Mon Jul 27 12:50:52 2015
From: henrik.bengtsson at ucsf.edu (Henrik Bengtsson)
Date: Mon, 27 Jul 2015 12:50:52 +0200
Subject: [R-pkg-devel] Best practices for vignettes
In-Reply-To: <51F0C7C54B032A42A23B74A088E7141C44195BD8@itsnt443.iowa.uiowa.edu>
References: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>
	<21941.13197.155891.302153@max.nulle.part>
	<21941.13686.234964.405959@max.nulle.part>
	<51F0C7C54B032A42A23B74A088E7141C44195BD8@itsnt443.iowa.uiowa.edu>
Message-ID: <CAFDcVCSF0ZL3NHWOZ_h+t221Xix4UDOT=PqjGh=hNMQzJYgojg@mail.gmail.com>

Have a look at tools::buildVignette() - it builds a vignette the same
way as R CMD build does it.  It's a good start for troubleshooting.

/Henrik

On Mon, Jul 27, 2015 at 1:31 AM, Lenth, Russell V
<russell-lenth at uiowa.edu> wrote:
> Thanks, Dirk. Well, I tried this (after suitable modification), and what it does is create all the intermediate files, graphics files, an .Rout file, etc. in the vignette directory. And even then, for some reason it didn't build the pdfs correctly. So I had a mess to clean up.
>
> I've tried Markdown a few times, and technically, I guess it works. But I always find myself abandoning it later because it gives me what it wants instead of what I want. I suppose I could learn more of its refinements, but even then it doesn't seem very promising. I'm not too old to learn new things, but at my age, I think I am empowered to choose what I want to learn -- and expertise on Markdown is just not a big priority.
>
> Russ
>
> -----Original Message-----
> From: Dirk Eddelbuettel [mailto:edd at debian.org]
> Sent: Sunday, July 26, 2015 2:31 PM
> To: Dirk Eddelbuettel <edd at debian.org>
> Cc: Lenth, Russell V <russell-lenth at uiowa.edu>; r-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] Best practices for vignettes
>
>
> On 26 July 2015 at 14:22, Dirk Eddelbuettel wrote:
> |
> | On 26 July 2015 at 18:42, Lenth, Russell V wrote:
> | | What's the best way to manage vignettes?
> |
> | All the young ones will of course tell you to use Markdown :)
> |
> | I still use Sweave / LaTeX as well, along with a custom driver:
> | highlight, as we once figured out how to make it create pretty shaded
> | boxen with code (as seen in the various Rcpp vignettes).
> |
> | So for that I often keep a five-line script 'buildVignette.r' in the
> | vignette directory.  With DESCRIPTION set up right (for the added
> | vignette driver) this then works in the package when it works manually for the tests.
>
> I was rambling here.  What I meant to say is
>
>  - buildVignette.r as shown below allows me to build the vignette on the spot
>    outside of package builds -- ie when I am in "vignette writing mode"
>
>  - if the vignette builds during the manual builds, which by their design
>    mock what the package build process does, then I am reasonably confident
>    that the R CMD ... process works too.
>
> Hope this clarifies.
>
> Dirk
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd at debian.org  Mon Jul 27 13:32:05 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 27 Jul 2015 06:32:05 -0500
Subject: [R-pkg-devel] Best practices for vignettes
In-Reply-To: <CAFDcVCSF0ZL3NHWOZ_h+t221Xix4UDOT=PqjGh=hNMQzJYgojg@mail.gmail.com>
References: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>
	<21941.13197.155891.302153@max.nulle.part>
	<21941.13686.234964.405959@max.nulle.part>
	<51F0C7C54B032A42A23B74A088E7141C44195BD8@itsnt443.iowa.uiowa.edu>
	<CAFDcVCSF0ZL3NHWOZ_h+t221Xix4UDOT=PqjGh=hNMQzJYgojg@mail.gmail.com>
Message-ID: <21942.5813.690597.281594@max.nulle.part>


On 27 July 2015 at 12:50, Henrik Bengtsson wrote:
| Have a look at tools::buildVignette() - it builds a vignette the same
| way as R CMD build does it.  It's a good start for troubleshooting.

Seconded.
 
| /Henrik
| 
| On Mon, Jul 27, 2015 at 1:31 AM, Lenth, Russell V
| <russell-lenth at uiowa.edu> wrote:
| > Thanks, Dirk. Well, I tried this (after suitable modification), and what it does is create all the intermediate files, graphics files, an .Rout file, etc. in the vignette directory. And even then, for some reason it didn't build the pdfs correctly. So I had a mess to clean up.

If you have the patience, you probably want to debug this piece by piece, and
maybe making the vignette (temporarily) smaller and smaller and less
dependent on other things.

Sometimes it is the little things. I once had 'build/' in .Rbuildignore
because I thought it was spurious. Not so. Tooks more than one iteration,
countless feeble attempts and an eventual hint from a CRAN maintainer.

Another debugging strategy is to grab a (small enough) existing package by
someone else and see _exactly_ how it is setup.

Lastly, "if you can't beat'em" ...  I do have some Markdown vignettes in a
newer package (drat) and that works well.  Doesn't look as perfect as a pdf,
but html rendering has its charms and uses.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From russell-lenth at uiowa.edu  Mon Jul 27 19:29:38 2015
From: russell-lenth at uiowa.edu (Lenth, Russell V)
Date: Mon, 27 Jul 2015 17:29:38 +0000
Subject: [R-pkg-devel] Best practices for vignettes
In-Reply-To: <CAFDcVCSF0ZL3NHWOZ_h+t221Xix4UDOT=PqjGh=hNMQzJYgojg@mail.gmail.com>
References: <51F0C7C54B032A42A23B74A088E7141C441957DA@itsnt443.iowa.uiowa.edu>
	<21941.13197.155891.302153@max.nulle.part>
	<21941.13686.234964.405959@max.nulle.part>
	<51F0C7C54B032A42A23B74A088E7141C44195BD8@itsnt443.iowa.uiowa.edu>,
	<CAFDcVCSF0ZL3NHWOZ_h+t221Xix4UDOT=PqjGh=hNMQzJYgojg@mail.gmail.com>
Message-ID: <51F0C7C54B032A42A23B74A088E7141C4419887E@itsnt443.iowa.uiowa.edu>

Thanks. This helped me learn a few things...

1. buildVignettes() operates on an installed package. So in RStudio, I do "build and reload" and it copies the vignette sources to the right place. Unfortunately, it does not also copy the associated .bib file, and it erases the one already there. So I have to manually copy it each time. However, I could script this and thus be able to get a reliable test of the vignettes.

2. I now know why I didn't get a build error. For testing, I put my LaTeX error back in the vignette... 
  -- On Windows with MikTeX, buildVignettes() reports only a warning that the pdflatex process returned an exit code of 1. 
  -- On the Mac with TeX Live, I get an error, not just a warning.
I suspect that TeX Live returns a higher error code for the same error. 

Most important, it appears that developers who use Windows with MikTeX should be advised that they will NOT detect certain LaTeX errors in routine building and checking. It might be worth switching to a different Windows installation of TeX.

Russ
--
Russell V. Lenth  -  Professor Emeritus
Department of Statistics and Actuarial Science
The University of Iowa  -  Iowa City, IA 52242  USA
Dept office (319)335-0712  -  FAX (319)335-3017
russell-lenth at uiowa.edu  -  http://www.stat.uiowa.edu/~rlenth/

________________________________________
From: Henrik Bengtsson [henrik.bengtsson at ucsf.edu]
Sent: Monday, July 27, 2015 5:50 AM
To: Lenth, Russell V
Cc: Dirk Eddelbuettel; r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] Best practices for vignettes

Have a look at tools::buildVignette() - it builds a vignette the same
way as R CMD build does it.  It's a good start for troubleshooting.

/Henrik



From Ray.Brownrigg at ecs.vuw.ac.nz  Wed Jul 29 21:07:50 2015
From: Ray.Brownrigg at ecs.vuw.ac.nz (Ray Brownrigg)
Date: Thu, 30 Jul 2015 07:07:50 +1200
Subject: [R-pkg-devel] new maintainer sought for maps packages
Message-ID: <55B92486.4020202@ecs.vuw.ac.nz>

I am about to retire from my 'day job' and will therefore have little 
further association with acadaemia/research in general or R in 
particular.  I am currently maintainer for the 3 mapping packages maps, 
mapdata and mapproj.

Is there anyone out there who would be willing to take this on?

I have had an offer from someone who is prepared to act as a backup in 
the case that nobody else is interested, as a better option than letting 
those packages become orphaned.  However because he has a young family 
at home he has indicated that he would gladly defer to someone who had 
the time and inclination.

The 3 packages have recently been updated to incorporate changes 
necessitated by the R-devel version of check.

So please reply as soon as possible if you may be interested in this.  
Note that from next week, my official address will auto-respond to 
indicate I no longer work there, but I will still have access to that 
account and will be checking it during August (but not September or 
October).

Ray Brownrigg
School of Engineering and Computer Science
Victoria University of Wellington
Wellington, New Zealand


From ralmond at macosx.com  Thu Jul 30 20:53:10 2015
From: ralmond at macosx.com (Russell Almond)
Date: Thu, 30 Jul 2015 14:53:10 -0400
Subject: [R-pkg-devel] R CMD build with configure-args
Message-ID: <55BA7296.8020406@macosx.com>


I've got a package that uses C code to link R to a third-party library.

I've set up my configure script to take an argument --with-netica
which passes the location of the library, header files, &c.

So I can install the package using:

   $ R CMD INSTALL RNetica
--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'

and check the packge (build the manual) using:

   $ R CMD check RNetica
--install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"

My problem comes when I want to build a source tarball for
distribution.  I used to use:

   $ R CMD build RNetica
--install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"

but that generates an error:

   gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG     -I. -I/src -fpic
-g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat
-Werror=format-security -D_FORTIFY_SOURCE=2 -g  -c Cases.c -o Cases.o
   In file included from Cases.c:18:0:
   ./RNetica.h:4:20: fatal error: Netica.h: No such file or directory
    #include <Netica.h>
                       ^

basically, it the Includes directory is not getting set correctly.  If
I use the same syntax as the INSTALL (i.e., just configure-args and
not the install-args wrapper) I get the same error message.  R CMD
INSTALL --build creates a binary tarball and not a source.

I think used to work correctly under R 3.1.  Did I miss something in
the release notes?

I'm having this problem under Ubuntu 14.4 (I think I'm also having the
problem on Mac OS X; I'm not having the problem under Windows, but
mostly because I'm using an environmental variable instead of a
command line argument to pass the location of the 3rd party library.)

Thanks in advance for any help.

-- 
Russell Almond
Associate Professor, Measurement & Statistics
Educational Psychology and Learning Systems
1114 W. Call St.
Florida State University
Tallahassee, FL 32306
(850) 644-5203
ralmond at fsu.edu
http://ralmond.net/


From murdoch.duncan at gmail.com  Thu Jul 30 22:08:10 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 30 Jul 2015 16:08:10 -0400
Subject: [R-pkg-devel] R CMD build with configure-args
In-Reply-To: <55BA7296.8020406@macosx.com>
References: <55BA7296.8020406@macosx.com>
Message-ID: <55BA842A.5030806@gmail.com>

On 30/07/2015 2:53 PM, Russell Almond wrote:
> 
> I've got a package that uses C code to link R to a third-party library.
> 
> I've set up my configure script to take an argument --with-netica
> which passes the location of the library, header files, &c.
> 
> So I can install the package using:
> 
>    $ R CMD INSTALL RNetica
> --configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'
> 
> and check the packge (build the manual) using:
> 
>    $ R CMD check RNetica
> --install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"
> 
> My problem comes when I want to build a source tarball for
> distribution.  I used to use:
> 
>    $ R CMD build RNetica
> --install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"

When you say "used to use", when was that?  There was no --install-args
option in R 3.0.  I think there should be, and I can add it, but I'd
like to know if it was removed for a reason.

Duncan Murdoch

> 
> but that generates an error:
> 
>    gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG     -I. -I/src -fpic
> -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat
> -Werror=format-security -D_FORTIFY_SOURCE=2 -g  -c Cases.c -o Cases.o
>    In file included from Cases.c:18:0:
>    ./RNetica.h:4:20: fatal error: Netica.h: No such file or directory
>     #include <Netica.h>
>                        ^
> 
> basically, it the Includes directory is not getting set correctly.  If
> I use the same syntax as the INSTALL (i.e., just configure-args and
> not the install-args wrapper) I get the same error message.  R CMD
> INSTALL --build creates a binary tarball and not a source.
> 
> I think used to work correctly under R 3.1.  Did I miss something in
> the release notes?
> 
> I'm having this problem under Ubuntu 14.4 (I think I'm also having the
> problem on Mac OS X; I'm not having the problem under Windows, but
> mostly because I'm using an environmental variable instead of a
> command line argument to pass the location of the 3rd party library.)
> 
> Thanks in advance for any help.
>


From ralmond at macosx.com  Thu Jul 30 22:52:53 2015
From: ralmond at macosx.com (Russell Almond)
Date: Thu, 30 Jul 2015 16:52:53 -0400
Subject: [R-pkg-devel] R CMD build with configure-args
In-Reply-To: <55BA842A.5030806@gmail.com>
References: <55BA7296.8020406@macosx.com> <55BA842A.5030806@gmail.com>
Message-ID: <55BA8EA5.9030401@macosx.com>

The behavior changed somewhere along the line.  I think it is related to 
the version bump from 3.1 to 3.2, but it could have been earlier.

It used to be when I wanted to release a version of my package I would run:

INSTALL
check
build
INSTALL --build (on each of a Windows and Mac box).

to create source and binary tarballs.

I was never quite sure if I needed the check syntax or the INSTALL 
syntax for build.  Somewhere along the line it stopped working.  I'm not 
sure exactly when, because I was working around by creating the source 
tarball on the Windows box where I was using an environmental variable 
instead of the command line arg.

I suspect that what must have happened is that previously build did not 
try to recompile the package (or used my source directory where the 
binaries where already in place).  Now it does, so it would probably be 
useful to add the --install-args switch.

	--Russell


On 07/30/2015 04:08 PM, Duncan Murdoch wrote:
> On 30/07/2015 2:53 PM, Russell Almond wrote:
>>
>> I've got a package that uses C code to link R to a third-party library.
>>
>> I've set up my configure script to take an argument --with-netica
>> which passes the location of the library, header files, &c.
>>
>> So I can install the package using:
>>
>>     $ R CMD INSTALL RNetica
>> --configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'
>>
>> and check the packge (build the manual) using:
>>
>>     $ R CMD check RNetica
>> --install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"
>>
>> My problem comes when I want to build a source tarball for
>> distribution.  I used to use:
>>
>>     $ R CMD build RNetica
>> --install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"
>
> When you say "used to use", when was that?  There was no --install-args
> option in R 3.0.  I think there should be, and I can add it, but I'd
> like to know if it was removed for a reason.
>
> Duncan Murdoch
>
>>
>> but that generates an error:
>>
>>     gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG     -I. -I/src -fpic
>> -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat
>> -Werror=format-security -D_FORTIFY_SOURCE=2 -g  -c Cases.c -o Cases.o
>>     In file included from Cases.c:18:0:
>>     ./RNetica.h:4:20: fatal error: Netica.h: No such file or directory
>>      #include <Netica.h>
>>                         ^
>>
>> basically, it the Includes directory is not getting set correctly.  If
>> I use the same syntax as the INSTALL (i.e., just configure-args and
>> not the install-args wrapper) I get the same error message.  R CMD
>> INSTALL --build creates a binary tarball and not a source.
>>
>> I think used to work correctly under R 3.1.  Did I miss something in
>> the release notes?
>>
>> I'm having this problem under Ubuntu 14.4 (I think I'm also having the
>> problem on Mac OS X; I'm not having the problem under Windows, but
>> mostly because I'm using an environmental variable instead of a
>> command line argument to pass the location of the 3rd party library.)
>>
>> Thanks in advance for any help.
>>
>

-- 
Russell Almond
Associate Professor, Measurement & Statistics
Educational Psychology and Learning Systems
1114 W. Call St.
Florida State University
Tallahassee, FL 32306
(850) 644-5203
ralmond at fsu.edu
http://ralmond.net/


From murdoch.duncan at gmail.com  Thu Jul 30 23:01:41 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 30 Jul 2015 17:01:41 -0400
Subject: [R-pkg-devel] R CMD build with configure-args
In-Reply-To: <55BA8EA5.9030401@macosx.com>
References: <55BA7296.8020406@macosx.com> <55BA842A.5030806@gmail.com>
	<55BA8EA5.9030401@macosx.com>
Message-ID: <55BA90B5.6010009@gmail.com>

On 30/07/2015 4:52 PM, Russell Almond wrote:
> The behavior changed somewhere along the line. 

If you don't want to spend the time to answer a simple question like
"when did you see that?", why do you expect others to spend time solving
your problem?

Duncan Murdoch

 I think it is related to
> the version bump from 3.1 to 3.2, but it could have been earlier.
> 
> It used to be when I wanted to release a version of my package I would run:
> 
> INSTALL
> check
> build
> INSTALL --build (on each of a Windows and Mac box).
> 
> to create source and binary tarballs.
> 
> I was never quite sure if I needed the check syntax or the INSTALL 
> syntax for build.  Somewhere along the line it stopped working.  I'm not 
> sure exactly when, because I was working around by creating the source 
> tarball on the Windows box where I was using an environmental variable 
> instead of the command line arg.
> 
> I suspect that what must have happened is that previously build did not 
> try to recompile the package (or used my source directory where the 
> binaries where already in place).  Now it does, so it would probably be 
> useful to add the --install-args switch.
> 
> 	--Russell
> 
> 
> On 07/30/2015 04:08 PM, Duncan Murdoch wrote:
>> On 30/07/2015 2:53 PM, Russell Almond wrote:
>>>
>>> I've got a package that uses C code to link R to a third-party library.
>>>
>>> I've set up my configure script to take an argument --with-netica
>>> which passes the location of the library, header files, &c.
>>>
>>> So I can install the package using:
>>>
>>>     $ R CMD INSTALL RNetica
>>> --configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'
>>>
>>> and check the packge (build the manual) using:
>>>
>>>     $ R CMD check RNetica
>>> --install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"
>>>
>>> My problem comes when I want to build a source tarball for
>>> distribution.  I used to use:
>>>
>>>     $ R CMD build RNetica
>>> --install-args="--configure-args='--with-netica=/home/ralmond/software/Netica_API_504/'"
>>
>> When you say "used to use", when was that?  There was no --install-args
>> option in R 3.0.  I think there should be, and I can add it, but I'd
>> like to know if it was removed for a reason.
>>
>> Duncan Murdoch
>>
>>>
>>> but that generates an error:
>>>
>>>     gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG     -I. -I/src -fpic
>>> -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat
>>> -Werror=format-security -D_FORTIFY_SOURCE=2 -g  -c Cases.c -o Cases.o
>>>     In file included from Cases.c:18:0:
>>>     ./RNetica.h:4:20: fatal error: Netica.h: No such file or directory
>>>      #include <Netica.h>
>>>                         ^
>>>
>>> basically, it the Includes directory is not getting set correctly.  If
>>> I use the same syntax as the INSTALL (i.e., just configure-args and
>>> not the install-args wrapper) I get the same error message.  R CMD
>>> INSTALL --build creates a binary tarball and not a source.
>>>
>>> I think used to work correctly under R 3.1.  Did I miss something in
>>> the release notes?
>>>
>>> I'm having this problem under Ubuntu 14.4 (I think I'm also having the
>>> problem on Mac OS X; I'm not having the problem under Windows, but
>>> mostly because I'm using an environmental variable instead of a
>>> command line argument to pass the location of the 3rd party library.)
>>>
>>> Thanks in advance for any help.
>>>
>>
>


From edd at debian.org  Thu Jul 30 23:11:34 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 30 Jul 2015 16:11:34 -0500
Subject: [R-pkg-devel] R CMD build with configure-args
In-Reply-To: <55BA842A.5030806@gmail.com>
References: <55BA7296.8020406@macosx.com>
	<55BA842A.5030806@gmail.com>
Message-ID: <21946.37638.722276.543105@max.nulle.part>


Besides what Duncan said, relying on user to supply arguments is pretty bad
as it more or less guarantees _any_ automated test will not succeed (for lack
of involvement of the sage user).

Writing configure scripts feels like yet another painful step, but it really
is not that hard if you know a little shell scripting already.  You can even
do simple things and just loop over a fixed (but hopefully long) list of know
locations -- which is what RPostgreSQL does:

  https://github.com/cran/RPostgreSQL/blob/master/configure.in#L38-L69

Not my proudest moment, but it worked for a few (ten-)thousands of
installations and builds ...

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ralmond at macosx.com  Thu Jul 30 23:42:29 2015
From: ralmond at macosx.com (Russell Almond)
Date: Thu, 30 Jul 2015 17:42:29 -0400
Subject: [R-pkg-devel] R CMD build with configure-args
In-Reply-To: <21946.37638.722276.543105@max.nulle.part>
References: <55BA7296.8020406@macosx.com>	<55BA842A.5030806@gmail.com>
	<21946.37638.722276.543105@max.nulle.part>
Message-ID: <55BA9A45.30001@macosx.com>

Thanks for the suggestion.  I do have a configure script (that is what 
is reading the --with-netica arg) but I didn't think about searching the 
standard install locations.  I can probably use that to work around this 
problem.

However, that doesn't completely solve the problem.  If I want to force 
the configure script to use a non-standard location (say to use an 
experimental version of the library), I still need to be able to pass 
configure args to INSTALL and check.  I admit the need for doing this 
with build is a little bit less clear, although it is also unclear why 
build (which is making a source tarball) needs to compile the C code.

	--Russell


On 07/30/2015 05:11 PM, Dirk Eddelbuettel wrote:
>
> Besides what Duncan said, relying on user to supply arguments is pretty bad
> as it more or less guarantees _any_ automated test will not succeed (for lack
> of involvement of the sage user).
>
> Writing configure scripts feels like yet another painful step, but it really
> is not that hard if you know a little shell scripting already.  You can even
> do simple things and just loop over a fixed (but hopefully long) list of know
> locations -- which is what RPostgreSQL does:
>
>    https://github.com/cran/RPostgreSQL/blob/master/configure.in#L38-L69
>
> Not my proudest moment, but it worked for a few (ten-)thousands of
> installations and builds ...
>
> Dirk
>

-- 
Russell Almond
Associate Professor, Measurement & Statistics
Educational Psychology and Learning Systems
1114 W. Call St.
Florida State University
Tallahassee, FL 32306
(850) 644-5203
ralmond at fsu.edu
http://ralmond.net/


From edd at debian.org  Thu Jul 30 23:56:47 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 30 Jul 2015 16:56:47 -0500
Subject: [R-pkg-devel] R CMD build with configure-args
In-Reply-To: <55BA9A45.30001@macosx.com>
References: <55BA7296.8020406@macosx.com> <55BA842A.5030806@gmail.com>
	<21946.37638.722276.543105@max.nulle.part>
	<55BA9A45.30001@macosx.com>
Message-ID: <21946.40351.244756.915334@max.nulle.part>


On 30 July 2015 at 17:42, Russell Almond wrote:
| Thanks for the suggestion.  I do have a configure script (that is what 
| is reading the --with-netica arg) but I didn't think about searching the 
| standard install locations.  I can probably use that to work around this 
| problem.
| 
| However, that doesn't completely solve the problem.  If I want to force 
| the configure script to use a non-standard location (say to use an 
| experimental version of the library), I still need to be able to pass 
| configure args to INSTALL and check.  I admit the need for doing this 
| with build is a little bit less clear, although it is also unclear why 
| build (which is making a source tarball) needs to compile the C code.

Do not forget that you could also use an environment variable for truly
non-standard location -- just like Windoze does for its configure-lacking
existence.

Standards are important, so by all means try to make it work via configure.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From glennmschultz at me.com  Fri Jul 31 02:49:20 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Fri, 31 Jul 2015 00:49:20 +0000 (GMT)
Subject: [R-pkg-devel] need some help to understand package build workflow
Message-ID: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>

Hi All,

I have a package stable and working. ?Now, I am trying to consolidate some functions that share similar inputs. ?Example below. ?So, I branched on github and work with the branch but now when I run the R check in studio I get the following warning:

* checking Rd \usage sections ... WARNING
Documented arguments not in \usage in documentation object 'Effective.Measure':
? ?type?

Clearly type is documented. ?Perhaps this is an R studio/git hub issue. Travis tells me the build is broken. ?I am trying to build and work with the package within standards so I am not sure what happened. ? Maybe this is not a topic that belongs here but I can't find answers on the internet.

Glenn

#' A function to compute effective duration and convexity
#'?
#' Calculates the effective duration and based on discount vector (zero coupon)
#' cashflow vector, and rate delta
#' @param Rate.Delta A numeric value the interest rate shift in basis points
#' @param cashflow A numeric vector of cashflow
#' @param discount.rates A numeric vector of the discount rates
#' @param time.period A numeric vector of the time period
#' @param type A character vector to specify either duration or convexity
#' @export
Effective.Measure <- function(Rate.Delta = numeric(),?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?cashflow = vector(),?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?discount.rates = vector(),?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?time.period = vector(),
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?type = "character"){
??
? discount.rates.up = discount.rates + Rate.Delta
? discount.rates.dwn = discount.rates - Rate.Delta
? Price.NC = sum((1/((1+discount.rates)^time.period)) * cashflow)
? Price.UP = sum((1/((1+discount.rates.up)^time.period)) * cashflow)
? Price.DWN = sum((1/((1+discount.rates.dwn)^time.period)) * cashflow)
??
? switch(type,
? ? ? ? ?duration = ? (Price.UP - Price.DWN)/(2*Price.NC*Rate.Delta),
? ? ? ? ?convexity = ?(Price.UP + Price.DWN - (2*Price.NC))/(2*Price.NC*(Rate.Delta^2)))

}

setGeneric("Effective.Measure", function(Rate.Delta = numeric(),?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? cashflow = vector(),?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? discount.rates = vector(),?
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? time.period = vector())
{standardGeneric("Effective.Measure")})



From murdoch.duncan at gmail.com  Fri Jul 31 03:14:01 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 30 Jul 2015 21:14:01 -0400
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
Message-ID: <55BACBD9.4080800@gmail.com>

On 30/07/2015 8:49 PM, Glenn Schultz wrote:
> Hi All,
> 
> I have a package stable and working.  Now, I am trying to consolidate some functions that share similar inputs.  Example below.  So, I branched on github and work with the branch but now when I run the R check in studio I get the following warning:
> 
> * checking Rd \usage sections ... WARNING
> Documented arguments not in \usage in documentation object 'Effective.Measure':
>   ?type?
> 
> Clearly type is documented.  Perhaps this is an R studio/git hub issue. Travis tells me the build is broken.  I am trying to build and work with the package within standards so I am not sure what happened.   Maybe this is not a topic that belongs here but I can't find answers on the internet.

No, it's not clear that type is documented.  You're only showing us the
.R file, not the .Rd file that Roxygen (?) produced from it.

Duncan Murdoch

> Glenn
> 
> #' A function to compute effective duration and convexity
> #' 
> #' Calculates the effective duration and based on discount vector (zero coupon)
> #' cashflow vector, and rate delta
> #' @param Rate.Delta A numeric value the interest rate shift in basis points
> #' @param cashflow A numeric vector of cashflow
> #' @param discount.rates A numeric vector of the discount rates
> #' @param time.period A numeric vector of the time period
> #' @param type A character vector to specify either duration or convexity
> #' @export
> Effective.Measure <- function(Rate.Delta = numeric(), 
>                                cashflow = vector(), 
>                                discount.rates = vector(), 
>                                time.period = vector(),
>                                type = "character"){
>   
>   discount.rates.up = discount.rates + Rate.Delta
>   discount.rates.dwn = discount.rates - Rate.Delta
>   Price.NC = sum((1/((1+discount.rates)^time.period)) * cashflow)
>   Price.UP = sum((1/((1+discount.rates.up)^time.period)) * cashflow)
>   Price.DWN = sum((1/((1+discount.rates.dwn)^time.period)) * cashflow)
>   
>   switch(type,
>          duration =   (Price.UP - Price.DWN)/(2*Price.NC*Rate.Delta),
>          convexity =  (Price.UP + Price.DWN - (2*Price.NC))/(2*Price.NC*(Rate.Delta^2)))
> 
> }
> 
> setGeneric("Effective.Measure", function(Rate.Delta = numeric(), 
>                                           cashflow = vector(), 
>                                           discount.rates = vector(), 
>                                           time.period = vector())
> {standardGeneric("Effective.Measure")})
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From murdoch.duncan at gmail.com  Fri Jul 31 03:38:31 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 30 Jul 2015 21:38:31 -0400
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <55BACBD9.4080800@gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com>
Message-ID: <55BAD197.8070903@gmail.com>

On 30/07/2015 9:14 PM, Duncan Murdoch wrote:
> On 30/07/2015 8:49 PM, Glenn Schultz wrote:
>> Hi All,
>>
>> I have a package stable and working.  Now, I am trying to consolidate some functions that share similar inputs.  Example below.  So, I branched on github and work with the branch but now when I run the R check in studio I get the following warning:
>>
>> * checking Rd \usage sections ... WARNING
>> Documented arguments not in \usage in documentation object 'Effective.Measure':
>>   ?type?
>>
>> Clearly type is documented.  Perhaps this is an R studio/git hub issue. Travis tells me the build is broken.  I am trying to build and work with the package within standards so I am not sure what happened.   Maybe this is not a topic that belongs here but I can't find answers on the internet.
> 
> No, it's not clear that type is documented.  You're only showing us the
> .R file, not the .Rd file that Roxygen (?) produced from it.

Discussion went private for a few emails, so to finish this thread here:

Turns out roxygen2 was generating a bad .Rd file, so this is a roxygen2 bug.

Duncan Murdoch

> 
> Duncan Murdoch
> 
>> Glenn
>>
>> #' A function to compute effective duration and convexity
>> #' 
>> #' Calculates the effective duration and based on discount vector (zero coupon)
>> #' cashflow vector, and rate delta
>> #' @param Rate.Delta A numeric value the interest rate shift in basis points
>> #' @param cashflow A numeric vector of cashflow
>> #' @param discount.rates A numeric vector of the discount rates
>> #' @param time.period A numeric vector of the time period
>> #' @param type A character vector to specify either duration or convexity
>> #' @export
>> Effective.Measure <- function(Rate.Delta = numeric(), 
>>                                cashflow = vector(), 
>>                                discount.rates = vector(), 
>>                                time.period = vector(),
>>                                type = "character"){
>>   
>>   discount.rates.up = discount.rates + Rate.Delta
>>   discount.rates.dwn = discount.rates - Rate.Delta
>>   Price.NC = sum((1/((1+discount.rates)^time.period)) * cashflow)
>>   Price.UP = sum((1/((1+discount.rates.up)^time.period)) * cashflow)
>>   Price.DWN = sum((1/((1+discount.rates.dwn)^time.period)) * cashflow)
>>   
>>   switch(type,
>>          duration =   (Price.UP - Price.DWN)/(2*Price.NC*Rate.Delta),
>>          convexity =  (Price.UP + Price.DWN - (2*Price.NC))/(2*Price.NC*(Rate.Delta^2)))
>>
>> }
>>
>> setGeneric("Effective.Measure", function(Rate.Delta = numeric(), 
>>                                           cashflow = vector(), 
>>                                           discount.rates = vector(), 
>>                                           time.period = vector())
>> {standardGeneric("Effective.Measure")})
>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>


From h.wickham at gmail.com  Fri Jul 31 04:53:11 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Thu, 30 Jul 2015 21:53:11 -0500
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <55BAD197.8070903@gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com> <55BAD197.8070903@gmail.com>
Message-ID: <CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>

On Thursday, July 30, 2015, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> On 30/07/2015 9:14 PM, Duncan Murdoch wrote:
> > On 30/07/2015 8:49 PM, Glenn Schultz wrote:
> >> Hi All,
> >>
> >> I have a package stable and working.  Now, I am trying to consolidate
> some functions that share similar inputs.  Example below.  So, I branched
> on github and work with the branch but now when I run the R check in studio
> I get the following warning:
> >>
> >> * checking Rd \usage sections ... WARNING
> >> Documented arguments not in \usage in documentation object
> 'Effective.Measure':
> >>   ?type?
> >>
> >> Clearly type is documented.  Perhaps this is an R studio/git hub issue.
> Travis tells me the build is broken.  I am trying to build and work with
> the package within standards so I am not sure what happened.   Maybe this
> is not a topic that belongs here but I can't find answers on the internet.
> >
> > No, it's not clear that type is documented.  You're only showing us the
> > .R file, not the .Rd file that Roxygen (?) produced from it.
>
> Discussion went private for a few emails, so to finish this thread here:
>
> Turns out roxygen2 was generating a bad .Rd file, so this is a roxygen2
> bug.
>
> I'd really appreciate it if someone would file a bug on this.

Hadley


-- 
http://had.co.nz/

	[[alternative HTML version deleted]]


From kevinushey at gmail.com  Fri Jul 31 07:53:59 2015
From: kevinushey at gmail.com (Kevin Ushey)
Date: Thu, 30 Jul 2015 22:53:59 -0700
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com> <55BAD197.8070903@gmail.com>
	<CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>
Message-ID: <CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>

I've posted an MRE at https://github.com/klutometis/roxygen/issues/362.

The issue occurs when a function and an S4 generic have the same name;
I imagine this is fairly uncommon? Wouldn't the function be masked by
the S4 generic and effectively be invisible after the package was
loaded?

On Thu, Jul 30, 2015 at 7:53 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
> On Thursday, July 30, 2015, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>
>> On 30/07/2015 9:14 PM, Duncan Murdoch wrote:
>> > On 30/07/2015 8:49 PM, Glenn Schultz wrote:
>> >> Hi All,
>> >>
>> >> I have a package stable and working.  Now, I am trying to consolidate
>> some functions that share similar inputs.  Example below.  So, I branched
>> on github and work with the branch but now when I run the R check in studio
>> I get the following warning:
>> >>
>> >> * checking Rd \usage sections ... WARNING
>> >> Documented arguments not in \usage in documentation object
>> 'Effective.Measure':
>> >>   ?type?
>> >>
>> >> Clearly type is documented.  Perhaps this is an R studio/git hub issue.
>> Travis tells me the build is broken.  I am trying to build and work with
>> the package within standards so I am not sure what happened.   Maybe this
>> is not a topic that belongs here but I can't find answers on the internet.
>> >
>> > No, it's not clear that type is documented.  You're only showing us the
>> > .R file, not the .Rd file that Roxygen (?) produced from it.
>>
>> Discussion went private for a few emails, so to finish this thread here:
>>
>> Turns out roxygen2 was generating a bad .Rd file, so this is a roxygen2
>> bug.
>>
>> I'd really appreciate it if someone would file a bug on this.
>
> Hadley
>
>
> --
> http://had.co.nz/
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From Ray.Brownrigg at ecs.vuw.ac.nz  Fri Jul 31 11:52:53 2015
From: Ray.Brownrigg at ecs.vuw.ac.nz (Ray Brownrigg)
Date: Fri, 31 Jul 2015 21:52:53 +1200
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <55B92486.4020202@ecs.vuw.ac.nz>
References: <55B92486.4020202@ecs.vuw.ac.nz>
Message-ID: <55BB4575.5010402@ecs.vuw.ac.nz>

I have been somewhat surprised by the number of positive responses to my 
message.  I have found a candidate for the position of maintainer of the 
maps, mapdata and mapproj packages.  I have confidence that Alex Deckmyn 
<alex.deckmyn at meteo.be> will do at least as good a job as I have done in 
this regard.

The current (recent) releases of the packages still have my name as 
maintainer, but the address specified points to my (now) old work 
address which will autorespond to say I have now retired.  However in 
practise, I will still be able to read and respond to such emails for 
the foreseeable future.

Among other improvements, Alex is working on setting up a more accurate 
"world" database for maps and will submit this once it has been fully 
tested.

Thanks everyone for your support.
Ray Brownrigg


From h.wickham at gmail.com  Fri Jul 31 13:11:55 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 31 Jul 2015 06:11:55 -0500
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com> <55BAD197.8070903@gmail.com>
	<CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>
	<CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>
Message-ID: <CABdHhvGMsbj8XVsOVjZ26hKQ0q7T++1wmL6nqe8j3_m_sDjgXw@mail.gmail.com>

It seems arguable that this is actually a roxygen bug - the function
that's actually exported from the package does not have a type
argument.

Hadley

On Fri, Jul 31, 2015 at 12:53 AM, Kevin Ushey <kevinushey at gmail.com> wrote:
> I've posted an MRE at https://github.com/klutometis/roxygen/issues/362.
>
> The issue occurs when a function and an S4 generic have the same name;
> I imagine this is fairly uncommon? Wouldn't the function be masked by
> the S4 generic and effectively be invisible after the package was
> loaded?
>
> On Thu, Jul 30, 2015 at 7:53 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>> On Thursday, July 30, 2015, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>>> On 30/07/2015 9:14 PM, Duncan Murdoch wrote:
>>> > On 30/07/2015 8:49 PM, Glenn Schultz wrote:
>>> >> Hi All,
>>> >>
>>> >> I have a package stable and working.  Now, I am trying to consolidate
>>> some functions that share similar inputs.  Example below.  So, I branched
>>> on github and work with the branch but now when I run the R check in studio
>>> I get the following warning:
>>> >>
>>> >> * checking Rd \usage sections ... WARNING
>>> >> Documented arguments not in \usage in documentation object
>>> 'Effective.Measure':
>>> >>   ?type?
>>> >>
>>> >> Clearly type is documented.  Perhaps this is an R studio/git hub issue.
>>> Travis tells me the build is broken.  I am trying to build and work with
>>> the package within standards so I am not sure what happened.   Maybe this
>>> is not a topic that belongs here but I can't find answers on the internet.
>>> >
>>> > No, it's not clear that type is documented.  You're only showing us the
>>> > .R file, not the .Rd file that Roxygen (?) produced from it.
>>>
>>> Discussion went private for a few emails, so to finish this thread here:
>>>
>>> Turns out roxygen2 was generating a bad .Rd file, so this is a roxygen2
>>> bug.
>>>
>>> I'd really appreciate it if someone would file a bug on this.
>>
>> Hadley
>>
>>
>> --
>> http://had.co.nz/
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://had.co.nz/


From alex.deckmyn at meteo.be  Fri Jul 31 19:48:49 2015
From: alex.deckmyn at meteo.be (Alex Deckmyn)
Date: Fri, 31 Jul 2015 19:48:49 +0200 (CEST)
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <55BB4575.5010402@ecs.vuw.ac.nz>
References: <55B92486.4020202@ecs.vuw.ac.nz> <55BB4575.5010402@ecs.vuw.ac.nz>
Message-ID: <518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>

First of all, I would like to thank Ray for his many years of taking care of maps, mapdata and mapproj, and for his confidence in my taking over. I hope to keep the packages running smoothly. 

I think R-sig-Geo is the best place to discuss future developments and will be posting there soon. As Ray mentioned, I (with his help & feedback) have been preparing an updated world map. I am going to be very cautious, but the many changes in country names (post-1990 Europe!) mean that any package or code that uses maps by calling map('world',region=...) to create a map using country names, could be affected. Maintainers of packages calling "maps" may want to contact me to make sure I don't break anything. In any case, I am currently testing a beta version that includes the old data set as a fall back. 

Alex 

--- 
Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
Royal Meteorological Institute http://www.meteo.be 
Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 



I have been somewhat surprised by the number of positive responses to my 
message. I have found a candidate for the position of maintainer of the 
maps, mapdata and mapproj packages. I have confidence that Alex Deckmyn 
<alex.deckmyn at meteo.be> will do at least as good a job as I have done in 
this regard. 

The current (recent) releases of the packages still have my name as 
maintainer, but the address specified points to my (now) old work 
address which will autorespond to say I have now retired. However in 
practise, I will still be able to read and respond to such emails for 
the foreseeable future. 

Among other improvements, Alex is working on setting up a more accurate 
"world" database for maps and will submit this once it has been fully 
tested. 

Thanks everyone for your support. 
Ray Brownrigg 

	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Fri Jul 31 20:26:01 2015
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 31 Jul 2015 20:26:01 +0200
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
References: <55B92486.4020202@ecs.vuw.ac.nz> <55BB4575.5010402@ecs.vuw.ac.nz>
	<518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
Message-ID: <21947.48569.674658.393425@stat.math.ethz.ch>

>>>>> Alex Deckmyn <alex.deckmyn at meteo.be>
>>>>>     on Fri, 31 Jul 2015 19:48:49 +0200 writes:

    > First of all, I would like to thank Ray for his many years of taking care of maps, mapdata and mapproj, and for his confidence in my taking over. I hope to keep the packages running smoothly. 

Indeed, thanks to Ray and you (and I am also happy to have heard
from Ray about many positive responses !)

    > I think R-sig-Geo is the best place to discuss future developments and will be posting there soon.

I agree ... but the following is not about 'maps' in particular,
but package maintenance / compatibility ....

    >  As Ray mentioned, I (with his help & feedback) have been preparing an updated world map. I am going to be very cautious, but the many changes in country names (post-1990 Europe!) mean that any package or code that uses maps by calling map('world',region=...) to create a map using country names, could be affected. Maintainers of packages calling "maps" may want to contact me to make sure I don't break anything. In any case, I am currently testing a beta version that includes the old data set as a fall back. 

I know these data sets are not very small, but I would still
strongly recommend that you 
keep the old map, say as   "world198x"  (and change the "x" to a
digit if you know which one, or the "8x" to "7y" ... etc).
Storage and bandwidth have become considerably cheaper and so
the package could provide (almost) back compatibility ... and
also something interesting in itself (comparison of two very
similar maps with R; teaching, history, ...).

Best regards,
Martin

    > Alex 

    > --- 
    > Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
    > Royal Meteorological Institute http://www.meteo.be 
    > Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 



    > I have been somewhat surprised by the number of positive responses to my 
    > message. I have found a candidate for the position of maintainer of the 
    > maps, mapdata and mapproj packages. I have confidence that Alex Deckmyn 
    > <alex.deckmyn at meteo.be> will do at least as good a job as I have done in 
    > this regard. 




    > The current (recent) releases of the packages still have my name as 
    > maintainer, but the address specified points to my (now) old work 
    > address which will autorespond to say I have now retired. However in 
    > practise, I will still be able to read and respond to such emails for 
    > the foreseeable future. 

    > Among other improvements, Alex is working on setting up a more accurate 
    > "world" database for maps and will submit this once it has been fully 
    > tested. 

    > Thanks everyone for your support. 
    > Ray Brownrigg 

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jonathan at mazamascience.com  Fri Jul 31 20:31:30 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Fri, 31 Jul 2015 11:31:30 -0700
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
References: <55B92486.4020202@ecs.vuw.ac.nz> <55BB4575.5010402@ecs.vuw.ac.nz>
	<518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
Message-ID: <CAPjNR=QD2ubrwYOh_Y8CN7T2hk4tpD7JsNC8p4sxKp2Pv-oSyA@mail.gmail.com>

Alex,

Thank you for addressing the #1 issue with the 'maps' package. I have
several clients and colleagues that I have pushed to use R for mapping but
it's always embarrassing to say they have to either 1: accept Soviet Union
era borders or 2: embrace the complexity of the 'sp' package.

Updating the world borders and (Oh please!) allowing countries to be
identified by ISO-3166-1-alpha2 country codes would hugely improve the
utility of the 'maps' package.

Our efforts with the MazamaSpatialUtils
<https://cran.r-project.org/web/packages/MazamaSpatialUtils> package
originated with the outdated world map in the 'maps' package.

Best Regards,

Jon

On Fri, Jul 31, 2015 at 10:48 AM, Alex Deckmyn <alex.deckmyn at meteo.be>
wrote:

> First of all, I would like to thank Ray for his many years of taking care
> of maps, mapdata and mapproj, and for his confidence in my taking over. I
> hope to keep the packages running smoothly.
>
> I think R-sig-Geo is the best place to discuss future developments and
> will be posting there soon. As Ray mentioned, I (with his help & feedback)
> have been preparing an updated world map. I am going to be very cautious,
> but the many changes in country names (post-1990 Europe!) mean that any
> package or code that uses maps by calling map('world',region=...) to create
> a map using country names, could be affected. Maintainers of packages
> calling "maps" may want to contact me to make sure I don't break anything.
> In any case, I am currently testing a beta version that includes the old
> data set as a fall back.
>
> Alex
>
> ---
> Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be
> Royal Meteorological Institute http://www.meteo.be
> Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646
>
>
>
> I have been somewhat surprised by the number of positive responses to my
> message. I have found a candidate for the position of maintainer of the
> maps, mapdata and mapproj packages. I have confidence that Alex Deckmyn
> <alex.deckmyn at meteo.be> will do at least as good a job as I have done in
> this regard.
>
> The current (recent) releases of the packages still have my name as
> maintainer, but the address specified points to my (now) old work
> address which will autorespond to say I have now retired. However in
> practise, I will still be able to read and respond to such emails for
> the foreseeable future.
>
> Among other improvements, Alex is working on setting up a more accurate
> "world" database for maps and will submit this once it has been fully
> tested.
>
> Thanks everyone for your support.
> Ray Brownrigg
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From alex.deckmyn at meteo.be  Fri Jul 31 20:59:32 2015
From: alex.deckmyn at meteo.be (Alex Deckmyn)
Date: Fri, 31 Jul 2015 20:59:32 +0200 (CEST)
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <21947.48569.674658.393425@stat.math.ethz.ch>
References: <55B92486.4020202@ecs.vuw.ac.nz> <55BB4575.5010402@ecs.vuw.ac.nz>
	<518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
	<21947.48569.674658.393425@stat.math.ethz.ch>
Message-ID: <61246150.5212024.1438369172072.JavaMail.zimbra@meteo.be>

Martin, 

The old data set will certainly stay for a while (or indeed indefinitely, why not). To make the transition as smooth as possible (I am aware that "maps" is used in more places than I can ever check myself) I am including the possibility of switching back to "legacy" mode using an environment variable (or an extra function "world.legacy(TRUE)"), so that any code that runs into trouble can be switched to the old database without needing to edit the code itself. 

Would it be a good idea to make the new maps package (beta) available (e.g. via github) prior to submitting to CRAN? It is more or less ready. Given the many packages that call maps, this could give maintainers a chance to check things. For the moment, it's only the country borders & names that have changed. 

Alex 

From: "Martin Maechler" <maechler at stat.math.ethz.ch> 

> I think R-sig-Geo is the best place to discuss future developments and will be posting there soon. 

I agree ... but the following is not about 'maps' in particular, 
but package maintenance / compatibility .... 

> As Ray mentioned, I (with his help & feedback) have been preparing an updated world map. I am going to be very cautious, but the many changes in country names (post-1990 Europe!) mean that any package or code that uses maps by calling map('world',region=...) to create a map using country names, could be affected. Maintainers of packages calling "maps" may want to contact me to make sure I don't break anything. In any case, I am currently testing a beta version that includes the old data set as a fall back. 

I know these data sets are not very small, but I would still 
strongly recommend that you 
keep the old map, say as "world198x" (and change the "x" to a 
digit if you know which one, or the "8x" to "7y" ... etc). 
Storage and bandwidth have become considerably cheaper and so 
the package could provide (almost) back compatibility ... and 
also something interesting in itself (comparison of two very 
similar maps with R; teaching, history, ...). 

Best regards, 
Martin 

> Alex 

> --- 
> Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
> Royal Meteorological Institute http://www.meteo.be 
> Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 



> I have been somewhat surprised by the number of positive responses to my 
> message. I have found a candidate for the position of maintainer of the 
> maps, mapdata and mapproj packages. I have confidence that Alex Deckmyn 
> <alex.deckmyn at meteo.be> will do at least as good a job as I have done in 
> this regard. 




> The current (recent) releases of the packages still have my name as 
> maintainer, but the address specified points to my (now) old work 
> address which will autorespond to say I have now retired. However in 
> practise, I will still be able to read and respond to such emails for 
> the foreseeable future. 

> Among other improvements, Alex is working on setting up a more accurate 
> "world" database for maps and will submit this once it has been fully 
> tested. 

> Thanks everyone for your support. 
> Ray Brownrigg 

> [[alternative HTML version deleted]] 

> ______________________________________________ 
> R-package-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-package-devel 

	[[alternative HTML version deleted]]


From jonathan at mazamascience.com  Fri Jul 31 21:04:31 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Fri, 31 Jul 2015 12:04:31 -0700
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <61246150.5212024.1438369172072.JavaMail.zimbra@meteo.be>
References: <55B92486.4020202@ecs.vuw.ac.nz> <55BB4575.5010402@ecs.vuw.ac.nz>
	<518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
	<21947.48569.674658.393425@stat.math.ethz.ch>
	<61246150.5212024.1438369172072.JavaMail.zimbra@meteo.be>
Message-ID: <CAPjNR=TGGSggaMAf5dOncuObNc9+8VT1hZz0P-_d5ZjW8iGNLQ@mail.gmail.com>

Please do make the new code available for testing. Those of us developing
packages that import 'maps' would love the chance to test our code against
the new version of the package.

On Fri, Jul 31, 2015 at 11:59 AM, Alex Deckmyn <alex.deckmyn at meteo.be>
wrote:

> Martin,
>
> The old data set will certainly stay for a while (or indeed indefinitely,
> why not). To make the transition as smooth as possible (I am aware that
> "maps" is used in more places than I can ever check myself) I am including
> the possibility of switching back to "legacy" mode using an environment
> variable (or an extra function "world.legacy(TRUE)"), so that any code that
> runs into trouble can be switched to the old database without needing to
> edit the code itself.
>
> Would it be a good idea to make the new maps package (beta) available
> (e.g. via github) prior to submitting to CRAN? It is more or less ready.
> Given the many packages that call maps, this could give maintainers a
> chance to check things. For the moment, it's only the country borders &
> names that have changed.
>
> Alex
>
> From: "Martin Maechler" <maechler at stat.math.ethz.ch>
>
> > I think R-sig-Geo is the best place to discuss future developments and
> will be posting there soon.
>
> I agree ... but the following is not about 'maps' in particular,
> but package maintenance / compatibility ....
>
> > As Ray mentioned, I (with his help & feedback) have been preparing an
> updated world map. I am going to be very cautious, but the many changes in
> country names (post-1990 Europe!) mean that any package or code that uses
> maps by calling map('world',region=...) to create a map using country
> names, could be affected. Maintainers of packages calling "maps" may want
> to contact me to make sure I don't break anything. In any case, I am
> currently testing a beta version that includes the old data set as a fall
> back.
>
> I know these data sets are not very small, but I would still
> strongly recommend that you
> keep the old map, say as "world198x" (and change the "x" to a
> digit if you know which one, or the "8x" to "7y" ... etc).
> Storage and bandwidth have become considerably cheaper and so
> the package could provide (almost) back compatibility ... and
> also something interesting in itself (comparison of two very
> similar maps with R; teaching, history, ...).
>
> Best regards,
> Martin
>
> > Alex
>
> > ---
> > Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be
> > Royal Meteorological Institute http://www.meteo.be
> > Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646
>
>
>
> > I have been somewhat surprised by the number of positive responses to my
> > message. I have found a candidate for the position of maintainer of the
> > maps, mapdata and mapproj packages. I have confidence that Alex Deckmyn
> > <alex.deckmyn at meteo.be> will do at least as good a job as I have done in
> > this regard.
>
>
>
>
> > The current (recent) releases of the packages still have my name as
> > maintainer, but the address specified points to my (now) old work
> > address which will autorespond to say I have now retired. However in
> > practise, I will still be able to read and respond to such emails for
> > the foreseeable future.
>
> > Among other improvements, Alex is working on setting up a more accurate
> > "world" database for maps and will submit this once it has been fully
> > tested.
>
> > Thanks everyone for your support.
> > Ray Brownrigg
>
> > [[alternative HTML version deleted]]
>
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From alex.deckmyn at meteo.be  Fri Jul 31 21:14:22 2015
From: alex.deckmyn at meteo.be (Alex Deckmyn)
Date: Fri, 31 Jul 2015 21:14:22 +0200 (CEST)
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <CAPjNR=QD2ubrwYOh_Y8CN7T2hk4tpD7JsNC8p4sxKp2Pv-oSyA@mail.gmail.com>
References: <55B92486.4020202@ecs.vuw.ac.nz> <55BB4575.5010402@ecs.vuw.ac.nz>
	<518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
	<CAPjNR=QD2ubrwYOh_Y8CN7T2hk4tpD7JsNC8p4sxKp2Pv-oSyA@mail.gmail.com>
Message-ID: <2027751671.5212148.1438370062050.JavaMail.zimbra@meteo.be>

Jon, 

Identification using ISO codes is a good idea, although I think the old naming scheme shouldn't be broken. But adding functionalities to "map" will always have to be done in a way that keeps backward compatbility, so I'll have to think about a good way to do this. 

Alex 

--- 
Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
Royal Meteorological Institute http://www.meteo.be 
Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 


From: "Jonathan Callahan" <jonathan at mazamascience.com> 
To: "Alex" <alex.deckmyn at meteo.be> 
Cc: r-package-devel at r-project.org 
Sent: Friday, 31 July, 2015 20:31:30 
Subject: Re: [R-pkg-devel] new maintainer sought for maps packages 

Alex, 
Thank you for addressing the #1 issue with the 'maps' package. I have several clients and colleagues that I have pushed to use R for mapping but it's always embarrassing to say they have to either 1: accept Soviet Union era borders or 2: embrace the complexity of the 'sp' package. 

Updating the world borders and (Oh please!) allowing countries to be identified by ISO-3166-1-alpha2 country codes would hugely improve the utility of the 'maps' package. 

Our efforts with the MazamaSpatialUtils package originated with the outdated world map in the 'maps' package. 

Best Regards, 

Jon 

On Fri, Jul 31, 2015 at 10:48 AM, Alex Deckmyn < alex.deckmyn at meteo.be > wrote: 


First of all, I would like to thank Ray for his many years of taking care of maps, mapdata and mapproj, and for his confidence in my taking over. I hope to keep the packages running smoothly. 

I think R-sig-Geo is the best place to discuss future developments and will be posting there soon. As Ray mentioned, I (with his help & feedback) have been preparing an updated world map. I am going to be very cautious, but the many changes in country names (post-1990 Europe!) mean that any package or code that uses maps by calling map('world',region=...) to create a map using country names, could be affected. Maintainers of packages calling "maps" may want to contact me to make sure I don't break anything. In any case, I am currently testing a beta version that includes the old data set as a fall back. 

Alex 

--- 
Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
Royal Meteorological Institute http://www.meteo.be 
Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 



I have been somewhat surprised by the number of positive responses to my 
message. I have found a candidate for the position of maintainer of the 
maps, mapdata and mapproj packages. I have confidence that Alex Deckmyn 
< alex.deckmyn at meteo.be > will do at least as good a job as I have done in 
this regard. 

The current (recent) releases of the packages still have my name as 
maintainer, but the address specified points to my (now) old work 
address which will autorespond to say I have now retired. However in 
practise, I will still be able to read and respond to such emails for 
the foreseeable future. 

Among other improvements, Alex is working on setting up a more accurate 
"world" database for maps and will submit this once it has been fully 
tested. 

Thanks everyone for your support. 
Ray Brownrigg 

[[alternative HTML version deleted]] 

______________________________________________ 
R-package-devel at r-project.org mailing list 
https://stat.ethz.ch/mailman/listinfo/r-package-devel 






-- 
Jonathan Callahan, PhD 
Mazama Science 
206-708-5028 
mazamascience.com 


	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Fri Jul 31 23:45:24 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 31 Jul 2015 17:45:24 -0400
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <CABdHhvGMsbj8XVsOVjZ26hKQ0q7T++1wmL6nqe8j3_m_sDjgXw@mail.gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com> <55BAD197.8070903@gmail.com>
	<CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>
	<CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>
	<CABdHhvGMsbj8XVsOVjZ26hKQ0q7T++1wmL6nqe8j3_m_sDjgXw@mail.gmail.com>
Message-ID: <55BBEC74.1000705@gmail.com>

On 31/07/2015 7:11 AM, Hadley Wickham wrote:
> It seems arguable that this is actually a roxygen bug - the function
> that's actually exported from the package does not have a type
> argument.

The package fails R CMD check because of a bad .Rd file.  If a user had
written that file, it would be user error, but roxygen2 wrote it, so I'd
say it's pretty clearly a roxygen2 bug.

Duncan Murdoch

> 
> Hadley
> 
> On Fri, Jul 31, 2015 at 12:53 AM, Kevin Ushey <kevinushey at gmail.com> wrote:
>> I've posted an MRE at https://github.com/klutometis/roxygen/issues/362.
>>
>> The issue occurs when a function and an S4 generic have the same name;
>> I imagine this is fairly uncommon? Wouldn't the function be masked by
>> the S4 generic and effectively be invisible after the package was
>> loaded?
>>
>> On Thu, Jul 30, 2015 at 7:53 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>> On Thursday, July 30, 2015, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>
>>>> On 30/07/2015 9:14 PM, Duncan Murdoch wrote:
>>>>> On 30/07/2015 8:49 PM, Glenn Schultz wrote:
>>>>>> Hi All,
>>>>>>
>>>>>> I have a package stable and working.  Now, I am trying to consolidate
>>>> some functions that share similar inputs.  Example below.  So, I branched
>>>> on github and work with the branch but now when I run the R check in studio
>>>> I get the following warning:
>>>>>>
>>>>>> * checking Rd \usage sections ... WARNING
>>>>>> Documented arguments not in \usage in documentation object
>>>> 'Effective.Measure':
>>>>>>   ?type?
>>>>>>
>>>>>> Clearly type is documented.  Perhaps this is an R studio/git hub issue.
>>>> Travis tells me the build is broken.  I am trying to build and work with
>>>> the package within standards so I am not sure what happened.   Maybe this
>>>> is not a topic that belongs here but I can't find answers on the internet.
>>>>>
>>>>> No, it's not clear that type is documented.  You're only showing us the
>>>>> .R file, not the .Rd file that Roxygen (?) produced from it.
>>>>
>>>> Discussion went private for a few emails, so to finish this thread here:
>>>>
>>>> Turns out roxygen2 was generating a bad .Rd file, so this is a roxygen2
>>>> bug.
>>>>
>>>> I'd really appreciate it if someone would file a bug on this.
>>>
>>> Hadley
>>>
>>>
>>> --
>>> http://had.co.nz/
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> 
>


From h.wickham at gmail.com  Fri Jul 31 23:56:17 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 31 Jul 2015 16:56:17 -0500
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <55BBEC74.1000705@gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com> <55BAD197.8070903@gmail.com>
	<CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>
	<CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>
	<CABdHhvGMsbj8XVsOVjZ26hKQ0q7T++1wmL6nqe8j3_m_sDjgXw@mail.gmail.com>
	<55BBEC74.1000705@gmail.com>
Message-ID: <CABdHhvECEXytuBao=s4xsCiaw3fQjtwtRGU3U5StW497CwjJ3A@mail.gmail.com>

>> It seems arguable that this is actually a roxygen bug - the function
>> that's actually exported from the package does not have a type
>> argument.
>
> The package fails R CMD check because of a bad .Rd file.  If a user had
> written that file, it would be user error, but roxygen2 wrote it, so I'd
> say it's pretty clearly a roxygen2 bug.

It would really help me if you'd explain a little bit more. I think
the essential problem is that the package has two definitions of f:

f <- function(x, y) {}
setGeneric(f, function(x) {})

Roxygen uses the second definition (because it's the last defined),
and expects the function to have one argument. R CMD check clearly
excepts it two have two arguments. It's not obvious to me which is
correct.

Hadley

-- 
http://had.co.nz/


From kevinushey at gmail.com  Sat Aug  1 00:14:44 2015
From: kevinushey at gmail.com (Kevin Ushey)
Date: Fri, 31 Jul 2015 15:14:44 -0700
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <CABdHhvECEXytuBao=s4xsCiaw3fQjtwtRGU3U5StW497CwjJ3A@mail.gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com> <55BAD197.8070903@gmail.com>
	<CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>
	<CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>
	<CABdHhvGMsbj8XVsOVjZ26hKQ0q7T++1wmL6nqe8j3_m_sDjgXw@mail.gmail.com>
	<55BBEC74.1000705@gmail.com>
	<CABdHhvECEXytuBao=s4xsCiaw3fQjtwtRGU3U5StW497CwjJ3A@mail.gmail.com>
Message-ID: <CAJXgQP19XoA7Jv+SdFEm8kyGQm7M30sgj9Qyd2+hqdCx8=WxoA@mail.gmail.com>

I'm not sure if that's correct -- from what I see, in the generated Rd
documentation:

- The 'usage' is drawn from the S4 generic,
- The 'arguments' are drawn from the function.

I think R CMD check is correctly warning about that.

On Fri, Jul 31, 2015 at 2:56 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>> It seems arguable that this is actually a roxygen bug - the function
>>> that's actually exported from the package does not have a type
>>> argument.
>>
>> The package fails R CMD check because of a bad .Rd file.  If a user had
>> written that file, it would be user error, but roxygen2 wrote it, so I'd
>> say it's pretty clearly a roxygen2 bug.
>
> It would really help me if you'd explain a little bit more. I think
> the essential problem is that the package has two definitions of f:
>
> f <- function(x, y) {}
> setGeneric(f, function(x) {})
>
> Roxygen uses the second definition (because it's the last defined),
> and expects the function to have one argument. R CMD check clearly
> excepts it two have two arguments. It's not obvious to me which is
> correct.
>
> Hadley
>
> --
> http://had.co.nz/


From murdoch.duncan at gmail.com  Sat Aug  1 03:57:43 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 31 Jul 2015 21:57:43 -0400
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <CAJXgQP19XoA7Jv+SdFEm8kyGQm7M30sgj9Qyd2+hqdCx8=WxoA@mail.gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>	<55BACBD9.4080800@gmail.com>	<55BAD197.8070903@gmail.com>	<CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>	<CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>	<CABdHhvGMsbj8XVsOVjZ26hKQ0q7T++1wmL6nqe8j3_m_sDjgXw@mail.gmail.com>	<55BBEC74.1000705@gmail.com>	<CABdHhvECEXytuBao=s4xsCiaw3fQjtwtRGU3U5StW497CwjJ3A@mail.gmail.com>
	<CAJXgQP19XoA7Jv+SdFEm8kyGQm7M30sgj9Qyd2+hqdCx8=WxoA@mail.gmail.com>
Message-ID: <55BC2797.9040200@gmail.com>

On 31/07/2015 6:14 PM, Kevin Ushey wrote:
> I'm not sure if that's correct -- from what I see, in the generated Rd
> documentation:
> 
> - The 'usage' is drawn from the S4 generic,
> - The 'arguments' are drawn from the function.
> 
> I think R CMD check is correctly warning about that.

I agree the warning is correct.

I'm not so sure it's actually a Roxygen2 bug, but I think it's that, or
a missing feature.  The user documented an argument that doesn't exist,
because the function is defined twice.  Since Roxygen uses position in
the file to match docs to functions, it could have complained that the
argument docs were in the wrong place (before the inactive definition),
or it could have complained that they were inconsistent with the
expected arg list.

Duncan


> 
> On Fri, Jul 31, 2015 at 2:56 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>>> It seems arguable that this is actually a roxygen bug - the function
>>>> that's actually exported from the package does not have a type
>>>> argument.
>>>
>>> The package fails R CMD check because of a bad .Rd file.  If a user had
>>> written that file, it would be user error, but roxygen2 wrote it, so I'd
>>> say it's pretty clearly a roxygen2 bug.
>>
>> It would really help me if you'd explain a little bit more. I think
>> the essential problem is that the package has two definitions of f:
>>
>> f <- function(x, y) {}
>> setGeneric(f, function(x) {})
>>
>> Roxygen uses the second definition (because it's the last defined),
>> and expects the function to have one argument. R CMD check clearly
>> excepts it two have two arguments. It's not obvious to me which is
>> correct.
>>
>> Hadley
>>
>> --
>> http://had.co.nz/


From alex.deckmyn at meteo.be  Mon Aug  3 09:11:31 2015
From: alex.deckmyn at meteo.be (Alex Deckmyn)
Date: Mon, 3 Aug 2015 09:11:31 +0200 (CEST)
Subject: [R-pkg-devel] new maintainer sought for maps packages
In-Reply-To: <CAPjNR=TGGSggaMAf5dOncuObNc9+8VT1hZz0P-_d5ZjW8iGNLQ@mail.gmail.com>
References: <55B92486.4020202@ecs.vuw.ac.nz> <55BB4575.5010402@ecs.vuw.ac.nz>
	<518769580.5211227.1438364929172.JavaMail.zimbra@meteo.be>
	<21947.48569.674658.393425@stat.math.ethz.ch>
	<61246150.5212024.1438369172072.JavaMail.zimbra@meteo.be>
	<CAPjNR=TGGSggaMAf5dOncuObNc9+8VT1hZz0P-_d5ZjW8iGNLQ@mail.gmail.com>
Message-ID: <1950681728.5240222.1438585891636.JavaMail.zimbra@meteo.be>

Hi, 

I have made a beta version of the new maps package available at 
https://github.com/adeckmyn/maps/archive/v3.0-beta.1.tar.gz. 
If things go smoothly, I will probably submit it to CRAN early September. 

I will also announce and clarify this on R-sig-Geo. 

- Martin, the old data base is now called 'legacy_world', but can alternatively also be accessed as 'world' by calling world.legacy(TRUE) or by an environment setting. The last is meant for people who need to run code quickly without editing it. 
- Jon, I quite liked the suggestion of enabling ISO3166. I have added a simple table and lookup function which could be used as 
> map('world',region=iso3166(c('BE','NL'))) 

There will soon be an updated high resolution map too (it is already accessible in a test package https://github.com/adeckmyn/mapdataNE). 

Alex 
--- 
Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
Royal Meteorological Institute http://www.meteo.be 
Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 


From: "Jonathan Callahan" <jonathan at mazamascience.com> 
To: "Alex" <alex.deckmyn at meteo.be> 
Cc: "Martin Maechler" <maechler at stat.math.ethz.ch>, r-package-devel at r-project.org 
Sent: Friday, 31 July, 2015 21:04:31 
Subject: Re: [R-pkg-devel] new maintainer sought for maps packages 

Please do make the new code available for testing. Those of us developing packages that import 'maps' would love the chance to test our code against the new version of the package. 

On Fri, Jul 31, 2015 at 11:59 AM, Alex Deckmyn < alex.deckmyn at meteo.be > wrote: 


Martin, 

The old data set will certainly stay for a while (or indeed indefinitely, why not). To make the transition as smooth as possible (I am aware that "maps" is used in more places than I can ever check myself) I am including the possibility of switching back to "legacy" mode using an environment variable (or an extra function "world.legacy(TRUE)"), so that any code that runs into trouble can be switched to the old database without needing to edit the code itself. 

Would it be a good idea to make the new maps package (beta) available (e.g. via github) prior to submitting to CRAN? It is more or less ready. Given the many packages that call maps, this could give maintainers a chance to check things. For the moment, it's only the country borders & names that have changed. 

Alex 

From: "Martin Maechler" < maechler at stat.math.ethz.ch > 

> I think R-sig-Geo is the best place to discuss future developments and will be posting there soon. 

I agree ... but the following is not about 'maps' in particular, 
but package maintenance / compatibility .... 

> As Ray mentioned, I (with his help & feedback) have been preparing an updated world map. I am going to be very cautious, but the many changes in country names (post-1990 Europe!) mean that any package or code that uses maps by calling map('world',region=...) to create a map using country names, could be affected. Maintainers of packages calling "maps" may want to contact me to make sure I don't break anything. In any case, I am currently testing a beta version that includes the old data set as a fall back. 

I know these data sets are not very small, but I would still 
strongly recommend that you 
keep the old map, say as "world198x" (and change the "x" to a 
digit if you know which one, or the "8x" to "7y" ... etc). 
Storage and bandwidth have become considerably cheaper and so 
the package could provide (almost) back compatibility ... and 
also something interesting in itself (comparison of two very 
similar maps with R; teaching, history, ...). 

Best regards, 
Martin 

> Alex 

> --- 
> Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
> Royal Meteorological Institute http://www.meteo.be 
> Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 



> I have been somewhat surprised by the number of positive responses to my 
> message. I have found a candidate for the position of maintainer of the 
> maps, mapdata and mapproj packages. I have confidence that Alex Deckmyn 
> < alex.deckmyn at meteo.be > will do at least as good a job as I have done in 
> this regard. 




> The current (recent) releases of the packages still have my name as 
> maintainer, but the address specified points to my (now) old work 
> address which will autorespond to say I have now retired. However in 
> practise, I will still be able to read and respond to such emails for 
> the foreseeable future. 

> Among other improvements, Alex is working on setting up a more accurate 
> "world" database for maps and will submit this once it has been fully 
> tested. 

> Thanks everyone for your support. 
> Ray Brownrigg 

> [[alternative HTML version deleted]] 

> ______________________________________________ 
> R-package-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-package-devel 

[[alternative HTML version deleted]] 

______________________________________________ 
R-package-devel at r-project.org mailing list 
https://stat.ethz.ch/mailman/listinfo/r-package-devel 






-- 
Jonathan Callahan, PhD 
Mazama Science 
206-708-5028 
mazamascience.com 


	[[alternative HTML version deleted]]


From h.wickham at gmail.com  Mon Aug  3 14:11:44 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 3 Aug 2015 07:11:44 -0500
Subject: [R-pkg-devel] need some help to understand package build
	workflow
In-Reply-To: <CAJXgQP19XoA7Jv+SdFEm8kyGQm7M30sgj9Qyd2+hqdCx8=WxoA@mail.gmail.com>
References: <932b384e-cd3e-484e-b2c1-66b5511599b9@me.com>
	<55BACBD9.4080800@gmail.com> <55BAD197.8070903@gmail.com>
	<CABdHhvEcKCXs8wamrNfj6Qn9J2K9nXRiwxzgdY-HKdi832FoYg@mail.gmail.com>
	<CAJXgQP3XoVFsgEkMV2H+TF3F_f13hnL0jmi7_j6pidbNukwO8Q@mail.gmail.com>
	<CABdHhvGMsbj8XVsOVjZ26hKQ0q7T++1wmL6nqe8j3_m_sDjgXw@mail.gmail.com>
	<55BBEC74.1000705@gmail.com>
	<CABdHhvECEXytuBao=s4xsCiaw3fQjtwtRGU3U5StW497CwjJ3A@mail.gmail.com>
	<CAJXgQP19XoA7Jv+SdFEm8kyGQm7M30sgj9Qyd2+hqdCx8=WxoA@mail.gmail.com>
Message-ID: <CABdHhvFLQgBidiXNRn3fWX9Gi3tuCAtxt-CKUPYR7M7cee5sDQ@mail.gmail.com>

On Fri, Jul 31, 2015 at 5:14 PM, Kevin Ushey <kevinushey at gmail.com> wrote:
> I'm not sure if that's correct -- from what I see, in the generated Rd
> documentation:
>
> - The 'usage' is drawn from the S4 generic,
> - The 'arguments' are drawn from the function.
>
> I think R CMD check is correctly warning about that.

Ah, got it - thanks!

Hadley

-- 
http://had.co.nz/


From glennmschultz at me.com  Mon Aug  3 22:31:23 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Mon, 03 Aug 2015 20:31:23 +0000 (GMT)
Subject: [R-pkg-devel] .tar vs. binary builds
Message-ID: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>

Hello All,

I have a package which I would like to distribute. ?However, there are some classes that are not exported if I provide a tar file can the user decompress the tar to the source and then export class. ?I am thinking the answer is year since the tar is source code. ?Conversely, a binary build would prohibit this - correct?

Best Regards,
Glenn

From bbolker at gmail.com  Mon Aug  3 22:43:55 2015
From: bbolker at gmail.com (Ben Bolker)
Date: Mon, 03 Aug 2015 16:43:55 -0400
Subject: [R-pkg-devel] .tar vs. binary builds
In-Reply-To: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>
References: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>
Message-ID: <55BFD28B.3020602@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15-08-03 04:31 PM, Glenn Schultz wrote:
> Hello All,
> 
> I have a package which I would like to distribute.  However, there
> are some classes that are not exported if I provide a tar file can
> the user decompress the tar to the source and then export class.  I
> am thinking the answer is year since the tar is source code.
> Conversely, a binary build would prohibit this - correct?
> 
> Best Regards, Glenn ______________________________________________ 
> R-package-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

  Not really clear what your question is.  If you distribute a source
package/'tarball' (i.e. .tar, typically compressed to .tar.gz) then
users can install via R CMD INSTALL [...] or within R
install.packages("...",repos=NULL).  Then they'll have access to
everything that is exported via your NAMESPACE file.  Can you be more
concrete/specific/clear about what you have in mind?

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQEcBAEBAgAGBQJVv9KLAAoJEOCV5YRblxUHnokIANorhDR3olkH3zLlt9ZoYMS+
uNuVfRuF9JOhe2BD0C4fEUEkPp0IjnNNcDdP1R6gBSaj8ai+Lq2qOKucwPpll6zr
9q+5jUxKaQJmO6QBzMJODSSflFjZmbwZHhb0QLzDMfn41cAcg18K0uW6SLH91avF
kqPxVGn2sAccBuZtjbjCdPfRHalg/N0rSmvgWDNTtVQhbZJFfAwopgVqVyMKm2wV
K+J2xGd85NAkHCT/1No0ghG5s6/GTXjsfD0O5qJ07Ut5/GwLaWkeS9F9fEHPvziC
XlwOjsaOg8YNpCWi2aycrQYt9zINNTmFsN0Zrg/k+x2Zuoim9QeTHdWnWT8K85I=
=enco
-----END PGP SIGNATURE-----


From murdoch.duncan at gmail.com  Tue Aug  4 00:10:23 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 03 Aug 2015 18:10:23 -0400
Subject: [R-pkg-devel] .tar vs. binary builds
In-Reply-To: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>
References: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>
Message-ID: <55BFE6CF.8030304@gmail.com>

On 03/08/2015 4:31 PM, Glenn Schultz wrote:
> Hello All,
> 
> I have a package which I would like to distribute.  However, there are some classes that are not exported if I provide a tar file can the user decompress the tar to the source and then export class.  I am thinking the answer is year since the tar is source code.  Conversely, a binary build would prohibit this - correct?

If you distribute a binary file, your package will soon become obsolete:
 they are tied to particular versions of R and particular platforms.

If you want wide exposure for your package, you should distribute it as
a source package on CRAN.  It's more work than self-publishing (because
you need to meet their requirements), but it will improve your package.

If your package is distributed in any other way, some people (like me)
will advise against using it at all.

Duncan Murdoch


From bbolker at gmail.com  Tue Aug  4 01:04:40 2015
From: bbolker at gmail.com (Ben Bolker)
Date: Mon, 03 Aug 2015 19:04:40 -0400
Subject: [R-pkg-devel] .tar vs. binary builds
In-Reply-To: <55BFF2ED.4090904@gmail.com>
References: <55BFF2ED.4090904@gmail.com>
Message-ID: <55BFF388.5030105@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 15-08-03 06:34 PM, Glenn Schultz wrote:
> Hi Ben,

[Please keep the list cc'd in your replies.]

> Thanks for answering so quickly.  Basically, I want to be able to
  distribute the package to users and testers some are on Mac others
  Windows.  I am looking for the best way to do this but for the time
  being there are some classes which should not be extended.  So the
  .tar being source may allow a user to uncompress the source and
  alter and export a class that needs to be protected from change.
  Basically, I want to open source a mortgage and asset backed
  valuation tool but there are certain classes that for now should not
  changed or extended.

I don't know how expert your users are, or what kind of
social/moral/administrative control you have over what they do with
your code. Building binary packages does strip out some information,
but since R is an interpreted language, the information needed to
change/modify/extend the code would still be present for a
sufficiently motivated user.  You will definitely gain some degree of
security/write-protection through obscurity, but not any real
protection.  R can be obfuscated, but it is not designed for being
locked down; if you really need security, the general advice is to
provide a front-end to the users via a server you control.

> Glenn
> 
> Sent from my iPhone
> 
>> On Aug 3, 2015, at 3:43 PM, Ben Bolker <bbolker at gmail.com> 
>> wrote:
>> 
>>>> On 15-08-03 04:31 PM, Glenn Schultz wrote: Hello All,
>>>> 
>>>> I have a package which I would like to distribute.  However, 
>>>> there are some classes that are not exported if I provide a 
>>>> tar file can the user decompress the tar to the source and 
>>>> then export class.  I am thinking the answer is year since 
>>>> the tar is source code. Conversely, a binary build would 
>>>> prohibit this - correct?
>>>> 
>>>> Best Regards, Glenn 
>>>> ______________________________________________ 
>>>> R-package-devel at r-project.org mailing list 
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> Not really clear what your question is.  If you distribute a source
> package/'tarball' (i.e. .tar, typically compressed to .tar.gz) then
> users can install via R CMD INSTALL [...] or within R
> install.packages("...",repos=NULL).  Then they'll have access to 
> everything that is exported via your NAMESPACE file.  Can you be 
> more concrete/specific/clear about what you have in mind?
> 
>> 
>> ______________________________________________ 
>> R-package-devel at r-project.org mailing list 
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQEcBAEBAgAGBQJVv/OIAAoJEOCV5YRblxUHfiMIAJwlKENYU3a2rj3npiJC59XO
ZxeBVBhDnWGrPN9g+w4pimSFZhJ2QD5+WuyA/SiuLN9vlVjBfzo7VGjRBqDopsmt
7/j1ACfx2Jz2uvnUWmb7IRI2uEBR+yIezuQbY0m6gbzKIrDHT8PYXkNvBnRW1EkA
c2T8C5pPocSCwyKCgqPARoCd16+Va6rzV1aCjuhJHk5tgH8a7IampP4dn9w/coRN
CLzJEWpXhzP+9fhSaG5bdLm3cTgDxybPDwPAvkWFhmmKrd3kpf69jMYUxIkyqgu8
HkLX4BT6s5qvURvmT1DyAY2pztJWaX2Gd3n1aEUze91Du8yq85miiGexWUZTDPc=
=uGhT
-----END PGP SIGNATURE-----


From glennmschultz at me.com  Tue Aug  4 01:59:24 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Mon, 03 Aug 2015 23:59:24 +0000 (GMT)
Subject: [R-pkg-devel] .tar vs. binary builds
In-Reply-To: <55BFF388.5030105@gmail.com>
Message-ID: <2ddc2b6a-5cf0-4fb4-8743-8c845a95d536@me.com>

Hi Ben,

I get it thanks - feedback very helpful.

-Glenn ?

On Aug 03, 2015, at 06:06 PM, Ben Bolker <bbolker at gmail.com> wrote:

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 15-08-03 06:34 PM, Glenn Schultz wrote:
Hi Ben,

[Please keep the list cc'd in your replies.]

Thanks for answering so quickly. Basically, I want to be able to
distribute the package to users and testers some are on Mac others
Windows. I am looking for the best way to do this but for the time
being there are some classes which should not be extended. So the
.tar being source may allow a user to uncompress the source and
alter and export a class that needs to be protected from change.
Basically, I want to open source a mortgage and asset backed
valuation tool but there are certain classes that for now should not
changed or extended.

I don't know how expert your users are, or what kind of
social/moral/administrative control you have over what they do with
your code. Building binary packages does strip out some information,
but since R is an interpreted language, the information needed to
change/modify/extend the code would still be present for a
sufficiently motivated user. You will definitely gain some degree of
security/write-protection through obscurity, but not any real
protection. R can be obfuscated, but it is not designed for being
locked down; if you really need security, the general advice is to
provide a front-end to the users via a server you control.

Glenn

Sent from my iPhone

On Aug 3, 2015, at 3:43 PM, Ben Bolker <bbolker at gmail.com>
wrote:

On 15-08-03 04:31 PM, Glenn Schultz wrote: Hello All,

I have a package which I would like to distribute. However,
there are some classes that are not exported if I provide a
tar file can the user decompress the tar to the source and
then export class. I am thinking the answer is year since
the tar is source code. Conversely, a binary build would
prohibit this - correct?

Best Regards, Glenn
______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

Not really clear what your question is. If you distribute a source
package/'tarball' (i.e. .tar, typically compressed to .tar.gz) then
users can install via R CMD INSTALL [...] or within R
install.packages("...",repos=NULL). Then they'll have access to
everything that is exported via your NAMESPACE file. Can you be
more concrete/specific/clear about what you have in mind?


______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQEcBAEBAgAGBQJVv/OIAAoJEOCV5YRblxUHfiMIAJwlKENYU3a2rj3npiJC59XO
ZxeBVBhDnWGrPN9g+w4pimSFZhJ2QD5+WuyA/SiuLN9vlVjBfzo7VGjRBqDopsmt
7/j1ACfx2Jz2uvnUWmb7IRI2uEBR+yIezuQbY0m6gbzKIrDHT8PYXkNvBnRW1EkA
c2T8C5pPocSCwyKCgqPARoCd16+Va6rzV1aCjuhJHk5tgH8a7IampP4dn9w/coRN
CLzJEWpXhzP+9fhSaG5bdLm3cTgDxybPDwPAvkWFhmmKrd3kpf69jMYUxIkyqgu8
HkLX4BT6s5qvURvmT1DyAY2pztJWaX2Gd3n1aEUze91Du8yq85miiGexWUZTDPc=
=uGhT
-----END PGP SIGNATURE-----

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

From glennmschultz at me.com  Tue Aug  4 02:32:04 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Mon, 03 Aug 2015 19:32:04 -0500
Subject: [R-pkg-devel] .tar vs. binary builds
In-Reply-To: <55BFE6CF.8030304@gmail.com>
References: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>
	<55BFE6CF.8030304@gmail.com>
Message-ID: <F7199153-2F4F-49DB-96D7-2F6B4CA95B1C@me.com>

Got it thanks - I want to achieve maximum exposure and transparency

Sent from my iPhone

> On Aug 3, 2015, at 5:10 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
>> On 03/08/2015 4:31 PM, Glenn Schultz wrote:
>> Hello All,
>> 
>> I have a package which I would like to distribute.  However, there are some classes that are not exported if I provide a tar file can the user decompress the tar to the source and then export class.  I am thinking the answer is year since the tar is source code.  Conversely, a binary build would prohibit this - correct?
> 
> If you distribute a binary file, your package will soon become obsolete:
> they are tied to particular versions of R and particular platforms.
> 
> If you want wide exposure for your package, you should distribute it as
> a source package on CRAN.  It's more work than self-publishing (because
> you need to meet their requirements), but it will improve your package.
> 
> If your package is distributed in any other way, some people (like me)
> will advise against using it at all.
> 
> Duncan Murdoch
> 


From edd at debian.org  Tue Aug  4 03:38:57 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 3 Aug 2015 20:38:57 -0500
Subject: [R-pkg-devel] .tar vs. binary builds
In-Reply-To: <F7199153-2F4F-49DB-96D7-2F6B4CA95B1C@me.com>
References: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>
	<55BFE6CF.8030304@gmail.com>
	<F7199153-2F4F-49DB-96D7-2F6B4CA95B1C@me.com>
Message-ID: <21952.6065.900883.498954@max.nulle.part>


On 3 August 2015 at 19:32, Glenn Schultz wrote:
| Got it thanks - I want to achieve maximum exposure and transparency

So provide access to the source code, as well as to installable binaries.

That is a recipe many of us have used for years if not decades.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From glennmschultz at me.com  Tue Aug  4 13:28:03 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Tue, 04 Aug 2015 06:28:03 -0500
Subject: [R-pkg-devel] .tar vs. binary builds
In-Reply-To: <55BFE6CF.8030304@gmail.com>
References: <14d06bc8-6f60-4622-bbd7-90b2a84abbb3@me.com>
	<55BFE6CF.8030304@gmail.com>
Message-ID: <D7FB7C25-3D14-42EE-B696-62EACFB650D0@me.com>

Hi Duncan,
I plan to submit it to CRAN at some point it passes RCMD and works on Mac and windows. 

 I am working on the vignette and help files.  When those are done I plan to submit to CRAN.  Will see how that goes. 

The are a ton of other thing like accessor and error handling that need to be addressed.  I am researching those.

Glenn

Sent from my iPhone

> On Aug 3, 2015, at 5:10 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
>> On 03/08/2015 4:31 PM, Glenn Schultz wrote:
>> Hello All,
>> 
>> I have a package which I would like to distribute.  However, there are some classes that are not exported if I provide a tar file can the user decompress the tar to the source and then export class.  I am thinking the answer is year since the tar is source code.  Conversely, a binary build would prohibit this - correct?
> 
> If you distribute a binary file, your package will soon become obsolete:
> they are tied to particular versions of R and particular platforms.
> 
> If you want wide exposure for your package, you should distribute it as
> a source package on CRAN.  It's more work than self-publishing (because
> you need to meet their requirements), but it will improve your package.
> 
> If your package is distributed in any other way, some people (like me)
> will advise against using it at all.
> 
> Duncan Murdoch
> 


From zz4 at williams.edu  Mon Aug  3 20:54:40 2015
From: zz4 at williams.edu (Zhu, Zijie)
Date: Mon, 3 Aug 2015 14:54:40 -0400
Subject: [R-pkg-devel] Including Open-Source C Code in R Package
Message-ID: <CAFahs2Xtb6LUoWbNecSHcsE7rKwNO55S4Eg-q5VNjYs08xJdHQ@mail.gmail.com>

Hi all,

I would like to submit a package to CRAN. Now my package includes an
open-source C model released by some other institution. This
open-source C model is published under some public license that is not
in the complete list that CRAN considers valid (link to the list:
https://svn.r-project.org/R/trunk/share/licenses/license.db)

Last time I tried to submit the package containing this C model to
CRAN, but they rejected because of the license problem. Therefore, I
would like to know if the following is possible, or what is the best
practice:

1. Can I include the open-source C model in my package, in a way that
can get around the license issue?

2. Or, if the above is not feasible, I can split the package in
halves. Is it possible that I submit "Part A" to CRAN and put "Part B"
on Github, and when calling `install.packages("Part A")`, "Part B"
will also be fetched and installed from Github? Currently I have the
following piece of code in "Part A" to do this:

.onLoad <- function(libname, pkgname) {
  if ( ! "Part B" %in% .packages(all.available = TRUE)){
    devtools::install_github("myrepo/Part B")
  }
}

Is this acceptable to CRAN maintainer, or what is the best practice?

Many thanks in advance!!

Sincerely,
Miller


From edd at debian.org  Wed Aug  5 19:21:34 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 5 Aug 2015 12:21:34 -0500
Subject: [R-pkg-devel] Including Open-Source C Code in R Package
In-Reply-To: <CAFahs2Xtb6LUoWbNecSHcsE7rKwNO55S4Eg-q5VNjYs08xJdHQ@mail.gmail.com>
References: <CAFahs2Xtb6LUoWbNecSHcsE7rKwNO55S4Eg-q5VNjYs08xJdHQ@mail.gmail.com>
Message-ID: <21954.17950.150622.10220@max.nulle.part>


On 3 August 2015 at 14:54, Zhu, Zijie wrote:
| Hi all,
| 
| I would like to submit a package to CRAN. Now my package includes an
| open-source C model released by some other institution. This
| open-source C model is published under some public license that is not
| in the complete list that CRAN considers valid (link to the list:
| https://svn.r-project.org/R/trunk/share/licenses/license.db)
|
| Last time I tried to submit the package containing this C model to
| CRAN, but they rejected because of the license problem. Therefore, I
| would like to know if the following is possible, or what is the best
| practice:
| 
| 1. Can I include the open-source C model in my package, in a way that
| can get around the license issue?

You seem to suggest that you can copy the code and put another license on
it. In general you can not: doing so is likely to violate the license.
(Disclaimer: I am not a lawyer, and for real answers you will need one).

| 2. Or, if the above is not feasible, I can split the package in
| halves. Is it possible that I submit "Part A" to CRAN and put "Part B"
| on Github, and when calling `install.packages("Part A")`, "Part B"
| will also be fetched and installed from Github? Currently I have the
| following piece of code in "Part A" to do this:
| 
| .onLoad <- function(libname, pkgname) {
|   if ( ! "Part B" %in% .packages(all.available = TRUE)){
|     devtools::install_github("myrepo/Part B")
|   }
| }
| 
| Is this acceptable to CRAN maintainer, or what is the best practice?

There are several packages on CRAN that use the 'Additional_repositories'
field in DESCRIPTION (see the "Writing R Extensions" manual for details) and
two of these use a drat repo (disclaimer: I wrote drat, and find it useful;
see http://dirk.eddelbuettel.com/code/drat.html for more on drat):

  - lawn
  - wikipediatrend

You could follow their lead and just have the code which CRAN cannot use on
an additional repository. Which drat makes super-easy --- and then it is just
an install.packages() call away.

Note, however, that Additional_repositories works only for Suggests: but not
Depends:  This has implications for how you lay out code in your package.

Dirk

 
| Many thanks in advance!!
| 
| Sincerely,
| Miller
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch.duncan at gmail.com  Wed Aug  5 19:34:39 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 05 Aug 2015 13:34:39 -0400
Subject: [R-pkg-devel] Including Open-Source C Code in R Package
In-Reply-To: <CAFahs2Xtb6LUoWbNecSHcsE7rKwNO55S4Eg-q5VNjYs08xJdHQ@mail.gmail.com>
References: <CAFahs2Xtb6LUoWbNecSHcsE7rKwNO55S4Eg-q5VNjYs08xJdHQ@mail.gmail.com>
Message-ID: <55C2492F.6030401@gmail.com>

On 03/08/2015 2:54 PM, Zhu, Zijie wrote:
> Hi all,
> 
> I would like to submit a package to CRAN. Now my package includes an
> open-source C model released by some other institution. This
> open-source C model is published under some public license that is not
> in the complete list that CRAN considers valid (link to the list:
> https://svn.r-project.org/R/trunk/share/licenses/license.db)
> 
> Last time I tried to submit the package containing this C model to
> CRAN, but they rejected because of the license problem. Therefore, I
> would like to know if the following is possible, or what is the best
> practice:
> 
> 1. Can I include the open-source C model in my package, in a way that
> can get around the license issue?
> 
> 2. Or, if the above is not feasible, I can split the package in
> halves. Is it possible that I submit "Part A" to CRAN and put "Part B"
> on Github, and when calling `install.packages("Part A")`, "Part B"
> will also be fetched and installed from Github? Currently I have the
> following piece of code in "Part A" to do this:
> 
> .onLoad <- function(libname, pkgname) {
>   if ( ! "Part B" %in% .packages(all.available = TRUE)){
>     devtools::install_github("myrepo/Part B")
>   }
> }
> 
> Is this acceptable to CRAN maintainer, or what is the best practice?

I don't think so --- how could anyone use your package, if it is incomplete?

You should get permission from the authors of the other package to
release it under one of the allowed licenses.  Or distribute the whole
thing on Github, or some other non-CRAN location.

Duncan Murdoch


From zz4 at williams.edu  Wed Aug  5 22:14:12 2015
From: zz4 at williams.edu (Zhu, Zijie)
Date: Wed, 5 Aug 2015 16:14:12 -0400
Subject: [R-pkg-devel] Including Open-Source C Code in R Package
In-Reply-To: <21954.17950.150622.10220@max.nulle.part>
References: <CAFahs2Xtb6LUoWbNecSHcsE7rKwNO55S4Eg-q5VNjYs08xJdHQ@mail.gmail.com>
	<21954.17950.150622.10220@max.nulle.part>
Message-ID: <CAFahs2VBiwKs4J5-p+VhpEfURuAXjEcnMxcP0pOwJPTj3qxU7A@mail.gmail.com>

Hi Dirk and Duncan,

Many thanks for replying! I will definitely try drat and see how it works.

> I don't think so --- how could anyone use your package, if it is incomplete?
>
> You should get permission from the authors of the other package to
> release it under one of the allowed licenses.  Or distribute the whole
> thing on Github, or some other non-CRAN location.

And sorry, Duncan, that I didn't explain my situation very clearly.
I'm also co-author of the other R package. At the beginning, I
co-authored an R package that contains the open-source C model. I
tried to submit this package to CRAN, but the CRAN maintainer says the
license of that C model is not in mainstream and I should obtain a
written confirmation (which I failed, cuz the institution that wrote
the C code never responded.) So I tried to split the package into
halves, one half containing the C-model code and the other half
without C code. I intend to put the half without C code on Github,
while submitting the half with C code to CRAN. So I'm actually
co-author of both R packages that I referred to.

The .onLoad funciton above is trying to download the R package with C
code from Github, when users first install the R package without C
code from CRAN. So when user type install.packages("CRAN-part"), she
will also (unknowingly) call install_github("Github-part"). I am
concerned that CRAN maintainer will not be happy about this .onLoad
function and what it does.

Thanks,
Miller


From murdoch.duncan at gmail.com  Wed Aug  5 22:28:30 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 05 Aug 2015 16:28:30 -0400
Subject: [R-pkg-devel] Including Open-Source C Code in R Package
In-Reply-To: <CAFahs2VBiwKs4J5-p+VhpEfURuAXjEcnMxcP0pOwJPTj3qxU7A@mail.gmail.com>
References: <CAFahs2Xtb6LUoWbNecSHcsE7rKwNO55S4Eg-q5VNjYs08xJdHQ@mail.gmail.com>	<21954.17950.150622.10220@max.nulle.part>
	<CAFahs2VBiwKs4J5-p+VhpEfURuAXjEcnMxcP0pOwJPTj3qxU7A@mail.gmail.com>
Message-ID: <55C271EE.2090309@gmail.com>

On 05/08/2015 4:14 PM, Zhu, Zijie wrote:
> Hi Dirk and Duncan,
> 
> Many thanks for replying! I will definitely try drat and see how it works.
> 
>> I don't think so --- how could anyone use your package, if it is incomplete?
>>
>> You should get permission from the authors of the other package to
>> release it under one of the allowed licenses.  Or distribute the whole
>> thing on Github, or some other non-CRAN location.
> 
> And sorry, Duncan, that I didn't explain my situation very clearly.
> I'm also co-author of the other R package. At the beginning, I
> co-authored an R package that contains the open-source C model. I
> tried to submit this package to CRAN, but the CRAN maintainer says the
> license of that C model is not in mainstream and I should obtain a
> written confirmation (which I failed, cuz the institution that wrote
> the C code never responded.) So I tried to split the package into
> halves, one half containing the C-model code and the other half
> without C code. I intend to put the half without C code on Github,
> while submitting the half with C code to CRAN. So I'm actually
> co-author of both R packages that I referred to.
> 
> The .onLoad funciton above is trying to download the R package with C
> code from Github, when users first install the R package without C
> code from CRAN. So when user type install.packages("CRAN-part"), she
> will also (unknowingly) call install_github("Github-part"). I am
> concerned that CRAN maintainer will not be happy about this .onLoad
> function and what it does.
> 

So don't submit it to CRAN.  People use CRAN because they have
standards, and it sounds as though you are trying to find a way to
subvert those standards.

Duncan Murdoch


From glennmschultz at me.com  Sun Aug  9 15:59:48 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Sun, 09 Aug 2015 13:59:48 +0000 (GMT)
Subject: [R-pkg-devel] Working with connections
Message-ID: <60e89955-2589-4db8-add2-8ed3836b5fcb@me.com>

Hi All,?

I use connections to open and close data folders needed by my package. ?After each function closes I get the following warnings (depending on the connection that has been opened).

10: closing unused connection 3 (/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)?

Below is the connection function that is related to the above warning:
? #------------------------------------------------------------------------------------
? #' A connection function to BondData calling MBS cusps
? #'?
? #' Opens a connection to the BondData folder to call MBS cusip data?
? #' @param MBS.id A character string the MBS.id or cusip number current MBS.id is supported
? #' @export
? MBS <- function(MBS.id = "character"){
? ? ? ? ? ? ? ? ? MBS.Conn <- gzfile(description = paste(system.file(package = "BondLab"),
? ? ? ? ? ? ? ? ? ? ? ? ? ? ? "/BondData/", MBS.id, ".rds", sep = ""), open = "rb") ? ? ? ? ?
? ? ? ? ? ? ? ? ? MBS <- readRDS(MBS.Conn)
? ? ? ? ? ? ? ? ? return(MBS)
? ? ? ? ? ? ? ? ? close.connection(MBS.Conn)
? ? ? ? ? ? ? ? ? }

I have googled this warning and it seems to be triggered when a function terminates and the connection is open. ?But, I think the connection function closes the connection once the object is returned. ?What am I doing wrong?

-Glenn

From josh.m.ulrich at gmail.com  Sun Aug  9 16:04:05 2015
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sun, 9 Aug 2015 09:04:05 -0500
Subject: [R-pkg-devel] Working with connections
In-Reply-To: <60e89955-2589-4db8-add2-8ed3836b5fcb@me.com>
References: <60e89955-2589-4db8-add2-8ed3836b5fcb@me.com>
Message-ID: <CAPPM_gRkEEow73-oYcaXB9crvW0NvPs=ytzfss1HRwh1WALSaQ@mail.gmail.com>

On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com> wrote:
> Hi All,
>
> I use connections to open and close data folders needed by my package.
> After each function closes I get the following warnings (depending on the
> connection that has been opened).
>
> 10: closing unused connection 3
> (/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)
>
> Below is the connection function that is related to the above warning:
>
> #------------------------------------------------------------------------------------
>   #' A connection function to BondData calling MBS cusps
>   #'
>   #' Opens a connection to the BondData folder to call MBS cusip data
>   #' @param MBS.id A character string the MBS.id or cusip number current
> MBS.id is supported
>   #' @export
>   MBS <- function(MBS.id = "character"){
>                   MBS.Conn <- gzfile(description = paste(system.file(package
> = "BondLab"),
>                               "/BondData/", MBS.id, ".rds", sep = ""), open
> = "rb")
>                   MBS <- readRDS(MBS.Conn)
>                   return(MBS)
>                   close.connection(MBS.Conn)
>                   }
>
> I have googled this warning and it seems to be triggered when a function
> terminates and the connection is open.  But, I think the connection function
> closes the connection once the object is returned.  What am I doing wrong?
>
Your call to return() exits the function, so the close.connection()
call is never evaluated.  Considering using on.exit() to close the
connection, since it will close the connection regardless of how the
function exits (e.g. because of an error).

> -Glenn
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From glennmschultz at me.com  Sun Aug  9 16:07:04 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Sun, 09 Aug 2015 09:07:04 -0500
Subject: [R-pkg-devel] Working with connections
In-Reply-To: <CAPPM_gRkEEow73-oYcaXB9crvW0NvPs=ytzfss1HRwh1WALSaQ@mail.gmail.com>
References: <60e89955-2589-4db8-add2-8ed3836b5fcb@me.com>
	<CAPPM_gRkEEow73-oYcaXB9crvW0NvPs=ytzfss1HRwh1WALSaQ@mail.gmail.com>
Message-ID: <7A6CA89F-ADD1-4397-BBEE-404BDDDAA674@me.com>

Hi Joshua, Thank-you.  
I did not realize that the call to return closed the connection
-Glenn
> On Aug 9, 2015, at 9:04 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> 
> On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com> wrote:
>> Hi All,
>> 
>> I use connections to open and close data folders needed by my package.
>> After each function closes I get the following warnings (depending on the
>> connection that has been opened).
>> 
>> 10: closing unused connection 3
>> (/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)
>> 
>> Below is the connection function that is related to the above warning:
>> 
>> #------------------------------------------------------------------------------------
>>  #' A connection function to BondData calling MBS cusps
>>  #'
>>  #' Opens a connection to the BondData folder to call MBS cusip data
>>  #' @param MBS.id A character string the MBS.id or cusip number current
>> MBS.id is supported
>>  #' @export
>>  MBS <- function(MBS.id = "character"){
>>                  MBS.Conn <- gzfile(description = paste(system.file(package
>> = "BondLab"),
>>                              "/BondData/", MBS.id, ".rds", sep = ""), open
>> = "rb")
>>                  MBS <- readRDS(MBS.Conn)
>>                  return(MBS)
>>                  close.connection(MBS.Conn)
>>                  }
>> 
>> I have googled this warning and it seems to be triggered when a function
>> terminates and the connection is open.  But, I think the connection function
>> closes the connection once the object is returned.  What am I doing wrong?
>> 
> Your call to return() exits the function, so the close.connection()
> call is never evaluated.  Considering using on.exit() to close the
> connection, since it will close the connection regardless of how the
> function exits (e.g. because of an error).
> 
>> -Glenn
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> 
> 
> -- 
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com


From h.wickham at gmail.com  Sun Aug  9 16:22:22 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sun, 9 Aug 2015 07:22:22 -0700
Subject: [R-pkg-devel] Working with connections
In-Reply-To: <CAPPM_gRkEEow73-oYcaXB9crvW0NvPs=ytzfss1HRwh1WALSaQ@mail.gmail.com>
References: <60e89955-2589-4db8-add2-8ed3836b5fcb@me.com>
	<CAPPM_gRkEEow73-oYcaXB9crvW0NvPs=ytzfss1HRwh1WALSaQ@mail.gmail.com>
Message-ID: <CABdHhvEEp4RWrEFvyov7zM49d5SbbiQUyKDke00nXN=7MShPAA@mail.gmail.com>

Also it's a little strange to put an RDS file _inside_ a gz, since
normally the compression is done internally.

And are you sure you should be exposing this data via a function,
rather than using the regular package data mechanism?

Hadley

On Sun, Aug 9, 2015 at 7:04 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com> wrote:
>> Hi All,
>>
>> I use connections to open and close data folders needed by my package.
>> After each function closes I get the following warnings (depending on the
>> connection that has been opened).
>>
>> 10: closing unused connection 3
>> (/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)
>>
>> Below is the connection function that is related to the above warning:
>>
>> #------------------------------------------------------------------------------------
>>   #' A connection function to BondData calling MBS cusps
>>   #'
>>   #' Opens a connection to the BondData folder to call MBS cusip data
>>   #' @param MBS.id A character string the MBS.id or cusip number current
>> MBS.id is supported
>>   #' @export
>>   MBS <- function(MBS.id = "character"){
>>                   MBS.Conn <- gzfile(description = paste(system.file(package
>> = "BondLab"),
>>                               "/BondData/", MBS.id, ".rds", sep = ""), open
>> = "rb")
>>                   MBS <- readRDS(MBS.Conn)
>>                   return(MBS)
>>                   close.connection(MBS.Conn)
>>                   }
>>
>> I have googled this warning and it seems to be triggered when a function
>> terminates and the connection is open.  But, I think the connection function
>> closes the connection once the object is returned.  What am I doing wrong?
>>
> Your call to return() exits the function, so the close.connection()
> call is never evaluated.  Considering using on.exit() to close the
> connection, since it will close the connection regardless of how the
> function exits (e.g. because of an error).
>
>> -Glenn
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>
>
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://had.co.nz/


From glennmschultz at me.com  Sun Aug  9 16:45:03 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Sun, 09 Aug 2015 14:45:03 +0000 (GMT)
Subject: [R-pkg-devel] Working with connections
Message-ID: <a0cecab4-a456-4d48-9b94-a94b7e2fb765@me.com>

Hi Hadley,
Thanks for answering. ?I basically followed what was outlined in Software for Data Analysis. ?Although, I must admit it was a little light in this area (about a paragraph). ?I will have to do some additional reading/research on the RDS inside a gz issue. ?If it is?not the?correct?application then I need to correct what I am doing.

To the second issue, I am exposing then data via a function to provide data storage/retrieval flexibility because cusip data for MBS securities can go to the terabyte. ?Additionally, in the case of a REMIC (a resecuritization) ?the cusip detail is assembled from many objects (a one to many relationship) before analysis begins.

So, based on the above I was thinking that one could have the data stored remotely (SQL, etc.) and edit the connection function as needed to point it to the required cusip data. ?Is there a better way to do this?


-Glenn

On Aug 09, 2015, at 09:23 AM, Hadley Wickham <h.wickham at gmail.com> wrote:

Also it's a little strange to put an RDS file _inside_ a gz, since
normally the compression is done internally.

And are you sure you should be exposing this data via a function,
rather than using the regular package data mechanism?

Hadley

On Sun, Aug 9, 2015 at 7:04 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com> wrote:
Hi All,

I use connections to open and close data folders needed by my package.
After each function closes I get the following warnings (depending on the
connection that has been opened).

10: closing unused connection 3
(/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)

Below is the connection function that is related to the above warning:

#------------------------------------------------------------------------------------
#' A connection function to BondData calling MBS cusps
#'
#' Opens a connection to the BondData folder to call MBS cusip data
#' @param MBS.id A character string the MBS.id or cusip number current
MBS.id is supported
#' @export
MBS <- function(MBS.id = "character"){
MBS.Conn <- gzfile(description = paste(system.file(package
= "BondLab"),
"/BondData/", MBS.id, ".rds", sep = ""), open
= "rb")
MBS <- readRDS(MBS.Conn)
return(MBS)
close.connection(MBS.Conn)
}

I have googled this warning and it seems to be triggered when a function
terminates and the connection is open. But, I think the connection function
closes the connection once the object is returned. What am I doing wrong?

Your call to return() exits the function, so the close.connection()
call is never evaluated. Considering using on.exit() to close the
connection, since it will close the connection regardless of how the
function exits (e.g. because of an error).

-Glenn
______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel



--
Joshua Ulrich | about.me/joshuaulrich
FOSS Trading | http://www.fosstrading.com

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://had.co.nz/

From ignacio82 at gmail.com  Mon Aug 10 19:25:18 2015
From: ignacio82 at gmail.com (Ignacio Martinez)
Date: Mon, 10 Aug 2015 17:25:18 +0000
Subject: [R-pkg-devel] Bug? Makevars ignores FC=mpif90
Message-ID: <CAJA1VFxmN0wNb5_mp-GCfZWg_ROZkGDr_dDWHH7RpLVQcqxQ+g@mail.gmail.com>

Hi,

I'm learning to develop R packages that use Fortran (and MPI). I recently
asked a question on stack-overflow and I was told to contact this list with
a followup question.

When I add to src/Makevars the follwoing line

FC=mpif90

Rstudio ignores it when I click `Build and Reload`.  But, if I create a
Makevars file in a .R/ directory in my$HOME directory with that line,
Rstudio uses mpif90.

Is the fact that R is ignoring the src/Makevars a bug? If not, am I doing
something wrong?

Thanks,

Ignacio


PS: I hope this is the right place to ask this question.

	[[alternative HTML version deleted]]


From pdalgd at gmail.com  Mon Aug 10 19:41:31 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Mon, 10 Aug 2015 19:41:31 +0200
Subject: [R-pkg-devel] Bug? Makevars ignores FC=mpif90
In-Reply-To: <CAJA1VFxmN0wNb5_mp-GCfZWg_ROZkGDr_dDWHH7RpLVQcqxQ+g@mail.gmail.com>
References: <CAJA1VFxmN0wNb5_mp-GCfZWg_ROZkGDr_dDWHH7RpLVQcqxQ+g@mail.gmail.com>
Message-ID: <A1D63962-4F4A-46CA-ACF8-84AF4B9F9233@gmail.com>


> On 10 Aug 2015, at 19:25 , Ignacio Martinez <ignacio82 at gmail.com> wrote:
> 
> Hi,
> 
> I'm learning to develop R packages that use Fortran (and MPI). I recently
> asked a question on stack-overflow and I was told to contact this list with
> a followup question.
> 
> When I add to src/Makevars the follwoing line
> 
> FC=mpif90
> 
> Rstudio ignores it when I click `Build and Reload`.  But, if I create a
> Makevars file in a .R/ directory in my$HOME directory with that line,
> Rstudio uses mpif90.
> 
> Is the fact that R is ignoring the src/Makevars a bug? If not, am I doing
> something wrong?
> 

Ask differently: Does it say anywhere that the build process should use src/Makevars? 

Also notice that an important part of the package concept is that packages can be distributed. The recipient's Fortran compiler is not necessarily "mpif90". So, generally speaking, build configuration belongs in the build environment, not in the package.

-pd

> Thanks,
> 
> Ignacio
> 
> 
> PS: I hope this is the right place to ask this question.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ignacio82 at gmail.com  Mon Aug 10 19:47:38 2015
From: ignacio82 at gmail.com (Ignacio Martinez)
Date: Mon, 10 Aug 2015 17:47:38 +0000
Subject: [R-pkg-devel] Bug? Makevars ignores FC=mpif90
In-Reply-To: <A1D63962-4F4A-46CA-ACF8-84AF4B9F9233@gmail.com>
References: <CAJA1VFxmN0wNb5_mp-GCfZWg_ROZkGDr_dDWHH7RpLVQcqxQ+g@mail.gmail.com>
	<A1D63962-4F4A-46CA-ACF8-84AF4B9F9233@gmail.com>
Message-ID: <CAJA1VFw0PS_Ni1P1V5d1nyHBw3Zq_SvYmMA+=VT2e0C9uFBkWg@mail.gmail.com>

Thanks peter.

1. Does it say anywhere that the build process should use src/Makevars?
I'm not sure, where should it say that? I'm using the default options in
Rstudio to create a package

2. Also notice that an important part of the package concept is that
packages can be distributed.
The package that i want to build uses MPI. Is that a problem? My
understanding is that in order to use MPI i have to set FC to mpif90. Is
that wrong?

3. build configuration belongs in the build environment
I'm not sure if I follow. What is the correct way of telling Rstudio that
the package i'm building uses MPI?

Thanks again!

PS: This is the link
<http://stackoverflow.com/questions/31924487/tell-rstudio-to-use-mpif90-instead-of-gfortran>to
my question in stack-overflow



On Mon, Aug 10, 2015 at 1:41 PM peter dalgaard <pdalgd at gmail.com> wrote:

>
> > On 10 Aug 2015, at 19:25 , Ignacio Martinez <ignacio82 at gmail.com> wrote:
> >
> > Hi,
> >
> > I'm learning to develop R packages that use Fortran (and MPI). I recently
> > asked a question on stack-overflow and I was told to contact this list
> with
> > a followup question.
> >
> > When I add to src/Makevars the follwoing line
> >
> > FC=mpif90
> >
> > Rstudio ignores it when I click `Build and Reload`.  But, if I create a
> > Makevars file in a .R/ directory in my$HOME directory with that line,
> > Rstudio uses mpif90.
> >
> > Is the fact that R is ignoring the src/Makevars a bug? If not, am I doing
> > something wrong?
> >
>
> Ask differently: Does it say anywhere that the build process should use
> src/Makevars?
>
> Also notice that an important part of the package concept is that packages
> can be distributed. The recipient's Fortran compiler is not necessarily
> "mpif90". So, generally speaking, build configuration belongs in the build
> environment, not in the package.
>
> -pd
>
> > Thanks,
> >
> > Ignacio
> >
> >
> > PS: I hope this is the right place to ask this question.
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> Peter Dalgaard, Professor,
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>
>
>
>
>
>
>
>
>

	[[alternative HTML version deleted]]


From pdalgd at gmail.com  Mon Aug 10 20:35:37 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Mon, 10 Aug 2015 20:35:37 +0200
Subject: [R-pkg-devel] Bug? Makevars ignores FC=mpif90
In-Reply-To: <CAJA1VFw0PS_Ni1P1V5d1nyHBw3Zq_SvYmMA+=VT2e0C9uFBkWg@mail.gmail.com>
References: <CAJA1VFxmN0wNb5_mp-GCfZWg_ROZkGDr_dDWHH7RpLVQcqxQ+g@mail.gmail.com>
	<A1D63962-4F4A-46CA-ACF8-84AF4B9F9233@gmail.com>
	<CAJA1VFw0PS_Ni1P1V5d1nyHBw3Zq_SvYmMA+=VT2e0C9uFBkWg@mail.gmail.com>
Message-ID: <247F3B6E-3A31-477E-AF98-81A2B89CB575@gmail.com>


> On 10 Aug 2015, at 19:47 , Ignacio Martinez <ignacio82 at gmail.com> wrote:
> 
> Thanks peter.
> 
> 1. Does it say anywhere that the build process should use src/Makevars?
> I'm not sure, where should it say that? I'm using the default options in Rstudio to create a package

It actually is discussed in Writing R Extensions. (I was half-expecting it not to be there.)  But you should read it very carefully, in particular the sections about which variables you want to set in it, and which ones you do not.

In very concrete terms, notice that src/Makevars is read _before_ $RHOME/etc/Makeconf. The latter sets FC, so overwrites whatever it was set to in src/Makevars.

> 2. Also notice that an important part of the package concept is that packages can be distributed.
> The package that i want to build uses MPI. Is that a problem? My understanding is that in order to use MPI i have to set FC to mpif90. Is that wrong?

It's wrong (or at least not right) to set it in the package sources, because someone else might have to set FC differently.

> 3. build configuration belongs in the build environment
> I'm not sure if I follow. What is the correct way of telling Rstudio that the package i'm building uses MPI?

Wouldn't know. You already know how to do it by settings in a personal Makevars file. It is not obvious that there is a general way of specifying that one needs to use a special kind of compiler.

-pd

> Thanks again!
> 
> PS: This is the link to my question in stack-overflow
> 
> 
> 
> On Mon, Aug 10, 2015 at 1:41 PM peter dalgaard <pdalgd at gmail.com> wrote:
> 
> > On 10 Aug 2015, at 19:25 , Ignacio Martinez <ignacio82 at gmail.com> wrote:
> >
> > Hi,
> >
> > I'm learning to develop R packages that use Fortran (and MPI). I recently
> > asked a question on stack-overflow and I was told to contact this list with
> > a followup question.
> >
> > When I add to src/Makevars the follwoing line
> >
> > FC=mpif90
> >
> > Rstudio ignores it when I click `Build and Reload`.  But, if I create a
> > Makevars file in a .R/ directory in my$HOME directory with that line,
> > Rstudio uses mpif90.
> >
> > Is the fact that R is ignoring the src/Makevars a bug? If not, am I doing
> > something wrong?
> >
> 
> Ask differently: Does it say anywhere that the build process should use src/Makevars?
> 
> Also notice that an important part of the package concept is that packages can be distributed. The recipient's Fortran compiler is not necessarily "mpif90". So, generally speaking, build configuration belongs in the build environment, not in the package.
> 
> -pd
> 
> > Thanks,
> >
> > Ignacio
> >
> >
> > PS: I hope this is the right place to ask this question.
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> --
> Peter Dalgaard, Professor,
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> 
> 
> 
> 
> 
> 
> 
> 

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From csgillespie at gmail.com  Mon Aug 10 22:33:32 2015
From: csgillespie at gmail.com (Colin Gillespie)
Date: Mon, 10 Aug 2015 20:33:32 +0000
Subject: [R-pkg-devel] Visible bindings and reference classes
Message-ID: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>

Dear All,

I have a package that uses reference classes. When I build the package I
get numerous notes of the sort

Note: no visible binding for '<<-' assignment to 'pars'

I've tried using GlobalVariables, but that didn't solve the issue.

After some googling, I came across the page
http://stackoverflow.com/q/23475309/203420 which suggests

suppressBindingNotes <- function(variablesMentionedInNotes) {
  for(variable in variablesMentionedInNotes) {
    assign(variable,NULL, envir = .GlobalEnv)
  }
}
suppressBindingNotes(c("dat", "internal", "xmin", "pars", "no_pars"))

But checking the package with --as-cran raises the note

* checking R code for possible problems ... NOTE
Found the following assignments to the global environment:
  File ?poweRlaw/R/aaa_all_classes.R?:
  assign(variable, NULL, envir = .GlobalEnv)

What is the correct way of removing the "visible bindings" notes?

Thanks

Colin

	[[alternative HTML version deleted]]


From jonathan at mazamascience.com  Tue Aug 11 00:35:49 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Mon, 10 Aug 2015 15:35:49 -0700
Subject: [R-pkg-devel] dplyr usage inside another package
Message-ID: <CAPjNR=TA0p8p-JyjPbsBcX+_uRYbtCW-xFk0q7ZpOsSDowvFVA@mail.gmail.com>

Greetings,

I'm using dplyr inside of another package with examples like this:

data <- dplyr::filter(data, datetime >= trange[1], datetime <= trange[2])


When I run my package through R CMD check I get the following NOTES:

monitorSubsetData: no visible binding for global variable ?datetime?


I already have dplyr listed in the package Depends: section of the
DESCRIPTION.

I'm also encountering

no visible global function definition for ?matches?


when I try to use the dplyr internal function matches().

Is there any way to allow for dplyr syntactic sugar inside of my package or
do I need to be pedantic and say data$datetime in the first example and
dplyr::matches in the second? (Will dplyr::matches even work when it is not
an exported function?)

Thanks,

Jon

-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From ligges at statistik.tu-dortmund.de  Tue Aug 11 01:10:17 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 11 Aug 2015 01:10:17 +0200
Subject: [R-pkg-devel] dplyr usage inside another package
In-Reply-To: <CAPjNR=TA0p8p-JyjPbsBcX+_uRYbtCW-xFk0q7ZpOsSDowvFVA@mail.gmail.com>
References: <CAPjNR=TA0p8p-JyjPbsBcX+_uRYbtCW-xFk0q7ZpOsSDowvFVA@mail.gmail.com>
Message-ID: <55C92F59.5030707@statistik.tu-dortmund.de>

On 11.08.2015 00:35, Jonathan Callahan wrote:
> Greetings,
>
> I'm using dplyr inside of another package with examples like this:
>
> data <- dplyr::filter(data, datetime >= trange[1], datetime <= trange[2])
>
>
> When I run my package through R CMD check I get the following NOTES:
>
> monitorSubsetData: no visible binding for global variable ?datetime?
>
>
> I already have dplyr listed in the package Depends: section of the
> DESCRIPTION.
>
> I'm also encountering
>
> no visible global function definition for ?matches?
>
>
> when I try to use the dplyr internal function matches().
>
> Is there any way to allow for dplyr syntactic sugar inside of my package

You can, but this is non-standard reference to datetime the codetools do 
not anticipate and hence you need to declare it via globalVariables().


> or
> do I need to be pedantic and say data$datetime in the first example and
> dplyr::matches in the second? (Will dplyr::matches even work when it is not
> an exported function?)

If it is any package you use in private you can use triple colons. If 
you want the package to be published on CRAN, then you must not use 
non-exported functions (hence not in the API of the package).

Best,
Uwe Ligges


> Thanks,
>
> Jon
>


From jenny at stat.ubc.ca  Tue Aug 11 01:40:37 2015
From: jenny at stat.ubc.ca (Jennifer Bryan)
Date: Mon, 10 Aug 2015 16:40:37 -0700
Subject: [R-pkg-devel] dplyr usage inside another package
In-Reply-To: <CAPjNR=TA0p8p-JyjPbsBcX+_uRYbtCW-xFk0q7ZpOsSDowvFVA@mail.gmail.com>
References: <CAPjNR=TA0p8p-JyjPbsBcX+_uRYbtCW-xFk0q7ZpOsSDowvFVA@mail.gmail.com>
Message-ID: <1D88076F-071D-4C8F-A793-9C18E54FC815@stat.ubc.ca>

Hi Jonathan,

Re: this note: no visible binding for global variable ?datetime?

In programming and packages, it is recommended to use special versions of dplyr?s single table verbs, e.g., use `filter_()` as opposed to `filter()`. Note the underscore. The ?underscore? functions use standard evaluation instead of non-standard evaluation. This vignette contains more details:

https://cran.rstudio.com/web/packages/dplyr/vignettes/nse.html

HTH,
Jenny

> On Aug 10, 2015, at 3:35 PM, Jonathan Callahan <jonathan at mazamascience.com> wrote:
> 
> Greetings,
> 
> I'm using dplyr inside of another package with examples like this:
> 
> data <- dplyr::filter(data, datetime >= trange[1], datetime <= trange[2])
> 
> 
> When I run my package through R CMD check I get the following NOTES:
> 
> monitorSubsetData: no visible binding for global variable ?datetime?
> 
> 
> I already have dplyr listed in the package Depends: section of the
> DESCRIPTION.
> 
> I'm also encountering
> 
> no visible global function definition for ?matches?
> 
> 
> when I try to use the dplyr internal function matches().
> 
> Is there any way to allow for dplyr syntactic sugar inside of my package or
> do I need to be pedantic and say data$datetime in the first example and
> dplyr::matches in the second? (Will dplyr::matches even work when it is not
> an exported function?)
> 
> Thanks,
> 
> Jon
> 
> -- 
> Jonathan Callahan, PhD
> Mazama Science
> 206-708-5028
> mazamascience.com
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jonathan at mazamascience.com  Tue Aug 11 01:50:32 2015
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Mon, 10 Aug 2015 16:50:32 -0700
Subject: [R-pkg-devel] dplyr usage inside another package
In-Reply-To: <1D88076F-071D-4C8F-A793-9C18E54FC815@stat.ubc.ca>
References: <CAPjNR=TA0p8p-JyjPbsBcX+_uRYbtCW-xFk0q7ZpOsSDowvFVA@mail.gmail.com>
	<1D88076F-071D-4C8F-A793-9C18E54FC815@stat.ubc.ca>
Message-ID: <CAPjNR=S+d5VbtxTFamBivFb2uMWuJOhTuWbR5ipAqXjx0bpqJg@mail.gmail.com>

Thanks Jenny! Just the advice I was looking for.

On Mon, Aug 10, 2015 at 4:40 PM, Jennifer Bryan <jenny at stat.ubc.ca> wrote:

> Hi Jonathan,
>
> Re: this note: no visible binding for global variable ?datetime?
>
> In programming and packages, it is recommended to use special versions of
> dplyr?s single table verbs, e.g., use `filter_()` as opposed to `filter()`.
> Note the underscore. The ?underscore? functions use standard evaluation
> instead of non-standard evaluation. This vignette contains more details:
>
> https://cran.rstudio.com/web/packages/dplyr/vignettes/nse.html
>
> HTH,
> Jenny
>
> > On Aug 10, 2015, at 3:35 PM, Jonathan Callahan <
> jonathan at mazamascience.com> wrote:
> >
> > Greetings,
> >
> > I'm using dplyr inside of another package with examples like this:
> >
> > data <- dplyr::filter(data, datetime >= trange[1], datetime <= trange[2])
> >
> >
> > When I run my package through R CMD check I get the following NOTES:
> >
> > monitorSubsetData: no visible binding for global variable ?datetime?
> >
> >
> > I already have dplyr listed in the package Depends: section of the
> > DESCRIPTION.
> >
> > I'm also encountering
> >
> > no visible global function definition for ?matches?
> >
> >
> > when I try to use the dplyr internal function matches().
> >
> > Is there any way to allow for dplyr syntactic sugar inside of my package
> or
> > do I need to be pedantic and say data$datetime in the first example and
> > dplyr::matches in the second? (Will dplyr::matches even work when it is
> not
> > an exported function?)
> >
> > Thanks,
> >
> > Jon
> >
> > --
> > Jonathan Callahan, PhD
> > Mazama Science
> > 206-708-5028
> > mazamascience.com
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>


-- 
Jonathan Callahan, PhD
Mazama Science
206-708-5028
mazamascience.com

	[[alternative HTML version deleted]]


From glennmschultz at me.com  Tue Aug 11 04:09:49 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Tue, 11 Aug 2015 02:09:49 +0000 (GMT)
Subject: [R-pkg-devel]
 =?utf-8?q?Working_with_connections_-_What_is_correc?=
 =?utf-8?q?t=3F?=
Message-ID: <c7ebc203-0e88-496c-862e-29147a164a04@me.com>

All,
Is my function just plain wrong or is it just programming style? ?I use connections because SODA (software for data analysis) recommends using connections when working with serialized files. ?

First, after researching the use of return() - following Joshua's comment and others I found a post on SO regarding return().?http://stackoverflow.com/questions/11738823/explicitly-calling-return-in-a-function-or-not
Second, Hadley's point regarding the use of RDS in gz function being a little strange. Following the help files the function is fashioned after the following which I found in R help files:
## Less convenient ways to restore the object
## which demonstrate compatibility with unserialize()
con <- gzfile("women.rds", "rb")
identical(unserialize(con), women)
close(con)
con <- gzfile("women.rds", "rb")
wm <- readBin(con, "raw", n = 1e4) # size is a guess
close(con)
identical(unserialize(wm), women)

With respect to the first, I understand why my function would be considered "buggy" - that can be fixed. It is the case, generally speaking, one does not need return() when programming in R; it is a functional language. ?However, some use return() and one finds return(value) in the R help files. ?Is it a strict no-no to use return()??

With respect to the second,?The function can be refactored and reduced to readRDS(). ?My question, is using gz file overkill or just plain wrong??
What is considered "best practice"?

-Glenn


On Aug 09, 2015, at 09:04 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:

On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com> wrote:
Hi All,

I use connections to open and close data folders needed by my package.
After each function closes I get the following warnings (depending on the
connection that has been opened).

10: closing unused connection 3
(/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)

Below is the connection function that is related to the above warning:

#------------------------------------------------------------------------------------
#' A connection function to BondData calling MBS cusps
#'
#' Opens a connection to the BondData folder to call MBS cusip data
#' @param MBS.id A character string the MBS.id or cusip number current
MBS.id is supported
#' @export
MBS <- function(MBS.id = "character"){
MBS.Conn <- gzfile(description = paste(system.file(package
= "BondLab"),
"/BondData/", MBS.id, ".rds", sep = ""), open
= "rb")
MBS <- readRDS(MBS.Conn)
return(MBS)
close.connection(MBS.Conn)
}

I have googled this warning and it seems to be triggered when a function
terminates and the connection is open. But, I think the connection function
closes the connection once the object is returned. What am I doing wrong?

Your call to return() exits the function, so the close.connection()
call is never evaluated. Considering using on.exit() to close the
connection, since it will close the connection regardless of how the
function exits (e.g. because of an error).

-Glenn
______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Joshua Ulrich | about.me/joshuaulrich
FOSS Trading | http://www.fosstrading.com

From edd at debian.org  Tue Aug 11 04:59:22 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 10 Aug 2015 21:59:22 -0500
Subject: [R-pkg-devel] Working with connections - What is correct?
In-Reply-To: <c7ebc203-0e88-496c-862e-29147a164a04@me.com>
References: <c7ebc203-0e88-496c-862e-29147a164a04@me.com>
Message-ID: <21961.25866.662153.526216@max.nulle.part>


On 11 August 2015 at 02:09, Glenn Schultz wrote:
| All,
| Is my function just plain wrong or is it just programming style? ?I use connections because SODA (software for data analysis) recommends using connections when working with serialized files. ?

Nothing wrong with connections. Many of us use them.

| First, after researching the use of return() - following Joshua's comment and others I found a post on SO regarding return().?http://stackoverflow.com/questions/11738823/explicitly-calling-return-in-a-function-or-not

Let's try once more. The function foo()

    foo <- function() {
       x <- 2
       return(x)
       x <- 3
    }

will return what value? Ie what does 'print(foo())' show?

| Second, Hadley's point regarding the use of RDS in gz function being a little strange. Following the help files the function is fashioned after the following which I found in R help files:

IIRC what Hadley was trying to say what you do _not_ need to compress before
inserting into a rds file as the rds file format compresses by default.

In other words compression comes for free, and effortlessly so.

Hth,  Dirk

| ## Less convenient ways to restore the object
| ## which demonstrate compatibility with unserialize()
| con <- gzfile("women.rds", "rb")
| identical(unserialize(con), women)
| close(con)
| con <- gzfile("women.rds", "rb")
| wm <- readBin(con, "raw", n = 1e4) # size is a guess
| close(con)
| identical(unserialize(wm), women)
| 
| With respect to the first, I understand why my function would be considered "buggy" - that can be fixed. It is the case, generally speaking, one does not need return() when programming in R; it is a functional language. ?However, some use return() and one finds return(value) in the R help files. ?Is it a strict no-no to use return()??
| 
| With respect to the second,?The function can be refactored and reduced to readRDS(). ?My question, is using gz file overkill or just plain wrong??
| What is considered "best practice"?
| 
| -Glenn
| 
| 
| On Aug 09, 2015, at 09:04 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
| 
| On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com> wrote:
| Hi All,
| 
| I use connections to open and close data folders needed by my package.
| After each function closes I get the following warnings (depending on the
| connection that has been opened).
| 
| 10: closing unused connection 3
| (/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)
| 
| Below is the connection function that is related to the above warning:
| 
| #------------------------------------------------------------------------------------
| #' A connection function to BondData calling MBS cusps
| #'
| #' Opens a connection to the BondData folder to call MBS cusip data
| #' @param MBS.id A character string the MBS.id or cusip number current
| MBS.id is supported
| #' @export
| MBS <- function(MBS.id = "character"){
| MBS.Conn <- gzfile(description = paste(system.file(package
| = "BondLab"),
| "/BondData/", MBS.id, ".rds", sep = ""), open
| = "rb")
| MBS <- readRDS(MBS.Conn)
| return(MBS)
| close.connection(MBS.Conn)
| }
| 
| I have googled this warning and it seems to be triggered when a function
| terminates and the connection is open. But, I think the connection function
| closes the connection once the object is returned. What am I doing wrong?
| 
| Your call to return() exits the function, so the close.connection()
| call is never evaluated. Considering using on.exit() to close the
| connection, since it will close the connection regardless of how the
| function exits (e.g. because of an error).
| 
| -Glenn
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel
| 
| 
| 
| -- 
| Joshua Ulrich | about.me/joshuaulrich
| FOSS Trading | http://www.fosstrading.com
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From glennmschultz at me.com  Tue Aug 11 05:18:56 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Tue, 11 Aug 2015 03:18:56 +0000 (GMT)
Subject: [R-pkg-devel]
 =?utf-8?q?Working_with_connections_-_What_is_correc?=
 =?utf-8?q?t=3F?=
Message-ID: <c640cc10-fe4d-49d4-bc2b-2a032f69fec0@me.com>

Hi Dirk,
Thanks for your response, I get the point on return(). For me, it is a security blanket - I just need to let that go rather than justify keeping it. I will refactor the connections and just get comfortable without return().

Thanks,
Glenn?

On Aug 10, 2015, at 09:59 PM, Dirk Eddelbuettel <edd at debian.org> wrote:


On 11 August 2015 at 02:09, Glenn Schultz wrote:
| All,
| Is my function just plain wrong or is it just programming style? ?I use connections because SODA (software for data analysis) recommends using connections when working with serialized files. ?

Nothing wrong with connections. Many of us use them.

| First, after researching the use of return() - following Joshua's comment and others I found a post on SO regarding return().?http://stackoverflow.com/questions/11738823/explicitly-calling-return-in-a-function-or-not

Let's try once more. The function foo()

foo <- function() {
x <- 2
return(x)
x <- 3
}

will return what value? Ie what does 'print(foo())' show?

| Second, Hadley's point regarding the use of RDS in gz function being a little strange. Following the help files the function is fashioned after the following which I found in R help files:

IIRC what Hadley was trying to say what you do _not_ need to compress before
inserting into a rds file as the rds file format compresses by default.

In other words compression comes for free, and effortlessly so.

Hth, Dirk

| ## Less convenient ways to restore the object
| ## which demonstrate compatibility with unserialize()
| con <- gzfile("women.rds", "rb")
| identical(unserialize(con), women)
| close(con)
| con <- gzfile("women.rds", "rb")
| wm <- readBin(con, "raw", n = 1e4) # size is a guess
| close(con)
| identical(unserialize(wm), women)
| 
| With respect to the first, I understand why my function would be considered "buggy" - that can be fixed. It is the case, generally speaking, one does not need return() when programming in R; it is a functional language. ?However, some use return() and one finds return(value) in the R help files. ?Is it a strict no-no to use return()??
| 
| With respect to the second,?The function can be refactored and reduced to readRDS(). ?My question, is using gz file overkill or just plain wrong??
| What is considered "best practice"?
| 
| -Glenn
| 
| 
| On Aug 09, 2015, at 09:04 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
| 
| On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com> wrote:
| Hi All,
| 
| I use connections to open and close data folders needed by my package.
| After each function closes I get the following warnings (depending on the
| connection that has been opened).
| 
| 10: closing unused connection 3
| (/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)
| 
| Below is the connection function that is related to the above warning:
| 
| #------------------------------------------------------------------------------------
| #' A connection function to BondData calling MBS cusps
| #'
| #' Opens a connection to the BondData folder to call MBS cusip data
| #' @param MBS.id A character string the MBS.id or cusip number current
| MBS.id is supported
| #' @export
| MBS <- function(MBS.id = "character"){
| MBS.Conn <- gzfile(description = paste(system.file(package
| = "BondLab"),
| "/BondData/", MBS.id, ".rds", sep = ""), open
| = "rb")
| MBS <- readRDS(MBS.Conn)
| return(MBS)
| close.connection(MBS.Conn)
| }
| 
| I have googled this warning and it seems to be triggered when a function
| terminates and the connection is open. But, I think the connection function
| closes the connection once the object is returned. What am I doing wrong?
| 
| Your call to return() exits the function, so the close.connection()
| call is never evaluated. Considering using on.exit() to close the
| connection, since it will close the connection regardless of how the
| function exits (e.g. because of an error).
| 
| -Glenn
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel
| 
| 
| 
| -- 
| Joshua Ulrich | about.me/joshuaulrich
| FOSS Trading | http://www.fosstrading.com
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

From josh.m.ulrich at gmail.com  Tue Aug 11 13:11:18 2015
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Tue, 11 Aug 2015 06:11:18 -0500
Subject: [R-pkg-devel] Working with connections - What is correct?
In-Reply-To: <c640cc10-fe4d-49d4-bc2b-2a032f69fec0@me.com>
References: <c640cc10-fe4d-49d4-bc2b-2a032f69fec0@me.com>
Message-ID: <CAPPM_gQ9qWGDY8Nr6sWbwDzr5oRe9jAw4pDjg5tS4A6twiFPrw@mail.gmail.com>

On Mon, Aug 10, 2015 at 10:18 PM, Glenn Schultz <glennmschultz at me.com> wrote:
> Hi Dirk,
> Thanks for your response, I get the point on return(). For me, it is a
> security blanket - I just need to let that go rather than justify keeping
> it. I will refactor the connections and just get comfortable without
> return().
>
I'm not sure you get Dirk's point about return(). He did not suggest
that you avoid using return(). He provided a simple example to
illustrate that code in a function body that occurs after a call to
return() is not evaluated.  There is nothing inherently wrong with
using return().  The only thing that was wrong was how you used it.

> Thanks,
> Glenn
>
>
> On Aug 10, 2015, at 09:59 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
>
> On 11 August 2015 at 02:09, Glenn Schultz wrote:
> | All,
> | Is my function just plain wrong or is it just programming style?  I use
> connections because SODA (software for data analysis) recommends using
> connections when working with serialized files.
>
> Nothing wrong with connections. Many of us use them.
>
> | First, after researching the use of return() - following Joshua's comment
> and others I found a post on SO regarding return().
> http://stackoverflow.com/questions/11738823/explicitly-calling-return-in-a-function-or-not
>
> Let's try once more. The function foo()
>
> foo <- function() {
> x <- 2
> return(x)
> x <- 3
> }
>
> will return what value? Ie what does 'print(foo())' show?
>
> | Second, Hadley's point regarding the use of RDS in gz function being a
> little strange. Following the help files the function is fashioned after the
> following which I found in R help files:
>
> IIRC what Hadley was trying to say what you do _not_ need to compress before
> inserting into a rds file as the rds file format compresses by default.
>
> In other words compression comes for free, and effortlessly so.
>
> Hth, Dirk
>
> | ## Less convenient ways to restore the object
> | ## which demonstrate compatibility with unserialize()
> | con <- gzfile("women.rds", "rb")
> | identical(unserialize(con), women)
> | close(con)
> | con <- gzfile("women.rds", "rb")
> | wm <- readBin(con, "raw", n = 1e4) # size is a guess
> | close(con)
> | identical(unserialize(wm), women)
> | | With respect to the first, I understand why my function would be
> considered "buggy" - that can be fixed. It is the case, generally speaking,
> one does not need return() when programming in R; it is a functional
> language.  However, some use return() and one finds return(value) in the R
> help files.  Is it a strict no-no to use return()?
> | | With respect to the second, The function can be refactored and reduced
> to readRDS().  My question, is using gz file overkill or just plain wrong?
> | What is considered "best practice"?
> | | -Glenn
> | | | On Aug 09, 2015, at 09:04 AM, Joshua Ulrich <josh.m.ulrich at gmail.com>
> wrote:
> | | On Sun, Aug 9, 2015 at 8:59 AM, Glenn Schultz <glennmschultz at me.com>
> wrote:
> | Hi All,
> | | I use connections to open and close data folders needed by my package.
> | After each function closes I get the following warnings (depending on the
> | connection that has been opened).
> | | 10: closing unused connection 3
> |
> (/Library/Frameworks/R.framework/Versions/3.2/Resources/library/BondLab/BondData/bondlabMBS4.rds)
> | | Below is the connection function that is related to the above warning:
> | |
> #------------------------------------------------------------------------------------
> | #' A connection function to BondData calling MBS cusps
> | #'
> | #' Opens a connection to the BondData folder to call MBS cusip data
> | #' @param MBS.id A character string the MBS.id or cusip number current
> | MBS.id is supported
> | #' @export
> | MBS <- function(MBS.id = "character"){
> | MBS.Conn <- gzfile(description = paste(system.file(package
> | = "BondLab"),
> | "/BondData/", MBS.id, ".rds", sep = ""), open
> | = "rb")
> | MBS <- readRDS(MBS.Conn)
> | return(MBS)
> | close.connection(MBS.Conn)
> | }
> | | I have googled this warning and it seems to be triggered when a function
> | terminates and the connection is open. But, I think the connection
> function
> | closes the connection once the object is returned. What am I doing wrong?
> | | Your call to return() exits the function, so the close.connection()
> | call is never evaluated. Considering using on.exit() to close the
> | connection, since it will close the connection regardless of how the
> | function exits (e.g. because of an error).
> | | -Glenn
> | ______________________________________________
> | R-package-devel at r-project.org mailing list
> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
> | | | | -- | Joshua Ulrich | about.me/joshuaulrich
> | FOSS Trading | http://www.fosstrading.com
> | ______________________________________________
> | R-package-devel at r-project.org mailing list
> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From maechler at stat.math.ethz.ch  Tue Aug 11 13:24:12 2015
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Aug 2015 13:24:12 +0200
Subject: [R-pkg-devel] Visible bindings and reference classes
In-Reply-To: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>
References: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>
Message-ID: <21961.56156.246929.329540@stat.math.ethz.ch>

>>>>> Colin Gillespie <csgillespie at gmail.com>
>>>>>     on Mon, 10 Aug 2015 20:33:32 +0000 writes:

> Dear All,
> 
> I have a package that uses reference classes. When I build the package I
> get numerous notes of the sort
> 
> Note: no visible binding for '<<-' assignment to 'pars'
> 
> I've tried using GlobalVariables, but that didn't solve the issue.

[ You mean globalVariables(): and it's a bad idea anyway IMO, 
  even if it is recommended : If you declare a variable in
  there, it is "global" in all places in your package and the
  codetools won't report it anywhere anymore.
  Much better in my view is to use something like

  var7 <- NULL # ~= globalVariables("var7")
 
]

To your question:

Reference classes are used in *many* places,  and the use of  ' <<- '
is really "standard" there.
e.g., package 'lme4', or 'pcalg' are two packages I'm involved with,
which use ref.classes and ' <<- '  but are "fine" with that.

So there must be something peculiar in your package leading to
the  <<-  warnings.

Maybe you should look into the source code of such other CRAN
packages to see how "they" do it differently than you.

Best regards,
Martin

Martin Maechler, ETH Zurich


> After some googling, I came across the page
> http://stackoverflow.com/q/23475309/203420 which suggests
> 
> suppressBindingNotes <- function(variablesMentionedInNotes) {
>   for(variable in variablesMentionedInNotes) {
>     assign(variable,NULL, envir = .GlobalEnv)
>   }
> }
> suppressBindingNotes(c("dat", "internal", "xmin", "pars", "no_pars"))
> 
> But checking the package with --as-cran raises the note
> 
> * checking R code for possible problems ... NOTE
> Found the following assignments to the global environment:
>   File ?poweRlaw/R/aaa_all_classes.R?:
>   assign(variable, NULL, envir = .GlobalEnv)
> 
> What is the correct way of removing the "visible bindings" notes?
> 
> Thanks
> 
> Colin
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From csgillespie at gmail.com  Tue Aug 11 15:32:39 2015
From: csgillespie at gmail.com (Colin Gillespie)
Date: Tue, 11 Aug 2015 13:32:39 +0000
Subject: [R-pkg-devel] Visible bindings and reference classes
In-Reply-To: <21961.56156.246929.329540@stat.math.ethz.ch>
References: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>
	<21961.56156.246929.329540@stat.math.ethz.ch>
Message-ID: <CADbDLZ=MTbGW8HnZo5BebTW4QBB7Cuk0XM0-JdZrvicdb5z8aQ@mail.gmail.com>

>
>
> To your question:
>
> Reference classes are used in *many* places,  and the use of  ' <<- '
> is really "standard" there.
> e.g., package 'lme4', or 'pcalg' are two packages I'm involved with,
> which use ref.classes and ' <<- '  but are "fine" with that.
>
> So there must be something peculiar in your package leading to
> the  <<-  warnings.
>

After a bit more investigating I've narrowed it down.  The notes can be
generated by having

d1 = setRefClass("d1", fields=list(x = "numeric"))
d1$accessors("x")

**and** having ByteCompile: true. Commenting out the accessors line removes
the visible binding note. The  x=NULL  or globalVariables("x") trick
doesn't work.

A stackoverflow answer suggests that I need to add

assign(variable,NULL, envir = .GlobalEnv)

but this generates a new NOTE under R CMD check

I've not been able to find another package that uses accessors and
ByteCompile

Thanks

Colin










>
> Maybe you should look into the source code of such other CRAN
> packages to see how "they" do it differently than you.
>
> Best regards,
> Martin
>
> Martin Maechler, ETH Zurich
>
>
> > After some googling, I came across the page
> > http://stackoverflow.com/q/23475309/203420 which suggests
> >
> > suppressBindingNotes <- function(variablesMentionedInNotes) {
> >   for(variable in variablesMentionedInNotes) {
> >     assign(variable,NULL, envir = .GlobalEnv)
> >   }
> > }
> > suppressBindingNotes(c("dat", "internal", "xmin", "pars", "no_pars"))
> >
> > But checking the package with --as-cran raises the note
> >
> > * checking R code for possible problems ... NOTE
> > Found the following assignments to the global environment:
> >   File ?poweRlaw/R/aaa_all_classes.R?:
> >   assign(variable, NULL, envir = .GlobalEnv)
> >
> > What is the correct way of removing the "visible bindings" notes?
> >
> > Thanks
> >
> > Colin
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From wdunlap at tibco.com  Tue Aug 11 17:47:23 2015
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 11 Aug 2015 08:47:23 -0700
Subject: [R-pkg-devel] Visible bindings and reference classes
In-Reply-To: <21961.56156.246929.329540@stat.math.ethz.ch>
References: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>
	<21961.56156.246929.329540@stat.math.ethz.ch>
Message-ID: <CAF8bMcbfqoWJ7DTk3hf0qWdgqHBS=j+JzAdK4hg9q_NHzqU6Dw@mail.gmail.com>

This is a problem in the compiler package.  Here is a way to reproduce it:

def <- quote(Config <- setRefClass("Config",
    fields = list(
        ConfigString = "character"),
    methods = list(
        # Constructor
        initialize = function() {
            ConfigString <<- "Hello, World!"
        })
))
dput(def, file= (tf <- tempfile()))
compiler::cmpfile(tf)
#Note: no visible binding for '<<-' assignment to 'ConfigString'
saving to file
#"C:\Users\wdunlap\AppData\Local\Temp\Rtmpk91qvT\file26d447c45b81.Rc" ...
done




Bill Dunlap
TIBCO Software
wdunlap tibco.com

On Tue, Aug 11, 2015 at 4:24 AM, Martin Maechler <maechler at stat.math.ethz.ch
> wrote:

> >>>>> Colin Gillespie <csgillespie at gmail.com>
> >>>>>     on Mon, 10 Aug 2015 20:33:32 +0000 writes:
>
> > Dear All,
> >
> > I have a package that uses reference classes. When I build the package I
> > get numerous notes of the sort
> >
> > Note: no visible binding for '<<-' assignment to 'pars'
> >
> > I've tried using GlobalVariables, but that didn't solve the issue.
>
> [ You mean globalVariables(): and it's a bad idea anyway IMO,
>   even if it is recommended : If you declare a variable in
>   there, it is "global" in all places in your package and the
>   codetools won't report it anywhere anymore.
>   Much better in my view is to use something like
>
>   var7 <- NULL # ~= globalVariables("var7")
>
> ]
>
> To your question:
>
> Reference classes are used in *many* places,  and the use of  ' <<- '
> is really "standard" there.
> e.g., package 'lme4', or 'pcalg' are two packages I'm involved with,
> which use ref.classes and ' <<- '  but are "fine" with that.
>
> So there must be something peculiar in your package leading to
> the  <<-  warnings.
>
> Maybe you should look into the source code of such other CRAN
> packages to see how "they" do it differently than you.
>
> Best regards,
> Martin
>
> Martin Maechler, ETH Zurich
>
>
> > After some googling, I came across the page
> > http://stackoverflow.com/q/23475309/203420 which suggests
> >
> > suppressBindingNotes <- function(variablesMentionedInNotes) {
> >   for(variable in variablesMentionedInNotes) {
> >     assign(variable,NULL, envir = .GlobalEnv)
> >   }
> > }
> > suppressBindingNotes(c("dat", "internal", "xmin", "pars", "no_pars"))
> >
> > But checking the package with --as-cran raises the note
> >
> > * checking R code for possible problems ... NOTE
> > Found the following assignments to the global environment:
> >   File ?poweRlaw/R/aaa_all_classes.R?:
> >   assign(variable, NULL, envir = .GlobalEnv)
> >
> > What is the correct way of removing the "visible bindings" notes?
> >
> > Thanks
> >
> > Colin
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From wdunlap at tibco.com  Tue Aug 11 18:04:27 2015
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 11 Aug 2015 09:04:27 -0700
Subject: [R-pkg-devel] Visible bindings and reference classes
In-Reply-To: <CAF8bMcbfqoWJ7DTk3hf0qWdgqHBS=j+JzAdK4hg9q_NHzqU6Dw@mail.gmail.com>
References: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>
	<21961.56156.246929.329540@stat.math.ethz.ch>
	<CAF8bMcbfqoWJ7DTk3hf0qWdgqHBS=j+JzAdK4hg9q_NHzqU6Dw@mail.gmail.com>
Message-ID: <CAF8bMcYSioLVEb8cnLYjZazBwVRnoqWpvS3DpTrWnwuj9KMh6w@mail.gmail.com>

You can avoid the temporary file by replacing
  dput(def, file= (tf <- tempfile()))
  compiler::cmpfile(tf)
with
  cdef <- compiler::compile(def)
  #Note: no visible binding for '<<-' assignment to 'ConfigString'
The compiled code appears to work.
  eval(cdef)
  c1 <- Config$new()
  c1
  #Reference class object of class "Config"
  #Field "ConfigString":
  #[1] "Hello, World!"
  > objects(all=TRUE)
  #[1] ".__C__Config"           ".__global__"
  #[3] ".requireCachedGenerics" "c1"
  #[5] "cdef"                   "Config"
  #[7] "def"


Bill Dunlap
TIBCO Software
wdunlap tibco.com

On Tue, Aug 11, 2015 at 8:47 AM, William Dunlap <wdunlap at tibco.com> wrote:

> This is a problem in the compiler package.  Here is a way to reproduce it:
>
> def <- quote(Config <- setRefClass("Config",
>     fields = list(
>         ConfigString = "character"),
>     methods = list(
>         # Constructor
>         initialize = function() {
>             ConfigString <<- "Hello, World!"
>         })
> ))
> dput(def, file= (tf <- tempfile()))
> compiler::cmpfile(tf)
> #Note: no visible binding for '<<-' assignment to 'ConfigString'
> saving to file
> #"C:\Users\wdunlap\AppData\Local\Temp\Rtmpk91qvT\file26d447c45b81.Rc" ...
> done
>
>
>
>
> Bill Dunlap
> TIBCO Software
> wdunlap tibco.com
>
> On Tue, Aug 11, 2015 at 4:24 AM, Martin Maechler <
> maechler at stat.math.ethz.ch> wrote:
>
>> >>>>> Colin Gillespie <csgillespie at gmail.com>
>> >>>>>     on Mon, 10 Aug 2015 20:33:32 +0000 writes:
>>
>> > Dear All,
>> >
>> > I have a package that uses reference classes. When I build the package I
>> > get numerous notes of the sort
>> >
>> > Note: no visible binding for '<<-' assignment to 'pars'
>> >
>> > I've tried using GlobalVariables, but that didn't solve the issue.
>>
>> [ You mean globalVariables(): and it's a bad idea anyway IMO,
>>   even if it is recommended : If you declare a variable in
>>   there, it is "global" in all places in your package and the
>>   codetools won't report it anywhere anymore.
>>   Much better in my view is to use something like
>>
>>   var7 <- NULL # ~= globalVariables("var7")
>>
>> ]
>>
>> To your question:
>>
>> Reference classes are used in *many* places,  and the use of  ' <<- '
>> is really "standard" there.
>> e.g., package 'lme4', or 'pcalg' are two packages I'm involved with,
>> which use ref.classes and ' <<- '  but are "fine" with that.
>>
>> So there must be something peculiar in your package leading to
>> the  <<-  warnings.
>>
>> Maybe you should look into the source code of such other CRAN
>> packages to see how "they" do it differently than you.
>>
>> Best regards,
>> Martin
>>
>> Martin Maechler, ETH Zurich
>>
>>
>> > After some googling, I came across the page
>> > http://stackoverflow.com/q/23475309/203420 which suggests
>> >
>> > suppressBindingNotes <- function(variablesMentionedInNotes) {
>> >   for(variable in variablesMentionedInNotes) {
>> >     assign(variable,NULL, envir = .GlobalEnv)
>> >   }
>> > }
>> > suppressBindingNotes(c("dat", "internal", "xmin", "pars", "no_pars"))
>> >
>> > But checking the package with --as-cran raises the note
>> >
>> > * checking R code for possible problems ... NOTE
>> > Found the following assignments to the global environment:
>> >   File ?poweRlaw/R/aaa_all_classes.R?:
>> >   assign(variable, NULL, envir = .GlobalEnv)
>> >
>> > What is the correct way of removing the "visible bindings" notes?
>> >
>> > Thanks
>> >
>> > Colin
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
>

	[[alternative HTML version deleted]]


From cdetermanjr at gmail.com  Tue Aug 11 18:49:10 2015
From: cdetermanjr at gmail.com (Charles Determan)
Date: Tue, 11 Aug 2015 11:49:10 -0500
Subject: [R-pkg-devel] CRAN submission which requires third party software?
Message-ID: <CAKxd1KNLvdQ7ojZP81xadyNrEy3otXuhmNtrYwX-Vyne17Gaag@mail.gmail.com>

I am beginning to reach the completion of a new package I would like to
submit to CRAN.  However, there are a few aspects of it that I would like
some guidance prior to submitting.

1. It requires some third party software (i.e. an OpenCL SDK) to be
installed before it will compile (it contains c++ code).  As such, I don't
believe it would build successfully when submitted to CRAN.  I can verify
it builds and tests successfully on Travis CI but not sure how CRAN would
approach this.

2. It requires a support package which is another header only package which
mirrors the structure of BH.

I know this has been accomplished by some other packages like gputools (
https://cran.r-project.org/web/packages/gputools/index.html) which requires
the CUDA toolkit to be installed.  I also don't know how to approach the
companion package submission (i.e. that others could use just like the BH
package).

Anyone have any recommendations on how I should prepare for submitting this
package.

Thank you,
Charles

	[[alternative HTML version deleted]]


From edd at debian.org  Tue Aug 11 19:13:34 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 11 Aug 2015 12:13:34 -0500
Subject: [R-pkg-devel] CRAN submission which requires third party
	software?
In-Reply-To: <CAKxd1KNLvdQ7ojZP81xadyNrEy3otXuhmNtrYwX-Vyne17Gaag@mail.gmail.com>
References: <CAKxd1KNLvdQ7ojZP81xadyNrEy3otXuhmNtrYwX-Vyne17Gaag@mail.gmail.com>
Message-ID: <21962.11582.616805.282524@max.nulle.part>


On 11 August 2015 at 11:49, Charles Determan wrote:
| I am beginning to reach the completion of a new package I would like to
| submit to CRAN.  However, there are a few aspects of it that I would like
| some guidance prior to submitting.
| 
| 1. It requires some third party software (i.e. an OpenCL SDK) to be
| installed before it will compile (it contains c++ code).  As such, I don't
| believe it would build successfully when submitted to CRAN.  I can verify
| it builds and tests successfully on Travis CI but not sure how CRAN would
| approach this.

So you are saying it needs _new tools to build_ it?  That may be tough.

| 2. It requires a support package which is another header only package which
| mirrors the structure of BH.

I see no difficulty with this part.

Dirk

| I know this has been accomplished by some other packages like gputools (
| https://cran.r-project.org/web/packages/gputools/index.html) which requires
| the CUDA toolkit to be installed.  I also don't know how to approach the
| companion package submission (i.e. that others could use just like the BH
| package).
| 
| Anyone have any recommendations on how I should prepare for submitting this
| package.
| 
| Thank you,
| Charles
| 
| 	[[alternative HTML version deleted]]
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ignacio82 at gmail.com  Tue Aug 11 19:32:13 2015
From: ignacio82 at gmail.com (Ignacio Martinez)
Date: Tue, 11 Aug 2015 17:32:13 +0000
Subject: [R-pkg-devel] not resolved from current namespace error
Message-ID: <CAJA1VFwN17KJXMipg78dPF_mNJ+XYNDP2HTYZUWw7vgn63VMhQ@mail.gmail.com>

I'm trying to create a package that uses a MPI Fortran module. I have a working
version <https://github.com/ignacio82/MyPi> of that package that uses a
Fortran module without MPI.

When I run the function `FMPIpi(DARTS = 5000, ROUNDS = 100, cores=2)` I get
the following errors:

> FMPIpi(DARTS = 5000, ROUNDS = 100, cores=2)
2 slaves are spawned successfully. 0 failed.
master (rank 0, comm 1) of size 3 is running on: 2d60fd60575b
slave1 (rank 1, comm 1) of size 3 is running on: 2d60fd60575b
slave2 (rank 2, comm 1) of size 3 is running on: 2d60fd60575b
Error in .Fortran("MPIpi", avepi = as.numeric(1), DARTS =
as.integer(DARTS),  :
 "mpipi" not resolved from current namespace (MyPi)

It looks like something is wrong in my NAMESPACE. This is what I have there:

export(Pibenchmark)
export(Fpi)
export(FMPIpi)
export(Rpi)
useDynLib(MyPi)
exportPattern("^[[:alpha:]]+")
This is my Fortran module:

Module Fortranpi
USE MPI
IMPLICIT NONE
contains
subroutine dboard(darts, dartsscore)
 integer, intent(in)                    :: darts
 double precision, intent(out)          :: dartsscore
 double precision                       :: x_coord, y_coord
 integer                                :: score, n

score = 0
do n = 1, darts
 call random_number(x_coord)
 call random_number(y_coord)

 if ((x_coord**2 + y_coord**2) <= 1.0d0) then
 score = score + 1
 end if
end do

dartsscore = 4.0d0*score/darts

end subroutine dboard

subroutine pi(avepi, DARTS, ROUNDS) bind(C, name="pi_")
 use, intrinsic                         :: iso_c_binding, only : c_double,
c_int
 real(c_double), intent(out)            ::  avepi
 integer(c_int), intent(in)             ::  DARTS, ROUNDS
 integer                                ::  MASTER, rank, i, n
 integer, allocatable                   ::  seed(:)
 double precision                       ::  pi_est, homepi, pirecv, pisum

! we set it to zero in the sequential run
rank = 0
! initialize the random number generator
! we make sure the seed is different for each task
call random_seed()
call random_seed(size = n)
allocate(seed(n))
seed = 12 + rank*11
call random_seed(put=seed(1:n))
deallocate(seed)

avepi = 0
do i = 0, ROUNDS-1
 call dboard(darts, pi_est)
 ! calculate the average value of pi over all iterations
 avepi = ((avepi*i) + pi_est)/(i + 1)
end do
end subroutine pi


subroutine MPIpi(avepi, DARTS, ROUNDS) bind(C, name="MPIpi_")
use, intrinsic                         :: iso_c_binding, only : c_double,
c_int
real(c_double), intent(out)            :: avepi
integer(c_int), intent(in)             :: DARTS, ROUNDS
integer                                :: i, n, mynpts, ierr, numprocs,
proc_num
integer, allocatable                   :: seed(:)
double precision                       :: pi_est, y, sumpi

 call mpi_init(ierr)
 call mpi_comm_size(MPI_COMM_WORLD, numprocs, ierr)
 call mpi_comm_rank(MPI_COMM_WORLD, proc_num, ierr)

 if (numprocs .eq. 0) then
mynpts = ROUNDS - (numprocs-1)*(ROUNDS/numprocs)
 else
mynpts = ROUNDS/numprocs
 endif

 ! initialize the random number generator
 ! we make sure the seed is different for each task
 call random_seed()
 call random_seed(size = n)
 allocate(seed(n))
 seed = 12 + proc_num*11
 call random_seed(put=seed(1:n))
 deallocate(seed)

 y=0.0d0
do i = 1, mynpts
call dboard(darts, pi_est)
y = y + pi_est
 end do

 call mpi_reduce(y, sumpi, 1, mpi_double_precision, mpi_sum, 0, &
 mpi_comm_world, ierr)
 if (proc_num==0) avepi = sumpi/ROUNDS
 call mpi_finalize(ierr)
end subroutine MPIpi

end module Fortranpi
and this is my R function

#'@export
FMPIpi <- function(DARTS, ROUNDS, cores) {
 Rmpi::mpi.spawn.Rslaves(nslaves=cores)
 retvals <- .Fortran("MPIpi", avepi = as.numeric(1), DARTS =
 as.integer(DARTS), ROUNDS =  as.integer(ROUNDS))
 return(retvals$avepi)
}

What am I doing wrong?

Thanks a lot!

Ignacio

	[[alternative HTML version deleted]]


From thomas.wainwright at noaa.gov  Tue Aug 11 20:21:03 2015
From: thomas.wainwright at noaa.gov (Tom Wainwright)
Date: Tue, 11 Aug 2015 11:21:03 -0700
Subject: [R-pkg-devel] not resolved from current namespace error
In-Reply-To: <CAJA1VFwN17KJXMipg78dPF_mNJ+XYNDP2HTYZUWw7vgn63VMhQ@mail.gmail.com>
References: <CAJA1VFwN17KJXMipg78dPF_mNJ+XYNDP2HTYZUWw7vgn63VMhQ@mail.gmail.com>
Message-ID: <CAPw7dZGHE4RXChsygBh-Qwcat2pahbunn=WAyyie1t2Q0Pjb9A@mail.gmail.com>

Not sure, but your problem might be answered in the .Fortran() help page:

All Fortran compilers known to be usable to compile R map symbol names to
> lower case, and so does .Fortran.
>

I've been caught by that before, and found that using all lowercase names
for Fortran routines in R is safest.

Tom Wainwright

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The contents of this message are mine personally and do not
necessarily reflect any position of the Government or the
National Oceanic and Atmospheric Administration.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


On Tue, Aug 11, 2015 at 10:32 AM, Ignacio Martinez <ignacio82 at gmail.com>
wrote:

> I'm trying to create a package that uses a MPI Fortran module. I have a
> working
> version <https://github.com/ignacio82/MyPi> of that package that uses a
> Fortran module without MPI.
>
> When I run the function `FMPIpi(DARTS = 5000, ROUNDS = 100, cores=2)` I get
> the following errors:
>
> > FMPIpi(DARTS = 5000, ROUNDS = 100, cores=2)
> 2 slaves are spawned successfully. 0 failed.
> master (rank 0, comm 1) of size 3 is running on: 2d60fd60575b
> slave1 (rank 1, comm 1) of size 3 is running on: 2d60fd60575b
> slave2 (rank 2, comm 1) of size 3 is running on: 2d60fd60575b
> Error in .Fortran("MPIpi", avepi = as.numeric(1), DARTS =
> as.integer(DARTS),  :
>  "mpipi" not resolved from current namespace (MyPi)
>
> It looks like something is wrong in my NAMESPACE. This is what I have
> there:
>
> export(Pibenchmark)
> export(Fpi)
> export(FMPIpi)
> export(Rpi)
> useDynLib(MyPi)
> exportPattern("^[[:alpha:]]+")
> This is my Fortran module:
>
> Module Fortranpi
> USE MPI
> IMPLICIT NONE
> contains
> subroutine dboard(darts, dartsscore)
>  integer, intent(in)                    :: darts
>  double precision, intent(out)          :: dartsscore
>  double precision                       :: x_coord, y_coord
>  integer                                :: score, n
>
> score = 0
> do n = 1, darts
>  call random_number(x_coord)
>  call random_number(y_coord)
>
>  if ((x_coord**2 + y_coord**2) <= 1.0d0) then
>  score = score + 1
>  end if
> end do
>
> dartsscore = 4.0d0*score/darts
>
> end subroutine dboard
>
> subroutine pi(avepi, DARTS, ROUNDS) bind(C, name="pi_")
>  use, intrinsic                         :: iso_c_binding, only : c_double,
> c_int
>  real(c_double), intent(out)            ::  avepi
>  integer(c_int), intent(in)             ::  DARTS, ROUNDS
>  integer                                ::  MASTER, rank, i, n
>  integer, allocatable                   ::  seed(:)
>  double precision                       ::  pi_est, homepi, pirecv, pisum
>
> ! we set it to zero in the sequential run
> rank = 0
> ! initialize the random number generator
> ! we make sure the seed is different for each task
> call random_seed()
> call random_seed(size = n)
> allocate(seed(n))
> seed = 12 + rank*11
> call random_seed(put=seed(1:n))
> deallocate(seed)
>
> avepi = 0
> do i = 0, ROUNDS-1
>  call dboard(darts, pi_est)
>  ! calculate the average value of pi over all iterations
>  avepi = ((avepi*i) + pi_est)/(i + 1)
> end do
> end subroutine pi
>
>
> subroutine MPIpi(avepi, DARTS, ROUNDS) bind(C, name="MPIpi_")
> use, intrinsic                         :: iso_c_binding, only : c_double,
> c_int
> real(c_double), intent(out)            :: avepi
> integer(c_int), intent(in)             :: DARTS, ROUNDS
> integer                                :: i, n, mynpts, ierr, numprocs,
> proc_num
> integer, allocatable                   :: seed(:)
> double precision                       :: pi_est, y, sumpi
>
>  call mpi_init(ierr)
>  call mpi_comm_size(MPI_COMM_WORLD, numprocs, ierr)
>  call mpi_comm_rank(MPI_COMM_WORLD, proc_num, ierr)
>
>  if (numprocs .eq. 0) then
> mynpts = ROUNDS - (numprocs-1)*(ROUNDS/numprocs)
>  else
> mynpts = ROUNDS/numprocs
>  endif
>
>  ! initialize the random number generator
>  ! we make sure the seed is different for each task
>  call random_seed()
>  call random_seed(size = n)
>  allocate(seed(n))
>  seed = 12 + proc_num*11
>  call random_seed(put=seed(1:n))
>  deallocate(seed)
>
>  y=0.0d0
> do i = 1, mynpts
> call dboard(darts, pi_est)
> y = y + pi_est
>  end do
>
>  call mpi_reduce(y, sumpi, 1, mpi_double_precision, mpi_sum, 0, &
>  mpi_comm_world, ierr)
>  if (proc_num==0) avepi = sumpi/ROUNDS
>  call mpi_finalize(ierr)
> end subroutine MPIpi
>
> end module Fortranpi
> and this is my R function
>
> #'@export
> FMPIpi <- function(DARTS, ROUNDS, cores) {
>  Rmpi::mpi.spawn.Rslaves(nslaves=cores)
>  retvals <- .Fortran("MPIpi", avepi = as.numeric(1), DARTS =
>  as.integer(DARTS), ROUNDS =  as.integer(ROUNDS))
>  return(retvals$avepi)
> }
>
> What am I doing wrong?
>
> Thanks a lot!
>
> Ignacio
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ignacio82 at gmail.com  Tue Aug 11 20:31:48 2015
From: ignacio82 at gmail.com (Ignacio Martinez)
Date: Tue, 11 Aug 2015 18:31:48 +0000
Subject: [R-pkg-devel] not resolved from current namespace error
In-Reply-To: <CAPw7dZGHE4RXChsygBh-Qwcat2pahbunn=WAyyie1t2Q0Pjb9A@mail.gmail.com>
References: <CAJA1VFwN17KJXMipg78dPF_mNJ+XYNDP2HTYZUWw7vgn63VMhQ@mail.gmail.com>
	<CAPw7dZGHE4RXChsygBh-Qwcat2pahbunn=WAyyie1t2Q0Pjb9A@mail.gmail.com>
Message-ID: <CAJA1VFyadfO1nBqvB1d+P6a-PkrEWcpA8QqNsv6w1fhRJ7mkbQ@mail.gmail.com>

renaming did the trick! Now I can create the library but the parallel part
is not working (things are much slower in parallel). I will try to figure
that out next.

Is this a good list to ask R + Fortran + MPI questions or should I go to a
different place?

Thanks!

On Tue, Aug 11, 2015 at 2:21 PM Tom Wainwright <thomas.wainwright at noaa.gov>
wrote:

> Not sure, but your problem might be answered in the .Fortran() help page:
>
> All Fortran compilers known to be usable to compile R map symbol names to
>> lower case, and so does .Fortran.
>>
>
> I've been caught by that before, and found that using all lowercase names
> for Fortran routines in R is safest.
>
> Tom Wainwright
>
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> The contents of this message are mine personally and do not
> necessarily reflect any position of the Government or the
> National Oceanic and Atmospheric Administration.
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
>
>
> On Tue, Aug 11, 2015 at 10:32 AM, Ignacio Martinez <ignacio82 at gmail.com>
> wrote:
>
>> I'm trying to create a package that uses a MPI Fortran module. I have a
>> working
>>
> version <https://github.com/ignacio82/MyPi> of that package that uses a
>
>
>> Fortran module without MPI.
>>
>> When I run the function `FMPIpi(DARTS = 5000, ROUNDS = 100, cores=2)` I
>> get
>> the following errors:
>>
>> > FMPIpi(DARTS = 5000, ROUNDS = 100, cores=2)
>> 2 slaves are spawned successfully. 0 failed.
>> master (rank 0, comm 1) of size 3 is running on: 2d60fd60575b
>> slave1 (rank 1, comm 1) of size 3 is running on: 2d60fd60575b
>> slave2 (rank 2, comm 1) of size 3 is running on: 2d60fd60575b
>> Error in .Fortran("MPIpi", avepi = as.numeric(1), DARTS =
>> as.integer(DARTS),  :
>>  "mpipi" not resolved from current namespace (MyPi)
>>
>> It looks like something is wrong in my NAMESPACE. This is what I have
>> there:
>>
>> export(Pibenchmark)
>> export(Fpi)
>> export(FMPIpi)
>> export(Rpi)
>> useDynLib(MyPi)
>> exportPattern("^[[:alpha:]]+")
>> This is my Fortran module:
>>
>> Module Fortranpi
>> USE MPI
>> IMPLICIT NONE
>> contains
>> subroutine dboard(darts, dartsscore)
>>  integer, intent(in)                    :: darts
>>  double precision, intent(out)          :: dartsscore
>>  double precision                       :: x_coord, y_coord
>>  integer                                :: score, n
>>
>> score = 0
>> do n = 1, darts
>>  call random_number(x_coord)
>>  call random_number(y_coord)
>>
>>  if ((x_coord**2 + y_coord**2) <= 1.0d0) then
>>  score = score + 1
>>  end if
>> end do
>>
>> dartsscore = 4.0d0*score/darts
>>
>> end subroutine dboard
>>
>> subroutine pi(avepi, DARTS, ROUNDS) bind(C, name="pi_")
>>  use, intrinsic                         :: iso_c_binding, only : c_double,
>> c_int
>>  real(c_double), intent(out)            ::  avepi
>>  integer(c_int), intent(in)             ::  DARTS, ROUNDS
>>  integer                                ::  MASTER, rank, i, n
>>  integer, allocatable                   ::  seed(:)
>>  double precision                       ::  pi_est, homepi, pirecv, pisum
>>
>> ! we set it to zero in the sequential run
>> rank = 0
>> ! initialize the random number generator
>> ! we make sure the seed is different for each task
>> call random_seed()
>> call random_seed(size = n)
>> allocate(seed(n))
>> seed = 12 + rank*11
>> call random_seed(put=seed(1:n))
>> deallocate(seed)
>>
>> avepi = 0
>> do i = 0, ROUNDS-1
>>  call dboard(darts, pi_est)
>>  ! calculate the average value of pi over all iterations
>>  avepi = ((avepi*i) + pi_est)/(i + 1)
>> end do
>> end subroutine pi
>>
>>
>> subroutine MPIpi(avepi, DARTS, ROUNDS) bind(C, name="MPIpi_")
>> use, intrinsic                         :: iso_c_binding, only : c_double,
>> c_int
>> real(c_double), intent(out)            :: avepi
>> integer(c_int), intent(in)             :: DARTS, ROUNDS
>> integer                                :: i, n, mynpts, ierr, numprocs,
>> proc_num
>> integer, allocatable                   :: seed(:)
>> double precision                       :: pi_est, y, sumpi
>>
>>  call mpi_init(ierr)
>>  call mpi_comm_size(MPI_COMM_WORLD, numprocs, ierr)
>>  call mpi_comm_rank(MPI_COMM_WORLD, proc_num, ierr)
>>
>>  if (numprocs .eq. 0) then
>> mynpts = ROUNDS - (numprocs-1)*(ROUNDS/numprocs)
>>  else
>> mynpts = ROUNDS/numprocs
>>  endif
>>
>>  ! initialize the random number generator
>>  ! we make sure the seed is different for each task
>>  call random_seed()
>>  call random_seed(size = n)
>>  allocate(seed(n))
>>  seed = 12 + proc_num*11
>>  call random_seed(put=seed(1:n))
>>  deallocate(seed)
>>
>>  y=0.0d0
>> do i = 1, mynpts
>> call dboard(darts, pi_est)
>> y = y + pi_est
>>  end do
>>
>>  call mpi_reduce(y, sumpi, 1, mpi_double_precision, mpi_sum, 0, &
>>  mpi_comm_world, ierr)
>>  if (proc_num==0) avepi = sumpi/ROUNDS
>>  call mpi_finalize(ierr)
>> end subroutine MPIpi
>>
>> end module Fortranpi
>> and this is my R function
>>
>> #'@export
>> FMPIpi <- function(DARTS, ROUNDS, cores) {
>>  Rmpi::mpi.spawn.Rslaves(nslaves=cores)
>>  retvals <- .Fortran("MPIpi", avepi = as.numeric(1), DARTS =
>>  as.integer(DARTS), ROUNDS =  as.integer(ROUNDS))
>>  return(retvals$avepi)
>> }
>>
>> What am I doing wrong?
>>
>> Thanks a lot!
>>
>> Ignacio
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
>

	[[alternative HTML version deleted]]


From luke-tierney at uiowa.edu  Tue Aug 11 20:47:03 2015
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Tue, 11 Aug 2015 13:47:03 -0500
Subject: [R-pkg-devel] Visible bindings and reference classes
In-Reply-To: <CADbDLZ=MTbGW8HnZo5BebTW4QBB7Cuk0XM0-JdZrvicdb5z8aQ@mail.gmail.com>
References: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>
	<21961.56156.246929.329540@stat.math.ethz.ch>
	<CADbDLZ=MTbGW8HnZo5BebTW4QBB7Cuk0XM0-JdZrvicdb5z8aQ@mail.gmail.com>
Message-ID: <alpine.OSX.2.02.1508111342590.81922@lukes-macbook-air.local>

On Tue, 11 Aug 2015, Colin Gillespie wrote:

>>>> To your question:
>>
>> Reference classes are used in *many* places,  and the use of  ' <<- '
>> is really "standard" there.
>> e.g., package 'lme4', or 'pcalg' are two packages I'm involved with,
>> which use ref.classes and ' <<- '  but are "fine" with that.
>>
>> So there must be something peculiar in your package leading to
>> the  <<-  warnings.
>>
>
> After a bit more investigating I've narrowed it down.  The notes can be
> generated by having
>
> d1 = setRefClass("d1", fields=list(x = "numeric"))
> d1$accessors("x")
>
> **and** having ByteCompile: true. Commenting out the accessors line removes
> the visible binding note. The  x=NULL  or globalVariables("x") trick
> doesn't work.

For now I would recommend not enabling byte code compilation or not
using accessors if you want to avoid these warnings. The compiler
notes are valid given the implementation of the accessors mechanism;
I'm fairly sure some minor changes to the accessor mechanism could
address this. We'll look into this.

Best,

luke

>
> A stackoverflow answer suggests that I need to add
>
> assign(variable,NULL, envir = .GlobalEnv)
>
> but this generates a new NOTE under R CMD check
>
> I've not been able to find another package that uses accessors and
> ByteCompile
>
> Thanks
>
> Colin
>
>
>
>
>
>
>
>
>
>
>>
>> Maybe you should look into the source code of such other CRAN
>> packages to see how "they" do it differently than you.
>>
>> Best regards,
>> Martin
>>
>> Martin Maechler, ETH Zurich
>>
>>
>> > After some googling, I came across the page
>> > http://stackoverflow.com/q/23475309/203420 which suggests
>> >
>> > suppressBindingNotes <- function(variablesMentionedInNotes) {
>> >   for(variable in variablesMentionedInNotes) {
>> >     assign(variable,NULL, envir = .GlobalEnv)
>> >   }
>> > }
>> > suppressBindingNotes(c("dat", "internal", "xmin", "pars", "no_pars"))
>> >
>> > But checking the package with --as-cran raises the note
>> >
>> > * checking R code for possible problems ... NOTE
>> > Found the following assignments to the global environment:
>> >   File ?poweRlaw/R/aaa_all_classes.R?:
>> >   assign(variable, NULL, envir = .GlobalEnv)
>> >
>> > What is the correct way of removing the "visible bindings" notes?
>> >
>> > Thanks
>> >
>> > Colin
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From luke-tierney at uiowa.edu  Tue Aug 11 22:01:06 2015
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Tue, 11 Aug 2015 15:01:06 -0500
Subject: [R-pkg-devel] Visible bindings and reference classes
In-Reply-To: <CAF8bMcYSioLVEb8cnLYjZazBwVRnoqWpvS3DpTrWnwuj9KMh6w@mail.gmail.com>
References: <CADbDLZk7-dEuXtEzKnwP2qPkcE-vmXO93ZtkuJ+6HJrcNnUX8A@mail.gmail.com>
	<21961.56156.246929.329540@stat.math.ethz.ch>
	<CAF8bMcbfqoWJ7DTk3hf0qWdgqHBS=j+JzAdK4hg9q_NHzqU6Dw@mail.gmail.com>
	<CAF8bMcYSioLVEb8cnLYjZazBwVRnoqWpvS3DpTrWnwuj9KMh6w@mail.gmail.com>
Message-ID: <alpine.OSX.2.02.1508111457130.97349@lukes-macbook-air.local>

On Tue, 11 Aug 2015, William Dunlap wrote:

> You can avoid the temporary file by replacing
>  dput(def, file= (tf <- tempfile()))
>  compiler::cmpfile(tf)
> with
>  cdef <- compiler::compile(def)
>  #Note: no visible binding for '<<-' assignment to 'ConfigString'
> The compiled code appears to work.
>  eval(cdef)
>  c1 <- Config$new()
>  c1
>  #Reference class object of class "Config"
>  #Field "ConfigString":
>  #[1] "Hello, World!"
>  > objects(all=TRUE)
>  #[1] ".__C__Config"           ".__global__"
>  #[3] ".requireCachedGenerics" "c1"
>  #[5] "cdef"                   "Config"
>  #[7] "def"
>

Short answer: this isn't actually what is happening in Colin's
example, and in any case the notes seem OK to me, given what is
happening.

For the long answer, the basic issue is that the compiler, and
codetools, look at the code as it is written and try to make sense of
it. The methods implementation, and reference class implementation in
particular, rewrite the code in various ways. This creates some
mismatches. These can either we worked around by adapting
compiler/codetools to internals of methods/reference classes, or by
modifying methods/reference class implementations to be more amenable
to static analysis, or some combination.

The way packages are compiled already does adapt to the implementation
of methods/reference classes/etc to some degree by the way it compiles
code. It does not compile at the file level. Instead it compiles while
serializing code that has been loaded and in some cases modified by
the methods infrastructure, which is why the expression/file compile
example isn't related to what Colin was seeing. A reference class
definition like this at package top level should not be a problem for
byte compilation.

Here is a slight modification of Colin's example:

d1 = setRefClass("d1", fields=list(x = "numeric"))
a <- d1$accessors("x")

Then

> a$getX
function () 
x
<environment: 0x103c7e1f8>

and the environment of this function does not contain "x":
> codetools::checkUsage(a$getX)
<anonymous>: no visible binding for global variable ?x?

When a packages using accessors is byte compiled the compiler sees
these incomplete accessor functions and points this out.

For an instance,

> v <- d1$new()
> v$getX
Class method definition for method getX()
function () 
x
<environment: 0x103ae3378>

This function has a new environment, the .xData part of v, and that does contain "x":

> codetools::checkUsage(v$getX)
# no note

So a change to the implementation of the accessors method to create
its accessors with an environment that is like the one they would see
when the are used would remove this note. I'm happy to help but
someone more familiar with reference class internals would have to
take the lead on this.

Compiled functions revert to interpreted when their environments are
changed, so the code does work, but doesn't benefit from compilation.
This is a bit overly cautious: if the structure of the environments in
terms of the variables they define remains the same, as it would if
the accessors created in the class had environments that matched their
intended usage, then the compiled code would remain valid and could
still be used. [Of course at present there isn't much if any benefit
to compiling functions this small, but that may change in the future.]







>
> Bill Dunlap
> TIBCO Software
> wdunlap tibco.com
>
> On Tue, Aug 11, 2015 at 8:47 AM, William Dunlap <wdunlap at tibco.com> wrote:
>
>> This is a problem in the compiler package.  Here is a way to reproduce it:
>>
>> def <- quote(Config <- setRefClass("Config",
>>     fields = list(
>>         ConfigString = "character"),
>>     methods = list(
>>         # Constructor
>>         initialize = function() {
>>             ConfigString <<- "Hello, World!"
>>         })
>> ))
>> dput(def, file= (tf <- tempfile()))
>> compiler::cmpfile(tf)
>> #Note: no visible binding for '<<-' assignment to 'ConfigString'
>> saving to file
>> #"C:\Users\wdunlap\AppData\Local\Temp\Rtmpk91qvT\file26d447c45b81.Rc" ...
>> done
>>
>>
>>
>>
>> Bill Dunlap
>> TIBCO Software
>> wdunlap tibco.com
>>
>> On Tue, Aug 11, 2015 at 4:24 AM, Martin Maechler <
>> maechler at stat.math.ethz.ch> wrote:
>>
>>> >>>>> Colin Gillespie <csgillespie at gmail.com>
>>> >>>>>     on Mon, 10 Aug 2015 20:33:32 +0000 writes:
>>>
>>> > Dear All,
>>> >
>>> > I have a package that uses reference classes. When I build the package I
>>> > get numerous notes of the sort
>>> >
>>> > Note: no visible binding for '<<-' assignment to 'pars'
>>> >
>>> > I've tried using GlobalVariables, but that didn't solve the issue.
>>>
>>> [ You mean globalVariables(): and it's a bad idea anyway IMO,
>>>   even if it is recommended : If you declare a variable in
>>>   there, it is "global" in all places in your package and the
>>>   codetools won't report it anywhere anymore.
>>>   Much better in my view is to use something like
>>>
>>>   var7 <- NULL # ~= globalVariables("var7")
>>>
>>> ]
>>>
>>> To your question:
>>>
>>> Reference classes are used in *many* places,  and the use of  ' <<- '
>>> is really "standard" there.
>>> e.g., package 'lme4', or 'pcalg' are two packages I'm involved with,
>>> which use ref.classes and ' <<- '  but are "fine" with that.
>>>
>>> So there must be something peculiar in your package leading to
>>> the  <<-  warnings.
>>>
>>> Maybe you should look into the source code of such other CRAN
>>> packages to see how "they" do it differently than you.
>>>
>>> Best regards,
>>> Martin
>>>
>>> Martin Maechler, ETH Zurich
>>>
>>>
>>> > After some googling, I came across the page
>>> > http://stackoverflow.com/q/23475309/203420 which suggests
>>> >
>>> > suppressBindingNotes <- function(variablesMentionedInNotes) {
>>> >   for(variable in variablesMentionedInNotes) {
>>> >     assign(variable,NULL, envir = .GlobalEnv)
>>> >   }
>>> > }
>>> > suppressBindingNotes(c("dat", "internal", "xmin", "pars", "no_pars"))
>>> >
>>> > But checking the package with --as-cran raises the note
>>> >
>>> > * checking R code for possible problems ... NOTE
>>> > Found the following assignments to the global environment:
>>> >   File ?poweRlaw/R/aaa_all_classes.R?:
>>> >   assign(variable, NULL, envir = .GlobalEnv)
>>> >
>>> > What is the correct way of removing the "visible bindings" notes?
>>> >
>>> > Thanks
>>> >
>>> > Colin
>>> >
>>> >       [[alternative HTML version deleted]]
>>> >
>>> > ______________________________________________
>>> > R-package-devel at r-project.org mailing list
>>> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From sowe at dtu.dk  Wed Aug 12 13:44:41 2015
From: sowe at dtu.dk (=?Windows-1252?Q?S=F8ren_Havelund_Welling?=)
Date: Wed, 12 Aug 2015 11:44:41 +0000
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks" machine
 support rgl 3D plots
Message-ID: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>

Dear all

I have a package(forestFloor) which produces an test error when built on the "r-release-osx-x86_64-mavericks" machine. I'm quite sure it's due to Xquartz(or similar) graphical resources have to be installed for 3D plotting. I tried with no luck, to screen the source code of ~15 other packages importing rgl to get some inspiration. Most packages did not run any rgl examples or tests.

See the error message below

Questions:
1. I there a fix for "r-release-osx-x86_64-mavericks" machine? Could I e.g. specify Xquartz to be installed?
2. Should I in general just assume no OSX user has installed Xquartz and link to a OSX install-guide from source in description file?
3.  Can I in general test builds on "r-release-osx-x86_64-mavericks" machine somehow without spamming CRAN with submissions?


Thanks in advance
Soren H Welling

Check DetailsVersion: 1.8.3 
Check: tests 
Result: ERROR 
    Running the tests in ?tests/stdUsage.R? failed.
    Last 13 lines of output:
     > plot(ffTest42,col=Col,plot_GOF=TRUE,speed=T) 
     [1] "compute goodness-of-fit with leave-one-out k-nearest neighbor(guassian kernel), kknn package"
     > 
     > #if ever needed, k-nearest neighbor parameters for goodness-of-fit can be access through convolute_ff
     > #a new fit will be calculated and added to forstFloor object as ffTest42$FCfit
     > ffTest42 = convolute_ff(ffTest42,userArgs.kknn=alist(kernel="epanechnikov",kmax=5))
     > plot(ffTest42,col=Col,plot_GOF=TRUE)
     > 
     > #in 3D the interaction between X3 and X reveals itself completely
     > show3d(ffTest42,3:4,col=Col,plot.rgl=list(size=5),sortByImportance=FALSE) 
     Error in rgl.open(useNULL) : rgl.open failed
     Calls: show3d ... plot3d.default -> next3d -> .check3d -> open3d -> rgl.open
     Execution halted 
Flavor: r-release-osx-x86_64-mavericks

From edd at debian.org  Wed Aug 12 14:26:33 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 12 Aug 2015 07:26:33 -0500
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
Message-ID: <21963.15225.888683.947819@max.nulle.part>


Hi S?ren,

On 12 August 2015 at 11:44, S?ren Havelund Welling wrote:
| Dear all
| 
| I have a package(forestFloor) which produces an test error when built on the "r-release-osx-x86_64-mavericks" machine. I'm quite sure it's due to Xquartz(or similar) graphical resources have to be installed for 3D plotting. I tried with no luck, to screen the source code of ~15 other packages importing rgl to get some inspiration. Most packages did not run any rgl examples or tests.
| 
| See the error message below
| 
| Questions:
| 1. I there a fix for "r-release-osx-x86_64-mavericks" machine? Could I e.g. specify Xquartz to be installed?
| 2. Should I in general just assume no OSX user has installed Xquartz and link to a OSX install-guide from source in description file?
| 3.  Can I in general test builds on "r-release-osx-x86_64-mavericks" machine somehow without spamming CRAN with submissions?


I don't know about 1) to 3) but may I plead with you to not run rgl code
during R CMD check?

I frequently tests against all reverse dependencies against some of my
packages, ie Rcpp, RcppArmadillo, ... and packages using rgl generally fail
during these tests.

A simple wrapper like

  if (interactive()) {
      # do something
  }

can help in demos or examples. 

| Thanks in advance
| Soren H Welling
| 
| Check DetailsVersion: 1.8.3 
| Check: tests 
| Result: ERROR 
|     Running the tests in ?tests/stdUsage.R? failed.
|     Last 13 lines of output:
|      > plot(ffTest42,col=Col,plot_GOF=TRUE,speed=T) 
|      [1] "compute goodness-of-fit with leave-one-out k-nearest neighbor(guassian kernel), kknn package"
|      > 
|      > #if ever needed, k-nearest neighbor parameters for goodness-of-fit can be access through convolute_ff
|      > #a new fit will be calculated and added to forstFloor object as ffTest42$FCfit
|      > ffTest42 = convolute_ff(ffTest42,userArgs.kknn=alist(kernel="epanechnikov",kmax=5))
|      > plot(ffTest42,col=Col,plot_GOF=TRUE)
|      > 
|      > #in 3D the interaction between X3 and X reveals itself completely
|      > show3d(ffTest42,3:4,col=Col,plot.rgl=list(size=5),sortByImportance=FALSE) 
|      Error in rgl.open(useNULL) : rgl.open failed
|      Calls: show3d ... plot3d.default -> next3d -> .check3d -> open3d -> rgl.open
|      Execution halted 
| Flavor: r-release-osx-x86_64-mavericks


Yes, I see lots of that on Linux too as the tests run 'headless' without a
controlling terminal.

Dirk
 ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch.duncan at gmail.com  Wed Aug 12 15:07:15 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 12 Aug 2015 09:07:15 -0400
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <21963.15225.888683.947819@max.nulle.part>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
	<21963.15225.888683.947819@max.nulle.part>
Message-ID: <55CB4503.9090706@gmail.com>

On 12/08/2015 8:26 AM, Dirk Eddelbuettel wrote:
> 
> Hi S?ren,
> 
> On 12 August 2015 at 11:44, S?ren Havelund Welling wrote:
> | Dear all
> | 
> | I have a package(forestFloor) which produces an test error when built on the "r-release-osx-x86_64-mavericks" machine. I'm quite sure it's due to Xquartz(or similar) graphical resources have to be installed for 3D plotting. I tried with no luck, to screen the source code of ~15 other packages importing rgl to get some inspiration. Most packages did not run any rgl examples or tests.
> | 
> | See the error message below
> | 
> | Questions:
> | 1. I there a fix for "r-release-osx-x86_64-mavericks" machine? Could I e.g. specify Xquartz to be installed?
> | 2. Should I in general just assume no OSX user has installed Xquartz and link to a OSX install-guide from source in description file?
> | 3.  Can I in general test builds on "r-release-osx-x86_64-mavericks" machine somehow without spamming CRAN with submissions?
> 
> 
> I don't know about 1) to 3) but may I plead with you to not run rgl code
> during R CMD check?
> 
> I frequently tests against all reverse dependencies against some of my
> packages, ie Rcpp, RcppArmadillo, ... and packages using rgl generally fail
> during these tests.
> 
> A simple wrapper like
> 
>   if (interactive()) {
>       # do something
>   }
> 
> can help in demos or examples. 
> 
> | Thanks in advance
> | Soren H Welling
> | 
> | Check DetailsVersion: 1.8.3 
> | Check: tests 
> | Result: ERROR 
> |     Running the tests in ?tests/stdUsage.R? failed.
> |     Last 13 lines of output:
> |      > plot(ffTest42,col=Col,plot_GOF=TRUE,speed=T) 
> |      [1] "compute goodness-of-fit with leave-one-out k-nearest neighbor(guassian kernel), kknn package"
> |      > 
> |      > #if ever needed, k-nearest neighbor parameters for goodness-of-fit can be access through convolute_ff
> |      > #a new fit will be calculated and added to forstFloor object as ffTest42$FCfit
> |      > ffTest42 = convolute_ff(ffTest42,userArgs.kknn=alist(kernel="epanechnikov",kmax=5))
> |      > plot(ffTest42,col=Col,plot_GOF=TRUE)
> |      > 
> |      > #in 3D the interaction between X3 and X reveals itself completely
> |      > show3d(ffTest42,3:4,col=Col,plot.rgl=list(size=5),sortByImportance=FALSE) 
> |      Error in rgl.open(useNULL) : rgl.open failed
> |      Calls: show3d ... plot3d.default -> next3d -> .check3d -> open3d -> rgl.open
> |      Execution halted 
> | Flavor: r-release-osx-x86_64-mavericks
> 
> 
> Yes, I see lots of that on Linux too as the tests run 'headless' without a
> controlling terminal.

A while ago I added support in rgl to run on headless machines.  Set the
environment variable RGL_USE_NULL=TRUE before loading rgl, and should
never try to call X11 (or whatever graphics system you're using).
(It's also possible to use options(rgl.useNULL = TRUE) within R.  That's
no help to you, but is useful when embedding rgl plots in knitr documents.)

Duncan Murdoch


From edd at debian.org  Wed Aug 12 17:48:12 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 12 Aug 2015 10:48:12 -0500
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <55CB4503.9090706@gmail.com>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
	<21963.15225.888683.947819@max.nulle.part>
	<55CB4503.9090706@gmail.com>
Message-ID: <21963.27324.666461.293667@max.nulle.part>


On 12 August 2015 at 09:07, Duncan Murdoch wrote:
| On 12/08/2015 8:26 AM, Dirk Eddelbuettel wrote:
| > I frequently tests against all reverse dependencies against some of my
| > packages, ie Rcpp, RcppArmadillo, ... and packages using rgl generally fail
| > during these tests.

[...]
 
| A while ago I added support in rgl to run on headless machines.  Set the
| environment variable RGL_USE_NULL=TRUE before loading rgl, and should
| never try to call X11 (or whatever graphics system you're using).
| (It's also possible to use options(rgl.useNULL = TRUE) within R.  That's
| no help to you, but is useful when embedding rgl plots in knitr documents.)

Next time someone complains that "whining doesn't help", I'll send them to
this thread.   Setting 

   Sys.setenv("RGL_USE_NULL"="TRUE")       # Duncan Murdoch on r-package-devel on 12 Aug 2015

works wonderfully.  I should have whined earlier ...

Thanks, Duncan!

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From cdetermanjr at gmail.com  Wed Aug 12 18:45:47 2015
From: cdetermanjr at gmail.com (Charles Determan)
Date: Wed, 12 Aug 2015 11:45:47 -0500
Subject: [R-pkg-devel] CRAN submission which requires third party
	software?
In-Reply-To: <21962.11582.616805.282524@max.nulle.part>
References: <CAKxd1KNLvdQ7ojZP81xadyNrEy3otXuhmNtrYwX-Vyne17Gaag@mail.gmail.com>
	<21962.11582.616805.282524@max.nulle.part>
Message-ID: <CAKxd1KPU+T6z8KEVmEQUP6fwowrq==ShOHQT02+92jLbApT4Uw@mail.gmail.com>

Hi Dirk,

I was primarily concerned with the requirement of the SDK.  Strictly
speaking, the SDK isn't actually need it to compile the package (assuming
the CRAN servers have the OpenCL library).  I would just need to have
nearly all the tests skipped on CRAN and the package would essentially be
worthless to someone installing it without the SDK.

Another concern is that the package requires a C++11 compiler.  This isn't
an issue on Linux systems but I don't know how to accomplish a build on
Windows as the Rtools compiler is still using 4.6 (as I am sure you know).

Thanks,
Charles

On Tue, Aug 11, 2015 at 12:13 PM, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 11 August 2015 at 11:49, Charles Determan wrote:
> | I am beginning to reach the completion of a new package I would like to
> | submit to CRAN.  However, there are a few aspects of it that I would like
> | some guidance prior to submitting.
> |
> | 1. It requires some third party software (i.e. an OpenCL SDK) to be
> | installed before it will compile (it contains c++ code).  As such, I
> don't
> | believe it would build successfully when submitted to CRAN.  I can verify
> | it builds and tests successfully on Travis CI but not sure how CRAN would
> | approach this.
>
> So you are saying it needs _new tools to build_ it?  That may be tough.
>
> | 2. It requires a support package which is another header only package
> which
> | mirrors the structure of BH.
>
> I see no difficulty with this part.
>
> Dirk
>
> | I know this has been accomplished by some other packages like gputools (
> | https://cran.r-project.org/web/packages/gputools/index.html) which
> requires
> | the CUDA toolkit to be installed.  I also don't know how to approach the
> | companion package submission (i.e. that others could use just like the BH
> | package).
> |
> | Anyone have any recommendations on how I should prepare for submitting
> this
> | package.
> |
> | Thank you,
> | Charles
> |
> |       [[alternative HTML version deleted]]
> |
> | ______________________________________________
> | R-package-devel at r-project.org mailing list
> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From henrik.bengtsson at ucsf.edu  Wed Aug 12 20:47:31 2015
From: henrik.bengtsson at ucsf.edu (Henrik Bengtsson)
Date: Wed, 12 Aug 2015 20:47:31 +0200
Subject: [R-pkg-devel] Milestone: 7000 packages on CRAN
In-Reply-To: <CAFDcVCTBSXSf6+6EeZPvUaixRF5kw61qL9+q3ug0Xk2AVBwbXw@mail.gmail.com>
References: <CAFDcVCQ9_swe-Wrja-2mr3+csQw+-WfRirq2r266bvtRCROcQg@mail.gmail.com>
	<CAFDcVCTBSXSf6+6EeZPvUaixRF5kw61qL9+q3ug0Xk2AVBwbXw@mail.gmail.com>
Message-ID: <CAFDcVCSxFdKVnegqeN_s5s6pVLwyh-OzTpweb6FtOpcfBnv7Rg@mail.gmail.com>

Another 1000 packages were added to CRAN, which took less than 9 months.
Today (August 12, 2015), the Comprehensive R Archive Network (CRAN) [1]
reports:

?Currently, the CRAN package repository features 7002 available packages.?

While the previous 1000 packages took 355 days, going from 6000 to 7000
packages took 287 days - which means that now a new CRAN package is born on
average every 6.9 hours (or 3.5 packages per day). Since the start of CRAN
18.3 years ago on April 23, 1997 [2], there has been on average one new
package appearing on CRAN every 22.9 hours. It is actually more frequent
than that because dropped/archived packages are not accounted for. The 7000
packages on CRAN are maintained by ~4130 people [3].

Thanks to the CRAN team and to all package developers. You can give back by
carefully reporting bugs to the maintainers and properly citing any
packages you use in your publications, cf. citation("pkg name").

Milestones:

2015-08-12: 7000 packages [this post]
2014-10-29: 6000 packages [10]
2013-11-08: 5000 packages [9]
2012-08-23: 4000 packages [8]
2011-05-12: 3000 packages [7]
2009-10-04: 2000 packages [6]
2007-04-12: 1000 packages [5]
2004-10-01: 500 packages [4]
2003-04-01: 250 packages [4]

These data are for CRAN only. There are many more packages elsewhere, e.g.
R-Forge, Bioconductor, Github etc.

[1] http://cran.r-project.org/web/packages/
[2] https://en.wikipedia.org/wiki/R_(programming_language)#Milestones
[3] http://cran.r-project.org/web/checks/check_summary_by_maintainer.html
[4] Private data
[5] https://stat.ethz.ch/pipermail/r-devel/2007-April/045359.html
[6] https://stat.ethz.ch/pipermail/r-devel/2009-October/055049.html
[7] https://stat.ethz.ch/pipermail/r-devel/2011-May/061002.html
[8] https://stat.ethz.ch/pipermail/r-devel/2012-August/064675.html
[9] https://stat.ethz.ch/pipermail/r-devel/2013-November/067935.html
[10] https://stat.ethz.ch/pipermail/r-devel/2014-October/069997.html

/Henrik

	[[alternative HTML version deleted]]


From sowe at dtu.dk  Thu Aug 13 00:30:19 2015
From: sowe at dtu.dk (=?iso-8859-1?Q?S=F8ren_Havelund_Welling?=)
Date: Wed, 12 Aug 2015 22:30:19 +0000
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <21963.27324.666461.293667@max.nulle.part>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
	<21963.15225.888683.947819@max.nulle.part>
	<55CB4503.9090706@gmail.com>, <21963.27324.666461.293667@max.nulle.part>
Message-ID: <1B3F92D43EA50646AB74A6C8C69A036064D093@ait-pex02mbx05.win.dtu.dk>

I placed in top of all test scripts:
if(!interactive()) Sys.setenv(RGL_USE_NULL=TRUE) #disable RGL for headless machines

on 3)
I guess I could build and test the github version of package on travis.ci in a OSX environment

Many thanks for the help
PS "What happens when you squeeze grapes? -they wine a lot"

________________________________________
From: Dirk Eddelbuettel [edd at debian.org]
Sent: Wednesday, August 12, 2015 5:48 PM
To: Duncan Murdoch
Cc: Dirk Eddelbuettel; S?ren Havelund Welling; r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks" machine support rgl 3D plots

On 12 August 2015 at 09:07, Duncan Murdoch wrote:
| On 12/08/2015 8:26 AM, Dirk Eddelbuettel wrote:
| > I frequently tests against all reverse dependencies against some of my
| > packages, ie Rcpp, RcppArmadillo, ... and packages using rgl generally fail
| > during these tests.

[...]

| A while ago I added support in rgl to run on headless machines.  Set the
| environment variable RGL_USE_NULL=TRUE before loading rgl, and should
| never try to call X11 (or whatever graphics system you're using).
| (It's also possible to use options(rgl.useNULL = TRUE) within R.  That's
| no help to you, but is useful when embedding rgl plots in knitr documents.)

Next time someone complains that "whining doesn't help", I'll send them to
this thread.   Setting

   Sys.setenv("RGL_USE_NULL"="TRUE")       # Duncan Murdoch on r-package-devel on 12 Aug 2015

works wonderfully.  I should have whined earlier ...

Thanks, Duncan!

Dirk

--
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From daattali at gmail.com  Sat Aug 15 08:36:08 2015
From: daattali at gmail.com (Dean Attali)
Date: Fri, 14 Aug 2015 23:36:08 -0700
Subject: [R-pkg-devel] Listing a package in "Imports:" when it's used
	outside of "R" directory
Message-ID: <CA+j8Z+n89X-V+-2pWE7Ou6Py8iRVoXDB5=mJKei2to_HhR9dyw@mail.gmail.com>

It seems like if a package is declared under the "Imports:" field in
the DESCRIPTION
file, and that package is not used in any code in the R directory, then I
get an error when doing a R CMD CHECK

 Namespace in Imports field not imported from: 'DT'
>    All declared Imports should be used.



It certainly makes sense why this is regarded as an error, but I'm running into
a case where I think this should be allowed, and wanted to get your opinion
on whether what I'm doing seems strange or if this error should be
revisited.

Suppose I have a package that implements some analysis pipeline. In order to
make it more accessible and useable, I want to include a Shiny app that uses
the package code.  I place the Shiny app inside the directory "inst/shiny",
and I export a function called "shine" which simply runs the app.  For
example, this could be my shine function:

#' Run the Shiny app
> #' @export
>  shine <- function() {
>    shiny::runApp(system.file("shiny", package = "testpkg"))
>  }



And this is an example of a dumb app in the inst/shiny location:

shiny::shinyApp(
>    ui = shiny::fluidPage(
>      DT::dataTableOutput("table")
>    ),
>    server = function(input, output, session) {
>      output$table <- DT::renderDataTable(mtcars)
>    }
>  )




Since the Shiny app is an integral part of the package, and the app uses the
"DT" package, I want to place DT under the Imports: field. But then I ran
into the above error.

I know I can get rid of the problem by placing the entire shiny app in the R
folder, but it's a large app and it seems like separating it and having it
under inst/shiny makes more sense.

What would be the correct solution here?

---
http://deanattali.com

	[[alternative HTML version deleted]]


From edd at debian.org  Sat Aug 15 14:35:18 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 15 Aug 2015 07:35:18 -0500
Subject: [R-pkg-devel] Listing a package in "Imports:" when it's
	used	outside of "R" directory
In-Reply-To: <CA+j8Z+n89X-V+-2pWE7Ou6Py8iRVoXDB5=mJKei2to_HhR9dyw@mail.gmail.com>
References: <CA+j8Z+n89X-V+-2pWE7Ou6Py8iRVoXDB5=mJKei2to_HhR9dyw@mail.gmail.com>
Message-ID: <21967.12806.146422.42376@max.nulle.part>


On 14 August 2015 at 23:36, Dean Attali wrote:
| Since the Shiny app is an integral part of the package, and the app uses the
| "DT" package, I want to place DT under the Imports: field. But then I ran
| into the above error.

The code checkers are heuristics.  They cannot get everything right.

If this is what you want, why not make it so -- maybe by adding an 'empty'
call into a DT function not used.  Eg

     R/ignoreme.R

containing

     nevercalled <- function(filename) {
          ignored <- data.table::fread(filename)
     }

should do.
 
| I know I can get rid of the problem by placing the entire shiny app in the R
| folder, but it's a large app and it seems like separating it and having it
| under inst/shiny makes more sense.

Why?  It is still in the package.  Maybe make the shiny app a package itself
and add Suggests: on it?
 
Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From daattali at gmail.com  Sat Aug 15 20:50:33 2015
From: daattali at gmail.com (Dean Attali)
Date: Sat, 15 Aug 2015 11:50:33 -0700
Subject: [R-pkg-devel] Listing a package in "Imports:" when it's used
 outside of "R" directory
In-Reply-To: <21967.12806.146422.42376@max.nulle.part>
References: <CA+j8Z+n89X-V+-2pWE7Ou6Py8iRVoXDB5=mJKei2to_HhR9dyw@mail.gmail.com>
	<21967.12806.146422.42376@max.nulle.part>
Message-ID: <CA+j8Z+=WftAe94GAtmpCzghwq2_yrXWUiA_f1cuiEM0EdoSaew@mail.gmail.com>

I'll go with your suggestion to make a dummy function, thanks Dirk

---
http://deanattali.com

On 15 August 2015 at 05:35, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 14 August 2015 at 23:36, Dean Attali wrote:
> | Since the Shiny app is an integral part of the package, and the app uses
> the
> | "DT" package, I want to place DT under the Imports: field. But then I ran
> | into the above error.
>
> The code checkers are heuristics.  They cannot get everything right.
>
> If this is what you want, why not make it so -- maybe by adding an 'empty'
> call into a DT function not used.  Eg
>
>      R/ignoreme.R
>
> containing
>
>      nevercalled <- function(filename) {
>           ignored <- data.table::fread(filename)
>      }
>
> should do.
>
> | I know I can get rid of the problem by placing the entire shiny app in
> the R
> | folder, but it's a large app and it seems like separating it and having
> it
> | under inst/shiny makes more sense.
>
> Why?  It is still in the package.  Maybe make the shiny app a package
> itself
> and add Suggests: on it?
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Sun Aug 16 01:12:28 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 15 Aug 2015 19:12:28 -0400
Subject: [R-pkg-devel] Listing a package in "Imports:" when it's used
 outside of "R" directory
In-Reply-To: <CA+j8Z+n89X-V+-2pWE7Ou6Py8iRVoXDB5=mJKei2to_HhR9dyw@mail.gmail.com>
References: <CA+j8Z+n89X-V+-2pWE7Ou6Py8iRVoXDB5=mJKei2to_HhR9dyw@mail.gmail.com>
Message-ID: <55CFC75C.5060703@gmail.com>

On 15/08/2015 2:36 AM, Dean Attali wrote:
> It seems like if a package is declared under the "Imports:" field in
> the DESCRIPTION
> file, and that package is not used in any code in the R directory, then I
> get an error when doing a R CMD CHECK
> 
>  Namespace in Imports field not imported from: 'DT'
>>    All declared Imports should be used.
> 
> 
> 
> It certainly makes sense why this is regarded as an error, but I'm running into
> a case where I think this should be allowed, and wanted to get your opinion
> on whether what I'm doing seems strange or if this error should be
> revisited.
> 
> Suppose I have a package that implements some analysis pipeline. In order to
> make it more accessible and useable, I want to include a Shiny app that uses
> the package code.  I place the Shiny app inside the directory "inst/shiny",
> and I export a function called "shine" which simply runs the app.  For
> example, this could be my shine function:
> 
> #' Run the Shiny app
>> #' @export
>>  shine <- function() {
>>    shiny::runApp(system.file("shiny", package = "testpkg"))
>>  }
> 
> 
> 
> And this is an example of a dumb app in the inst/shiny location:
> 
> shiny::shinyApp(
>>    ui = shiny::fluidPage(
>>      DT::dataTableOutput("table")
>>    ),
>>    server = function(input, output, session) {
>>      output$table <- DT::renderDataTable(mtcars)
>>    }
>>  )
> 
> 
> 
> 
> Since the Shiny app is an integral part of the package, and the app uses the
> "DT" package, I want to place DT under the Imports: field. But then I ran
> into the above error.
> 
> I know I can get rid of the problem by placing the entire shiny app in the R
> folder, but it's a large app and it seems like separating it and having it
> under inst/shiny makes more sense.
> 
> What would be the correct solution here?

If you're not importing it, then don't list it as an import.

"Suggests" sounds closer to what you want, so you could use that, but
then your package will fail if a user installs it without suggested
packages.

"Depends" is generally a bad idea.

So use "Imports", but do import something.

Duncan Murdoch


From jefferis at mrc-lmb.cam.ac.uk  Sun Aug 16 14:47:09 2015
From: jefferis at mrc-lmb.cam.ac.uk (Dr Gregory Jefferis)
Date: Sun, 16 Aug 2015 13:47:09 +0100
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <55CB4503.9090706@gmail.com>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
	<21963.15225.888683.947819@max.nulle.part> <55CB4503.9090706@gmail.com>
Message-ID: <3F0C870A-8D2A-4E49-8434-266F978285E0@mrc-lmb.cam.ac.uk>

Dear Duncan,

On 12 Aug 2015, at 14:07, Duncan Murdoch wrote:

> A while ago I added support in rgl to run on headless machines.  Set 
> the
> environment variable RGL_USE_NULL=TRUE before loading rgl, and should
> never try to call X11 (or whatever graphics system you're using).
> (It's also possible to use options(rgl.useNULL = TRUE) within R.  
> That's
> no help to you, but is useful when embedding rgl plots in knitr 
> documents.)

Could I just check if this approach can be used to suppress example code 
including rgl calls when it is running on CRAN as part of R CMD check? I 
have a package that does not build on r-release-osx-x86_64-mavericks 
because there appears to be a problem with rgl and the examples fail:

https://www.r-project.org/nosvn/R.check/r-release-osx-x86_64-mavericks/nat-00check.html

Of course I could put all the examples inside dontrun blocks, but I do 
prefer to have them run.

Many thanks for any suggestions,

Greg.

--
Gregory Jefferis, PhD                   Tel: +44 1223 267048
Division of Neurobiology
MRC Laboratory of Molecular Biology
Francis Crick Avenue
Cambridge Biomedical Campus
Cambridge, CB2 OQH, UK

http://www2.mrc-lmb.cam.ac.uk/group-leaders/h-to-m/g-jefferis
http://jefferislab.org
http://flybrain.stanford.edu


From murdoch.duncan at gmail.com  Sun Aug 16 18:21:26 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 16 Aug 2015 12:21:26 -0400
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <3F0C870A-8D2A-4E49-8434-266F978285E0@mrc-lmb.cam.ac.uk>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
	<21963.15225.888683.947819@max.nulle.part>
	<55CB4503.9090706@gmail.com>
	<3F0C870A-8D2A-4E49-8434-266F978285E0@mrc-lmb.cam.ac.uk>
Message-ID: <55D0B886.3000903@gmail.com>

On 16/08/2015 8:47 AM, Dr Gregory Jefferis wrote:
> Dear Duncan,
> 
> On 12 Aug 2015, at 14:07, Duncan Murdoch wrote:
> 
>> A while ago I added support in rgl to run on headless machines.  Set 
>> the
>> environment variable RGL_USE_NULL=TRUE before loading rgl, and should
>> never try to call X11 (or whatever graphics system you're using).
>> (It's also possible to use options(rgl.useNULL = TRUE) within R.  
>> That's
>> no help to you, but is useful when embedding rgl plots in knitr 
>> documents.)
> 
> Could I just check if this approach can be used to suppress example code 
> including rgl calls when it is running on CRAN as part of R CMD check? I 
> have a package that does not build on r-release-osx-x86_64-mavericks 
> because there appears to be a problem with rgl and the examples fail:
> 
> https://www.r-project.org/nosvn/R.check/r-release-osx-x86_64-mavericks/nat-00check.html
> 
> Of course I could put all the examples inside dontrun blocks, but I do 
> prefer to have them run.
> 

It was designed so that CRAN didn't need to see all the pretty pictures
when running tests.  If they set the environment variable, your tests
might pass.

It is harder for you to implement this yourself, because CRAN frowns on
tests that try to detect whether they're running under CRAN or not.

You could put in "if (interactive())" checks around your displays.  If
you want to check whether the rgl calls are okay, you could do something
like this:

library(rgl)
options(rgl.useNULL = TRUE)

# do some rgl plotting, which won't display, but will be tested

# now to display it to users,
if (interactive())
  browseURL(writeWebGL(tempfile()))

but this displays in a browser, not in an R window.

Duncan Murdoch


From jefferis at mrc-lmb.cam.ac.uk  Sun Aug 16 20:43:13 2015
From: jefferis at mrc-lmb.cam.ac.uk (Dr Gregory Jefferis)
Date: Sun, 16 Aug 2015 19:43:13 +0100
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <1B3F92D43EA50646AB74A6C8C69A036064D093@ait-pex02mbx05.win.dtu.dk>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
	<21963.15225.888683.947819@max.nulle.part> <55CB4503.9090706@gmail.com>
	<21963.27324.666461.293667@max.nulle.part>
	<1B3F92D43EA50646AB74A6C8C69A036064D093@ait-pex02mbx05.win.dtu.dk>
Message-ID: <E39F1908-49C9-43C3-AE17-D7826A24E02B@mrc-lmb.cam.ac.uk>

On 12 Aug 2015, at 23:30, S?ren Havelund Welling wrote:

> I placed in top of all test scripts:
> if(!interactive()) Sys.setenv(RGL_USE_NULL=TRUE) #disable RGL for 
> headless machines

System environment variables are inherited, so I think you should be 
able to do this once in your master test script e.g. test-all.r. The 
exception that I've noticed is that if you are using Rstudio + devtools 
+ testthat, the Test Package menu item seems to ignore test-all.r.

Best,

Greg.

--
Gregory Jefferis, PhD                   Tel: +44 1223 267048
Division of Neurobiology
MRC Laboratory of Molecular Biology
Francis Crick Avenue
Cambridge Biomedical Campus
Cambridge, CB2 OQH, UK

http://www2.mrc-lmb.cam.ac.uk/group-leaders/h-to-m/g-jefferis
http://jefferislab.org
http://flybrain.stanford.edu


From thierry.onkelinx at inbo.be  Mon Aug 17 11:03:36 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Mon, 17 Aug 2015 11:03:36 +0200
Subject: [R-pkg-devel] Running tests on 32-bit and 64-bit
Message-ID: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>

Dear all,

Is there an easy way to run the tests of a package on both a 32-bit and
64-bit version? Ideally it should work when using R CMD check --as-cran on
all OS's. Although I expect that multi architecture versions are only
available on windows. So a Windows only solution will be fine as well.

The origin of the problem is that I calculate some SHA1 hashed on objects
containing floating point numbers. The floating points have different
precision on 32-bit and 64-bit, and thus different hashes. I'm trying to
work around that problem. And thus need an easy way to run tests on both
32-bit and 64-bit.

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

	[[alternative HTML version deleted]]


From ligges at statistik.tu-dortmund.de  Mon Aug 17 11:11:57 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 17 Aug 2015 11:11:57 +0200
Subject: [R-pkg-devel] Running tests on 32-bit and 64-bit
In-Reply-To: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>
References: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>
Message-ID: <55D1A55D.2010108@statistik.tu-dortmund.de>

Use winbuilder, it runs 32-bit and 64-bit R tests on a Windows 64-bit 
platform. Not sure how you implemented the different precisions, but 
just go ahead and try on winbiulder.

Best,
Uwe Ligges


On 17.08.2015 11:03, Thierry Onkelinx wrote:
> Dear all,
>
> Is there an easy way to run the tests of a package on both a 32-bit and
> 64-bit version? Ideally it should work when using R CMD check --as-cran on
> all OS's. Although I expect that multi architecture versions are only
> available on windows. So a Windows only solution will be fine as well.
>
> The origin of the problem is that I calculate some SHA1 hashed on objects
> containing floating point numbers. The floating points have different
> precision on 32-bit and 64-bit, and thus different hashes. I'm trying to
> work around that problem. And thus need an easy way to run tests on both
> 32-bit and 64-bit.
>
> Best regards,
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
> Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to say
> what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From murdoch.duncan at gmail.com  Mon Aug 17 11:14:37 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 17 Aug 2015 05:14:37 -0400
Subject: [R-pkg-devel] Running tests on 32-bit and 64-bit
In-Reply-To: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>
References: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>
Message-ID: <55D1A5FD.1010406@gmail.com>

On 17/08/2015 5:03 AM, Thierry Onkelinx wrote:
> Dear all,
> 
> Is there an easy way to run the tests of a package on both a 32-bit and
> 64-bit version? Ideally it should work when using R CMD check --as-cran on
> all OS's. Although I expect that multi architecture versions are only
> available on windows. So a Windows only solution will be fine as well.

> The origin of the problem is that I calculate some SHA1 hashed on objects
> containing floating point numbers. The floating points have different
> precision on 32-bit and 64-bit, and thus different hashes. I'm trying to
> work around that problem. And thus need an easy way to run tests on both
> 32-bit and 64-bit.

I'm not sure I see the problem.  If you install both the 32 and 64 bit
versions, then you can run whichever one you want. To run both, just
give the full path to the R.exe executables when you run the tests.

Duncan Murdoch

> 
> Best regards,
> 
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
> Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
> 
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to say
> what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From kasperdanielhansen at gmail.com  Mon Aug 17 14:21:38 2015
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Mon, 17 Aug 2015 08:21:38 -0400
Subject: [R-pkg-devel] Running tests on 32-bit and 64-bit
In-Reply-To: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>
References: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>
Message-ID: <CAC2h7uszv+yHLkJeTrQ4Ss+Rai9yOqKkSA18utQTVijz_UfQsw@mail.gmail.com>

Perhaps related: in the Bioconductor minfi package I do some checking on
somewhat large matrices (450,000 times n).  To save space, I compute a hash
of the correct result using the digest package.  As you, I ran into obvious
issues with precision across platforms.  To solve this, I take the matrix
and run it through sprintf() with (my choice) 6 digits and then I hash the
resulting character matrix.  It works pretty nice for my purpose.

You find minfi on github.  Code is in
  inst/unitTests/test_preprocess.R  (testing using Runit)
  inst/testData/testData/testData_preprocessQuantile.R (creating the
reference "correct" matrix - this is only intended to be re-run when the
algorithm change)
  R/utils.R for the two convenience functions .digestMatrix and
.digestVector

Best,
Kasper

On Mon, Aug 17, 2015 at 5:03 AM, Thierry Onkelinx <thierry.onkelinx at inbo.be>
wrote:

> Dear all,
>
> Is there an easy way to run the tests of a package on both a 32-bit and
> 64-bit version? Ideally it should work when using R CMD check --as-cran on
> all OS's. Although I expect that multi architecture versions are only
> available on windows. So a Windows only solution will be fine as well.
>
> The origin of the problem is that I calculate some SHA1 hashed on objects
> containing floating point numbers. The floating points have different
> precision on 32-bit and 64-bit, and thus different hashes. I'm trying to
> work around that problem. And thus need an easy way to run tests on both
> 32-bit and 64-bit.
>
> Best regards,
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
> Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to say
> what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From h.wickham at gmail.com  Mon Aug 17 15:25:48 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 17 Aug 2015 06:25:48 -0700
Subject: [R-pkg-devel] how to make "r-release-osx-x86_64-mavericks"
 machine support rgl 3D plots
In-Reply-To: <55CB4503.9090706@gmail.com>
References: <1B3F92D43EA50646AB74A6C8C69A036064D00C@ait-pex02mbx05.win.dtu.dk>
	<21963.15225.888683.947819@max.nulle.part> <55CB4503.9090706@gmail.com>
Message-ID: <CABdHhvH6HH9oZjMAikoTacJ+s+CbBPkttr5Lnws8b=k818mJwQ@mail.gmail.com>

>> | Check DetailsVersion: 1.8.3
>> | Check: tests
>> | Result: ERROR
>> |     Running the tests in ?tests/stdUsage.R? failed.
>> |     Last 13 lines of output:
>> |      > plot(ffTest42,col=Col,plot_GOF=TRUE,speed=T)
>> |      [1] "compute goodness-of-fit with leave-one-out k-nearest neighbor(guassian kernel), kknn package"
>> |      >
>> |      > #if ever needed, k-nearest neighbor parameters for goodness-of-fit can be access through convolute_ff
>> |      > #a new fit will be calculated and added to forstFloor object as ffTest42$FCfit
>> |      > ffTest42 = convolute_ff(ffTest42,userArgs.kknn=alist(kernel="epanechnikov",kmax=5))
>> |      > plot(ffTest42,col=Col,plot_GOF=TRUE)
>> |      >
>> |      > #in 3D the interaction between X3 and X reveals itself completely
>> |      > show3d(ffTest42,3:4,col=Col,plot.rgl=list(size=5),sortByImportance=FALSE)
>> |      Error in rgl.open(useNULL) : rgl.open failed
>> |      Calls: show3d ... plot3d.default -> next3d -> .check3d -> open3d -> rgl.open
>> |      Execution halted
>> | Flavor: r-release-osx-x86_64-mavericks
>>
>>
>> Yes, I see lots of that on Linux too as the tests run 'headless' without a
>> controlling terminal.
>
> A while ago I added support in rgl to run on headless machines.  Set the
> environment variable RGL_USE_NULL=TRUE before loading rgl, and should
> never try to call X11 (or whatever graphics system you're using).
> (It's also possible to use options(rgl.useNULL = TRUE) within R.  That's
> no help to you, but is useful when embedding rgl plots in knitr documents.)

Oh that's great! I have a related problem to Dirk - except I run R CMD
check on my local machine, so while the checks are running, RGL
windows randomly pop up over the course of hours.

Hadley

-- 
http://had.co.nz/


From benjamin.hofner at fau.de  Tue Aug 18 12:06:22 2015
From: benjamin.hofner at fau.de (Benjamin Hofner)
Date: Tue, 18 Aug 2015 12:06:22 +0200
Subject: [R-pkg-devel] Strange timings reported from R CMD check
Message-ID: <55D3039E.5070605@fau.de>

Dear all,

When we prepared a release candidate form package mboost (see 
https://github.com/hofnerb/mboost/tree/master/pkg/mboostPatch for the 
code) we we found a strange issue regarding the timings. When running

R CMD check --as-cran

on the package mboost we found the following timings:

Linux (x86_64-pc-linux-gnu):
----------------------------

Examples with CPU or elapsed time > 5s
          user system elapsed
mboost 14.791  9.274   11.75


If I run on the Linux machine in R --vanilla the following command:

   system.time({ library("mboost"); example("mboost", ask = FALSE) })

i.e., load the package AND run the example I get a timing of

   user system elapsed
  2.840  1.374   3.051

To check the timings, I also used a Mac.

MacOS (x86_64-apple-darwin10.8.0):
----------------------------------

Examples with CPU or elapsed time > 5s
         user system elapsed
mboost 2.629  2.644     2.9

The MacOS note is very strange as it complains that time > 5s which it 
isn't. The Linux note is also strange as I cannot reproduce these timing 
at all if I run the code separately.

We have now shortened the example to comply with the CRAN policies (in 
any case) but wonder where these very different timings come from.

Is it a bug in R CMD check? Or does anyone know what the reason for 
these strange timings is?

Best,
Benjamin


From berryboessenkool at hotmail.com  Tue Aug 18 12:12:22 2015
From: berryboessenkool at hotmail.com (Berry Boessenkool)
Date: Tue, 18 Aug 2015 12:12:22 +0200
Subject: [R-pkg-devel] browseURL in examples
Message-ID: <DUB123-W3698323B29CF371E8E5D02D5780@phx.gbl>

Hi all,
 
In the CRAN package policies [1], it says 
 
"Packages should not start external software (such as PDF viewers or
browsers) during examples or tests unless that specific instance of
the software is explicitly closed afterwards."
 
If I want to refer to a website with browseURL in the examples, 
what's the most elegant way to do it? 

\dontrun --> obtrusive "## not run" parts, confuse new R-users
# browseURL("www.link.html") --> user must uncomment things


Or do you think links should only be used in Vignettes / References section?

In this case, it's a reference to a statistical method,
and yes, I slightly feel like I'm misusing the examples section.
But I think that's where most people explore function usage...


Thanks for any ideas and thoughts,
Berry

[1]
https://cran.r-project.org/web/packages/policies.html
 
 		 	   		  
	[[alternative HTML version deleted]]


From brian at braverock.com  Tue Aug 18 12:16:43 2015
From: brian at braverock.com (Brian G. Peterson)
Date: Tue, 18 Aug 2015 05:16:43 -0500
Subject: [R-pkg-devel] browseURL in examples
In-Reply-To: <DUB123-W3698323B29CF371E8E5D02D5780@phx.gbl>
References: <DUB123-W3698323B29CF371E8E5D02D5780@phx.gbl>
Message-ID: <55D3060B.5030204@braverock.com>

On 08/18/2015 05:12 AM, Berry Boessenkool wrote:
> Hi all,
>
> In the CRAN package policies [1], it says
>
> "Packages should not start external software (such as PDF viewers or
> browsers) during examples or tests unless that specific instance of
> the software is explicitly closed afterwards."
>
> If I want to refer to a website with browseURL in the examples,
> what's the most elegant way to do it?
>
> \dontrun --> obtrusive "## not run" parts, confuse new R-users
> # browseURL("www.link.html") --> user must uncomment things
>
>
> Or do you think links should only be used in Vignettes / References section?
>
> In this case, it's a reference to a statistical method,
> and yes, I slightly feel like I'm misusing the examples section.
> But I think that's where most people explore function usage...

I don't see how popping up browser windows for anything other than a 
demonstration of rendering something to HTML would ever make sense.

I think most people explore functions by typing ?functionName

Why not just put the links in the documentation for your function?



-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From murdoch.duncan at gmail.com  Tue Aug 18 13:20:44 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 18 Aug 2015 07:20:44 -0400
Subject: [R-pkg-devel] browseURL in examples
In-Reply-To: <DUB123-W3698323B29CF371E8E5D02D5780@phx.gbl>
References: <DUB123-W3698323B29CF371E8E5D02D5780@phx.gbl>
Message-ID: <55D3150C.7050005@gmail.com>

On 18/08/2015 6:12 AM, Berry Boessenkool wrote:
> Hi all,
>  
> In the CRAN package policies [1], it says 
>  
> "Packages should not start external software (such as PDF viewers or
> browsers) during examples or tests unless that specific instance of
> the software is explicitly closed afterwards."
>  
> If I want to refer to a website with browseURL in the examples, 
> what's the most elegant way to do it? 
> 
> \dontrun --> obtrusive "## not run" parts, confuse new R-users
> # browseURL("www.link.html") --> user must uncomment things

Using "if (interactive()) browseURL(...)" is a reasonable way.

Duncan Murdoch

> 
> 
> Or do you think links should only be used in Vignettes / References section?
> 
> In this case, it's a reference to a statistical method,
> and yes, I slightly feel like I'm misusing the examples section.
> But I think that's where most people explore function usage...
> 
> 
> Thanks for any ideas and thoughts,
> Berry
> 
> [1]
> https://cran.r-project.org/web/packages/policies.html
>  
>  		 	   		  
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From mark.vanderloo at gmail.com  Tue Aug 18 13:57:50 2015
From: mark.vanderloo at gmail.com (Mark van der Loo)
Date: Tue, 18 Aug 2015 11:57:50 +0000
Subject: [R-pkg-devel] browseURL in examples
In-Reply-To: <55D3150C.7050005@gmail.com>
References: <DUB123-W3698323B29CF371E8E5D02D5780@phx.gbl>
	<55D3150C.7050005@gmail.com>
Message-ID: <CAOKDuOiTmKK_v9LSHYSw3w6yavsnNiLdXE3-NQAwFBuX9PfeOw@mail.gmail.com>

Berry,

why not use

\href{[your link]}{[link text]}

in the documentation details[1]?

Best,
Mark
[1] https://cran.r-project.org/doc/manuals/R-exts.html#Marking-text



Op di 18 aug. 2015 om 13:21 schreef Duncan Murdoch <murdoch.duncan at gmail.com
>:

> On 18/08/2015 6:12 AM, Berry Boessenkool wrote:
> > Hi all,
> >
> > In the CRAN package policies [1], it says
> >
> > "Packages should not start external software (such as PDF viewers or
> > browsers) during examples or tests unless that specific instance of
> > the software is explicitly closed afterwards."
> >
> > If I want to refer to a website with browseURL in the examples,
> > what's the most elegant way to do it?
> >
> > \dontrun --> obtrusive "## not run" parts, confuse new R-users
> > # browseURL("www.link.html") --> user must uncomment things
>
> Using "if (interactive()) browseURL(...)" is a reasonable way.
>
> Duncan Murdoch
>
> >
> >
> > Or do you think links should only be used in Vignettes / References
> section?
> >
> > In this case, it's a reference to a statistical method,
> > and yes, I slightly feel like I'm misusing the examples section.
> > But I think that's where most people explore function usage...
> >
> >
> > Thanks for any ideas and thoughts,
> > Berry
> >
> > [1]
> > https://cran.r-project.org/web/packages/policies.html
> >
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From thierry.onkelinx at inbo.be  Wed Aug 19 14:59:51 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Wed, 19 Aug 2015 14:59:51 +0200
Subject: [R-pkg-devel] Running tests on 32-bit and 64-bit
In-Reply-To: <CAC2h7uszv+yHLkJeTrQ4Ss+Rai9yOqKkSA18utQTVijz_UfQsw@mail.gmail.com>
References: <CAJuCY5yH6U9M1xCgSNYfb12k+0kxHqAXE31hKiGKv9EAue+QGw@mail.gmail.com>
	<CAC2h7uszv+yHLkJeTrQ4Ss+Rai9yOqKkSA18utQTVijz_UfQsw@mail.gmail.com>
Message-ID: <CAJuCY5w7wCaBG8qNOiWLw4aSw6Py3i5HqFJa6WLLQtVkE8rR9w@mail.gmail.com>

Dear all,

Thanks for the feedback.

@Uwe
I'll have a look at winbuilder. Can it handle non-CRAN dependencies?
E.g. packages which are available on github or bitbucket?
I was rather looking for something which can run on my local machine.
That would give me faster feedback than a remote system. My current
setup is development on Win 32-bit and continuous integration on Linux
64-bit.

@Duncan
I was hoping for something as easy to use as devtools::test() I ended
by creating test_both() Feedback on the function is welcome.

test_both <- function(path = "."){
  path <- normalizePath(".", winslash = "/")
  commands <- paste0(
    Sys.getenv("R_HOME"),
    "/bin/",
    c("i386/", "x64/"),
    "Rscript.exe -e devtools::test('",
    path,
    "')"
  )
  for (command in commands) {
    system(command)
  }
}

@Kasper
Thanks for the suggestions. I tried both to use signif() and
sprintf("%f"), but both fail for time to time. My current solutions is
based on sprintf("%a"). num_32_64() converts numerics into a string
which is identical on both architecture. get_sha1() calculates the
SHA1 for different kinds of objects. You can find the code at
http://bitbucket.org/thierry_onkelinx/n2khelper

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no
more than asking him to perform a post-mortem examination: he may be
able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does
not ensure that a reasonable answer can be extracted from a given body
of data. ~ John Tukey


2015-08-17 14:21 GMT+02:00 Kasper Daniel Hansen <kasperdanielhansen at gmail.com>:
> Perhaps related: in the Bioconductor minfi package I do some checking on
> somewhat large matrices (450,000 times n).  To save space, I compute a hash
> of the correct result using the digest package.  As you, I ran into obvious
> issues with precision across platforms.  To solve this, I take the matrix
> and run it through sprintf() with (my choice) 6 digits and then I hash the
> resulting character matrix.  It works pretty nice for my purpose.
>
> You find minfi on github.  Code is in
>   inst/unitTests/test_preprocess.R  (testing using Runit)
>   inst/testData/testData/testData_preprocessQuantile.R (creating the
> reference "correct" matrix - this is only intended to be re-run when the
> algorithm change)
>   R/utils.R for the two convenience functions .digestMatrix and
> .digestVector
>
> Best,
> Kasper
>
> On Mon, Aug 17, 2015 at 5:03 AM, Thierry Onkelinx <thierry.onkelinx at inbo.be>
> wrote:
>>
>> Dear all,
>>
>> Is there an easy way to run the tests of a package on both a 32-bit and
>> 64-bit version? Ideally it should work when using R CMD check --as-cran on
>> all OS's. Although I expect that multi architecture versions are only
>> available on windows. So a Windows only solution will be fine as well.
>>
>> The origin of the problem is that I calculate some SHA1 hashed on objects
>> containing floating point numbers. The floating points have different
>> precision on 32-bit and 64-bit, and thus different hashes. I'm trying to
>> work around that problem. And thus need an easy way to run tests on both
>> 32-bit and 64-bit.
>>
>> Best regards,
>>
>> ir. Thierry Onkelinx
>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature and
>> Forest
>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>> Kliniekstraat 25
>> 1070 Anderlecht
>> Belgium
>>
>> To call in the statistician after the experiment is done may be no more
>> than asking him to perform a post-mortem examination: he may be able to
>> say
>> what the experiment died of. ~ Sir Ronald Aylmer Fisher
>> The plural of anecdote is not data. ~ Roger Brinner
>> The combination of some data and an aching desire for an answer does not
>> ensure that a reasonable answer can be extracted from a given body of
>> data.
>> ~ John Tukey
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>


From glennmschultz at me.com  Wed Aug 19 16:19:27 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Wed, 19 Aug 2015 14:19:27 +0000 (GMT)
Subject: [R-pkg-devel] Writing vignette and help files
Message-ID: <1a789953-32c6-4317-b8d1-8793ac00672b@me.com>

Hello All,

The package that I am working no longer gives warnings upon closing connections and syntax is used properly (and understood - thanks to all that answered my questions). ?I have two questions regarding package documentation.

Any special considerations when creating multiple vignettes?

I am working on the vignette using markdown and knitr and I was thinking of breaking this into three vignettes.
How to use the package
More detail on functions
Outline of classes
When does one consider a package ready to submit to CRAN?

The package passes the check in R Studio
Works on Windows, Mac, and Linux
It will be fully documented once I finish the vignettes
What it needs:
Friendly error exit (teaching myself about better error messages and nicer exiting)
Accessor functions
?I have been working on this package for about 2-1/2 years. I expect I could work on the above items for another 12 months. ?Is it a requirement that the "nicer" error messaging needs to done before submitting to CRAN? ?Right now, my package could replace a Bloomberg terminal for MBS pass-throughs and REMICs provided one has access to the required cusip data which is free and open source from the GSE websites (FNMA, FHLMC, and GNMA).

- Glenn

From sdjacobs at uchicago.edu  Wed Aug 19 20:39:11 2015
From: sdjacobs at uchicago.edu (Simon David Jacobs)
Date: Wed, 19 Aug 2015 18:39:11 +0000
Subject: [R-pkg-devel] Package with external non-Windows C library
Message-ID: <D1FA3780.137C1%sdjacobs@uchicago.edu>

Hi all,

I am trying to write an R package that relies on an external C library. My
understanding is that the prefered method is to include the C library in
the `src' folder of the package. I'm running into two problems that may
prevent this package from being distributed on CRAN:

1) The library is a standard configure; make; make install build. I don't
think it will be able to be installed on Windows without cygwin. Does this
automatically disqualify my package from being distributed on CRAN?

2) The library's makefiles have GNU extensions, leading to the following
WARNING with R CMD check:
* checking for GNU extensions in Makefiles ... WARNING
Found the following file(s) containing GNU extensions:
  src/snap-0.4/test/Makefile
  src/snap-0.4/test/Makefile.in
Portable Makefiles do not use GNU extensions such as +=, :=, $(shell),
$(wildcard), ifeq ... endif. See section ?Writing portable packages? in
the ?Writing R Extensions? manual.

Is there a possible workaround here without porting the library? FYI, the
library in question is the SNAP graph code:
http://snap-graph.sourceforge.net/

Thanks in advance.

Best,
Simon

--
Simon Jacobs
Research Programmer
Research Computing Center
University of Chicago
sdjacobs at uchicago.edu


From edd at debian.org  Wed Aug 19 21:12:49 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 19 Aug 2015 14:12:49 -0500
Subject: [R-pkg-devel] Package with external non-Windows C library
In-Reply-To: <D1FA3780.137C1%sdjacobs@uchicago.edu>
References: <D1FA3780.137C1%sdjacobs@uchicago.edu>
Message-ID: <21972.54577.261440.653559@max.nulle.part>


Hi Simon,

On 19 August 2015 at 18:39, Simon David Jacobs wrote:
| I am trying to write an R package that relies on an external C library. My
| understanding is that the prefered method is to include the C library in
| the `src' folder of the package. I'm running into two problems that may

There are examples for both approaches on CRAN (even within my packages).  It
can get tricky with more obscure libraries; snap by be an example for that.

| prevent this package from being distributed on CRAN:
| 
| 1) The library is a standard configure; make; make install build. I don't
| think it will be able to be installed on Windows without cygwin. Does this
| automatically disqualify my package from being distributed on CRAN?

It's complicated.  You could try pre-creating Makefiles for windows.  You
could exclude Windows (at least at the beginning).
 
| 2) The library's makefiles have GNU extensions, leading to the following
| WARNING with R CMD check:
| * checking for GNU extensions in Makefiles ... WARNING
| Found the following file(s) containing GNU extensions:
|   src/snap-0.4/test/Makefile
|   src/snap-0.4/test/Makefile.in
| Portable Makefiles do not use GNU extensions such as +=, :=, $(shell),
| $(wildcard), ifeq ... endif. See section ?Writing portable packages? in
| the ?Writing R Extensions? manual.
| 
| Is there a possible workaround here without porting the library? FYI, the

Yes, either rename each Makefile to GNUmakefile, or add 'GNU make' to
SystemRequirements. 

Hth, Dirk

| library in question is the SNAP graph code:
| http://snap-graph.sourceforge.net/
| 
| Thanks in advance.
| 
| Best,
| Simon
| 
| --
| Simon Jacobs
| Research Programmer
| Research Computing Center
| University of Chicago
| sdjacobs at uchicago.edu
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jfox at mcmaster.ca  Wed Aug 19 21:15:47 2015
From: jfox at mcmaster.ca (John Fox)
Date: Wed, 19 Aug 2015 15:15:47 -0400
Subject: [R-pkg-devel] recursive dependencies and install.packages()
Message-ID: <002001d0dab3$74144130$5c3cc390$@mcmaster.ca>

Dear list members,

I'm pretty sure (from memory) that this was discussed before but I can't
find a relevant thread.

The Rcmdr packages "depends" on the RcmdrMisc package which "depends" on the
Hmisc package which "imports" the ggplot2 package.

When the Rcmdr package is installed via install.packages("Rcmdr"), i.e.,
with all arguments other than pkgs at their defaults, the RcmdrMisc and
Hmisc packages are installed but not ggplot2, causing the Rcmdr to fail to
load, unless ggplot2 is installed directly.

>From ?install.packages I see:

---------- snip ---------
Dependencies:	
logical indicating whether to also install uninstalled packages which these
packages depend on/link to/import/suggest (and so on recursively). Not used
if repos = NULL. Can also be a character vector, a subset of c("Depends",
"Imports", "LinkingTo", "Suggests", "Enhances").
Only supported if lib is of length one (or missing), so it is unambiguous
where to install the dependent packages. If this is not the case it is
ignored, with a warning.
The default, NA, means c("Depends", "Imports", "LinkingTo").
TRUE means to use c("Depends", "Imports", "LinkingTo", "Suggests") for pkgs
and c("Depends", "Imports", "LinkingTo") for added dependencies: this
installs all the packages needed to run pkgs, their examples, tests and
vignettes (if the package author specified them correctly).
In all of these, "LinkingTo" is omitted for binary packages.

---------- snip ---------

from which I infer, obviously incorrectly, that the three-deep recursive
dependency on ggplot2 would cause it to be installed.

So, two questions:

(1) What is the correct understanding of how recursive dependencies are
handled by install.packages() with default arguments?

(2) What is the best fix assuming that na?ve users will use
install.packages() with default arguments? I can specify that RcmdrMisc
"imports" ggplot2, which I believe will cause ggplot2 to be installed when
the Rcmdr package is installed, since the recursive dependency would then be
two deep, which apparently works. Is that a reasonable solution? (It seems
like a kludge to me.)

Thanks for any help,

John

-----------------------------------------------
John Fox, Professor
McMaster University
Hamilton, Ontario, Canada
http://socserv.socsci.mcmaster.ca/jfox/


From jfox at mcmaster.ca  Wed Aug 19 21:57:24 2015
From: jfox at mcmaster.ca (John Fox)
Date: Wed, 19 Aug 2015 15:57:24 -0400
Subject: [R-pkg-devel] recursive dependencies and install.packages()
In-Reply-To: <28187_1440011769_t7JJG8do016066_002001d0dab3$74144130$5c3cc390$@mcmaster.ca>
References: <28187_1440011769_t7JJG8do016066_002001d0dab3$74144130$5c3cc390$@mcmaster.ca>
Message-ID: <002501d0dab9$44866e10$cd934a30$@mcmaster.ca>

Dear list members,

My question was prompted by a message from a user indicating that loading
the Rcmdr package following installation via install.packages("Rcmdr")
failed in the manner I indicated, with the indirect dependency ggplot2
missing. 

I thought that I was able to duplicate this error by deleting the Rcmdr,
RcmdrMisc, Hmisc, and ggplot packages from the R 3.2.2 library on my Windows
10 system and then reinstalling the Rcmdr package via
install.packages("Rcmdr"). But when I tried installing the Rcmdr on a
Windows (8) machine with a newly installed R 3.2.2, I was unable to
duplicate the error. That is, everything worked fine, including the
recursively installed ggplot2 dependency.

I subsequently uninstalled R 3.2.2 from my Windows 10 machine, deleted the R
3.2.2 library, and reinstalled R 3.2.2 and the Rcmdr package. Again,
everything worked as expected.

So I expect that my original message reflected idiosyncratic errors (the
source of which I don't understand) -- and that recursive dependencies are
in fact resolved as I understood, and as implied by ?install.packages.

My apologies for what appears to be a false alarm.

John

> -----Original Message-----
> From: R-package-devel [mailto:r-package-devel-bounces at r-project.org] On
> Behalf Of John Fox
> Sent: Wednesday, August 19, 2015 3:16 PM
> To: r-package-devel at r-project.org
> Subject: [R-pkg-devel] recursive dependencies and install.packages()
> 
> Dear list members,
> 
> I'm pretty sure (from memory) that this was discussed before but I can't
> find a relevant thread.
> 
> The Rcmdr packages "depends" on the RcmdrMisc package which "depends" on
> the
> Hmisc package which "imports" the ggplot2 package.
> 
> When the Rcmdr package is installed via install.packages("Rcmdr"), i.e.,
> with all arguments other than pkgs at their defaults, the RcmdrMisc and
> Hmisc packages are installed but not ggplot2, causing the Rcmdr to fail
> to
> load, unless ggplot2 is installed directly.
> 
> >From ?install.packages I see:
> 
> ---------- snip ---------
> Dependencies:
> logical indicating whether to also install uninstalled packages which
> these
> packages depend on/link to/import/suggest (and so on recursively). Not
> used
> if repos = NULL. Can also be a character vector, a subset of
> c("Depends",
> "Imports", "LinkingTo", "Suggests", "Enhances").
> Only supported if lib is of length one (or missing), so it is
> unambiguous
> where to install the dependent packages. If this is not the case it is
> ignored, with a warning.
> The default, NA, means c("Depends", "Imports", "LinkingTo").
> TRUE means to use c("Depends", "Imports", "LinkingTo", "Suggests") for
> pkgs
> and c("Depends", "Imports", "LinkingTo") for added dependencies: this
> installs all the packages needed to run pkgs, their examples, tests and
> vignettes (if the package author specified them correctly).
> In all of these, "LinkingTo" is omitted for binary packages.
> 
> ---------- snip ---------
> 
> from which I infer, obviously incorrectly, that the three-deep recursive
> dependency on ggplot2 would cause it to be installed.
> 
> So, two questions:
> 
> (1) What is the correct understanding of how recursive dependencies are
> handled by install.packages() with default arguments?
> 
> (2) What is the best fix assuming that na?ve users will use
> install.packages() with default arguments? I can specify that RcmdrMisc
> "imports" ggplot2, which I believe will cause ggplot2 to be installed
> when
> the Rcmdr package is installed, since the recursive dependency would
> then be
> two deep, which apparently works. Is that a reasonable solution? (It
> seems
> like a kludge to me.)
> 
> Thanks for any help,
> 
> John
> 
> -----------------------------------------------
> John Fox, Professor
> McMaster University
> Hamilton, Ontario, Canada
> http://socserv.socsci.mcmaster.ca/jfox/
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From dstr7320 at uni.sydney.edu.au  Thu Aug 20 07:00:06 2015
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Thu, 20 Aug 2015 05:00:06 +0000
Subject: [R-pkg-devel] Browser Level for Conditional Function Parameter
Message-ID: <SN1PR0101MB1439C11363D008BE6B70F33FCD660@SN1PR0101MB1439.prod.exchangelabs.com>

Good day,

Why do I get a debug message and a change in browser level when I inspect the title variable ? For the comparison variable, it simply prints its value and remains at level 1.

aFunction <- function(comparison = c("within", "classifier", "selection"),
                      title = if(comparison[1] == "within") "Internal" else "Between")
{
    browser()
    require(ggplot2)
    comparison <- match.arg(comparison)
    ggplot(mtcars, aes(wt, mpg)) + geom_point() + ggtitle(title)
}

aFunction()

Browse[1]> title
debug at #4: [1] "Internal"
Browse[3]>

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia

From berryboessenkool at hotmail.com  Thu Aug 20 13:06:16 2015
From: berryboessenkool at hotmail.com (Berry Boessenkool)
Date: Thu, 20 Aug 2015 13:06:16 +0200
Subject: [R-pkg-devel] Browser Level for Conditional Function Parameter
In-Reply-To: <SN1PR0101MB1439C11363D008BE6B70F33FCD660@SN1PR0101MB1439.prod.exchangelabs.com>
References: <SN1PR0101MB1439C11363D008BE6B70F33FCD660@SN1PR0101MB1439.prod.exchangelabs.com>
Message-ID: <DUB123-W16A282F7700D020FC01E40D5660@phx.gbl>


I always get the browser level change in combination with if-statements...

You haven't by change at some point in time set
debug(aFunction)
If so, set
undebug(aFunction)

Berry


> From: dstr7320 at uni.sydney.edu.au
> To: r-package-devel at r-project.org
> Date: Thu, 20 Aug 2015 05:00:06 +0000
> Subject: [R-pkg-devel] Browser Level for Conditional Function Parameter
> 
> Good day,
> 
> Why do I get a debug message and a change in browser level when I inspect the title variable ? For the comparison variable, it simply prints its value and remains at level 1.
> 
> aFunction <- function(comparison = c("within", "classifier", "selection"),
>                       title = if(comparison[1] == "within") "Internal" else "Between")
> {
>     browser()
>     require(ggplot2)
>     comparison <- match.arg(comparison)
>     ggplot(mtcars, aes(wt, mpg)) + geom_point() + ggtitle(title)
> }
> 
> aFunction()
> 
> Browse[1]> title
> debug at #4: [1] "Internal"
> Browse[3]>
> 
> --------------------------------------
> Dario Strbenac
> PhD Student
> University of Sydney
> Camperdown NSW 2050
> Australia
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
 		 	   		  
	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Thu Aug 20 14:20:11 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 20 Aug 2015 08:20:11 -0400
Subject: [R-pkg-devel] Browser Level for Conditional Function Parameter
In-Reply-To: <SN1PR0101MB1439C11363D008BE6B70F33FCD660@SN1PR0101MB1439.prod.exchangelabs.com>
References: <SN1PR0101MB1439C11363D008BE6B70F33FCD660@SN1PR0101MB1439.prod.exchangelabs.com>
Message-ID: <55D5C5FB.9010102@gmail.com>

On 20/08/2015 1:00 AM, Dario Strbenac wrote:
> Good day,
> 
> Why do I get a debug message and a change in browser level when I inspect the title variable ? For the comparison variable, it simply prints its value and remains at level 1.

This is an R-devel question, not an R-pkg-devel question.

You get the break there because displaying title requires code to be
evaluated (the default value is an expression), and the browser will
break while evaluating that code.  The "debug" message comes because it
is on line 4 of your function that it is breaking.  If it had been in a
file that you sourced, it would give the line number from that file.

Duncan Murdoch

> aFunction <- function(comparison = c("within", "classifier", "selection"),
>                       title = if(comparison[1] == "within") "Internal" else "Between")
> {
>     browser()
>     require(ggplot2)
>     comparison <- match.arg(comparison)
>     ggplot(mtcars, aes(wt, mpg)) + geom_point() + ggtitle(title)
> }
> 
> aFunction()
> 
> Browse[1]> title
> debug at #4: [1] "Internal"
> Browse[3]>
> 
> --------------------------------------
> Dario Strbenac
> PhD Student
> University of Sydney
> Camperdown NSW 2050
> Australia
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From jpritikin at pobox.com  Fri Aug 21 22:31:44 2015
From: jpritikin at pobox.com (Joshua N Pritikin)
Date: Fri, 21 Aug 2015 16:31:44 -0400
Subject: [R-pkg-devel] openmp
Message-ID: <20150821203144.GH4463@droplet>

Many CRAN packages offer improved performance when compiled with 
OpenMP. However, the MacOS and Windows binaries built by CRAN are built 
without openmp enabled. Would it be possible to build openmp enabled 
binaries for some CRAN packages?

-- 
Joshua N. Pritikin
Department of Psychology
University of Virginia
485 McCormick Rd, Gilmer Hall Room 102
Charlottesville, VA 22904
http://people.virginia.edu/~jnp3bc


From jpritikin at pobox.com  Mon Aug 24 15:14:42 2015
From: jpritikin at pobox.com (Joshua N Pritikin)
Date: Mon, 24 Aug 2015 09:14:42 -0400
Subject: [R-pkg-devel] openmp
In-Reply-To: <CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
Message-ID: <20150824131442.GA18349@droplet>

On Sun, Aug 23, 2015 at 08:01:08AM +0200, Mark van der Loo wrote:
>    Afaik, openmp is available on windows. According to writing R
>    extensions:
> 
>    There is nothing to say what version of OpenMP is supported: version
>    3.0 (May 2008) is supported by recent versions of the Linux, _Windows_
>    and Solaris platforms, but portable packages cannot assume that end
>    users have recent versions. OS X nowadays uses clang, and the Apple
>    builds currently have no OpenMP support.

So I take that answer as, "No, CRAN cannot possibly enable openmp for 
binary builds." Is that correct?

>    Op 21 aug. 2015 22:50 schreef "Joshua N Pritikin"
>    <[1]jpritikin at pobox.com>:
>      Many CRAN packages offer improved performance when compiled with
>      OpenMP. However, the MacOS and Windows binaries built by CRAN are
>      built
>      without openmp enabled. Would it be possible to build openmp enabled
>      binaries for some CRAN packages?

-- 
Joshua N. Pritikin
Department of Psychology
University of Virginia
485 McCormick Rd, Gilmer Hall Room 102
Charlottesville, VA 22904
http://people.virginia.edu/~jnp3bc


From edd at debian.org  Mon Aug 24 16:29:34 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 24 Aug 2015 09:29:34 -0500
Subject: [R-pkg-devel] openmp
In-Reply-To: <20150824131442.GA18349@droplet>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
Message-ID: <21979.10830.554717.433634@max.nulle.part>


On 24 August 2015 at 09:14, Joshua N Pritikin wrote:
| On Sun, Aug 23, 2015 at 08:01:08AM +0200, Mark van der Loo wrote:
| >    Afaik, openmp is available on windows. According to writing R
| >    extensions:
| > 
| >    There is nothing to say what version of OpenMP is supported: version
| >    3.0 (May 2008) is supported by recent versions of the Linux, _Windows_
| >    and Solaris platforms, but portable packages cannot assume that end
| >    users have recent versions. OS X nowadays uses clang, and the Apple
| >    builds currently have no OpenMP support.
| 
| So I take that answer as, "No, CRAN cannot possibly enable openmp for 
| binary builds." Is that correct?

The CRAN maintainers are not withholding OpenMP from you because they are meanies.

But they may do so because it is not reliable or performant on some of the
platforms.  This issue has been discussed before, Luke Tierney in particular
is quite on top of this has made comments in the past that performance might
"soon" catch up in the OS X implementation.  OpenMP _is_ used in R itself and
by a number of packages.  Your best bet may be to test for it with a
configure script, and maybe to talk to the respective CRAN maintainers for
Windows and OS X if you have particular questions, there.

| 
| >    Op 21 aug. 2015 22:50 schreef "Joshua N Pritikin"
| >    <[1]jpritikin at pobox.com>:
| >      Many CRAN packages offer improved performance when compiled with
| >      OpenMP. However, the MacOS and Windows binaries built by CRAN are
| >      built
| >      without openmp enabled. Would it be possible to build openmp enabled
| >      binaries for some CRAN packages?
| 
| -- 
| Joshua N. Pritikin
| Department of Psychology
| University of Virginia
| 485 McCormick Rd, Gilmer Hall Room 102
| Charlottesville, VA 22904
| http://people.virginia.edu/~jnp3bc
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jpritikin at pobox.com  Mon Aug 24 17:02:31 2015
From: jpritikin at pobox.com (Joshua N Pritikin)
Date: Mon, 24 Aug 2015 11:02:31 -0400
Subject: [R-pkg-devel] [[openmx-dev]] Re:  openmp
In-Reply-To: <21979.10830.554717.433634@max.nulle.part>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
	<21979.10830.554717.433634@max.nulle.part>
Message-ID: <20150824150231.GB25533@droplet>

On Mon, Aug 24, 2015 at 09:29:34AM -0500, Dirk Eddelbuettel wrote:
> On 24 August 2015 at 09:14, Joshua N Pritikin wrote:
> | So I take that answer as, "No, CRAN cannot possibly enable openmp for 
> | binary builds." Is that correct?
> 
> The CRAN maintainers are not withholding OpenMP from you because they 
> are meanies.
> 
> But they may do so because it is not reliable or performant on some of 
> the platforms.  This issue has been discussed before, Luke Tierney in 
> particular is quite on top of this has made comments in the past that 
> performance might "soon" catch up in the OS X implementation.  OpenMP 
> _is_ used in R itself and by a number of packages.  Your best bet may 
> be to test for it with a configure script, and maybe to talk to the 
> respective CRAN maintainers for Windows and OS X if you have 
> particular questions, there.

Currently, we have a configure script for package OpenMx that only 
enables openmp if gcc is the compiler (OS X only). Nice to hear that 
openmp is supported on Windows.

Are there any CRAN packages that actually compile to openmp enabled 
binaries on CRAN? I'd prefer if we weren't breaking new ground here. I'd 
love to copy an already working configure script instead of trying to 
write it for the first time.

-- 
Joshua N. Pritikin
Department of Psychology
University of Virginia
485 McCormick Rd, Gilmer Hall Room 102
Charlottesville, VA 22904
http://people.virginia.edu/~jnp3bc


From edd at debian.org  Mon Aug 24 17:14:10 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 24 Aug 2015 10:14:10 -0500
Subject: [R-pkg-devel] [[openmx-dev]] Re:  openmp
In-Reply-To: <20150824150231.GB25533@droplet>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
	<21979.10830.554717.433634@max.nulle.part>
	<20150824150231.GB25533@droplet>
Message-ID: <21979.13506.424812.143567@max.nulle.part>


On 24 August 2015 at 11:02, Joshua N Pritikin wrote:
| Currently, we have a configure script for package OpenMx that only 
| enables openmp if gcc is the compiler (OS X only). Nice to hear that 
| openmp is supported on Windows.

Interesting that you opt to ignore OpenMP support on the platform that
probably supports it best ...

| 
| Are there any CRAN packages that actually compile to openmp enabled 
| binaries on CRAN? I'd prefer if we weren't breaking new ground here. I'd 
| love to copy an already working configure script instead of trying to 
| write it for the first time.

edd at xmcorsairs:~/CRAN$ grep -l openmp */src/Makevars*
FRESA.CAD/src/Makevars.win
laGP/src/Makevars
maptpx/src/Makevars
mvnfast/src/Makevars
ndl/src/Makevars.win
PropClust/src/Makevars
rpf/src/Makevars
SOD/src/Makevars.in
SOD/src/Makevars.win
edd at xmcorsairs:~/CRAN$ 

That is highly incomplete as I didn't even bother tp grep configure scripts.
Maybe you can take it from here.  Gabor's excellent MetaCRAN also gives you
search tools.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jpritikin at pobox.com  Mon Aug 24 17:46:00 2015
From: jpritikin at pobox.com (Joshua N Pritikin)
Date: Mon, 24 Aug 2015 11:46:00 -0400
Subject: [R-pkg-devel] [[openmx-dev]] Re: [[openmx-dev]] Re:  openmp
In-Reply-To: <21979.13506.424812.143567@max.nulle.part>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
	<21979.10830.554717.433634@max.nulle.part>
	<20150824150231.GB25533@droplet>
	<21979.13506.424812.143567@max.nulle.part>
Message-ID: <20150824154600.GC25533@droplet>

On Mon, Aug 24, 2015 at 10:14:10AM -0500, Dirk Eddelbuettel wrote:
> On 24 August 2015 at 11:02, Joshua N Pritikin wrote:
> | Currently, we have a configure script for package OpenMx that only 
> | enables openmp if gcc is the compiler (OS X only). Nice to hear that 
> | openmp is supported on Windows.
> 
> Interesting that you opt to ignore OpenMP support on the platform that
> probably supports it best ...

Do you mean Linux? Yeah, we do enable OpenMP on gcc+Linux but CRAN 
doesn't compile binaries for Linux so it's up to the user to have things 
set up properly.

-- 
Joshua N. Pritikin
Department of Psychology
University of Virginia
485 McCormick Rd, Gilmer Hall Room 102
Charlottesville, VA 22904
http://people.virginia.edu/~jnp3bc


From jpritikin at pobox.com  Mon Aug 24 18:51:28 2015
From: jpritikin at pobox.com (Joshua N Pritikin)
Date: Mon, 24 Aug 2015 12:51:28 -0400
Subject: [R-pkg-devel] [mcneale@mac.com: Re: [[openmx-dev]] Re:
 [[openmx-dev]] Re: [[openmx-dev]] Re: openmp]
Message-ID: <20150824165128.GG25533@droplet>

Dirk, I pick one of the packages you suggested and asked my colleague to 
test it on MacOS X. As you can see, it did not use more than 1 CPU. I 
inspected the Makevars and found that it relied on 
SHLIB_OPENMP_CXXFLAGS. This variable is set to -fopenmp on my laptop.

Does CRAN add -fopenmp to SHLIB_OPENMP_CXXFLAGS (when there is compiler 
support) or not? It seems not.

-- 
Joshua N. Pritikin
Department of Psychology
University of Virginia
485 McCormick Rd, Gilmer Hall Room 102
Charlottesville, VA 22904
http://people.virginia.edu/~jnp3bc
-------------- next part --------------
An embedded message was scrubbed...
From: Michael Neale <mcneale at mac.com>
Subject: Re: [[openmx-dev]] Re: [[openmx-dev]] Re: [[openmx-dev]] Re: [R-pkg-devel] openmp
Date: Mon, 24 Aug 2015 12:25:12 -0400
Size: 3693
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20150824/96efd608/attachment.mht>

From kamvarz at science.oregonstate.edu  Mon Aug 24 18:57:52 2015
From: kamvarz at science.oregonstate.edu (Zhian Kamvar)
Date: Mon, 24 Aug 2015 09:57:52 -0700
Subject: [R-pkg-devel] [[openmx-dev]] Re: [[openmx-dev]] Re:  openmp
In-Reply-To: <20150824154600.GC25533@droplet>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
	<21979.10830.554717.433634@max.nulle.part>
	<20150824150231.GB25533@droplet>
	<21979.13506.424812.143567@max.nulle.part>
	<20150824154600.GC25533@droplet>
Message-ID: <C6F8A747-43F2-4364-A5B8-D91C51CD5493@science.oregonstate.edu>

The way several packages have implemented OpenMP is to wrap it in pre-compiler statements i.e.:

// Include openMP if the compiler supports it
#ifdef _OPENMP
#include <omp.h>
#endif

This way, all compilers can build the code and those that have OpenMP (even modified versions of clang: https://clang-omp.github.io/) can do so in a parallel fashion.

> On Aug 24, 2015, at 08:46 , Joshua N Pritikin <jpritikin at pobox.com> wrote:
> 
> On Mon, Aug 24, 2015 at 10:14:10AM -0500, Dirk Eddelbuettel wrote:
>> On 24 August 2015 at 11:02, Joshua N Pritikin wrote:
>> | Currently, we have a configure script for package OpenMx that only 
>> | enables openmp if gcc is the compiler (OS X only). Nice to hear that 
>> | openmp is supported on Windows.
>> 
>> Interesting that you opt to ignore OpenMP support on the platform that
>> probably supports it best ...
> 
> Do you mean Linux? Yeah, we do enable OpenMP on gcc+Linux but CRAN 
> doesn't compile binaries for Linux so it's up to the user to have things 
> set up properly.
> 
> -- 
> Joshua N. Pritikin
> Department of Psychology
> University of Virginia
> 485 McCormick Rd, Gilmer Hall Room 102
> Charlottesville, VA 22904
> http://people.virginia.edu/~jnp3bc
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jpritikin at pobox.com  Mon Aug 24 19:03:00 2015
From: jpritikin at pobox.com (Joshua N Pritikin)
Date: Mon, 24 Aug 2015 13:03:00 -0400
Subject: [R-pkg-devel] [[openmx-dev]] Re: [[openmx-dev]] Re:  openmp
In-Reply-To: <63E0F4C8-6D01-405F-8060-1F91B10C0164@gmail.com>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
	<21979.10830.554717.433634@max.nulle.part>
	<20150824150231.GB25533@droplet>
	<21979.13506.424812.143567@max.nulle.part>
	<20150824154600.GC25533@droplet>
	<63E0F4C8-6D01-405F-8060-1F91B10C0164@gmail.com>
Message-ID: <20150824170300.GH25533@droplet>

On Mon, Aug 24, 2015 at 09:57:05AM -0700, Zhian Kamvar wrote:
> The way several packages have implemented OpenMP is to wrap it in 
> pre-compiler statements i.e.:
> 
> // Include openMP if the compiler supports it
> #ifdef _OPENMP
> #include <omp.h>
> #endif
> 
> This way, all compilers can build the code and those that have OpenMP 
> (even modified versions of clang: https://clang-omp.github.io/) can do 
> so in a parallel fashion.

Yes, of course, but you're missing the point of my enquiry. My question 
is whether it is possible for CRAN to build and distribute openmp 
enabled binaries.

-- 
Joshua N. Pritikin
Department of Psychology
University of Virginia
485 McCormick Rd, Gilmer Hall Room 102
Charlottesville, VA 22904
http://people.virginia.edu/~jnp3bc


From mark.vanderloo at gmail.com  Mon Aug 24 21:38:35 2015
From: mark.vanderloo at gmail.com (Mark van der Loo)
Date: Mon, 24 Aug 2015 19:38:35 +0000
Subject: [R-pkg-devel] [[openmx-dev]] Re: [[openmx-dev]] Re: openmp
In-Reply-To: <20150824170300.GH25533@droplet>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
	<21979.10830.554717.433634@max.nulle.part>
	<20150824150231.GB25533@droplet>
	<21979.13506.424812.143567@max.nulle.part>
	<20150824154600.GC25533@droplet>
	<63E0F4C8-6D01-405F-8060-1F91B10C0164@gmail.com>
	<20150824170300.GH25533@droplet>
Message-ID: <CAOKDuOhSzkZLEoQ=gRuu4g_6Yugngc5hZNVZPDe_3+WP0Qw9AA@mail.gmail.com>

At least on linux, CRAN builds using openMP. I got a valgrind report once
[shame on me btw] showing that 9 (out of 10) threads were running examples.


So my best guess is that it will do the same for Windows since it also has
openMP support according to WRE[1].  I wouldn't know why not, except for
the reasons Dirk already mentioned. It will not do this for OS X since WRE
states clearly that

OS X nowadays uses clang, and the Apple builds currently have no OpenMP
support.

so if nobody has openMP support on OS X, for sure CRAN doesn't have it.
/M

[1]https://cran.r-project.org/doc/manuals/R-exts.html#OpenMP-support



Op ma 24 aug. 2015 om 19:04 schreef Joshua N Pritikin <jpritikin at pobox.com>:

> On Mon, Aug 24, 2015 at 09:57:05AM -0700, Zhian Kamvar wrote:
> > The way several packages have implemented OpenMP is to wrap it in
> > pre-compiler statements i.e.:
> >
> > // Include openMP if the compiler supports it
> > #ifdef _OPENMP
> > #include <omp.h>
> > #endif
> >
> > This way, all compilers can build the code and those that have OpenMP
> > (even modified versions of clang: https://clang-omp.github.io/) can do
> > so in a parallel fashion.
>
> Yes, of course, but you're missing the point of my enquiry. My question
> is whether it is possible for CRAN to build and distribute openmp
> enabled binaries.
>
> --
> Joshua N. Pritikin
> Department of Psychology
> University of Virginia
> 485 McCormick Rd, Gilmer Hall Room 102
> Charlottesville, VA 22904
> http://people.virginia.edu/~jnp3bc
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From mark.vanderloo at gmail.com  Tue Aug 25 08:06:55 2015
From: mark.vanderloo at gmail.com (Mark van der Loo)
Date: Tue, 25 Aug 2015 06:06:55 +0000
Subject: [R-pkg-devel] [[openmx-dev]] [[openmx-dev]] Re: [[openmx-dev]]
 Re: openmp
In-Reply-To: <976B19BD-EA0F-427F-9B67-134ECED6E44F@mac.com>
References: <20150821203144.GH4463@droplet>
	<CAOKDuOjyNEpNsWNgmz25+90YfN0wQU_PiiSAVhd6MoJDNPv+JA@mail.gmail.com>
	<20150824131442.GA18349@droplet>
	<21979.10830.554717.433634@max.nulle.part>
	<20150824150231.GB25533@droplet>
	<21979.13506.424812.143567@max.nulle.part>
	<20150824154600.GC25533@droplet>
	<63E0F4C8-6D01-405F-8060-1F91B10C0164@gmail.com>
	<20150824170300.GH25533@droplet>
	<CAOKDuOhSzkZLEoQ=gRuu4g_6Yugngc5hZNVZPDe_3+WP0Qw9AA@mail.gmail.com>
	<976B19BD-EA0F-427F-9B67-134ECED6E44F@mac.com>
Message-ID: <CAOKDuOjwRiaNtk0Q2nax+SHenCLCGqs7ZoHfg8o=1DFwbvTMsA@mail.gmail.com>

If you want to distributed such binaries, I would suggest using the 'drat'
package to set up your own repo. I'm using it for beta versions of my
packages and I find it very useful and easy to use. The latest version of
'drat' also supports binaries.

Or, vote with your feet and switch to Linux ;-).

/M



Op ma 24 aug. 2015 om 23:44 schreef Michael Neale <mcneale at mac.com>:

> Yes, well, we have support for our own parallel build of an OS X version
> of R package using OpenMP and gcc, but I don?t suppose that CRAN
> maintainers would be interested in also supporting OS X in this fashion.
> Supplying binaries seems the only option unless clang developers decide to
> support OpenMP, which seems unlikely since Apple wants to promote its own
> parallel computing tools.
>
> Michael Neale
> mcneale at mac.com
>
>
>
> On Aug 24, 2015, at 3:38 PM, Mark van der Loo <mark.vanderloo at gmail.com>
> wrote:
>
>
> At least on linux, CRAN builds using openMP. I got a valgrind report once
> [shame on me btw] showing that 9 (out of 10) threads were running examples.
>
>
> So my best guess is that it will do the same for Windows since it also has
> openMP support according to WRE[1].  I wouldn't know why not, except for
> the reasons Dirk already mentioned. It will not do this for OS X since WRE
> states clearly that
>
> OS X nowadays uses clang, and the Apple builds currently have no OpenMP
> support.
>
> so if nobody has openMP support on OS X, for sure CRAN doesn't have it.
> /M
>
> [1]https://cran.r-project.org/doc/manuals/R-exts.html#OpenMP-support
>
>
>
> Op ma 24 aug. 2015 om 19:04 schreef Joshua N Pritikin <jpritikin at pobox.com
> >:
>
>> On Mon, Aug 24, 2015 at 09:57:05AM -0700, Zhian Kamvar wrote:
>> > The way several packages have implemented OpenMP is to wrap it in
>> > pre-compiler statements i.e.:
>> >
>> > // Include openMP if the compiler supports it
>> > #ifdef _OPENMP
>> > #include <omp.h>
>> > #endif
>> >
>> > This way, all compilers can build the code and those that have OpenMP
>> > (even modified versions of clang: https://clang-omp.github.io/) can do
>> > so in a parallel fashion.
>>
>> Yes, of course, but you're missing the point of my enquiry. My question
>> is whether it is possible for CRAN to build and distribute openmp
>> enabled binaries.
>>
>> --
>> Joshua N. Pritikin
>> Department of Psychology
>> University of Virginia
>> 485 McCormick Rd, Gilmer Hall Room 102
>> Charlottesville, VA 22904
>> http://people.virginia.edu/~jnp3bc
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
>

	[[alternative HTML version deleted]]


From complexm at gmail.com  Tue Aug 25 12:14:44 2015
From: complexm at gmail.com (code M)
Date: Tue, 25 Aug 2015 12:14:44 +0200
Subject: [R-pkg-devel] how to reproduce an ASAN container overflow
Message-ID: <CAA2dc0Dp8xY-Ub8VOJjmZR1L0RUbwgw2z7p59ntdrWgaLCXGOA@mail.gmail.com>

dear all,

i am trying for three days to reproduce the container overflow in my
package,
alas i am not able to. for the full output see:
http://www.stats.ox.ac.uk/pub/bdr/memtests/clang-ASAN/lasvmR/00check.log

the error seems actually to be easy (vector::clear before std::copy), but i
want
to be sure that the cran-check does not fail again. so i'd like to
reproduce the error
first. from dirks tutorial (
http://dirk.eddelbuettel.com/code/sanitizers.html),
i would assume that if the sanitiziers package work, i'd be good,
i.e. running docker yields the following on my ubuntu 15.10 (alpha):


~$ docker run --rm -ti -v $(pwd):/mnt rocker/r-devel-san /bin/bash
root at 126d39bbe93f:/#  Rdevel -e
"install.packages('sanitizers');library(sanitizers);
print(stackAddressSanitize(42))"

--- CUT ---

stack_address.cpp:16:32: runtime error: index 142 out of bounds for type
'int [100]'
stack_address.cpp:16:33: runtime error: load of address 0x7ffde3477988 with
insufficient space for an object of type 'int'
0x7ffde3477988: note: pointer points here
 d0 61 00 00  e0 7c b4 02 d0 61 00 00  b3 8a b5 41 00 00 00 00  60 5e f2 ff
22 7f 00 00  c0 61 99 ff
              ^
[1] 45382880
>

=================================================================
==11==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 6 byte(s) in 2 object(s) allocated from:
    #0 0x7f2300e8537a in malloc
(/usr/lib/x86_64-linux-gnu/libasan.so.2+0x9437a)
    #1 0x7f22fd8ba9e9 in strdup (/lib/x86_64-linux-gnu/libc.so.6+0x819e9)

SUMMARY: AddressSanitizer: 6 byte(s) leaked in 2 allocation(s).
root at 126d39bbe93f:/#


so checking my program in this docker environment with Rdevel should more
or less reproduce the cran report above. but it does not. so "Rdevel CMD
build ."
and then "Rdevel CMD check --as-cran ./lasvmR_0.1.1.tar.gz" yields no
relevant
error:


$ Rdevel CMD check --as-cran ./lasvmR_0.1.1.tar.gz
--- CUT ---
* checking for unstated dependencies in examples ... WARNING
summary.c:876:5: runtime error: null pointer passed as argument 2, which is
declared to never be null
* checking line endings in C/C++/Fortran sources/headers ... OK
* checking compiled code ... OK
 WARNING
?qpdf? is needed for checks on size reduction of PDFs
* checking installed files from ?inst/doc? ... OK
* checking files in ?vignettes? ... OK
* checking examples ... OK
--- CUT ---

=================================================================
==602==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 72128 byte(s) in 2 object(s) allocated from:
    #0 0x7f3836fca4e1 in __interceptor_calloc
(/usr/lib/x86_64-linux-gnu/libasan.so.2+0x944e1)
    #1 0x7f382a3e08d9  (/usr/lib/x86_64-linux-gnu/libcurl.so.4+0x1e8d9)
    #2 0xf98996c57a955ff  (<unknown module>)
--- CUT ---


the compile flags in 00install.out seems also ok for me (with no error or
warnings)


--- CUT ---
g++ -fsanitize=address,undefined -I/usr/local/lib/R/include -DNDEBUG
 -I/usr/local/include -I"/usr/local/lib/R/site-library/Rcpp/include"
-fpic  -pipe -Wall -pedantic -O3  -c vector.cpp -o vector.o
g++ -fsanitize=address,undefined -shared -L/usr/local/lib/R/lib
-L/usr/local/lib -o lasvmR.so RcppExports.o kcache.o kernel.o la_svm.o
la_test.o lasvm.o lasvm_wrapper.o messages.o vector.o
-L/usr/local/lib/R/lib -lR
--- CUT ---


i also tried to recompile R-devel from svn locally on my machine with
various
-fsanitize options and exchanging gcc with clang (this i could not do on
the
docker image, due to some apt-get version errors), taking the configure
switches
from dirks docker container. but whatever i do, finally i only get either
no errors
at all or i get a bunch of errors from other packages that makes R CMD stop
before getting to compiling/checking my package.

can someone tell me what i do wrong and how to get the exact same error
report
as the cran check above? i also gladly accept RTFM statements, i could not
find
anything relevant and to the point, or a page where the exact configuration
and/or compile flags for the cran-report can be found.

sorry if i missed any important information you might need to help me.

all the best,
aydin

	[[alternative HTML version deleted]]


From d.luedecke at uke.de  Tue Aug 25 15:48:16 2015
From: d.luedecke at uke.de (=?UTF-8?Q?Daniel_L=c3=bcdecke?=)
Date: Tue, 25 Aug 2015 15:48:16 +0200
Subject: [R-pkg-devel] Warnings with reverse dependencies in mutually
	dependend packages?
Message-ID: <55DC7220.5060407@uke.de>

I maintain two packages, which are kind of "mutually depending" on each 
other. Now I have updated package A, like to submit it - however, it 
produces warnings (in my package B) when doing the reverse dependency 
check. Yet I cannot fix the warnings in package B and submit it, since 
it relies on new functions of package A, which has to be submitted 
first... and so on.

My question: is it ok to submit package A, saying that I'm aware of the 
warnings in package B, which are already fixed, and that I would submit 
package B after package A has been released on CRAN?

Best
Daniel
--

_____________________________________________________________________

Universit?tsklinikum Hamburg-Eppendorf; K?rperschaft des ?ffentlichen Rechts; Gerichtsstand: Hamburg | www.uke.de
Vorstandsmitglieder: Prof. Dr. Burkhard G?ke (Vorsitzender), Prof. Dr. Dr. Uwe Koch-Gromus, Joachim Pr?l?, Rainer Schoppik
_____________________________________________________________________

SAVE PAPER - THINK BEFORE PRINTING

From murdoch.duncan at gmail.com  Tue Aug 25 16:56:20 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 25 Aug 2015 10:56:20 -0400
Subject: [R-pkg-devel] Warnings with reverse dependencies in mutually
 dependend packages?
In-Reply-To: <55DC7220.5060407@uke.de>
References: <55DC7220.5060407@uke.de>
Message-ID: <55DC8214.90101@gmail.com>

On 25/08/2015 9:48 AM, Daniel L?decke wrote:
> I maintain two packages, which are kind of "mutually depending" on each 
> other. Now I have updated package A, like to submit it - however, it 
> produces warnings (in my package B) when doing the reverse dependency 
> check. Yet I cannot fix the warnings in package B and submit it, since 
> it relies on new functions of package A, which has to be submitted 
> first... and so on.
> 
> My question: is it ok to submit package A, saying that I'm aware of the 
> warnings in package B, which are already fixed, and that I would submit 
> package B after package A has been released on CRAN?


It's not clear to me whether both packages will work in the time when
you've updated A but not B.  If not, this is a bad idea:  users of your
packages will be left with broken systems.

If you want to make incompatible changes to A, and B is the only reverse
dependency, then you could update both at once.  When you submit the
first one, say that the other submission is coming as well.

You should also be making use of version specifiers in your DESCRIPTION
file.  If B version 2 won't work with A version 1, then say that, via

Depends:  A (>=2.0.0)

Duncan Murdoch


From d.luedecke at uke.de  Tue Aug 25 19:39:27 2015
From: d.luedecke at uke.de (=?iso-8859-1?Q?Daniel_L=FCdecke?=)
Date: Tue, 25 Aug 2015 19:39:27 +0200
Subject: [R-pkg-devel] Warnings with reverse dependencies in mutually
	dependend packages?
In-Reply-To: <55DC8214.90101@gmail.com>
References: <55DC7220.5060407@uke.de> <55DC8214.90101@gmail.com>
Message-ID: <63C8D537-8555-43AD-AD9B-46F7495B1824@uke.de>

Thanks for the quick reply. Yes, both packages will work. It's just that I renamed some functions in package B (e.g. `get_val_labels` to `get_labels`) and calling `get_val_labels` now throws a "deprecated"-warning (I'm using `.Deprecated` in that function call).

Thus, checking reverse dependencies, my current package A on CRAN will of course give warnings due to calling old function names, however, I already updated package A accordingly, which will no longer throw warnings once both packages A and B are updated on CRAN.

Also, I'm already using version identifiers in my DESCRIPTION file, so depend packages with correct required versions should be installed.

I guess it's not important, but the packages I'm talking about are `sjPlot` and `sjmisc`.

Best
Daniel

Am 25.08.2015 um 16:56 schrieb Duncan Murdoch <murdoch.duncan at gmail.com>:

> On 25/08/2015 9:48 AM, Daniel L?decke wrote:
>> I maintain two packages, which are kind of "mutually depending" on each 
>> other. Now I have updated package A, like to submit it - however, it 
>> produces warnings (in my package B) when doing the reverse dependency 
>> check. Yet I cannot fix the warnings in package B and submit it, since 
>> it relies on new functions of package A, which has to be submitted 
>> first... and so on.
>> 
>> My question: is it ok to submit package A, saying that I'm aware of the 
>> warnings in package B, which are already fixed, and that I would submit 
>> package B after package A has been released on CRAN?
> 
> 
> It's not clear to me whether both packages will work in the time when
> you've updated A but not B.  If not, this is a bad idea:  users of your
> packages will be left with broken systems.
> 
> If you want to make incompatible changes to A, and B is the only reverse
> dependency, then you could update both at once.  When you submit the
> first one, say that the other submission is coming as well.
> 
> You should also be making use of version specifiers in your DESCRIPTION
> file.  If B version 2 won't work with A version 1, then say that, via
> 
> Depends:  A (>=2.0.0)
> 
> Duncan Murdoch

--

_____________________________________________________________________

Universit?tsklinikum Hamburg-Eppendorf; K?rperschaft des ?ffentlichen Rechts; Gerichtsstand: Hamburg | www.uke.de
Vorstandsmitglieder: Prof. Dr. Burkhard G?ke (Vorsitzender), Prof. Dr. Dr. Uwe Koch-Gromus, Joachim Pr?l?, Rainer Schoppik
_____________________________________________________________________

SAVE PAPER - THINK BEFORE PRINTING


From d.luedecke at uke.de  Tue Aug 25 20:14:13 2015
From: d.luedecke at uke.de (=?iso-8859-1?Q?Daniel_L=FCdecke?=)
Date: Tue, 25 Aug 2015 20:14:13 +0200
Subject: [R-pkg-devel] Warnings with reverse dependencies in mutually
	dependend packages?
In-Reply-To: <63C8D537-8555-43AD-AD9B-46F7495B1824@uke.de>
References: <55DC7220.5060407@uke.de> <55DC8214.90101@gmail.com>
	<63C8D537-8555-43AD-AD9B-46F7495B1824@uke.de>
Message-ID: <E672E219-5DED-4594-A5FB-B897822EF71A@uke.de>

Short addition: and I can't update package A first, because package B also got a new function, which I'm also using in package A. So, the update of package A requires a function which will first be available in the update of package B...


Am 25.08.2015 um 19:39 schrieb Daniel L?decke <d.luedecke at uke.de>:

> Thanks for the quick reply. Yes, both packages will work. It's just that I renamed some functions in package B (e.g. `get_val_labels` to `get_labels`) and calling `get_val_labels` now throws a "deprecated"-warning (I'm using `.Deprecated` in that function call).
> 
> Thus, checking reverse dependencies, my current package A on CRAN will of course give warnings due to calling old function names, however, I already updated package A accordingly, which will no longer throw warnings once both packages A and B are updated on CRAN.
> 
> Also, I'm already using version identifiers in my DESCRIPTION file, so depend packages with correct required versions should be installed.
> 
> I guess it's not important, but the packages I'm talking about are `sjPlot` and `sjmisc`.
> 
> Best
> Daniel
> 
> Am 25.08.2015 um 16:56 schrieb Duncan Murdoch <murdoch.duncan at gmail.com>:
> 
>> On 25/08/2015 9:48 AM, Daniel L?decke wrote:
>>> I maintain two packages, which are kind of "mutually depending" on each 
>>> other. Now I have updated package A, like to submit it - however, it 
>>> produces warnings (in my package B) when doing the reverse dependency 
>>> check. Yet I cannot fix the warnings in package B and submit it, since 
>>> it relies on new functions of package A, which has to be submitted 
>>> first... and so on.
>>> 
>>> My question: is it ok to submit package A, saying that I'm aware of the 
>>> warnings in package B, which are already fixed, and that I would submit 
>>> package B after package A has been released on CRAN?
>> 
>> 
>> It's not clear to me whether both packages will work in the time when
>> you've updated A but not B.  If not, this is a bad idea:  users of your
>> packages will be left with broken systems.
>> 
>> If you want to make incompatible changes to A, and B is the only reverse
>> dependency, then you could update both at once.  When you submit the
>> first one, say that the other submission is coming as well.
>> 
>> You should also be making use of version specifiers in your DESCRIPTION
>> file.  If B version 2 won't work with A version 1, then say that, via
>> 
>> Depends:  A (>=2.0.0)
>> 
>> Duncan Murdoch




--

_____________________________________________________________________

Universit?tsklinikum Hamburg-Eppendorf; K?rperschaft des ?ffentlichen Rechts; Gerichtsstand: Hamburg | www.uke.de
Vorstandsmitglieder: Prof. Dr. Burkhard G?ke (Vorsitzender), Prof. Dr. Dr. Uwe Koch-Gromus, Joachim Pr?l?, Rainer Schoppik
_____________________________________________________________________

SAVE PAPER - THINK BEFORE PRINTING


From edd at debian.org  Tue Aug 25 20:43:47 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 25 Aug 2015 13:43:47 -0500
Subject: [R-pkg-devel] Warnings with reverse dependencies in
	mutually	dependend packages?
In-Reply-To: <E672E219-5DED-4594-A5FB-B897822EF71A@uke.de>
References: <55DC7220.5060407@uke.de> <55DC8214.90101@gmail.com>
	<63C8D537-8555-43AD-AD9B-46F7495B1824@uke.de>
	<E672E219-5DED-4594-A5FB-B897822EF71A@uke.de>
Message-ID: <21980.46947.743052.160099@max.nulle.part>


Daniel,

That whole setup sounds somewhat messy.  I would either

 -  merge sjPlot and sjmisc, possibly into sjPlot and just deprecate the
    then-redundant sjmisc
    
 -  define sjbase, upload it, and have both sjPlot and sjmisc depend on it

Dirk


-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From d.luedecke at uke.de  Tue Aug 25 21:06:34 2015
From: d.luedecke at uke.de (=?iso-8859-1?Q?Daniel_L=FCdecke?=)
Date: Tue, 25 Aug 2015 21:06:34 +0200
Subject: [R-pkg-devel] Warnings with reverse dependencies in mutually
	dependend packages?
In-Reply-To: <21980.46947.743052.160099@max.nulle.part>
References: <55DC7220.5060407@uke.de> <55DC8214.90101@gmail.com>
	<63C8D537-8555-43AD-AD9B-46F7495B1824@uke.de>
	<E672E219-5DED-4594-A5FB-B897822EF71A@uke.de>
	<21980.46947.743052.160099@max.nulle.part>
Message-ID: <02F44A29-3FB8-415D-ABFF-6815735AEF5A@uke.de>

Merging sjPlot and sjmisc is no real option, because I just split the packages, since the amount of functions became too large, and the original package was no longer focussing on its initial intention. That's why I decided to split the packages.

I simply could wait with the renaming of functions and the deprecated-warning for a later update of package B, and everything would be fine - however, to reduce submission frequency, I just thought that there might be a solution for my problem.

Daniel

Am 25.08.2015 um 20:43 schrieb Dirk Eddelbuettel <edd at debian.org>:

> 
> Daniel,
> 
> That whole setup sounds somewhat messy.  I would either
> 
> -  merge sjPlot and sjmisc, possibly into sjPlot and just deprecate the
>    then-redundant sjmisc
> 
> -  define sjbase, upload it, and have both sjPlot and sjmisc depend on it
> 
> Dirk
> 
> 
> -- 
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


-------------- next part --------------
--

_____________________________________________________________________

Universit?tsklinikum Hamburg-Eppendorf; K?rperschaft des ?ffentlichen Rechts; Gerichtsstand: Hamburg | www.uke.de
Vorstandsmitglieder: Prof. Dr. Burkhard G?ke (Vorsitzender), Prof. Dr. Dr. Uwe Koch-Gromus, Joachim Pr?l?, Rainer Schoppik
_____________________________________________________________________

SAVE PAPER - THINK BEFORE PRINTING

From Rainer at krugs.de  Wed Aug 26 12:23:58 2015
From: Rainer at krugs.de (Rainer M Krug)
Date: Wed, 26 Aug 2015 12:23:58 +0200
Subject: [R-pkg-devel] R CMD check for a package which depends on not
	installed other package
Message-ID: <m2k2siqrep.fsf@krugs.de>

Hi

I am working on two packages, where one (EnergyBalance) contains
general functions and the second package (EnergyBalancePaper) contains
the data and the analysis of this specific day=ta using the general
functions ion the package EnergyBalance.

Now I am trying to clean the packages and I am running

--8<---------------cut here---------------start------------->8---
R CMD build ./PACKAGE && R CMD check PACKAGE_0.0.1.tar.gz
--8<---------------cut here---------------end--------------->8---

where everything works fine for EnergyBalance, but EnergyBalancePaper
depends on EnergyBalance, and I get obviously the following error:

,----
| Package required but not available: ?EnergyBalance?
`----

As they are both still under heavy development, I do not want to install
them in my main library of R.

Is there a way of telling R to use ./../library as a library as well in
the command, or should I define a .Rprofile in the current diractory?

What is the best approach in such a situation?

Thanks,

Rainer

-- 
Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology, UCT), Dipl. Phys. (Germany)

Centre of Excellence for Invasion Biology
Stellenbosch University
South Africa

Tel :       +33 - (0)9 53 10 27 44
Cell:       +33 - (0)6 85 62 59 98
Fax :       +33 - (0)9 58 10 27 44

Fax (D):    +49 - (0)3 21 21 25 22 44

email:      Rainer at krugs.de

Skype:      RMkrug

PGP: 0x0F52F982
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 480 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20150826/459383de/attachment.bin>

From ligges at statistik.tu-dortmund.de  Wed Aug 26 13:03:23 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 26 Aug 2015 13:03:23 +0200
Subject: [R-pkg-devel] R CMD check for a package which depends on not
 installed other package
In-Reply-To: <m2k2siqrep.fsf@krugs.de>
References: <m2k2siqrep.fsf@krugs.de>
Message-ID: <55DD9CFB.9040709@statistik.tu-dortmund.de>



On 26.08.2015 12:23, Rainer M Krug wrote:
> Hi
>
> I am working on two packages, where one (EnergyBalance) contains
> general functions and the second package (EnergyBalancePaper) contains
> the data and the analysis of this specific day=ta using the general
> functions ion the package EnergyBalance.
>
> Now I am trying to clean the packages and I am running
>
> --8<---------------cut here---------------start------------->8---
> R CMD build ./PACKAGE && R CMD check PACKAGE_0.0.1.tar.gz
> --8<---------------cut here---------------end--------------->8---
>
> where everything works fine for EnergyBalance, but EnergyBalancePaper
> depends on EnergyBalance, and I get obviously the following error:
>
> ,----
> | Package required but not available: ?EnergyBalance?
> `----
>
> As they are both still under heavy development, I do not want to install
> them in my main library of R.
>
> Is there a way of telling R to use ./../library as a library as well in
> the command, or should I define a .Rprofile in the current diractory?
>
> What is the best approach in such a situation?

Install into that other library and temporarily set R_LIBS_USER that 
points to that additional library.

Best,
Uwe Ligges


>
> Thanks,
>
> Rainer
>
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From Rainer at krugs.de  Wed Aug 26 15:23:07 2015
From: Rainer at krugs.de (Rainer M Krug)
Date: Wed, 26 Aug 2015 15:23:07 +0200
Subject: [R-pkg-devel] R CMD check for a package which depends on not
	installed other package
In-Reply-To: <55DD9CFB.9040709@statistik.tu-dortmund.de> (Uwe Ligges's message
	of "Wed, 26 Aug 2015 13:03:23 +0200")
References: <m2k2siqrep.fsf@krugs.de>
	<55DD9CFB.9040709@statistik.tu-dortmund.de>
Message-ID: <m26142qj44.fsf@krugs.de>

Uwe Ligges <ligges at statistik.tu-dortmund.de> writes:

> On 26.08.2015 12:23, Rainer M Krug wrote:
>> Hi
>>
>> I am working on two packages, where one (EnergyBalance) contains
>> general functions and the second package (EnergyBalancePaper) contains
>> the data and the analysis of this specific day=ta using the general
>> functions ion the package EnergyBalance.
>>
>> Now I am trying to clean the packages and I am running
>>
>> --8<---------------cut here---------------start------------->8---
>> R CMD build ./PACKAGE && R CMD check PACKAGE_0.0.1.tar.gz
>> --8<---------------cut here---------------end--------------->8---
>>
>> where everything works fine for EnergyBalance, but EnergyBalancePaper
>> depends on EnergyBalance, and I get obviously the following error:
>>
>> ,----
>> | Package required but not available: ?EnergyBalance?
>> `----
>>
>> As they are both still under heavy development, I do not want to install
>> them in my main library of R.
>>
>> Is there a way of telling R to use ./../library as a library as well in
>> the command, or should I define a .Rprofile in the current diractory?
>>
>> What is the best approach in such a situation?
>
> Install into that other library and temporarily set R_LIBS_USER that
> points to that additional library.

Nice - that even works with --vanilla

Thanks,
Rainer

>
> Best,
> Uwe Ligges
>
>
>>
>> Thanks,
>>
>> Rainer
>>
>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>

-- 
Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology, UCT), Dipl. Phys. (Germany)

Centre of Excellence for Invasion Biology
Stellenbosch University
South Africa

Tel :       +33 - (0)9 53 10 27 44
Cell:       +33 - (0)6 85 62 59 98
Fax :       +33 - (0)9 58 10 27 44

Fax (D):    +49 - (0)3 21 21 25 22 44

email:      Rainer at krugs.de

Skype:      RMkrug

PGP: 0x0F52F982
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 480 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20150826/ca8aa88a/attachment.bin>

From thierry.onkelinx at inbo.be  Fri Aug 28 10:23:23 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Fri, 28 Aug 2015 10:23:23 +0200
Subject: [R-pkg-devel] Define S4 method for generic in other package
Message-ID: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>

Dear all,

I'm trying to define a new S4 method for a generics defined in an
other package. Here is my attempt, but that isn't working.

bar <- function(a, b) is defined as generic and S4 method in the package foo

#' @importFrom foo bar
#' @importMethodsFrom foo bar
setMethod(
  f = "bar",
  signature = signature(A = "myClass"),
  definition = function(
    a,
    b
  ){
    bar(
      a = myClass at A,
      b = myClass at B
    )
  }
)

When I build my package I get the error "no existing definition for
function 'bar'".

Any suggestions?

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no
more than asking him to perform a post-mortem examination: he may be
able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does
not ensure that a reasonable answer can be extracted from a given body
of data. ~ John Tukey


From murdoch.duncan at gmail.com  Fri Aug 28 13:25:38 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 28 Aug 2015 07:25:38 -0400
Subject: [R-pkg-devel] Define S4 method for generic in other package
In-Reply-To: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>
References: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>
Message-ID: <55E04532.20304@gmail.com>

On 28/08/2015 4:23 AM, Thierry Onkelinx wrote:
> Dear all,
> 
> I'm trying to define a new S4 method for a generics defined in an
> other package. Here is my attempt, but that isn't working.
> 
> bar <- function(a, b) is defined as generic and S4 method in the package foo
> 
> #' @importFrom foo bar
> #' @importMethodsFrom foo bar

I'd advise against using Roxygen2 declarations.  They might be right,
they might not, but you limit the number of people who can answer your
question to those who know *both* Roxygen2 *and* S4 details.

The Writing R Extensions manual describes the NAMESPACE requirements to
do what you want pretty clearly, but I have no idea if the declarations
above satisfy them.

Duncan Murdoch

> setMethod(
>   f = "bar",
>   signature = signature(A = "myClass"),
>   definition = function(
>     a,
>     b
>   ){
>     bar(
>       a = myClass at A,
>       b = myClass at B
>     )
>   }
> )
> 
> When I build my package I get the error "no existing definition for
> function 'bar'".
> 
> Any suggestions?
> 
> Best regards,
> 
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
> 
> To call in the statistician after the experiment is done may be no
> more than asking him to perform a post-mortem examination: he may be
> able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does
> not ensure that a reasonable answer can be extracted from a given body
> of data. ~ John Tukey
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From jpritikin at pobox.com  Fri Aug 28 15:23:51 2015
From: jpritikin at pobox.com (Joshua N Pritikin)
Date: Fri, 28 Aug 2015 09:23:51 -0400
Subject: [R-pkg-devel] why doesn't CRAN add -fopenmp to
	SHLIB_OPENMP_CXXFLAGS for Mac OS?
Message-ID: <20150828132351.GY25533@droplet>

For example, mvnfast CRAN binaries could take advantage of OpenMP.

The OpenMx team has been building Mac OS binaries with openmp enabled 
for years. We compile with gcc and bundle the necessary openmp enabled 
libraries with the binary. Why couldn't CRAN do this?

-- 
Joshua N. Pritikin
Department of Psychology
University of Virginia
485 McCormick Rd, Gilmer Hall Room 102
Charlottesville, VA 22904
http://people.virginia.edu/~jnp3bc


From mark.vanderloo at gmail.com  Fri Aug 28 16:50:50 2015
From: mark.vanderloo at gmail.com (Mark van der Loo)
Date: Fri, 28 Aug 2015 14:50:50 +0000
Subject: [R-pkg-devel] why doesn't CRAN add -fopenmp to
 SHLIB_OPENMP_CXXFLAGS for Mac OS?
In-Reply-To: <20150828132351.GY25533@droplet>
References: <20150828132351.GY25533@droplet>
Message-ID: <CAOKDuOjdvzQSOpXKXyU8+GyA=5OiduD1C=RpV9_B6to6nvrrRQ@mail.gmail.com>

It is not a question of whether the CRAN maintainers _could_ do it.
Technically anything's possible[1]. But, as is nicely pointed out[2]

    "The time of the volunteers is CRAN?s most precious resource[...]"

If you ask me, the voluntary CRAN team is already supporting an amazing
range of architectures, which must be a huge job to maintain. Especially
since R and all its packages should behave consistently across all those
architectures.

I agree it is a pity that clang does not support openmp, but that's just
the way it is right now. (note: I use openmp in several packages).

You could contact the CRAN team and ask if they would be prepared to add
the gcc toolchain as an option for OSX. Or, you can contact the clang team
for openmp support.

Other options:
- Switch to C11/C++11 which has (lower-level) paralellization in the
standard and should be supported by any compiler that claims compliance.
- Use higher-level paralellization, such as offered by the parallel or
partools

Best,
Mark

[1] Well, one problem is: how would install.packages know what binary to
choose: the one compiled by clang or the one compiled by gcc?

[2] https://cran.r-project.org/web/packages/policies.html





Op vr 28 aug. 2015 om 15:26 schreef Joshua N Pritikin <jpritikin at pobox.com>:

> For example, mvnfast CRAN binaries could take advantage of OpenMP.
>
> The OpenMx team has been building Mac OS binaries with openmp enabled
> for years. We compile with gcc and bundle the necessary openmp enabled
> libraries with the binary. Why couldn't CRAN do this?
>
> --
> Joshua N. Pritikin
> Department of Psychology
> University of Virginia
> 485 McCormick Rd, Gilmer Hall Room 102
> Charlottesville, VA 22904
> http://people.virginia.edu/~jnp3bc
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From famuvie at gmail.com  Fri Aug 28 16:46:38 2015
From: famuvie at gmail.com (=?UTF-8?Q?Facundo_Mu=c3=b1oz?=)
Date: Fri, 28 Aug 2015 16:46:38 +0200
Subject: [R-pkg-devel] extending a few functions from another package
Message-ID: <55E0744E.8060707@gmail.com>

Dear list,

I have built a package geoRcb (https://github.com/famuvie/geoRcb) which
is an extension of package geoR.
It provides some very specific additional functionality, in the form of
new arguments for only 3 functions from geoR.
It also has some original complementary functions, but otherwise keeps
most of geoR untouched.

To avoid forking the whole geoR package (and duplicating the vast
majority of the code), I only packaged the modified (or original)
functions. However, since these functions make use of some other
internal functions, I used the dirty trick of *implanting* the modified
functions within the geoR namespace
(https://github.com/famuvie/geoRcb/blob/master/R/geoRcb.R)

I understand that modifying another package's namespace is very bad.
But I don't see how to proceed correctly in this case without forking
the whole package.

Thanks for your suggestions.
        ?acu.-


From mark.vanderloo at gmail.com  Fri Aug 28 17:34:33 2015
From: mark.vanderloo at gmail.com (Mark van der Loo)
Date: Fri, 28 Aug 2015 15:34:33 +0000
Subject: [R-pkg-devel] extending a few functions from another package
In-Reply-To: <55E0744E.8060707@gmail.com>
References: <55E0744E.8060707@gmail.com>
Message-ID: <CAOKDuOgR58i3F+jRbL79SU8KF8D7iXZo5AEkfxG=XsqcP0ewyQ@mail.gmail.com>

Implanting is indeed a dirty trick. You could contact the maintainers of
geoR and ask if your code can be added to the package. Or perhaps they can
export some of the functionality you need.

/M







Op vr 28 aug. 2015 om 16:58 schreef Facundo Mu?oz <famuvie at gmail.com>:

> Dear list,
>
> I have built a package geoRcb (https://github.com/famuvie/geoRcb) which
> is an extension of package geoR.
> It provides some very specific additional functionality, in the form of
> new arguments for only 3 functions from geoR.
> It also has some original complementary functions, but otherwise keeps
> most of geoR untouched.
>
> To avoid forking the whole geoR package (and duplicating the vast
> majority of the code), I only packaged the modified (or original)
> functions. However, since these functions make use of some other
> internal functions, I used the dirty trick of *implanting* the modified
> functions within the geoR namespace
> (https://github.com/famuvie/geoRcb/blob/master/R/geoRcb.R)
>
> I understand that modifying another package's namespace is very bad.
> But I don't see how to proceed correctly in this case without forking
> the whole package.
>
> Thanks for your suggestions.
>         ?acu.-
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From glennmschultz at me.com  Sun Aug 30 00:37:20 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Sat, 29 Aug 2015 22:37:20 +0000 (GMT)
Subject: [R-pkg-devel] Problem with Description File
Message-ID: <2a25f3c5-11ae-4967-b864-5437168cce9c@me.com>

Hi All,

I am getting an error that the build directory does not contain a description file. ?But there is one in the directory. ?Everything was working fine until this error. ?Any ideas how to fix it?

ERROR: The build directory does not contain a DESCRIPTION
file so cannot be built as a package.


Glenn

From ligges at statistik.tu-dortmund.de  Sun Aug 30 08:55:57 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 30 Aug 2015 08:55:57 +0200
Subject: [R-pkg-devel] Problem with Description File
In-Reply-To: <2a25f3c5-11ae-4967-b864-5437168cce9c@me.com>
References: <2a25f3c5-11ae-4967-b864-5437168cce9c@me.com>
Message-ID: <55E2A8FD.5020405@statistik.tu-dortmund.de>



On 30.08.2015 00:37, Glenn Schultz wrote:
> Hi All,
>
> I am getting an error that the build directory does not contain a
> description file.  But there is one in the directory.  Everything was
> working fine until this error.  Any ideas how to fix it?
>
> ERROR: The build directory does not contain a DESCRIPTION
> file so cannot be built as a package.
>

Is it spelled all upper case? Do you have read permission?
If on Windows: Is there some hidden filname extension?

Best,
Uwe Ligges
>
> Glenn
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From benjamin.hofner at fau.de  Mon Aug 31 12:03:00 2015
From: benjamin.hofner at fau.de (Benjamin Hofner)
Date: Mon, 31 Aug 2015 12:03:00 +0200
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
	plot.formula
Message-ID: <55E42654.20309@fau.de>

Dear all,

CRAN policies do not allow that single methods (for generic functions) 
which are defined in base or recommended packages are replaced. They 
advice package authors to replace the standard generic and use a 
xxx.default method which then calls the original standard generic.

Using the following code


## overwrite standard generic
plot <- function(x, y, ...)
     UseMethod("plot")

## per default fall back to standard generic
plot.default <- function(x, y, ...)
     graphics::plot(x, y, ...)

## now specify modified plot function for data frames
plot.data.frame <- function(x, variables = names(x), ...)


essentially works for all tested plot.xxx functions. Yet, it breaks 
plot.formula. How can I proceed to overwrite plot.data.frame without 
breaking plot.formula. Any help is greatly appreciated.

For a detailed description of the problem with syntax highlighting and 
code to reproduce the problem please see:

http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula

Best,
Benjamin
-- 
******************************************************************************
Dr. rer. nat. Benjamin Hofner

Institut f?r Medizininformatik, Biometrie und Epidemiologie
Friedrich-Alexander-Universit?t Erlangen-N?rnberg
Waldstr. 6 - 91054 Erlangen - Germany

Tel: +49-9131-85-22707
Fax: +49-9131-85-25740

B?ro:
   Raum 3.036
   Universit?tsstra?e 22
   (Eingang linke Seite des Geb?udes; Wegweiser IMBE)

benjamin.hofner at fau.de

http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
http://www.benjaminhofner.de


From h.wickham at gmail.com  Tue Sep  1 00:32:08 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Mon, 31 Aug 2015 17:32:08 -0500
Subject: [R-pkg-devel] Define S4 method for generic in other package
In-Reply-To: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>
References: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>
Message-ID: <CABdHhvHzvBd9SyiknM_hEGA5WENOhTLFhcwRjPozznSALZTK0Q@mail.gmail.com>

I'd recommend creating a minimal package that illustrates the problem
using an existing S4 generic in a base package (e.g. stats4::AIC).
That makes it easier to figure out what's gone wrong.

It's unlikely to be a roxygen2 problem since the translation from
@importFrom foo bar (etc) to importFrom(foo, bar) is quite
straightforward.

Hadley

On Fri, Aug 28, 2015 at 3:23 AM, Thierry Onkelinx
<thierry.onkelinx at inbo.be> wrote:
> Dear all,
>
> I'm trying to define a new S4 method for a generics defined in an
> other package. Here is my attempt, but that isn't working.
>
> bar <- function(a, b) is defined as generic and S4 method in the package foo
>
> #' @importFrom foo bar
> #' @importMethodsFrom foo bar
> setMethod(
>   f = "bar",
>   signature = signature(A = "myClass"),
>   definition = function(
>     a,
>     b
>   ){
>     bar(
>       a = myClass at A,
>       b = myClass at B
>     )
>   }
> )
>
> When I build my package I get the error "no existing definition for
> function 'bar'".
>
> Any suggestions?
>
> Best regards,
>
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no
> more than asking him to perform a post-mortem examination: he may be
> able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does
> not ensure that a reasonable answer can be extracted from a given body
> of data. ~ John Tukey
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://had.co.nz/


From ucfagls at gmail.com  Tue Sep  1 04:37:51 2015
From: ucfagls at gmail.com (Gavin Simpson)
Date: Mon, 31 Aug 2015 20:37:51 -0600
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
	plot.formula
In-Reply-To: <55E42654.20309@fau.de>
References: <55E42654.20309@fau.de>
Message-ID: <CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>

Why do you even need to take over `plot`, `plot.default`? You can just
register/export the plot.data.frame method from our package without
touching the generic or default method. The part of WRE that you refer to
is about making functions that are *not* S3 methods in one of base R or
it's packages into S3 generics. You are just providing a method for an
existing generic so you don't need to follow that code.

That said, it wouldn't be good form to fundamentally alter the way
plot.data.frame worked as users might expect certain functionality.

HTH

G

On 31 August 2015 at 04:03, Benjamin Hofner <benjamin.hofner at fau.de> wrote:

> Dear all,
>
> CRAN policies do not allow that single methods (for generic functions)
> which are defined in base or recommended packages are replaced. They advice
> package authors to replace the standard generic and use a xxx.default
> method which then calls the original standard generic.
>
> Using the following code
>
>
> ## overwrite standard generic
> plot <- function(x, y, ...)
>     UseMethod("plot")
>
> ## per default fall back to standard generic
> plot.default <- function(x, y, ...)
>     graphics::plot(x, y, ...)
>
> ## now specify modified plot function for data frames
> plot.data.frame <- function(x, variables = names(x), ...)
>
>
> essentially works for all tested plot.xxx functions. Yet, it breaks
> plot.formula. How can I proceed to overwrite plot.data.frame without
> breaking plot.formula. Any help is greatly appreciated.
>
> For a detailed description of the problem with syntax highlighting and
> code to reproduce the problem please see:
>
>
> http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
>
> Best,
> Benjamin
> --
>
> ******************************************************************************
> Dr. rer. nat. Benjamin Hofner
>
> Institut f?r Medizininformatik, Biometrie und Epidemiologie
> Friedrich-Alexander-Universit?t Erlangen-N?rnberg
> Waldstr. 6 - 91054 Erlangen - Germany
>
> Tel: +49-9131-85-22707
> Fax: +49-9131-85-25740
>
> B?ro:
>   Raum 3.036
>   Universit?tsstra?e 22
>   (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>
> benjamin.hofner at fau.de
>
> http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
> http://www.benjaminhofner.de
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



-- 
Gavin Simpson, PhD

	[[alternative HTML version deleted]]


From thierry.onkelinx at inbo.be  Tue Sep  1 10:53:09 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Tue, 1 Sep 2015 10:53:09 +0200
Subject: [R-pkg-devel] Define S4 method for generic in other package
In-Reply-To: <CABdHhvHzvBd9SyiknM_hEGA5WENOhTLFhcwRjPozznSALZTK0Q@mail.gmail.com>
References: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>
	<CABdHhvHzvBd9SyiknM_hEGA5WENOhTLFhcwRjPozznSALZTK0Q@mail.gmail.com>
Message-ID: <CAJuCY5zmk9W54uaRt+Z3ov8y7LXEo59mShua70+B_BbnmfaMbQ@mail.gmail.com>

Dear Hadley,

I've put a reproducible example at https://github.com/ThierryO/testS4

Best regards,
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no
more than asking him to perform a post-mortem examination: he may be
able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does
not ensure that a reasonable answer can be extracted from a given body
of data. ~ John Tukey


2015-09-01 0:32 GMT+02:00 Hadley Wickham <h.wickham at gmail.com>:
> I'd recommend creating a minimal package that illustrates the problem
> using an existing S4 generic in a base package (e.g. stats4::AIC).
> That makes it easier to figure out what's gone wrong.
>
> It's unlikely to be a roxygen2 problem since the translation from
> @importFrom foo bar (etc) to importFrom(foo, bar) is quite
> straightforward.
>
> Hadley
>
> On Fri, Aug 28, 2015 at 3:23 AM, Thierry Onkelinx
> <thierry.onkelinx at inbo.be> wrote:
>> Dear all,
>>
>> I'm trying to define a new S4 method for a generics defined in an
>> other package. Here is my attempt, but that isn't working.
>>
>> bar <- function(a, b) is defined as generic and S4 method in the package foo
>>
>> #' @importFrom foo bar
>> #' @importMethodsFrom foo bar
>> setMethod(
>>   f = "bar",
>>   signature = signature(A = "myClass"),
>>   definition = function(
>>     a,
>>     b
>>   ){
>>     bar(
>>       a = myClass at A,
>>       b = myClass at B
>>     )
>>   }
>> )
>>
>> When I build my package I get the error "no existing definition for
>> function 'bar'".
>>
>> Any suggestions?
>>
>> Best regards,
>>
>> ir. Thierry Onkelinx
>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
>> and Forest
>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>> Kliniekstraat 25
>> 1070 Anderlecht
>> Belgium
>>
>> To call in the statistician after the experiment is done may be no
>> more than asking him to perform a post-mortem examination: he may be
>> able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
>> The plural of anecdote is not data. ~ Roger Brinner
>> The combination of some data and an aching desire for an answer does
>> not ensure that a reasonable answer can be extracted from a given body
>> of data. ~ John Tukey
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>
>
> --
> http://had.co.nz/


From glennmschultz at me.com  Tue Sep  1 14:17:59 2015
From: glennmschultz at me.com (Glenn Schultz)
Date: Tue, 01 Sep 2015 07:17:59 -0500
Subject: [R-pkg-devel] Problem with Description File
In-Reply-To: <55E2A8FD.5020405@statistik.tu-dortmund.de>
References: <2a25f3c5-11ae-4967-b864-5437168cce9c@me.com>
	<55E2A8FD.5020405@statistik.tu-dortmund.de>
Message-ID: <F97D76B1-DA23-442C-BFBF-9C36240CE866@me.com>

I solved the problem. By copying the description file from the R library into the project directory.  Then everything started working
Glenn

Sent from my iPhone

> On Aug 30, 2015, at 1:55 AM, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
> 
> 
> 
>> On 30.08.2015 00:37, Glenn Schultz wrote:
>> Hi All,
>> 
>> I am getting an error that the build directory does not contain a
>> description file.  But there is one in the directory.  Everything was
>> working fine until this error.  Any ideas how to fix it?
>> 
>> ERROR: The build directory does not contain a DESCRIPTION
>> file so cannot be built as a package.
> 
> Is it spelled all upper case? Do you have read permission?
> If on Windows: Is there some hidden filname extension?
> 
> Best,
> Uwe Ligges
>> 
>> Glenn
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From benjamin.hofner at fau.de  Tue Sep  1 15:08:34 2015
From: benjamin.hofner at fau.de (Benjamin Hofner)
Date: Tue, 1 Sep 2015 15:08:34 +0200
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
 plot.formula
In-Reply-To: <CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
Message-ID: <55E5A352.5040008@fau.de>

Dear Gavin,

unfortunately, I cannot overwrite plot.data.frame only. If I do this I
get the following warning from R CMD check:

* checking use of S3 registration ... WARNING
Registered S3 method from a standard package overwritten by 'papeR':
method from
plot.data.frame graphics

The reason for this is given in the following statement by Prof. Ripley:

 > Do not replace registered S3 methods from base/recommended packages,
 > something which is not allowed by the CRAN policies and will mean
 > that everyone gets your method even if your namespace is unloaded.

The route I am taking is one of the advised routes to go (see 
https://github.com/hofnerb/papeR/issues/5). So I am still looking for a 
fix of this issue.

Your warning regarding the changed user experience is well noted. 
However, I think (and am aware that this is my personal opinion) that a 
lot of users will not miss the standard plot.data.frame method which is 
only well defined for numerics anyway and not very informative in many 
situations. After your comment I am thinking of adding an option to my 
plot.data.frame function which allows to fall back to the original user 
experience.

Thanks,
Benjamin

Am 01.09.2015 um 04:37 schrieb Gavin Simpson:
> Why do you even need to take over `plot`, `plot.default`? You can just
> register/export the plot.data.frame method from our package without
> touching the generic or default method. The part of WRE that you refer
> to is about making functions that are *not* S3 methods in one of base R
> or it's packages into S3 generics. You are just providing a method for
> an existing generic so you don't need to follow that code.
>
> That said, it wouldn't be good form to fundamentally alter the way
> plot.data.frame worked as users might expect certain functionality.
>
> HTH
>
> G
>
> On 31 August 2015 at 04:03, Benjamin Hofner <benjamin.hofner at fau.de
> <mailto:benjamin.hofner at fau.de>> wrote:
>
>     Dear all,
>
>     CRAN policies do not allow that single methods (for generic
>     functions) which are defined in base or recommended packages are
>     replaced. They advice package authors to replace the standard
>     generic and use a xxx.default method which then calls the original
>     standard generic.
>
>     Using the following code
>
>
>     ## overwrite standard generic
>     plot <- function(x, y, ...)
>          UseMethod("plot")
>
>     ## per default fall back to standard generic
>     plot.default <- function(x, y, ...)
>          graphics::plot(x, y, ...)
>
>     ## now specify modified plot function for data frames
>     plot.data.frame <- function(x, variables = names(x), ...)
>
>
>     essentially works for all tested plot.xxx functions. Yet, it breaks
>     plot.formula. How can I proceed to overwrite plot.data.frame without
>     breaking plot.formula. Any help is greatly appreciated.
>
>     For a detailed description of the problem with syntax highlighting
>     and code to reproduce the problem please see:
>
>     http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
>
>     Best,
>     Benjamin
>     --
>     ******************************************************************************
>     Dr. rer. nat. Benjamin Hofner
>
>     Institut f?r Medizininformatik, Biometrie und Epidemiologie
>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>     Waldstr. 6 - 91054 Erlangen - Germany
>
>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>
>     B?ro:
>        Raum 3.036
>        Universit?tsstra?e 22
>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>
>     benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>
>     http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>     http://www.benjaminhofner.de
>
>     ______________________________________________
>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>     mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>
>
>
> --
> Gavin Simpson, PhD


From h.wickham at gmail.com  Tue Sep  1 15:10:59 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 1 Sep 2015 08:10:59 -0500
Subject: [R-pkg-devel] Define S4 method for generic in other package
In-Reply-To: <CAJuCY5zmk9W54uaRt+Z3ov8y7LXEo59mShua70+B_BbnmfaMbQ@mail.gmail.com>
References: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>
	<CABdHhvHzvBd9SyiknM_hEGA5WENOhTLFhcwRjPozznSALZTK0Q@mail.gmail.com>
	<CAJuCY5zmk9W54uaRt+Z3ov8y7LXEo59mShua70+B_BbnmfaMbQ@mail.gmail.com>
Message-ID: <CABdHhvHn3THhrNNDZmiwSGcS3t2Lycf68ReY35nJthwx2c--Ug@mail.gmail.com>

Ah, the problem is because of roxyen2 because:

* To document your code, roxygen2 needs to load it first
* But it can't load it without the definition of git2r::pull

So you're stuck in a bit of a vicious circle. I usually break out of
this circle by temporarily patching the NAMESPACE by hand (in this
case with importFrom(git2r,pull) and then re-generating once I can get
the package loading.

It would be nice to have a more general solution, but I'm not sure how
to do it, because (e.g.) @export needs the loaded object so it can
generate the correct directives. Maybe I need a separate roclet that
only does import namespaces and can run by only inspecting the
comments, not by running the code. I filed an issue at
https://github.com/klutometis/roxygen/issues/372

Hadley

On Tue, Sep 1, 2015 at 3:53 AM, Thierry Onkelinx
<thierry.onkelinx at inbo.be> wrote:
> Dear Hadley,
>
> I've put a reproducible example at https://github.com/ThierryO/testS4
>
> Best regards,
> ir. Thierry Onkelinx
> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
> and Forest
> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
> Kliniekstraat 25
> 1070 Anderlecht
> Belgium
>
> To call in the statistician after the experiment is done may be no
> more than asking him to perform a post-mortem examination: he may be
> able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does
> not ensure that a reasonable answer can be extracted from a given body
> of data. ~ John Tukey
>
>
> 2015-09-01 0:32 GMT+02:00 Hadley Wickham <h.wickham at gmail.com>:
>> I'd recommend creating a minimal package that illustrates the problem
>> using an existing S4 generic in a base package (e.g. stats4::AIC).
>> That makes it easier to figure out what's gone wrong.
>>
>> It's unlikely to be a roxygen2 problem since the translation from
>> @importFrom foo bar (etc) to importFrom(foo, bar) is quite
>> straightforward.
>>
>> Hadley
>>
>> On Fri, Aug 28, 2015 at 3:23 AM, Thierry Onkelinx
>> <thierry.onkelinx at inbo.be> wrote:
>>> Dear all,
>>>
>>> I'm trying to define a new S4 method for a generics defined in an
>>> other package. Here is my attempt, but that isn't working.
>>>
>>> bar <- function(a, b) is defined as generic and S4 method in the package foo
>>>
>>> #' @importFrom foo bar
>>> #' @importMethodsFrom foo bar
>>> setMethod(
>>>   f = "bar",
>>>   signature = signature(A = "myClass"),
>>>   definition = function(
>>>     a,
>>>     b
>>>   ){
>>>     bar(
>>>       a = myClass at A,
>>>       b = myClass at B
>>>     )
>>>   }
>>> )
>>>
>>> When I build my package I get the error "no existing definition for
>>> function 'bar'".
>>>
>>> Any suggestions?
>>>
>>> Best regards,
>>>
>>> ir. Thierry Onkelinx
>>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
>>> and Forest
>>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>>> Kliniekstraat 25
>>> 1070 Anderlecht
>>> Belgium
>>>
>>> To call in the statistician after the experiment is done may be no
>>> more than asking him to perform a post-mortem examination: he may be
>>> able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
>>> The plural of anecdote is not data. ~ Roger Brinner
>>> The combination of some data and an aching desire for an answer does
>>> not ensure that a reasonable answer can be extracted from a given body
>>> of data. ~ John Tukey
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>
>>
>> --
>> http://had.co.nz/



-- 
http://had.co.nz/


From h.wickham at gmail.com  Tue Sep  1 15:14:51 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Tue, 1 Sep 2015 08:14:51 -0500
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
	plot.formula
In-Reply-To: <55E5A352.5040008@fau.de>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
	<55E5A352.5040008@fau.de>
Message-ID: <CABdHhvFontSByS65WxooChsQWMWy+W+8W5-TchP-3apjg5kYKQ@mail.gmail.com>

Why don't you just create your own function?

Hadley

On Tue, Sep 1, 2015 at 8:08 AM, Benjamin Hofner <benjamin.hofner at fau.de> wrote:
> Dear Gavin,
>
> unfortunately, I cannot overwrite plot.data.frame only. If I do this I
> get the following warning from R CMD check:
>
> * checking use of S3 registration ... WARNING
> Registered S3 method from a standard package overwritten by 'papeR':
> method from
> plot.data.frame graphics
>
> The reason for this is given in the following statement by Prof. Ripley:
>
>> Do not replace registered S3 methods from base/recommended packages,
>> something which is not allowed by the CRAN policies and will mean
>> that everyone gets your method even if your namespace is unloaded.
>
> The route I am taking is one of the advised routes to go (see
> https://github.com/hofnerb/papeR/issues/5). So I am still looking for a fix
> of this issue.
>
> Your warning regarding the changed user experience is well noted. However, I
> think (and am aware that this is my personal opinion) that a lot of users
> will not miss the standard plot.data.frame method which is only well defined
> for numerics anyway and not very informative in many situations. After your
> comment I am thinking of adding an option to my plot.data.frame function
> which allows to fall back to the original user experience.
>
> Thanks,
> Benjamin
>
> Am 01.09.2015 um 04:37 schrieb Gavin Simpson:
>>
>> Why do you even need to take over `plot`, `plot.default`? You can just
>> register/export the plot.data.frame method from our package without
>> touching the generic or default method. The part of WRE that you refer
>> to is about making functions that are *not* S3 methods in one of base R
>> or it's packages into S3 generics. You are just providing a method for
>> an existing generic so you don't need to follow that code.
>>
>> That said, it wouldn't be good form to fundamentally alter the way
>> plot.data.frame worked as users might expect certain functionality.
>>
>> HTH
>>
>> G
>>
>> On 31 August 2015 at 04:03, Benjamin Hofner <benjamin.hofner at fau.de
>> <mailto:benjamin.hofner at fau.de>> wrote:
>>
>>     Dear all,
>>
>>     CRAN policies do not allow that single methods (for generic
>>     functions) which are defined in base or recommended packages are
>>     replaced. They advice package authors to replace the standard
>>     generic and use a xxx.default method which then calls the original
>>     standard generic.
>>
>>     Using the following code
>>
>>
>>     ## overwrite standard generic
>>     plot <- function(x, y, ...)
>>          UseMethod("plot")
>>
>>     ## per default fall back to standard generic
>>     plot.default <- function(x, y, ...)
>>          graphics::plot(x, y, ...)
>>
>>     ## now specify modified plot function for data frames
>>     plot.data.frame <- function(x, variables = names(x), ...)
>>
>>
>>     essentially works for all tested plot.xxx functions. Yet, it breaks
>>     plot.formula. How can I proceed to overwrite plot.data.frame without
>>     breaking plot.formula. Any help is greatly appreciated.
>>
>>     For a detailed description of the problem with syntax highlighting
>>     and code to reproduce the problem please see:
>>
>>
>> http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
>>
>>     Best,
>>     Benjamin
>>     --
>>
>> ******************************************************************************
>>     Dr. rer. nat. Benjamin Hofner
>>
>>     Institut f?r Medizininformatik, Biometrie und Epidemiologie
>>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>>     Waldstr. 6 - 91054 Erlangen - Germany
>>
>>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>>
>>     B?ro:
>>        Raum 3.036
>>        Universit?tsstra?e 22
>>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>>
>>     benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>>
>>     http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>>     http://www.benjaminhofner.de
>>
>>     ______________________________________________
>>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>>     mailing list
>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>
>>
>>
>> --
>> Gavin Simpson, PhD
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://had.co.nz/


From thierry.onkelinx at inbo.be  Tue Sep  1 15:14:41 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Tue, 1 Sep 2015 15:14:41 +0200
Subject: [R-pkg-devel] Define S4 method for generic in other package
In-Reply-To: <CABdHhvHn3THhrNNDZmiwSGcS3t2Lycf68ReY35nJthwx2c--Ug@mail.gmail.com>
References: <CAJuCY5y__v0RPzHceJbnQPMpcfM2JXjcW7hLjiKvxhkYgwvExA@mail.gmail.com>
	<CABdHhvHzvBd9SyiknM_hEGA5WENOhTLFhcwRjPozznSALZTK0Q@mail.gmail.com>
	<CAJuCY5zmk9W54uaRt+Z3ov8y7LXEo59mShua70+B_BbnmfaMbQ@mail.gmail.com>
	<CABdHhvHn3THhrNNDZmiwSGcS3t2Lycf68ReY35nJthwx2c--Ug@mail.gmail.com>
Message-ID: <CAJuCY5wYZFCU09Lz+tU2rg6MgAMg5hOjibkJQrvL2ONngLUkaw@mail.gmail.com>

Hi Hadley,

Thanks for the workaround.

Best regards,

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium

To call in the statistician after the experiment is done may be no
more than asking him to perform a post-mortem examination: he may be
able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does
not ensure that a reasonable answer can be extracted from a given body
of data. ~ John Tukey


2015-09-01 15:10 GMT+02:00 Hadley Wickham <h.wickham at gmail.com>:
> Ah, the problem is because of roxyen2 because:
>
> * To document your code, roxygen2 needs to load it first
> * But it can't load it without the definition of git2r::pull
>
> So you're stuck in a bit of a vicious circle. I usually break out of
> this circle by temporarily patching the NAMESPACE by hand (in this
> case with importFrom(git2r,pull) and then re-generating once I can get
> the package loading.
>
> It would be nice to have a more general solution, but I'm not sure how
> to do it, because (e.g.) @export needs the loaded object so it can
> generate the correct directives. Maybe I need a separate roclet that
> only does import namespaces and can run by only inspecting the
> comments, not by running the code. I filed an issue at
> https://github.com/klutometis/roxygen/issues/372
>
> Hadley
>
> On Tue, Sep 1, 2015 at 3:53 AM, Thierry Onkelinx
> <thierry.onkelinx at inbo.be> wrote:
>> Dear Hadley,
>>
>> I've put a reproducible example at https://github.com/ThierryO/testS4
>>
>> Best regards,
>> ir. Thierry Onkelinx
>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
>> and Forest
>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>> Kliniekstraat 25
>> 1070 Anderlecht
>> Belgium
>>
>> To call in the statistician after the experiment is done may be no
>> more than asking him to perform a post-mortem examination: he may be
>> able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
>> The plural of anecdote is not data. ~ Roger Brinner
>> The combination of some data and an aching desire for an answer does
>> not ensure that a reasonable answer can be extracted from a given body
>> of data. ~ John Tukey
>>
>>
>> 2015-09-01 0:32 GMT+02:00 Hadley Wickham <h.wickham at gmail.com>:
>>> I'd recommend creating a minimal package that illustrates the problem
>>> using an existing S4 generic in a base package (e.g. stats4::AIC).
>>> That makes it easier to figure out what's gone wrong.
>>>
>>> It's unlikely to be a roxygen2 problem since the translation from
>>> @importFrom foo bar (etc) to importFrom(foo, bar) is quite
>>> straightforward.
>>>
>>> Hadley
>>>
>>> On Fri, Aug 28, 2015 at 3:23 AM, Thierry Onkelinx
>>> <thierry.onkelinx at inbo.be> wrote:
>>>> Dear all,
>>>>
>>>> I'm trying to define a new S4 method for a generics defined in an
>>>> other package. Here is my attempt, but that isn't working.
>>>>
>>>> bar <- function(a, b) is defined as generic and S4 method in the package foo
>>>>
>>>> #' @importFrom foo bar
>>>> #' @importMethodsFrom foo bar
>>>> setMethod(
>>>>   f = "bar",
>>>>   signature = signature(A = "myClass"),
>>>>   definition = function(
>>>>     a,
>>>>     b
>>>>   ){
>>>>     bar(
>>>>       a = myClass at A,
>>>>       b = myClass at B
>>>>     )
>>>>   }
>>>> )
>>>>
>>>> When I build my package I get the error "no existing definition for
>>>> function 'bar'".
>>>>
>>>> Any suggestions?
>>>>
>>>> Best regards,
>>>>
>>>> ir. Thierry Onkelinx
>>>> Instituut voor natuur- en bosonderzoek / Research Institute for Nature
>>>> and Forest
>>>> team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
>>>> Kliniekstraat 25
>>>> 1070 Anderlecht
>>>> Belgium
>>>>
>>>> To call in the statistician after the experiment is done may be no
>>>> more than asking him to perform a post-mortem examination: he may be
>>>> able to say what the experiment died of. ~ Sir Ronald Aylmer Fisher
>>>> The plural of anecdote is not data. ~ Roger Brinner
>>>> The combination of some data and an aching desire for an answer does
>>>> not ensure that a reasonable answer can be extracted from a given body
>>>> of data. ~ John Tukey
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>>
>>>
>>> --
>>> http://had.co.nz/
>
>
>
> --
> http://had.co.nz/


From ucfagls at gmail.com  Tue Sep  1 15:44:15 2015
From: ucfagls at gmail.com (Gavin Simpson)
Date: Tue, 1 Sep 2015 07:44:15 -0600
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
	plot.formula
In-Reply-To: <CABdHhvFontSByS65WxooChsQWMWy+W+8W5-TchP-3apjg5kYKQ@mail.gmail.com>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
	<55E5A352.5040008@fau.de>
	<CABdHhvFontSByS65WxooChsQWMWy+W+8W5-TchP-3apjg5kYKQ@mail.gmail.com>
Message-ID: <CAAHES9xoKg1MN6G=v9ctTP6EwLr28nHchPw03AHFhJJx5KMy8A@mail.gmail.com>

...or have an object that is a data.frame but to which you add an
additional class

class(obj) <- c("my_df", "data.frame")

Then you can include plot.my_df() in your package, plus a function to
create a my_df object from a data frame, and you don't have to worry about
all this and your objects will still work like data frames

G
On Sep 1, 2015 07:15, "Hadley Wickham" <h.wickham at gmail.com> wrote:

> Why don't you just create your own function?
>
> Hadley
>
> On Tue, Sep 1, 2015 at 8:08 AM, Benjamin Hofner <benjamin.hofner at fau.de>
> wrote:
> > Dear Gavin,
> >
> > unfortunately, I cannot overwrite plot.data.frame only. If I do this I
> > get the following warning from R CMD check:
> >
> > * checking use of S3 registration ... WARNING
> > Registered S3 method from a standard package overwritten by 'papeR':
> > method from
> > plot.data.frame graphics
> >
> > The reason for this is given in the following statement by Prof. Ripley:
> >
> >> Do not replace registered S3 methods from base/recommended packages,
> >> something which is not allowed by the CRAN policies and will mean
> >> that everyone gets your method even if your namespace is unloaded.
> >
> > The route I am taking is one of the advised routes to go (see
> > https://github.com/hofnerb/papeR/issues/5). So I am still looking for a
> fix
> > of this issue.
> >
> > Your warning regarding the changed user experience is well noted.
> However, I
> > think (and am aware that this is my personal opinion) that a lot of users
> > will not miss the standard plot.data.frame method which is only well
> defined
> > for numerics anyway and not very informative in many situations. After
> your
> > comment I am thinking of adding an option to my plot.data.frame function
> > which allows to fall back to the original user experience.
> >
> > Thanks,
> > Benjamin
> >
> > Am 01.09.2015 um 04:37 schrieb Gavin Simpson:
> >>
> >> Why do you even need to take over `plot`, `plot.default`? You can just
> >> register/export the plot.data.frame method from our package without
> >> touching the generic or default method. The part of WRE that you refer
> >> to is about making functions that are *not* S3 methods in one of base R
> >> or it's packages into S3 generics. You are just providing a method for
> >> an existing generic so you don't need to follow that code.
> >>
> >> That said, it wouldn't be good form to fundamentally alter the way
> >> plot.data.frame worked as users might expect certain functionality.
> >>
> >> HTH
> >>
> >> G
> >>
> >> On 31 August 2015 at 04:03, Benjamin Hofner <benjamin.hofner at fau.de
> >> <mailto:benjamin.hofner at fau.de>> wrote:
> >>
> >>     Dear all,
> >>
> >>     CRAN policies do not allow that single methods (for generic
> >>     functions) which are defined in base or recommended packages are
> >>     replaced. They advice package authors to replace the standard
> >>     generic and use a xxx.default method which then calls the original
> >>     standard generic.
> >>
> >>     Using the following code
> >>
> >>
> >>     ## overwrite standard generic
> >>     plot <- function(x, y, ...)
> >>          UseMethod("plot")
> >>
> >>     ## per default fall back to standard generic
> >>     plot.default <- function(x, y, ...)
> >>          graphics::plot(x, y, ...)
> >>
> >>     ## now specify modified plot function for data frames
> >>     plot.data.frame <- function(x, variables = names(x), ...)
> >>
> >>
> >>     essentially works for all tested plot.xxx functions. Yet, it breaks
> >>     plot.formula. How can I proceed to overwrite plot.data.frame without
> >>     breaking plot.formula. Any help is greatly appreciated.
> >>
> >>     For a detailed description of the problem with syntax highlighting
> >>     and code to reproduce the problem please see:
> >>
> >>
> >>
> http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
> >>
> >>     Best,
> >>     Benjamin
> >>     --
> >>
> >>
> ******************************************************************************
> >>     Dr. rer. nat. Benjamin Hofner
> >>
> >>     Institut f?r Medizininformatik, Biometrie und Epidemiologie
> >>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
> >>     Waldstr. 6 - 91054 Erlangen - Germany
> >>
> >>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
> >>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
> >>
> >>     B?ro:
> >>        Raum 3.036
> >>        Universit?tsstra?e 22
> >>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
> >>
> >>     benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
> >>
> >>     http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
> >>     http://www.benjaminhofner.de
> >>
> >>     ______________________________________________
> >>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org
> >
> >>     mailing list
> >>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>
> >>
> >>
> >>
> >> --
> >> Gavin Simpson, PhD
> >
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>
>
> --
> http://had.co.nz/
>

	[[alternative HTML version deleted]]


From benjamin.hofner at fau.de  Tue Sep  1 15:53:48 2015
From: benjamin.hofner at fau.de (Benjamin Hofner)
Date: Tue, 1 Sep 2015 15:53:48 +0200
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
 plot.formula
In-Reply-To: <CAAHES9xoKg1MN6G=v9ctTP6EwLr28nHchPw03AHFhJJx5KMy8A@mail.gmail.com>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
	<55E5A352.5040008@fau.de>
	<CABdHhvFontSByS65WxooChsQWMWy+W+8W5-TchP-3apjg5kYKQ@mail.gmail.com>
	<CAAHES9xoKg1MN6G=v9ctTP6EwLr28nHchPw03AHFhJJx5KMy8A@mail.gmail.com>
Message-ID: <55E5ADEC.5080608@fau.de>

I am using it this way as I want to be able to plot data.frames but have 
a better display and more options. Thus, using plot.data.frame seems 
rather natural. A different function or new classes are just a work 
around. I do not want to use a new class as these functions should work 
on ANY data frame without coercion.

Additionally, I had the function plot.data.frame [*] in an old versions 
of the package and would like to keep it for backward compatibility.

[*] admittedly the function was plot.labeled.data.frame but I dropped 
the class labeled.data.frame as all my functions now work on regular 
data frames as well. If labels are present, these are used. If not, not.

Benjamin

Am 01.09.2015 um 15:44 schrieb Gavin Simpson:
> ...or have an object that is a data.frame but to which you add an
> additional class
>
> class(obj) <- c("my_df", "data.frame")
>
> Then you can include plot.my_df() in your package, plus a function to
> create a my_df object from a data frame, and you don't have to worry
> about all this and your objects will still work like data frames
>
> G
>
> On Sep 1, 2015 07:15, "Hadley Wickham" <h.wickham at gmail.com
> <mailto:h.wickham at gmail.com>> wrote:
>
>     Why don't you just create your own function?
>
>     Hadley
>
>     On Tue, Sep 1, 2015 at 8:08 AM, Benjamin Hofner
>     <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>> wrote:
>      > Dear Gavin,
>      >
>      > unfortunately, I cannot overwrite plot.data.frame only. If I do
>     this I
>      > get the following warning from R CMD check:
>      >
>      > * checking use of S3 registration ... WARNING
>      > Registered S3 method from a standard package overwritten by 'papeR':
>      > method from
>      > plot.data.frame graphics
>      >
>      > The reason for this is given in the following statement by Prof.
>     Ripley:
>      >
>      >> Do not replace registered S3 methods from base/recommended packages,
>      >> something which is not allowed by the CRAN policies and will mean
>      >> that everyone gets your method even if your namespace is unloaded.
>      >
>      > The route I am taking is one of the advised routes to go (see
>      > https://github.com/hofnerb/papeR/issues/5). So I am still looking
>     for a fix
>      > of this issue.
>      >
>      > Your warning regarding the changed user experience is well noted.
>     However, I
>      > think (and am aware that this is my personal opinion) that a lot
>     of users
>      > will not miss the standard plot.data.frame method which is only
>     well defined
>      > for numerics anyway and not very informative in many situations.
>     After your
>      > comment I am thinking of adding an option to my plot.data.frame
>     function
>      > which allows to fall back to the original user experience.
>      >
>      > Thanks,
>      > Benjamin
>      >
>      > Am 01.09.2015 um 04:37 schrieb Gavin Simpson:
>      >>
>      >> Why do you even need to take over `plot`, `plot.default`? You
>     can just
>      >> register/export the plot.data.frame method from our package without
>      >> touching the generic or default method. The part of WRE that you
>     refer
>      >> to is about making functions that are *not* S3 methods in one of
>     base R
>      >> or it's packages into S3 generics. You are just providing a
>     method for
>      >> an existing generic so you don't need to follow that code.
>      >>
>      >> That said, it wouldn't be good form to fundamentally alter the way
>      >> plot.data.frame worked as users might expect certain functionality.
>      >>
>      >> HTH
>      >>
>      >> G
>      >>
>      >> On 31 August 2015 at 04:03, Benjamin Hofner
>     <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>      >> <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>>
>     wrote:
>      >>
>      >>     Dear all,
>      >>
>      >>     CRAN policies do not allow that single methods (for generic
>      >>     functions) which are defined in base or recommended packages are
>      >>     replaced. They advice package authors to replace the standard
>      >>     generic and use a xxx.default method which then calls the
>     original
>      >>     standard generic.
>      >>
>      >>     Using the following code
>      >>
>      >>
>      >>     ## overwrite standard generic
>      >>     plot <- function(x, y, ...)
>      >>          UseMethod("plot")
>      >>
>      >>     ## per default fall back to standard generic
>      >>     plot.default <- function(x, y, ...)
>      >>          graphics::plot(x, y, ...)
>      >>
>      >>     ## now specify modified plot function for data frames
>      >>     plot.data.frame <- function(x, variables = names(x), ...)
>      >>
>      >>
>      >>     essentially works for all tested plot.xxx functions. Yet, it
>     breaks
>      >>     plot.formula. How can I proceed to overwrite plot.data.frame
>     without
>      >>     breaking plot.formula. Any help is greatly appreciated.
>      >>
>      >>     For a detailed description of the problem with syntax
>     highlighting
>      >>     and code to reproduce the problem please see:
>      >>
>      >>
>      >>
>     http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
>      >>
>      >>     Best,
>      >>     Benjamin
>      >>     --
>      >>
>      >>
>     ******************************************************************************
>      >>     Dr. rer. nat. Benjamin Hofner
>      >>
>      >>     Institut f?r Medizininformatik, Biometrie und Epidemiologie
>      >>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>      >>     Waldstr. 6 - 91054 Erlangen - Germany
>      >>
>      >>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>     <tel:%2B49-9131-85-22707>
>      >>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>     <tel:%2B49-9131-85-25740>
>      >>
>      >>     B?ro:
>      >>        Raum 3.036
>      >>        Universit?tsstra?e 22
>      >>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>      >>
>      >> benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>     <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>
>      >>
>      >> http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>      >> http://www.benjaminhofner.de
>      >>
>      >>     ______________________________________________
>      >> R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org>
>     <mailto:R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org>>
>      >>     mailing list
>      >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>      >>
>      >>
>      >>
>      >>
>      >> --
>      >> Gavin Simpson, PhD
>      >
>      >
>      > ______________________________________________
>      > R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>
>
>     --
>     http://had.co.nz/
>

-- 
******************************************************************************
Dr. rer. nat. Benjamin Hofner

Institut f?r Medizininformatik, Biometrie und Epidemiologie
Friedrich-Alexander-Universit?t Erlangen-N?rnberg
Waldstr. 6 - 91054 Erlangen - Germany

Tel: +49-9131-85-22707
Fax: +49-9131-85-25740

B?ro:
   Raum 3.036
   Universit?tsstra?e 22
   (Eingang linke Seite des Geb?udes; Wegweiser IMBE)

benjamin.hofner at fau.de

http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
http://www.benjaminhofner.de


From wdunlap at tibco.com  Tue Sep  1 17:39:22 2015
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 1 Sep 2015 08:39:22 -0700
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
	plot.formula
In-Reply-To: <CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
Message-ID: <CAF8bMcboyQz8HNWhzF170qNDdNkZz9oZvuLqQ9cm5onudC7o4A@mail.gmail.com>

Try giving y a default value, NULL, in your plot.default:
   plot.default <- function(x, y=NULL, ...)
       graphics::plot(x, y, ...)


Bill Dunlap
TIBCO Software
wdunlap tibco.com

On Mon, Aug 31, 2015 at 7:37 PM, Gavin Simpson <ucfagls at gmail.com> wrote:

> Why do you even need to take over `plot`, `plot.default`? You can just
> register/export the plot.data.frame method from our package without
> touching the generic or default method. The part of WRE that you refer to
> is about making functions that are *not* S3 methods in one of base R or
> it's packages into S3 generics. You are just providing a method for an
> existing generic so you don't need to follow that code.
>
> That said, it wouldn't be good form to fundamentally alter the way
> plot.data.frame worked as users might expect certain functionality.
>
> HTH
>
> G
>
> On 31 August 2015 at 04:03, Benjamin Hofner <benjamin.hofner at fau.de>
> wrote:
>
> > Dear all,
> >
> > CRAN policies do not allow that single methods (for generic functions)
> > which are defined in base or recommended packages are replaced. They
> advice
> > package authors to replace the standard generic and use a xxx.default
> > method which then calls the original standard generic.
> >
> > Using the following code
> >
> >
> > ## overwrite standard generic
> > plot <- function(x, y, ...)
> >     UseMethod("plot")
> >
> > ## per default fall back to standard generic
> > plot.default <- function(x, y, ...)
> >     graphics::plot(x, y, ...)
> >
> > ## now specify modified plot function for data frames
> > plot.data.frame <- function(x, variables = names(x), ...)
> >
> >
> > essentially works for all tested plot.xxx functions. Yet, it breaks
> > plot.formula. How can I proceed to overwrite plot.data.frame without
> > breaking plot.formula. Any help is greatly appreciated.
> >
> > For a detailed description of the problem with syntax highlighting and
> > code to reproduce the problem please see:
> >
> >
> >
> http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
> >
> > Best,
> > Benjamin
> > --
> >
> >
> ******************************************************************************
> > Dr. rer. nat. Benjamin Hofner
> >
> > Institut f?r Medizininformatik, Biometrie und Epidemiologie
> > Friedrich-Alexander-Universit?t Erlangen-N?rnberg
> > Waldstr. 6 - 91054 Erlangen - Germany
> >
> > Tel: +49-9131-85-22707
> > Fax: +49-9131-85-25740
> >
> > B?ro:
> >   Raum 3.036
> >   Universit?tsstra?e 22
> >   (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
> >
> > benjamin.hofner at fau.de
> >
> > http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
> > http://www.benjaminhofner.de
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>
>
> --
> Gavin Simpson, PhD
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ucfagls at gmail.com  Tue Sep  1 17:54:51 2015
From: ucfagls at gmail.com (Gavin Simpson)
Date: Tue, 1 Sep 2015 09:54:51 -0600
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
	plot.formula
In-Reply-To: <55E5ADEC.5080608@fau.de>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
	<55E5A352.5040008@fau.de>
	<CABdHhvFontSByS65WxooChsQWMWy+W+8W5-TchP-3apjg5kYKQ@mail.gmail.com>
	<CAAHES9xoKg1MN6G=v9ctTP6EwLr28nHchPw03AHFhJJx5KMy8A@mail.gmail.com>
	<55E5ADEC.5080608@fau.de>
Message-ID: <CAAHES9wk9aGp2Z0qjabohqEoNZZ3VZPYTvrV76qJKbkj2R7fkQ@mail.gmail.com>

It's not just plot.formula that is broken; plot.lm is dead too for example.
It's seems that just unexported methods fail to be called. This works
plot(ts(1:100)), correctly calling the plot.ts method.

What you must be doing overwriting the plot generic seems to be clobbering
S3 dispatch or killing the registration of those methods such that they
never get called.

I think you might need to take this to R Devel to ask what is happening to
S3 dispatch when you modify the generic (by providing your own), unless
someone else here knows what is going on?

If this isn't a problem in R, it looks like it would be easier all round to
follow Prof. Ripley's other advice/option and add a new class to data.frame
objects and provide a method for that new class...

HTH

G

On 1 September 2015 at 07:53, Benjamin Hofner <benjamin.hofner at fau.de>
wrote:

> I am using it this way as I want to be able to plot data.frames but have a
> better display and more options. Thus, using plot.data.frame seems rather
> natural. A different function or new classes are just a work around. I do
> not want to use a new class as these functions should work on ANY data
> frame without coercion.
>
> Additionally, I had the function plot.data.frame [*] in an old versions of
> the package and would like to keep it for backward compatibility.
>
> [*] admittedly the function was plot.labeled.data.frame but I dropped the
> class labeled.data.frame as all my functions now work on regular data
> frames as well. If labels are present, these are used. If not, not.
>
> Benjamin
>
> Am 01.09.2015 um 15:44 schrieb Gavin Simpson:
>
>> ...or have an object that is a data.frame but to which you add an
>> additional class
>>
>> class(obj) <- c("my_df", "data.frame")
>>
>> Then you can include plot.my_df() in your package, plus a function to
>> create a my_df object from a data frame, and you don't have to worry
>> about all this and your objects will still work like data frames
>>
>> G
>>
>> On Sep 1, 2015 07:15, "Hadley Wickham" <h.wickham at gmail.com
>> <mailto:h.wickham at gmail.com>> wrote:
>>
>>     Why don't you just create your own function?
>>
>>     Hadley
>>
>>     On Tue, Sep 1, 2015 at 8:08 AM, Benjamin Hofner
>>     <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>> wrote:
>>      > Dear Gavin,
>>      >
>>      > unfortunately, I cannot overwrite plot.data.frame only. If I do
>>     this I
>>      > get the following warning from R CMD check:
>>      >
>>      > * checking use of S3 registration ... WARNING
>>      > Registered S3 method from a standard package overwritten by
>> 'papeR':
>>      > method from
>>      > plot.data.frame graphics
>>      >
>>      > The reason for this is given in the following statement by Prof.
>>     Ripley:
>>      >
>>      >> Do not replace registered S3 methods from base/recommended
>> packages,
>>      >> something which is not allowed by the CRAN policies and will mean
>>      >> that everyone gets your method even if your namespace is unloaded.
>>      >
>>      > The route I am taking is one of the advised routes to go (see
>>      > https://github.com/hofnerb/papeR/issues/5). So I am still looking
>>     for a fix
>>      > of this issue.
>>      >
>>      > Your warning regarding the changed user experience is well noted.
>>     However, I
>>      > think (and am aware that this is my personal opinion) that a lot
>>     of users
>>      > will not miss the standard plot.data.frame method which is only
>>     well defined
>>      > for numerics anyway and not very informative in many situations.
>>     After your
>>      > comment I am thinking of adding an option to my plot.data.frame
>>     function
>>      > which allows to fall back to the original user experience.
>>      >
>>      > Thanks,
>>      > Benjamin
>>      >
>>      > Am 01.09.2015 um 04:37 schrieb Gavin Simpson:
>>      >>
>>      >> Why do you even need to take over `plot`, `plot.default`? You
>>     can just
>>      >> register/export the plot.data.frame method from our package
>> without
>>      >> touching the generic or default method. The part of WRE that you
>>     refer
>>      >> to is about making functions that are *not* S3 methods in one of
>>     base R
>>      >> or it's packages into S3 generics. You are just providing a
>>     method for
>>      >> an existing generic so you don't need to follow that code.
>>      >>
>>      >> That said, it wouldn't be good form to fundamentally alter the way
>>      >> plot.data.frame worked as users might expect certain
>> functionality.
>>      >>
>>      >> HTH
>>      >>
>>      >> G
>>      >>
>>      >> On 31 August 2015 at 04:03, Benjamin Hofner
>>     <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>>      >> <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>>
>>
>>     wrote:
>>      >>
>>      >>     Dear all,
>>      >>
>>      >>     CRAN policies do not allow that single methods (for generic
>>      >>     functions) which are defined in base or recommended packages
>> are
>>      >>     replaced. They advice package authors to replace the standard
>>      >>     generic and use a xxx.default method which then calls the
>>     original
>>      >>     standard generic.
>>      >>
>>      >>     Using the following code
>>      >>
>>      >>
>>      >>     ## overwrite standard generic
>>      >>     plot <- function(x, y, ...)
>>      >>          UseMethod("plot")
>>      >>
>>      >>     ## per default fall back to standard generic
>>      >>     plot.default <- function(x, y, ...)
>>      >>          graphics::plot(x, y, ...)
>>      >>
>>      >>     ## now specify modified plot function for data frames
>>      >>     plot.data.frame <- function(x, variables = names(x), ...)
>>      >>
>>      >>
>>      >>     essentially works for all tested plot.xxx functions. Yet, it
>>     breaks
>>      >>     plot.formula. How can I proceed to overwrite plot.data.frame
>>     without
>>      >>     breaking plot.formula. Any help is greatly appreciated.
>>      >>
>>      >>     For a detailed description of the problem with syntax
>>     highlighting
>>      >>     and code to reproduce the problem please see:
>>      >>
>>      >>
>>      >>
>>
>> http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
>>      >>
>>      >>     Best,
>>      >>     Benjamin
>>      >>     --
>>      >>
>>      >>
>>
>> ******************************************************************************
>>      >>     Dr. rer. nat. Benjamin Hofner
>>      >>
>>      >>     Institut f?r Medizininformatik, Biometrie und Epidemiologie
>>      >>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>>      >>     Waldstr. 6 - 91054 Erlangen - Germany
>>      >>
>>      >>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>>     <tel:%2B49-9131-85-22707>
>>      >>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>>     <tel:%2B49-9131-85-25740>
>>      >>
>>      >>     B?ro:
>>      >>        Raum 3.036
>>      >>        Universit?tsstra?e 22
>>      >>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>>      >>
>>      >> benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>>     <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>
>>      >>
>>      >> http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>>      >> http://www.benjaminhofner.de
>>      >>
>>      >>     ______________________________________________
>>      >> R-package-devel at r-project.org
>>     <mailto:R-package-devel at r-project.org>
>>     <mailto:R-package-devel at r-project.org
>>     <mailto:R-package-devel at r-project.org>>
>>      >>     mailing list
>>      >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>      >>
>>      >>
>>      >>
>>      >>
>>      >> --
>>      >> Gavin Simpson, PhD
>>      >
>>      >
>>      > ______________________________________________
>>      > R-package-devel at r-project.org
>>     <mailto:R-package-devel at r-project.org> mailing list
>>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>
>>
>>     --
>>     http://had.co.nz/
>>
>>
> --
>
> ******************************************************************************
> Dr. rer. nat. Benjamin Hofner
>
> Institut f?r Medizininformatik, Biometrie und Epidemiologie
> Friedrich-Alexander-Universit?t Erlangen-N?rnberg
> Waldstr. 6 - 91054 Erlangen - Germany
>
> Tel: +49-9131-85-22707
> Fax: +49-9131-85-25740
>
> B?ro:
>   Raum 3.036
>   Universit?tsstra?e 22
>   (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>
> benjamin.hofner at fau.de
>
> http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
> http://www.benjaminhofner.de
>
> ******************************************************************************
>



-- 
Gavin Simpson, PhD

	[[alternative HTML version deleted]]


From benjamin.hofner at fau.de  Tue Sep  1 18:01:45 2015
From: benjamin.hofner at fau.de (Benjamin Hofner)
Date: Tue, 1 Sep 2015 18:01:45 +0200
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
 plot.formula
In-Reply-To: <CAAHES9wk9aGp2Z0qjabohqEoNZZ3VZPYTvrV76qJKbkj2R7fkQ@mail.gmail.com>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
	<55E5A352.5040008@fau.de>
	<CABdHhvFontSByS65WxooChsQWMWy+W+8W5-TchP-3apjg5kYKQ@mail.gmail.com>
	<CAAHES9xoKg1MN6G=v9ctTP6EwLr28nHchPw03AHFhJJx5KMy8A@mail.gmail.com>
	<55E5ADEC.5080608@fau.de>
	<CAAHES9wk9aGp2Z0qjabohqEoNZZ3VZPYTvrV76qJKbkj2R7fkQ@mail.gmail.com>
Message-ID: <55E5CBE9.5080507@fau.de>

Dear Gavin,

you and Hadley seem to be right. It looks like a problem which is buried 
deeper within R and the method dispatch. It seems like I have to 
reintroduce the class labeled.data.frame and plot.labeled.data.frame.

However, I will post on R-devel to try to understand this issue.

Thanks a lot!
Benjamin

Am 01.09.2015 um 17:54 schrieb Gavin Simpson:
> It's not just plot.formula that is broken; plot.lm is dead too for
> example. It's seems that just unexported methods fail to be called. This
> works plot(ts(1:100)), correctly calling the plot.ts method.
>
> What you must be doing overwriting the plot generic seems to be
> clobbering S3 dispatch or killing the registration of those methods such
> that they never get called.
>
> I think you might need to take this to R Devel to ask what is happening
> to S3 dispatch when you modify the generic (by providing your own),
> unless someone else here knows what is going on?
>
> If this isn't a problem in R, it looks like it would be easier all round
> to follow Prof. Ripley's other advice/option and add a new class to
> data.frame objects and provide a method for that new class...
>
> HTH
>
> G
>
> On 1 September 2015 at 07:53, Benjamin Hofner <benjamin.hofner at fau.de
> <mailto:benjamin.hofner at fau.de>> wrote:
>
>     I am using it this way as I want to be able to plot data.frames but
>     have a better display and more options. Thus, using plot.data.frame
>     seems rather natural. A different function or new classes are just a
>     work around. I do not want to use a new class as these functions
>     should work on ANY data frame without coercion.
>
>     Additionally, I had the function plot.data.frame [*] in an old
>     versions of the package and would like to keep it for backward
>     compatibility.
>
>     [*] admittedly the function was plot.labeled.data.frame but I
>     dropped the class labeled.data.frame as all my functions now work on
>     regular data frames as well. If labels are present, these are used.
>     If not, not.
>
>     Benjamin
>
>     Am 01.09.2015 um 15:44 schrieb Gavin Simpson:
>
>         ...or have an object that is a data.frame but to which you add an
>         additional class
>
>         class(obj) <- c("my_df", "data.frame")
>
>         Then you can include plot.my_df() in your package, plus a
>         function to
>         create a my_df object from a data frame, and you don't have to worry
>         about all this and your objects will still work like data frames
>
>         G
>
>         On Sep 1, 2015 07:15, "Hadley Wickham" <h.wickham at gmail.com
>         <mailto:h.wickham at gmail.com>
>         <mailto:h.wickham at gmail.com <mailto:h.wickham at gmail.com>>> wrote:
>
>              Why don't you just create your own function?
>
>              Hadley
>
>              On Tue, Sep 1, 2015 at 8:08 AM, Benjamin Hofner
>              <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>         <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>>
>         wrote:
>               > Dear Gavin,
>               >
>               > unfortunately, I cannot overwrite plot.data.frame only.
>         If I do
>              this I
>               > get the following warning from R CMD check:
>               >
>               > * checking use of S3 registration ... WARNING
>               > Registered S3 method from a standard package overwritten
>         by 'papeR':
>               > method from
>               > plot.data.frame graphics
>               >
>               > The reason for this is given in the following statement
>         by Prof.
>              Ripley:
>               >
>               >> Do not replace registered S3 methods from
>         base/recommended packages,
>               >> something which is not allowed by the CRAN policies and
>         will mean
>               >> that everyone gets your method even if your namespace
>         is unloaded.
>               >
>               > The route I am taking is one of the advised routes to go
>         (see
>               > https://github.com/hofnerb/papeR/issues/5). So I am
>         still looking
>              for a fix
>               > of this issue.
>               >
>               > Your warning regarding the changed user experience is
>         well noted.
>              However, I
>               > think (and am aware that this is my personal opinion)
>         that a lot
>              of users
>               > will not miss the standard plot.data.frame method which
>         is only
>              well defined
>               > for numerics anyway and not very informative in many
>         situations.
>              After your
>               > comment I am thinking of adding an option to my
>         plot.data.frame
>              function
>               > which allows to fall back to the original user experience.
>               >
>               > Thanks,
>               > Benjamin
>               >
>               > Am 01.09.2015 um 04:37 schrieb Gavin Simpson:
>               >>
>               >> Why do you even need to take over `plot`,
>         `plot.default`? You
>              can just
>               >> register/export the plot.data.frame method from our
>         package without
>               >> touching the generic or default method. The part of WRE
>         that you
>              refer
>               >> to is about making functions that are *not* S3 methods
>         in one of
>              base R
>               >> or it's packages into S3 generics. You are just providing a
>              method for
>               >> an existing generic so you don't need to follow that code.
>               >>
>               >> That said, it wouldn't be good form to fundamentally
>         alter the way
>               >> plot.data.frame worked as users might expect certain
>         functionality.
>               >>
>               >> HTH
>               >>
>               >> G
>               >>
>               >> On 31 August 2015 at 04:03, Benjamin Hofner
>              <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>         <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>
>               >> <mailto:benjamin.hofner at fau.de
>         <mailto:benjamin.hofner at fau.de> <mailto:benjamin.hofner at fau.de
>         <mailto:benjamin.hofner at fau.de>>>>
>
>              wrote:
>               >>
>               >>     Dear all,
>               >>
>               >>     CRAN policies do not allow that single methods (for
>         generic
>               >>     functions) which are defined in base or recommended
>         packages are
>               >>     replaced. They advice package authors to replace
>         the standard
>               >>     generic and use a xxx.default method which then
>         calls the
>              original
>               >>     standard generic.
>               >>
>               >>     Using the following code
>               >>
>               >>
>               >>     ## overwrite standard generic
>               >>     plot <- function(x, y, ...)
>               >>          UseMethod("plot")
>               >>
>               >>     ## per default fall back to standard generic
>               >>     plot.default <- function(x, y, ...)
>               >>          graphics::plot(x, y, ...)
>               >>
>               >>     ## now specify modified plot function for data frames
>               >>     plot.data.frame <- function(x, variables =
>         names(x), ...)
>               >>
>               >>
>               >>     essentially works for all tested plot.xxx
>         functions. Yet, it
>              breaks
>               >>     plot.formula. How can I proceed to overwrite
>         plot.data.frame
>              without
>               >>     breaking plot.formula. Any help is greatly appreciated.
>               >>
>               >>     For a detailed description of the problem with syntax
>              highlighting
>               >>     and code to reproduce the problem please see:
>               >>
>               >>
>               >>
>         http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
>               >>
>               >>     Best,
>               >>     Benjamin
>               >>     --
>               >>
>               >>
>
>         ******************************************************************************
>               >>     Dr. rer. nat. Benjamin Hofner
>               >>
>               >>     Institut f?r Medizininformatik, Biometrie und
>         Epidemiologie
>               >>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>               >>     Waldstr. 6 - 91054 Erlangen - Germany
>               >>
>               >>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>         <tel:%2B49-9131-85-22707>
>              <tel:%2B49-9131-85-22707>
>               >>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>         <tel:%2B49-9131-85-25740>
>              <tel:%2B49-9131-85-25740>
>               >>
>               >>     B?ro:
>               >>        Raum 3.036
>               >>        Universit?tsstra?e 22
>               >>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>               >>
>               >> benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>         <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>
>              <mailto:benjamin.hofner at fau.de
>         <mailto:benjamin.hofner at fau.de> <mailto:benjamin.hofner at fau.de
>         <mailto:benjamin.hofner at fau.de>>>
>               >>
>               >>
>         http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>               >> http://www.benjaminhofner.de
>               >>
>               >>     ______________________________________________
>               >> R-package-devel at r-project.org
>         <mailto:R-package-devel at r-project.org>
>              <mailto:R-package-devel at r-project.org
>         <mailto:R-package-devel at r-project.org>>
>              <mailto:R-package-devel at r-project.org
>         <mailto:R-package-devel at r-project.org>
>              <mailto:R-package-devel at r-project.org
>         <mailto:R-package-devel at r-project.org>>>
>               >>     mailing list
>               >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>               >>
>               >>
>               >>
>               >>
>               >> --
>               >> Gavin Simpson, PhD
>               >
>               >
>               > ______________________________________________
>               > R-package-devel at r-project.org
>         <mailto:R-package-devel at r-project.org>
>              <mailto:R-package-devel at r-project.org
>         <mailto:R-package-devel at r-project.org>> mailing list
>               > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>
>
>              --
>         http://had.co.nz/
>
>
>     --
>     ******************************************************************************
>     Dr. rer. nat. Benjamin Hofner
>
>     Institut f?r Medizininformatik, Biometrie und Epidemiologie
>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>     Waldstr. 6 - 91054 Erlangen - Germany
>
>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>
>     B?ro:
>        Raum 3.036
>        Universit?tsstra?e 22
>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>
>     benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>
>     http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>     http://www.benjaminhofner.de
>     ******************************************************************************
>
>
>
>
> --
> Gavin Simpson, PhD

-- 
******************************************************************************
Dr. rer. nat. Benjamin Hofner

Institut f?r Medizininformatik, Biometrie und Epidemiologie
Friedrich-Alexander-Universit?t Erlangen-N?rnberg
Waldstr. 6 - 91054 Erlangen - Germany

Tel: +49-9131-85-22707
Fax: +49-9131-85-25740

B?ro:
   Raum 3.036
   Universit?tsstra?e 22
   (Eingang linke Seite des Geb?udes; Wegweiser IMBE)

benjamin.hofner at fau.de

http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
http://www.benjaminhofner.de


From kevinushey at gmail.com  Tue Sep  1 19:18:25 2015
From: kevinushey at gmail.com (Kevin Ushey)
Date: Tue, 1 Sep 2015 10:18:25 -0700
Subject: [R-pkg-devel] Redefinition of generic for plot function breaks
	plot.formula
In-Reply-To: <55E5CBE9.5080507@fau.de>
References: <55E42654.20309@fau.de>
	<CAAHES9xx7f=PV0uCKCAYuFr_A5OUUSL+yR8yPjGWmmrDe4_POg@mail.gmail.com>
	<55E5A352.5040008@fau.de>
	<CABdHhvFontSByS65WxooChsQWMWy+W+8W5-TchP-3apjg5kYKQ@mail.gmail.com>
	<CAAHES9xoKg1MN6G=v9ctTP6EwLr28nHchPw03AHFhJJx5KMy8A@mail.gmail.com>
	<55E5ADEC.5080608@fau.de>
	<CAAHES9wk9aGp2Z0qjabohqEoNZZ3VZPYTvrV76qJKbkj2R7fkQ@mail.gmail.com>
	<55E5CBE9.5080507@fau.de>
Message-ID: <CAJXgQP3oRXYfW3OXx-dcu_WCX-Y9tYw=BG-neyETbFavdwyyuw@mail.gmail.com>

FWIW, it's a very _very_ bad idea to add methods to S3 generics for
classes you don't 'own'. Some code might be written with the
expectation that `plot(df)` actually does dispatch to `plot.default`.
This implies that simply loading your package would break code in
surprising ways.

I would strongly suggest creating your own class and using
pre-existing generics whenever possible.


On Tue, Sep 1, 2015 at 9:01 AM, Benjamin Hofner <benjamin.hofner at fau.de> wrote:
> Dear Gavin,
>
> you and Hadley seem to be right. It looks like a problem which is buried
> deeper within R and the method dispatch. It seems like I have to reintroduce
> the class labeled.data.frame and plot.labeled.data.frame.
>
> However, I will post on R-devel to try to understand this issue.
>
> Thanks a lot!
> Benjamin
>
> Am 01.09.2015 um 17:54 schrieb Gavin Simpson:
>>
>> It's not just plot.formula that is broken; plot.lm is dead too for
>> example. It's seems that just unexported methods fail to be called. This
>> works plot(ts(1:100)), correctly calling the plot.ts method.
>>
>> What you must be doing overwriting the plot generic seems to be
>> clobbering S3 dispatch or killing the registration of those methods such
>> that they never get called.
>>
>> I think you might need to take this to R Devel to ask what is happening
>> to S3 dispatch when you modify the generic (by providing your own),
>> unless someone else here knows what is going on?
>>
>> If this isn't a problem in R, it looks like it would be easier all round
>> to follow Prof. Ripley's other advice/option and add a new class to
>> data.frame objects and provide a method for that new class...
>>
>> HTH
>>
>> G
>>
>> On 1 September 2015 at 07:53, Benjamin Hofner <benjamin.hofner at fau.de
>> <mailto:benjamin.hofner at fau.de>> wrote:
>>
>>     I am using it this way as I want to be able to plot data.frames but
>>     have a better display and more options. Thus, using plot.data.frame
>>     seems rather natural. A different function or new classes are just a
>>     work around. I do not want to use a new class as these functions
>>     should work on ANY data frame without coercion.
>>
>>     Additionally, I had the function plot.data.frame [*] in an old
>>     versions of the package and would like to keep it for backward
>>     compatibility.
>>
>>     [*] admittedly the function was plot.labeled.data.frame but I
>>     dropped the class labeled.data.frame as all my functions now work on
>>     regular data frames as well. If labels are present, these are used.
>>     If not, not.
>>
>>     Benjamin
>>
>>     Am 01.09.2015 um 15:44 schrieb Gavin Simpson:
>>
>>         ...or have an object that is a data.frame but to which you add an
>>         additional class
>>
>>         class(obj) <- c("my_df", "data.frame")
>>
>>         Then you can include plot.my_df() in your package, plus a
>>         function to
>>         create a my_df object from a data frame, and you don't have to
>> worry
>>         about all this and your objects will still work like data frames
>>
>>         G
>>
>>         On Sep 1, 2015 07:15, "Hadley Wickham" <h.wickham at gmail.com
>>         <mailto:h.wickham at gmail.com>
>>         <mailto:h.wickham at gmail.com <mailto:h.wickham at gmail.com>>> wrote:
>>
>>              Why don't you just create your own function?
>>
>>              Hadley
>>
>>              On Tue, Sep 1, 2015 at 8:08 AM, Benjamin Hofner
>>              <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>>         <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>>
>>         wrote:
>>               > Dear Gavin,
>>               >
>>               > unfortunately, I cannot overwrite plot.data.frame only.
>>         If I do
>>              this I
>>               > get the following warning from R CMD check:
>>               >
>>               > * checking use of S3 registration ... WARNING
>>               > Registered S3 method from a standard package overwritten
>>         by 'papeR':
>>               > method from
>>               > plot.data.frame graphics
>>               >
>>               > The reason for this is given in the following statement
>>         by Prof.
>>              Ripley:
>>               >
>>               >> Do not replace registered S3 methods from
>>         base/recommended packages,
>>               >> something which is not allowed by the CRAN policies and
>>         will mean
>>               >> that everyone gets your method even if your namespace
>>         is unloaded.
>>               >
>>               > The route I am taking is one of the advised routes to go
>>         (see
>>               > https://github.com/hofnerb/papeR/issues/5). So I am
>>         still looking
>>              for a fix
>>               > of this issue.
>>               >
>>               > Your warning regarding the changed user experience is
>>         well noted.
>>              However, I
>>               > think (and am aware that this is my personal opinion)
>>         that a lot
>>              of users
>>               > will not miss the standard plot.data.frame method which
>>         is only
>>              well defined
>>               > for numerics anyway and not very informative in many
>>         situations.
>>              After your
>>               > comment I am thinking of adding an option to my
>>         plot.data.frame
>>              function
>>               > which allows to fall back to the original user experience.
>>               >
>>               > Thanks,
>>               > Benjamin
>>               >
>>               > Am 01.09.2015 um 04:37 schrieb Gavin Simpson:
>>               >>
>>               >> Why do you even need to take over `plot`,
>>         `plot.default`? You
>>              can just
>>               >> register/export the plot.data.frame method from our
>>         package without
>>               >> touching the generic or default method. The part of WRE
>>         that you
>>              refer
>>               >> to is about making functions that are *not* S3 methods
>>         in one of
>>              base R
>>               >> or it's packages into S3 generics. You are just providing
>> a
>>              method for
>>               >> an existing generic so you don't need to follow that
>> code.
>>               >>
>>               >> That said, it wouldn't be good form to fundamentally
>>         alter the way
>>               >> plot.data.frame worked as users might expect certain
>>         functionality.
>>               >>
>>               >> HTH
>>               >>
>>               >> G
>>               >>
>>               >> On 31 August 2015 at 04:03, Benjamin Hofner
>>              <benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>>         <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>
>>               >> <mailto:benjamin.hofner at fau.de
>>         <mailto:benjamin.hofner at fau.de> <mailto:benjamin.hofner at fau.de
>>         <mailto:benjamin.hofner at fau.de>>>>
>>
>>              wrote:
>>               >>
>>               >>     Dear all,
>>               >>
>>               >>     CRAN policies do not allow that single methods (for
>>         generic
>>               >>     functions) which are defined in base or recommended
>>         packages are
>>               >>     replaced. They advice package authors to replace
>>         the standard
>>               >>     generic and use a xxx.default method which then
>>         calls the
>>              original
>>               >>     standard generic.
>>               >>
>>               >>     Using the following code
>>               >>
>>               >>
>>               >>     ## overwrite standard generic
>>               >>     plot <- function(x, y, ...)
>>               >>          UseMethod("plot")
>>               >>
>>               >>     ## per default fall back to standard generic
>>               >>     plot.default <- function(x, y, ...)
>>               >>          graphics::plot(x, y, ...)
>>               >>
>>               >>     ## now specify modified plot function for data frames
>>               >>     plot.data.frame <- function(x, variables =
>>         names(x), ...)
>>               >>
>>               >>
>>               >>     essentially works for all tested plot.xxx
>>         functions. Yet, it
>>              breaks
>>               >>     plot.formula. How can I proceed to overwrite
>>         plot.data.frame
>>              without
>>               >>     breaking plot.formula. Any help is greatly
>> appreciated.
>>               >>
>>               >>     For a detailed description of the problem with syntax
>>              highlighting
>>               >>     and code to reproduce the problem please see:
>>               >>
>>               >>
>>               >>
>>
>> http://stackoverflow.com/questions/32246361/redefinition-of-generic-for-plot-function-breaks-plot-formula
>>               >>
>>               >>     Best,
>>               >>     Benjamin
>>               >>     --
>>               >>
>>               >>
>>
>>
>> ******************************************************************************
>>               >>     Dr. rer. nat. Benjamin Hofner
>>               >>
>>               >>     Institut f?r Medizininformatik, Biometrie und
>>         Epidemiologie
>>               >>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>>               >>     Waldstr. 6 - 91054 Erlangen - Germany
>>               >>
>>               >>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>>         <tel:%2B49-9131-85-22707>
>>              <tel:%2B49-9131-85-22707>
>>               >>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>>         <tel:%2B49-9131-85-25740>
>>              <tel:%2B49-9131-85-25740>
>>               >>
>>               >>     B?ro:
>>               >>        Raum 3.036
>>               >>        Universit?tsstra?e 22
>>               >>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>>               >>
>>               >> benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>>         <mailto:benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>>
>>              <mailto:benjamin.hofner at fau.de
>>         <mailto:benjamin.hofner at fau.de> <mailto:benjamin.hofner at fau.de
>>         <mailto:benjamin.hofner at fau.de>>>
>>               >>
>>               >>
>>         http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>>               >> http://www.benjaminhofner.de
>>               >>
>>               >>     ______________________________________________
>>               >> R-package-devel at r-project.org
>>         <mailto:R-package-devel at r-project.org>
>>              <mailto:R-package-devel at r-project.org
>>         <mailto:R-package-devel at r-project.org>>
>>              <mailto:R-package-devel at r-project.org
>>         <mailto:R-package-devel at r-project.org>
>>              <mailto:R-package-devel at r-project.org
>>         <mailto:R-package-devel at r-project.org>>>
>>               >>     mailing list
>>               >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>               >>
>>               >>
>>               >>
>>               >>
>>               >> --
>>               >> Gavin Simpson, PhD
>>               >
>>               >
>>               > ______________________________________________
>>               > R-package-devel at r-project.org
>>         <mailto:R-package-devel at r-project.org>
>>              <mailto:R-package-devel at r-project.org
>>         <mailto:R-package-devel at r-project.org>> mailing list
>>               > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>
>>
>>              --
>>         http://had.co.nz/
>>
>>
>>     --
>>
>> ******************************************************************************
>>     Dr. rer. nat. Benjamin Hofner
>>
>>     Institut f?r Medizininformatik, Biometrie und Epidemiologie
>>     Friedrich-Alexander-Universit?t Erlangen-N?rnberg
>>     Waldstr. 6 - 91054 Erlangen - Germany
>>
>>     Tel: +49-9131-85-22707 <tel:%2B49-9131-85-22707>
>>     Fax: +49-9131-85-25740 <tel:%2B49-9131-85-25740>
>>
>>     B?ro:
>>        Raum 3.036
>>        Universit?tsstra?e 22
>>        (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>>
>>     benjamin.hofner at fau.de <mailto:benjamin.hofner at fau.de>
>>
>>     http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
>>     http://www.benjaminhofner.de
>>
>> ******************************************************************************
>>
>>
>>
>>
>> --
>> Gavin Simpson, PhD
>
>
> --
> ******************************************************************************
> Dr. rer. nat. Benjamin Hofner
>
> Institut f?r Medizininformatik, Biometrie und Epidemiologie
> Friedrich-Alexander-Universit?t Erlangen-N?rnberg
> Waldstr. 6 - 91054 Erlangen - Germany
>
> Tel: +49-9131-85-22707
> Fax: +49-9131-85-25740
>
> B?ro:
>   Raum 3.036
>   Universit?tsstra?e 22
>   (Eingang linke Seite des Geb?udes; Wegweiser IMBE)
>
> benjamin.hofner at fau.de
>
> http://www.imbe.med.uni-erlangen.de/cms/benjamin_hofner.html
> http://www.benjaminhofner.de
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From limxx356 at umn.edu  Fri Sep  4 00:07:05 2015
From: limxx356 at umn.edu (Chay Ngee Lim)
Date: Thu, 3 Sep 2015 17:07:05 -0500
Subject: [R-pkg-devel] devtools::revdep_check error message
Message-ID: <CAF+B1fQnGMj=6vYZneYWfcf1WAzghM0YtUE_g6=4MiZqexHWhg@mail.gmail.com>

Hi,

I am a first time package developer, having issues with the downstream
dependency check function -- devtools::revdep_check.

>From the manual, it seems that by default the current directory will
be set as the package path so I was working within the package path
and had completed the checks before going to the downstream dependency
check but I am getting the following error message:


Reverse dependency checks for phxnlme
===================================================================Installing
phxnlmeError in normalizePath(path.expand(path), winslash, mustWork) :
  path[1]="C:\Users\Chay\AppData\Local\Temp\Rtmp001SM6/R-lib": The
system cannot find the path specified


Thanks.

Chay

	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Fri Sep  4 00:38:04 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 3 Sep 2015 18:38:04 -0400
Subject: [R-pkg-devel] devtools::revdep_check error message
In-Reply-To: <CAF+B1fQnGMj=6vYZneYWfcf1WAzghM0YtUE_g6=4MiZqexHWhg@mail.gmail.com>
References: <CAF+B1fQnGMj=6vYZneYWfcf1WAzghM0YtUE_g6=4MiZqexHWhg@mail.gmail.com>
Message-ID: <55E8CBCC.4000108@gmail.com>

On 03/09/2015 6:07 PM, Chay Ngee Lim wrote:
> Hi,
> 
> I am a first time package developer, having issues with the downstream
> dependency check function -- devtools::revdep_check.
> 
>>From the manual, it seems that by default the current directory will
> be set as the package path so I was working within the package path
> and had completed the checks before going to the downstream dependency
> check but I am getting the following error message:
> 
> 
> Reverse dependency checks for phxnlme
> ===================================================================Installing
> phxnlmeError in normalizePath(path.expand(path), winslash, mustWork) :
>   path[1]="C:\Users\Chay\AppData\Local\Temp\Rtmp001SM6/R-lib": The
> system cannot find the path specified
> 

This sounds like a devtools misuse or bug --- you probably need to ask
about it on the devtools page.  (devtools is not part of R, it is a
contributed package.)

The devtools page is http://github.com/hadley/devtools.

Duncan Murdoch


From benjamin.leutner at uni-wuerzburg.de  Fri Sep  4 10:34:41 2015
From: benjamin.leutner at uni-wuerzburg.de (Benjamin Leutner)
Date: Fri, 4 Sep 2015 10:34:41 +0200
Subject: [R-pkg-devel] Winbuilder build error on r-release due to lazy
	loading
Message-ID: <55E957A1.8080804@uni-wuerzburg.de>

Dear List,

I'm about to submit my first package to CRAN but am stuck with an error 
on winbuilder:
My package builds and checks fine on TravisCI (oldrel, release and 
r-devel) as well as locally (Ubuntu 15.04 and Windows, R3.2.2).

When I submit it to winbuilder it builds without problems on R-devel.

http://win-builder.r-project.org/feFmHdOo851R


However on R-release it fails to pass the R-release build:

http://win-builder.r-project.org/N9v1fqwY4e13

Permanent link to failing log (00install.out):

https://gist.github.com/bleutner/69c78460894a53b1a8d9


The 00install.out says:

** R
** data
*** moving datasets to lazyload DB
** inst
** preparing package for lazy loading
Error : objects 'findbars', 'nobars' are not exported by 'namespace:lme4'
ERROR: lazy loading failed for package 'RStoolbox'
* removing 'd:/RCompile/CRANguest/R-release/lib/RStoolbox'


This is the package repo:

https://github.com/bleutner/RStoolbox


I don't get what is happening here. Is it my fault or is there something 
wrong on winbuilder?
I can't reproduce this on any other Windows machine all on R3.2.2


Best regards,
Benjamin


-- 
Benjamin Leutner M.Sc.

Department of Remote Sensing
University of Wuerzburg
Campus Hubland Nord 86
97074 Wuerzburg, Germany

Tel: +49-(0)931-31 89594
Fax: +49-(0)931-31 89594-0
Email: benjamin.leutner at uni-wuerzburg.de
Web: http://www.fernerkundung.uni-wuerzburg.de


From benjamin.leutner at uni-wuerzburg.de  Fri Sep  4 20:59:53 2015
From: benjamin.leutner at uni-wuerzburg.de (Benjamin Leutner)
Date: Fri, 4 Sep 2015 20:59:53 +0200
Subject: [R-pkg-devel] Winbuilder build error on r-release due to lazy
 loading
In-Reply-To: <55E957A1.8080804@uni-wuerzburg.de>
References: <55E957A1.8080804@uni-wuerzburg.de>
Message-ID: <55E9EA29.3090108@uni-wuerzburg.de>


To supplement my previous email:
here is a link to the source bundle if that helps
https://raw.githubusercontent.com/bleutner/RStoolbox/gh-pages/RStoolbox_0.1.0.tar.gz

On 04.09.2015 10:34, Benjamin Leutner wrote:
> Dear List,
>
> I'm about to submit my first package to CRAN but am stuck with an 
> error on winbuilder:
> My package builds and checks fine on TravisCI (oldrel, release and 
> r-devel) as well as locally (Ubuntu 15.04 and Windows, R3.2.2).
>
> When I submit it to winbuilder it builds without problems on R-devel.
>
> http://win-builder.r-project.org/feFmHdOo851R
>
>
> However on R-release it fails to pass the R-release build:
>
> http://win-builder.r-project.org/N9v1fqwY4e13
>
> Permanent link to failing log (00install.out):
>
> https://gist.github.com/bleutner/69c78460894a53b1a8d9
>
>
> The 00install.out says:
>
> ** R
> ** data
> *** moving datasets to lazyload DB
> ** inst
> ** preparing package for lazy loading
> Error : objects 'findbars', 'nobars' are not exported by 'namespace:lme4'
> ERROR: lazy loading failed for package 'RStoolbox'
> * removing 'd:/RCompile/CRANguest/R-release/lib/RStoolbox'
>
>
> This is the package repo:
>
> https://github.com/bleutner/RStoolbox
>
>
> I don't get what is happening here. Is it my fault or is there 
> something wrong on winbuilder?
> I can't reproduce this on any other Windows machine all on R3.2.2
>
>
> Best regards,
> Benjamin
>
>

-- 
Benjamin Leutner M.Sc.

Department of Remote Sensing
University of Wuerzburg
Campus Hubland Nord 86
97074 Wuerzburg, Germany

Tel: +49-(0)931-31 89594
Fax: +49-(0)931-31 89594-0
Email: benjamin.leutner at uni-wuerzburg.de
Web: http://www.fernerkundung.uni-wuerzburg.de


From ligges at statistik.tu-dortmund.de  Fri Sep  4 21:55:51 2015
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 4 Sep 2015 21:55:51 +0200
Subject: [R-pkg-devel] Winbuilder build error on r-release due to lazy
 loading
In-Reply-To: <55E9EA29.3090108@uni-wuerzburg.de>
References: <55E957A1.8080804@uni-wuerzburg.de>
	<55E9EA29.3090108@uni-wuerzburg.de>
Message-ID: <55E9F747.5070703@statistik.tu-dortmund.de>

Please try again now.


Best,
Uwe Ligges


On 04.09.2015 20:59, Benjamin Leutner wrote:
>
> To supplement my previous email:
> here is a link to the source bundle if that helps
> https://raw.githubusercontent.com/bleutner/RStoolbox/gh-pages/RStoolbox_0.1.0.tar.gz
>
>
> On 04.09.2015 10:34, Benjamin Leutner wrote:
>> Dear List,
>>
>> I'm about to submit my first package to CRAN but am stuck with an
>> error on winbuilder:
>> My package builds and checks fine on TravisCI (oldrel, release and
>> r-devel) as well as locally (Ubuntu 15.04 and Windows, R3.2.2).
>>
>> When I submit it to winbuilder it builds without problems on R-devel.
>>
>> http://win-builder.r-project.org/feFmHdOo851R
>>
>>
>> However on R-release it fails to pass the R-release build:
>>
>> http://win-builder.r-project.org/N9v1fqwY4e13
>>
>> Permanent link to failing log (00install.out):
>>
>> https://gist.github.com/bleutner/69c78460894a53b1a8d9
>>
>>
>> The 00install.out says:
>>
>> ** R
>> ** data
>> *** moving datasets to lazyload DB
>> ** inst
>> ** preparing package for lazy loading
>> Error : objects 'findbars', 'nobars' are not exported by 'namespace:lme4'
>> ERROR: lazy loading failed for package 'RStoolbox'
>> * removing 'd:/RCompile/CRANguest/R-release/lib/RStoolbox'
>>
>>
>> This is the package repo:
>>
>> https://github.com/bleutner/RStoolbox
>>
>>
>> I don't get what is happening here. Is it my fault or is there
>> something wrong on winbuilder?
>> I can't reproduce this on any other Windows machine all on R3.2.2
>>
>>
>> Best regards,
>> Benjamin
>>
>>
>


From benjamin.leutner at uni-wuerzburg.de  Fri Sep  4 22:24:26 2015
From: benjamin.leutner at uni-wuerzburg.de (Benjamin Leutner)
Date: Fri, 4 Sep 2015 22:24:26 +0200
Subject: [R-pkg-devel] Winbuilder build error on r-release due to lazy
 loading
In-Reply-To: <55E9F747.5070703@statistik.tu-dortmund.de>
References: <55E957A1.8080804@uni-wuerzburg.de>
	<55E9EA29.3090108@uni-wuerzburg.de>
	<55E9F747.5070703@statistik.tu-dortmund.de>
Message-ID: <55E9FDFA.1070803@uni-wuerzburg.de>

Fantastic. Now it builds just fine. Out of curiosity: what was the issue?

Thanks
Benjamin


On 04.09.2015 21:55, Uwe Ligges wrote:
> Please try again now.
>
>
> Best,
> Uwe Ligges
>
>
> On 04.09.2015 20:59, Benjamin Leutner wrote:
>>
>> To supplement my previous email:
>> here is a link to the source bundle if that helps
>> https://raw.githubusercontent.com/bleutner/RStoolbox/gh-pages/RStoolbox_0.1.0.tar.gz 
>>
>>
>>
>> On 04.09.2015 10:34, Benjamin Leutner wrote:
>>> Dear List,
>>>
>>> I'm about to submit my first package to CRAN but am stuck with an
>>> error on winbuilder:
>>> My package builds and checks fine on TravisCI (oldrel, release and
>>> r-devel) as well as locally (Ubuntu 15.04 and Windows, R3.2.2).
>>>
>>> When I submit it to winbuilder it builds without problems on R-devel.
>>>
>>> http://win-builder.r-project.org/feFmHdOo851R
>>>
>>>
>>> However on R-release it fails to pass the R-release build:
>>>
>>> http://win-builder.r-project.org/N9v1fqwY4e13
>>>
>>> Permanent link to failing log (00install.out):
>>>
>>> https://gist.github.com/bleutner/69c78460894a53b1a8d9
>>>
>>>
>>> The 00install.out says:
>>>
>>> ** R
>>> ** data
>>> *** moving datasets to lazyload DB
>>> ** inst
>>> ** preparing package for lazy loading
>>> Error : objects 'findbars', 'nobars' are not exported by 
>>> 'namespace:lme4'
>>> ERROR: lazy loading failed for package 'RStoolbox'
>>> * removing 'd:/RCompile/CRANguest/R-release/lib/RStoolbox'
>>>
>>>
>>> This is the package repo:
>>>
>>> https://github.com/bleutner/RStoolbox
>>>
>>>
>>> I don't get what is happening here. Is it my fault or is there
>>> something wrong on winbuilder?
>>> I can't reproduce this on any other Windows machine all on R3.2.2
>>>
>>>
>>> Best regards,
>>> Benjamin
>>>
>>>
>>
>

-- 
Benjamin Leutner M.Sc.

Department of Remote Sensing
University of Wuerzburg
Campus Hubland Nord 86
97074 Wuerzburg, Germany

Tel: +49-(0)931-31 89594
Fax: +49-(0)931-31 89594-0
Email: benjamin.leutner at uni-wuerzburg.de
Web: http://www.fernerkundung.uni-wuerzburg.de


From erich.subs at neuwirth.priv.at  Mon Sep 14 17:24:14 2015
From: erich.subs at neuwirth.priv.at (Erich Subscriptions)
Date: Mon, 14 Sep 2015 17:24:14 +0200
Subject: [R-pkg-devel] html from Rd
Message-ID: <F38E7170-5C8F-4815-818E-5D6601D4EA51@neuwirth.priv.at>

I am converting an Rd file to html.
I am furthermore using the html file produced as input for producing a ch, file.
And the user experience could be improved it there were a way to embed names like
<a name=?first name?> 
into the html file produced.
Is there a way of accomplishing this?

Erich Neuwirth

From murdoch.duncan at gmail.com  Mon Sep 14 18:37:23 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 14 Sep 2015 12:37:23 -0400
Subject: [R-pkg-devel] html from Rd
In-Reply-To: <F38E7170-5C8F-4815-818E-5D6601D4EA51@neuwirth.priv.at>
References: <F38E7170-5C8F-4815-818E-5D6601D4EA51@neuwirth.priv.at>
Message-ID: <55F6F7C3.1030003@gmail.com>

On 14/09/2015 11:24 AM, Erich Subscriptions wrote:
> I am converting an Rd file to html.
> I am furthermore using the html file produced as input for producing a ch, file.
> And the user experience could be improved it there were a way to embed names like
> <a name=?first name?>
> into the html file produced.
> Is there a way of accomplishing this?

I think this is more of an R-devel topic, but the answer is "yes, 
several ways, none very simple".

The way I'd do it is to split up the parse_Rd() step from the Rd2HTML() 
step, and add the extra bit to the parsed version.

Another way to do it would be to edit the input file before conversion, 
or the output file after conversion.  The latter is probably easier 
because the output is a little more predictable.

Duncan Murdoch


From dstr7320 at uni.sydney.edu.au  Tue Sep 15 07:00:05 2015
From: dstr7320 at uni.sydney.edu.au (Dario Strbenac)
Date: Tue, 15 Sep 2015 05:00:05 +0000
Subject: [R-pkg-devel] Return Value of By Function
Message-ID: <SN1PR0101MB1439A0B7AAADF3724A2F165DCD5C0@SN1PR0101MB1439.prod.exchangelabs.com>

Good day,

I am curious why the by function result has dimensions attached, even when it returns a list.

result <- by(warpbreaks[, 1],   warpbreaks[, -1], summary)
str(result)

List of 6
...
- attr(*, "dim")= int [1:2] 2 3
 - attr(*, "dimnames")=List of 2
  ..$ wool   : chr [1:2] "A" "B"
  ..$ tension: chr [1:3] "L" "M" "H"

Also, why does looking at the top of the list remove the names ?

> head(result, 3)
[[1]]
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   26.00   51.00   44.56   54.00   70.00 

[[2]]
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  14.00   20.00   29.00   28.22   31.00   44.00 

[[3]]
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
     12      18      21      24      30      36

Compared to :

> result
wool: A
tension: L
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   26.00   51.00   44.56   54.00   70.00 
...

I can't tell which list entry is for which combination of factors, after it is accessed. It would be great if it was easier to get the factor levels used for each list element, perhaps as a data.frame.

--------------------------------------
Dario Strbenac
PhD Student
University of Sydney
Camperdown NSW 2050
Australia


From maechler at stat.math.ethz.ch  Tue Sep 15 09:49:45 2015
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 15 Sep 2015 09:49:45 +0200
Subject: [R-pkg-devel] Return Value of By Function
In-Reply-To: <SN1PR0101MB1439A0B7AAADF3724A2F165DCD5C0@SN1PR0101MB1439.prod.exchangelabs.com>
References: <SN1PR0101MB1439A0B7AAADF3724A2F165DCD5C0@SN1PR0101MB1439.prod.exchangelabs.com>
Message-ID: <22007.52633.450451.206739@stat.math.ethz.ch>

>>>>> Dario Strbenac <dstr7320 at uni.sydney.edu.au>
>>>>>     on Tue, 15 Sep 2015 05:00:05 +0000 writes:

    > Good day, I am curious why the by function result has
    > dimensions attached, even when it returns a list.

Sorry, but this is *NOT* the mailing list for such questions !

Please ask on different list (or forum), e.g., on R-help.

Martin Maechler


From alex.deckmyn at meteo.be  Fri Sep 18 22:25:21 2015
From: alex.deckmyn at meteo.be (Alex Deckmyn)
Date: Fri, 18 Sep 2015 22:25:21 +0200 (CEST)
Subject: [R-pkg-devel] problem with locale-dependent order()
Message-ID: <1594107507.7395252.1442607921071.JavaMail.zimbra@meteo.be>

Hi, 

For an update of the maps package, I have run into a bug caused by the locale-depent behaviour of order(). 
In a certain function, the polygon names of the world map are lexically sorted with order() prior to being sent to a C routine. That routine expects them to be sorted according to ASCII rules, but that is not the result I get. The main culprit is the colon used to identify sub-regions. For instance, in my locale (en_GB_UTF-8), I get 

"uk:northen ireland" < "ukrain" < "uk:scotland" 

which is not the order expected by C. I guess some language settings would also cause other unexpected results. 

Apart from the pain of fixing uk/ukrain ambiguities, is there a safe way to fix this order() in a package? An obvious solution seems to be 

lcc <- Sys.getlocale("LC_COLLATE") 
Sys.setlocale("LC_COLLATE","C") 
ord.nam <- order(nam) 
Sys.setlocale("LC_COLLATE",lcc) 

This seems to work fine on my linux PC, but I am not sure about other platforms (Windows, OS-X...), though the "C" locale should be standard. Is this safe? Or is there a better way to get the right ordering? 

Alex 

--- 
Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be 
Royal Meteorological Institute http://www.meteo.be 
Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646 

	[[alternative HTML version deleted]]


From richierocks at gmail.com  Sat Sep 19 12:07:06 2015
From: richierocks at gmail.com (Richard Cotton)
Date: Sat, 19 Sep 2015 13:07:06 +0300
Subject: [R-pkg-devel] Writing a portable package that imports functions
	only available on Windows
Message-ID: <CAPp_+=ddQ8taA+xCusq=Vvz=GX8=fY=ieMVYCMHtUBy0_-w2kA@mail.gmail.com>

I have a package that uses win.version from the utils package.

I've made my R code safe to use across platforms, I check that the OS is
Windows before calling win.version.

The NAMESPACE file contains the line

importFrom(utils,win.version)

which causes an install failure under other OSes since that function
doesn't exist.

Can I use this platform-dependent function and still have a cross-platform
package?

Also, it seems like it would be nicer if the utils package always included
this function and returned NA with a warning on platforms other than
Windows.  Does that sound like a reasonable change?

-- 
Regards,
Richie

Learning R <http://shop.oreilly.com/product/0636920028352.do>
4dpiecharts.com

	[[alternative HTML version deleted]]


From thierry.onkelinx at inbo.be  Sat Sep 19 13:05:39 2015
From: thierry.onkelinx at inbo.be (Thierry Onkelinx)
Date: Sat, 19 Sep 2015 13:05:39 +0200
Subject: [R-pkg-devel] Writing a portable package that imports functions
 only available on Windows
In-Reply-To: <CAPp_+=ddQ8taA+xCusq=Vvz=GX8=fY=ieMVYCMHtUBy0_-w2kA@mail.gmail.com>
References: <CAPp_+=ddQ8taA+xCusq=Vvz=GX8=fY=ieMVYCMHtUBy0_-w2kA@mail.gmail.com>
Message-ID: <CAJuCY5w+LFBnh71VhWy+xf8oZmpf3a5jrQvXxFr9ee-Sr7R_cA@mail.gmail.com>

Have a look at the RODBC package. odbcConnectAcces() is only available on
Windows.
Op 19-sep.-2015 12:08 schreef "Richard Cotton" <richierocks at gmail.com>:

> I have a package that uses win.version from the utils package.
>
> I've made my R code safe to use across platforms, I check that the OS is
> Windows before calling win.version.
>
> The NAMESPACE file contains the line
>
> importFrom(utils,win.version)
>
> which causes an install failure under other OSes since that function
> doesn't exist.
>
> Can I use this platform-dependent function and still have a cross-platform
> package?
>
> Also, it seems like it would be nicer if the utils package always included
> this function and returned NA with a warning on platforms other than
> Windows.  Does that sound like a reasonable change?
>
> --
> Regards,
> Richie
>
> Learning R <http://shop.oreilly.com/product/0636920028352.do>
> 4dpiecharts.com
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch.duncan at gmail.com  Sat Sep 19 13:20:03 2015
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 19 Sep 2015 07:20:03 -0400
Subject: [R-pkg-devel] Writing a portable package that imports functions
 only available on Windows
In-Reply-To: <CAPp_+=ddQ8taA+xCusq=Vvz=GX8=fY=ieMVYCMHtUBy0_-w2kA@mail.gmail.com>
References: <CAPp_+=ddQ8taA+xCusq=Vvz=GX8=fY=ieMVYCMHtUBy0_-w2kA@mail.gmail.com>
Message-ID: <55FD44E3.6030801@gmail.com>

On 19/09/2015 6:07 AM, Richard Cotton wrote:
> I have a package that uses win.version from the utils package.
> 
> I've made my R code safe to use across platforms, I check that the OS is
> Windows before calling win.version.
> 
> The NAMESPACE file contains the line
> 
> importFrom(utils,win.version)
> 
> which causes an install failure under other OSes since that function
> doesn't exist.
> 
> Can I use this platform-dependent function and still have a cross-platform
> package?

I think there are two ways to do this.

You can use conditionals in the NAMESPACE file. For example, rgl has

if(tools:::.OStype() == "windows") {
importFrom(utils, getWindowsHandle)
}

This is really old code, and I'm surprised I don't get warnings about
the :::. I believe a better test would be

.Platform$OS.type == "windows"

but I just sent a new version of rgl to CRAN before noticing this, so
the fix will have to wait.

Alternatively, I believe if you use utils::win.version in the code
instead of importing it in the NAMESPACE file you won't get a warning.
(You need to condition the call on being on Windows, of course.)

> 
> Also, it seems like it would be nicer if the utils package always included
> this function and returned NA with a warning on platforms other than
> Windows.  Does that sound like a reasonable change?
> 

Platform-specific functions cause a number of problems; this is just one
of them.  It might be a good idea to do away with them completely, but
that would be pretty boring work, for little gain.

Duncan Murdoch


From mashranga at yahoo.com  Sat Sep 19 21:42:39 2015
From: mashranga at yahoo.com (Mohammad Tanvir Ahamed)
Date: Sat, 19 Sep 2015 19:42:39 +0000 (UTC)
Subject: Help with Package creation
In-Reply-To: <1889360163.58293.1442630664341.JavaMail.yahoo@mail.yahoo.com>
References: <1889360163.58293.1442630664341.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <747185242.252420.1442691759815.JavaMail.yahoo@mail.yahoo.com>

Hello ,

I am new in R package built. 

I want to install one package (randomForest) that will install automatically while my package(myPack) will install. 
I am using R studio to built. 

My Description file is : 

Package: myPack
Type: Package
Title: What the Package Does (Title Case)
Version: 0.1
Date: 2015-09-19
Author: Who wrote it
Maintainer: Who to complain to <yourfault at somewhere.net>
Description: More about what it does (maybe more than one line)
License: What license is it under?
Depends: R
Imports: randomForest

LazyData: TRUE 

------------------------------------------------------------------------------------

But it shows me a error ...



Updating myPack documentation
Loading myPack
Error in (function (dep_name, dep_ver = NA, dep_compare = NA)  : 
  Dependency package randomForest not available.
Calls: suppressPackageStartupMessages ... <Anonymous> -> load_all -> load_imports -> mapply -> <Anonymous>
Execution halted


Exited with status 1.


------------------------------------------------------------------------------------

Any help regarding this problem will appreciated . 
Thank you . 


Tanvir Ahamed 
G?teborg, Sweden  |


From jenny at stat.ubc.ca  Mon Sep 21 00:17:45 2015
From: jenny at stat.ubc.ca (Jennifer Bryan)
Date: Sun, 20 Sep 2015 15:17:45 -0700
Subject: [R-pkg-devel] Help with Package creation
In-Reply-To: <mailman.4169.1442759864.3797.r-package-devel@r-project.org>
References: <1889360163.58293.1442630664341.JavaMail.yahoo@mail.yahoo.com>
	<mailman.4169.1442759864.3797.r-package-devel@r-project.org>
Message-ID: <F781F0C3-94EC-4EBA-9EBD-A5F34678FE58@stat.ubc.ca>

Hi Mohammad,

You don?t really say but I?m guessing your error is when checking the package?

I think you should take the message at face value. It appears the randomForest package is not
available from the libraries R knows about at the time of whatever it is your doing. R CMD check
will not go out and install a dependency for you. install.packages() will do this, so maybe that
is what you?re thinking of.

? Jenny

> On Sep 20, 2015, at 7:37 AM, Mohammad Tanvir Ahamed via R-package-devel <r-package-devel at r-project.org> wrote:
> 
> 
> From: Mohammad Tanvir Ahamed <mashranga at yahoo.com>
> Subject: Help with Package creation
> Date: September 19, 2015 at 12:42:39 PM PDT
> To: "r-package-devel at r-project.org" <r-package-devel at r-project.org>
> Reply-To: Mohammad Tanvir Ahamed <mashranga at yahoo.com>
> 
> 
> Hello ,
> 
> I am new in R package built. 
> 
> I want to install one package (randomForest) that will install automatically while my package(myPack) will install. 
> I am using R studio to built. 
> 
> My Description file is : 
> 
> Package: myPack
> Type: Package
> Title: What the Package Does (Title Case)
> Version: 0.1
> Date: 2015-09-19
> Author: Who wrote it
> Maintainer: Who to complain to <yourfault at somewhere.net>
> Description: More about what it does (maybe more than one line)
> License: What license is it under?
> Depends: R
> Imports: randomForest
> 
> LazyData: TRUE 
> 
> ------------------------------------------------------------------------------------
> 
> But it shows me a error ...
> 
> 
> 
> Updating myPack documentation
> Loading myPack
> Error in (function (dep_name, dep_ver = NA, dep_compare = NA)  : 
>  Dependency package randomForest not available.
> Calls: suppressPackageStartupMessages ... <Anonymous> -> load_all -> load_imports -> mapply -> <Anonymous>
> Execution halted
> 
> 
> Exited with status 1.
> 
> 
> ------------------------------------------------------------------------------------
> 
> Any help regarding this problem will appreciated . 
> Thank you . 
> 
> 
> Tanvir Ahamed 
> G?teborg, Sweden  |
> 
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From h.wickham at gmail.com  Sun Sep 20 19:22:54 2015
From: h.wickham at gmail.com (Hadley Wickham)
Date: Sun, 20 Sep 2015 13:22:54 -0400
Subject: [R-pkg-devel] problem with locale-dependent order()
In-Reply-To: <1594107507.7395252.1442607921071.JavaMail.zimbra@meteo.be>
References: <1594107507.7395252.1442607921071.JavaMail.zimbra@meteo.be>
Message-ID: <CABdHhvGFWKnqUp_7eZiR83UQhW217WA4Zj0OaqbDF--zddsV4w@mail.gmail.com>

Hi Alex,

As far as I know, that's the best solution. In roxygen, I've wrapped
it up with a couple of helpers:

set_collate <- function(locale) {
  cur <- Sys.getlocale(category = "LC_COLLATE")
  Sys.setlocale(category = "LC_COLLATE", locale = locale)
  cur
}

with_collate <- function(locale, code) {
  old <- set_collate(locale)
  on.exit(set_collate(old))

  force(code)
}

sort_c <- function(x) with_collate("C", sort(x))

Hadley

On Fri, Sep 18, 2015 at 4:25 PM, Alex Deckmyn <alex.deckmyn at meteo.be> wrote:
> Hi,
>
> For an update of the maps package, I have run into a bug caused by the locale-depent behaviour of order().
> In a certain function, the polygon names of the world map are lexically sorted with order() prior to being sent to a C routine. That routine expects them to be sorted according to ASCII rules, but that is not the result I get. The main culprit is the colon used to identify sub-regions. For instance, in my locale (en_GB_UTF-8), I get
>
> "uk:northen ireland" < "ukrain" < "uk:scotland"
>
> which is not the order expected by C. I guess some language settings would also cause other unexpected results.
>
> Apart from the pain of fixing uk/ukrain ambiguities, is there a safe way to fix this order() in a package? An obvious solution seems to be
>
> lcc <- Sys.getlocale("LC_COLLATE")
> Sys.setlocale("LC_COLLATE","C")
> ord.nam <- order(nam)
> Sys.setlocale("LC_COLLATE",lcc)
>
> This seems to work fine on my linux PC, but I am not sure about other platforms (Windows, OS-X...), though the "C" locale should be standard. Is this safe? Or is there a better way to get the right ordering?
>
> Alex
>
> ---
> Dr. Alex Deckmyn e-mail: alex.deckmyn at meteo.be
> Royal Meteorological Institute http://www.meteo.be
> Ringlaan 3, 1180 Ukkel, Belgium tel. (32)(2)3730646
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://had.co.nz/


From DAVID.SHAUB at dish.com  Wed Sep 23 19:37:47 2015
From: DAVID.SHAUB at dish.com (Shaub, David)
Date: Wed, 23 Sep 2015 11:37:47 -0600
Subject: [R-pkg-devel] Unit test functions as standalone block of code but
 not in test_that()
Message-ID: <EEAAA68994E0C7448D25DE01CF98AB0003413A65EE@MER2-EXCH07A7.echostar.com>

I'm creating unit tests on the forecast package, specifically for the forecast.ar() function. I have a block of code that works just fine when run on its own.

require(testthat)
require(forecast)
set.seed(55)
simseries <- stats::arima.sim(model = list(ar = c(-0.42, 0.832, 0.1, -0.34)), n = 400)
arfit <- stats::ar(simseries)
fc1 <- forecast(arfit)$mean
fc2 <- forecast(arfit, bootstrap = TRUE, npaths = 100, fan = TRUE)$mean
expect_true(all(fc1 == fc2))

However, when I embed this in a test_that() function (after starting a new clean R session), I get an error that the ts is empty. I've determined that the error occurs on the two lines generating fc1 and fc2; simseries is assigned correctly.

require(testthat)
require(forecast)
test_that("tests for forecast.ar", {
set.seed(55)
simseries <- stats::arima.sim(model = list(ar = c(-0.42, 0.832, 0.1, -0.34)), n = 400)
arfit <- stats::ar(simseries)
fc1 <- forecast(arfit)$mean
fc2 <- forecast(arfit, bootstrap = TRUE, npaths = 100, fan = TRUE)$mean
expect_true(all(fc1 == fc2))
})

Why is this happening? I thought it might be a namespace issue with using the ar and arima.sim functions from the stats package, so I included the stats namespace in the function call, but that does not fix the problem.

R 3.1.1 forecast 6.1 testthat 0.10.0

David Shaub
Business Operations Analyst II
In-Home Services |Dish Network L.L.C
IHS Command Center | Forecasting Team
David.Shaub at dish.com<mailto:gavin.redelman at dish.com>



	[[alternative HTML version deleted]]


From jack at jackwasey.com  Sat Sep 26 16:27:32 2015
From: jack at jackwasey.com (Jack Wasey)
Date: Sat, 26 Sep 2015 10:27:32 -0400
Subject: [R-pkg-devel] Using the correct R binary in configure script
Message-ID: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>

Hello,

Having just read section 1.2 in Writing R extensions, a fragment of a
configure script is offered in order to determine the correct compiler
options. It starts by setting R_HOME with:

: ${R_HOME=`R RHOME`}


`R` is called, even if, as in my case, `Rdevel` is the command used to
invoke package compilation. This can be overridden by setting R_HOME
in the call to `Rdevel`, but this seems to be undesirable, since the
whole point of a configure script is that it sets up the package given
the constraints of the compiling environment.

My particular problem is that I have docker images with plain R in
/usr/bin/R, and R-devel with sanitizers in /usr/local/bin/Rdevel.
These have different compiler flags, and if I `Rdevel CMD INSTALL
mypackage` then it configures itself for the plain `R` environment.

Things are unfolding at:
https://github.com/jackwasey/rocker-ubsan
and
https://github.com/jackwasey/icd9/tree/issue75/tools

Am I doing something wrong?

Thanks for your advice,

Jack


From edd at debian.org  Sat Sep 26 17:43:51 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 26 Sep 2015 10:43:51 -0500
Subject: [R-pkg-devel] Using the correct R binary in configure script
In-Reply-To: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
References: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
Message-ID: <22022.48439.245838.660163@max.nulle.part>


On 26 September 2015 at 10:27, Jack Wasey wrote:
| Having just read section 1.2 in Writing R extensions, a fragment of a
| configure script is offered in order to determine the correct compiler
| options. It starts by setting R_HOME with:
| 
| : ${R_HOME=`R RHOME`}
| 
| 
| `R` is called, even if, as in my case, `Rdevel` is the command used to
| invoke package compilation. This can be overridden by setting R_HOME
| in the call to `Rdevel`, but this seems to be undesirable, since the
| whole point of a configure script is that it sets up the package given
| the constraints of the compiling environment.

[...] 
| 
| Am I doing something wrong?

R_HOME is set to the result of the command R RHOME if and only it is unset.

And it usually is unset.  This scheme generally works, I use it in a few
packages on CRAN which had it for years -- and it was initially suggested to
my by Kurt to make precisely _this_ work:  you set a different $PATH, or call
a different R engine.  And the right thing happens:

  edd at max:~$ R RHOME            # default installation
  /usr/lib/R
  edd at max:~$ RD RHOME           # alternate R-devel with a short-hand wrapper
  /usr/local/lib/R-devel/lib/R
  edd at max:~$ which RD
  /home/edd/bin/RD
  edd at max:~$ 

The (nice) idea of calling R-devel just 'RD' appears due to Winston.  It
works the same way if I just call R-devel-sh as I had for years:

  edd at max:~$ R-devel.sh RHOME
  /usr/local/lib/R-devel/lib/R
  edd at max:~$ 

So if you still think it fails for you, compare to e.g. the packages

  nloptr
  RProtoBuf
  RQuantLib
  RVowpalWabbit

all of which use this scheme.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jack at jackwasey.com  Sat Sep 26 18:32:41 2015
From: jack at jackwasey.com (Jack Wasey)
Date: Sat, 26 Sep 2015 12:32:41 -0400
Subject: [R-pkg-devel] Using the correct R binary in configure script
In-Reply-To: <22022.48439.245838.660163@max.nulle.part>
References: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
	<22022.48439.245838.660163@max.nulle.part>
Message-ID: <CA+zP7HFAc0_JpgEBCdgSK9Bjuo+0PMgg8Hq77KXhHcgt6jCQYg@mail.gmail.com>

Dirk, thanks for detailed reply. I may not have explained myself well
enough. I think the problem is that the recommended configure command
assumes 'R', not the actually running RD, Rdevel etc, when inferring
R_HOME. I can indeed set R_HOME, but I want my configure script to be able
to figure out which R is running, and thus which R_HOME to use when it is
not set.

Your RQuantLib seems to use the same bare 'R RHOME', yet if a package is R
CMD installed with RD, the configure script will in fact not run RD, but R,
to find R_HOME. I think it is usually not apparent because the compile
flags derived from R_HOME/bin/R CMD config are usually the same or similar,
but when, in my case, I have R compiled with OpenMP, and RD with
sanitizers, but without OpenMP, this fails because of the discrepancy.

Again, I feel like I'm missing something obvious, but I hope my explanation
of what I think is happening may help you guide me.

Best wishes,

Jack

On Saturday, September 26, 2015, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 26 September 2015 at 10:27, Jack Wasey wrote:
> | Having just read section 1.2 in Writing R extensions, a fragment of a
> | configure script is offered in order to determine the correct compiler
> | options. It starts by setting R_HOME with:
> |
> | : ${R_HOME=`R RHOME`}
> |
> |
> | `R` is called, even if, as in my case, `Rdevel` is the command used to
> | invoke package compilation. This can be overridden by setting R_HOME
> | in the call to `Rdevel`, but this seems to be undesirable, since the
> | whole point of a configure script is that it sets up the package given
> | the constraints of the compiling environment.
>
> [...]
> |
> | Am I doing something wrong?
>
> R_HOME is set to the result of the command R RHOME if and only it is unset.
>
> And it usually is unset.  This scheme generally works, I use it in a few
> packages on CRAN which had it for years -- and it was initially suggested
> to
> my by Kurt to make precisely _this_ work:  you set a different $PATH, or
> call
> a different R engine.  And the right thing happens:
>
>   edd at max:~$ R RHOME            # default installation
>   /usr/lib/R
>   edd at max:~$ RD RHOME           # alternate R-devel with a short-hand
> wrapper
>   /usr/local/lib/R-devel/lib/R
>   edd at max:~$ which RD
>   /home/edd/bin/RD
>   edd at max:~$
>
> The (nice) idea of calling R-devel just 'RD' appears due to Winston.  It
> works the same way if I just call R-devel-sh as I had for years:
>
>   edd at max:~$ R-devel.sh RHOME
>   /usr/local/lib/R-devel/lib/R
>   edd at max:~$
>
> So if you still think it fails for you, compare to e.g. the packages
>
>   nloptr
>   RProtoBuf
>   RQuantLib
>   RVowpalWabbit
>
> all of which use this scheme.
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> <javascript:;>
>

	[[alternative HTML version deleted]]


From edd at debian.org  Sat Sep 26 19:23:34 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 26 Sep 2015 12:23:34 -0500
Subject: [R-pkg-devel] Using the correct R binary in configure script
In-Reply-To: <CA+zP7HFAc0_JpgEBCdgSK9Bjuo+0PMgg8Hq77KXhHcgt6jCQYg@mail.gmail.com>
References: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
	<22022.48439.245838.660163@max.nulle.part>
	<CA+zP7HFAc0_JpgEBCdgSK9Bjuo+0PMgg8Hq77KXhHcgt6jCQYg@mail.gmail.com>
Message-ID: <22022.54422.587881.263969@max.nulle.part>


On 26 September 2015 at 12:32, Jack Wasey wrote:
| Dirk, thanks for detailed reply. I may not have explained myself well enough. I
| think the problem is that the recommended configure command assumes 'R',?not

If and only if R_HOME is unset. But witness:

  edd at max:~$ R --slave -e 'Sys.getenv("R_HOME")'
  [1] "/usr/lib/R"
  edd at max:~$ RD --slave -e 'Sys.getenv("R_HOME")'
  [1] "/usr/local/lib/R-devel/lib/R"
  edd at max:~$

You don't have to take my work for it, but maybe you trust Writing R Extensions.
And with RHOME set to this, the rest of confiure.{ac,in} uses it.  From
nloptr where I helped Jelmer to generalize his setup:

   ## Set R_HOME, respecting an environment variable if set 
   : ${R_HOME=$(R RHOME)}
   if test -z "${R_HOME}"; then
       AC_MSG_ERROR([Could not determine R_HOME.])   
   fi

   ## Get R compilers and flags
   NLOPT_CC=$("${R_HOME}/bin/R" CMD config CC)
   NLOPT_CFLAGS=$("${R_HOME}/bin/R" CMD config CFLAGS)
   NLOPT_CPP=$("${R_HOME}/bin/R" CMD config CPP)
   NLOPT_CPPFLAGS=$("${R_HOME}/bin/R" CMD config CPPFLAGS)
   NLOPT_CXX=$("${R_HOME}/bin/R" CMD config CXX)
   NLOPT_CXXFLAGS=$("${R_HOME}/bin/R" CMD config CXXFLAGS)
   NLOPT_CXXCPP=$("${R_HOME}/bin/R" CMD config CXXCPP)

See the source:

   https://github.com/jyypma/nloptr/blob/master/configure.ac#L106-L119

| the actually running RD, Rdevel etc, when inferring R_HOME. I can indeed set
| R_HOME, but I want my configure script to be able to figure out which R is
| running, and thus which R_HOME to use when it is not set.
| 
| Your RQuantLib seems to use the same bare 'R RHOME', yet if a package is R
| CMD?installed with RD, the configure script will in fact not run RD, but R, to
| find R_HOME. I think it?is usually not apparent because the compile flags
| derived from R_HOME/bin/R?CMD config are usually the same or similar, but when,
| in my case, I have R compiled with OpenMP, and RD with sanitizers, but without
| OpenMP, this fails because of the discrepancy.
| 
| Again, I feel like I'm missing something obvious, but I hope my explanation of
| what I think is happening may help you guide me.

No I think it beats me, so I'll retire from this thread.  Maybe you can
'diassemble' a few of the existing configure.{ac,in} on CRAN.  There are
hundreds to choose from.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From henrik.bengtsson at ucsf.edu  Sat Sep 26 19:45:49 2015
From: henrik.bengtsson at ucsf.edu (Henrik Bengtsson)
Date: Sat, 26 Sep 2015 10:45:49 -0700
Subject: [R-pkg-devel] Using the correct R binary in configure script
In-Reply-To: <CA+zP7HFAc0_JpgEBCdgSK9Bjuo+0PMgg8Hq77KXhHcgt6jCQYg@mail.gmail.com>
References: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
	<22022.48439.245838.660163@max.nulle.part>
	<CA+zP7HFAc0_JpgEBCdgSK9Bjuo+0PMgg8Hq77KXhHcgt6jCQYg@mail.gmail.com>
Message-ID: <CAFDcVCQ0RyMvdcsROBi-5jL+nDRQO89Ms4ygBRBzE9XCFt_UwA@mail.gmail.com>

Not sure I understand what you're doing and in what context, but if
you're trying to query R for where it lives, the following may help.
Note that executables or where they live do *not* follow solely from
R.home() - there's more to it.

## Windows
$ Rscript -e "R.home()"
[1] "C:/PROGRA~1/R/R-devel"

$ Rscript -e "R.home('bin')"
[1] "C:/PROGRA~1/R/R-devel/bin/x64"

$ Rscript -e "commandArgs()[1L]"
[1] "C:\\PROGRA~1\\R\\R-devel\\bin\\x64\\Rterm.exe"

(there is typically another 32-bit binary under ..bin\i386\ on Windows)


# Linux
$ Rscript -e "R.home()"
[1] "/path-to-software/R/R-3.2.2-20150814/lib64/R"

$ Rscript -e "R.home('bin')"
[1] "/path-to-software/R/R-3.2.2-20150814/lib64/R/bin"

$ Rscript -e "commandArgs()[1L]"
[1] "/path-to/software/R/R-3.2.2-20150814/lib64/R/bin/exec/R"

# Linux R 2.11.1
cclc01{henrik}: /path-to/software/R-2.11.1/bin/Rscript -e "R.home()"
[1] "/path-to/software/R/R-2.11.1-20150918/lib64/R"


# OS X
$ Rscript -e "R.home()"
[1] "/Library/Frameworks/R.framework/Resources"
$ Rscript -e "R.home('bin')"
[1] "/Library/Frameworks/R.framework/Resources/bin"
$ Rscript -e "commandArgs()[1L]"
[1] "/Library/Frameworks/R.framework/Resources/bin/exec/R"

My $.02

Henrik

On Sat, Sep 26, 2015 at 9:32 AM, Jack Wasey <jack at jackwasey.com> wrote:
> Dirk, thanks for detailed reply. I may not have explained myself well
> enough. I think the problem is that the recommended configure command
> assumes 'R', not the actually running RD, Rdevel etc, when inferring
> R_HOME. I can indeed set R_HOME, but I want my configure script to be able
> to figure out which R is running, and thus which R_HOME to use when it is
> not set.
>
> Your RQuantLib seems to use the same bare 'R RHOME', yet if a package is R
> CMD installed with RD, the configure script will in fact not run RD, but R,
> to find R_HOME. I think it is usually not apparent because the compile
> flags derived from R_HOME/bin/R CMD config are usually the same or similar,
> but when, in my case, I have R compiled with OpenMP, and RD with
> sanitizers, but without OpenMP, this fails because of the discrepancy.
>
> Again, I feel like I'm missing something obvious, but I hope my explanation
> of what I think is happening may help you guide me.
>
> Best wishes,
>
> Jack
>
> On Saturday, September 26, 2015, Dirk Eddelbuettel <edd at debian.org> wrote:
>
>>
>> On 26 September 2015 at 10:27, Jack Wasey wrote:
>> | Having just read section 1.2 in Writing R extensions, a fragment of a
>> | configure script is offered in order to determine the correct compiler
>> | options. It starts by setting R_HOME with:
>> |
>> | : ${R_HOME=`R RHOME`}
>> |
>> |
>> | `R` is called, even if, as in my case, `Rdevel` is the command used to
>> | invoke package compilation. This can be overridden by setting R_HOME
>> | in the call to `Rdevel`, but this seems to be undesirable, since the
>> | whole point of a configure script is that it sets up the package given
>> | the constraints of the compiling environment.
>>
>> [...]
>> |
>> | Am I doing something wrong?
>>
>> R_HOME is set to the result of the command R RHOME if and only it is unset.
>>
>> And it usually is unset.  This scheme generally works, I use it in a few
>> packages on CRAN which had it for years -- and it was initially suggested
>> to
>> my by Kurt to make precisely _this_ work:  you set a different $PATH, or
>> call
>> a different R engine.  And the right thing happens:
>>
>>   edd at max:~$ R RHOME            # default installation
>>   /usr/lib/R
>>   edd at max:~$ RD RHOME           # alternate R-devel with a short-hand
>> wrapper
>>   /usr/local/lib/R-devel/lib/R
>>   edd at max:~$ which RD
>>   /home/edd/bin/RD
>>   edd at max:~$
>>
>> The (nice) idea of calling R-devel just 'RD' appears due to Winston.  It
>> works the same way if I just call R-devel-sh as I had for years:
>>
>>   edd at max:~$ R-devel.sh RHOME
>>   /usr/local/lib/R-devel/lib/R
>>   edd at max:~$
>>
>> So if you still think it fails for you, compare to e.g. the packages
>>
>>   nloptr
>>   RProtoBuf
>>   RQuantLib
>>   RVowpalWabbit
>>
>> all of which use this scheme.
>>
>> Dirk
>>
>> --
>> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> <javascript:;>
>>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From pdalgd at gmail.com  Sat Sep 26 22:29:57 2015
From: pdalgd at gmail.com (peter dalgaard)
Date: Sat, 26 Sep 2015 22:29:57 +0200
Subject: [R-pkg-devel] Using the correct R binary in configure script
In-Reply-To: <22022.48439.245838.660163@max.nulle.part>
References: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
	<22022.48439.245838.660163@max.nulle.part>
Message-ID: <39F86C27-3E55-4ADC-8256-B6E1FD1574DA@gmail.com>


> On 26 Sep 2015, at 17:43 , Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> R_HOME is set to the result of the command R RHOME if and only it is unset.
> 
> And it usually is unset. 

Did you actually mean that, Dirk? I would expect that R_HOME would be set by "myR CMD whatever" before it got to the configure script, so that the default R would only be used as a last resort. And R rather actively defends itself against R_HOME being set in its environment.

E.g.

$ R_HOME=/tmp R CMD env | grep R_HOME
WARNING: ignoring environment value of R_HOME
R_HOME=/Library/Frameworks/R.framework/Resources

(I'm not sure that it is actually supposed to work, but apparently R CMD foo executes 'foo' in the same environment as R CMD check et al.)

-pd

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From edd at debian.org  Sat Sep 26 22:54:26 2015
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 26 Sep 2015 15:54:26 -0500
Subject: [R-pkg-devel] Using the correct R binary in configure script
In-Reply-To: <39F86C27-3E55-4ADC-8256-B6E1FD1574DA@gmail.com>
References: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
	<22022.48439.245838.660163@max.nulle.part>
	<39F86C27-3E55-4ADC-8256-B6E1FD1574DA@gmail.com>
Message-ID: <22023.1538.22408.314705@max.nulle.part>


On 26 September 2015 at 22:29, peter dalgaard wrote:
| 
| > On 26 Sep 2015, at 17:43 , Dirk Eddelbuettel <edd at debian.org> wrote:
| > 
| > R_HOME is set to the result of the command R RHOME if and only it is unset.
| > 
| > And it usually is unset. 
| 
| Did you actually mean that, Dirk?

Yes. But I didn't make myself very clear, as you noted.

What I meant to say, but did not, sadly, was that via PATH and called the
corresponding R front-end script from the particular (via PATH or explicit
absolute dir/path/to/R we get R_HOME set by the particular R invoked.

Which then calls configure for us, and that is how configure sees it as set
without the need for explicit settings.

| I would expect that R_HOME would be set by "myR CMD whatever" before it got
| to the configure script, so that the default R would only be used as a last
| resort. And R rather actively defends itself against R_HOME being set in
| its environment. 

Quite right.

| E.g.
| 
| $ R_HOME=/tmp R CMD env | grep R_HOME
| WARNING: ignoring environment value of R_HOME
| R_HOME=/Library/Frameworks/R.framework/Resources
| 
| (I'm not sure that it is actually supposed to work, but apparently R CMD foo executes 'foo' in the same environment as R CMD check et al.)

Some backends take advantage of that. Rserve comes to mind IIRC.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jack at jackwasey.com  Sun Sep 27 13:11:40 2015
From: jack at jackwasey.com (Jack Wasey)
Date: Sun, 27 Sep 2015 07:11:40 -0400
Subject: [R-pkg-devel] Using the correct R binary in configure script
In-Reply-To: <22023.1538.22408.314705@max.nulle.part>
References: <CA+zP7HF2A3RNsM_AXejXKSn0-OLb7+16k9iFmzBy9BYn4CisRg@mail.gmail.com>
	<22022.48439.245838.660163@max.nulle.part>
	<39F86C27-3E55-4ADC-8256-B6E1FD1574DA@gmail.com>
	<22023.1538.22408.314705@max.nulle.part>
Message-ID: <CA+zP7HEgwHWNPxfxvR7b1YCN0gfHHY12DaoDUE=oU9ERB6iFaw@mail.gmail.com>

Thanks for all your input. I am now aware that the R environment
running configure will have set R_HOME. I had sometimes been running
./configure without R_HOME set, leading to my problem (since in this
case, the configure snippet does assume 'R'). I'll stick to the
official build routine from now on.

It may be helpful to other package developers that I threw a tiny
package up on github to demonstrate this behavior: this could be
useful as a simple test base for people working on configure scripts
in R packages.

https://github.com/jackwasey/configrdev
The script therein tests the package in DIrk's
rocker/r-devel-san-clang which has both R and RD.

Jack

On Sat, Sep 26, 2015 at 4:54 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> On 26 September 2015 at 22:29, peter dalgaard wrote:
> |
> | > On 26 Sep 2015, at 17:43 , Dirk Eddelbuettel <edd at debian.org> wrote:
> | >
> | > R_HOME is set to the result of the command R RHOME if and only it is unset.
> | >
> | > And it usually is unset.
> |
> | Did you actually mean that, Dirk?
>
> Yes. But I didn't make myself very clear, as you noted.
>
> What I meant to say, but did not, sadly, was that via PATH and called the
> corresponding R front-end script from the particular (via PATH or explicit
> absolute dir/path/to/R we get R_HOME set by the particular R invoked.
>
> Which then calls configure for us, and that is how configure sees it as set
> without the need for explicit settings.
>
> | I would expect that R_HOME would be set by "myR CMD whatever" before it got
> | to the configure script, so that the default R would only be used as a last
> | resort. And R rather actively defends itself against R_HOME being set in
> | its environment.
>
> Quite right.
>
> | E.g.
> |
> | $ R_HOME=/tmp R CMD env | grep R_HOME
> | WARNING: ignoring environment value of R_HOME
> | R_HOME=/Library/Frameworks/R.framework/Resources
> |
> | (I'm not sure that it is actually supposed to work, but apparently R CMD foo executes 'foo' in the same environment as R CMD check et al.)
>
> Some backends take advantage of that. Rserve comes to mind IIRC.
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From wolfgang.viechtbauer at maastrichtuniversity.nl  Tue Sep 29 17:47:34 2015
From: wolfgang.viechtbauer at maastrichtuniversity.nl (Viechtbauer Wolfgang (STAT))
Date: Tue, 29 Sep 2015 17:47:34 +0200
Subject: [R-pkg-devel] CRAN Version r-release-osx-x86_64-mavericks
Message-ID: <077E31A57DA26E46AB0D493C9966AC730F1E1333B3@UM-MAIL4112.unimaas.nl>

Dear All,

I just submitted a new version (1.9-8) of the metafor package to CRAN. The checks show an error for r-release-osx-x86_64-mavericks:

https://cran.r-project.org/web/checks/check_results_metafor.html

Digging down shows:

ERROR: this R is version 3.2.0, package 'metafor' requires R >= 3.2.2

But isn't 3.2.2 available for Mac OS X 10.9 (Mavericks)? https://cran.r-project.org/bin/macosx/ seems to suggest it is.

Is there any reason why this isn't being used here?

Best,
Wolfgang

-- 
Wolfgang Viechtbauer, Ph.D., Statistician | Department of Psychiatry and    
Neuropsychology | Maastricht University | P.O. Box 616 (VIJV1) | 6200 MD    
Maastricht, The Netherlands | +31 (43) 388-4170 | http://www.wvbauer.com    


