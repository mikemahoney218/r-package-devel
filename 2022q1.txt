From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Jan  1 20:11:56 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 1 Jan 2022 14:11:56 -0500
Subject: [R-pkg-devel] doi confusion and Data codoc mismatches
In-Reply-To: <12a47080-a803-45e5-9feb-b501e658ddb0@gmail.com>
References: <9e255e07-f32d-c3ad-a677-f2c6190f44db@effectivedefense.org>
 <32fe7d16-cf04-cb2d-6513-047b61d5c5b7@gmail.com>
 <12a47080-a803-45e5-9feb-b501e658ddb0@gmail.com>
Message-ID: <ff6d01c2-63b4-d827-468d-f891d5db09a5@gmail.com>

On 26/12/2021 8:03 a.m., Duncan Murdoch wrote:
> I've now submitted a bug report for R:
> https://bugs.r-project.org/show_bug.cgi?id=18266 along with a suggested
> patch to remove the first of these.

And this patch was committed to the trunk by Kurt Hornik, so it should 
appear in R 4.2.0 or maybe some 4.1.x release.  Thanks Kurt!

Duncan Murdoch

> 
> Duncan Murdoch
> 
> 
> On 26/12/2021 5:55 a.m., Duncan Murdoch wrote:
>> On 26/12/2021 12:07 a.m., Spencer Graves wrote:
>>> Hello, All:
>>>
>>>
>>> 	  The latest checks on
>>> "https://github.com/sbgraves237/Ecdat/runs/4634725654?check_suite_focus=true"
>>> identify two problems I don't know how to fix:
>>>
>>>
>>> FIRST:  Data codoc mismatches from documentation object 'USnewspapers':
>>>       Variables in data frame 'USnewspapers'
>>>         Code: AdsProportion Ads_G2012dollars Ads_currentGdollars
>>>               Circ_G2012dollars Circ_currentGdollars GDP_G2012 GDP_nominalG
>>>               Population_M RevenuePerCap_2012 RevenuePerCap_nominal
>>>               Revenue_G2012dollars Revenue_currentGdollars Year
>>>               newspapers_p_GDP
>>>         Docs: Ads_G2012dollars Circ_G2012dollars Circ_currentGdollars
>>>               Revenue_G2012dollars Revenue_currentGdollars AdsProportion
>>>               Ads_currentGdollars GDP_G2012 GDP_nominalG Population_M
>>>               RevenuePerCap_2012 RevenuePerCap_nominal Year newspapers_p_GDP
>>>
>>>
>>> 	  I believe that the column names in the data.frame 'USnewspapers'
>>> match the names in the order given in the *.Rd file and the variable
>>> list following "Code" here matches that following "Docs" using, e.g.,
>>> sort(scan(what=character())).
>>
>> You can debug this by running tools::codocData("Ecdat") after the
>> package is installed.  It appears that some of the names in the docs are
>> picking up newlines, specifically the ones documented like this:
>>
>> \item{Ads_currentGdollars,
>>              Ads_G2012dollars,
>>              Circ_currentGdollars,
>>              Circ_G2012dollars,
>>              Revenue_currentGdollars,
>>              Revenue_G2012dollars}
>>
>> I think that's a bug in codocData.  A workaround is to put those all on
>> one line.  You don't get a "line too long" warning, because they'll be
>> reformatted in the display.
>>
>>>
>>>
>>> SECOND:  Found the following URLs which should use \doi (with the DOI
>>> name only):
>>>         File 'AccountantsAuditorsPct.Rd':
>>>           https://doi.org/10.18128/D010.V8.0
>>>         File 'OCC1950.Rd':
>>>           https://doi.org/10.18128/D010.V10.0
>>>
>>>
>>> 	  My concern here is that these two urls are in, e.g.,
>>> \href{https://doi.org/10.18128/D010.V8.0}{text to display to click to
>>> link to the doi url}.  If it were, e.g.,
>>> \url{https://doi.org/10.18128/D010.V8.0} I would try replacing it with
>>> \doi{10.18128/D010.V8.0}.  However, if I do that, I don't know what to
>>> do with the "text to display to click to link to the doi url".
>>
>> The first of those links to a page with this version of the reference:
>>
>> Steven Ruggles, Sarah Flood, Ronald Goeken, Josiah Grover, Erin Meyer,
>> Jose Pacas, and Matthew Sobek. Integrated Public Use Microdata Series:
>> Version 8.0 [dataset]. Minneapolis: University of Minnesota, 2018.
>> http://doi.org/10.18128/D010.V8.0
>>
>>
>> You'd get a format pretty close to that if you don't try to make the
>> title into a link, just enter it as
>>
>>      Steven Ruggles, Sarah Flood, Ronald Goeken,
>>        Josiah Grover, Erin Meyer, Jose Pacas, and
>>        Matthew Sobek (2018)
>> IPUMS
>>        USA: Version 8.0 [dataset]. Minneapolis, MN:
>>        IPUMS. \doi{10.18128/D010.V8.0}
>>
>> Duncan Murdoch
>


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Mon Jan  3 10:43:45 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Mon, 3 Jan 2022 10:43:45 +0100
Subject: [R-pkg-devel] 
 Error in inDL(x, as.logical(local), as.logical(now),
 ...) unable to load shared object
In-Reply-To: <a891864b-ec31-d8ef-6b62-c1845048bdf2@landtucker.com>
References: <a6607f62-79d0-af0a-be36-8d052157ada4@landtucker.com>
 <34471861-2063-33b7-3605-6ecdff815ea6@gmail.com>
 <25028.35062.869522.630615@rob.eddelbuettel.com>
 <76bab54d-53a6-b181-d2ae-3a485c45c62d@landtucker.com>
 <114a796c-9951-01a5-b6f6-c6e69381ab9f@gmail.com>
 <a891864b-ec31-d8ef-6b62-c1845048bdf2@landtucker.com>
Message-ID: <b4830673-4c60-e160-48e5-a448dea0bf5a@gmail.com>


On 12/27/21 4:04 PM, Ezra Tucker wrote:
> Hi Tomas,
>
>
> Thanks again for all your great info. One last question- and maybe it's
> a stupid one. You mention the JAGS package-- I've been using xml2 as my
> kind-of template. Installing it on linux for example will fail unless
> you have the libxml2-dev package installed (at least for debian-based),
> whereas for windows it just goes and downloads the dll as part of the
> install process. Why would/should this package NOT just perform this
> action for linux as well (namely, automatically download the precompiled
> .so from somewhere else and package it in so you don't need root
> privileges to install the package)? Is this just a difference in install
> philosophy between linux and windows?

Hi Ezra,

Dirk responded in detail re Unix.

On Windows, static libraries (not dynamic) are used by R and are part of 
the toolchain (Rtools42 for R-devel and R 4.2), you just link the 
libraries from there via PKG_LIBS in your Makevars.ucrt or Makevars.win 
file. See for example rgdal for the recommended way how to do this, and 
[1] for a description.

Best
Tomas

[1] https://developer.r-project.org/WindowsBuilds/winutf8/ucrt3/howto.html

>
>
> Thanks again!
>
> -Ezra
>
> On 12/23/21 17:20, Tomas Kalibera wrote:
>> On 12/23/21 4:52 PM, Ezra Tucker wrote:
>>> Hi Tomas and Dirk,
>>>
>>>
>>> Thanks for your suggestions! Between the two, got it working. I didn't
>>> know Windows didn't do rpath, I think that you're right that setting the
>>> PATH would have helped. I haven't seen that in an R package before, so I
>>> did what was in the Rblpapi package, which was creating a couple of
>>> copies of the dll in question.
>> Well it is very exceptional that packages link to an external DLL, only
>> very few CRAN packages do (another example is packages linking to JAGS).
>> I know about these as some of them caused trouble with staged
>> installation and other with the switch to UCRT, they certainly make
>> maintaining and improving R harder. They typically won't work correctly
>> with encodings on Windows. The C++ interface is particularly tricky and
>> fragile. So, one thing is getting this to work in your package you need
>> another question is whether at all it should be published on CRAN, and
>> if that was your plan that'd be best discussed with the CRAN repository
>> maintainers. In some cases there is no other way thank linking to an
>> external DLL, but the question is always whether such package should be
>> on CRAN.
>>> On a related note, in Rblpapi Makevars.win line 47 it's downloading and
>>> extracting the compiled library from GitHub. My understanding is that
>>> one shouldn't include pre-compiled libraries in R packages for security
>>> reasons, at least not for submitting to CRAN. Is doing it this way a
>>> good way around that?
>> No, those concerns apply and are unrelated in principle to using an
>> external DLL. My understanding is that this was also an exception
>> discussed with the CRAN repository maintainers, but I don't know the
>> case specifically.
>>
>> Best
>> Tomas
>>
>>
>>> Thanks again!
>>>
>>> -Ezra
>>>
>>>
>>> On 12/23/21 09:34, Dirk Eddelbuettel wrote:
>>>> On 23 December 2021 at 11:07, Tomas Kalibera wrote:
>>>> | You can have a look at CRAN package Rblpapi which is using an external DLL.
>>>>
>>>> Yes with one big caveat: You have to make sure the library follows what is
>>>> the "hour-glass pattern": it needs to have an internal (the "narrow" part) C
>>>> library covering the wider underlying library and offered via a wider header.
>>>>
>>>> Only C linkage works across different compiler families. You just cannot use
>>>> a Virtual C++-made Windows DLL from R's MinGW g++ compiler with C++.
>>>>
>>>> But you can use C linkage.  So some libraries (such as the Bloomberg API used
>>>> in Rblpapi and the TileDB API used in the tiledb package (when not using a
>>>> local build) can use a library following the hourglass pattern:
>>>>
>>>>      - "wide" bottom layer (may be C++ or C) with the core implementation
>>>>
>>>>      - "narrow" C layer accessing the bottom and priving an API providing via C
>>>>        which profits from C's portable foreign function interface
>>>>
>>>>      - "wide" layer on top via a header-only C++ file accesssing the C and
>>>>        which the C++ compiler optimizes away so that the C API is used for linking
>>>>
>>>> Sounds complicated, but works great.
>>>>
>>>> Good detail is in a hour-long but not-too-technical talk here
>>>>
>>>>      https://www.youtube.com/watch?v=PVYdHDm0q6Y
>>>>
>>>> and slides etc are here
>>>>
>>>>      https://github.com/CppCon/CppCon2014/tree/master/Presentations/Hourglass%20Interfaces%20for%20C%2B%2B%20APIs
>>>>
>>>> Dirk
>>>>
>>>> --
>>>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jan  4 19:28:09 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 4 Jan 2022 12:28:09 -0600
Subject: [R-pkg-devel] doi confusion and Data codoc mismatches--AND THE
 VALUE OF GITHUB
In-Reply-To: <ff6d01c2-63b4-d827-468d-f891d5db09a5@gmail.com>
References: <9e255e07-f32d-c3ad-a677-f2c6190f44db@effectivedefense.org>
 <32fe7d16-cf04-cb2d-6513-047b61d5c5b7@gmail.com>
 <12a47080-a803-45e5-9feb-b501e658ddb0@gmail.com>
 <ff6d01c2-63b4-d827-468d-f891d5db09a5@gmail.com>
Message-ID: <e8acb9ff-52f9-6288-5515-0626ccfe44be@effectivedefense.org>

	  Thanks to Duncan and Kurt for looking into this, recommending a patch 
for my code, and implementing a change to codocData.


VALUE OF GITHUB:  This exchange illustrates the value of GitHub:


	  1.  It made it easier for Duncan to diagnose the problem and 
recommend fixes both to me and to Kurt.


	  2.  I missed this email when it arrived five days after my post but 
found it after noticing a pull request from Duncan on GitHub.  I 
implemented it, and it worked!  Then I checked for a reply to my earlier 
post, and found Duncan's comment below.


	  Spencer


On 1/1/22 1:11 PM, Duncan Murdoch wrote:
> On 26/12/2021 8:03 a.m., Duncan Murdoch wrote:
>> I've now submitted a bug report for R:
>> https://bugs.r-project.org/show_bug.cgi?id=18266 along with a suggested
>> patch to remove the first of these.
> 
> And this patch was committed to the trunk by Kurt Hornik, so it should 
> appear in R 4.2.0 or maybe some 4.1.x release.? Thanks Kurt!
> 
> Duncan Murdoch
> 
>>
>> Duncan Murdoch
>>
>>
>> On 26/12/2021 5:55 a.m., Duncan Murdoch wrote:
>>> On 26/12/2021 12:07 a.m., Spencer Graves wrote:
>>>> Hello, All:
>>>>
>>>>
>>>> ????? The latest checks on
>>>> "https://github.com/sbgraves237/Ecdat/runs/4634725654?check_suite_focus=true" 
>>>>
>>>> identify two problems I don't know how to fix:
>>>>
>>>>
>>>> FIRST:? Data codoc mismatches from documentation object 'USnewspapers':
>>>> ????? Variables in data frame 'USnewspapers'
>>>> ??????? Code: AdsProportion Ads_G2012dollars Ads_currentGdollars
>>>> ????????????? Circ_G2012dollars Circ_currentGdollars GDP_G2012 
>>>> GDP_nominalG
>>>> ????????????? Population_M RevenuePerCap_2012 RevenuePerCap_nominal
>>>> ????????????? Revenue_G2012dollars Revenue_currentGdollars Year
>>>> ????????????? newspapers_p_GDP
>>>> ??????? Docs: Ads_G2012dollars Circ_G2012dollars Circ_currentGdollars
>>>> ????????????? Revenue_G2012dollars Revenue_currentGdollars 
>>>> AdsProportion
>>>> ????????????? Ads_currentGdollars GDP_G2012 GDP_nominalG Population_M
>>>> ????????????? RevenuePerCap_2012 RevenuePerCap_nominal Year 
>>>> newspapers_p_GDP
>>>>
>>>>
>>>> ????? I believe that the column names in the data.frame 'USnewspapers'
>>>> match the names in the order given in the *.Rd file and the variable
>>>> list following "Code" here matches that following "Docs" using, e.g.,
>>>> sort(scan(what=character())).
>>>
>>> You can debug this by running tools::codocData("Ecdat") after the
>>> package is installed.? It appears that some of the names in the docs are
>>> picking up newlines, specifically the ones documented like this:
>>>
>>> \item{Ads_currentGdollars,
>>> ???????????? Ads_G2012dollars,
>>> ???????????? Circ_currentGdollars,
>>> ???????????? Circ_G2012dollars,
>>> ???????????? Revenue_currentGdollars,
>>> ???????????? Revenue_G2012dollars}
>>>
>>> I think that's a bug in codocData.? A workaround is to put those all on
>>> one line.? You don't get a "line too long" warning, because they'll be
>>> reformatted in the display.
>>>
>>>>
>>>>
>>>> SECOND:? Found the following URLs which should use \doi (with the DOI
>>>> name only):
>>>> ??????? File 'AccountantsAuditorsPct.Rd':
>>>> ????????? https://doi.org/10.18128/D010.V8.0
>>>> ??????? File 'OCC1950.Rd':
>>>> ????????? https://doi.org/10.18128/D010.V10.0
>>>>
>>>>
>>>> ????? My concern here is that these two urls are in, e.g.,
>>>> \href{https://doi.org/10.18128/D010.V8.0}{text to display to click to
>>>> link to the doi url}.? If it were, e.g.,
>>>> \url{https://doi.org/10.18128/D010.V8.0} I would try replacing it with
>>>> \doi{10.18128/D010.V8.0}.? However, if I do that, I don't know what to
>>>> do with the "text to display to click to link to the doi url".
>>>
>>> The first of those links to a page with this version of the reference:
>>>
>>> Steven Ruggles, Sarah Flood, Ronald Goeken, Josiah Grover, Erin Meyer,
>>> Jose Pacas, and Matthew Sobek. Integrated Public Use Microdata Series:
>>> Version 8.0 [dataset]. Minneapolis: University of Minnesota, 2018.
>>> http://doi.org/10.18128/D010.V8.0
>>>
>>>
>>> You'd get a format pretty close to that if you don't try to make the
>>> title into a link, just enter it as
>>>
>>> ???? Steven Ruggles, Sarah Flood, Ronald Goeken,
>>> ?????? Josiah Grover, Erin Meyer, Jose Pacas, and
>>> ?????? Matthew Sobek (2018)
>>> IPUMS
>>> ?????? USA: Version 8.0 [dataset]. Minneapolis, MN:
>>> ?????? IPUMS. \doi{10.18128/D010.V8.0}
>>>
>>> Duncan Murdoch
>>
>


From |gor|@|tu| @end|ng |rom gm@||@com  Wed Jan  5 21:15:20 2022
From: |gor|@|tu| @end|ng |rom gm@||@com (Igor L)
Date: Wed, 5 Jan 2022 17:15:20 -0300
Subject: [R-pkg-devel] Possible bug report/false positive
Message-ID: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>

To whom it may concern,
I'm using devtools::check() and trying to upload my package to CRAN (The
code is available in github
<https://github.com/igorlaltuf/dail/blob/main/R/requests.R>), but I'm not
able to understand why the function is showing 1 NOTE:


-- R CMD check results
------------------------------------------------------------------------------------
dail 0.0.0.9000 ----
Duration: 17.9s
> checking R code for possible problems ... NOTE
  Found an obsolete/platform-specific call in the following function:
    'requests'
  Found the platform-specific device:
    'X11'
  dev.new() is the preferred way to open a new device, in the unlikely
  event one is needed.
  requests: no visible binding for global variable 'protocolo'
  Undefined global functions or variables:
    protocolo
0 errors ? | 0 warnings ? | 1 note x


After uploading it to CRAN, I noticed that: (1) this only happens on
debian; and (2) as pointed out in this answer
<https://stackoverflow.com/questions/70585796/unable-to-understand-1-note-in-devtoolscheck-caused-by-a-platform-specific-d>,
the code might be understanding X11 as a function from package::grDevices
<https://github.com/wch/r-source/blob/b1434842427cc01b7e8301495fe0f75ef519ac01/src/library/tools/R/QC.R#L6384-L6391>
.
Does anyone know the reason for this and how to solve it?

Best regards,
*Igor Laltuf Marques*
https://igorlaltuf.github.io/

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Jan  6 15:37:01 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 6 Jan 2022 17:37:01 +0300
Subject: [R-pkg-devel] Possible bug report/false positive
In-Reply-To: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>
References: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>
Message-ID: <20220106173701.45dd00d6@Tarkus>

On Wed, 5 Jan 2022 17:15:20 -0300
Igor L <igorlaltuf at gmail.com> wrote:

>   Found the platform-specific device:
>    'X11'

> how to solve it?

One of the tricks that work (in the sense that calls to functions using
non-standard evaluation don't result in warnings about "Undefined
global functions or variables") is to declare the variables locally,
inside the function:

protocolo <- X1 <- X2 <- ... X21 <- NULL
var <- readr::read_csv2(...) ...

Alternatively, since you know that the file always has 21 columns,
you can pass the variable to `colnames<-` instead of dplyr::rename,
together with a vector of column names you already have in the
nomes.colunas vector. This way, you won't need to declare the 21 dummy
variable.

By the way, you shouldn't declare at least download.file and unzip
functions as global variables. Instead, import them from the utils
package in your NAMESPACE (or using the @importFrom Roxygen tag, if you
use Roxygen).

There are other ways the package code could be improved:

 - There doesn't seem to be a need for the dynamically-named variable
   you create using assign(paste0('pedidos', i), var) and remove soon
   after; you can just use `var` instead of get(paste0('pedidos', i)).
 - If you're worried about leaving temporary variables around, move
   the loop body into a separate function so that anything you don't
   return from it would be cleaned up automatically.
 - You can future-proof your package by creating the URLs with
   paste0('https://dadosabertos-download.cgu.gov.br/FalaBR/Arquivos_FalaBR_Filtrado/Arquivos_csv_',
   year, '.zip') instead of hard-coding their list. It seems likely to
   me that once the 2022 Right to Information Law report is available,
   it'll have a predictable URL. If not, then you'll update the
   package (as you were going to anyway).
 - If you need to iterate over indices in a vector, use for (idx in
   seq_along(vector)) instead of for (i in vector) and match() to
   find the index. Though in this case, the code can be modified to
   avoid the need for the index in the loop body.

-- 
Best regards,
Ivan


From |gor|@|tu| @end|ng |rom gm@||@com  Thu Jan  6 22:56:45 2022
From: |gor|@|tu| @end|ng |rom gm@||@com (Igor L)
Date: Thu, 6 Jan 2022 18:56:45 -0300
Subject: [R-pkg-devel] Possible bug report/false positive
In-Reply-To: <20220106173701.45dd00d6@Tarkus>
References: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>
 <20220106173701.45dd00d6@Tarkus>
Message-ID: <CAHGVjrnm2hj2bTPKru6rVcCbF_fL_M1wuK8X5zoD+o7jjQEo2Q@mail.gmail.com>

Ivan,
Declaring the variables inside the function solved the problem (protocolo
<- X1 <- X2 <- ... X21 <- NULL).
Thanks for the help and suggestions for improving the code.
Best Regards,
Igor

Em qui., 6 de jan. de 2022 ?s 11:37, Ivan Krylov <krylov.r00t at gmail.com>
escreveu:

> On Wed, 5 Jan 2022 17:15:20 -0300
> Igor L <igorlaltuf at gmail.com> wrote:
>
> >   Found the platform-specific device:
> >    'X11'
>
> > how to solve it?
>
> One of the tricks that work (in the sense that calls to functions using
> non-standard evaluation don't result in warnings about "Undefined
> global functions or variables") is to declare the variables locally,
> inside the function:
>
> protocolo <- X1 <- X2 <- ... X21 <- NULL
> var <- readr::read_csv2(...) ...
>
> Alternatively, since you know that the file always has 21 columns,
> you can pass the variable to `colnames<-` instead of dplyr::rename,
> together with a vector of column names you already have in the
> nomes.colunas vector. This way, you won't need to declare the 21 dummy
> variable.
>
> By the way, you shouldn't declare at least download.file and unzip
> functions as global variables. Instead, import them from the utils
> package in your NAMESPACE (or using the @importFrom Roxygen tag, if you
> use Roxygen).
>
> There are other ways the package code could be improved:
>
>  - There doesn't seem to be a need for the dynamically-named variable
>    you create using assign(paste0('pedidos', i), var) and remove soon
>    after; you can just use `var` instead of get(paste0('pedidos', i)).
>  - If you're worried about leaving temporary variables around, move
>    the loop body into a separate function so that anything you don't
>    return from it would be cleaned up automatically.
>  - You can future-proof your package by creating the URLs with
>    paste0('
> https://dadosabertos-download.cgu.gov.br/FalaBR/Arquivos_FalaBR_Filtrado/Arquivos_csv_
> ',
>    year, '.zip') instead of hard-coding their list. It seems likely to
>    me that once the 2022 Right to Information Law report is available,
>    it'll have a predictable URL. If not, then you'll update the
>    package (as you were going to anyway).
>  - If you need to iterate over indices in a vector, use for (idx in
>    seq_along(vector)) instead of for (i in vector) and match() to
>    find the index. Though in this case, the code can be modified to
>    avoid the need for the index in the loop body.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From r|cc@r| @end|ng |rom hotm@||@|t  Tue Jan 11 18:44:03 2022
From: r|cc@r| @end|ng |rom hotm@||@|t (riccardo)
Date: Tue, 11 Jan 2022 18:44:03 +0100
Subject: [R-pkg-devel] Fix JFM package problem
Message-ID: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>

Hallo,

I wish to submit the following error rising running an example in a rcpp 
function *only *in Debian check:

> ### Name: least_square_plane_rcpp
> ### Title: returns the coefficients of the least square plane and the
> ###   relative medium square error
> ### Aliases: least_square_plane_rcpp
> 
> ### ** Examples
> 
> list_xyz<-matrix(data = c(-10.0, -10.0, -15.0 ,10.0, -10.0,
+  -5.0, -10.0, 10.0, 5.0, 10.0, 10.0 ,15.0)
+ ,nrow = 4,ncol = 3, byrow = TRUE)
> least_square_plane_rcpp(list_xyz)

warning: eig_sym(): given matrix is not symmetric
Error in least_square_plane_rcpp(list_xyz) :
   Mat::operator(): index out of bounds
Execution halted

This error raised also in window OS, but was fixed changing input 
variable in Rcpp::NumericMatrix.

Complete check is at:
https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220111_170553/Debian/00check.log

Every suggestion is welcome.

Thank you in advance

Best Regards

Riccardo

	[[alternative HTML version deleted]]


From em@nue|e@cord@no @end|ng |rom gm@||@com  Fri Jan 14 10:47:22 2022
From: em@nue|e@cord@no @end|ng |rom gm@||@com (Emanuele Cordano)
Date: Fri, 14 Jan 2022 10:47:22 +0100
Subject: [R-pkg-devel] Mac OS X builds and checksf for CRAN
Message-ID: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>

Dear list,

Is this service currently working?

https://mac.r-project.org/macbuilder/submit.html

server returns 504 Gateway Time-out error.
I found out this after trying to using the service because I have to fix
some issues in one of my packages before CRAN submission.

Thank you
Best

Emanuele Cordano
-- 
Emanuele Cordano, PhD
Environmental Engineer / Ingegnere per l' Ambiente e il territorio nr.
3587 (Albo A - Provincia di Trento)
cell: +39 3282818564
email: emanuele.cordano at gmail.com,emanuele.cordano at rendena100.eu,
emanuele.cordano at eurac.edu
PEC: emanuele.cordano at ingpec.eu
URL: www.rendena100.eu
LinkedIn: https://www.linkedin.com/in/emanuele-cordano-31995333
GitHub: https://github.com/ecor

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Jan 14 11:39:08 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 14 Jan 2022 05:39:08 -0500
Subject: [R-pkg-devel] Mac OS X builds and checksf for CRAN
In-Reply-To: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>
References: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>
Message-ID: <934a3152-4f1e-a55e-b14c-e4af87648774@gmail.com>

On 14/01/2022 4:47 a.m., Emanuele Cordano wrote:
> Dear list,
> 
> Is this service currently working?
> 
> https://mac.r-project.org/macbuilder/submit.html
> 
> server returns 504 Gateway Time-out error.
> I found out this after trying to using the service because I have to fix
> some issues in one of my packages before CRAN submission.
> 

It is offline until at least Monday -- there's a message about this on 
the R-sig-mac list.

Duncan Murdoch


From em@nue|e@cord@no @end|ng |rom gm@||@com  Fri Jan 14 12:06:18 2022
From: em@nue|e@cord@no @end|ng |rom gm@||@com (Emanuele Cordano)
Date: Fri, 14 Jan 2022 12:06:18 +0100
Subject: [R-pkg-devel] Mac OS X builds and checksf for CRAN
In-Reply-To: <934a3152-4f1e-a55e-b14c-e4af87648774@gmail.com>
References: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>
 <934a3152-4f1e-a55e-b14c-e4af87648774@gmail.com>
Message-ID: <CAKw81f8mmBDekMK5yhdtSbsVQfs9X2nP9tKaNMPFizsBidt64g@mail.gmail.com>

Thank you
best
Emanuele Cordano

Il giorno ven 14 gen 2022 alle ore 11:39 Duncan Murdoch <
murdoch.duncan at gmail.com> ha scritto:

> On 14/01/2022 4:47 a.m., Emanuele Cordano wrote:
> > Dear list,
> >
> > Is this service currently working?
> >
> > https://mac.r-project.org/macbuilder/submit.html
> >
> > server returns 504 Gateway Time-out error.
> > I found out this after trying to using the service because I have to fix
> > some issues in one of my packages before CRAN submission.
> >
>
> It is offline until at least Monday -- there's a message about this on
> the R-sig-mac list.
>
> Duncan Murdoch
>


-- 
Emanuele Cordano, PhD
Environmental Engineer / Ingegnere per l' Ambiente e il territorio nr.
3587 (Albo A - Provincia di Trento)
cell: +39 3282818564
email: emanuele.cordano at gmail.com,emanuele.cordano at rendena100.eu,
emanuele.cordano at eurac.edu
PEC: emanuele.cordano at ingpec.eu
URL: www.rendena100.eu
LinkedIn: https://www.linkedin.com/in/emanuele-cordano-31995333
GitHub: https://github.com/ecor

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Fri Jan 14 14:22:47 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 14 Jan 2022 07:22:47 -0600
Subject: [R-pkg-devel] Fix JFM package problem
In-Reply-To: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
References: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
Message-ID: <25057.31015.865393.985033@rob.eddelbuettel.com>


On 11 January 2022 at 18:44, riccardo wrote:
| Hallo,
| 
| I wish to submit the following error rising running an example in a rcpp 
| function *only *in Debian check:
| 
| > ### Name: least_square_plane_rcpp
| > ### Title: returns the coefficients of the least square plane and the
| > ###   relative medium square error
| > ### Aliases: least_square_plane_rcpp
| > 
| > ### ** Examples
| > 
| > list_xyz<-matrix(data = c(-10.0, -10.0, -15.0 ,10.0, -10.0,
| +  -5.0, -10.0, 10.0, 5.0, 10.0, 10.0 ,15.0)
| + ,nrow = 4,ncol = 3, byrow = TRUE)
| > least_square_plane_rcpp(list_xyz)
| 
| warning: eig_sym(): given matrix is not symmetric
| Error in least_square_plane_rcpp(list_xyz) :
|    Mat::operator(): index out of bounds
| Execution halted
| 
| This error raised also in window OS, but was fixed changing input 
| variable in Rcpp::NumericMatrix.
| 
| Complete check is at:
| https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220111_170553/Debian/00check.log
| 
| Every suggestion is welcome.

This is a general packaging list; Rcpp has a dedicated list. Could you please
there, or if you cannot, on StackOverflow, or post a GitHub issue?

There are some decent tutorials out here about how to post a _minimally
verifiable complete example_, see eg
   https://stackoverflow.com/help/minimal-reproducible-example
This post would not allow to do any meaningful investigation yet.

Thanks in advance for your help,  Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From r@m@krug @end|ng |rom gm@||@com  Fri Jan 14 15:14:11 2022
From: r@m@krug @end|ng |rom gm@||@com (Rainer M Krug)
Date: Fri, 14 Jan 2022 06:14:11 -0800
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
Message-ID: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>

Hi

I want to re-submit an archived package to CRAN, and I get, when checking
on hub builder, the following Note:

* checking for detritus in the temp directory ... NOTE
Found the following files/directories:
  'lastMiKTeXException'


See
https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159


Any suggestions how this can be fixed?

Thanks.

I also get from the following,

* checking for non-standard things in the check directory ... NOTE
Found the following files/directories:
  ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
  ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
  ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
  ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
  ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
  ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
  ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
  ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
  ?wikitaxa? ?worrms? ?zoo?


(
https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
)
but I assume that is not relevant.
?

Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology,
UCT), Dipl. Phys. (Germany)

Orcid ID: 0000-0002-7490-0066

Department of Evolutionary Biology and Environmental Studies
University of Z?rich
Office Y34-J-74
Winterthurerstrasse 190
8075 Z?rich
Switzerland

Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Orcid ID: 0000-0002-7490-0066

Department of Evolutionary Biology and Environmental Studies
University of Z?rich
Office Y34-J-74
Winterthurerstrasse 190
8075 Z?rich
Switzerland

Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich
Office Y34-J-74
Winterthurerstrasse 190
8075 Z?rich
Switzerland

Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich





Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Ke


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Keug@


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Keug at gmail.


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Keug at gmail.com


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com




Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com


---

Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Sat Jan 15 00:40:00 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Sat, 15 Jan 2022 00:40:00 +0100
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
In-Reply-To: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
References: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
Message-ID: <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>



On 14.01.2022 15:14, Rainer M Krug wrote:
> Hi
> 
> I want to re-submit an archived package to CRAN, and I get, when checking
> on hub builder, the following Note:
> 
> * checking for detritus in the temp directory ... NOTE
> Found the following files/directories:
>    'lastMiKTeXException'

If it is not part of your package it may be related due to failing 
MikTeX when building, e.g., the manual or vignettes?
If hat worked otherwise I'd ignore it unless it also happens on CRAN.

Best,
Uwe Ligges

> 
> 
> See
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159
> 
> 
> Any suggestions how this can be fixed?
> 
> Thanks.
> 
> I also get from the following,
> 
> * checking for non-standard things in the check directory ... NOTE
> Found the following files/directories:
>    ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
>    ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
>    ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
>    ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
>    ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
>    ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
>    ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
>    ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
>    ?wikitaxa? ?worrms? ?zoo?
> 
> 
> (
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
> )
> but I assume that is not relevant.
> ?
> 
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology,
> UCT), Dipl. Phys. (Germany)
> 
> Orcid ID: 0000-0002-7490-0066
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> Office Y34-J-74
> Winterthurerstrasse 190
> 8075 Z?rich
> Switzerland
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Orcid ID: 0000-0002-7490-0066
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> Office Y34-J-74
> Winterthurerstrasse 190
> 8075 Z?rich
> Switzerland
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> Office Y34-J-74
> Winterthurerstrasse 190
> 8075 Z?rich
> Switzerland
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Ke
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Keug@
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Keug at gmail.
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Keug at gmail.com
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 
> ---
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@m@krug @end|ng |rom gm@||@com  Sun Jan 16 13:12:25 2022
From: r@m@krug @end|ng |rom gm@||@com (Rainer M Krug)
Date: Sun, 16 Jan 2022 04:12:25 -0800
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
In-Reply-To: <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>
References: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
 <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>
Message-ID: <CAGhLh6HjNHC0GoEqGpr2ifYzMG8-8Uxog-vEhybDfbfQ2otNyQ@mail.gmail.com>

Thanks Uwe,

I?ll try submission to CRAN beginning of next week.

Rainer



On 15 Jan 2022 at 00:40:00, Uwe Ligges <ligges at statistik.tu-dortmund.de>
wrote:

>
>
> On 14.01.2022 15:14, Rainer M Krug wrote:
>
> Hi
>
>
> I want to re-submit an archived package to CRAN, and I get, when checking
>
> on hub builder, the following Note:
>
>
> * checking for detritus in the temp directory ... NOTE
>
> Found the following files/directories:
>
>    'lastMiKTeXException'
>
>
> If it is not part of your package it may be related due to failing
> MikTeX when building, e.g., the manual or vignettes?
> If hat worked otherwise I'd ignore it unless it also happens on CRAN.
>
> Best,
> Uwe Ligges
>
>
>
> See
>
>
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159
>
>
>
> Any suggestions how this can be fixed?
>
>
> Thanks.
>
>
> I also get from the following,
>
>
> * checking for non-standard things in the check directory ... NOTE
>
> Found the following files/directories:
>
>    ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
>
>    ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
>
>    ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
>
>    ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
>
>    ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
>
>    ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
>
>    ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
>
>    ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
>
>    ?wikitaxa? ?worrms? ?zoo?
>
>
>
> (
>
>
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
>
> )
>
> but I assume that is not relevant.
>
> ?
>
>
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology,
>
> UCT), Dipl. Phys. (Germany)
>
>
> Orcid ID: 0000-0002-7490-0066
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
> Office Y34-J-74
>
> Winterthurerstrasse 190
>
> 8075 Z?rich
>
> Switzerland
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Orcid ID: 0000-0002-7490-0066
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
> Office Y34-J-74
>
> Winterthurerstrasse 190
>
> 8075 Z?rich
>
> Switzerland
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
> Office Y34-J-74
>
> Winterthurerstrasse 190
>
> 8075 Z?rich
>
> Switzerland
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Ke
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Keug@
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Keug at gmail.
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Keug at gmail.com
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
>
> ---
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
> [[alternative HTML version deleted]]
>
>
> ______________________________________________
>
> R-package-devel at r-project.org mailing list
>
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r  Mon Jan 17 16:06:40 2022
From: @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r (=?UTF-8?Q?Aur=c3=a9lie_Siberchicot?=)
Date: Mon, 17 Jan 2022 16:06:40 +0100
Subject: [R-pkg-devel] package with datasets requiring sp
Message-ID: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>

Hi,

I maintain the 'ade4' package which contains data with S4 objects from 
the package 'sp'.
Some functions of the 'sp' package are also used in examples in some Rd 
files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {} --).
In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports' 
according to an email received from Brian Ripley, because "At least one 
of the datasets cannot be loaded without a package declared in Suggests: 
-- typically this is because it loads a namespace defining S4 classes, 
and such imports should be declared in Imports or (as Matrix does) use a 
.R wrapper."

For a few months, I have had the following NOTE:
* checking dependencies in R code ... NOTE
Namespace in Imports field not imported from: ?sp?
All declared Imports should be used.

In 'Writing R Extensions', I found: "Packages needed to use datasets 
from the package should be in ?Imports?: this includes those needed to 
define S4 classes used."

Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary 
to the recommendations of 'Writing R Extensions' and Brian Ripley.
I'm a bit confused to solve this note and the best way to declare the 
dependency of 'ade4' to 'sp'.
Is anyone in my situation? Does anyone have any advice?

Thanks in advande for any help.
Cheers.
Aur?lie.





-- 
Aur?lie SIBERCHICOT
Ing?nieure en Ing?nierie Logicielle
04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr

Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
Universit? Claude Bernard - Lyon 1
B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
69622 Villeurbanne cedex


	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Mon Jan 17 17:24:34 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Mon, 17 Jan 2022 11:24:34 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
Message-ID: <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>

If a package is declared in Imports, it means that there must be some kind
of import expression in the NAMESPACE file. For example:

import(sp) # imports the whole sp package, probably NOT what you want
importFrom(sp, Polygon)  # import object Polygon from sp namespace

Theoretically, your import statement could import any of the sp namespace
objects, but it probably makes far more sense to import the datasets from
sp that you're using

On Mon, Jan 17, 2022, 11:11 Aur?lie Siberchicot <
aurelie.siberchicot at univ-lyon1.fr> wrote:

> Hi,
>
> I maintain the 'ade4' package which contains data with S4 objects from
> the package 'sp'.
> Some functions of the 'sp' package are also used in examples in some Rd
> files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {} --).
> In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports'
> according to an email received from Brian Ripley, because "At least one
> of the datasets cannot be loaded without a package declared in Suggests:
> -- typically this is because it loads a namespace defining S4 classes,
> and such imports should be declared in Imports or (as Matrix does) use a
> .R wrapper."
>
> For a few months, I have had the following NOTE:
> * checking dependencies in R code ... NOTE
> Namespace in Imports field not imported from: ?sp?
> All declared Imports should be used.
>
> In 'Writing R Extensions', I found: "Packages needed to use datasets
> from the package should be in ?Imports?: this includes those needed to
> define S4 classes used."
>
> Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary
> to the recommendations of 'Writing R Extensions' and Brian Ripley.
> I'm a bit confused to solve this note and the best way to declare the
> dependency of 'ade4' to 'sp'.
> Is anyone in my situation? Does anyone have any advice?
>
> Thanks in advande for any help.
> Cheers.
> Aur?lie.
>
>
>
>
>
> --
> Aur?lie SIBERCHICOT
> Ing?nieure en Ing?nierie Logicielle
> 04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>
> Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
> Universit? Claude Bernard - Lyon 1
> B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
> 69622 Villeurbanne cedex
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Jan 17 19:17:19 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 17 Jan 2022 13:17:19 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
Message-ID: <2e2885d5-a6f6-7a10-0cef-ff046c4f2a6e@gmail.com>

On 17/01/2022 10:06 a.m., Aur?lie Siberchicot wrote:
> Hi,
> 
> I maintain the 'ade4' package which contains data with S4 objects from
> the package 'sp'.
> Some functions of the 'sp' package are also used in examples in some Rd
> files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {} --).
> In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports'
> according to an email received from Brian Ripley, because "At least one
> of the datasets cannot be loaded without a package declared in Suggests:
> -- typically this is because it loads a namespace defining S4 classes,
> and such imports should be declared in Imports or (as Matrix does) use a
> .R wrapper."
> 
> For a few months, I have had the following NOTE:
> * checking dependencies in R code ... NOTE
> Namespace in Imports field not imported from: ?sp?
> All declared Imports should be used.
> 
> In 'Writing R Extensions', I found: "Packages needed to use datasets
> from the package should be in ?Imports?: this includes those needed to
> define S4 classes used."
> 
> Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary
> to the recommendations of 'Writing R Extensions' and Brian Ripley.
> I'm a bit confused to solve this note and the best way to declare the
> dependency of 'ade4' to 'sp'.
> Is anyone in my situation? Does anyone have any advice?

I think the easiest is to follow Prof Ripley's second suggestion:  "use 
a .R wrapper".  To do this, you don't put the .rda file in the data 
directory, you put it somewhere else.  Matrix uses inst/external.  In 
your data directory, you put a small script.

For example, if the object name is foo, you might have the saved object 
in inst/external/foo.rda, and in the data directory a script foo.R that 
looks something like this:

   if (!requireNamespace("sp")) stop("The sp package is required for foo.")

   foo <- readRDS(system.file("external/foo.rda", package = "ade4"))

Duncan Murdoch


From @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r  Tue Jan 18 10:03:09 2022
From: @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r (=?UTF-8?Q?Aur=c3=a9lie_Siberchicot?=)
Date: Tue, 18 Jan 2022 10:03:09 +0100
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
Message-ID: <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>

Thank you Andrew !
I think I didn't explain my context correctly.
I'm not importing datasets from 'sp'. I have datasets that are built 
from S4 objects of sp.
In pratical terms, I don't import anything from 'sp' but I need 'sp' for 
my datasets to exist.

Cheers.
Aur?lie.


Le 17/01/2022 ? 17:24, Andrew Simmons a ?crit?:
> If a package is declared in Imports, it means that there must be some 
> kind of import expression in the NAMESPACE file. For example:
>
> import(sp) # imports the whole sp package, probably NOT what you want
> importFrom(sp, Polygon)? # import object Polygon from sp namespace
>
> Theoretically, your import statement could import any of the sp 
> namespace objects, but it probably makes far more sense to import the 
> datasets from sp that you're using
>
> On Mon, Jan 17, 2022, 11:11 Aur?lie Siberchicot 
> <aurelie.siberchicot at univ-lyon1.fr 
> <mailto:aurelie.siberchicot at univ-lyon1.fr>> wrote:
>
>     Hi,
>
>     I maintain the 'ade4' package which contains data with S4 objects
>     from
>     the package 'sp'.
>     Some functions of the 'sp' package are also used in examples in
>     some Rd
>     files (using the code -- if(requireNamespace("sp", quietly =
>     TRUE)) {} --).
>     In February 2020, I moved the 'sp' package from 'Suggests' to
>     'Imports'
>     according to an email received from Brian Ripley, because "At
>     least one
>     of the datasets cannot be loaded without a package declared in
>     Suggests:
>     -- typically this is because it loads a namespace defining S4
>     classes,
>     and such imports should be declared in Imports or (as Matrix does)
>     use a
>     .R wrapper."
>
>     For a few months, I have had the following NOTE:
>     * checking dependencies in R code ... NOTE
>     Namespace in Imports field not imported from: ?sp?
>     All declared Imports should be used.
>
>     In 'Writing R Extensions', I found: "Packages needed to use datasets
>     from the package should be in ?Imports?: this includes those
>     needed to
>     define S4 classes used."
>
>     Moving back 'sp' in 'Suggests' seems to solves the NOTE but is
>     contrary
>     to the recommendations of 'Writing R Extensions' and Brian Ripley.
>     I'm a bit confused to solve this note and the best way to declare the
>     dependency of 'ade4' to 'sp'.
>     Is anyone in my situation? Does anyone have any advice?
>
>     Thanks in advande for any help.
>     Cheers.
>     Aur?lie.
>
>
>
>
>
>     -- 
>     Aur?lie SIBERCHICOT
>     Ing?nieure en Ing?nierie Logicielle
>     04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>     <mailto:aurelie.siberchicot at univ-lyon1.fr>
>
>     Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
>     Universit? Claude Bernard - Lyon 1
>     B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
>     69622 Villeurbanne cedex
>
>
>     ? ? ? ? [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>

-- 
Aur?lie SIBERCHICOT
Ing?nieure en Ing?nierie Logicielle
04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr

Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
Universit? Claude Bernard - Lyon 1
B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
69622 Villeurbanne cedex


	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Tue Jan 18 23:02:31 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Wed, 19 Jan 2022 11:02:31 +1300
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
 <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
Message-ID: <20220119110231.16e8bc8a@rolf-Latitude-E7470>

On Tue, 18 Jan 2022 10:03:09 +0100
Aur?lie Siberchicot <aurelie.siberchicot at univ-lyon1.fr> wrote:

> Thank you Andrew !
> I think I didn't explain my context correctly.
> I'm not importing datasets from 'sp'. I have datasets that are built 
> from S4 objects of sp.
> In pratical terms, I don't import anything from 'sp' but I need 'sp'
> for my datasets to exist.

I'm probably misunderstanding/missing the point --- but it seems to me
that the obvious procedure would be to obtain the necessary objects
from sp, build your data sets, put them into the data directory of your
package, and then make no further reference to sp (other than perhaps
duly acknowledging the provenance of your data sets in the help files
that you write for them).

If my comment is totally out to lunch, please ignore it.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Jan 19 11:34:38 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 19 Jan 2022 05:34:38 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <20220119110231.16e8bc8a@rolf-Latitude-E7470>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
 <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
 <20220119110231.16e8bc8a@rolf-Latitude-E7470>
Message-ID: <a4df1cfd-a80b-3f16-9cd9-40c23f9f7fcc@gmail.com>

On 18/01/2022 5:02 p.m., Rolf Turner wrote:
> On Tue, 18 Jan 2022 10:03:09 +0100
> Aur?lie Siberchicot <aurelie.siberchicot at univ-lyon1.fr> wrote:
> 
>> Thank you Andrew !
>> I think I didn't explain my context correctly.
>> I'm not importing datasets from 'sp'. I have datasets that are built
>> from S4 objects of sp.
>> In pratical terms, I don't import anything from 'sp' but I need 'sp'
>> for my datasets to exist.
> 
> I'm probably misunderstanding/missing the point --- but it seems to me
> that the obvious procedure would be to obtain the necessary objects
> from sp, build your data sets, put them into the data directory of your
> package, and then make no further reference to sp (other than perhaps
> duly acknowledging the provenance of your data sets in the help files
> that you write for them).
> 
> If my comment is totally out to lunch, please ignore it.

The issue is that the data sets are S4 objects whose class definition is 
in sp.  You can't load such an object without having the class 
definition available.  Copying the class definition to another package 
would not be a reasonable solution.

R's check code doesn't recognize that using a class from another package 
is a hard reference to the other package, and it complains if sp is 
listed in the Imports list.

Really it should be equivalent to having a package in the Imports list, 
with all imports done using :: at runtime.  Then ade4 couldn't be 
installed without having sp present, and loading the data could trigger 
a namespace load of sp.  But that logic isn't in place.

The solution given by Prof. Ripley allows a workaround:  list sp in 
Suggests, and have a script that checks for sp before trying to load the 
data.  This is fine if loading that dataset is optional, with most users 
not needing it.  However, if it happens to be a dataset that most users 
will need to load, it's not good:  most users will need sp, and it 
should be a hard dependency for the package.

Duncan Murdoch


From @kw@|mmo @end|ng |rom gm@||@com  Wed Jan 19 16:50:11 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Wed, 19 Jan 2022 10:50:11 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
 <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
Message-ID: <CAPcHnpShVv1ExTz6K3O=PPJu+T2p7EGb+4XUirhpJfZmZPLm=Q@mail.gmail.com>

It seems like I did misunderstand. What I'd suggest instead is adding:

importClassesFrom(sp, ...)
importMethodsFrom(sp, ...)

in your NAMESPACE file, and then put the class names and method names that
you need. This is (probably) the best solution; it imports only the things
you absolutely need from sp, while making sp a hard dependency (your
package namespace cannot by load without the sp namespace also loaded).

On Tue, Jan 18, 2022, 04:03 Aur?lie Siberchicot <
aurelie.siberchicot at univ-lyon1.fr> wrote:

> Thank you Andrew !
> I think I didn't explain my context correctly.
> I'm not importing datasets from 'sp'. I have datasets that are built from
> S4 objects of sp.
> In pratical terms, I don't import anything from 'sp' but I need 'sp' for
> my datasets to exist.
>
> Cheers.
> Aur?lie.
>
>
> Le 17/01/2022 ? 17:24, Andrew Simmons a ?crit :
>
> If a package is declared in Imports, it means that there must be some kind
> of import expression in the NAMESPACE file. For example:
>
> import(sp) # imports the whole sp package, probably NOT what you want
> importFrom(sp, Polygon)  # import object Polygon from sp namespace
>
> Theoretically, your import statement could import any of the sp namespace
> objects, but it probably makes far more sense to import the datasets from
> sp that you're using
>
> On Mon, Jan 17, 2022, 11:11 Aur?lie Siberchicot <
> aurelie.siberchicot at univ-lyon1.fr> wrote:
>
>> Hi,
>>
>> I maintain the 'ade4' package which contains data with S4 objects from
>> the package 'sp'.
>> Some functions of the 'sp' package are also used in examples in some Rd
>> files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {}
>> --).
>> In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports'
>> according to an email received from Brian Ripley, because "At least one
>> of the datasets cannot be loaded without a package declared in Suggests:
>> -- typically this is because it loads a namespace defining S4 classes,
>> and such imports should be declared in Imports or (as Matrix does) use a
>> .R wrapper."
>>
>> For a few months, I have had the following NOTE:
>> * checking dependencies in R code ... NOTE
>> Namespace in Imports field not imported from: ?sp?
>> All declared Imports should be used.
>>
>> In 'Writing R Extensions', I found: "Packages needed to use datasets
>> from the package should be in ?Imports?: this includes those needed to
>> define S4 classes used."
>>
>> Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary
>> to the recommendations of 'Writing R Extensions' and Brian Ripley.
>> I'm a bit confused to solve this note and the best way to declare the
>> dependency of 'ade4' to 'sp'.
>> Is anyone in my situation? Does anyone have any advice?
>>
>> Thanks in advande for any help.
>> Cheers.
>> Aur?lie.
>>
>>
>>
>>
>>
>> --
>> Aur?lie SIBERCHICOT
>> Ing?nieure en Ing?nierie Logicielle
>> 04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>>
>> Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
>> Universit? Claude Bernard - Lyon 1
>> B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
>> 69622 Villeurbanne cedex
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
> --
> Aur?lie SIBERCHICOT
> Ing?nieure en Ing?nierie Logicielle
> 04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>
> Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
> Universit? Claude Bernard - Lyon 1
> B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
> 69622 Villeurbanne cedex
>
>
>

	[[alternative HTML version deleted]]


From Ke|th@Go|d|e|d @end|ng |rom nyu|@ngone@org  Wed Jan 19 22:37:49 2022
From: Ke|th@Go|d|e|d @end|ng |rom nyu|@ngone@org (Goldfeld, Keith)
Date: Wed, 19 Jan 2022 21:37:49 +0000
Subject: [R-pkg-devel] PREPERROR on Debian Linux, R-devel
Message-ID: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>

Good afternoon/evening ?



I maintain the R package ?simstudy? (https://cran.r-project.org/web/packages/simstudy/index.html) and recently made a few bug fixes and simple enhancements. I am preparing to submit a new version 0.4.0 to CRAN. In doing the rhub checks (rhub::check_for_cran()), I received a curious PREPERROR from ?Debian Linux, R-Devel, GCC ASAN/UBSAN?. I am wondering if this is something on my end that I can and should fix, or if it is something that is out of my hands.



Thanks so much.



-          Keith



------------------------------------------------------------
This email message, including any attachments, is for the sole use of the intended recipient(s) and may contain information that is proprietary, confidential, and exempt from disclosure under applicable law. Any unauthorized review, use, disclosure, or distribution is prohibited. If you have received this email in error please notify the sender by return email and delete the original message. Please note, the recipient should check this email and any attachments for the presence of viruses. The organization accepts no liability for any damage caused by any virus transmitted by this email.
=================================

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu Jan 20 09:44:39 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 20 Jan 2022 09:44:39 +0100
Subject: [R-pkg-devel] PREPERROR on Debian Linux, R-devel
In-Reply-To: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
References: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
Message-ID: <e1c47bb4-b916-def3-854d-1693036c7482@statistik.tu-dortmund.de>



On 19.01.2022 22:37, Goldfeld, Keith via R-package-devel wrote:
> Good afternoon/evening ?
> 
> 
> 
> I maintain the R package ?simstudy? (https://cran.r-project.org/web/packages/simstudy/index.html) and recently made a few bug fixes and simple enhancements. I am preparing to submit a new version 0.4.0 to CRAN. In doing the rhub checks (rhub::check_for_cran()), I received a curious PREPERROR from ?Debian Linux, R-Devel, GCC ASAN/UBSAN?. I am wondering if this is something on my end that I can and should fix, or if it is something that is out of my hands.


Perhaps people can answer your querstion if you provide full logs.

Best,
Uwe Ligges



> 
> 
> Thanks so much.
> 
> 
> 
> -          Keith
> 
> 
> 
> ------------------------------------------------------------
> This email message, including any attachments, is for the sole use of the intended recipient(s) and may contain information that is proprietary, confidential, and exempt from disclosure under applicable law. Any unauthorized review, use, disclosure, or distribution is prohibited. If you have received this email in error please notify the sender by return email and delete the original message. Please note, the recipient should check this email and any attachments for the presence of viruses. The organization accepts no liability for any damage caused by any virus transmitted by this email.
> =================================
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Thu Jan 20 14:05:04 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 20 Jan 2022 07:05:04 -0600
Subject: [R-pkg-devel] PREPERROR on Debian Linux, R-devel
In-Reply-To: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
References: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
Message-ID: <25065.24064.272686.642975@rob.eddelbuettel.com>


On 19 January 2022 at 21:37, Goldfeld, Keith via R-package-devel wrote:
| In doing the rhub checks (rhub::check_for_cran()), I received a curious PREPERROR from ?Debian Linux, R-Devel, GCC ASAN/UBSAN?. I am wondering if this is something on my end that I can and should fix, or if it is something that is out of my hands.

I suggest "out of your hands" as I also often run there too (as the platform
is included in a 'wrapper' function in the rhub package) and always get that
PREPERROR. The logs often show OK but under ASAN/UBSAN something seems to
propagate the wrong way leading to an overall 'error'.  <man_shrugging_emoji_here>

I would just move on and ignore it. It seems like a long-lasting 'bug' but on
balance it is more valuable to actually have a ASAN/UBSAN instance than not.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From r@m@krug @end|ng |rom gm@||@com  Thu Jan 20 20:29:20 2022
From: r@m@krug @end|ng |rom gm@||@com (Rainer M Krug)
Date: Thu, 20 Jan 2022 14:29:20 -0500
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
In-Reply-To: <CAGhLh6HjNHC0GoEqGpr2ifYzMG8-8Uxog-vEhybDfbfQ2otNyQ@mail.gmail.com>
References: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
 <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>
 <CAGhLh6HjNHC0GoEqGpr2ifYzMG8-8Uxog-vEhybDfbfQ2otNyQ@mail.gmail.com>
Message-ID: <CAGhLh6FfPp5=zLroVPA4+QtPgG6J37PEQTQALDw_DxwboU5mRg@mail.gmail.com>

OK - I resubmitted, and got the following response:

###############
Dear maintainer,

package dmdScheme_1.2.8.tar.gz does not pass the incoming checks
automatically, please see the following pre-tests:
Windows: <
https://win-builder.r-project.org/incoming_pretest/dmdScheme_1.2.8_20220120_195907/Windows/00check.log
>
Status: 1 NOTE
Debian: <
https://win-builder.r-project.org/incoming_pretest/dmdScheme_1.2.8_20220120_195907/Debian/00check.log
>
Status: 2 NOTEs



Please fix all problems and resubmit a fixed version via the webform.
If you are not sure how to fix the problems shown, please ask for help on
the R-package-devel mailing list:
<https://stat.ethz.ch/mailman/listinfo/r-package-devel>
If you are fairly certain the rejection is a false positive, please
reply-all to this message and explain.

More details are given in the directory:
<
https://win-builder.r-project.org/incoming_pretest/dmdScheme_1.2.8_20220120_195907/
>
The files will be removed after roughly 7 days.

No strong reverse dependencies to be checked.

Best regards,
CRAN teams' auto-check service
Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: CRAN incoming feasibility, Result: NOTE
 Maintainer: 'Rainer M. Krug <Rainer.Krug at uzh.ch>'

 New submission

 Package was archived on CRAN

 Possibly misspelled words in DESCRIPTION:
   Krug (5:41)
   MetaData (2:24)
   Petchey (5:55)

 CRAN repository db overrides:
   X-CRAN-Comment: Archived on 2021-09-06 as check problems were not
     corrected in time.

Flavor: r-devel-linux-x86_64-debian-gcc
Check: for non-standard things in the check directory, Result: NOTE
 Found the following files/directories:
   ?emeScheme'

###############

So that brings me back to square zero. Not reproducible anywhere, only on
Debian on CRAN.

Do you have any suggestions on how I can proceed?

Thanks,

Rainer

---


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com



On 16 Jan 2022 at 13:12:25, Rainer M Krug <r.m.krug at gmail.com> wrote:

> Thanks Uwe,
>
> I?ll try submission to CRAN beginning of next week.
>
> Rainer
>
>
>
> On 15 Jan 2022 at 00:40:00, Uwe Ligges <ligges at statistik.tu-dortmund.de>
> wrote:
>
>>
>>
>> On 14.01.2022 15:14, Rainer M Krug wrote:
>>
>> Hi
>>
>>
>> I want to re-submit an archived package to CRAN, and I get, when checking
>>
>> on hub builder, the following Note:
>>
>>
>> * checking for detritus in the temp directory ... NOTE
>>
>> Found the following files/directories:
>>
>>    'lastMiKTeXException'
>>
>>
>> If it is not part of your package it may be related due to failing
>> MikTeX when building, e.g., the manual or vignettes?
>> If hat worked otherwise I'd ignore it unless it also happens on CRAN.
>>
>> Best,
>> Uwe Ligges
>>
>>
>>
>> See
>>
>>
>> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159
>>
>>
>>
>> Any suggestions how this can be fixed?
>>
>>
>> Thanks.
>>
>>
>> I also get from the following,
>>
>>
>> * checking for non-standard things in the check directory ... NOTE
>>
>> Found the following files/directories:
>>
>>    ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
>>
>>    ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
>>
>>    ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
>>
>>    ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
>>
>>    ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
>>
>>    ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
>>
>>    ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
>>
>>    ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
>>
>>    ?wikitaxa? ?worrms? ?zoo?
>>
>>
>>
>> (
>>
>>
>> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
>>
>> )
>>
>> but I assume that is not relevant.
>>
>> ?
>>
>>
>> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
>> Biology,
>>
>> UCT), Dipl. Phys. (Germany)
>>
>>
>> Orcid ID: 0000-0002-7490-0066
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>> Office Y34-J-74
>>
>> Winterthurerstrasse 190
>>
>> 8075 Z?rich
>>
>> Switzerland
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Orcid ID: 0000-0002-7490-0066
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>> Office Y34-J-74
>>
>> Winterthurerstrasse 190
>>
>> 8075 Z?rich
>>
>> Switzerland
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>> Office Y34-J-74
>>
>> Winterthurerstrasse 190
>>
>> 8075 Z?rich
>>
>> Switzerland
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Ke
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Keug@
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Keug at gmail.
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Keug at gmail.com
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>>
>> ---
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>> [[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>>
>> R-package-devel at r-project.org mailing list
>>
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>

	[[alternative HTML version deleted]]


From yut@n|@|n| @end|ng |rom gm@||@com  Sat Jan 22 10:50:09 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Sat, 22 Jan 2022 18:50:09 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on Windows
Message-ID: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>

Hi,

I'm trying to create a Rust library that can implement an R graphic
device[1], but the R session crashes on `dev.off()` on Windows with R
4.1.2. Strangely, it works without errors on Linux, on macOS, and even
on Windows with R-devel.

Looking at the stack trace below by WinDbg, the problem is probably
that either of the two free()s in GEdestroyDevDesc() tries to free
some memory that was already freed (I'm a very beginner of this kind
of debugging, so I might be wrong).

    # Child-SP          RetAddr               Call Site
    00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
    01 00000000`0441cbc0 00007ffb`3df14c82
ntdll!RtlReportCriticalFailure+0x97
    ...snip...
    08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
    09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
    0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
    0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
    0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
    ...snip...

But, I found no difference in the related code (around devoff() and
GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
lot of feature additions in R-devel, but I don't think it affects
here. Is there anyone who suffered from similar crashes? Am I missing
something?

I would appreciate any advice.

Best,
Yutani

[1]: https://github.com/extendr/extendr/pull/360


From r|cc@r| @end|ng |rom hotm@||@|t  Sat Jan 22 12:40:25 2022
From: r|cc@r| @end|ng |rom hotm@||@|t (riccardo)
Date: Sat, 22 Jan 2022 12:40:25 +0100
Subject: [R-pkg-devel] Fix JFM package problem
In-Reply-To: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
References: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
Message-ID: <AM5PR0601MB2244FECEB8EA7218865E8446D75C9@AM5PR0601MB2244.eurprd06.prod.outlook.com>

Hallo,

I re-submitted the JFM package and the following error raised again running an example in a rcpp
function only in Debian check:

package JFM_1.0.tar.gz does not pass the incoming checks automatically, please see the following pre-tests:
Windows:<https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220122_111558/Windows/00check.log>
Status: 1 NOTE
Debian:<https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220122_111558/Debian/00check.log>
Status: 1 ERROR, 1 NOTE

Running examples in ???JFM-Ex.R??? failed
The error most likely occurred in:

> base::assign(".ptime", proc.time(), pos = "CheckExEnv")
> ### Name: least_square_plane_rcpp
> ### Title: returns the coefficients of the least square plane and the
> ###   relative medium square error
> ### Aliases: least_square_plane_rcpp
> 
> ### ** Examples
> 
> list_xyz<-matrix(data = c(-10.0, -10.0, -15.0 ,10.0, -10.0,
+ -5.0, -10.0, 10.0, 5.0, 10.0, 10.0 ,15.0),
+ nrow = 4,ncol = 3, byrow = TRUE)
> least_square_plane_rcpp(list_xyz)

warning: eig_sym(): given matrix is not symmetric
Error in least_square_plane_rcpp(list_xyz) :
   Mat::operator(): index out of bounds
Execution halted

as you suggested I posted an issue with complete function code athttps://github.com/riccarl/JFM/issues/1

the correct result in windows is:

3.333333e-01  6.666667e-01 -6.666667e-01  0.000000e+00  6.280370e-16

Thank you in advance
Riccardo


	[[alternative HTML version deleted]]


From r@|@@pere|r@@br @end|ng |rom gm@||@com  Mon Jan 24 02:54:35 2022
From: r@|@@pere|r@@br @end|ng |rom gm@||@com (Rafael H. M. Pereira)
Date: Sun, 23 Jan 2022 22:54:35 -0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
Message-ID: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>

Hi all.

In one of the functions of my package (flightsbr), I have a vector with
character strings where I need to replace the degree symbol ? with a point
'.' So this is what I do:

vec <- gsub("[?]", ".", vec)

However, I keep getting this Warning from devtools::check():
  Found the following file with non-ASCII characters:
    utils.R
  Portable packages must use only ASCII characters in their R code,
  except perhaps in comments.
  Use \uxxxx escapes for other characters.

I assume there is a ASCII representation of ?, but I cannot really find a
way to do this using ASCII  characters. Any ideas?

best,
Rafael Pereira

	[[alternative HTML version deleted]]


From @vr@h@m@@d|er @end|ng |rom gm@||@com  Mon Jan 24 02:56:37 2022
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Mon, 24 Jan 2022 01:56:37 +0000
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
Message-ID: <CAL6gwnKK7O+KnkYyvE13kiqJBCdcFY_eu-NRwHz=iV=mzY+mVA@mail.gmail.com>

https://theasciicode.com.ar/extended-ascii-code/degree-symbol-ascii-code-248.html

On Mon, Jan 24, 2022 at 1:55 AM Rafael H. M. Pereira
<rafa.pereira.br at gmail.com> wrote:
>
> Hi all.
>
> In one of the functions of my package (flightsbr), I have a vector with
> character strings where I need to replace the degree symbol ? with a point
> '.' So this is what I do:
>
> vec <- gsub("[?]", ".", vec)
>
> However, I keep getting this Warning from devtools::check():
>   Found the following file with non-ASCII characters:
>     utils.R
>   Portable packages must use only ASCII characters in their R code,
>   except perhaps in comments.
>   Use \uxxxx escapes for other characters.
>
> I assume there is a ASCII representation of ?, but I cannot really find a
> way to do this using ASCII  characters. Any ideas?
>
> best,
> Rafael Pereira
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From dbos@k01 m@iii@g oii gm@ii@com  Mon Jan 24 03:09:09 2022
From: dbos@k01 m@iii@g oii gm@ii@com (dbos@k01 m@iii@g oii gm@ii@com)
Date: Sun, 23 Jan 2022 21:09:09 -0500
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
Message-ID: <007601d810c7$6050bd30$20f23790$@gmail.com>

vec <- c("one", "two", "three?")
vec
# [1] "one"    "two"    "three?"

vec1 <- gsub("[\xB0]", ".", vec)
vec1
# [1] "one"    "two"    "three."

-----Original Message-----
From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf Of Rafael H. M. Pereira
Sent: Sunday, January 23, 2022 8:55 PM
To: r-package-devel at r-project.org
Subject: [R-pkg-devel] ASCII code for Degree symbol ?

Hi all.

In one of the functions of my package (flightsbr), I have a vector with character strings where I need to replace the degree symbol ? with a point '.' So this is what I do:

vec <- gsub("[?]", ".", vec)

However, I keep getting this Warning from devtools::check():
  Found the following file with non-ASCII characters:
    utils.R
  Portable packages must use only ASCII characters in their R code,
  except perhaps in comments.
  Use \uxxxx escapes for other characters.

I assume there is a ASCII representation of ?, but I cannot really find a way to do this using ASCII  characters. Any ideas?

best,
Rafael Pereira

	[[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@|@@pere|r@@br @end|ng |rom gm@||@com  Mon Jan 24 03:20:37 2022
From: r@|@@pere|r@@br @end|ng |rom gm@||@com (Rafael H. M. Pereira)
Date: Sun, 23 Jan 2022 23:20:37 -0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <007601d810c7$6050bd30$20f23790$@gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
Message-ID: <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>

Thank you, dbosak01. This was really  really  helpful !

best wishes,
Rafael Pereira

On Sun, Jan 23, 2022 at 11:09 PM <dbosak01 at gmail.com> wrote:

> vec <- c("one", "two", "three?")
> vec
> # [1] "one"    "two"    "three?"
>
> vec1 <- gsub("[\xB0]", ".", vec)
> vec1
> # [1] "one"    "two"    "three."
>
> -----Original Message-----
> From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf
> Of Rafael H. M. Pereira
> Sent: Sunday, January 23, 2022 8:55 PM
> To: r-package-devel at r-project.org
> Subject: [R-pkg-devel] ASCII code for Degree symbol ?
>
> Hi all.
>
> In one of the functions of my package (flightsbr), I have a vector with
> character strings where I need to replace the degree symbol ? with a point
> '.' So this is what I do:
>
> vec <- gsub("[?]", ".", vec)
>
> However, I keep getting this Warning from devtools::check():
>   Found the following file with non-ASCII characters:
>     utils.R
>   Portable packages must use only ASCII characters in their R code,
>   except perhaps in comments.
>   Use \uxxxx escapes for other characters.
>
> I assume there is a ASCII representation of ?, but I cannot really find a
> way to do this using ASCII  characters. Any ideas?
>
> best,
> Rafael Pereira
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Jan 24 09:23:42 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 24 Jan 2022 11:23:42 +0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <007601d810c7$6050bd30$20f23790$@gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
Message-ID: <20220124112342.6673a75d@parabola>

On Sun, 23 Jan 2022 21:09:09 -0500
<dbosak01 at gmail.com> wrote:

> vec1 <- gsub("[\xB0]", ".", vec)

A great degree of care is needed with this.

Encoding('\xB0') is "unknown", i.e. \xXX escape codes are assumed to be
bytes in your native system encoding. On GNU/Linux and other systems
where native encoding is UTF-8 (and not Latin-1 or an ANSI code page),
'\xB0' is an invalid byte sequence, not a degree symbol:

'\xB0' == '?'
# [1] FALSE

On the other hand, the code point for ? is also U+00B0:

as.hexmode(utf8ToInt('?'))
# [1] "b0"
'\ub0'
# [1] "?"

The difference is that Encoding('\ub0') is "UTF-8" and is therefore
portable between systems with different native encodings.

-- 
Best regards,
Ivan


From md @end|ng |rom @und@ku@dk  Mon Jan 24 11:03:44 2022
From: md @end|ng |rom @und@ku@dk (Matt Denwood)
Date: Mon, 24 Jan 2022 10:03:44 +0000
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
 <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>
Message-ID: <49974CCA-A9ED-4735-BE45-7BB5CF5FD230@sund.ku.dk>

Hi Rafael

I find ?stringi::stri_escape_unicode to be extremely useful for generating \uxxxx escapes, for example:

> stringi::stri_escape_unicode("?") |> cat("\n")
\u00b0

Which can be reversed (for checking) using:

> stringi::stri_unescape_unicode("\u00b0") |> cat("\n")
?

This also works with non-ASCII characters embedded in longer sentences:

> stringi::stri_escape_unicode("?v ? m?rkelige tegn!") |> cat("\n")
\u00c5v \u2014 m\u00e6rkelige tegn!

> stringi::stri_unescape_unicode("\u00c5v \u2014 m\u00e6rkelige tegn!") |> cat("\n")
?v ? m?rkelige tegn!

Big thanks to the authors of the stringi package if they are reading this!

Cheers,

Matt


?On 24/01/2022, 03:26, "R-package-devel on behalf of Rafael H. M. Pereira" <r-package-devel-bounces at r-project.org on behalf of rafa.pereira.br at gmail.com> wrote:

    Thank you, dbosak01. This was really  really  helpful !

    best wishes,
    Rafael Pereira

    On Sun, Jan 23, 2022 at 11:09 PM <dbosak01 at gmail.com> wrote:

    > vec <- c("one", "two", "three?")
    > vec
    > # [1] "one"    "two"    "three?"
    >
    > vec1 <- gsub("[\xB0]", ".", vec)
    > vec1
    > # [1] "one"    "two"    "three."
    >
    > -----Original Message-----
    > From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf
    > Of Rafael H. M. Pereira
    > Sent: Sunday, January 23, 2022 8:55 PM
    > To: r-package-devel at r-project.org
    > Subject: [R-pkg-devel] ASCII code for Degree symbol ?
    >
    > Hi all.
    >
    > In one of the functions of my package (flightsbr), I have a vector with
    > character strings where I need to replace the degree symbol ? with a point
    > '.' So this is what I do:
    >
    > vec <- gsub("[?]", ".", vec)
    >
    > However, I keep getting this Warning from devtools::check():
    >   Found the following file with non-ASCII characters:
    >     utils.R
    >   Portable packages must use only ASCII characters in their R code,
    >   except perhaps in comments.
    >   Use \uxxxx escapes for other characters.
    >
    > I assume there is a ASCII representation of ?, but I cannot really find a
    > way to do this using ASCII  characters. Any ideas?
    >
    > best,
    > Rafael Pereira
    >
    >         [[alternative HTML version deleted]]
    >
    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0
    >
    >

    	[[alternative HTML version deleted]]

    ______________________________________________
    R-package-devel at r-project.org mailing list
    https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0


From @gqh@mmond @end|ng |rom gm@||@com  Mon Jan 24 11:58:20 2022
From: @gqh@mmond @end|ng |rom gm@||@com (Anthony Hammond)
Date: Mon, 24 Jan 2022 10:58:20 +0000
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
Message-ID: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>

Hello,

Since updating to the current version of R (4.1.2) I can't seem to pass the
R cmd checks, I get the below message. I've read a lot online about
installing and linking MikTex, which I've done. Another suggests I need the
function texi2dvi(), which is available in the tools package. So I'm not
sure what to do. Any assistance would be appreciated

Thank you
Anthony

checking PDF version of manual ... WARNING
LaTeX errors when creating PDF version.
This typically indicates Rd problems.
* checking PDF version of manual without hyperrefs or index ... ERROR
Re-running with no redirection of stdout/stderr.
Hmm ... looks like a package
You may want to clean up by 'rm -Rf
C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in running tools::texi2pdf()
* DONE
Status: 1 ERROR, 1 WARNING

	[[alternative HTML version deleted]]


From r@|@@pere|r@@br @end|ng |rom gm@||@com  Mon Jan 24 13:49:00 2022
From: r@|@@pere|r@@br @end|ng |rom gm@||@com (Rafael H. M. Pereira)
Date: Mon, 24 Jan 2022 09:49:00 -0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <49974CCA-A9ED-4735-BE45-7BB5CF5FD230@sund.ku.dk>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
 <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>
 <49974CCA-A9ED-4735-BE45-7BB5CF5FD230@sund.ku.dk>
Message-ID: <CAA42DG=tCYCZuW72TJt2_2Y-zvRwRQw7PqxjeRUz6ffeV6GcGw@mail.gmail.com>

Thank you Matt and Ivan. This is all much appreciated. The concern with
portability across OS is also very important! thanks again!

Rafael

On Mon, Jan 24, 2022 at 7:03 AM Matt Denwood <md at sund.ku.dk> wrote:

> Hi Rafael
>
> I find ?stringi::stri_escape_unicode to be extremely useful for generating
> \uxxxx escapes, for example:
>
> > stringi::stri_escape_unicode("?") |> cat("\n")
> \u00b0
>
> Which can be reversed (for checking) using:
>
> > stringi::stri_unescape_unicode("\u00b0") |> cat("\n")
> ?
>
> This also works with non-ASCII characters embedded in longer sentences:
>
> > stringi::stri_escape_unicode("?v ? m?rkelige tegn!") |> cat("\n")
> \u00c5v \u2014 m\u00e6rkelige tegn!
>
> > stringi::stri_unescape_unicode("\u00c5v \u2014 m\u00e6rkelige tegn!") |>
> cat("\n")
> ?v ? m?rkelige tegn!
>
> Big thanks to the authors of the stringi package if they are reading this!
>
> Cheers,
>
> Matt
>
>
> ?On 24/01/2022, 03:26, "R-package-devel on behalf of Rafael H. M. Pereira"
> <r-package-devel-bounces at r-project.org on behalf of
> rafa.pereira.br at gmail.com> wrote:
>
>     Thank you, dbosak01. This was really  really  helpful !
>
>     best wishes,
>     Rafael Pereira
>
>     On Sun, Jan 23, 2022 at 11:09 PM <dbosak01 at gmail.com> wrote:
>
>     > vec <- c("one", "two", "three?")
>     > vec
>     > # [1] "one"    "two"    "three?"
>     >
>     > vec1 <- gsub("[\xB0]", ".", vec)
>     > vec1
>     > # [1] "one"    "two"    "three."
>     >
>     > -----Original Message-----
>     > From: R-package-devel <r-package-devel-bounces at r-project.org> On
> Behalf
>     > Of Rafael H. M. Pereira
>     > Sent: Sunday, January 23, 2022 8:55 PM
>     > To: r-package-devel at r-project.org
>     > Subject: [R-pkg-devel] ASCII code for Degree symbol ?
>     >
>     > Hi all.
>     >
>     > In one of the functions of my package (flightsbr), I have a vector
> with
>     > character strings where I need to replace the degree symbol ? with a
> point
>     > '.' So this is what I do:
>     >
>     > vec <- gsub("[?]", ".", vec)
>     >
>     > However, I keep getting this Warning from devtools::check():
>     >   Found the following file with non-ASCII characters:
>     >     utils.R
>     >   Portable packages must use only ASCII characters in their R code,
>     >   except perhaps in comments.
>     >   Use \uxxxx escapes for other characters.
>     >
>     > I assume there is a ASCII representation of ?, but I cannot really
> find a
>     > way to do this using ASCII  characters. Any ideas?
>     >
>     > best,
>     > Rafael Pereira
>     >
>     >         [[alternative HTML version deleted]]
>     >
>     > ______________________________________________
>     > R-package-devel at r-project.org mailing list
>     >
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0
>     >
>     >
>
>         [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0
>
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Jan 24 13:50:01 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 24 Jan 2022 07:50:01 -0500
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
In-Reply-To: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
References: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
Message-ID: <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>

On 24/01/2022 5:58 a.m., Anthony Hammond wrote:
> Hello,
> 
> Since updating to the current version of R (4.1.2) I can't seem to pass the
> R cmd checks, I get the below message. I've read a lot online about
> installing and linking MikTex, which I've done. Another suggests I need the
> function texi2dvi(), which is available in the tools package. So I'm not
> sure what to do. Any assistance would be appreciated
> 
> Thank you
> Anthony
> 
> checking PDF version of manual ... WARNING
> LaTeX errors when creating PDF version.
> This typically indicates Rd problems.
> * checking PDF version of manual without hyperrefs or index ... ERROR
> Re-running with no redirection of stdout/stderr.
> Hmm ... looks like a package
> You may want to clean up by 'rm -Rf
> C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available
> Error in running tools::texi2pdf()
> * DONE
> Status: 1 ERROR, 1 WARNING

You should fix the ERROR first.  It's saying that the `pdflatex` program 
isn't being found.  Since you say you've installed MikTeX, that probably 
means that it isn't on the system path.  You need to do 2 things:

1.  Find out where pdflatex.exe is on your system.
2.  Make sure its directory is on the PATH that R sees.

You do step 1 using Windows search tools.  For step 2, use 
Sys.getenv("PATH") in R to see the current path.

If you found pdflatex.exe in C:\Miktex\bin\pdflatex.exe then you'd need 
to add "C:\Miktex\bin" to your path.  You can do this temporarily within 
R using

     Sys.setenv(PATH = paste0(Sys.getenv("PATH"), ";C:\\Miktex\\bin")

but this will only last for the current session.  To add it permanently, 
you'll need to use some Windows configuration tools.

Duncan Murdoch


From o||ver@p@m@d@en @end|ng |rom gm@||@com  Mon Jan 24 17:30:41 2022
From: o||ver@p@m@d@en @end|ng |rom gm@||@com (Oliver Madsen)
Date: Mon, 24 Jan 2022 17:30:41 +0100
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
In-Reply-To: <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>
References: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
 <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>
Message-ID: <CAFL8AHqM09+ZEj4zgCuKfw1VOYkT_RPY6XJC4m-Lg-QO33snWg@mail.gmail.com>

For windows simply search "environment variable" which will allow you to
open the environment variable gui. In thete append the folder to the
pdfmatex executable under user variables, and then it should be found by R
after restarting the session.

/Oli er

On Mon, 24 Jan 2022, 13:50 Duncan Murdoch, <murdoch.duncan at gmail.com> wrote:

> On 24/01/2022 5:58 a.m., Anthony Hammond wrote:
> > Hello,
> >
> > Since updating to the current version of R (4.1.2) I can't seem to pass
> the
> > R cmd checks, I get the below message. I've read a lot online about
> > installing and linking MikTex, which I've done. Another suggests I need
> the
> > function texi2dvi(), which is available in the tools package. So I'm not
> > sure what to do. Any assistance would be appreciated
> >
> > Thank you
> > Anthony
> >
> > checking PDF version of manual ... WARNING
> > LaTeX errors when creating PDF version.
> > This typically indicates Rd problems.
> > * checking PDF version of manual without hyperrefs or index ... ERROR
> > Re-running with no redirection of stdout/stderr.
> > Hmm ... looks like a package
> > You may want to clean up by 'rm -Rf
> > C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in running tools::texi2pdf()
> > * DONE
> > Status: 1 ERROR, 1 WARNING
>
> You should fix the ERROR first.  It's saying that the `pdflatex` program
> isn't being found.  Since you say you've installed MikTeX, that probably
> means that it isn't on the system path.  You need to do 2 things:
>
> 1.  Find out where pdflatex.exe is on your system.
> 2.  Make sure its directory is on the PATH that R sees.
>
> You do step 1 using Windows search tools.  For step 2, use
> Sys.getenv("PATH") in R to see the current path.
>
> If you found pdflatex.exe in C:\Miktex\bin\pdflatex.exe then you'd need
> to add "C:\Miktex\bin" to your path.  You can do this temporarily within
> R using
>
>      Sys.setenv(PATH = paste0(Sys.getenv("PATH"), ";C:\\Miktex\\bin")
>
> but this will only last for the current session.  To add it permanently,
> you'll need to use some Windows configuration tools.
>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From berryboe@@enkoo| @end|ng |rom hotm@||@com  Tue Jan 25 08:24:09 2022
From: berryboe@@enkoo| @end|ng |rom hotm@||@com (Berry Boessenkool)
Date: Tue, 25 Jan 2022 07:24:09 +0000
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
In-Reply-To: <CAFL8AHqM09+ZEj4zgCuKfw1VOYkT_RPY6XJC4m-Lg-QO33snWg@mail.gmail.com>
References: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
 <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>
 <CAFL8AHqM09+ZEj4zgCuKfw1VOYkT_RPY6XJC4m-Lg-QO33snWg@mail.gmail.com>
Message-ID: <DB9P193MB15635A6AA6AA44403D6E5AA5D55F9@DB9P193MB1563.EURP193.PROD.OUTLOOK.COM>


> to add "C:\Miktex\bin" to your path.  You can do this temporarily within

a last thing I'd like to add to this:
You can change the path as perceived by R permantly with this:
writeLines('PATH="C:\\Miktex\\bin;${PATH}"', con = "~/.Renviron")
Not sure if this is good practice, but it works for unzip, see https://bookdown.org/brry/rdwd/fread.html

Regards,
Berry

________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Oliver Madsen <oliver.p.madsen at gmail.com>
Sent: Monday, January 24, 2022 17:30
To: Duncan Murdoch <murdoch.duncan at gmail.com>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] LaTeX errors when creating PDF version, Error in texi2dvi

For windows simply search "environment variable" which will allow you to
open the environment variable gui. In thete append the folder to the
pdfmatex executable under user variables, and then it should be found by R
after restarting the session.

/Oli er

On Mon, 24 Jan 2022, 13:50 Duncan Murdoch, <murdoch.duncan at gmail.com> wrote:

> On 24/01/2022 5:58 a.m., Anthony Hammond wrote:
> > Hello,
> >
> > Since updating to the current version of R (4.1.2) I can't seem to pass
> the

> > installing and linking MikTex, which I've done. Another suggests I need
> the
> > function texi2dvi(), which is available in the tools package. So I'm not
> > sure what to do. Any assistance would be appreciated
> >
> > Thank you
> > Anthony
> >
> > checking PDF version of manual ... WARNING
> > LaTeX errors when creating PDF version.
> > This typically indicates Rd problems.
> > * checking PDF version of manual without hyperrefs or index ... ERROR
> > Re-running with no redirection of stdout/stderr.
> > Hmm ... looks like a package
> > You may want to clean up by 'rm -Rf
> > C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in running tools::texi2pdf()
> > * DONE
> > Status: 1 ERROR, 1 WARNING
>
> You should fix the ERROR first.  It's saying that the `pdflatex` program
> isn't being found.  Since you say you've installed MikTeX, that probably
> means that it isn't on the system path.  You need to do 2 things:
>
> 1.  Find out where pdflatex.exe is on your system.
> 2.  Make sure its directory is on the PATH that R sees.
>

> Sys.getenv("PATH") in R to see the current path.
>
> If you found pdflatex.exe in C:\Miktex\bin\pdflatex.exe then you'd need
> to add "C:\Miktex\bin" to your path.  You can do this temporarily within
> R using
>
>      Sys.setenv(PATH = paste0(Sys.getenv("PATH"), ";C:\\Miktex\\bin")
>
> but this will only last for the current session.  To add it permanently,

>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From @|ex@ndru@vod@ @end|ng |rom @eh@ox@@c@uk  Tue Jan 25 01:02:38 2022
From: @|ex@ndru@vod@ @end|ng |rom @eh@ox@@c@uk (Alexandru Voda)
Date: Tue, 25 Jan 2022 00:02:38 +0000
Subject: [R-pkg-devel] Question on best approach to develop R package that
 wraps old complex Python2 software
Message-ID: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>

Hi!

How would one best write an R wrapper package over a complex Python2 software (such as https://github.com/bulik/ldsc), that is still very widely used in statistical genetics?

I'm writting an R package (that currently passes all --as-cran checks) for multiple other C++ softwares on the same topic as the one above, but this Python2 one I've difficulties with - it just looks like a bunch of hackish system() calls... And while it works on Linux and Mac, I've no idea whether it'd work on Windows.

While it may seem easy to dismiss, actually LDSC is widely used in the statistical genetics field, and lots of people find it difficult to work with because of all the dependency files and weirdly documented commands, and because... well... Python2...

Any tips? Or do you know anyone that I should contact/ask?

Best wishes,
Alexandru

	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Tue Jan 25 16:27:05 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Tue, 25 Jan 2022 10:27:05 -0500
Subject: [R-pkg-devel] 
 Question on best approach to develop R package that
 wraps old complex Python2 software
In-Reply-To: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
References: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>

I would suggest the reticulate library in R. The few most important for
your case are reticulate::use_python_version and reticulate::import.
For example, in your R package, you should start with:


# change this to the name of the module you need
numpy <- NULL


.onLoad <- function (libname, pkgname)
{
    reticulate::use_python_version("2.7")  # change this as you need to


    # .onLoad happens before the namespace is locked, so this is legitimate
    numpy <<- reticulate::import("numpy", delay_load = list(
        on_error = function(c) stop(
            "unable to import 'numpy', try ",
            sQuote("reticulate::py_install(\"numpy\")"),
            " if it is not installed:\n  ",
            conditionMessage(c)
        )
    ))
}


when your package's namespace is loaded, this will load the version of
python you need to use, and will lazy-import the module you need for your
python session.

On Tue, Jan 25, 2022 at 8:52 AM Alexandru Voda <alexandru.voda at seh.ox.ac.uk>
wrote:

> Hi!
>
> How would one best write an R wrapper package over a complex Python2
> software (such as https://github.com/bulik/ldsc), that is still very
> widely used in statistical genetics?
>
> I'm writting an R package (that currently passes all --as-cran checks) for
> multiple other C++ softwares on the same topic as the one above, but this
> Python2 one I've difficulties with - it just looks like a bunch of hackish
> system() calls... And while it works on Linux and Mac, I've no idea whether
> it'd work on Windows.
>
> While it may seem easy to dismiss, actually LDSC is widely used in the
> statistical genetics field, and lots of people find it difficult to work
> with because of all the dependency files and weirdly documented commands,
> and because... well... Python2...
>
> Any tips? Or do you know anyone that I should contact/ask?
>
> Best wishes,
> Alexandru
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @me @end|ng |rom |y@|k@com  Tue Jan 25 17:45:02 2022
From: @me @end|ng |rom |y@|k@com (=?UTF-8?Q?Stefan_McKinnon_H=C3=B8j=2DEdwards?=)
Date: Tue, 25 Jan 2022 17:45:02 +0100
Subject: [R-pkg-devel] 
 Question on best approach to develop R package that
 wraps old complex Python2 software
In-Reply-To: <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>
References: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
 <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>
Message-ID: <CAHJFP8TgOCEtLHaid-vMSXQymamCjgvOk7uWv0gUJLur3JjAew@mail.gmail.com>

If the Python2 package is mainly system() calls, I would write an R package
that essentially did the same, without relaying calls via the Python
routines. I.e. let R call the commands directly.

The only downside to this approach, is that R doesn't handle multithreading
as well as Python does. In Python, you have the subcommand (subprocess?)
module, I believe, with which you can call an external command and send it
input, check its output, send new input, or just leave it be, until you
want to check in on your subcommand. But to my knowledge, no similar method
exists in R.
Which brings us to the point: for how long do these external commands run?
Regardless of module used in Python or directly called from R, the R
process will wait. Mostly an issue for interactive uses.

Another approach could be to have your R package handle data formatting,
setup settings etc. and compiling a command with arguments, that the user
may call at their leisure, whether on their laptop, cloud or HPC. When
results have been factualised, they can return to your package to analyse
the results.
I used this approach for my badly named R package Siccuracy, for aiding
with the imputation software AlphaImpute.

Kindly,
Stefan

tir. 25. jan. 2022 16.27 skrev Andrew Simmons <akwsimmo at gmail.com>:

> I would suggest the reticulate library in R. The few most important for
> your case are reticulate::use_python_version and reticulate::import.
> For example, in your R package, you should start with:
>
>
> # change this to the name of the module you need
> numpy <- NULL
>
>
> .onLoad <- function (libname, pkgname)
> {
>     reticulate::use_python_version("2.7")  # change this as you need to
>
>
>     # .onLoad happens before the namespace is locked, so this is legitimate
>     numpy <<- reticulate::import("numpy", delay_load = list(
>         on_error = function(c) stop(
>             "unable to import 'numpy', try ",
>             sQuote("reticulate::py_install(\"numpy\")"),
>             " if it is not installed:\n  ",
>             conditionMessage(c)
>         )
>     ))
> }
>
>
> when your package's namespace is loaded, this will load the version of
> python you need to use, and will lazy-import the module you need for your
> python session.
>
> On Tue, Jan 25, 2022 at 8:52 AM Alexandru Voda <
> alexandru.voda at seh.ox.ac.uk>
> wrote:
>
> > Hi!
> >
> > How would one best write an R wrapper package over a complex Python2
> > software (such as https://github.com/bulik/ldsc), that is still very
> > widely used in statistical genetics?
> >
> > I'm writting an R package (that currently passes all --as-cran checks)
> for
> > multiple other C++ softwares on the same topic as the one above, but this
> > Python2 one I've difficulties with - it just looks like a bunch of
> hackish
> > system() calls... And while it works on Linux and Mac, I've no idea
> whether
> > it'd work on Windows.
> >
> > While it may seem easy to dismiss, actually LDSC is widely used in the
> > statistical genetics field, and lots of people find it difficult to work
> > with because of all the dependency files and weirdly documented commands,
> > and because... well... Python2...
> >
> > Any tips? Or do you know anyone that I should contact/ask?
> >
> > Best wishes,
> > Alexandru
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Tue Jan 25 21:12:07 2022
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Tue, 25 Jan 2022 15:12:07 -0500 (EST)
Subject: [R-pkg-devel] 
 Question on best approach to develop R package that
 wraps old complex Python2 software
In-Reply-To: <CAHJFP8TgOCEtLHaid-vMSXQymamCjgvOk7uWv0gUJLur3JjAew@mail.gmail.com>
References: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
 <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>
 <CAHJFP8TgOCEtLHaid-vMSXQymamCjgvOk7uWv0gUJLur3JjAew@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2201251508330.2405@iridium>



On Tue, 25 Jan 2022, Stefan McKinnon H?j-Edwards wrote:

> If the Python2 package is mainly system() calls, I would write an R package
> that essentially did the same, without relaying calls via the Python
> routines. I.e. let R call the commands directly.
>
> The only downside to this approach, is that R doesn't handle multithreading
> as well as Python does. In Python, you have the subcommand (subprocess?)
> module, I believe, with which you can call an external command and send it
> input, check its output, send new input, or just leave it be, until you
> want to check in on your subcommand. But to my knowledge, no similar method
> exists in R.

In R, you can use Tcl (tcltk) to do the same, which actually works better 
than Python.

The problem with python is that last time I checked there were three 
different interfaces for process control and none of the them were 
complete - it was impossible to reliably control a third-party program, 
while performing other tasks.

In contrast, Tcl has a well-designed interface that you can use in 
non-blocking mode.

best

Vladimir Dergachev

> Which brings us to the point: for how long do these external commands run?
> Regardless of module used in Python or directly called from R, the R
> process will wait. Mostly an issue for interactive uses.
>
> Another approach could be to have your R package handle data formatting,
> setup settings etc. and compiling a command with arguments, that the user
> may call at their leisure, whether on their laptop, cloud or HPC. When
> results have been factualised, they can return to your package to analyse
> the results.
> I used this approach for my badly named R package Siccuracy, for aiding
> with the imputation software AlphaImpute.
>
> Kindly,
> Stefan
>
> tir. 25. jan. 2022 16.27 skrev Andrew Simmons <akwsimmo at gmail.com>:
>
>> I would suggest the reticulate library in R. The few most important for
>> your case are reticulate::use_python_version and reticulate::import.
>> For example, in your R package, you should start with:
>>
>>
>> # change this to the name of the module you need
>> numpy <- NULL
>>
>>
>> .onLoad <- function (libname, pkgname)
>> {
>>     reticulate::use_python_version("2.7")  # change this as you need to
>>
>>
>>     # .onLoad happens before the namespace is locked, so this is legitimate
>>     numpy <<- reticulate::import("numpy", delay_load = list(
>>         on_error = function(c) stop(
>>             "unable to import 'numpy', try ",
>>             sQuote("reticulate::py_install(\"numpy\")"),
>>             " if it is not installed:\n  ",
>>             conditionMessage(c)
>>         )
>>     ))
>> }
>>
>>
>> when your package's namespace is loaded, this will load the version of
>> python you need to use, and will lazy-import the module you need for your
>> python session.
>>
>> On Tue, Jan 25, 2022 at 8:52 AM Alexandru Voda <
>> alexandru.voda at seh.ox.ac.uk>
>> wrote:
>>
>>> Hi!
>>>
>>> How would one best write an R wrapper package over a complex Python2
>>> software (such as https://github.com/bulik/ldsc), that is still very
>>> widely used in statistical genetics?
>>>
>>> I'm writting an R package (that currently passes all --as-cran checks)
>> for
>>> multiple other C++ softwares on the same topic as the one above, but this
>>> Python2 one I've difficulties with - it just looks like a bunch of
>> hackish
>>> system() calls... And while it works on Linux and Mac, I've no idea
>> whether
>>> it'd work on Windows.
>>>
>>> While it may seem easy to dismiss, actually LDSC is widely used in the
>>> statistical genetics field, and lots of people find it difficult to work
>>> with because of all the dependency files and weirdly documented commands,
>>> and because... well... Python2...
>>>
>>> Any tips? Or do you know anyone that I should contact/ask?
>>>
>>> Best wishes,
>>> Alexandru
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jan 26 15:20:16 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 26 Jan 2022 15:20:16 +0100
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
Message-ID: <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>

Hi Yutani,

if you haven't done that already, I would recommend building R with 
debug symbols (DEBUG=T, so that make file don't strip them) and with -O0 
(no optimizations), so that the debug symbols are more accurate. Without 
that, the stack traces can be very misleading. You might try both with 
windbg and gdb, sometimes one of them provides an extra hint. Ideally 
you would also build the involved package(s) the same way.

Then, it is important to check where the free() is called from, whether 
it is directly or from the GC. In both cases (but more likely in the 
latter), it could be caused by somewhat unrelated memory corruption, 
which may be hard to find - e.g. possibly a PROTECT error. Running with 
gctorture() might help, if gctorture() changes where the crash happens, 
it is more likely a somewhat unrelated memory corruption.

If it were a double-free or similar allocation error inside R itself (or 
some of the involved packages), it would be easy to find with a debugger.

If debugging this way does not help, you can try narrowing down the 
example, while preserving the crash. That may make debugging easier, and 
if you eventually get to a point that you have a reproducible example 
involving only base R and base packages, you know it is a bug in R, and 
can submit that in a bug report for others to debug.

Best
Tomas

On 1/22/22 10:50, Hiroaki Yutani wrote:
> Hi,
>
> I'm trying to create a Rust library that can implement an R graphic
> device[1], but the R session crashes on `dev.off()` on Windows with R
> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> on Windows with R-devel.
>
> Looking at the stack trace below by WinDbg, the problem is probably
> that either of the two free()s in GEdestroyDevDesc() tries to free
> some memory that was already freed (I'm a very beginner of this kind
> of debugging, so I might be wrong).
>
>      # Child-SP          RetAddr               Call Site
>      00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
>      01 00000000`0441cbc0 00007ffb`3df14c82
> ntdll!RtlReportCriticalFailure+0x97
>      ...snip...
>      08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
>      09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
>      0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
>      0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
>      0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
>      ...snip...
>
> But, I found no difference in the related code (around devoff() and
> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> lot of feature additions in R-devel, but I don't think it affects
> here. Is there anyone who suffered from similar crashes? Am I missing
> something?
>
> I would appreciate any advice.
>
> Best,
> Yutani
>
> [1]: https://github.com/extendr/extendr/pull/360
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Wed Jan 26 15:44:18 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Wed, 26 Jan 2022 23:44:18 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
Message-ID: <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>

Hi Tomas,

Thanks for your helpful advice. This time, it seems the cause of the
error was an allocator mismatch; I mistakenly allocated the struct on
Rust's side, which means it's allocated by Rust's allocator, but a
`DevDesc` is to be freed on R's side. The problem is solved by using
libc::calloc(), which allocates using the C runtime's allocator, and
compiling it with the same toolchain that compiles R.

I also saw some errors when it relates to GC, so it might be some
PROTECT issue. Thanks for the hint.

During debugging, I learned a lot about how to build R with DEBUG=T
and use gdb, and it really helped me. I'm yet to unlock the power of
WinDBG, but I will try next time...

Best,
Yutani

2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:

>
> Hi Yutani,
>
> if you haven't done that already, I would recommend building R with
> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
> (no optimizations), so that the debug symbols are more accurate. Without
> that, the stack traces can be very misleading. You might try both with
> windbg and gdb, sometimes one of them provides an extra hint. Ideally
> you would also build the involved package(s) the same way.
>
> Then, it is important to check where the free() is called from, whether
> it is directly or from the GC. In both cases (but more likely in the
> latter), it could be caused by somewhat unrelated memory corruption,
> which may be hard to find - e.g. possibly a PROTECT error. Running with
> gctorture() might help, if gctorture() changes where the crash happens,
> it is more likely a somewhat unrelated memory corruption.
>
> If it were a double-free or similar allocation error inside R itself (or
> some of the involved packages), it would be easy to find with a debugger.
>
> If debugging this way does not help, you can try narrowing down the
> example, while preserving the crash. That may make debugging easier, and
> if you eventually get to a point that you have a reproducible example
> involving only base R and base packages, you know it is a bug in R, and
> can submit that in a bug report for others to debug.
>
> Best
> Tomas
>
> On 1/22/22 10:50, Hiroaki Yutani wrote:
> > Hi,
> >
> > I'm trying to create a Rust library that can implement an R graphic
> > device[1], but the R session crashes on `dev.off()` on Windows with R
> > 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> > on Windows with R-devel.
> >
> > Looking at the stack trace below by WinDbg, the problem is probably
> > that either of the two free()s in GEdestroyDevDesc() tries to free
> > some memory that was already freed (I'm a very beginner of this kind
> > of debugging, so I might be wrong).
> >
> >      # Child-SP          RetAddr               Call Site
> >      00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
> >      01 00000000`0441cbc0 00007ffb`3df14c82
> > ntdll!RtlReportCriticalFailure+0x97
> >      ...snip...
> >      08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
> >      09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
> >      0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
> >      0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
> >      0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
> >      ...snip...
> >
> > But, I found no difference in the related code (around devoff() and
> > GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> > lot of feature additions in R-devel, but I don't think it affects
> > here. Is there anyone who suffered from similar crashes? Am I missing
> > something?
> >
> > I would appreciate any advice.
> >
> > Best,
> > Yutani
> >
> > [1]: https://github.com/extendr/extendr/pull/360
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jan 26 16:21:17 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 26 Jan 2022 16:21:17 +0100
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
Message-ID: <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>


On 1/26/22 15:44, Hiroaki Yutani wrote:
> Hi Tomas,
>
> Thanks for your helpful advice. This time, it seems the cause of the
> error was an allocator mismatch; I mistakenly allocated the struct on
> Rust's side, which means it's allocated by Rust's allocator, but a
> `DevDesc` is to be freed on R's side. The problem is solved by using
> libc::calloc(), which allocates using the C runtime's allocator, and
> compiling it with the same toolchain that compiles R.

Hi Yutani,

congratulations on tracing it down.

Particularly on Windows, whenever a DLL (or any API) is providing a 
function to allocate anything, it should provide also a function to free 
it, and only that function should be used to do so, even if it is just a 
wrapper for malloc() etc. So I would recommend following that, there 
should be a Rust allocator's "free" function which you could then call 
from R.

Best
Tomas

>
> I also saw some errors when it relates to GC, so it might be some
> PROTECT issue. Thanks for the hint.
>
> During debugging, I learned a lot about how to build R with DEBUG=T
> and use gdb, and it really helped me. I'm yet to unlock the power of
> WinDBG, but I will try next time...
>
> Best,
> Yutani
>
> 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
>
>> Hi Yutani,
>>
>> if you haven't done that already, I would recommend building R with
>> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
>> (no optimizations), so that the debug symbols are more accurate. Without
>> that, the stack traces can be very misleading. You might try both with
>> windbg and gdb, sometimes one of them provides an extra hint. Ideally
>> you would also build the involved package(s) the same way.
>>
>> Then, it is important to check where the free() is called from, whether
>> it is directly or from the GC. In both cases (but more likely in the
>> latter), it could be caused by somewhat unrelated memory corruption,
>> which may be hard to find - e.g. possibly a PROTECT error. Running with
>> gctorture() might help, if gctorture() changes where the crash happens,
>> it is more likely a somewhat unrelated memory corruption.
>>
>> If it were a double-free or similar allocation error inside R itself (or
>> some of the involved packages), it would be easy to find with a debugger.
>>
>> If debugging this way does not help, you can try narrowing down the
>> example, while preserving the crash. That may make debugging easier, and
>> if you eventually get to a point that you have a reproducible example
>> involving only base R and base packages, you know it is a bug in R, and
>> can submit that in a bug report for others to debug.
>>
>> Best
>> Tomas
>>
>> On 1/22/22 10:50, Hiroaki Yutani wrote:
>>> Hi,
>>>
>>> I'm trying to create a Rust library that can implement an R graphic
>>> device[1], but the R session crashes on `dev.off()` on Windows with R
>>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
>>> on Windows with R-devel.
>>>
>>> Looking at the stack trace below by WinDbg, the problem is probably
>>> that either of the two free()s in GEdestroyDevDesc() tries to free
>>> some memory that was already freed (I'm a very beginner of this kind
>>> of debugging, so I might be wrong).
>>>
>>>       # Child-SP          RetAddr               Call Site
>>>       00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
>>>       01 00000000`0441cbc0 00007ffb`3df14c82
>>> ntdll!RtlReportCriticalFailure+0x97
>>>       ...snip...
>>>       08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
>>>       09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
>>>       0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
>>>       0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
>>>       0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
>>>       ...snip...
>>>
>>> But, I found no difference in the related code (around devoff() and
>>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
>>> lot of feature additions in R-devel, but I don't think it affects
>>> here. Is there anyone who suffered from similar crashes? Am I missing
>>> something?
>>>
>>> I would appreciate any advice.
>>>
>>> Best,
>>> Yutani
>>>
>>> [1]: https://github.com/extendr/extendr/pull/360
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Wed Jan 26 16:42:37 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Thu, 27 Jan 2022 00:42:37 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
 <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
Message-ID: <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>

Hi Tomas,

Thanks, but, if I understand correctly, there's no room to call the
Rust allocator's "free" function in the case of `DevDesc`. A `DevDesc`
is supposed to be freed in `GEdestroyDevDesc()` when the device is
closed. If I free it by myself, it would cause double-free.

So, now I'm wondering if it makes sense that R provides either an API
that creates a `DevDesc` instance, or one that accepts a custom
allocator for DevDesc. But, as I expect this is a minor use case, I'm
not confident enough this would be meaningful.
I might end up filing such a feature request on Bugzilla, but let me
hold off for a while.

Best,
Yutani

2022?1?27?(?) 0:21 Tomas Kalibera <tomas.kalibera at gmail.com>:
>
>
> On 1/26/22 15:44, Hiroaki Yutani wrote:
> > Hi Tomas,
> >
> > Thanks for your helpful advice. This time, it seems the cause of the
> > error was an allocator mismatch; I mistakenly allocated the struct on
> > Rust's side, which means it's allocated by Rust's allocator, but a
> > `DevDesc` is to be freed on R's side. The problem is solved by using
> > libc::calloc(), which allocates using the C runtime's allocator, and
> > compiling it with the same toolchain that compiles R.
>
> Hi Yutani,
>
> congratulations on tracing it down.
>
> Particularly on Windows, whenever a DLL (or any API) is providing a
> function to allocate anything, it should provide also a function to free
> it, and only that function should be used to do so, even if it is just a
> wrapper for malloc() etc. So I would recommend following that, there
> should be a Rust allocator's "free" function which you could then call
> from R.
>
> Best
> Tomas
>
> >
> > I also saw some errors when it relates to GC, so it might be some
> > PROTECT issue. Thanks for the hint.
> >
> > During debugging, I learned a lot about how to build R with DEBUG=T
> > and use gdb, and it really helped me. I'm yet to unlock the power of
> > WinDBG, but I will try next time...
> >
> > Best,
> > Yutani
> >
> > 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
> >
> >> Hi Yutani,
> >>
> >> if you haven't done that already, I would recommend building R with
> >> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
> >> (no optimizations), so that the debug symbols are more accurate. Without
> >> that, the stack traces can be very misleading. You might try both with
> >> windbg and gdb, sometimes one of them provides an extra hint. Ideally
> >> you would also build the involved package(s) the same way.
> >>
> >> Then, it is important to check where the free() is called from, whether
> >> it is directly or from the GC. In both cases (but more likely in the
> >> latter), it could be caused by somewhat unrelated memory corruption,
> >> which may be hard to find - e.g. possibly a PROTECT error. Running with
> >> gctorture() might help, if gctorture() changes where the crash happens,
> >> it is more likely a somewhat unrelated memory corruption.
> >>
> >> If it were a double-free or similar allocation error inside R itself (or
> >> some of the involved packages), it would be easy to find with a debugger.
> >>
> >> If debugging this way does not help, you can try narrowing down the
> >> example, while preserving the crash. That may make debugging easier, and
> >> if you eventually get to a point that you have a reproducible example
> >> involving only base R and base packages, you know it is a bug in R, and
> >> can submit that in a bug report for others to debug.
> >>
> >> Best
> >> Tomas
> >>
> >> On 1/22/22 10:50, Hiroaki Yutani wrote:
> >>> Hi,
> >>>
> >>> I'm trying to create a Rust library that can implement an R graphic
> >>> device[1], but the R session crashes on `dev.off()` on Windows with R
> >>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> >>> on Windows with R-devel.
> >>>
> >>> Looking at the stack trace below by WinDbg, the problem is probably
> >>> that either of the two free()s in GEdestroyDevDesc() tries to free
> >>> some memory that was already freed (I'm a very beginner of this kind
> >>> of debugging, so I might be wrong).
> >>>
> >>>       # Child-SP          RetAddr               Call Site
> >>>       00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
> >>>       01 00000000`0441cbc0 00007ffb`3df14c82
> >>> ntdll!RtlReportCriticalFailure+0x97
> >>>       ...snip...
> >>>       08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
> >>>       09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
> >>>       0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
> >>>       0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
> >>>       0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
> >>>       ...snip...
> >>>
> >>> But, I found no difference in the related code (around devoff() and
> >>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> >>> lot of feature additions in R-devel, but I don't think it affects
> >>> here. Is there anyone who suffered from similar crashes? Am I missing
> >>> something?
> >>>
> >>> I would appreciate any advice.
> >>>
> >>> Best,
> >>> Yutani
> >>>
> >>> [1]: https://github.com/extendr/extendr/pull/360
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jan 26 17:35:44 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 26 Jan 2022 17:35:44 +0100
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
 <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
 <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>
Message-ID: <a57fcbdf-b97f-28c4-3051-0a3e29afec76@gmail.com>

Hi Yutani,

On 1/26/22 16:42, Hiroaki Yutani wrote:
> Hi Tomas,
>
> Thanks, but, if I understand correctly, there's no room to call the
> Rust allocator's "free" function in the case of `DevDesc`. A `DevDesc`
> is supposed to be freed in `GEdestroyDevDesc()` when the device is
> closed. If I free it by myself, it would cause double-free.
>
> So, now I'm wondering if it makes sense that R provides either an API
> that creates a `DevDesc` instance, or one that accepts a custom
> allocator for DevDesc. But, as I expect this is a minor use case, I'm
> not confident enough this would be meaningful.
> I might end up filing such a feature request on Bugzilla, but let me
> hold off for a while.

I see. If you are using the public interface and it allows you to 
(indirectly) free the devices, it should allow you also to allocate 
them. So yes, please file a bug report and please provide enough context 
there so that the report is self-sufficient.

Beyond the general rule than any API allowing to allocate or free needs 
to allow both, I'd leave this to the experts on graphics in R.

Thanks,
Tomas

>
> Best,
> Yutani
>
> 2022?1?27?(?) 0:21 Tomas Kalibera <tomas.kalibera at gmail.com>:
>>
>> On 1/26/22 15:44, Hiroaki Yutani wrote:
>>> Hi Tomas,
>>>
>>> Thanks for your helpful advice. This time, it seems the cause of the
>>> error was an allocator mismatch; I mistakenly allocated the struct on
>>> Rust's side, which means it's allocated by Rust's allocator, but a
>>> `DevDesc` is to be freed on R's side. The problem is solved by using
>>> libc::calloc(), which allocates using the C runtime's allocator, and
>>> compiling it with the same toolchain that compiles R.
>> Hi Yutani,
>>
>> congratulations on tracing it down.
>>
>> Particularly on Windows, whenever a DLL (or any API) is providing a
>> function to allocate anything, it should provide also a function to free
>> it, and only that function should be used to do so, even if it is just a
>> wrapper for malloc() etc. So I would recommend following that, there
>> should be a Rust allocator's "free" function which you could then call
>> from R.
>>
>> Best
>> Tomas
>>
>>> I also saw some errors when it relates to GC, so it might be some
>>> PROTECT issue. Thanks for the hint.
>>>
>>> During debugging, I learned a lot about how to build R with DEBUG=T
>>> and use gdb, and it really helped me. I'm yet to unlock the power of
>>> WinDBG, but I will try next time...
>>>
>>> Best,
>>> Yutani
>>>
>>> 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
>>>
>>>> Hi Yutani,
>>>>
>>>> if you haven't done that already, I would recommend building R with
>>>> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
>>>> (no optimizations), so that the debug symbols are more accurate. Without
>>>> that, the stack traces can be very misleading. You might try both with
>>>> windbg and gdb, sometimes one of them provides an extra hint. Ideally
>>>> you would also build the involved package(s) the same way.
>>>>
>>>> Then, it is important to check where the free() is called from, whether
>>>> it is directly or from the GC. In both cases (but more likely in the
>>>> latter), it could be caused by somewhat unrelated memory corruption,
>>>> which may be hard to find - e.g. possibly a PROTECT error. Running with
>>>> gctorture() might help, if gctorture() changes where the crash happens,
>>>> it is more likely a somewhat unrelated memory corruption.
>>>>
>>>> If it were a double-free or similar allocation error inside R itself (or
>>>> some of the involved packages), it would be easy to find with a debugger.
>>>>
>>>> If debugging this way does not help, you can try narrowing down the
>>>> example, while preserving the crash. That may make debugging easier, and
>>>> if you eventually get to a point that you have a reproducible example
>>>> involving only base R and base packages, you know it is a bug in R, and
>>>> can submit that in a bug report for others to debug.
>>>>
>>>> Best
>>>> Tomas
>>>>
>>>> On 1/22/22 10:50, Hiroaki Yutani wrote:
>>>>> Hi,
>>>>>
>>>>> I'm trying to create a Rust library that can implement an R graphic
>>>>> device[1], but the R session crashes on `dev.off()` on Windows with R
>>>>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
>>>>> on Windows with R-devel.
>>>>>
>>>>> Looking at the stack trace below by WinDbg, the problem is probably
>>>>> that either of the two free()s in GEdestroyDevDesc() tries to free
>>>>> some memory that was already freed (I'm a very beginner of this kind
>>>>> of debugging, so I might be wrong).
>>>>>
>>>>>        # Child-SP          RetAddr               Call Site
>>>>>        00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
>>>>>        01 00000000`0441cbc0 00007ffb`3df14c82
>>>>> ntdll!RtlReportCriticalFailure+0x97
>>>>>        ...snip...
>>>>>        08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
>>>>>        09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
>>>>>        0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
>>>>>        0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
>>>>>        0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
>>>>>        ...snip...
>>>>>
>>>>> But, I found no difference in the related code (around devoff() and
>>>>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
>>>>> lot of feature additions in R-devel, but I don't think it affects
>>>>> here. Is there anyone who suffered from similar crashes? Am I missing
>>>>> something?
>>>>>
>>>>> I would appreciate any advice.
>>>>>
>>>>> Best,
>>>>> Yutani
>>>>>
>>>>> [1]: https://github.com/extendr/extendr/pull/360
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Thu Jan 27 00:55:48 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Thu, 27 Jan 2022 08:55:48 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <a57fcbdf-b97f-28c4-3051-0a3e29afec76@gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
 <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
 <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>
 <a57fcbdf-b97f-28c4-3051-0a3e29afec76@gmail.com>
Message-ID: <CALyqOb8c41vV_uHPPzAqtRnLWxr6BTGnY60ZYkyxeJhfjf-3QQ@mail.gmail.com>

I see, thanks. I filed here:

https://bugs.r-project.org/show_bug.cgi?id=18292

Best,
Yutani

2022?1?27?(?) 1:35 Tomas Kalibera <tomas.kalibera at gmail.com>:
>
> Hi Yutani,
>
> On 1/26/22 16:42, Hiroaki Yutani wrote:
> > Hi Tomas,
> >
> > Thanks, but, if I understand correctly, there's no room to call the
> > Rust allocator's "free" function in the case of `DevDesc`. A `DevDesc`
> > is supposed to be freed in `GEdestroyDevDesc()` when the device is
> > closed. If I free it by myself, it would cause double-free.
> >
> > So, now I'm wondering if it makes sense that R provides either an API
> > that creates a `DevDesc` instance, or one that accepts a custom
> > allocator for DevDesc. But, as I expect this is a minor use case, I'm
> > not confident enough this would be meaningful.
> > I might end up filing such a feature request on Bugzilla, but let me
> > hold off for a while.
>
> I see. If you are using the public interface and it allows you to
> (indirectly) free the devices, it should allow you also to allocate
> them. So yes, please file a bug report and please provide enough context
> there so that the report is self-sufficient.
>
> Beyond the general rule than any API allowing to allocate or free needs
> to allow both, I'd leave this to the experts on graphics in R.
>
> Thanks,
> Tomas
>
> >
> > Best,
> > Yutani
> >
> > 2022?1?27?(?) 0:21 Tomas Kalibera <tomas.kalibera at gmail.com>:
> >>
> >> On 1/26/22 15:44, Hiroaki Yutani wrote:
> >>> Hi Tomas,
> >>>
> >>> Thanks for your helpful advice. This time, it seems the cause of the
> >>> error was an allocator mismatch; I mistakenly allocated the struct on
> >>> Rust's side, which means it's allocated by Rust's allocator, but a
> >>> `DevDesc` is to be freed on R's side. The problem is solved by using
> >>> libc::calloc(), which allocates using the C runtime's allocator, and
> >>> compiling it with the same toolchain that compiles R.
> >> Hi Yutani,
> >>
> >> congratulations on tracing it down.
> >>
> >> Particularly on Windows, whenever a DLL (or any API) is providing a
> >> function to allocate anything, it should provide also a function to free
> >> it, and only that function should be used to do so, even if it is just a
> >> wrapper for malloc() etc. So I would recommend following that, there
> >> should be a Rust allocator's "free" function which you could then call
> >> from R.
> >>
> >> Best
> >> Tomas
> >>
> >>> I also saw some errors when it relates to GC, so it might be some
> >>> PROTECT issue. Thanks for the hint.
> >>>
> >>> During debugging, I learned a lot about how to build R with DEBUG=T
> >>> and use gdb, and it really helped me. I'm yet to unlock the power of
> >>> WinDBG, but I will try next time...
> >>>
> >>> Best,
> >>> Yutani
> >>>
> >>> 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
> >>>
> >>>> Hi Yutani,
> >>>>
> >>>> if you haven't done that already, I would recommend building R with
> >>>> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
> >>>> (no optimizations), so that the debug symbols are more accurate. Without
> >>>> that, the stack traces can be very misleading. You might try both with
> >>>> windbg and gdb, sometimes one of them provides an extra hint. Ideally
> >>>> you would also build the involved package(s) the same way.
> >>>>
> >>>> Then, it is important to check where the free() is called from, whether
> >>>> it is directly or from the GC. In both cases (but more likely in the
> >>>> latter), it could be caused by somewhat unrelated memory corruption,
> >>>> which may be hard to find - e.g. possibly a PROTECT error. Running with
> >>>> gctorture() might help, if gctorture() changes where the crash happens,
> >>>> it is more likely a somewhat unrelated memory corruption.
> >>>>
> >>>> If it were a double-free or similar allocation error inside R itself (or
> >>>> some of the involved packages), it would be easy to find with a debugger.
> >>>>
> >>>> If debugging this way does not help, you can try narrowing down the
> >>>> example, while preserving the crash. That may make debugging easier, and
> >>>> if you eventually get to a point that you have a reproducible example
> >>>> involving only base R and base packages, you know it is a bug in R, and
> >>>> can submit that in a bug report for others to debug.
> >>>>
> >>>> Best
> >>>> Tomas
> >>>>
> >>>> On 1/22/22 10:50, Hiroaki Yutani wrote:
> >>>>> Hi,
> >>>>>
> >>>>> I'm trying to create a Rust library that can implement an R graphic
> >>>>> device[1], but the R session crashes on `dev.off()` on Windows with R
> >>>>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> >>>>> on Windows with R-devel.
> >>>>>
> >>>>> Looking at the stack trace below by WinDbg, the problem is probably
> >>>>> that either of the two free()s in GEdestroyDevDesc() tries to free
> >>>>> some memory that was already freed (I'm a very beginner of this kind
> >>>>> of debugging, so I might be wrong).
> >>>>>
> >>>>>        # Child-SP          RetAddr               Call Site
> >>>>>        00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
> >>>>>        01 00000000`0441cbc0 00007ffb`3df14c82
> >>>>> ntdll!RtlReportCriticalFailure+0x97
> >>>>>        ...snip...
> >>>>>        08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
> >>>>>        09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
> >>>>>        0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
> >>>>>        0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
> >>>>>        0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
> >>>>>        ...snip...
> >>>>>
> >>>>> But, I found no difference in the related code (around devoff() and
> >>>>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> >>>>> lot of feature additions in R-devel, but I don't think it affects
> >>>>> here. Is there anyone who suffered from similar crashes? Am I missing
> >>>>> something?
> >>>>>
> >>>>> I would appreciate any advice.
> >>>>>
> >>>>> Best,
> >>>>> Yutani
> >>>>>
> >>>>> [1]: https://github.com/extendr/extendr/pull/360
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-package-devel at r-project.org mailing list
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 15:55:49 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 08:55:49 -0600
Subject: [R-pkg-devel] Is using global assignment in package tests allowed?
Message-ID: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>

Hello,

I'm writing unit tests using testthat for a package that we want to submit
to CRAN. Because of some aspect of how testthat works (which is beyond my
ken), I have only been able to get my tests to work by using global
assignment (<<-) to create some objects on which the tests are then run.
However, per CRAN policy: "Packages should not modify the global
environment (user?s workspace)."

Does anyone know whether this policy applies to all code within the
package, including unit tests? Or does it apply just to the code and
functions in /R?
Or to all code that is executed as part of checking the package (i.e., code
that is never run can use <<-)?

James

	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Thu Jan 27 16:20:57 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Thu, 27 Jan 2022 07:20:57 -0800
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
Message-ID: <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>

I don't know the answer to your question, but "beyond my ken" doesn't sound like a very convincing reason. Mucking with any environment that isn't yours is asking for trouble... the behavior you depend on today may come into conflict with the code you are coordinating with when you least expect it.

Is your code in a public version control repo?

On January 27, 2022 6:55:49 AM PST, James Pustejovsky <jepusto at gmail.com> wrote:
>Hello,
>
>I'm writing unit tests using testthat for a package that we want to submit
>to CRAN. Because of some aspect of how testthat works (which is beyond my
>ken), I have only been able to get my tests to work by using global
>assignment (<<-) to create some objects on which the tests are then run.
>However, per CRAN policy: "Packages should not modify the global
>environment (user?s workspace)."
>
>Does anyone know whether this policy applies to all code within the
>package, including unit tests? Or does it apply just to the code and
>functions in /R?
>Or to all code that is executed as part of checking the package (i.e., code
>that is never run can use <<-)?
>
>James
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Jan 27 16:26:59 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 27 Jan 2022 18:26:59 +0300
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
Message-ID: <20220127182659.12cc391c@Tarkus>

On Thu, 27 Jan 2022 08:55:49 -0600
James Pustejovsky <jepusto at gmail.com> wrote:

> Because of some aspect of how testthat works (which is beyond my
> ken), I have only been able to get my tests to work by using global
> assignment (<<-) to create some objects on which the tests are then
> run.

What are you trying to achieve? Perhaps there's a better way to do
that. I think that you can ask testthat-specific questions at
<https://community.rstudio.com/> if they turn out to be too far from
base R.

> Does anyone know whether this policy applies to all code within the
> package, including unit tests? Or does it apply just to the code and
> functions in /R?

I'm not a CRAN member, but I think that the spirit of the rule only
covers the user-accessible code, and tests aren't typically run in the
same R session where the user objects live. For the same reason, I
think that it's acceptable to test internal interfaces you don't want
to export by calling them by means of package:::function.

-- 
Best regards,
Ivan


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 16:28:58 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 09:28:58 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
Message-ID: <CAFUVuJyDaNeEQizLn5L8u6+x55=YkbKR2w-qxN88NXRPwFLaig@mail.gmail.com>

Thanks for your perspective. Re: "beyond my ken" I'm just being honest. My
operating assumption was that the unit testing code is run in its own
process and therefore that using global assignment would be okay (i.e., not
mucking with someone else's environment). But perhaps I'm being naive.

The package is on Github here: https://github.com/meghapsimatrix/wildmeta/
The tests that use global assignment are:
https://github.com/meghapsimatrix/wildmeta/blob/main/tests/testthat/test-rma-mv-methods.R
https://github.com/meghapsimatrix/wildmeta/blob/main/tests/testthat/test-missing-value-handling.R


On Thu, Jan 27, 2022 at 9:20 AM Jeff Newmiller <jdnewmil at dcn.davis.ca.us>
wrote:

> I don't know the answer to your question, but "beyond my ken" doesn't
> sound like a very convincing reason. Mucking with any environment that
> isn't yours is asking for trouble... the behavior you depend on today may
> come into conflict with the code you are coordinating with when you least
> expect it.
>
> Is your code in a public version control repo?
>
> On January 27, 2022 6:55:49 AM PST, James Pustejovsky <jepusto at gmail.com>
> wrote:
> >Hello,
> >
> >I'm writing unit tests using testthat for a package that we want to submit
> >to CRAN. Because of some aspect of how testthat works (which is beyond my
> >ken), I have only been able to get my tests to work by using global
> >assignment (<<-) to create some objects on which the tests are then run.
> >However, per CRAN policy: "Packages should not modify the global
> >environment (user?s workspace)."
> >
> >Does anyone know whether this policy applies to all code within the
> >package, including unit tests? Or does it apply just to the code and
> >functions in /R?
> >Or to all code that is executed as part of checking the package (i.e.,
> code
> >that is never run can use <<-)?
> >
> >James
> >
> >       [[alternative HTML version deleted]]
> >
> >______________________________________________
> >R-package-devel at r-project.org mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> Sent from my phone. Please excuse my brevity.
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Thu Jan 27 16:40:14 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 27 Jan 2022 09:40:14 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
Message-ID: <25074.48350.241616.702973@rob.eddelbuettel.com>


On 27 January 2022 at 07:20, Jeff Newmiller wrote:
| I don't know the answer to your question, but "beyond my ken" doesn't sound like a very convincing reason. Mucking with any environment that isn't yours is asking for trouble... the behavior you depend on today may come into conflict with the code you are coordinating with when you least expect it.

Right on.

Yes a number of packages (of mine and other people) use a different approach
to maintain 'global state' without ... using 'global variables' (== bad).

The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then also
set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <- "foo"`
which you can later test for, alter, ... at will.

All without running afould of what `R CMD check --as-cran` may hate, all the
while maintaining your logic flow.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 16:56:17 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 09:56:17 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <25074.48350.241616.702973@rob.eddelbuettel.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
Message-ID: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>

But I am not using global variables at all in the package code (in
/R)---only for unit testing. Is this distinction relevant? Or do I need to
avoid global assignment even in the unit tests?

On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
> | I don't know the answer to your question, but "beyond my ken" doesn't
> sound like a very convincing reason. Mucking with any environment that
> isn't yours is asking for trouble... the behavior you depend on today may
> come into conflict with the code you are coordinating with when you least
> expect it.
>
> Right on.
>
> Yes a number of packages (of mine and other people) use a different
> approach
> to maintain 'global state' without ... using 'global variables' (== bad).
>
> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
> also
> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
> "foo"`
> which you can later test for, alter, ... at will.
>
> All without running afould of what `R CMD check --as-cran` may hate, all
> the
> while maintaining your logic flow.
>
> Dirk
>
> --
> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 17:11:49 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 11:11:49 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
Message-ID: <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>

On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
> But I am not using global variables at all in the package code (in
> /R)---only for unit testing. Is this distinction relevant? Or do I need to
> avoid global assignment even in the unit tests?

CRAN may let you do what you are doing, but as Dirk and Jeff said, it 
could come back to bite you later.  For example, you may create a 
variable named foo containing extremely valuable data, and then run your 
test.  (Tests can be run outside of R CMD check.)  If your test stomps 
on foo, you'll lose all that data.

It's worth using some trick like Dirk's to avoid this possibility.

Duncan Murdoch
> 
> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>>
>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>> | I don't know the answer to your question, but "beyond my ken" doesn't
>> sound like a very convincing reason. Mucking with any environment that
>> isn't yours is asking for trouble... the behavior you depend on today may
>> come into conflict with the code you are coordinating with when you least
>> expect it.
>>
>> Right on.
>>
>> Yes a number of packages (of mine and other people) use a different
>> approach
>> to maintain 'global state' without ... using 'global variables' (== bad).
>>
>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>> also
>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>> "foo"`
>> which you can later test for, alter, ... at will.
>>
>> All without running afould of what `R CMD check --as-cran` may hate, all
>> the
>> while maintaining your logic flow.
>>
>> Dirk
>>
>> --
>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Thu Jan 27 17:18:28 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 27 Jan 2022 11:18:28 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
Message-ID: <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>

   I will chime in briefly.

   I have spent hours trying to understand the scoping behaviour of 
testthat, mostly without success. I have lots of examples where I have 
tests that fail *only* when running devtools::check(), but not when 
running test_that in an interactive session, or in the same code run via 
source() or in an R batch session.  So I am quite sympathetic to "beyond 
my ken".

   I agree that it's best to understand everything so that you can know 
when you might run into trouble in the future, but I have sometimes 
reconciled myself to giving up when it seemed I was spending much more 
time debugging my tests than debugging the actual package code ...

   For what it's worth, I have found that running <<- in these contexts 
doesn't seem to bother CRAN at all -- possibly because it's the *tests* 
that are potentially modifying the global environment, not the package 
itself.

   If you think about it, a prohibition on modifying the global 
environment in tests would mean that a plain old test file that assigned 
variables as part of testing flow would change the environment.

On 1/27/22 10:56 AM, James Pustejovsky wrote:
> But I am not using global variables at all in the package code (in
> /R)---only for unit testing. Is this distinction relevant? Or do I need to
> avoid global assignment even in the unit tests?
> 
> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>>
>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>> | I don't know the answer to your question, but "beyond my ken" doesn't
>> sound like a very convincing reason. Mucking with any environment that
>> isn't yours is asking for trouble... the behavior you depend on today may
>> come into conflict with the code you are coordinating with when you least
>> expect it.
>>
>> Right on.
>>
>> Yes a number of packages (of mine and other people) use a different
>> approach
>> to maintain 'global state' without ... using 'global variables' (== bad).
>>
>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>> also
>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>> "foo"`
>> which you can later test for, alter, ... at will.
>>
>> All without running afould of what `R CMD check --as-cran` may hate, all
>> the
>> while maintaining your logic flow.
>>
>> Dirk
>>
>> --
>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 17:24:54 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 10:24:54 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
Message-ID: <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>

I suppose, but this seems like kind of a far-fetched possibility if you're
following any sort of reasonable scripting/development practices. Why in
the world would someone be working with extremely valuable data and then
decide to run all my package's unit tests interactively in the same session?

In any case, it sounds like I should either just skip these unit tests or
try to figure out what the heck is causing my namespace problems with
testthat.

On Thu, Jan 27, 2022 at 10:11 AM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
> > But I am not using global variables at all in the package code (in
> > /R)---only for unit testing. Is this distinction relevant? Or do I need
> to
> > avoid global assignment even in the unit tests?
>
> CRAN may let you do what you are doing, but as Dirk and Jeff said, it
> could come back to bite you later.  For example, you may create a
> variable named foo containing extremely valuable data, and then run your
> test.  (Tests can be run outside of R CMD check.)  If your test stomps
> on foo, you'll lose all that data.
>
> It's worth using some trick like Dirk's to avoid this possibility.
>
> Duncan Murdoch
> >
> > On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org>
> wrote:
> >
> >>
> >> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
> >> | I don't know the answer to your question, but "beyond my ken" doesn't
> >> sound like a very convincing reason. Mucking with any environment that
> >> isn't yours is asking for trouble... the behavior you depend on today
> may
> >> come into conflict with the code you are coordinating with when you
> least
> >> expect it.
> >>
> >> Right on.
> >>
> >> Yes a number of packages (of mine and other people) use a different
> >> approach
> >> to maintain 'global state' without ... using 'global variables' (==
> bad).
> >>
> >> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
> >> also
> >> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
> >> "foo"`
> >> which you can later test for, alter, ... at will.
> >>
> >> All without running afould of what `R CMD check --as-cran` may hate, all
> >> the
> >> while maintaining your logic flow.
> >>
> >> Dirk
> >>
> >> --
> >> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From @ergue|@@oko| @end|ng |rom gm@||@com  Thu Jan 27 17:31:12 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Thu, 27 Jan 2022 17:31:12 +0100
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
Message-ID: <535a87a2-8393-3c86-ca77-48e89404d9e0@gmail.com>

On 27/01/2022 16:56, James Pustejovsky wrote:
> But I am not using global variables at all in the package code (in
> /R)---only for unit testing.
The response of Dirk can be seen as: create myenv in your package but 
use it in your tests instead of globalenv. This way you must be safe.

Serguei.


>   Is this distinction relevant? Or do I need to
> avoid global assignment even in the unit tests?
>
> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
>
>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>> | I don't know the answer to your question, but "beyond my ken" doesn't
>> sound like a very convincing reason. Mucking with any environment that
>> isn't yours is asking for trouble... the behavior you depend on today may
>> come into conflict with the code you are coordinating with when you least
>> expect it.
>>
>> Right on.
>>
>> Yes a number of packages (of mine and other people) use a different
>> approach
>> to maintain 'global state' without ... using 'global variables' (== bad).
>>
>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>> also
>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>> "foo"`
>> which you can later test for, alter, ... at will.
>>
>> All without running afould of what `R CMD check --as-cran` may hate, all
>> the
>> while maintaining your logic flow.
>>
>> Dirk
>>
>> --
>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From n|u|tz @end|ng |rom gm@||@com  Thu Jan 27 17:35:10 2022
From: n|u|tz @end|ng |rom gm@||@com (Neal Fultz)
Date: Thu, 27 Jan 2022 08:35:10 -0800
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
 <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
Message-ID: <CAL9B2vdVKYg=hqD-HuS4B2UEcvRvmXxcH99RLmgQxnu73ocTzA@mail.gmail.com>

I believe, in base R, package tests scripts are run sequentially in clean
sessions via R CMD BATCH. Test scripts can load packages, load data, etc,
but the state is lost from script to script.

Not sure about testthat tests / rstudio run tests button, because iirc it
recursively loads other scripts from a shim within a single job.

If I had to choose between writing a normal function, or a complicated
function that works with testthat scoping, I'd opt for the normal one.

On Thu, Jan 27, 2022 at 8:25 AM James Pustejovsky <jepusto at gmail.com> wrote:

> I suppose, but this seems like kind of a far-fetched possibility if you're
> following any sort of reasonable scripting/development practices. Why in
> the world would someone be working with extremely valuable data and then
> decide to run all my package's unit tests interactively in the same
> session?
>
> In any case, it sounds like I should either just skip these unit tests or
> try to figure out what the heck is causing my namespace problems with
> testthat.
>
> On Thu, Jan 27, 2022 at 10:11 AM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
>
> > On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
> > > But I am not using global variables at all in the package code (in
> > > /R)---only for unit testing. Is this distinction relevant? Or do I need
> > to
> > > avoid global assignment even in the unit tests?
> >
> > CRAN may let you do what you are doing, but as Dirk and Jeff said, it
> > could come back to bite you later.  For example, you may create a
> > variable named foo containing extremely valuable data, and then run your
> > test.  (Tests can be run outside of R CMD check.)  If your test stomps
> > on foo, you'll lose all that data.
> >
> > It's worth using some trick like Dirk's to avoid this possibility.
> >
> > Duncan Murdoch
> > >
> > > On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org>
> > wrote:
> > >
> > >>
> > >> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
> > >> | I don't know the answer to your question, but "beyond my ken"
> doesn't
> > >> sound like a very convincing reason. Mucking with any environment that
> > >> isn't yours is asking for trouble... the behavior you depend on today
> > may
> > >> come into conflict with the code you are coordinating with when you
> > least
> > >> expect it.
> > >>
> > >> Right on.
> > >>
> > >> Yes a number of packages (of mine and other people) use a different
> > >> approach
> > >> to maintain 'global state' without ... using 'global variables' (==
> > bad).
> > >>
> > >> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to
> then
> > >> also
> > >> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]]
> <-
> > >> "foo"`
> > >> which you can later test for, alter, ... at will.
> > >>
> > >> All without running afould of what `R CMD check --as-cran` may hate,
> all
> > >> the
> > >> while maintaining your logic flow.
> > >>
> > >> Dirk
> > >>
> > >> --
> > >> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> > >>
> > >
> > >       [[alternative HTML version deleted]]
> > >
> > > ______________________________________________
> > > R-package-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Thu Jan 27 17:43:16 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 27 Jan 2022 10:43:16 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
Message-ID: <25074.52132.158815.121498@rob.eddelbuettel.com>


On 27 January 2022 at 11:18, Ben Bolker wrote:
|    I have spent hours trying to understand the scoping behaviour of 
| testthat, mostly without success. 

It may bear repeating that use of a test runner package is NOT required by
CRAN Repo Policy, Writing R Extensions, or any other official text.

If any one of these candidate packages is too complicated, or confusing, or
lengthens your test setup, or [your reason here] then consider not using it.

Choice is a good thing, and we have a free option of using one or none of the
different available testing packages. 

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 17:53:12 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 11:53:12 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
 <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
Message-ID: <0934f48c-3654-0fcd-873d-3c0b3ed21c08@gmail.com>

On 27/01/2022 11:24 a.m., James Pustejovsky wrote:
> I suppose, but this seems like kind of a far-fetched possibility if 
> you're following any sort of reasonable scripting/development practices. 
> Why in the world would someone be working with extremely valuable data 
> and then decide to run all my package's unit tests interactively in the 
> same session?

Perhaps "extremely" was an exaggeration, but it's not that far-fetched 
for someone to notice a problem in your package and want to make a 
change and test it.

Your first test stomps on oswald2013, V, mod_A, mod_B, mod_C1, and about 
20 other variables.  That seems kind of excessive to me.

Duncan Murdoch

> 
> In any case, it sounds like I should either just skip these unit tests 
> or try to figure out what the heck is causing my namespace problems with 
> testthat.
> 
> On Thu, Jan 27, 2022 at 10:11 AM Duncan Murdoch 
> <murdoch.duncan at gmail.com <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
>      > But I am not using global variables at all in the package code (in
>      > /R)---only for unit testing. Is this distinction relevant? Or do
>     I need to
>      > avoid global assignment even in the unit tests?
> 
>     CRAN may let you do what you are doing, but as Dirk and Jeff said, it
>     could come back to bite you later.? For example, you may create a
>     variable named foo containing extremely valuable data, and then run
>     your
>     test.? (Tests can be run outside of R CMD check.)? If your test stomps
>     on foo, you'll lose all that data.
> 
>     It's worth using some trick like Dirk's to avoid this possibility.
> 
>     Duncan Murdoch
>      >
>      > On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org
>     <mailto:edd at debian.org>> wrote:
>      >
>      >>
>      >> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>      >> | I don't know the answer to your question, but "beyond my ken"
>     doesn't
>      >> sound like a very convincing reason. Mucking with any
>     environment that
>      >> isn't yours is asking for trouble... the behavior you depend on
>     today may
>      >> come into conflict with the code you are coordinating with when
>     you least
>      >> expect it.
>      >>
>      >> Right on.
>      >>
>      >> Yes a number of packages (of mine and other people) use a different
>      >> approach
>      >> to maintain 'global state' without ... using 'global variables'
>     (== bad).
>      >>
>      >> The trick is something like `pkgenv <- new.env()` in R/zzz.R and
>     to then
>      >> also
>      >> set an option or two you need in .onLoad as eg 
>     `pkgenv[["prefence"]] <-
>      >> "foo"`
>      >> which you can later test for, alter, ... at will.
>      >>
>      >> All without running afould of what `R CMD check --as-cran` may
>     hate, all
>      >> the
>      >> while maintaining your logic flow.
>      >>
>      >> Dirk
>      >>
>      >> --
>      >> https://dirk.eddelbuettel.com <https://dirk.eddelbuettel.com> |
>     @eddelbuettel | edd at debian.org <mailto:edd at debian.org>
>      >>
>      >
>      >? ? ? ?[[alternative HTML version deleted]]
>      >
>      > ______________________________________________
>      > R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 18:02:39 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 11:02:39 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <25074.52132.158815.121498@rob.eddelbuettel.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <25074.52132.158815.121498@rob.eddelbuettel.com>
Message-ID: <CAFUVuJxEimhAHXKgV6UD3NCedWzj+D6bNo9f0x7V7t3BzOYRJA@mail.gmail.com>

Yes, that's a good point. Thanks for the reminder.

On Thu, Jan 27, 2022 at 10:52 AM Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 27 January 2022 at 11:18, Ben Bolker wrote:
> |    I have spent hours trying to understand the scoping behaviour of
> | testthat, mostly without success.
>
> It may bear repeating that use of a test runner package is NOT required by
> CRAN Repo Policy, Writing R Extensions, or any other official text.
>
> If any one of these candidate packages is too complicated, or confusing, or
> lengthens your test setup, or [your reason here] then consider not using
> it.
>
> Choice is a good thing, and we have a free option of using one or none of
> the
> different available testing packages.
>
> Dirk
>
> --
> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 18:07:31 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 12:07:31 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
Message-ID: <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>

On 27/01/2022 11:18 a.m., Ben Bolker wrote:
>     I will chime in briefly.
> 
>     I have spent hours trying to understand the scoping behaviour of
> testthat, mostly without success. I have lots of examples where I have
> tests that fail *only* when running devtools::check(), but not when
> running test_that in an interactive session, or in the same code run via
> source() or in an R batch session.  So I am quite sympathetic to "beyond
> my ken".
> 
>     I agree that it's best to understand everything so that you can know
> when you might run into trouble in the future, but I have sometimes
> reconciled myself to giving up when it seemed I was spending much more
> time debugging my tests than debugging the actual package code ...
> 
>     For what it's worth, I have found that running <<- in these contexts
> doesn't seem to bother CRAN at all -- possibly because it's the *tests*
> that are potentially modifying the global environment, not the package
> itself.
> 
>     If you think about it, a prohibition on modifying the global
> environment in tests would mean that a plain old test file that assigned
> variables as part of testing flow would change the environment.

Yes, tests should be able to create variables, but they shouldn't go 
overboard.  A test like

    x <- 1
    stopifnot(x == 1)

will wipe out x, but that's probably not such a big deal.  On the other 
hand, a test like

    c <<- function(...) stop('do not do this!')
    testthat::expect_error(c(1))

is probably not a good idea.

Duncan Murdoch

> 
> On 1/27/22 10:56 AM, James Pustejovsky wrote:
>> But I am not using global variables at all in the package code (in
>> /R)---only for unit testing. Is this distinction relevant? Or do I need to
>> avoid global assignment even in the unit tests?
>>
>> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
>>
>>>
>>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>>> | I don't know the answer to your question, but "beyond my ken" doesn't
>>> sound like a very convincing reason. Mucking with any environment that
>>> isn't yours is asking for trouble... the behavior you depend on today may
>>> come into conflict with the code you are coordinating with when you least
>>> expect it.
>>>
>>> Right on.
>>>
>>> Yes a number of packages (of mine and other people) use a different
>>> approach
>>> to maintain 'global state' without ... using 'global variables' (== bad).
>>>
>>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>>> also
>>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>>> "foo"`
>>> which you can later test for, alter, ... at will.
>>>
>>> All without running afould of what `R CMD check --as-cran` may hate, all
>>> the
>>> while maintaining your logic flow.
>>>
>>> Dirk
>>>
>>> --
>>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From bbo|ker @end|ng |rom gm@||@com  Thu Jan 27 18:11:55 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 27 Jan 2022 12:11:55 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
Message-ID: <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>



On 1/27/22 12:07 PM, Duncan Murdoch wrote:
> On 27/01/2022 11:18 a.m., Ben Bolker wrote:
>> ??? I will chime in briefly.
>>
>> ??? I have spent hours trying to understand the scoping behaviour of
>> testthat, mostly without success. I have lots of examples where I have
>> tests that fail *only* when running devtools::check(), but not when
>> running test_that in an interactive session, or in the same code run via
>> source() or in an R batch session.? So I am quite sympathetic to "beyond
>> my ken".
>>
>> ??? I agree that it's best to understand everything so that you can know
>> when you might run into trouble in the future, but I have sometimes
>> reconciled myself to giving up when it seemed I was spending much more
>> time debugging my tests than debugging the actual package code ...
>>
>> ??? For what it's worth, I have found that running <<- in these contexts
>> doesn't seem to bother CRAN at all -- possibly because it's the *tests*
>> that are potentially modifying the global environment, not the package
>> itself.
>>
>> ??? If you think about it, a prohibition on modifying the global
>> environment in tests would mean that a plain old test file that assigned
>> variables as part of testing flow would change the environment.
> 
> Yes, tests should be able to create variables, but they shouldn't go 
> overboard.? A test like
> 
>  ?? x <- 1
>  ?? stopifnot(x == 1)
> 
> will wipe out x, but that's probably not such a big deal.? On the other 
> hand, a test like
> 
>  ?? c <<- function(...) stop('do not do this!')
>  ?? testthat::expect_error(c(1))
> 
> is probably not a good idea.
> 
> Duncan Murdoch

   Fair enough.

   As to Dirk's comments about not being required to use a particular 
test platform, I'll just say: inertia/sunk costs. I will definitely 
consider using tinytest, or something else, in future projects ... (I do 
like some of the extra features offered by testing platforms over the 
base-R/vanilla "source() everything in the tests/ directory" approach.)

   cheers
     Ben Bolker
> 
>>
>> On 1/27/22 10:56 AM, James Pustejovsky wrote:
>>> But I am not using global variables at all in the package code (in
>>> /R)---only for unit testing. Is this distinction relevant? Or do I 
>>> need to
>>> avoid global assignment even in the unit tests?
>>>
>>> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> 
>>> wrote:
>>>
>>>>
>>>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>>>> | I don't know the answer to your question, but "beyond my ken" doesn't
>>>> sound like a very convincing reason. Mucking with any environment that
>>>> isn't yours is asking for trouble... the behavior you depend on 
>>>> today may
>>>> come into conflict with the code you are coordinating with when you 
>>>> least
>>>> expect it.
>>>>
>>>> Right on.
>>>>
>>>> Yes a number of packages (of mine and other people) use a different
>>>> approach
>>>> to maintain 'global state' without ... using 'global variables' (== 
>>>> bad).
>>>>
>>>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to 
>>>> then
>>>> also
>>>> set an option or two you need in .onLoad as eg  
>>>> `pkgenv[["prefence"]] <-
>>>> "foo"`
>>>> which you can later test for, alter, ... at will.
>>>>
>>>> All without running afould of what `R CMD check --as-cran` may hate, 
>>>> all
>>>> the
>>>> while maintaining your logic flow.
>>>>
>>>> Dirk
>>>>
>>>> -- 
>>>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>>
>>>
>>> ????[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 18:40:15 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 12:40:15 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
 <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
Message-ID: <5ccd0375-5d85-9e33-f358-1c92ef284998@gmail.com>

On 27/01/2022 12:11 p.m., Ben Bolker wrote:
> 
> 
> On 1/27/22 12:07 PM, Duncan Murdoch wrote:
>> On 27/01/2022 11:18 a.m., Ben Bolker wrote:
>>>  ??? I will chime in briefly.
>>>
>>>  ??? I have spent hours trying to understand the scoping behaviour of
>>> testthat, mostly without success. I have lots of examples where I have
>>> tests that fail *only* when running devtools::check(), but not when
>>> running test_that in an interactive session, or in the same code run via
>>> source() or in an R batch session.? So I am quite sympathetic to "beyond
>>> my ken".
>>>
>>>  ??? I agree that it's best to understand everything so that you can know
>>> when you might run into trouble in the future, but I have sometimes
>>> reconciled myself to giving up when it seemed I was spending much more
>>> time debugging my tests than debugging the actual package code ...
>>>
>>>  ??? For what it's worth, I have found that running <<- in these contexts
>>> doesn't seem to bother CRAN at all -- possibly because it's the *tests*
>>> that are potentially modifying the global environment, not the package
>>> itself.
>>>
>>>  ??? If you think about it, a prohibition on modifying the global
>>> environment in tests would mean that a plain old test file that assigned
>>> variables as part of testing flow would change the environment.
>>
>> Yes, tests should be able to create variables, but they shouldn't go
>> overboard.? A test like
>>
>>   ?? x <- 1
>>   ?? stopifnot(x == 1)
>>
>> will wipe out x, but that's probably not such a big deal.? On the other
>> hand, a test like
>>
>>   ?? c <<- function(...) stop('do not do this!')
>>   ?? testthat::expect_error(c(1))
>>
>> is probably not a good idea.
>>
>> Duncan Murdoch
> 
>     Fair enough.
> 
>     As to Dirk's comments about not being required to use a particular
> test platform, I'll just say: inertia/sunk costs. I will definitely
> consider using tinytest, or something else, in future projects ... (I do
> like some of the extra features offered by testing platforms over the
> base-R/vanilla "source() everything in the tests/ directory" approach.)

Rather than just complaining, I'll try to offer some constructive 
advice.  The answer I just posted to this 9 year old question on 
StackOverflow probably won't help the original author, but maybe it's 
helpful to others:  https://stackoverflow.com/q/70702130/2554330 .

Though I don't use testthat enough to know if it will actually work.

Duncan Murdoch


From edd @end|ng |rom deb|@n@org  Thu Jan 27 19:18:46 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 27 Jan 2022 12:18:46 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
 <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
Message-ID: <25074.57862.271667.22128@rob.eddelbuettel.com>


On 27 January 2022 at 12:11, Ben Bolker wrote:
| I will definitely consider using tinytest, or something else, in future projects ... 

Every tinytest test file is a regular R script. That is the core feature.

No metaphysics, astrology, or tarot reading needed know what is happening. 

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Fri Jan 28 08:37:52 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Fri, 28 Jan 2022 08:37:52 +0100
Subject: [R-pkg-devel] =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
Message-ID: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>

Dear listers,

One user (in cc) has signaled a problem installing the package pgirmess 
(versin 1.7.1 on CRAN), with this message on loading:

> library(pgirmess)

Error: package or namespace load failed for ?pgirmess?:

Function found when exporting methods from the namespace ?raster? which 
is not S4 generic: ?all.equal?

In addition: Warning message:

no function found corresponding to methods exports from ?raster? for: 
?direction?, ?gridDistance?

I cannot identify where the trouble comes from since:

- pgirmess goes through OK in all the checks on CRAN

- I can install/remove it with correct loading on my own platform

- pgirmess 1.7.1 does not import 'raster' and the functions mentioned above

The user has installed the last R version on Windows.? However, she gets 
a correct loading only if she loads 'Matrix' before (or 'lme4' - but to 
my knowlege, lme4 actually loads Matrix).

She meets also the same issuer with pgirmess 2.0 (not on CRAN yet, see 
https://github.com/pgiraudoux/pgirmess however this version (still on 
test) has deprecated/dropped all functions related to dealing with rasters.

This occurs in R directly (not necessarily within RStudio).

On the web, Iook likes this issue has is already been spotted for some 
other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw 
that installing rtools might solve the problem (e.g. 
https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914) 
however, it seems to me a strange workaround since rtools should not be 
made necessary for lay R user (not developers).

Best,





	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Fri Jan 28 09:22:58 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Fri, 28 Jan 2022 09:22:58 +0100
Subject: [R-pkg-devel] =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
Message-ID: <b762d962-1e17-a944-6c13-8d5829d76c90@univ-fcomte.fr>

Dear listers,

One user (in cc) has signaled a problem installing the package pgirmess 
(versin 1.7.1 on CRAN), with this message on loading:

> library(pgirmess)

Error: package or namespace load failed for ?pgirmess?:

Function found when exporting methods from the namespace ?raster? which 
is not S4 generic: ?all.equal?

In addition: Warning message:

no function found corresponding to methods exports from ?raster? for: 
?direction?, ?gridDistance?

I cannot identify where the trouble comes from since:

- pgirmess goes through OK in all the checks on CRAN

- I can install/remove it with correct loading on my own platform

- pgirmess 1.7.1 does not import 'raster' and the functions mentioned above

The user has installed the last R version on Windows.? However, she gets 
a correct loading only if she loads 'Matrix' before (or 'lme4' - but to 
my knowlege, lme4 actually loads Matrix).

She meets also the same issuer with pgirmess 2.0 (not on CRAN yet, see 
https://github.com/pgiraudoux/pgirmess however this version (still on 
test) has deprecated/dropped all functions related to dealing with rasters.

This occurs in R directly (not necessarily within RStudio).

On the web, Iook likes this issue has is already been spotted for some 
other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw 
that installing rtools might solve the problem (e.g. 
https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914) 
however, it seems to me a strange workaround since rtools should not be 
made necessary for lay R user (not developers).

Best,





	[[alternative HTML version deleted]]


From zk@mv@r @end|ng |rom gm@||@com  Fri Jan 28 16:26:58 2022
From: zk@mv@r @end|ng |rom gm@||@com (Zhian Kamvar)
Date: Fri, 28 Jan 2022 07:26:58 -0800
Subject: [R-pkg-devel] 
	=?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
	=?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which?=
	=?utf-8?b?IGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwuZXF1YWzigJk=?=
In-Reply-To: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
Message-ID: <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>

The reason why Rtools was suggested was because CRAN takes some time for
the binaries to be built and people were trying to install it just after
raster was released.
The solution is for the user to re-install the raster package from CRAN in
a fresh R environment.

All the best,
Zhian


On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux <
patrick.giraudoux at univ-fcomte.fr> wrote:

> Dear listers,
>
> One user (in cc) has signaled a problem installing the package pgirmess
> (versin 1.7.1 on CRAN), with this message on loading:
>
> > library(pgirmess)
>
> Error: package or namespace load failed for ?pgirmess?:
>
> Function found when exporting methods from the namespace ?raster? which
> is not S4 generic: ?all.equal?
>
> In addition: Warning message:
>
> no function found corresponding to methods exports from ?raster? for:
> ?direction?, ?gridDistance?
>
> I cannot identify where the trouble comes from since:
>
> - pgirmess goes through OK in all the checks on CRAN
>
> - I can install/remove it with correct loading on my own platform
>
> - pgirmess 1.7.1 does not import 'raster' and the functions mentioned above
>
> The user has installed the last R version on Windows.  However, she gets
> a correct loading only if she loads 'Matrix' before (or 'lme4' - but to
> my knowlege, lme4 actually loads Matrix).
>
> She meets also the same issuer with pgirmess 2.0 (not on CRAN yet, see
> https://github.com/pgiraudoux/pgirmess however this version (still on
> test) has deprecated/dropped all functions related to dealing with rasters.
>
> This occurs in R directly (not necessarily within RStudio).
>
> On the web, Iook likes this issue has is already been spotted for some
> other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw
> that installing rtools might solve the problem (e.g.
>
> https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914)
>
> however, it seems to me a strange workaround since rtools should not be
> made necessary for lay R user (not developers).
>
> Best,
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Fri Jan 28 16:45:38 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Fri, 28 Jan 2022 16:45:38 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
In-Reply-To: <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
 <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
Message-ID: <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>

OK. Thanks Zhian. However what suprises me is that pgirmess namespace 
does not import any function from raster nor uses ?direction? or 
?gridDistance? and the package raster is not imported from the 
description file. raster is not in the Suggests either...

So I wonder why loading pgirmess can trigger such an error... and 
depends on loading other packages before (such as Matrix !)? in such 
case (but generally not, and never on CRAN checks).


Le 28/01/2022 ? 16:26, Zhian Kamvar a ?crit?:
> The reason why Rtools was suggested was because CRAN takes some time 
> for the binaries to be built and people were trying to install it just 
> after raster was released.
> The solution is for the user to re-install the raster package from 
> CRAN in a fresh R environment.
>
> All the best,
> Zhian
>
>
> On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux 
> <patrick.giraudoux at univ-fcomte.fr> wrote:
>
>     Dear listers,
>
>     One user (in cc) has signaled a problem installing the package
>     pgirmess
>     (versin 1.7.1 on CRAN), with this message on loading:
>
>     > library(pgirmess)
>
>     Error: package or namespace load failed for ?pgirmess?:
>
>     Function found when exporting methods from the namespace ?raster?
>     which
>     is not S4 generic: ?all.equal?
>
>     In addition: Warning message:
>
>     no function found corresponding to methods exports from ?raster? for:
>     ?direction?, ?gridDistance?
>
>     I cannot identify where the trouble comes from since:
>
>     - pgirmess goes through OK in all the checks on CRAN
>
>     - I can install/remove it with correct loading on my own platform
>
>     - pgirmess 1.7.1 does not import 'raster' and the functions
>     mentioned above
>
>     The user has installed the last R version on Windows. However, she
>     gets
>     a correct loading only if she loads 'Matrix' before (or 'lme4' -
>     but to
>     my knowlege, lme4 actually loads Matrix).
>
>     She meets also the same issuer with pgirmess 2.0 (not on CRAN yet,
>     see
>     https://github.com/pgiraudoux/pgirmess however this version (still on
>     test) has deprecated/dropped all functions related to dealing with
>     rasters.
>
>     This occurs in R directly (not necessarily within RStudio).
>
>     On the web, Iook likes this issue has is already been spotted for
>     some
>     other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw
>     that installing rtools might solve the problem (e.g.
>     https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914)
>
>     however, it seems to me a strange workaround since rtools should
>     not be
>     made necessary for lay R user (not developers).
>
>     Best,
>
>
>
>
>
>     ? ? ? ? [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From zk@mv@r @end|ng |rom gm@||@com  Fri Jan 28 17:35:47 2022
From: zk@mv@r @end|ng |rom gm@||@com (Zhian Kamvar)
Date: Fri, 28 Jan 2022 08:35:47 -0800
Subject: [R-pkg-devel] 
	=?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
	=?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which?=
	=?utf-8?b?IGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwuZXF1YWzigJk=?=
In-Reply-To: <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
 <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
 <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>
Message-ID: <CAPsXksJ_WjjQQkjNQyyjmqOkknm-3GufOVVXYvygn0EvgUVHPw@mail.gmail.com>

I've run into deep dependencies registering methods that mess things up
before: https://github.com/thibautjombart/adegenet/issues/308.
AFAICT, it has something to do with the way R deploys methods where they
can be available if the namespace is available. In this case, it's via
spdep -> spData -> raster. That being said, I am NOT an expert on this and
would like to know more if anyone has better insight.


On Fri, Jan 28, 2022 at 7:46 AM Patrick Giraudoux <
patrick.giraudoux at univ-fcomte.fr> wrote:

> OK. Thanks Zhian. However what suprises me is that pgirmess namespace
> does not import any function from raster nor uses ?direction? or
> ?gridDistance? and the package raster is not imported from the
> description file. raster is not in the Suggests either...
>
> So I wonder why loading pgirmess can trigger such an error... and
> depends on loading other packages before (such as Matrix !)  in such
> case (but generally not, and never on CRAN checks).
>
>
> Le 28/01/2022 ? 16:26, Zhian Kamvar a ?crit :
> > The reason why Rtools was suggested was because CRAN takes some time
> > for the binaries to be built and people were trying to install it just
> > after raster was released.
> > The solution is for the user to re-install the raster package from
> > CRAN in a fresh R environment.
> >
> > All the best,
> > Zhian
> >
> >
> > On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux
> > <patrick.giraudoux at univ-fcomte.fr> wrote:
> >
> >     Dear listers,
> >
> >     One user (in cc) has signaled a problem installing the package
> >     pgirmess
> >     (versin 1.7.1 on CRAN), with this message on loading:
> >
> >     > library(pgirmess)
> >
> >     Error: package or namespace load failed for ?pgirmess?:
> >
> >     Function found when exporting methods from the namespace ?raster?
> >     which
> >     is not S4 generic: ?all.equal?
> >
> >     In addition: Warning message:
> >
> >     no function found corresponding to methods exports from ?raster? for:
> >     ?direction?, ?gridDistance?
> >
> >     I cannot identify where the trouble comes from since:
> >
> >     - pgirmess goes through OK in all the checks on CRAN
> >
> >     - I can install/remove it with correct loading on my own platform
> >
> >     - pgirmess 1.7.1 does not import 'raster' and the functions
> >     mentioned above
> >
> >     The user has installed the last R version on Windows. However, she
> >     gets
> >     a correct loading only if she loads 'Matrix' before (or 'lme4' -
> >     but to
> >     my knowlege, lme4 actually loads Matrix).
> >
> >     She meets also the same issuer with pgirmess 2.0 (not on CRAN yet,
> >     see
> >     https://github.com/pgiraudoux/pgirmess however this version (still
> on
> >     test) has deprecated/dropped all functions related to dealing with
> >     rasters.
> >
> >     This occurs in R directly (not necessarily within RStudio).
> >
> >     On the web, Iook likes this issue has is already been spotted for
> >     some
> >     other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw
> >     that installing rtools might solve the problem (e.g.
> >
> https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914
> )
> >
> >     however, it seems to me a strange workaround since rtools should
> >     not be
> >     made necessary for lay R user (not developers).
> >
> >     Best,
> >
> >
> >
> >
> >
> >             [[alternative HTML version deleted]]
> >
> >     ______________________________________________
> >     R-package-devel at r-project.org mailing list
> >     https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Sat Jan 29 07:43:03 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Sat, 29 Jan 2022 07:43:03 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
In-Reply-To: <CAPsXksJ_WjjQQkjNQyyjmqOkknm-3GufOVVXYvygn0EvgUVHPw@mail.gmail.com>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
 <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
 <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>
 <CAPsXksJ_WjjQQkjNQyyjmqOkknm-3GufOVVXYvygn0EvgUVHPw@mail.gmail.com>
Message-ID: <ed7b6070-2a00-4836-14fe-5601493ac93c@univ-fcomte.fr>

Clear enough ! Many thanks. Me too I am not an expert in this but at 
least, now, I understand it is not due to some mis-programming in the 
package. Hope that people able to deal with the R core an namespace 
management will handle this one day.

Best,

Patrick


Le 28/01/2022 ? 17:35, Zhian Kamvar a ?crit?:
> I've run into deep dependencies registering methods that mess things 
> up before: https://github.com/thibautjombart/adegenet/issues/308.
> AFAICT, it has something to do with the way R deploys methods where 
> they can be available if the namespace is available. In this case, 
> it's via spdep -> spData -> raster. That being said, I am NOT an 
> expert on this and would?like to know more if anyone has better insight.
>
>
> On Fri, Jan 28, 2022 at 7:46 AM Patrick Giraudoux 
> <patrick.giraudoux at univ-fcomte.fr> wrote:
>
>     OK. Thanks Zhian. However what suprises me is that pgirmess namespace
>     does not import any function from raster nor uses ?direction? or
>     ?gridDistance? and the package raster is not imported from the
>     description file. raster is not in the Suggests either...
>
>     So I wonder why loading pgirmess can trigger such an error... and
>     depends on loading other packages before (such as Matrix !) in such
>     case (but generally not, and never on CRAN checks).
>
>
>     Le 28/01/2022 ? 16:26, Zhian Kamvar a ?crit?:
>     > The reason why Rtools was suggested was because CRAN takes some
>     time
>     > for the binaries to be built and people were trying to install
>     it just
>     > after raster was released.
>     > The solution is for the user to re-install the raster package from
>     > CRAN in a fresh R environment.
>     >
>     > All the best,
>     > Zhian
>     >
>     >
>     > On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux
>     > <patrick.giraudoux at univ-fcomte.fr> wrote:
>     >
>     >? ? ?Dear listers,
>     >
>     >? ? ?One user (in cc) has signaled a problem installing the package
>     >? ? ?pgirmess
>     >? ? ?(versin 1.7.1 on CRAN), with this message on loading:
>     >
>     >? ? ?> library(pgirmess)
>     >
>     >? ? ?Error: package or namespace load failed for ?pgirmess?:
>     >
>     >? ? ?Function found when exporting methods from the namespace
>     ?raster?
>     >? ? ?which
>     >? ? ?is not S4 generic: ?all.equal?
>     >
>     >? ? ?In addition: Warning message:
>     >
>     >? ? ?no function found corresponding to methods exports from
>     ?raster? for:
>     >? ? ??direction?, ?gridDistance?
>     >
>     >? ? ?I cannot identify where the trouble comes from since:
>     >
>     >? ? ?- pgirmess goes through OK in all the checks on CRAN
>     >
>     >? ? ?- I can install/remove it with correct loading on my own
>     platform
>     >
>     >? ? ?- pgirmess 1.7.1 does not import 'raster' and the functions
>     >? ? ?mentioned above
>     >
>     >? ? ?The user has installed the last R version on Windows.
>     However, she
>     >? ? ?gets
>     >? ? ?a correct loading only if she loads 'Matrix' before (or 'lme4' -
>     >? ? ?but to
>     >? ? ?my knowlege, lme4 actually loads Matrix).
>     >
>     >? ? ?She meets also the same issuer with pgirmess 2.0 (not on
>     CRAN yet,
>     >? ? ?see
>     > https://github.com/pgiraudoux/pgirmess however this version
>     (still on
>     >? ? ?test) has deprecated/dropped all functions related to
>     dealing with
>     >? ? ?rasters.
>     >
>     >? ? ?This occurs in R directly (not necessarily within RStudio).
>     >
>     >? ? ?On the web, Iook likes this issue has is already been
>     spotted for
>     >? ? ?some
>     >? ? ?other packages (e.g. mapview, tmap, etc.). Checking
>     help-lists I saw
>     >? ? ?that installing rtools might solve the problem (e.g.
>     >
>     https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914)
>     >
>     >? ? ?however, it seems to me a strange workaround since rtools should
>     >? ? ?not be
>     >? ? ?made necessary for lay R user (not developers).
>     >
>     >? ? ?Best,
>     >
>     >
>     >
>     >
>     >
>     >? ? ?? ? ? ? [[alternative HTML version deleted]]
>     >
>     >? ? ?______________________________________________
>     > R-package-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     >
>
>     ? ? ? ? [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Mon Jan 31 13:53:12 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Mon, 31 Jan 2022 13:53:12 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?=5BRd=5D_trouble_with_package_loading=3A?=
 =?utf-8?q?_Function_found_when_exporting_methods_from_the_namespace_?=
 =?utf-8?b?4oCYcmFzdGVy4oCZIHdoaWNoIGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwu?=
 =?utf-8?b?ZXF1YWzigJk=?=
In-Reply-To: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
References: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
Message-ID: <67417606-90c4-4107-ed5b-a1062fd2a158@univ-fcomte.fr>

This contribution below from Roger Bivand seems to answer the issue 
raised on this thread.

Actually it matches quite well Zhian and Duncan's suspicions, doesn'it ?

Best,

Patrick


-------- Message transf?r? --------
Sujet?: 	Follow-up on R-devel
Date?: 	Mon, 31 Jan 2022 12:23:57 +0000
De?: 	Roger Bivand <Roger.Bivand at nhh.no>
Pour?: 	Patrick Giraudoux <patrick.giraudoux at univ-fcomte.fr>



Dear Patrick,

Could you follow up on R-package-devel and R-devel that (from 
https://github.com/rspatial/terra/issues/514):
CRAN has not yet updated terra to 1.5-12 for R 4.1.2 (since two weeks it 
is still the previous version).

I will send a new version to CRAN this weekend, hopefully it will get 
build for windows. What happens is that raster is dependent on that 
version of terra (or later), so you should first do

install.packages('terra')

(once Windows terra_1.5-17.zip is published and on your mirror) and then

install.packages('raster')

Best wishes,

Roger
	[[alternative HTML version deleted]]


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 14:27:54 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 08:27:54 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
Message-ID: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>

Hi,

I am preparing a package for submission and having issues with R CMD check, both using the r-lib GitHub actions and r-hub. I keep getting the warning message:

* checking whether package ?toxpiR? can be installed ... WARNING
Found the following significant warnings:
  Warning: namespace ?DBI? is not available and has been replaced
See ?.../00install.out? for details.

I cannot replicate the warning while checking as-cran on my local machine. Going through the logs it?s clear that DBI is not getting installed, but I also do not know who/what is calling it. I see that knitr lists DBI in imports, so it?s odd to me that it?s not getting installed. I do not directly import or use any DBI functions. The easy solution would be to add DBI to ?Suggests? ? and that feels more like a bandaid than a good solution.

DBI is also being loaded into the Namespace when loading the package. From a clean session:

> library(toxpiR)
> sessionInfo()
R version 4.1.2 (2021-11-01)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Monterey 12.1

Matrix products: default
LAPACK: /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] toxpiR_0.1.0

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.8          knitr_1.37          magrittr_2.0.2      BiocGenerics_0.40.0 tidyselect_1.1.1    R6_2.5.1            rlang_1.0.0        
 [8] fastmap_1.1.0       fansi_1.0.2         stringr_1.4.0       dplyr_1.0.7         tools_4.1.2         grid_4.1.2          xfun_0.29          
[15] utf8_1.2.2          DBI_1.1.2           cli_3.1.1           ellipsis_0.3.2      htmltools_0.5.2     assertthat_0.2.1    yaml_2.2.2         
[22] digest_0.6.29       tibble_3.1.6        lifecycle_1.0.1     crayon_1.4.2        purrr_0.3.4         pryr_0.1.5          tidyr_1.1.4        
[29] vctrs_0.3.8         S4Vectors_0.32.3    codetools_0.2-18    glue_1.6.1          evaluate_0.14       rmarkdown_2.11      stringi_1.7.6      
[36] pillar_1.6.5        compiler_4.1.2      generics_0.1.1      stats4_4.1.2        pkgconfig_2.0.3    

Any help is greatly appreciated!! Below I have linked to the  r-hub results and the pasted the Desc/Namespace. 

Thank you!

Dayne Filer, PhD
UNC School of Medicine
Renaissance Computing Institute 

Links to the r-hub results:

Windows/dev: https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-36c4ff0f5ae348e7a5b28c15ca9d761d <https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-36c4ff0f5ae348e7a5b28c15ca9d761d>
Linux/release: https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-f631ce3fc55d44b98bc328f2886caf6c/ <https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-f631ce3fc55d44b98bc328f2886caf6c/>
Linux/dev: https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-d64875065b744735bd4991da2d2dc185/ <https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-d64875065b744735bd4991da2d2dc185/>

The package DESCRIPTION:

Package: toxpiR
Type: Package
Title: Create ToxPi Prioritization Models
Version: 0.1.0
Authors at R: 
    c(person("Dayne L", "Filer", 
             role = c("aut"), 
             email = "dayne.filer at gmail.com",
             comment = c(ORCID = "0000-0002-3443-5315")),
      person("Dillon T", "Lloyd",
             role = "aut"),
      person("Preethi", "Thunga",
             role = "aut",
             comment = c(ORCID = "0000-0001-5447-0129")),
      person("Skylar W", "Marvel",
             role = "aut"),      
      person("David M", "Reif",
             role = c("aut", "cre"),
             email = "reif.david at gmail.com",
             comment = c(ORCID = "0000-0001-7815-6767")))
Description: 
  Enables users to build ToxPi prioritization models and provides 
  functionality within the grid framework for plotting ToxPi graphs.
  toxpiR allows for more customization than the ToxPi GUI (toxpi.org)
  and integration into existing workflows for greater ease-of-use, 
  reproducibility, and transparency.
  toxpiR package behaves nearly identically to the GUI; the package 
  documentation includes notes about all differences.
Imports: 
    grDevices,
    methods,
    S4Vectors,
    grid,
    rlang,
    stats,
    BiocGenerics,
    pryr,
    tidyr,
    utils
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.1.2
Roxygen: list(markdown = TRUE)
Depends: 
    R (>= 3.5.0)
Suggests: 
    rmarkdown,
    knitr,
    testthat (>= 3.0.0),
    covr
Config/testthat/edition: 3
Config/testthat/parallel: true
VignetteBuilder: knitr
License: GPL (>= 3)

Package NAMESPACE:

S3method(editDetails,pieGrob)
export(TxpModel)
export(TxpModelList)
export(TxpResultList)
export(TxpSlice)
export(TxpSliceList)
export(TxpTransFunc)
export(TxpTransFuncList)
export(as.TxpModelList)
export(as.TxpResultList)
export(as.TxpSliceList)
export(as.TxpTransFuncList)
export(grid.pieGridGrob)
export(grid.pieGrob)
export(pieGridGrob)
export(pieGrob)
export(txpCalculateScores)
export(txpImportGui)
exportClasses(TxpModel)
exportClasses(TxpModelList)
exportClasses(TxpResult)
exportClasses(TxpResultList)
exportClasses(TxpSlice)
exportClasses(TxpSliceList)
exportClasses(TxpTransFunc)
exportClasses(TxpTransFuncList)
exportMethods("[")
exportMethods("names<-")
exportMethods("txpIDs<-")
exportMethods("txpSlices<-")
exportMethods("txpTransFuncs<-")
exportMethods("txpValueNames<-")
exportMethods("txpWeights<-")
exportMethods(as.data.frame)
exportMethods(duplicated)
exportMethods(length)
exportMethods(merge)
exportMethods(names)
exportMethods(plot)
exportMethods(sort)
exportMethods(txpCalculateScores)
exportMethods(txpIDs)
exportMethods(txpModel)
exportMethods(txpRanks)
exportMethods(txpScores)
exportMethods(txpSliceScores)
exportMethods(txpSlices)
exportMethods(txpTransFuncs)
exportMethods(txpValueNames)
exportMethods(txpWeights)
import(grid)
import(methods)
importClassesFrom(S4Vectors,List)
importClassesFrom(S4Vectors,SimpleList)
importClassesFrom(S4Vectors,character_OR_NULL)
importFrom(BiocGenerics,as.data.frame)
importFrom(BiocGenerics,duplicated)
importFrom(BiocGenerics,sort)
importFrom(BiocGenerics,updateObject)
importFrom(S4Vectors,List)
importFrom(S4Vectors,classNameForDisplay)
importFrom(S4Vectors,coolcat)
importFrom(S4Vectors,new2)
importFrom(S4Vectors,setValidity2)
importFrom(grDevices,colorRampPalette)
importFrom(grDevices,extendrange)
importFrom(pryr,make_function)
importFrom(pryr,substitute_q)
importFrom(rlang,is_integerish)
importFrom(rlang,is_named)
importFrom(rlang,is_scalar_character)
importFrom(rlang,is_scalar_integerish)
importFrom(rlang,is_scalar_logical)
importFrom(stats,sd)
importFrom(tidyr,separate)
importFrom(utils,data)
importFrom(utils,read.csv)
importFrom(utils,type.convert)


	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Feb  1 15:27:44 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 1 Feb 2022 08:27:44 -0600
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
Message-ID: <25081.17248.899480.628292@rob.eddelbuettel.com>


Dayne,

When debugging, splitting concerns into separable buckets ofteb helps.
Submission to CRAN, contrary what an increasing number of people appear to
believe does _not_ require use of certain packages (none or in fact
required), documentation styles (though WRE mentioned markdown now, still no
requirement), testing frameworks -- or for that matter where you store your
code and how you test it. 

So in brief you could first concentrate on uploading your package, and
dealing with what R CMD check --as-cran and the test platforms (win-builder,
macbuilder, rhub, personal use of Docker or local machines, ...) give you.

And with that done, or in parallel, work out what goes off for you with
GitHub Actions_ which you are after all not required to use.  While there are
plenty of resources, I personally find the (widely used) GitHub Actions too
opaque and hard to debug / diagnose. I prefer a simpler scheme that relies on
a Docker container I provide (for my own use and use by others), and a setup
I can decompose and run (way more easily) locally. You can take a look at
https://eddelbuettel.github.io/r-ci/ and GitHub search should provide you
with a couple of usage examples.  That said, I am sure you will also find
helpful tips for use of GitHub Actions.

Cheers, Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Feb  1 16:14:01 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 1 Feb 2022 18:14:01 +0300
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
Message-ID: <20220201181401.0d1510e6@Tarkus>

On Tue, 1 Feb 2022 08:27:54 -0500
Dayne Filer <dayne.filer at gmail.com> wrote:

> I do not directly import or use any DBI functions.

00install.out says:

>> Warning: namespace ?DBI? is not available and has been replaced
>> by .GlobalEnv when processing object ?txp_example_model?

Should the txp_example_model object reference the DBI namespace?

I don't know the "right" solution here, but a similar problem has been
discussed here in R-pkg-devel some time ago:
https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html

You might have to depend on DBI explicitly because your data() object
uses it, but then `R CMD check` might object that you don't explicitly
import anything from it. One admittedly verbose way to work around that
would be to move the data file to inst/ and load it from
data/txp_example_model.R only after loadNamespace('DBI'), like some
data scripts do in the Matrix package.

-- 
Best regards,
Ivan


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Tue Feb  1 16:16:47 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Tue, 1 Feb 2022 16:16:47 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?=5BRd=5D_trouble_with_package_loading=3A?=
 =?utf-8?q?_Function_found_when_exporting_methods_from_the_namespace_?=
 =?utf-8?b?4oCYcmFzdGVy4oCZIHdoaWNoIGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwu?=
 =?utf-8?b?ZXF1YWzigJk=?=
In-Reply-To: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
References: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
Message-ID: <d18b5037-d2a2-3d1e-1400-b2bc2f29f5b5@univ-fcomte.fr>

A Master student of? us has just send us the way he has found to get out 
of the problem met. Here is the translation of his mail:

I have updated R to 4.1.2 using updateR() of the package installr from 
the R consol, specifying I want to keep the packages.

I have installed Rtools from there: 
https://cran.rstudio.com/bin/windows/Rtools/rtools40.html

Then I have opened the consol and applied:

write('PATH="${RTOOLS40_HOME}\\usr\\bin;${PATH}"', file = "~/.Renviron", 
append = TRUE)

then restarted R, and checked the RTools path applying:

Restart R, and verify that make can be found, which should show the path 
to your Rtools installation.

Sys.which("make")
## "C:\\rtools40\\usr\\bin\\make.exe"

then install.packages("terra", type = "source")

It has solved the problem, pgirmess work without trouble now.

This fit with Roger's info about late updates from *.tar.gz and *.zip? 
on CRAN messing a standard installation.

Best,

Patrick

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Feb  1 16:34:47 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 1 Feb 2022 09:34:47 -0600
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <20220201181401.0d1510e6@Tarkus>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
Message-ID: <25081.21271.277625.67460@rob.eddelbuettel.com>


On 1 February 2022 at 18:14, Ivan Krylov wrote:
| You might have to depend on DBI explicitly

Good point. That same issue hit me with two little test packages I built on
the weekend which started with a Imports: RPostgres and Imports: RPostgreSQL
(trying to compare something here) and when R / R CMD check whined (on the
simple attempt to connect) I shrugged I just added DBI.  Which shouldn't have
been necessary as DBI gets imported by either but I was in no mood to fight.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 18:13:33 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 12:13:33 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <20220201181401.0d1510e6@Tarkus>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
Message-ID: <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>

Thanks, Ivan! 

I completely missed the warning in the install.out file and had no idea where this was coming from. The object has a slot with a class inheriting from the S4Vectors package. Based on the very helpful thread you suggested, it appears that is the crux. The odd thing is that unlike the ade4 package which was NOT importing anything from the offending sp package, I list S4Vectors as an import. Why would, if the S4Vectors package has some dependencies on the DBI package (probably by way of the AnnotationDbi package?) would DBI not be installed? 

Thanks, All!

Dayne


> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
> 
> On Tue, 1 Feb 2022 08:27:54 -0500
> Dayne Filer <dayne.filer at gmail.com> wrote:
> 
>> I do not directly import or use any DBI functions.
> 
> 00install.out says:
> 
>>> Warning: namespace ?DBI? is not available and has been replaced
>>> by .GlobalEnv when processing object ?txp_example_model?
> 
> Should the txp_example_model object reference the DBI namespace?
> 
> I don't know the "right" solution here, but a similar problem has been
> discussed here in R-pkg-devel some time ago:
> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html
> 
> You might have to depend on DBI explicitly because your data() object
> uses it, but then `R CMD check` might object that you don't explicitly
> import anything from it. One admittedly verbose way to work around that
> would be to move the data file to inst/ and load it from
> data/txp_example_model.R only after loadNamespace('DBI'), like some
> data scripts do in the Matrix package.
> 
> -- 
> Best regards,
> Ivan


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 18:24:18 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 12:24:18 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <25081.21271.277625.67460@rob.eddelbuettel.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <25081.21271.277625.67460@rob.eddelbuettel.com>
Message-ID: <B4EE5953-B8E0-47F5-89A7-825C371ECC67@gmail.com>

Thanks, Dirk! 

I apologize ? your fist message went to my junk folder so I didn?t see until after my first response. I totally understand re: CRAN requirements. I thought maybe the issue was with how the GitHub actions script was setup, hence moving to r-hub. When they both gave the same answer, I then assumed it was real. 

I am also leaning towards adding to suggests and seeing if I can pass checks. It doesn?t detract from the package per se, I just find it odd that it doesn?t get installed, when it?s not MY package that requires it. You can go down the requirement trees (I haven?t done this for every package I import/suggest), but at least knitr -> DBI and S4Vectors -> AnnotationDbi -> DBI. How are these packages being installed during the test check without installing DBI?

Thanks, again!

Dayne

> On Feb 1, 2022, at 10:34 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> On 1 February 2022 at 18:14, Ivan Krylov wrote:
> | You might have to depend on DBI explicitly
> 
> Good point. That same issue hit me with two little test packages I built on
> the weekend which started with a Imports: RPostgres and Imports: RPostgreSQL
> (trying to compare something here) and when R / R CMD check whined (on the
> simple attempt to connect) I shrugged I just added DBI.  Which shouldn't have
> been necessary as DBI gets imported by either but I was in no mood to fight.
> 
> Dirk
> 
> -- 
> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Feb  1 18:25:45 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 1 Feb 2022 12:25:45 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
Message-ID: <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>

On 01/02/2022 12:13 p.m., Dayne Filer wrote:
> Thanks, Ivan!
> 
> I completely missed the warning in the install.out file and had no idea where this was coming from. The object has a slot with a class inheriting from the S4Vectors package. Based on the very helpful thread you suggested, it appears that is the crux. The odd thing is that unlike the ade4 package which was NOT importing anything from the offending sp package, I list S4Vectors as an import. Why would, if the S4Vectors package has some dependencies on the DBI package (probably by way of the AnnotationDbi package?) would DBI not be installed?

S4Vectors is a Bioconductor package, and its current version (0.32.3) 
doesn't list any imports.  It has just one non-base dependency 
(BiocGenerics) and a list of 10 suggested packages.  These dependencies 
may be different if you have a different version.

Normally suggested packages of the one being tested are loaded, but not 
suggested packages of packages it uses.  So it's probably one of those 
suggested packages that needs DBI.

Duncan Murdoch

> 
> Thanks, All!
> 
> Dayne
> 
> 
>> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>
>> On Tue, 1 Feb 2022 08:27:54 -0500
>> Dayne Filer <dayne.filer at gmail.com> wrote:
>>
>>> I do not directly import or use any DBI functions.
>>
>> 00install.out says:
>>
>>>> Warning: namespace ?DBI? is not available and has been replaced
>>>> by .GlobalEnv when processing object ?txp_example_model?
>>
>> Should the txp_example_model object reference the DBI namespace?
>>
>> I don't know the "right" solution here, but a similar problem has been
>> discussed here in R-pkg-devel some time ago:
>> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html
>>
>> You might have to depend on DBI explicitly because your data() object
>> uses it, but then `R CMD check` might object that you don't explicitly
>> import anything from it. One admittedly verbose way to work around that
>> would be to move the data file to inst/ and load it from
>> data/txp_example_model.R only after loadNamespace('DBI'), like some
>> data scripts do in the Matrix package.
>>
>> -- 
>> Best regards,
>> Ivan
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 18:29:01 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 12:29:01 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
 <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>
Message-ID: <5EF08F68-A5C4-41C3-BBC1-2C5572C9E6DF@gmail.com>

I see. And yes, I could only track DBI down though suggests from knitr & S4Vectors. The best answer then, it to suggest DBI?

Thanks,

Dayne

> On Feb 1, 2022, at 12:25 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> On 01/02/2022 12:13 p.m., Dayne Filer wrote:
>> Thanks, Ivan!
>> I completely missed the warning in the install.out file and had no idea where this was coming from. The object has a slot with a class inheriting from the S4Vectors package. Based on the very helpful thread you suggested, it appears that is the crux. The odd thing is that unlike the ade4 package which was NOT importing anything from the offending sp package, I list S4Vectors as an import. Why would, if the S4Vectors package has some dependencies on the DBI package (probably by way of the AnnotationDbi package?) would DBI not be installed?
> 
> S4Vectors is a Bioconductor package, and its current version (0.32.3) doesn't list any imports.  It has just one non-base dependency (BiocGenerics) and a list of 10 suggested packages. These dependencies may be different if you have a different version.
> 
> Normally suggested packages of the one being tested are loaded, but not suggested packages of packages it uses.  So it's probably one of those suggested packages that needs DBI.
> 
> Duncan Murdoch
> 
>> Thanks, All!
>> Dayne
>>> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>> 
>>> On Tue, 1 Feb 2022 08:27:54 -0500
>>> Dayne Filer <dayne.filer at gmail.com> wrote:
>>> 
>>>> I do not directly import or use any DBI functions.
>>> 
>>> 00install.out says:
>>> 
>>>>> Warning: namespace ?DBI? is not available and has been replaced
>>>>> by .GlobalEnv when processing object ?txp_example_model?
>>> 
>>> Should the txp_example_model object reference the DBI namespace?
>>> 
>>> I don't know the "right" solution here, but a similar problem has been
>>> discussed here in R-pkg-devel some time ago:
>>> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html
>>> 
>>> You might have to depend on DBI explicitly because your data() object
>>> uses it, but then `R CMD check` might object that you don't explicitly
>>> import anything from it. One admittedly verbose way to work around that
>>> would be to move the data file to inst/ and load it from
>>> data/txp_example_model.R only after loadNamespace('DBI'), like some
>>> data scripts do in the Matrix package.
>>> 
>>> -- 
>>> Best regards,
>>> Ivan
>> ______________________________________________
>> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel <https://stat.ethz.ch/mailman/listinfo/r-package-devel>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Feb  1 19:31:06 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 1 Feb 2022 13:31:06 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <5EF08F68-A5C4-41C3-BBC1-2C5572C9E6DF@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
 <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>
 <5EF08F68-A5C4-41C3-BBC1-2C5572C9E6DF@gmail.com>
Message-ID: <1dafe58d-bc4a-da69-925e-519bc74440ba@gmail.com>

On 01/02/2022 12:29 p.m., Dayne Filer wrote:
> I see. And yes, I could only track DBI down though suggests from knitr & 
> S4Vectors. The best answer then, it to suggest DBI?

That should be sufficient, but I think in the previous case it may have 
triggered a different message.

The theory is that your package should gracefully handle situations 
where suggested packages aren't present, by testing for them and falling 
back to some message to the user if they are not present.  The only way 
I know to do that for objects in the data directory is with a script to 
load them, as described in the previous thread.  Your script should work 
whether or not DBI can be loaded. If it can't be, it's fine to give a 
message (not an error) that you loaded a stub instead of the requested 
dataset (or maybe not to load anything at all, I'm not sure).

Duncan Murdoch

> 
> Thanks,
> 
> Dayne
> 
>> On Feb 1, 2022, at 12:25 PM, Duncan Murdoch <murdoch.duncan at gmail.com 
>> <mailto:murdoch.duncan at gmail.com>> wrote:
>>
>> On 01/02/2022 12:13 p.m., Dayne Filer wrote:
>>> Thanks, Ivan!
>>> I completely missed the warning in the install.out file and had no 
>>> idea where this was coming from. The object has a slot with a class 
>>> inheriting from the S4Vectors package. Based on the very helpful 
>>> thread you suggested, it appears that is the crux. The odd thing is 
>>> that unlike the ade4 package which was NOT importing anything from 
>>> the offending sp package, I list S4Vectors as an import. Why would, 
>>> if the S4Vectors package has some dependencies on the DBI package 
>>> (probably by way of the AnnotationDbi package?) would DBI not be 
>>> installed?
>>
>> S4Vectors is a Bioconductor package, and its current version (0.32.3) 
>> doesn't list any imports. ?It has just one non-base dependency 
>> (BiocGenerics) and a list of 10 suggested packages. These dependencies 
>> may be different if you have a different version.
>>
>> Normally suggested packages of the one being tested are loaded, but 
>> not suggested packages of packages it uses. ?So it's probably one of 
>> those suggested packages that needs DBI.
>>
>> Duncan Murdoch
>>
>>> Thanks, All!
>>> Dayne
>>>> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com 
>>>> <mailto:krylov.r00t at gmail.com>> wrote:
>>>>
>>>> On Tue, 1 Feb 2022 08:27:54 -0500
>>>> Dayne Filer <dayne.filer at gmail.com <mailto:dayne.filer at gmail.com>> 
>>>> wrote:
>>>>
>>>>> I do not directly import or use any DBI functions.
>>>>
>>>> 00install.out says:
>>>>
>>>>>> Warning: namespace ?DBI? is not available and has been replaced
>>>>>> by .GlobalEnv when processing object ?txp_example_model?
>>>>
>>>> Should the txp_example_model object reference the DBI namespace?
>>>>
>>>> I don't know the "right" solution here, but a similar problem has been
>>>> discussed here in R-pkg-devel some time ago:
>>>> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html 
>>>> <https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html>
>>>>
>>>> You might have to depend on DBI explicitly because your data() object
>>>> uses it, but then `R CMD check` might object that you don't explicitly
>>>> import anything from it. One admittedly verbose way to work around that
>>>> would be to move the data file to inst/ and load it from
>>>> data/txp_example_model.R only after loadNamespace('DBI'), like some
>>>> data scripts do in the Matrix package.
>>>>
>>>> --
>>>> Best regards,
>>>> Ivan
>>> ______________________________________________
>>> R-package-devel at r-project.org 
>>> <mailto:R-package-devel at r-project.org>mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel 
>>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From p|owr|ght@@ndrew @end|ng |rom gm@||@com  Tue Feb  1 21:20:08 2022
From: p|owr|ght@@ndrew @end|ng |rom gm@||@com (Andrew Plowright)
Date: Tue, 1 Feb 2022 12:20:08 -0800
Subject: [R-pkg-devel] New 'extptr.as.ref' argument in identical() causing
 check failures
Message-ID: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>

Hello, I have an 'identical()' method in my library

https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198

I recently started getting a warning message regarding a new
'extptr.as.ref' argument that was added to R-devel in December. When
running devtools::check_rhub() I get:

```
* checking for code/documentation mismatches ... WARNING
identical
                 TRUE, ignore.bytecode = TRUE, ignore.environment =
                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
Codoc mismatches from documentation object 'identical':
  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
                 TRUE, ignore.bytecode = TRUE, ignore.environment =
                 FALSE, ignore.srcref = TRUE)
  Argument names in code not in docs:
    extptr.as.ref
```

I tried adding the 'extptr.as.ref' argument to my documentation, but now I
get a new warning:

```
  Documented arguments not in \usage in documentation object 'identical':

    'extptr.as.ref'
  Functions with \usage entries need to have the appropriate \alias
  entries, and all their arguments documented.
  The \usage entries must correspond to syntactically valid R code.
  See chapter 'Writing R documentation files' in the 'Writing R
  Extensions' manual.
```

So it seems that a warning is being generated both with or without the
extptr.as.ref in my documentation. Any help would be appreciated, thanks!

Andrew

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Feb  2 01:45:00 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 2 Feb 2022 13:45:00 +1300
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
Message-ID: <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>

Andrew,

you should not re-define identical, it is not a semantic operation and does NOT test equality. Did you mean to write a `==` method instead?

Cheers,
Simon



> On Feb 2, 2022, at 9:20 AM, Andrew Plowright <plowright.andrew at gmail.com> wrote:
> 
> Hello, I have an 'identical()' method in my library
> 
> https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> 
> I recently started getting a warning message regarding a new
> 'extptr.as.ref' argument that was added to R-devel in December. When
> running devtools::check_rhub() I get:
> 
> ```
> * checking for code/documentation mismatches ... WARNING
> identical
>                 TRUE, ignore.bytecode = TRUE, ignore.environment =
>                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
>  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> Codoc mismatches from documentation object 'identical':
>  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
>                 TRUE, ignore.bytecode = TRUE, ignore.environment =
>                 FALSE, ignore.srcref = TRUE)
>  Argument names in code not in docs:
>    extptr.as.ref
> ```
> 
> I tried adding the 'extptr.as.ref' argument to my documentation, but now I
> get a new warning:
> 
> ```
>  Documented arguments not in \usage in documentation object 'identical':
> 
>    'extptr.as.ref'
>  Functions with \usage entries need to have the appropriate \alias
>  entries, and all their arguments documented.
>  The \usage entries must correspond to syntactically valid R code.
>  See chapter 'Writing R documentation files' in the 'Writing R
>  Extensions' manual.
> ```
> 
> So it seems that a warning is being generated both with or without the
> extptr.as.ref in my documentation. Any help would be appreciated, thanks!
> 
> Andrew
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From p|owr|ght@@ndrew @end|ng |rom gm@||@com  Wed Feb  2 03:01:40 2022
From: p|owr|ght@@ndrew @end|ng |rom gm@||@com (Andrew Plowright)
Date: Tue, 1 Feb 2022 18:01:40 -0800
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
 <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
Message-ID: <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>

Hi Simon,

Thanks for your reply. I guess I could use == instead. What I want is a
method for checking if two S4 class objects are the same. I thought that ==
was strictly meant for atomic and list types?

Andrew

On Tue, Feb 1, 2022 at 4:45 PM Simon Urbanek <simon.urbanek at r-project.org>
wrote:

> Andrew,
>
> you should not re-define identical, it is not a semantic operation and
> does NOT test equality. Did you mean to write a `==` method instead?
>
> Cheers,
> Simon
>
>
>
> > On Feb 2, 2022, at 9:20 AM, Andrew Plowright <plowright.andrew at gmail.com>
> wrote:
> >
> > Hello, I have an 'identical()' method in my library
> >
> >
> https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> >
> > I recently started getting a warning message regarding a new
> > 'extptr.as.ref' argument that was added to R-devel in December. When
> > running devtools::check_rhub() I get:
> >
> > ```
> > * checking for code/documentation mismatches ... WARNING
> > identical
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
> >  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > Codoc mismatches from documentation object 'identical':
> >  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE)
> >  Argument names in code not in docs:
> >    extptr.as.ref
> > ```
> >
> > I tried adding the 'extptr.as.ref' argument to my documentation, but now
> I
> > get a new warning:
> >
> > ```
> >  Documented arguments not in \usage in documentation object 'identical':
> >
> >    'extptr.as.ref'
> >  Functions with \usage entries need to have the appropriate \alias
> >  entries, and all their arguments documented.
> >  The \usage entries must correspond to syntactically valid R code.
> >  See chapter 'Writing R documentation files' in the 'Writing R
> >  Extensions' manual.
> > ```
> >
> > So it seems that a warning is being generated both with or without the
> > extptr.as.ref in my documentation. Any help would be appreciated, thanks!
> >
> > Andrew
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Feb  2 03:57:24 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 2 Feb 2022 15:57:24 +1300
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
 <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
 <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>
Message-ID: <9136D82D-675B-4F9B-A391-0017D0EB94CC@R-project.org>



> On Feb 2, 2022, at 3:01 PM, Andrew Plowright <plowright.andrew at gmail.com> wrote:
> 
> Hi Simon,
> 
> Thanks for your reply. I guess I could use == instead. What I want is a method for checking if two S4 class objects are the same. I thought that == was strictly meant for atomic and list types?
> 


identical() already checks that two objects S4 are the same - so if that's what you want, then you don't need to do anything, R provides.

I assumed you want to decide if two objects are semantically equal even if the two objects are not identical, but can still be equal - let's say because you include some additional information in the object that you want to skip when deciding equivalence. In that case == is the way to go. If your object does not have vector semantics, then you just return a scalar, e.g. let's take an example from a class you're familiar with:

WGS84 and EPSG: 4326 are the same CRS:

> st_crs("WGS84") == st_crs(4326)
[1] TRUE

but the objects are not necessarily identical:

> identical(st_crs("WGS84"), st_crs(4326))
[1] FALSE

Cheers,
Simon



> Andrew
> 
> On Tue, Feb 1, 2022 at 4:45 PM Simon Urbanek <simon.urbanek at r-project.org> wrote:
> Andrew,
> 
> you should not re-define identical, it is not a semantic operation and does NOT test equality. Did you mean to write a `==` method instead?
> 
> Cheers,
> Simon
> 
> 
> 
> > On Feb 2, 2022, at 9:20 AM, Andrew Plowright <plowright.andrew at gmail.com> wrote:
> > 
> > Hello, I have an 'identical()' method in my library
> > 
> > https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> > 
> > I recently started getting a warning message regarding a new
> > 'extptr.as.ref' argument that was added to R-devel in December. When
> > running devtools::check_rhub() I get:
> > 
> > ```
> > * checking for code/documentation mismatches ... WARNING
> > identical
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
> >  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > Codoc mismatches from documentation object 'identical':
> >  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE)
> >  Argument names in code not in docs:
> >    extptr.as.ref
> > ```
> > 
> > I tried adding the 'extptr.as.ref' argument to my documentation, but now I
> > get a new warning:
> > 
> > ```
> >  Documented arguments not in \usage in documentation object 'identical':
> > 
> >    'extptr.as.ref'
> >  Functions with \usage entries need to have the appropriate \alias
> >  entries, and all their arguments documented.
> >  The \usage entries must correspond to syntactically valid R code.
> >  See chapter 'Writing R documentation files' in the 'Writing R
> >  Extensions' manual.
> > ```
> > 
> > So it seems that a warning is being generated both with or without the
> > extptr.as.ref in my documentation. Any help would be appreciated, thanks!
> > 
> > Andrew
> > 
> >       [[alternative HTML version deleted]]
> > 
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> > 
> 


From p|owr|ght@@ndrew @end|ng |rom gm@||@com  Wed Feb  2 06:16:49 2022
From: p|owr|ght@@ndrew @end|ng |rom gm@||@com (Andrew Plowright)
Date: Tue, 1 Feb 2022 21:16:49 -0800
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <9136D82D-675B-4F9B-A391-0017D0EB94CC@R-project.org>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
 <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
 <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>
 <9136D82D-675B-4F9B-A391-0017D0EB94CC@R-project.org>
Message-ID: <CAOHs3k2kNUA4NomLxtGckx4UR-QsCS1yQXDO9YXmuTVqaM-R7Q@mail.gmail.com>

Great example, that makes perfect sense.

I'll just drop the identical method. Easy fix!

Thanks,
Andrew

On Tue, Feb 1, 2022 at 6:57 PM Simon Urbanek <simon.urbanek at r-project.org>
wrote:

>
>
> > On Feb 2, 2022, at 3:01 PM, Andrew Plowright <plowright.andrew at gmail.com>
> wrote:
> >
> > Hi Simon,
> >
> > Thanks for your reply. I guess I could use == instead. What I want is a
> method for checking if two S4 class objects are the same. I thought that ==
> was strictly meant for atomic and list types?
> >
>
>
> identical() already checks that two objects S4 are the same - so if that's
> what you want, then you don't need to do anything, R provides.
>
> I assumed you want to decide if two objects are semantically equal even if
> the two objects are not identical, but can still be equal - let's say
> because you include some additional information in the object that you want
> to skip when deciding equivalence. In that case == is the way to go. If
> your object does not have vector semantics, then you just return a scalar,
> e.g. let's take an example from a class you're familiar with:
>
> WGS84 and EPSG: 4326 are the same CRS:
>
> > st_crs("WGS84") == st_crs(4326)
> [1] TRUE
>
> but the objects are not necessarily identical:
>
> > identical(st_crs("WGS84"), st_crs(4326))
> [1] FALSE
>
> Cheers,
> Simon
>
>
>
> > Andrew
> >
> > On Tue, Feb 1, 2022 at 4:45 PM Simon Urbanek <
> simon.urbanek at r-project.org> wrote:
> > Andrew,
> >
> > you should not re-define identical, it is not a semantic operation and
> does NOT test equality. Did you mean to write a `==` method instead?
> >
> > Cheers,
> > Simon
> >
> >
> >
> > > On Feb 2, 2022, at 9:20 AM, Andrew Plowright <
> plowright.andrew at gmail.com> wrote:
> > >
> > > Hello, I have an 'identical()' method in my library
> > >
> > >
> https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> > >
> > > I recently started getting a warning message regarding a new
> > > 'extptr.as.ref' argument that was added to R-devel in December. When
> > > running devtools::check_rhub() I get:
> > >
> > > ```
> > > * checking for code/documentation mismatches ... WARNING
> > > identical
> > >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> > >                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
> > >  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > > Codoc mismatches from documentation object 'identical':
> > >  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> > >                 FALSE, ignore.srcref = TRUE)
> > >  Argument names in code not in docs:
> > >    extptr.as.ref
> > > ```
> > >
> > > I tried adding the 'extptr.as.ref' argument to my documentation, but
> now I
> > > get a new warning:
> > >
> > > ```
> > >  Documented arguments not in \usage in documentation object
> 'identical':
> > >
> > >    'extptr.as.ref'
> > >  Functions with \usage entries need to have the appropriate \alias
> > >  entries, and all their arguments documented.
> > >  The \usage entries must correspond to syntactically valid R code.
> > >  See chapter 'Writing R documentation files' in the 'Writing R
> > >  Extensions' manual.
> > > ```
> > >
> > > So it seems that a warning is being generated both with or without the
> > > extptr.as.ref in my documentation. Any help would be appreciated,
> thanks!
> > >
> > > Andrew
> > >
> > >       [[alternative HTML version deleted]]
> > >
> > > ______________________________________________
> > > R-package-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> > >
> >
>
>

	[[alternative HTML version deleted]]


From v|ncentv@nhee@ @end|ng |rom gm@||@com  Wed Feb  2 10:46:57 2022
From: v|ncentv@nhee@ @end|ng |rom gm@||@com (Vincent van Hees)
Date: Wed, 2 Feb 2022 10:46:57 +0100
Subject: [R-pkg-devel] invalid file URI: 5%B
Message-ID: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>

Hello,
I received the following response from CRAN after submitting my package:

Thanks, we see:
Found the following (possibly) invalid file URI:
  URI: %5B
    From: inst/doc/GGIR.html
Please fix and resubmit.

Link to win-builder log:
https://win-builder.r-project.org/incoming_pretest/GGIR_2.6-0_20220201_151400/Windows/00check.log

May I assume that this relates to a link inside my package vignette?

My vignette has many links of various types. How can I find out which one
is the problematic one? For example, does %5B provide an indication of the
location in the code or does it tell me the type of link (internal link to
file, internal link to vignette section, or external url)?

My vignette code is here:
https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd

Any help will be much appreciated,
Vincent

	[[alternative HTML version deleted]]


From e@ @end|ng |rom enr|co@chum@nn@net  Wed Feb  2 10:56:12 2022
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Wed, 02 Feb 2022 10:56:12 +0100
Subject: [R-pkg-devel] invalid file URI: 5%B
In-Reply-To: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
 (Vincent van Hees's message of "Wed, 2 Feb 2022 10:46:57 +0100")
References: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
Message-ID: <87sft18udf.fsf@enricoschumann.net>

On Wed, 02 Feb 2022, Vincent van Hees writes:

> Hello,
> I received the following response from CRAN after submitting my package:
>
> Thanks, we see:
> Found the following (possibly) invalid file URI:
>   URI: %5B
>     From: inst/doc/GGIR.html
> Please fix and resubmit.
>
> Link to win-builder log:
> https://win-builder.r-project.org/incoming_pretest/GGIR_2.6-0_20220201_151400/Windows/00check.log
>
> May I assume that this relates to a link inside my package vignette?
>
> My vignette has many links of various types. How can I find out which one
> is the problematic one? For example, does %5B provide an indication of the
> location in the code or does it tell me the type of link (internal link to
> file, internal link to vignette section, or external url)?
>
> My vignette code is here:
> https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd
>
> Any help will be much appreciated,
> Vincent
>

URLencode("[", reserved = TRUE)
## [1] "%5B"

Do you have any links with brackets?


-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Feb  2 11:07:29 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 2 Feb 2022 13:07:29 +0300
Subject: [R-pkg-devel] invalid file URI: 5%B
In-Reply-To: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
References: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
Message-ID: <20220202130729.65fd18d9@Tarkus>

On Wed, 2 Feb 2022 10:46:57 +0100
Vincent van Hees <vincentvanhees at gmail.com> wrote:

> May I assume that this relates to a link inside my package vignette?

That's true.

> My vignette has many links of various types. How can I find out which
> one is the problematic one?

Take a look at inst/doc/GGIR.html in the R CMD build output and search
for "%5B".

> For example, does %5B provide an indication of the location in the
> code or does it tell me the type of link (internal link to file,
> internal link to vignette section, or external url)?

Unfortunately, there's no indication of the location. According to the
code of R CMD check (src/library/tools/R/QC.R in the R source code),
"%5B" is the whole link. Apparently, a square bracket got wrongly
interpreted as a link destination somewhere inside your document. Most
likely, the link on line 1158 has an unnecessary "[":
https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd#L1158

-- 
Best regards,
Ivan


From v|ncentv@nhee@ @end|ng |rom gm@||@com  Wed Feb  2 11:54:35 2022
From: v|ncentv@nhee@ @end|ng |rom gm@||@com (Vincent van Hees)
Date: Wed, 2 Feb 2022 11:54:35 +0100
Subject: [R-pkg-devel] invalid file URI: 5%B
In-Reply-To: <20220202130729.65fd18d9@Tarkus>
References: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
 <20220202130729.65fd18d9@Tarkus>
Message-ID: <CALnEB15xKi3W3DU9VRf8UOAduE+WcUuM1mb5w5VJZOZQZQNdYg@mail.gmail.com>

That fixed the issue. Thanks a lot Ivan and Enrico!

On Wed, 2 Feb 2022 at 11:07, Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Wed, 2 Feb 2022 10:46:57 +0100
> Vincent van Hees <vincentvanhees at gmail.com> wrote:
>
> > May I assume that this relates to a link inside my package vignette?
>
> That's true.
>
> > My vignette has many links of various types. How can I find out which
> > one is the problematic one?
>
> Take a look at inst/doc/GGIR.html in the R CMD build output and search
> for "%5B".
>
> > For example, does %5B provide an indication of the location in the
> > code or does it tell me the type of link (internal link to file,
> > internal link to vignette section, or external url)?
>
> Unfortunately, there's no indication of the location. According to the
> code of R CMD check (src/library/tools/R/QC.R in the R source code),
> "%5B" is the whole link. Apparently, a square bracket got wrongly
> interpreted as a link destination somewhere inside your document. Most
> likely, the link on line 1158 has an unnecessary "[":
> https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd#L1158
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Feb  6 04:32:05 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 6 Feb 2022 16:32:05 +1300
Subject: [R-pkg-devel] Stack smashing detected (dynamically loaded Fortran).
Message-ID: <20220206163205.7d4121e3@rolf-Latitude-E7470>


In the past when I've got the "stack smashing detected" error, it turned
out to be due to that fact that I'd omitted an argument in a call to a
Fortran subroutine, or had in some similar way buggered up an argument
list.

In this instance, I've been tearing my hair out all day and can find no
discrepancies between argument lists in calls and in the code of
subroutines called.

The output that I get from valgrind (see the attached file "smash.txt")
does not enlighten me.  Perhaps someone cleverer than I can extract
useful information from it.  Or perhaps someone can suggest some other
means of discerning what is going wrong.

Should anyone have the inclination and patience to delve further, I have
made a tarball of (a somewhat stripped down version of) the problematic
code and put it up on my web page.  To get to it, go to

    https://www.stat.auckland.ac.nz/~rolf/

scroll down to the bottom and click on "Smash".

If you feel motivated to do so, download the tarball, extract the
contents ("tar xvf smash.tar.gz"), execute "R -d valgrind" in the
directory into which you downloaded smash.tar.gz, and then execute
source("demo.R").

If you amend the Fortran code you will of course need to rebuild the
shared library object:  R CMD SHLIB -o demo.so *.f

The Fortran code is pretty opaque since I actually wrote the code in
ratfor and then compiled it into Fortran.  If you have ratfor on your
system you could amend the *.r files (included in the tarball) and then
execute "makefor" (also in the tarball) to build the Fortran code.
    
I'd be grateful for any insight that anyone can provide.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: smash.txt
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20220206/13526cac/attachment.txt>

From kry|ov@r00t @end|ng |rom gm@||@com  Sun Feb  6 10:45:15 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 6 Feb 2022 12:45:15 +0300
Subject: [R-pkg-devel] 
 Stack smashing detected (dynamically loaded Fortran).
In-Reply-To: <20220206163205.7d4121e3@rolf-Latitude-E7470>
References: <20220206163205.7d4121e3@rolf-Latitude-E7470>
Message-ID: <20220206124515.1257c6b4@Tarkus>

On Sun, 6 Feb 2022 16:32:05 +1300
Rolf Turner <r.turner at auckland.ac.nz> wrote:

> The output that I get from valgrind (see the attached file
> "smash.txt") does not enlighten me.

For whatever reason, Valgrind doesn't see the error. I think it's the
compiler-provided stack canary that complains.

I've been able to get a slightly more informative error from
AddressSanitizer, by putting the following in ~/.R/Makevars:

FFLAGS=-g -Og -fsanitize=address
FCFLAGS=-g -Og -fsanitize=address

(you'll probably want to comment that out once you're done)

then building demo.so like this:

R CMD SHLIB -o demo.so *.f -fsanitize=address

*and* starting R like this (GNU/Linux-specific):

LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libasan.so.5 R

(The ASan version could be different on your machine.)

This gives us a line number (stack overflow in prephi.f:50). Somehow,
d2u is only of size 8 bytes (one double?) and is being overflown by
accessing its second index, despite it being declared as containing
`kstate` doubles and `k` being limited by `kstate`.

Here's how we can combine GDB and AddressSanitizer in dynamically
loaded code in R without recompililng R itself with ASan support:

R -d gdb
set environment LD_PRELOAD /usr/lib/x86_64-linux-gnu/libasan.so.5
set environment ASAN_OPTIONS abort_on_error=1
run

(GDB stops when ASan raises SIGABRT and lets us explore the program at
the time of the crash.)

Here I realised that d2u is a parameter, not a local variable. I
climbed two frames up into the getgl subroutine and found out that d2u
is defined as real(kind=8), without a dimension. This must be the
reason for the stack corruption. Same goes for d2zeta.

Unfortunately, demo.so keeps crashing R, seemingly because of memory
corruption (e.g. the function name turns out to be overwritten when
producing the error message 'array overflow in .Fortran("%s")'), but
only with certain combinations of build options, and ASan isn't helping
any more. An ASan build of R would probably help.

-- 
Best regards,
Ivan

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: asan_crash.txt
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20220206/047d26f2/attachment.txt>

From kry|ov@r00t @end|ng |rom gm@||@com  Sun Feb  6 11:25:48 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 6 Feb 2022 13:25:48 +0300
Subject: [R-pkg-devel] 
 Stack smashing detected (dynamically loaded Fortran).
In-Reply-To: <20220206124515.1257c6b4@Tarkus>
References: <20220206163205.7d4121e3@rolf-Latitude-E7470>
 <20220206124515.1257c6b4@Tarkus>
Message-ID: <20220206132548.0c9b08c8@Tarkus>

On Sun, 6 Feb 2022 12:45:15 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

> Unfortunately, demo.so keeps crashing R, seemingly because of memory
> corruption (e.g. the function name turns out to be overwritten when
> producing the error message 'array overflow in .Fortran("%s")')

I installed debugging symbols for R, set a watchpoint on the local
symName in function do_dotCode, one call frame above subroutine getgl,
and it hit:

Thread 1 "R" hit Watchpoint 3: symName

0x00007ffff24bb6a3 in derivf (fy=..., ndistr=4, zeta=..., sigma=...,
size=1, y=1, ymiss=0, dmat=..., kstate=2, npar=10, nphi=8, nyv=5,
nxc=1, d1f=..., d2f=..., d1zeta=..., d2zeta=..., d1u=..., d2u=...,
nd=1, epars=..., den=...) at derivf.f:59
 59            d2f(j,k,l) = epars(iy,j)*(a-b+c)/den(j)**2

d2f is declared to have dimensions (kstate,npar,npar) in derivf.f, but
is only a real(kind=8) in its caller, getgl.f. Setting the correct
dimensions in getgl.f seems to fix the crash.

-- 
Best regards,
Ivan


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Feb  6 21:00:58 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Mon, 7 Feb 2022 09:00:58 +1300
Subject: [R-pkg-devel] 
 Stack smashing detected (dynamically loaded Fortran).
In-Reply-To: <20220206132548.0c9b08c8@Tarkus>
References: <20220206163205.7d4121e3@rolf-Latitude-E7470>
 <20220206124515.1257c6b4@Tarkus> <20220206132548.0c9b08c8@Tarkus>
Message-ID: <20220207090058.637e9e27@rolf-Latitude-E7470>


On Sun, 6 Feb 2022 13:25:48 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

<SNIP>

> d2f is declared to have dimensions (kstate,npar,npar) in derivf.f, but
> is only a real(kind=8) in its caller, getgl.f. Setting the correct
> dimensions in getgl.f seems to fix the crash.

Aaaarrrghhhh!  Yes, that must be it. (And likewise with d2u, d2zeta,
...).  I was trying to use derivf to handle settings in which I only
wanted first derivatives as well as ones in which I wanted both first
and second derivatives.  And I buggered it up. As me high school mates
used to tell me, if I had a brain, I'd be sitting on the floor playing
with it!

Thanks Ivan for your diligent, well organised and clever tracking down
of the problem.  I shall retain your email with the illustration of
using "AddressSanitizer" etc., for future reference.

Thanks again.  I owe you, big-time!

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From th|erry@onke||nx @end|ng |rom |nbo@be  Mon Feb  7 15:55:18 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Mon, 7 Feb 2022 15:55:18 +0100
Subject: [R-pkg-devel] using a class from a suggested package
Message-ID: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>

Dear all,

My package A defines an S4 method for the "inla" S3 class. The INLA package
defines this class. That package has a huge source, making the build fail
on r-universe.dev. The solution is to not importClassesFrom(INLA, inla) but
use setOldClass("inla"). Then I can list INLA under Suggests instead of
Imports. So far so good.

My package B defines S4 objects with a superclass "maybeINLA" defined
as setClassUnion("maybeInla", c("inla", "NULL")). It also imports the
method from package A which handles the "inla" class. This is where I'm
gettin stuck.
- importClassesFrom(INLA, inla) works, but then I can't Suggests INLA.
- using setOldClass("inla") yields an R CMD check warning: "class "inla" is
defined (with package slot ?A?) but no metadata object found to revise
superClass information---not imported?  Making a copy in package ?B? "
- having exportClasses(inla) in package A and importClassesFrom(A, inla) in
package B works but this displays the message "Found more than one class
"inla" in cache; using the first, from namespace 'A' Also defined by 'INLA'
".

How can I use the "inla" class in package B while Suggesting the INLA
package and not have the warnings/messages?

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>

	[[alternative HTML version deleted]]


From |j|ytt|e @end|ng |rom me@com  Tue Feb  8 01:58:08 2022
From: |j|ytt|e @end|ng |rom me@com (Ian Lyttle)
Date: Mon, 7 Feb 2022 18:58:08 -0600
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
Message-ID: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>

?I am trying to check a package release-candidate on win-builder r-devel. This package imports a recently-released version of another package, {vegawidget}.
The check on win-builder (r-devel) fails:
* checking package dependencies ... ERROR
Package required and available but unsuitable version: 'vegawidget'
{vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently not available to win-builder r-devel.
For what it?s worth, the check passes for win-builder r-release and r-oldrel.
Is this just a matter of me needing to be more patient, or could there be something ?stuck? at win-builder?
Thanks!



	[[alternative HTML version deleted]]


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Tue Feb  8 15:55:17 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Tue, 8 Feb 2022 09:55:17 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
Message-ID: <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>

For what it's worth, I am seeing a similar issue.

I am trying to make a release that depends on the hardhat package, which
made a release on 2022-01-24, and it's still unavailable to check on
WinDevel. I am also depending on the newest release of gtsummary which was
made available on CRAN on 2022-01-29 (after hardhat's release). The
gtsummary package, however, became available on WinDevel a few days later.

Thank you,
Daniel

On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
>
> I am trying to check a package release-candidate on win-builder r-devel.
This package imports a recently-released version of another package,
{vegawidget}.
> The check on win-builder (r-devel) fails:
> * checking package dependencies ... ERROR
> Package required and available but unsuitable version: 'vegawidget'
> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently
not available to win-builder r-devel.
> For what it?s worth, the check passes for win-builder r-release and
r-oldrel.
> Is this just a matter of me needing to be more patient, or could there be
something ?stuck? at win-builder?
> Thanks!
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Feb  9 10:45:05 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 9 Feb 2022 12:45:05 +0300
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
Message-ID: <20220209124505.352ebbee@arachnoid>

On Mon, 7 Feb 2022 15:55:18 +0100
Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:

> My package A defines an S4 method for the "inla" S3 class. The INLA
> package defines this class. That package has a huge source, making
> the build fail on r-universe.dev. The solution is to not
> importClassesFrom(INLA, inla) but use setOldClass("inla"). Then I can
> list INLA under Suggests instead of Imports. So far so good.

This is a really complicated situation to be in.

On the one hand, the only documented way to use S4 classes from another
package is NAMESPACE and importClassesFrom(), which leads to stronger
dependencies than you would like. On the other hand, you're likely to
get warnings if more than one loaded namespace define S4 classes with
the same name, to it's a good idea to avoid calling setOldClass('inla')
in the A package if INLA can be loaded.

Could it be an option to define the "maybeInla" class in the A package,
initially as "NULL", and then extend it at runtime using getClassDef?

setClassUnion('maybeInla', 'NULL')

.onLoad <- function(...) {
# ...
 if (requireNamespace('INLA', quietly = TRUE)) {
  setIs(getClassDef('inla', package = 'INLA'), 'maybeInla')
 }
# ...
}

If INLA can't be loaded, then there's (ostensibly) no way to create
"inla" objects in the current session, and "NULL" is as good a
definition as it would get. Then B could import the maybeInla class
from A.

-- 
Best regards,
Ivan


From th|erry@onke||nx @end|ng |rom |nbo@be  Wed Feb  9 12:25:14 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Wed, 9 Feb 2022 12:25:14 +0100
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <20220209124505.352ebbee@arachnoid>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
 <20220209124505.352ebbee@arachnoid>
Message-ID: <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>

Dear Ivan,

Thanks for the suggestion. Something strange is happening. When I run
getClassDef("inla", package = "INLA") is a fresh session I get.

Virtual Class "inla" [package "INLA"]

Slots:

Name:   .S3Class
Class: character

Extends: "oldClass"

However when package A is loaded first, I get. Since package B imports
package A, the namespace of A is loaded when building B.

Virtual Class "inla" [package "A"]

Slots:

Name:   .S3Class
Class: character

Extends: "oldClass"
Building package B with the code below yields Warning: class "inla" is
defined (with package slot ?A?) but no metadata object found to revise
superClass information---not imported?  Making a copy in package ?B?

setClassUnion("maybeInla", "NULL")
#' @importFrom methods getClassDef setIs
.onLoad <- function(...) {
  if (requireNamespace("INLA", quietly = TRUE)) {
    setIs("inla", "maybeInla", classDef = getClassDef("inla", package =
"INLA"))
  }
}
Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op wo 9 feb. 2022 om 10:45 schreef Ivan Krylov <krylov.r00t at gmail.com>:

> On Mon, 7 Feb 2022 15:55:18 +0100
> Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>
> > My package A defines an S4 method for the "inla" S3 class. The INLA
> > package defines this class. That package has a huge source, making
> > the build fail on r-universe.dev. The solution is to not
> > importClassesFrom(INLA, inla) but use setOldClass("inla"). Then I can
> > list INLA under Suggests instead of Imports. So far so good.
>
> This is a really complicated situation to be in.
>
> On the one hand, the only documented way to use S4 classes from another
> package is NAMESPACE and importClassesFrom(), which leads to stronger
> dependencies than you would like. On the other hand, you're likely to
> get warnings if more than one loaded namespace define S4 classes with
> the same name, to it's a good idea to avoid calling setOldClass('inla')
> in the A package if INLA can be loaded.
>
> Could it be an option to define the "maybeInla" class in the A package,
> initially as "NULL", and then extend it at runtime using getClassDef?
>
> setClassUnion('maybeInla', 'NULL')
>
> .onLoad <- function(...) {
> # ...
>  if (requireNamespace('INLA', quietly = TRUE)) {
>   setIs(getClassDef('inla', package = 'INLA'), 'maybeInla')
>  }
> # ...
> }
>
> If INLA can't be loaded, then there's (ostensibly) no way to create
> "inla" objects in the current session, and "NULL" is as good a
> definition as it would get. Then B could import the maybeInla class
> from A.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Feb  9 14:05:55 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 9 Feb 2022 16:05:55 +0300
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
 <20220209124505.352ebbee@arachnoid>
 <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>
Message-ID: <20220209160555.50183736@arachnoid>

On Wed, 9 Feb 2022 12:25:14 +0100
Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:

> However when package A is loaded first, I get

> Virtual Class "inla" [package "A"]

Since you own both packages A and B, how much work would it be to
export maybeInla from package A instead of importing inla in package B?
I'm afraid you won't avoid the warning if package A creates its own
inla and you load package INLA in the same process.

-- 
Best regards,
Ivan


From th|erry@onke||nx @end|ng |rom |nbo@be  Wed Feb  9 16:43:37 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Wed, 9 Feb 2022 16:43:37 +0100
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <20220209160555.50183736@arachnoid>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
 <20220209124505.352ebbee@arachnoid>
 <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>
 <20220209160555.50183736@arachnoid>
Message-ID: <CAJuCY5yg9JWH3jFQm=-nt73UPj1ODpXobUdGs2yWFdmLv9iQyw@mail.gmail.com>

Dear Ivan,

Defining "maybeInla" in package A and importing that in package B solved
the problem. Thanks for your assistance.

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op wo 9 feb. 2022 om 14:05 schreef Ivan Krylov <krylov.r00t at gmail.com>:

> On Wed, 9 Feb 2022 12:25:14 +0100
> Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>
> > However when package A is loaded first, I get
>
> > Virtual Class "inla" [package "A"]
>
> Since you own both packages A and B, how much work would it be to
> export maybeInla from package A instead of importing inla in package B?
> I'm afraid you won't avoid the warning if package A creates its own
> inla and you load package INLA in the same process.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Fri Feb 11 23:22:10 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Fri, 11 Feb 2022 22:22:10 +0000
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
Message-ID: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>

I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).

No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.

I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check? 

Murray

From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Feb 11 23:44:12 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 11 Feb 2022 17:44:12 -0500
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
Message-ID: <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>

On 11/02/2022 5:22 p.m., Murray Efford wrote:
> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
> 
> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
> 
> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?

It's not easy to run just that test, but you can see it if you look here:

https://github.com/wch/r-source/blob/988077a792e628677bd5884b351fe08b2c17b8c8/src/library/tools/R/check.R#L4866-L4941

The basic idea is that it uses the "file" command.  There are some known 
false positives.

If you are on Linux, try running "file OVforest.dbf" and see what it says.

Duncan Murdoch


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Sat Feb 12 00:33:40 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Fri, 11 Feb 2022 23:33:40 +0000
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
Message-ID: <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>

Many thanks for your guidance. Indeed there is a radical change:

$ file OVforest.dbf
OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"

$ file OVforest2.dbf
OVforest2.dbf: amd 29k coff prebar executable

I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...

Murray

________________________________________
From: Duncan Murdoch <murdoch.duncan at gmail.com>
Sent: 12 February 2022 11:44
To: Murray Efford; R-package-devel at r-project.org
Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable

On 11/02/2022 5:22 p.m., Murray Efford wrote:
> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>
> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>
> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?

It's not easy to run just that test, but you can see it if you look here:

https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Ce242631c41c342f47d8908d9edb008b8%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802163497599994%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=Z77T09j1sONATxupZGSmkayrpjt3Ra1g%2FS6vxQq8CJs%3D&amp;reserved=0

The basic idea is that it uses the "file" command.  There are some known
false positives.

If you are on Linux, try running "file OVforest.dbf" and see what it says.

Duncan Murdoch


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Feb 12 00:38:48 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sat, 12 Feb 2022 12:38:48 +1300
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
 <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
Message-ID: <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>

FWIW this seems to be a known issue (for some definition of known):

https://bugs.astron.com/view.php?id=316

A fix is to set your date when writing the DBF file to year 2021 instead of 2022 (which also explains why it worked last year ;)).

Cheers,
Simon





> On Feb 12, 2022, at 12:33 PM, Murray Efford <murray.efford at otago.ac.nz> wrote:
> 
> Many thanks for your guidance. Indeed there is a radical change:
> 
> $ file OVforest.dbf
> OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"
> 
> $ file OVforest2.dbf
> OVforest2.dbf: amd 29k coff prebar executable
> 
> I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...
> 
> Murray
> 
> ________________________________________
> From: Duncan Murdoch <murdoch.duncan at gmail.com>
> Sent: 12 February 2022 11:44
> To: Murray Efford; R-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable
> 
> On 11/02/2022 5:22 p.m., Murray Efford wrote:
>> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>> 
>> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>> 
>> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?
> 
> It's not easy to run just that test, but you can see it if you look here:
> 
> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Ce242631c41c342f47d8908d9edb008b8%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802163497599994%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=Z77T09j1sONATxupZGSmkayrpjt3Ra1g%2FS6vxQq8CJs%3D&amp;reserved=0
> 
> The basic idea is that it uses the "file" command.  There are some known
> false positives.
> 
> If you are on Linux, try running "file OVforest.dbf" and see what it says.
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Feb 12 00:58:28 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sat, 12 Feb 2022 12:58:28 +1300
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
 <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
Message-ID: <BF0395CF-DF50-4472-B2A6-00BB270C59EB@R-project.org>

Also if you just want to "fix" the file, you can simply change the second byte using R:

fn = "myfile.dbf"
sz = file.info(fn)$size
r = readBin(fn, raw(), sz)
r[2] = as.raw(121) ## make it 2021 instead of 2022
writeBin(r, fn)



> On Feb 12, 2022, at 12:38 PM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> FWIW this seems to be a known issue (for some definition of known):
> 
> https://bugs.astron.com/view.php?id=316
> 
> A fix is to set your date when writing the DBF file to year 2021 instead of 2022 (which also explains why it worked last year ;)).
> 
> Cheers,
> Simon
> 
> 
> 
> 
> 
>> On Feb 12, 2022, at 12:33 PM, Murray Efford <murray.efford at otago.ac.nz> wrote:
>> 
>> Many thanks for your guidance. Indeed there is a radical change:
>> 
>> $ file OVforest.dbf
>> OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"
>> 
>> $ file OVforest2.dbf
>> OVforest2.dbf: amd 29k coff prebar executable
>> 
>> I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...
>> 
>> Murray
>> 
>> ________________________________________
>> From: Duncan Murdoch <murdoch.duncan at gmail.com>
>> Sent: 12 February 2022 11:44
>> To: Murray Efford; R-package-devel at r-project.org
>> Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable
>> 
>> On 11/02/2022 5:22 p.m., Murray Efford wrote:
>>> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>>> 
>>> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>>> 
>>> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?
>> 
>> It's not easy to run just that test, but you can see it if you look here:
>> 
>> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Ce242631c41c342f47d8908d9edb008b8%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802163497599994%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=Z77T09j1sONATxupZGSmkayrpjt3Ra1g%2FS6vxQq8CJs%3D&amp;reserved=0
>> 
>> The basic idea is that it uses the "file" command.  There are some known
>> false positives.
>> 
>> If you are on Linux, try running "file OVforest.dbf" and see what it says.
>> 
>> Duncan Murdoch
>> 
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Sat Feb 12 01:41:04 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Sat, 12 Feb 2022 00:41:04 +0000
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
 <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
Message-ID: <SY4PR01MB5658C193B4C72CB1FF2924BEAC319@SY4PR01MB5658.ausprd01.prod.outlook.com>

Amazing. Who would have thought? This works:

OVforest <- sf::st_read("OVforest.shp")
sf::st_write(OVforest, "OVforest3.shp", layer_options = "DBF_DATE_LAST_UPDATE=2021-12-31")

$ file OVforest3.dbf
OVforest3.dbf: FoxBase+/dBase III DBF, 3 records * 12, update-date 121-12-31, codepage ID=0x57, at offset 65 1st record "          0           1           2\032"

Murray

________________________________________
From: Simon Urbanek <simon.urbanek at R-project.org>
Sent: 12 February 2022 12:38
To: Murray Efford
Cc: Duncan Murdoch; R-package-devel at r-project.org
Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable

FWIW this seems to be a known issue (for some definition of known):

https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fbugs.astron.com%2Fview.php%3Fid%3D316&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Cf4c62a1b8f424575c75608d9edb7aa72%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802195379474238%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EGkZIRKQNcdcqXqHJaN7i%2FhCbaJn8r%2FosFUTrPE39ts%3D&amp;reserved=0

A fix is to set your date when writing the DBF file to year 2021 instead of 2022 (which also explains why it worked last year ;)).

Cheers,
Simon





> On Feb 12, 2022, at 12:33 PM, Murray Efford <murray.efford at otago.ac.nz> wrote:
>
> Many thanks for your guidance. Indeed there is a radical change:
>
> $ file OVforest.dbf
> OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"
>
> $ file OVforest2.dbf
> OVforest2.dbf: amd 29k coff prebar executable
>
> I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...
>
> Murray
>
> ________________________________________
> From: Duncan Murdoch <murdoch.duncan at gmail.com>
> Sent: 12 February 2022 11:44
> To: Murray Efford; R-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable
>
> On 11/02/2022 5:22 p.m., Murray Efford wrote:
>> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>>
>> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>>
>> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?
>
> It's not easy to run just that test, but you can see it if you look here:
>
> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Cf4c62a1b8f424575c75608d9edb7aa72%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802195379474238%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=1SkmfSqsvOpA%2Brs3DNCU86VJi6YXuGcSDxLIpjsQ720%3D&amp;reserved=0
>
> The basic idea is that it uses the "file" command.  There are some known
> false positives.
>
> If you are on Linux, try running "file OVforest.dbf" and see what it says.
>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Cf4c62a1b8f424575c75608d9edb7aa72%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802195379474238%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=q9urWht4opl4qfGzLCKDSD8VzDbxo8dquJm14jsxhxc%3D&amp;reserved=0
>


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Sun Feb 13 16:32:14 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Sun, 13 Feb 2022 10:32:14 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
Message-ID: <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>

Is there something wrong with the Windows Dev machine? It's now been 3
weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
still not available in the Win Dev check.

I have this in my DESCRIPTION file:
Imports:
    hardhat (>= 0.2.0)

And still getting this note when running devtools::check_win_devel().

Package required and available but unsuitable version: 'hardhat'

https://cran.r-project.org/package=hardhat

Daniel


On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com>
wrote:

> For what it's worth, I am seeing a similar issue.
>
> I am trying to make a release that depends on the hardhat package, which
> made a release on 2022-01-24, and it's still unavailable to check on
> WinDevel. I am also depending on the newest release of gtsummary which was
> made available on CRAN on 2022-01-29 (after hardhat's release). The
> gtsummary package, however, became available on WinDevel a few days later.
>
> Thank you,
> Daniel
>
> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
> >
> > I am trying to check a package release-candidate on win-builder r-devel.
> This package imports a recently-released version of another package,
> {vegawidget}.
> > The check on win-builder (r-devel) fails:
> > * checking package dependencies ... ERROR
> > Package required and available but unsuitable version: 'vegawidget'
> > {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently
> not available to win-builder r-devel.
> > For what it?s worth, the check passes for win-builder r-release and
> r-oldrel.
> > Is this just a matter of me needing to be more patient, or could there
> be something ?stuck? at win-builder?
> > Thanks!
> >
> >
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Feb 13 20:29:31 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 13 Feb 2022 14:29:31 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
Message-ID: <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>

I'd suggest writing to CRAN to point out that they may need to take a 
look, if you haven't already done so.  In the meantime, you can test 
elsewhere (R-hub, Github, your own Windows machine or image, etc.)

Duncan Murdoch

On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
> Is there something wrong with the Windows Dev machine? It's now been 3
> weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
> still not available in the Win Dev check.
> 
> I have this in my DESCRIPTION file:
> Imports:
>      hardhat (>= 0.2.0)
> 
> And still getting this note when running devtools::check_win_devel().
> 
> Package required and available but unsuitable version: 'hardhat'
> 
> https://cran.r-project.org/package=hardhat
> 
> Daniel
> 
> 
> On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com>
> wrote:
> 
>> For what it's worth, I am seeing a similar issue.
>>
>> I am trying to make a release that depends on the hardhat package, which
>> made a release on 2022-01-24, and it's still unavailable to check on
>> WinDevel. I am also depending on the newest release of gtsummary which was
>> made available on CRAN on 2022-01-29 (after hardhat's release). The
>> gtsummary package, however, became available on WinDevel a few days later.
>>
>> Thank you,
>> Daniel
>>
>> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
>>>
>>> I am trying to check a package release-candidate on win-builder r-devel.
>> This package imports a recently-released version of another package,
>> {vegawidget}.
>>> The check on win-builder (r-devel) fails:
>>> * checking package dependencies ... ERROR
>>> Package required and available but unsuitable version: 'vegawidget'
>>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently
>> not available to win-builder r-devel.
>>> For what it?s worth, the check passes for win-builder r-release and
>> r-oldrel.
>>> Is this just a matter of me needing to be more patient, or could there
>> be something ?stuck? at win-builder?
>>> Thanks!
>>>
>>>
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Sun Feb 13 20:33:51 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Sun, 13 Feb 2022 14:33:51 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
 <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
Message-ID: <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>

Thank you so much for the response Duncan!

How does one go about writing to CRAN?

The package is tested and ready to be shipped to CRAN, but since it's
failing on Win Devel, I assumed it would be auto-rejected if I submitted
for a CRAN release.

On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> I'd suggest writing to CRAN to point out that they may need to take a
> look, if you haven't already done so.  In the meantime, you can test
> elsewhere (R-hub, Github, your own Windows machine or image, etc.)
>
> Duncan Murdoch
>
> On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
> > Is there something wrong with the Windows Dev machine? It's now been 3
> > weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
> > still not available in the Win Dev check.
> >
> > I have this in my DESCRIPTION file:
> > Imports:
> >      hardhat (>= 0.2.0)
> >
> > And still getting this note when running devtools::check_win_devel().
> >
> > Package required and available but unsuitable version: 'hardhat'
> >
> > https://cran.r-project.org/package=hardhat
> >
> > Daniel
> >
> >
> > On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com
> >
> > wrote:
> >
> >> For what it's worth, I am seeing a similar issue.
> >>
> >> I am trying to make a release that depends on the hardhat package, which
> >> made a release on 2022-01-24, and it's still unavailable to check on
> >> WinDevel. I am also depending on the newest release of gtsummary which
> was
> >> made available on CRAN on 2022-01-29 (after hardhat's release). The
> >> gtsummary package, however, became available on WinDevel a few days
> later.
> >>
> >> Thank you,
> >> Daniel
> >>
> >> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
> >>>
> >>> I am trying to check a package release-candidate on win-builder
> r-devel.
> >> This package imports a recently-released version of another package,
> >> {vegawidget}.
> >>> The check on win-builder (r-devel) fails:
> >>> * checking package dependencies ... ERROR
> >>> Package required and available but unsuitable version: 'vegawidget'
> >>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
> apparently
> >> not available to win-builder r-devel.
> >>> For what it?s worth, the check passes for win-builder r-release and
> >> r-oldrel.
> >>> Is this just a matter of me needing to be more patient, or could there
> >> be something ?stuck? at win-builder?
> >>> Thanks!
> >>>
> >>>
> >>>
> >>>          [[alternative HTML version deleted]]
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Sun Feb 13 20:40:52 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sun, 13 Feb 2022 14:40:52 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
 <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
 <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
Message-ID: <974fe4a5-ef30-01dc-bd36-4eaf0de34ce8@gmail.com>

   Write to cran at r-project.org , I think ...

On 2/13/22 2:33 PM, Daniel Sjoberg wrote:
> Thank you so much for the response Duncan!
> 
> How does one go about writing to CRAN?
> 
> The package is tested and ready to be shipped to CRAN, but since it's
> failing on Win Devel, I assumed it would be auto-rejected if I submitted
> for a CRAN release.
> 
> On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
> 
>> I'd suggest writing to CRAN to point out that they may need to take a
>> look, if you haven't already done so.  In the meantime, you can test
>> elsewhere (R-hub, Github, your own Windows machine or image, etc.)
>>
>> Duncan Murdoch
>>
>> On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
>>> Is there something wrong with the Windows Dev machine? It's now been 3
>>> weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
>>> still not available in the Win Dev check.
>>>
>>> I have this in my DESCRIPTION file:
>>> Imports:
>>>       hardhat (>= 0.2.0)
>>>
>>> And still getting this note when running devtools::check_win_devel().
>>>
>>> Package required and available but unsuitable version: 'hardhat'
>>>
>>> https://cran.r-project.org/package=hardhat
>>>
>>> Daniel
>>>
>>>
>>> On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com
>>>
>>> wrote:
>>>
>>>> For what it's worth, I am seeing a similar issue.
>>>>
>>>> I am trying to make a release that depends on the hardhat package, which
>>>> made a release on 2022-01-24, and it's still unavailable to check on
>>>> WinDevel. I am also depending on the newest release of gtsummary which
>> was
>>>> made available on CRAN on 2022-01-29 (after hardhat's release). The
>>>> gtsummary package, however, became available on WinDevel a few days
>> later.
>>>>
>>>> Thank you,
>>>> Daniel
>>>>
>>>> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
>>>>>
>>>>> I am trying to check a package release-candidate on win-builder
>> r-devel.
>>>> This package imports a recently-released version of another package,
>>>> {vegawidget}.
>>>>> The check on win-builder (r-devel) fails:
>>>>> * checking package dependencies ... ERROR
>>>>> Package required and available but unsuitable version: 'vegawidget'
>>>>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
>> apparently
>>>> not available to win-builder r-devel.
>>>>> For what it?s worth, the check passes for win-builder r-release and
>>>> r-oldrel.
>>>>> Is this just a matter of me needing to be more patient, or could there
>>>> be something ?stuck? at win-builder?
>>>>> Thanks!
>>>>>
>>>>>
>>>>>
>>>>>           [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Feb 13 21:39:44 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 13 Feb 2022 15:39:44 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
 <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
 <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
Message-ID: <ee24c0a5-4194-4354-3ede-3c010699fd5c@gmail.com>

On 13/02/2022 2:33 p.m., Daniel Sjoberg wrote:
> Thank you so much for the response Duncan!
> 
> How does one go about writing to CRAN?

Ben gave you the address:  cran at r-project.org.
> 
> The package is tested and ready to be shipped to CRAN, but since it's 
> failing on Win Devel, I assumed it would be auto-rejected if I submitted 
> for a CRAN release.

I think CRAN and Winbuilder are separate machines. If CRAN isn't showing 
errors in its tests of the hardhat package then it has probably 
successfully built it and will use it in tests.   Currently it looks fine:

  https://cran.r-project.org/web/checks/check_results_hardhat.html

I do recommend testing on Windows R-devel on one of the other platforms 
I listed before submitting to CRAN.  I don't think auto-rejects waste a 
lot of their time, but it's better to get accepted on the first try.

Duncan Murdoch



>   
> On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <murdoch.duncan at gmail.com 
> <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     I'd suggest writing to CRAN to point out that they may need to take a
>     look, if you haven't already done so.? In the meantime, you can test
>     elsewhere (R-hub, Github, your own Windows machine or image, etc.)
> 
>     Duncan Murdoch
> 
>     On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
>      > Is there something wrong with the Windows Dev machine? It's now
>     been 3
>      > weeks since the release of the hardhat package v 0.2.0 on CRAN,
>     and it's
>      > still not available in the Win Dev check.
>      >
>      > I have this in my DESCRIPTION file:
>      > Imports:
>      >? ? ? hardhat (>= 0.2.0)
>      >
>      > And still getting this note when running devtools::check_win_devel().
>      >
>      > Package required and available but unsuitable version: 'hardhat'
>      >
>      > https://cran.r-project.org/package=hardhat
>     <https://cran.r-project.org/package=hardhat>
>      >
>      > Daniel
>      >
>      >
>      > On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg
>     <danield.sjoberg at gmail.com <mailto:danield.sjoberg at gmail.com>>
>      > wrote:
>      >
>      >> For what it's worth, I am seeing a similar issue.
>      >>
>      >> I am trying to make a release that depends on the hardhat
>     package, which
>      >> made a release on 2022-01-24, and it's still unavailable to check on
>      >> WinDevel. I am also depending on the newest release of gtsummary
>     which was
>      >> made available on CRAN on 2022-01-29 (after hardhat's release). The
>      >> gtsummary package, however, became available on WinDevel a few
>     days later.
>      >>
>      >> Thank you,
>      >> Daniel
>      >>
>      >> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com
>     <mailto:ijlyttle at me.com>> wrote:
>      >>>
>      >>> I am trying to check a package release-candidate on win-builder
>     r-devel.
>      >> This package imports a recently-released version of another package,
>      >> {vegawidget}.
>      >>> The check on win-builder (r-devel) fails:
>      >>> * checking package dependencies ... ERROR
>      >>> Package required and available but unsuitable version: 'vegawidget'
>      >>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
>     apparently
>      >> not available to win-builder r-devel.
>      >>> For what it?s worth, the check passes for win-builder r-release and
>      >> r-oldrel.
>      >>> Is this just a matter of me needing to be more patient, or
>     could there
>      >> be something ?stuck? at win-builder?
>      >>> Thanks!
>      >>>
>      >>>
>      >>>
>      >>>? ? ? ? ? [[alternative HTML version deleted]]
>      >>>
>      >>> ______________________________________________
>      >>> R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>      >>
>      >
>      >? ? ? ?[[alternative HTML version deleted]]
>      >
>      > ______________________________________________
>      > R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From |j|ytt|e @end|ng |rom me@com  Mon Feb 14 13:18:48 2022
From: |j|ytt|e @end|ng |rom me@com (Ian Lyttle)
Date: Mon, 14 Feb 2022 06:18:48 -0600
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <ee24c0a5-4194-4354-3ede-3c010699fd5c@gmail.com>
References: <ee24c0a5-4194-4354-3ede-3c010699fd5c@gmail.com>
Message-ID: <11A938E8-1C89-4A32-9075-1B3BEF0B88EC@me.com>

I tried win-builder (r-devel) again today, everything works for me. Looking forward to a smooth CRAN submission.

Thanks for the support and advice,

Ian


> On Feb 13, 2022, at 2:39 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> ?On 13/02/2022 2:33 p.m., Daniel Sjoberg wrote:
>> Thank you so much for the response Duncan!
>> How does one go about writing to CRAN?
> 
> Ben gave you the address:  cran at r-project.org.
>> The package is tested and ready to be shipped to CRAN, but since it's failing on Win Devel, I assumed it would be auto-rejected if I submitted for a CRAN release.
> 
> I think CRAN and Winbuilder are separate machines. If CRAN isn't showing errors in its tests of the hardhat package then it has probably successfully built it and will use it in tests.   Currently it looks fine:
> 
> https://cran.r-project.org/web/checks/check_results_hardhat.html
> 
> I do recommend testing on Windows R-devel on one of the other platforms I listed before submitting to CRAN.  I don't think auto-rejects waste a lot of their time, but it's better to get accepted on the first try.
> 
> Duncan Murdoch
> 
> 
> 
>>  On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <murdoch.duncan at gmail.com <mailto:murdoch.duncan at gmail.com>> wrote:
>>    I'd suggest writing to CRAN to point out that they may need to take a
>>    look, if you haven't already done so.  In the meantime, you can test
>>    elsewhere (R-hub, Github, your own Windows machine or image, etc.)
>>    Duncan Murdoch
>>    On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
>>     > Is there something wrong with the Windows Dev machine? It's now
>>    been 3
>>     > weeks since the release of the hardhat package v 0.2.0 on CRAN,
>>    and it's
>>     > still not available in the Win Dev check.
>>     >
>>     > I have this in my DESCRIPTION file:
>>     > Imports:
>>     >      hardhat (>= 0.2.0)
>>     >
>>     > And still getting this note when running devtools::check_win_devel().
>>     >
>>     > Package required and available but unsuitable version: 'hardhat'
>>     >
>>     > https://cran.r-project.org/package=hardhat
>>    <https://cran.r-project.org/package=hardhat>
>>     >
>>     > Daniel
>>     >
>>     >
>>     > On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg
>>    <danield.sjoberg at gmail.com <mailto:danield.sjoberg at gmail.com>>
>>     > wrote:
>>     >
>>     >> For what it's worth, I am seeing a similar issue.
>>     >>
>>     >> I am trying to make a release that depends on the hardhat
>>    package, which
>>     >> made a release on 2022-01-24, and it's still unavailable to check on
>>     >> WinDevel. I am also depending on the newest release of gtsummary
>>    which was
>>     >> made available on CRAN on 2022-01-29 (after hardhat's release). The
>>     >> gtsummary package, however, became available on WinDevel a few
>>    days later.
>>     >>
>>     >> Thank you,
>>     >> Daniel
>>     >>
>>     >> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com
>>    <mailto:ijlyttle at me.com>> wrote:
>>     >>>
>>     >>> I am trying to check a package release-candidate on win-builder
>>    r-devel.
>>     >> This package imports a recently-released version of another package,
>>     >> {vegawidget}.
>>     >>> The check on win-builder (r-devel) fails:
>>     >>> * checking package dependencies ... ERROR
>>     >>> Package required and available but unsuitable version: 'vegawidget'
>>     >>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
>>    apparently
>>     >> not available to win-builder r-devel.
>>     >>> For what it?s worth, the check passes for win-builder r-release and
>>     >> r-oldrel.
>>     >>> Is this just a matter of me needing to be more patient, or
>>    could there
>>     >> be something ?stuck? at win-builder?
>>     >>> Thanks!
>>     >>>
>>     >>>
>>     >>>
>>     >>>          [[alternative HTML version deleted]]
>>     >>>
>>     >>> ______________________________________________
>>     >>> R-package-devel at r-project.org
>>    <mailto:R-package-devel at r-project.org> mailing list
>>     >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>    <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>     >>
>>     >
>>     >       [[alternative HTML version deleted]]
>>     >
>>     > ______________________________________________
>>     > R-package-devel at r-project.org
>>    <mailto:R-package-devel at r-project.org> mailing list
>>     > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>    <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> 


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Mon Feb 14 14:06:11 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Mon, 14 Feb 2022 08:06:11 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <11A938E8-1C89-4A32-9075-1B3BEF0B88EC@me.com>
References: <ee24c0a5-4194-4354-3ede-3c010699fd5c@gmail.com>
 <11A938E8-1C89-4A32-9075-1B3BEF0B88EC@me.com>
Message-ID: <CAG5xu55X1yLhHOVynaX8MxVLpivtQseJy3QrjQi25bYD4JosMg@mail.gmail.com>

Thanks Duncan for the advice about the separate dev and production CRAN
systems. While the hardhat pkg was not available on Win Devel, I submitted
to CRAN last night and it was immediately accepted. Much appreciated!

On Mon, Feb 14, 2022, 7:19 AM Ian Lyttle <ijlyttle at me.com> wrote:

> I tried win-builder (r-devel) again today, everything works for me.
> Looking forward to a smooth CRAN submission.
>
> Thanks for the support and advice,
>
> Ian
>
>
> > On Feb 13, 2022, at 2:39 PM, Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
> >
> > ?On 13/02/2022 2:33 p.m., Daniel Sjoberg wrote:
> >> Thank you so much for the response Duncan!
> >> How does one go about writing to CRAN?
> >
> > Ben gave you the address:  cran at r-project.org.
> >> The package is tested and ready to be shipped to CRAN, but since it's
> failing on Win Devel, I assumed it would be auto-rejected if I submitted
> for a CRAN release.
> >
> > I think CRAN and Winbuilder are separate machines. If CRAN isn't showing
> errors in its tests of the hardhat package then it has probably
> successfully built it and will use it in tests.   Currently it looks fine:
> >
> > https://cran.r-project.org/web/checks/check_results_hardhat.html
> >
> > I do recommend testing on Windows R-devel on one of the other platforms
> I listed before submitting to CRAN.  I don't think auto-rejects waste a lot
> of their time, but it's better to get accepted on the first try.
> >
> > Duncan Murdoch
> >
> >
> >
> >>  On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <
> murdoch.duncan at gmail.com <mailto:murdoch.duncan at gmail.com>> wrote:
> >>    I'd suggest writing to CRAN to point out that they may need to take a
> >>    look, if you haven't already done so.  In the meantime, you can test
> >>    elsewhere (R-hub, Github, your own Windows machine or image, etc.)
> >>    Duncan Murdoch
> >>    On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
> >>     > Is there something wrong with the Windows Dev machine? It's now
> >>    been 3
> >>     > weeks since the release of the hardhat package v 0.2.0 on CRAN,
> >>    and it's
> >>     > still not available in the Win Dev check.
> >>     >
> >>     > I have this in my DESCRIPTION file:
> >>     > Imports:
> >>     >      hardhat (>= 0.2.0)
> >>     >
> >>     > And still getting this note when running
> devtools::check_win_devel().
> >>     >
> >>     > Package required and available but unsuitable version: 'hardhat'
> >>     >
> >>     > https://cran.r-project.org/package=hardhat
> >>    <https://cran.r-project.org/package=hardhat>
> >>     >
> >>     > Daniel
> >>     >
> >>     >
> >>     > On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg
> >>    <danield.sjoberg at gmail.com <mailto:danield.sjoberg at gmail.com>>
> >>     > wrote:
> >>     >
> >>     >> For what it's worth, I am seeing a similar issue.
> >>     >>
> >>     >> I am trying to make a release that depends on the hardhat
> >>    package, which
> >>     >> made a release on 2022-01-24, and it's still unavailable to
> check on
> >>     >> WinDevel. I am also depending on the newest release of gtsummary
> >>    which was
> >>     >> made available on CRAN on 2022-01-29 (after hardhat's release).
> The
> >>     >> gtsummary package, however, became available on WinDevel a few
> >>    days later.
> >>     >>
> >>     >> Thank you,
> >>     >> Daniel
> >>     >>
> >>     >> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com
> >>    <mailto:ijlyttle at me.com>> wrote:
> >>     >>>
> >>     >>> I am trying to check a package release-candidate on win-builder
> >>    r-devel.
> >>     >> This package imports a recently-released version of another
> package,
> >>     >> {vegawidget}.
> >>     >>> The check on win-builder (r-devel) fails:
> >>     >>> * checking package dependencies ... ERROR
> >>     >>> Package required and available but unsuitable version:
> 'vegawidget'
> >>     >>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
> >>    apparently
> >>     >> not available to win-builder r-devel.
> >>     >>> For what it?s worth, the check passes for win-builder r-release
> and
> >>     >> r-oldrel.
> >>     >>> Is this just a matter of me needing to be more patient, or
> >>    could there
> >>     >> be something ?stuck? at win-builder?
> >>     >>> Thanks!
> >>     >>>
> >>     >>>
> >>     >>>
> >>     >>>          [[alternative HTML version deleted]]
> >>     >>>
> >>     >>> ______________________________________________
> >>     >>> R-package-devel at r-project.org
> >>    <mailto:R-package-devel at r-project.org> mailing list
> >>     >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>    <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> >>     >>
> >>     >
> >>     >       [[alternative HTML version deleted]]
> >>     >
> >>     > ______________________________________________
> >>     > R-package-devel at r-project.org
> >>    <mailto:R-package-devel at r-project.org> mailing list
> >>     > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>    <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From r@@y@|@14 @end|ng |rom |mper|@|@@c@uk  Wed Feb 16 03:55:01 2022
From: r@@y@|@14 @end|ng |rom |mper|@|@@c@uk (Ayala Hernandez, Rafael)
Date: Wed, 16 Feb 2022 02:55:01 +0000
Subject: [R-pkg-devel] Best practices for distributing large data files
Message-ID: <2A0E5487-B157-4B1E-B8B9-0475204AF4E6@imperial.ac.uk>

Dear all,

I am currently trying to think of the best way to distribute large sets of coefficients required by my package asteRisk.

At the moment, I am using an accessory data package, asteRiskData, available from a drat repository, that bundles all of the required coefficients already parsed and stored as R objects.

However, as my package grows, the amount of data required is also growing. This has made the size of asteRiskData grow larger, reaching 99.99 MB at the moment, which is at the limit of what would be upload able to GitHub. Since the source package must be uploaded a a single .tar.gz file for the drat repository, I see no easy workaround, other than splitting it into multiple, accessory data packages.

I believe this option could become rather troublesome in the future, if the number of accessory data packages starts to grow too much.

So I would like to ask, is there any recommended procedure for distributing such large data files? 

Another option that has been suggested to me is not to use an accessory data package at all, but instead download and parse the required data on demand from the corresponding internet resources, store them locally, and then have future sessions load them from the local copies, therefore not requiring download and parsing in every R session, but only once (or possibly only once in a while, if the associated resource is updated). However, this would be leaving files of relatively large size (several 10s of MB) scattered in the local environment of users (instead of having them all centralized in the accessory data package). Is this option acceptable as well?

Thanks a lot in advance for any insights

Best wishes,

Rafa

From n|u|tz @end|ng |rom gm@||@com  Wed Feb 16 05:10:17 2022
From: n|u|tz @end|ng |rom gm@||@com (Neal Fultz)
Date: Tue, 15 Feb 2022 20:10:17 -0800
Subject: [R-pkg-devel] Best practices for distributing large data files
In-Reply-To: <2A0E5487-B157-4B1E-B8B9-0475204AF4E6@imperial.ac.uk>
References: <2A0E5487-B157-4B1E-B8B9-0475204AF4E6@imperial.ac.uk>
Message-ID: <CAL9B2vcdGw+y1F0z_jTpjVMjE1gNbLAGPOxJiREgxyQpF8FvQA@mail.gmail.com>

I host my clients' packages on aws; the cost is minimal, and extremely fast
for installing on other systems on amazon. Here's the script I use:

https://github.com/njnmco/njnmverse/blob/master/Makefile



On Tue, Feb 15, 2022 at 6:55 PM Ayala Hernandez, Rafael <
r.ayala14 at imperial.ac.uk> wrote:

> Dear all,
>
> I am currently trying to think of the best way to distribute large sets of
> coefficients required by my package asteRisk.
>
> At the moment, I am using an accessory data package, asteRiskData,
> available from a drat repository, that bundles all of the required
> coefficients already parsed and stored as R objects.
>
> However, as my package grows, the amount of data required is also growing.
> This has made the size of asteRiskData grow larger, reaching 99.99 MB at
> the moment, which is at the limit of what would be upload able to GitHub.
> Since the source package must be uploaded a a single .tar.gz file for the
> drat repository, I see no easy workaround, other than splitting it into
> multiple, accessory data packages.
>
> I believe this option could become rather troublesome in the future, if
> the number of accessory data packages starts to grow too much.
>
> So I would like to ask, is there any recommended procedure for
> distributing such large data files?
>
> Another option that has been suggested to me is not to use an accessory
> data package at all, but instead download and parse the required data on
> demand from the corresponding internet resources, store them locally, and
> then have future sessions load them from the local copies, therefore not
> requiring download and parsing in every R session, but only once (or
> possibly only once in a while, if the associated resource is updated).
> However, this would be leaving files of relatively large size (several 10s
> of MB) scattered in the local environment of users (instead of having them
> all centralized in the accessory data package). Is this option acceptable
> as well?
>
> Thanks a lot in advance for any insights
>
> Best wishes,
>
> Rafa
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @ndre@@@b|@ette @end|ng |rom un|-due@de  Wed Feb 16 10:24:11 2022
From: @ndre@@@b|@ette @end|ng |rom un|-due@de (=?utf-8?B?QmzDpHR0ZSwgQW5kcmVhcw==?=)
Date: Wed, 16 Feb 2022 09:24:11 +0000
Subject: [R-pkg-devel] Best practices for distributing large data files
Message-ID: <EBF736D2-E601-400E-ABAE-1F7629DAD895@uni-due.de>

Dear Rafa, 

AWS is a good option, and we are very satisfied with Zenodo for data that can be made publicly available.

See the corpus_install() function in the 'cwbtools' package I maintain: https://github.com/PolMine/cwbtools/blob/master/R/corpus.R It offers a download option from both AWS and Zenodo, e.g. to download / install the (~ 1 GB) GermaParl corpus: https://doi.org/10.5281/zenodo.3742113

Zenodo is easy to use and has the great advantage that a DOI is assigned automatically. AWS is our option for restricted data. Yet managing access rights is appropriately with AWS is not easy. Users often need assistance to create credential files. 

Kind regards
Andreas 




?Am 16.02.22, 03:55 schrieb "R-package-devel im Auftrag von Ayala Hernandez, Rafael" <r-package-devel-bounces at r-project.org im Auftrag von r.ayala14 at imperial.ac.uk>:

    Dear all,

    I am currently trying to think of the best way to distribute large sets of coefficients required by my package asteRisk.

    At the moment, I am using an accessory data package, asteRiskData, available from a drat repository, that bundles all of the required coefficients already parsed and stored as R objects.

    However, as my package grows, the amount of data required is also growing. This has made the size of asteRiskData grow larger, reaching 99.99 MB at the moment, which is at the limit of what would be upload able to GitHub. Since the source package must be uploaded a a single .tar.gz file for the drat repository, I see no easy workaround, other than splitting it into multiple, accessory data packages.

    I believe this option could become rather troublesome in the future, if the number of accessory data packages starts to grow too much.

    So I would like to ask, is there any recommended procedure for distributing such large data files? 

    Another option that has been suggested to me is not to use an accessory data package at all, but instead download and parse the required data on demand from the corresponding internet resources, store them locally, and then have future sessions load them from the local copies, therefore not requiring download and parsing in every R session, but only once (or possibly only once in a while, if the associated resource is updated). However, this would be leaving files of relatively large size (several 10s of MB) scattered in the local environment of users (instead of having them all centralized in the accessory data package). Is this option acceptable as well?

    Thanks a lot in advance for any insights

    Best wishes,

    Rafa
    ______________________________________________
    R-package-devel at r-project.org mailing list
    https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m|n@h@|| @end|ng |rom um|ch@edu  Wed Feb 16 15:31:12 2022
From: m|n@h@|| @end|ng |rom um|ch@edu (Greg Minshall)
Date: Wed, 16 Feb 2022 06:31:12 -0800
Subject: [R-pkg-devel] Best practices for distributing large data files
In-Reply-To: <2A0E5487-B157-4B1E-B8B9-0475204AF4E6@imperial.ac.uk>
References: <2A0E5487-B157-4B1E-B8B9-0475204AF4E6@imperial.ac.uk>
Message-ID: <1650934.1645021872@apollo2.minshall.org>

Rafael,

> Another option that has been suggested to me is not to use an
> accessory data package at all, but instead download and parse the
> required data on demand from the corresponding internet resources,
> store them locally, and then have future sessions load them from the
> local copies, therefore not requiring download and parsing in every R
> session, but only once (or possibly only once in a while, if the
> associated resource is updated). However, this would be leaving files
> of relatively large size (several 10s of MB) scattered in the local
> environment of users (instead of having them all centralized in the
> accessory data package). Is this option acceptable as well?

i've done this for caching some world bank data.  for my simple use,
this works well.  but, i don't really have any systematic way of
"invalidating" the cache, providing the user with any control over this,
etc., and i consider that a problem.

cheers, Greg


From m@pjg @end|ng |rom br|@to|@@c@uk  Wed Feb 16 16:53:17 2022
From: m@pjg @end|ng |rom br|@to|@@c@uk (Peter Green)
Date: Wed, 16 Feb 2022 15:53:17 +0000
Subject: [R-pkg-devel] (How) can you use R file i/o within Fortran code in
 an R package?
In-Reply-To: <44ce75ba-fce5-93c7-6244-09897a1fb97e@bristol.ac.uk>
References: <44ce75ba-fce5-93c7-6244-09897a1fb97e@bristol.ac.uk>
Message-ID: <e3c49560-8167-5b8d-3fca-faa272afe207@bristol.ac.uk>

I am developing a package based around several thousand lines of legacy 
Fortran code front-ended with a fairly minimal R function to format 
input and results. In its basic form it is on CRAN, but now I want to 
extend it in a way that will generate copious output over the course of 
the running time of the Fortran code, and I would prefer if possible to 
write this output to (several) files rather than return it through 
arguments to .Fortran.

I have a version using Fortran open, write and close (naturally avoiding 
stderr and stdout), which runs perfectly on several platforms, but 
generates a NOTE in R-hub and Winbuilder:

 > * checking compiled code ... NOTE
 > File ?Nmix/libs/Nmix.so?:
 >?? Found ?_gfortran_st_close?, possibly from ?close? (Fortran)
 >???? Object: ?Nmix-sub3z.o?
 >?? Found ?_gfortran_st_open?, possibly from ?open? (Fortran)
 >???? Object: ?Nmix-sub3z.o?
 >?? Found ?_gfortran_st_write?, possibly from ?write? (Fortran), ?print?
 >???? (Fortran)
 >???? Object: ?Nmix-sub3z.o?
 >
 > Compiled code should not call entry points which might terminate R nor
 > write to stdout/stderr instead of to the console, nor use Fortran I/O
 > nor system RNGs.
that will presumably cause it to fail submission to CRAN, for reasons I 
understand.

Is there a way that I can use R file i/o from within the Fortran code, 
possibly mediated through a C or C++ wrapper? As I am not fluent in 
these languages or all the concepts involved, if it is possible a recipe 
or template would be most appreciated. To fix ideas, (how) can I write 
100000 integers, separated by white space, to a text file?

My apologies if this is a well-known question already answered, possibly 
in the negative, but my search through the archives failed to find 
anything. Thank you.

Peter Green



From |eg|d| @end|ng |rom un|t@@|t  Wed Feb 16 18:08:04 2022
From: |eg|d| @end|ng |rom un|t@@|t (EGIDI LEONARDO)
Date: Wed, 16 Feb 2022 17:08:04 +0000
Subject: [R-pkg-devel] Problem with vignette compilation
Message-ID: <AS8P250MB0008939A4D07F69C0451EE85B6359@AS8P250MB0008.EURP250.PROD.OUTLOOK.COM>

Hi all,

I am ready to submit the ?footBayes? package for football models fitting.
However, even though my vignette knits correctly on my local machine and my package reports zero errors/warnings,
I am repeatedly getting this warning/error below when I check on Win builder through devtools::check_win_devel().
I did so many attempts, it is frustrating! I report the error below. The quitting line of the chunk regard a ?rstan? fit.
My VignetteBuilder in the description is ?knitr?
Any suggestion?

Thanks a lot.

Leonardo


-------------------------------------------------------------------------------------------------------------------------------------
* checking re-building of vignette outputs ... [76s] ERROR
Error(s) in re-building vignettes:
--- re-building 'footBayes_a_rapid_guide.Rmd' using knitr
This is bayesplot version 1.8.1
- Online documentation and vignettes at mc-stan.org/bayesplot
- bayesplot theme set to bayesplot::theme_default()
   * Does _not_ affect other ggplot2 plots
   * See ?bayesplot_theme_set for details on theme setting
This is loo version 2.4.1
- Online documentation and vignettes at mc-stan.org/loo
- As of v2.0.0 loo defaults to 1 core but we recommend using as many as possible. Use the 'cores' argument or set options(mc.cores = NUM_CORES) for an entire session.
- Windows 10 users: loo may be very slow if 'mc.cores' is set in your .Rprofile file (see https://github.com/stan-dev/loo/issues/94).

Attaching package: 'dplyr'

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

?????? Attaching packages ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? tidyverse 1.3.1 ??????
??? tibble  3.1.6     ??? purrr   0.3.4
??? tidyr   1.2.0     ??? stringr 1.4.0
??? readr   2.1.2     ??? forcats 0.5.1
?????? Conflicts ?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? tidyverse_conflicts() ??????
??? dplyr::filter() masks stats::filter()
??? dplyr::lag()    masks stats::lag()
make cmd is
  make -f "D:/RCompile/recent/R/etc/x64/Makeconf" -f "D:/RCompile/recent/R/share/make/winshlib.mk" CXX='$(CXX14) $(CXX14STD)' CXXFLAGS='$(CXX14FLAGS)' CXXPICFLAGS='$(CXX14PICFLAGS)' SHLIB_LDFLAGS='$(SHLIB_CXX14LDFLAGS)' SHLIB_LD='$(SHLIB_CXX14LD)' SHLIB="file26368298720af.dll" WIN=64 TCLBIN= OBJECTS="file26368298720af.o"

make would use
make[1]: Entering directory '/d/temp/RtmpALbt6R/working_dir/Rtmpe0dyI1'
if test "zfile26368298720af.o" != "z"; then \
  if test -e "file26368298720af-win.def"; then \
    echo g++  -shared -s -static-libgcc -o file26368298720af.dll file26368298720af-win.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
    g++  -shared -s -static-libgcc -o file26368298720af.dll file26368298720af-win.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
  else \
    echo EXPORTS > tmp.def; \
    nm file26368298720af.o | sed -n 's/^.* [BCDRT] / /p' | sed -e '/[.]refptr[.]/d' -e '/[.]weak[.]/d' | sed 's/[^ ][^ ]*/"&"/g'  >> tmp.def; \
    echo g++  -shared -s -static-libgcc -o file26368298720af.dll tmp.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
    g++  -shared -s -static-libgcc -o file26368298720af.dll tmp.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
    rm -f tmp.def; \
  fi \
fi
make[1]: Leaving directory '/d/temp/RtmpALbt6R/working_dir/Rtmpe0dyI1'
Quitting from lines 271-307 (footBayes_a_rapid_guide.Rmd)
Quitting from lines 271-307 (footBayes_a_rapid_guide.Rmd)
Error: processing vignette 'footBayes_a_rapid_guide.Rmd' failed with diagnostics:
invalid connection
--- failed re-building 'footBayes_a_rapid_guide.Rmd'

SUMMARY: processing the following file failed:
  'footBayes_a_rapid_guide.Rmd'

Error: Vignette re-building failed.
Execution halted
-------------------------------------------------------------------------------------------------------------------------------------

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Feb 16 19:00:47 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 16 Feb 2022 13:00:47 -0500
Subject: [R-pkg-devel] Problem with vignette compilation
In-Reply-To: <AS8P250MB0008939A4D07F69C0451EE85B6359@AS8P250MB0008.EURP250.PROD.OUTLOOK.COM>
References: <AS8P250MB0008939A4D07F69C0451EE85B6359@AS8P250MB0008.EURP250.PROD.OUTLOOK.COM>
Message-ID: <954a3dea-bd71-12fc-a5e5-4f010ac63703@gmail.com>

On 16/02/2022 12:08 p.m., EGIDI LEONARDO wrote:
> Hi all,
> 
> I am ready to submit the ?footBayes? package for football models fitting.
> However, even though my vignette knits correctly on my local machine and my package reports zero errors/warnings,
> I am repeatedly getting this warning/error below when I check on Win builder through devtools::check_win_devel().
> I did so many attempts, it is frustrating! I report the error below. The quitting line of the chunk regard a ?rstan? fit.
> My VignetteBuilder in the description is ?knitr?
> Any suggestion?

I don't know rstan, but those who do could probably help more if they 
had access to your source.  Is it online anywhere?

Duncan Murdoch

> 
> Thanks a lot.
> 
> Leonardo
> 
> 
> -------------------------------------------------------------------------------------------------------------------------------------
> * checking re-building of vignette outputs ... [76s] ERROR
> Error(s) in re-building vignettes:
> --- re-building 'footBayes_a_rapid_guide.Rmd' using knitr
> This is bayesplot version 1.8.1
> - Online documentation and vignettes at mc-stan.org/bayesplot
> - bayesplot theme set to bayesplot::theme_default()
>     * Does _not_ affect other ggplot2 plots
>     * See ?bayesplot_theme_set for details on theme setting
> This is loo version 2.4.1
> - Online documentation and vignettes at mc-stan.org/loo
> - As of v2.0.0 loo defaults to 1 core but we recommend using as many as possible. Use the 'cores' argument or set options(mc.cores = NUM_CORES) for an entire session.
> - Windows 10 users: loo may be very slow if 'mc.cores' is set in your .Rprofile file (see https://github.com/stan-dev/loo/issues/94).
> 
> Attaching package: 'dplyr'
> 
> The following objects are masked from 'package:stats':
> 
>      filter, lag
> 
> The following objects are masked from 'package:base':
> 
>      intersect, setdiff, setequal, union
> 
> ?????? Attaching packages ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? tidyverse 1.3.1 ??????
> ??? tibble  3.1.6     ??? purrr   0.3.4
> ??? tidyr   1.2.0     ??? stringr 1.4.0
> ??? readr   2.1.2     ??? forcats 0.5.1
> ?????? Conflicts ?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? tidyverse_conflicts() ??????
> ??? dplyr::filter() masks stats::filter()
> ??? dplyr::lag()    masks stats::lag()
> make cmd is
>    make -f "D:/RCompile/recent/R/etc/x64/Makeconf" -f "D:/RCompile/recent/R/share/make/winshlib.mk" CXX='$(CXX14) $(CXX14STD)' CXXFLAGS='$(CXX14FLAGS)' CXXPICFLAGS='$(CXX14PICFLAGS)' SHLIB_LDFLAGS='$(SHLIB_CXX14LDFLAGS)' SHLIB_LD='$(SHLIB_CXX14LD)' SHLIB="file26368298720af.dll" WIN=64 TCLBIN= OBJECTS="file26368298720af.o"
> 
> make would use
> make[1]: Entering directory '/d/temp/RtmpALbt6R/working_dir/Rtmpe0dyI1'
> if test "zfile26368298720af.o" != "z"; then \
>    if test -e "file26368298720af-win.def"; then \
>      echo g++  -shared -s -static-libgcc -o file26368298720af.dll file26368298720af-win.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
>      g++  -shared -s -static-libgcc -o file26368298720af.dll file26368298720af-win.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
>    else \
>      echo EXPORTS > tmp.def; \
>      nm file26368298720af.o | sed -n 's/^.* [BCDRT] / /p' | sed -e '/[.]refptr[.]/d' -e '/[.]weak[.]/d' | sed 's/[^ ][^ ]*/"&"/g'  >> tmp.def; \
>      echo g++  -shared -s -static-libgcc -o file26368298720af.dll tmp.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
>      g++  -shared -s -static-libgcc -o file26368298720af.dll tmp.def file26368298720af.o  -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib/x64" -L"d:/rtools42/x86_64-w64-mingw32.static.posix/lib"  -L"D:/RCompile/recent/R/bin/x64" -lR ; \
>      rm -f tmp.def; \
>    fi \
> fi
> make[1]: Leaving directory '/d/temp/RtmpALbt6R/working_dir/Rtmpe0dyI1'
> Quitting from lines 271-307 (footBayes_a_rapid_guide.Rmd)
> Quitting from lines 271-307 (footBayes_a_rapid_guide.Rmd)
> Error: processing vignette 'footBayes_a_rapid_guide.Rmd' failed with diagnostics:
> invalid connection
> --- failed re-building 'footBayes_a_rapid_guide.Rmd'
> 
> SUMMARY: processing the following file failed:
>    'footBayes_a_rapid_guide.Rmd'
> 
> Error: Vignette re-building failed.
> Execution halted
> -------------------------------------------------------------------------------------------------------------------------------------
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @ergue|@@oko| @end|ng |rom gm@||@com  Thu Feb 17 10:04:54 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Thu, 17 Feb 2022 10:04:54 +0100
Subject: [R-pkg-devel] 
 (How) can you use R file i/o within Fortran code in an R package?
In-Reply-To: <e3c49560-8167-5b8d-3fca-faa272afe207@bristol.ac.uk>
References: <44ce75ba-fce5-93c7-6244-09897a1fb97e@bristol.ac.uk>
 <e3c49560-8167-5b8d-3fca-faa272afe207@bristol.ac.uk>
Message-ID: <74f8a4d3-60e8-adb8-c222-05eaa67452bc@gmail.com>

Le 16/02/2022 ? 16:53, Peter Green a ?crit?:
> I am developing a package based around several thousand lines of 
> legacy Fortran code front-ended with a fairly minimal R function to 
> format input and results. In its basic form it is on CRAN, but now I 
> want to extend it in a way that will generate copious output over the 
> course of the running time of the Fortran code, and I would prefer if 
> possible to write this output to (several) files rather than return it 
> through arguments to .Fortran.
>
> I have a version using Fortran open, write and close (naturally 
> avoiding stderr and stdout), which runs perfectly on several 
> platforms, but generates a NOTE in R-hub and Winbuilder:
>
> > * checking compiled code ... NOTE
> > File ?Nmix/libs/Nmix.so?:
> >?? Found ?_gfortran_st_close?, possibly from ?close? (Fortran)
> >???? Object: ?Nmix-sub3z.o?
> >?? Found ?_gfortran_st_open?, possibly from ?open? (Fortran)
> >???? Object: ?Nmix-sub3z.o?
> >?? Found ?_gfortran_st_write?, possibly from ?write? (Fortran), ?print?
> >???? (Fortran)
> >???? Object: ?Nmix-sub3z.o?
> >
> > Compiled code should not call entry points which might terminate R nor
> > write to stdout/stderr instead of to the console, nor use Fortran I/O
> > nor system RNGs.
> that will presumably cause it to fail submission to CRAN, for reasons 
> I understand.
>
> Is there a way that I can use R file i/o from within the Fortran code, 
> possibly mediated through a C or C++ wrapper? As I am not fluent in 
> these languages or all the concepts involved, if it is possible a 
> recipe or template would be most appreciated. To fix ideas, (how) can 
> I write 100000 integers, separated by white space, to a text file?

I don't have an example in hand, just few pointers which could be useful.
First, how to print from Rcpp 
https://teuder.github.io/rcpp4everyone_en/060_printing_massages.html
This example use NumericVector type for an entry parameter which you 
won't need. Use just classical C types (double, int, ...) and pointers 
on them. You don't need either '//[Rcpp::export]' as you wont call this 
function from R but from Fortran.
Second, how to call C from Fortran, e.g. 
https://riptutorial.com/fortran/example/7149/calling-c-from-fortran
The fact that your printing function will be in .cpp file does not 
matter. C interface will work if you limit your parameters to C types.

Hoping it helps,
Best,
Serguei.

>
> My apologies if this is a well-known question already answered, 
> possibly in the negative, but my search through the archives failed to 
> find anything. Thank you.
>
> Peter Green
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From p@o @end|ng |rom qgg@@u@dk  Thu Feb 17 10:19:02 2022
From: p@o @end|ng |rom qgg@@u@dk (=?Windows-1252?Q?Peter_S=F8rensen?=)
Date: Thu, 17 Feb 2022 09:19:02 +0000
Subject: [R-pkg-devel] 
 (How) can you use R file i/o within Fortran code in an R package?
In-Reply-To: <74f8a4d3-60e8-adb8-c222-05eaa67452bc@gmail.com>
References: <44ce75ba-fce5-93c7-6244-09897a1fb97e@bristol.ac.uk>
 <e3c49560-8167-5b8d-3fca-faa272afe207@bristol.ac.uk>
 <74f8a4d3-60e8-adb8-c222-05eaa67452bc@gmail.com>
Message-ID: <AM0PR01MB42902DB02DB8B4A1DE74FBA5FC369@AM0PR01MB4290.eurprd01.prod.exchangelabs.com>

I have created a fortran interface to a few c functions (fopen, fwrite, fread, fseek) via iso_c_binding that is used in my fortran code. The code can be found here: qgg/bigreml.f90 at master ? psoerensen/qgg (github.com)<https://github.com/psoerensen/qgg/blob/master/src/bigreml.f90>
Perhaps this is useful in some way.
Kind regards
Peter
________________________________
Fra: R-package-devel <r-package-devel-bounces at r-project.org> p? vegne af Sokol Serguei <serguei.sokol at gmail.com>
Sendt: 17. februar 2022 10:04
Til: Peter Green <mapjg at bristol.ac.uk>; r-package-devel at r-project.org <r-package-devel at r-project.org>
Emne: Re: [R-pkg-devel] (How) can you use R file i/o within Fortran code in an R package?

Le 16/02/2022 ? 16:53, Peter Green a ?crit :
> I am developing a package based around several thousand lines of
> legacy Fortran code front-ended with a fairly minimal R function to
> format input and results. In its basic form it is on CRAN, but now I
> want to extend it in a way that will generate copious output over the
> course of the running time of the Fortran code, and I would prefer if
> possible to write this output to (several) files rather than return it
> through arguments to .Fortran.
>
> I have a version using Fortran open, write and close (naturally
> avoiding stderr and stdout), which runs perfectly on several
> platforms, but generates a NOTE in R-hub and Winbuilder:
>
> > * checking compiled code ... NOTE
> > File ?Nmix/libs/Nmix.so?:
> >   Found ?_gfortran_st_close?, possibly from ?close? (Fortran)
> >     Object: ?Nmix-sub3z.o?
> >   Found ?_gfortran_st_open?, possibly from ?open? (Fortran)
> >     Object: ?Nmix-sub3z.o?
> >   Found ?_gfortran_st_write?, possibly from ?write? (Fortran), ?print?
> >     (Fortran)
> >     Object: ?Nmix-sub3z.o?
> >
> > Compiled code should not call entry points which might terminate R nor
> > write to stdout/stderr instead of to the console, nor use Fortran I/O
> > nor system RNGs.
> that will presumably cause it to fail submission to CRAN, for reasons
> I understand.
>
> Is there a way that I can use R file i/o from within the Fortran code,
> possibly mediated through a C or C++ wrapper? As I am not fluent in
> these languages or all the concepts involved, if it is possible a
> recipe or template would be most appreciated. To fix ideas, (how) can
> I write 100000 integers, separated by white space, to a text file?

I don't have an example in hand, just few pointers which could be useful.
First, how to print from Rcpp
https://teuder.github.io/rcpp4everyone_en/060_printing_massages.html
This example use NumericVector type for an entry parameter which you
won't need. Use just classical C types (double, int, ...) and pointers
on them. You don't need either '//[Rcpp::export]' as you wont call this
function from R but from Fortran.
Second, how to call C from Fortran, e.g.
https://riptutorial.com/fortran/example/7149/calling-c-from-fortran
The fact that your printing function will be in .cpp file does not
matter. C interface will work if you limit your parameters to C types.

Hoping it helps,
Best,
Serguei.

>
> My apologies if this is a well-known question already answered,
> possibly in the negative, but my search through the archives failed to
> find anything. Thank you.
>
> Peter Green
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From n@r@@ @end|ng |rom @t@n|ord@edu  Thu Feb 17 20:41:10 2022
From: n@r@@ @end|ng |rom @t@n|ord@edu (Balasubramanian Narasimhan)
Date: Thu, 17 Feb 2022 11:41:10 -0800
Subject: [R-pkg-devel] 
 (How) can you use R file i/o within Fortran code in an R package?
In-Reply-To: <e3c49560-8167-5b8d-3fca-faa272afe207@bristol.ac.uk>
References: <44ce75ba-fce5-93c7-6244-09897a1fb97e@bristol.ac.uk>
 <e3c49560-8167-5b8d-3fca-faa272afe207@bristol.ac.uk>
Message-ID: <51582920-75a2-28bb-8ad4-e04731db08d2@stanford.edu>

An example and test package:

https://bnaras.github.io/ftest/articles/frcall.html

-Naras

On 2/16/22 7:53 AM, Peter Green wrote:
> I am developing a package based around several thousand lines of 
> legacy Fortran code front-ended with a fairly minimal R function to 
> format input and results. In its basic form it is on CRAN, but now I 
> want to extend it in a way that will generate copious output over the 
> course of the running time of the Fortran code, and I would prefer if 
> possible to write this output to (several) files rather than return it 
> through arguments to .Fortran.
>
> I have a version using Fortran open, write and close (naturally 
> avoiding stderr and stdout), which runs perfectly on several 
> platforms, but generates a NOTE in R-hub and Winbuilder:
>
> > * checking compiled code ... NOTE
> > File ?Nmix/libs/Nmix.so?:
> >?? Found ?_gfortran_st_close?, possibly from ?close? (Fortran)
> >???? Object: ?Nmix-sub3z.o?
> >?? Found ?_gfortran_st_open?, possibly from ?open? (Fortran)
> >???? Object: ?Nmix-sub3z.o?
> >?? Found ?_gfortran_st_write?, possibly from ?write? (Fortran), ?print?
> >???? (Fortran)
> >???? Object: ?Nmix-sub3z.o?
> >
> > Compiled code should not call entry points which might terminate R nor
> > write to stdout/stderr instead of to the console, nor use Fortran I/O
> > nor system RNGs.
> that will presumably cause it to fail submission to CRAN, for reasons 
> I understand.
>
> Is there a way that I can use R file i/o from within the Fortran code, 
> possibly mediated through a C or C++ wrapper? As I am not fluent in 
> these languages or all the concepts involved, if it is possible a 
> recipe or template would be most appreciated. To fix ideas, (how) can 
> I write 100000 integers, separated by white space, to a text file?
>
> My apologies if this is a well-known question already answered, 
> possibly in the negative, but my search through the archives failed to 
> find anything. Thank you.
>
> Peter Green
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From D@n@Ke||ey @end|ng |rom D@|@C@  Thu Feb 17 21:53:50 2022
From: D@n@Ke||ey @end|ng |rom D@|@C@ (Daniel Kelley)
Date: Thu, 17 Feb 2022 20:53:50 +0000
Subject: [R-pkg-devel] should I increase the version number when
 resubmitting a package that failed incoming tests?
Message-ID: <15D4797A-4942-4AD8-A926-CA920C26A0F8@dal.ca>

I tried submitting oce_1.6-0 and it was rejected (owing to a broken link, according to reference 1 below; see reference 2 for the email I got from the CRAN system).  The email suggested I fix the package and resubmit.

My question is: should I retain the same version number, or should I bump the number?  Since it did not "get into" the CRAN system, I'm thinking that I am supposed to use the same version number, but I don't want to make a mistake and get rejected again (e.g. for too many tries within a certain time interval).

Thanks, in advance, to anyone who can suggest what I ought to do.

Dan Kelley, Department of Oceanography, Dalhousie University, Canada.

# References

1. https://win-builder.r-project.org/incoming_pretest/oce_1.6-0_20220217_201627/Windows/00check.log
2. https://github.com/dankelley/oce/issues/1918#issuecomment-1043363009


	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Feb 17 22:03:54 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 18 Feb 2022 00:03:54 +0300
Subject: [R-pkg-devel] should I increase the version number when
 resubmitting a package that failed incoming tests?
In-Reply-To: <15D4797A-4942-4AD8-A926-CA920C26A0F8@dal.ca>
References: <15D4797A-4942-4AD8-A926-CA920C26A0F8@dal.ca>
Message-ID: <20220218000354.06b71d6c@Tarkus>

On Thu, 17 Feb 2022 20:53:50 +0000
Daniel Kelley <Dan.Kelley at Dal.Ca> wrote:

> My question is: should I retain the same version number, or should I
> bump the number?

CRAN policy currently says:

"Increasing the version number at each submission reduces confusion so
is preferred even when a previous submission was not accepted."

<https://cran.r-project.org/web/packages/policies.html#Re_002dsubmission>

I don't think you'd be penalised for incrementing a version, anyway,
and there doesn't seem to be a formal cool-down period for
resubmissions. It's reasonable to reupload once you're confident you've
addressed all 

-- 
Best regards,
Ivan


From m|n@h@|| @end|ng |rom um|ch@edu  Fri Feb 18 01:04:27 2022
From: m|n@h@|| @end|ng |rom um|ch@edu (Greg Minshall)
Date: Thu, 17 Feb 2022 16:04:27 -0800
Subject: [R-pkg-devel] should I increase the version number when
 resubmitting a package that failed incoming tests?
In-Reply-To: <15D4797A-4942-4AD8-A926-CA920C26A0F8@dal.ca>
References: <15D4797A-4942-4AD8-A926-CA920C26A0F8@dal.ca>
Message-ID: <1900332.1645142667@apollo2.minshall.org>

Daniel,

Ivan gave you good pointers from the R perspective.  and, in general
(i.e., even outside the R context), i would say that a "version number"
of a given package, ideally, should represent a unique set of
files/contents.  so, re-submitting, maybe you'd bump to oce_1.6-1, or
some such.

cheers, Greg


From ge|bjeremy22 @end|ng |rom gm@||@com  Fri Feb 18 02:00:40 2022
From: ge|bjeremy22 @end|ng |rom gm@||@com (=?UTF-8?B?asOpcsOpbXkgR2VsYg==?=)
Date: Thu, 17 Feb 2022 20:00:40 -0500
Subject: [R-pkg-devel] CRAN warning prepare_Rd: rgeos: versions of GEOS
Message-ID: <CACSk529+OvNMKuXP734MWMGEb0JytpBtUd1rAA4yo32d7q40tQ@mail.gmail.com>

Dear all,

I encounter a new warning with debian OS (only this one) when submitting a
package to CRAN:

* checking Rd files ... [4s/4s] WARNING
prepare_Rd: rgeos: versions of GEOS runtime 3.10.2-CAPI-1.16.0
and GEOS at installation 3.10.1-CAPI-1.16.0differ

(
https://win-builder.r-project.org/incoming_pretest/spNetwork_0.2.2_20220218_012321/Debian/00check.log
)

I tried two things and the warning remains:
    - increasing rgeos version requirement
    - uninstalling R-devel, reinstalling and rebuilding package

I can not find help online on that matter. Does someone know how to deal
with this warning?

Thank you in advance!
--

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Feb 18 08:45:20 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 18 Feb 2022 10:45:20 +0300
Subject: [R-pkg-devel] CRAN warning prepare_Rd: rgeos: versions of GEOS
In-Reply-To: <CACSk529+OvNMKuXP734MWMGEb0JytpBtUd1rAA4yo32d7q40tQ@mail.gmail.com>
References: <CACSk529+OvNMKuXP734MWMGEb0JytpBtUd1rAA4yo32d7q40tQ@mail.gmail.com>
Message-ID: <20220218104520.4a8656a4@Tarkus>

On Thu, 17 Feb 2022 20:00:40 -0500
j?r?my Gelb <gelbjeremy22 at gmail.com> wrote:

> prepare_Rd: rgeos: versions of GEOS runtime 3.10.2-CAPI-1.16.0
> and GEOS at installation 3.10.1-CAPI-1.16.0differ

This warning is produced by rgeos:::.onLoad [1], because
rgeos:::version_GEOS returns two different things [2],
"3.10.2-CAPI-1.16.0" coming from the GEOSversion() in the shared
library and "3.10.1-CAPI-1.16.0differ" coming from #define
GEOS_CAPI_VERSION in the headers.

I think that the incoming pretest machine needs a reinstall of the
rgeos package, or a reinstall of GEOS itself (so that the headers match
the shared object), or maybe both. There's nothing to fix in the
spNetwork package.

-- 
Best regards,
Ivan

[1]
https://r-forge.r-project.org/scm/viewvc.php/pkg/R/AAA.R?view=markup&revision=673&root=rgeos

[2]
https://r-forge.r-project.org/scm/viewvc.php/pkg/src/rgeos.c?view=markup&revision=576&root=rgeos


From ce@g|guere @end|ng |rom gm@||@com  Mon Feb 21 21:07:03 2022
From: ce@g|guere @end|ng |rom gm@||@com (=?iso-8859-1?Q?Charles-=C9douard_Gigu=E8re?=)
Date: Mon, 21 Feb 2022 15:07:03 -0500
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
Message-ID: <007301d8275e$984f1bc0$c8ed5340$@gmail.com>

Hello All, 

I have corrected some parameters to one of my function in my package CUFF
(https://github.com/giguerch/CUFF) following a request by Prof Ripley
related to a change in aggregate parameter list.  I ran a full check of my
package using the r-devel version and option --as-cran and got no error
message. When I submit it to CRAN there are some error messages and my
submission is denied but I don't know what to change since the only error
message is that the package cannot be installed. Can someone give me some
tips on how I can figure that out? 

Thank you. 

Charles-?douard

 

 


	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Feb 22 17:31:41 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 22 Feb 2022 19:31:41 +0300
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
Message-ID: <20220222193141.46fa2ef4@arachnoid>

On Mon, 21 Feb 2022 15:07:03 -0500
Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:

> When I submit it to CRAN there are some error messages and my
> submission is denied but I don't know what to change since the only
> error message is that the package cannot be installed. Can someone
> give me some tips on how I can figure that out? 

It would be much easier to help if we could see the messages themselves.

-- 
Best regards,
Ivan


From ce@g|guere @end|ng |rom gm@||@com  Tue Feb 22 17:43:28 2022
From: ce@g|guere @end|ng |rom gm@||@com (=?utf-8?Q?Charles-=C3=89douard_Gigu=C3=A8re?=)
Date: Tue, 22 Feb 2022 11:43:28 -0500
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <00b201d8280a$fb62a680$f227f380$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>	<007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <20220222193141.46fa2ef4@arachnoid>
 <00b201d8280a$fb62a680$f227f380$@gmail.com>
Message-ID: <00ba01d8280b$51c55db0$f5501910$@gmail.com>

Thank you for your reply,
In attachment, I have put my own log where everything checks out and below is the log I received from CRAN. The problem is that I don't have the 00install.out file from CRAN. I suspect it might have to do with the dependencies not installed on CRAN but the dependencies are declared in my Description file in the import section. I don?t know how to go forward. 
Charles-?douard

* using log directory 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck'
* using R Under development (unstable) (2022-02-15 r81747 ucrt)
* using platform: x86_64-w64-mingw32 (64-bit)
* using session charset: UTF-8
* checking for file 'CUFF/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'CUFF' version '1.8'
* package encoding: UTF-8
* checking CRAN incoming feasibility ... Note_to_CRAN_maintainers
Maintainer: 'Charles-??douard Gigu??re <ce.giguere at gmail.com>'
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for hidden files and directories ... OK
* checking for portable file names ... OK
* checking serialization versions ... OK
* checking whether package 'CUFF' can be installed ... ERROR Installation failed.
See 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out' for details.
* DONE
Status: 1 ERROR


-----Message d'origine-----
De : Ivan Krylov <krylov.r00t at gmail.com> Envoy? : 22 f?vrier 2022 11:32 ? : Charles-?douard Gigu?re <ce.giguere at gmail.com> Cc : r-package-devel at r-project.org Objet : Re: [R-pkg-devel] TR: Help with checking package.

On Mon, 21 Feb 2022 15:07:03 -0500
Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:

> When I submit it to CRAN there are some error messages and my 
> submission is denied but I don't know what to change since the only 
> error message is that the package cannot be installed. Can someone 
> give me some tips on how I can figure that out?

It would be much easier to help if we could see the messages themselves.

--
Best regards,
Ivan


From @eb@meyer @end|ng |rom |@u@de  Tue Feb 22 18:08:54 2022
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Tue, 22 Feb 2022 18:08:54 +0100
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <00ba01d8280b$51c55db0$f5501910$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <20220222193141.46fa2ef4@arachnoid>
 <00b201d8280a$fb62a680$f227f380$@gmail.com>
 <00ba01d8280b$51c55db0$f5501910$@gmail.com>
Message-ID: <adb6b4ea-09cb-6dba-6fd0-bfd9bc7affce@fau.de>

Am 22.02.22 um 17:43 schrieb Charles-?douard Gigu?re:
> Thank you for your reply,
> In attachment, I have put my own log where everything checks out and below is the log I received from CRAN. The problem is that I don't have the 00install.out file from CRAN. I suspect it might have to do with the dependencies not installed on CRAN but the dependencies are declared in my Description file in the import section. I don?t know how to go forward.
> Charles-?douard

The e-mail from the CRAN teams' auto-check service should contain a link 
to the relevant check results. Look for the sentence "More details are 
given in the directory:" at the end of that e-mail.

Best regards,

	Sebastian Meyer

> 
> * using log directory 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck'
> * using R Under development (unstable) (2022-02-15 r81747 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: UTF-8
> * checking for file 'CUFF/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'CUFF' version '1.8'
> * package encoding: UTF-8
> * checking CRAN incoming feasibility ... Note_to_CRAN_maintainers
> Maintainer: 'Charles-??douard Gigu??re <ce.giguere at gmail.com>'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking serialization versions ... OK
> * checking whether package 'CUFF' can be installed ... ERROR Installation failed.
> See 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out' for details.
> * DONE
> Status: 1 ERROR
> 
> 
> -----Message d'origine-----
> De : Ivan Krylov <krylov.r00t at gmail.com> Envoy? : 22 f?vrier 2022 11:32 ? : Charles-?douard Gigu?re <ce.giguere at gmail.com> Cc : r-package-devel at r-project.org Objet : Re: [R-pkg-devel] TR: Help with checking package.
> 
> On Mon, 21 Feb 2022 15:07:03 -0500
> Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:
> 
>> When I submit it to CRAN there are some error messages and my
>> submission is denied but I don't know what to change since the only
>> error message is that the package cannot be installed. Can someone
>> give me some tips on how I can figure that out?
> 
> It would be much easier to help if we could see the messages themselves.
> 
> --
> Best regards,
> Ivan
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @ergue|@@oko| @end|ng |rom gm@||@com  Tue Feb 22 18:10:00 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Tue, 22 Feb 2022 18:10:00 +0100
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <00ba01d8280b$51c55db0$f5501910$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <20220222193141.46fa2ef4@arachnoid>
 <00b201d8280a$fb62a680$f227f380$@gmail.com>
 <00ba01d8280b$51c55db0$f5501910$@gmail.com>
Message-ID: <c653bb8e-bbfc-aaa0-13d0-3aceabe9807b@gmail.com>

Le 22/02/2022 ? 17:43, Charles-?douard Gigu?re a ?crit?:
> Thank you for your reply,
> In attachment, I have put my own log where everything checks out and below is the log I received from CRAN. The problem is that I don't have the 00install.out file from CRAN. I suspect it might have to do with the dependencies not installed on CRAN but the dependencies are declared in my Description file in the import section. I don?t know how to go forward.

Next time it would be preferable to post a link from CRAN message not 
just a copy/paste.

Looking at 
https://win-builder.r-project.org/incoming_pretest/CUFF_1.8_20220216_031003/Windows/00install.out 
I see that a file 
'h:/DCRFS/Statisticiens/Banque_Signature/Donnees/QUEST.Rdata' cannot be 
opened.? The fact that french words are used in the path make me think 
that it must be a hard coded path. Do you recognize it?

Serguei.


> Charles-?douard
>
> * using log directory 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck'
> * using R Under development (unstable) (2022-02-15 r81747 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: UTF-8
> * checking for file 'CUFF/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'CUFF' version '1.8'
> * package encoding: UTF-8
> * checking CRAN incoming feasibility ... Note_to_CRAN_maintainers
> Maintainer: 'Charles-??douard Gigu??re <ce.giguere at gmail.com>'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking serialization versions ... OK
> * checking whether package 'CUFF' can be installed ... ERROR Installation failed.
> See 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out' for details.
> * DONE
> Status: 1 ERROR
>
>
> -----Message d'origine-----
> De : Ivan Krylov <krylov.r00t at gmail.com> Envoy? : 22 f?vrier 2022 11:32 ? : Charles-?douard Gigu?re <ce.giguere at gmail.com> Cc : r-package-devel at r-project.org Objet : Re: [R-pkg-devel] TR: Help with checking package.
>
> On Mon, 21 Feb 2022 15:07:03 -0500
> Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:
>
>> When I submit it to CRAN there are some error messages and my
>> submission is denied but I don't know what to change since the only
>> error message is that the package cannot be installed. Can someone
>> give me some tips on how I can figure that out?
> It would be much easier to help if we could see the messages themselves.
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ce@g|guere @end|ng |rom gm@||@com  Tue Feb 22 18:50:27 2022
From: ce@g|guere @end|ng |rom gm@||@com (=?utf-8?Q?Charles-=C3=89douard_Gigu=C3=A8re?=)
Date: Tue, 22 Feb 2022 12:50:27 -0500
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <adb6b4ea-09cb-6dba-6fd0-bfd9bc7affce@fau.de>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <20220222193141.46fa2ef4@arachnoid>
 <00b201d8280a$fb62a680$f227f380$@gmail.com>
 <00ba01d8280b$51c55db0$f5501910$@gmail.com>
 <adb6b4ea-09cb-6dba-6fd0-bfd9bc7affce@fau.de>
Message-ID: <00cb01d82814$ada4df30$08ee9d90$@gmail.com>

How can I access that file it is a local path: 

'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out'

Charles-?douard
-----Message d'origine-----
De : Sebastian Meyer <seb.meyer at fau.de> 
Envoy? : 22 f?vrier 2022 12:09
? : Charles-?douard Gigu?re <ce.giguere at gmail.com>; r-package-devel at r-project.org
Objet : Re: [R-pkg-devel] TR: Help with checking package.

Am 22.02.22 um 17:43 schrieb Charles-?douard Gigu?re:
> Thank you for your reply,
> In attachment, I have put my own log where everything checks out and below is the log I received from CRAN. The problem is that I don't have the 00install.out file from CRAN. I suspect it might have to do with the dependencies not installed on CRAN but the dependencies are declared in my Description file in the import section. I don?t know how to go forward.
> Charles-?douard

The e-mail from the CRAN teams' auto-check service should contain a link to the relevant check results. Look for the sentence "More details are given in the directory:" at the end of that e-mail.

Best regards,

	Sebastian Meyer

> 
> * using log directory 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck'
> * using R Under development (unstable) (2022-02-15 r81747 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: UTF-8
> * checking for file 'CUFF/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'CUFF' version '1.8'
> * package encoding: UTF-8
> * checking CRAN incoming feasibility ... Note_to_CRAN_maintainers
> Maintainer: 'Charles-??douard Gigu??re <ce.giguere at gmail.com>'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking serialization versions ... OK
> * checking whether package 'CUFF' can be installed ... ERROR Installation failed.
> See 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out' for details.
> * DONE
> Status: 1 ERROR
> 
> 
> -----Message d'origine-----
> De : Ivan Krylov <krylov.r00t at gmail.com> Envoy? : 22 f?vrier 2022 11:32 ? : Charles-?douard Gigu?re <ce.giguere at gmail.com> Cc : r-package-devel at r-project.org Objet : Re: [R-pkg-devel] TR: Help with checking package.
> 
> On Mon, 21 Feb 2022 15:07:03 -0500
> Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:
> 
>> When I submit it to CRAN there are some error messages and my 
>> submission is denied but I don't know what to change since the only 
>> error message is that the package cannot be installed. Can someone 
>> give me some tips on how I can figure that out?
> 
> It would be much easier to help if we could see the messages themselves.
> 
> --
> Best regards,
> Ivan
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From M@x@Turgeon @end|ng |rom um@n|tob@@c@  Tue Feb 22 19:05:52 2022
From: M@x@Turgeon @end|ng |rom um@n|tob@@c@ (Max Turgeon)
Date: Tue, 22 Feb 2022 18:05:52 +0000
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <00cb01d82814$ada4df30$08ee9d90$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <20220222193141.46fa2ef4@arachnoid>
 <00b201d8280a$fb62a680$f227f380$@gmail.com>
 <00ba01d8280b$51c55db0$f5501910$@gmail.com>
 <adb6b4ea-09cb-6dba-6fd0-bfd9bc7affce@fau.de>
 <00cb01d82814$ada4df30$08ee9d90$@gmail.com>
Message-ID: <YQXPR01MB45795F5BC65C05A740F98DB69A3B9@YQXPR01MB4579.CANPRD01.PROD.OUTLOOK.COM>

Hi Charles-?douard,

You can find the 00install.out file here: https://win-builder.r-project.org/incoming_pretest/CUFF_1.8_20220216_031003/Windows/00install.out

The issue seems to be with this line in your package: https://github.com/giguerch/CUFF/blob/c27896beda228e7af855b4cbbd86a3ef30f38a01/R/to_csv.r#L34

As mentioned below, you are loading data from a hard-coded absolute path, which of course won't work on someone else's machine. You need to remove, or change, that line.

Best,


Max Turgeon<https://www.name-coach.com/maxime-turgeon>
Assistant Professor

Department of Statistics
University of Manitoba

maxturgeon.ca<http://maxturgeon.ca/>

________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Charles-?douard Gigu?re <ce.giguere at gmail.com>
Sent: Tuesday, February 22, 2022 11:50 AM
To: 'Sebastian Meyer' <seb.meyer at fau.de>; r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] TR: Help with checking package.

********************************************************
Caution: This message was sent from outside the University of Manitoba.
********************************************************

How can I access that file it is a local path:

'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out'

Charles-?douard
-----Message d'origine-----
De : Sebastian Meyer <seb.meyer at fau.de>
Envoy? : 22 f?vrier 2022 12:09
? : Charles-?douard Gigu?re <ce.giguere at gmail.com>; r-package-devel at r-project.org
Objet : Re: [R-pkg-devel] TR: Help with checking package.

Am 22.02.22 um 17:43 schrieb Charles-?douard Gigu?re:
> Thank you for your reply,
> In attachment, I have put my own log where everything checks out and below is the log I received from CRAN. The problem is that I don't have the 00install.out file from CRAN. I suspect it might have to do with the dependencies not installed on CRAN but the dependencies are declared in my Description file in the import section. I don?t know how to go forward.
> Charles-?douard

The e-mail from the CRAN teams' auto-check service should contain a link to the relevant check results. Look for the sentence "More details are given in the directory:" at the end of that e-mail.

Best regards,

        Sebastian Meyer

>
> * using log directory 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck'
> * using R Under development (unstable) (2022-02-15 r81747 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: UTF-8
> * checking for file 'CUFF/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'CUFF' version '1.8'
> * package encoding: UTF-8
> * checking CRAN incoming feasibility ... Note_to_CRAN_maintainers
> Maintainer: 'Charles-?douard Gigu?re <ce.giguere at gmail.com>'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking serialization versions ... OK
> * checking whether package 'CUFF' can be installed ... ERROR Installation failed.
> See 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out' for details.
> * DONE
> Status: 1 ERROR
>
>
> -----Message d'origine-----
> De : Ivan Krylov <krylov.r00t at gmail.com> Envoy? : 22 f?vrier 2022 11:32 ? : Charles-?douard Gigu?re <ce.giguere at gmail.com> Cc : r-package-devel at r-project.org Objet : Re: [R-pkg-devel] TR: Help with checking package.
>
> On Mon, 21 Feb 2022 15:07:03 -0500
> Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:
>
>> When I submit it to CRAN there are some error messages and my
>> submission is denied but I don't know what to change since the only
>> error message is that the package cannot be installed. Can someone
>> give me some tips on how I can figure that out?
>
> It would be much easier to help if we could see the messages themselves.
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From ce@g|guere @end|ng |rom gm@||@com  Tue Feb 22 19:08:18 2022
From: ce@g|guere @end|ng |rom gm@||@com (=?utf-8?Q?Charles-=C3=89douard_Gigu=C3=A8re?=)
Date: Tue, 22 Feb 2022 13:08:18 -0500
Subject: [R-pkg-devel] TR: Help with checking package.
In-Reply-To: <adb6b4ea-09cb-6dba-6fd0-bfd9bc7affce@fau.de>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <20220222193141.46fa2ef4@arachnoid>
 <00b201d8280a$fb62a680$f227f380$@gmail.com>
 <00ba01d8280b$51c55db0$f5501910$@gmail.com>
 <adb6b4ea-09cb-6dba-6fd0-bfd9bc7affce@fau.de>
Message-ID: <00da01d82817$2b5d18f0$82174ad0$@gmail.com>

Hi Sebastian, 
Thank you very much, I found a way to look at the file 00install.out and I understand the problem with the local path now. My question now is : what option should I add to R CMD check so that it catches this error because when I used --as-cran it didn't catch this error. 
Thank you,
Charles-?douard

-----Message d'origine-----
De : Sebastian Meyer <seb.meyer at fau.de> 
Envoy? : 22 f?vrier 2022 12:09
? : Charles-?douard Gigu?re <ce.giguere at gmail.com>; r-package-devel at r-project.org
Objet : Re: [R-pkg-devel] TR: Help with checking package.

Am 22.02.22 um 17:43 schrieb Charles-?douard Gigu?re:
> Thank you for your reply,
> In attachment, I have put my own log where everything checks out and below is the log I received from CRAN. The problem is that I don't have the 00install.out file from CRAN. I suspect it might have to do with the dependencies not installed on CRAN but the dependencies are declared in my Description file in the import section. I don?t know how to go forward.
> Charles-?douard

The e-mail from the CRAN teams' auto-check service should contain a link to the relevant check results. Look for the sentence "More details are given in the directory:" at the end of that e-mail.

Best regards,

	Sebastian Meyer

> 
> * using log directory 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck'
> * using R Under development (unstable) (2022-02-15 r81747 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: UTF-8
> * checking for file 'CUFF/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'CUFF' version '1.8'
> * package encoding: UTF-8
> * checking CRAN incoming feasibility ... Note_to_CRAN_maintainers
> Maintainer: 'Charles-??douard Gigu??re <ce.giguere at gmail.com>'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking serialization versions ... OK
> * checking whether package 'CUFF' can be installed ... ERROR Installation failed.
> See 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out' for details.
> * DONE
> Status: 1 ERROR
> 
> 
> -----Message d'origine-----
> De : Ivan Krylov <krylov.r00t at gmail.com> Envoy? : 22 f?vrier 2022 11:32 ? : Charles-?douard Gigu?re <ce.giguere at gmail.com> Cc : r-package-devel at r-project.org Objet : Re: [R-pkg-devel] TR: Help with checking package.
> 
> On Mon, 21 Feb 2022 15:07:03 -0500
> Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:
> 
>> When I submit it to CRAN there are some error messages and my 
>> submission is denied but I don't know what to change since the only 
>> error message is that the package cannot be installed. Can someone 
>> give me some tips on how I can figure that out?
> 
> It would be much easier to help if we could see the messages themselves.
> 
> --
> Best regards,
> Ivan
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From roy@mende|@@ohn @end|ng |rom no@@@gov  Tue Feb 22 19:21:18 2022
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Tue, 22 Feb 2022 10:21:18 -0800
Subject: [R-pkg-devel] Help with checking package.
In-Reply-To: <00da01d82817$2b5d18f0$82174ad0$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <20220222193141.46fa2ef4@arachnoid>
 <00b201d8280a$fb62a680$f227f380$@gmail.com>
 <00ba01d8280b$51c55db0$f5501910$@gmail.com>
 <adb6b4ea-09cb-6dba-6fd0-bfd9bc7affce@fau.de>
 <00da01d82817$2b5d18f0$82174ad0$@gmail.com>
Message-ID: <DBA943BF-2B33-49BA-8601-08C170D2E3F3@noaa.gov>

I don't know if there is an option to R CMD check tha will catch this, but you should always test your packages on some combination of win builder and RHub.  That would have flagged the error, and gives you the best chance of catching all possible errors across various OSs before you submit to CRAN.

HTH,

-Roy

> On Feb 22, 2022, at 10:08 AM, Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:
> 
> Hi Sebastian, 
> Thank you very much, I found a way to look at the file 00install.out and I understand the problem with the local path now. My question now is : what option should I add to R CMD check so that it catches this error because when I used --as-cran it didn't catch this error. 
> Thank you,
> Charles-?douard
> 
> -----Message d'origine-----
> De : Sebastian Meyer <seb.meyer at fau.de> 
> Envoy? : 22 f?vrier 2022 12:09
> ? : Charles-?douard Gigu?re <ce.giguere at gmail.com>; r-package-devel at r-project.org
> Objet : Re: [R-pkg-devel] TR: Help with checking package.
> 
> Am 22.02.22 um 17:43 schrieb Charles-?douard Gigu?re:
>> Thank you for your reply,
>> In attachment, I have put my own log where everything checks out and below is the log I received from CRAN. The problem is that I don't have the 00install.out file from CRAN. I suspect it might have to do with the dependencies not installed on CRAN but the dependencies are declared in my Description file in the import section. I don?t know how to go forward.
>> Charles-?douard
> 
> The e-mail from the CRAN teams' auto-check service should contain a link to the relevant check results. Look for the sentence "More details are given in the directory:" at the end of that e-mail.
> 
> Best regards,
> 
> 	Sebastian Meyer
> 
>> 
>> * using log directory 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck'
>> * using R Under development (unstable) (2022-02-15 r81747 ucrt)
>> * using platform: x86_64-w64-mingw32 (64-bit)
>> * using session charset: UTF-8
>> * checking for file 'CUFF/DESCRIPTION' ... OK
>> * checking extension type ... Package
>> * this is package 'CUFF' version '1.8'
>> * package encoding: UTF-8
>> * checking CRAN incoming feasibility ... Note_to_CRAN_maintainers
>> Maintainer: 'Charles-??douard Gigu??re <ce.giguere at gmail.com>'
>> * checking package namespace information ... OK
>> * checking package dependencies ... OK
>> * checking if this is a source package ... OK
>> * checking if there is a namespace ... OK
>> * checking for hidden files and directories ... OK
>> * checking for portable file names ... OK
>> * checking serialization versions ... OK
>> * checking whether package 'CUFF' can be installed ... ERROR Installation failed.
>> See 'd:/RCompile/CRANincoming/R-devel/CUFF.Rcheck/00install.out' for details.
>> * DONE
>> Status: 1 ERROR
>> 
>> 
>> -----Message d'origine-----
>> De : Ivan Krylov <krylov.r00t at gmail.com> Envoy? : 22 f?vrier 2022 11:32 ? : Charles-?douard Gigu?re <ce.giguere at gmail.com> Cc : r-package-devel at r-project.org Objet : Re: [R-pkg-devel] TR: Help with checking package.
>> 
>> On Mon, 21 Feb 2022 15:07:03 -0500
>> Charles-?douard Gigu?re <ce.giguere at gmail.com> wrote:
>> 
>>> When I submit it to CRAN there are some error messages and my 
>>> submission is denied but I don't know what to change since the only 
>>> error message is that the package cannot be installed. Can someone 
>>> give me some tips on how I can figure that out?
>> 
>> It would be much easier to help if we could see the messages themselves.
>> 
>> --
>> Best regards,
>> Ivan
>> 
>> ______________________________________________
>> R-package-devel at r-project.org mailing list 
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.


From zh|q|@ng@w@ng @end|ng |rom menz|e@@edu@@u  Wed Feb 23 02:20:51 2022
From: zh|q|@ng@w@ng @end|ng |rom menz|e@@edu@@u (Zhiqiang Wang)
Date: Wed, 23 Feb 2022 01:20:51 +0000
Subject: [R-pkg-devel] Change email address
In-Reply-To: <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
Message-ID: <SYBPR01MB5981A276DCBDC3A1EC6CB024C33C9@SYBPR01MB5981.ausprd01.prod.outlook.com>

Hi All

I am the maintainer of packages "chest" and "allestimates". With my employment change, I would like to change my work email to a gmail address.
After reading https://cran.r-project.org/web/packages/policies.html, I am still not clear how to change my email and whether I need to resubmit package updates. Any suggestions would be appreciated.

Regards,

Zhiqiang

Zhiqiang Wang


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Feb 23 14:37:04 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 23 Feb 2022 08:37:04 -0500
Subject: [R-pkg-devel] Change email address
In-Reply-To: <SYBPR01MB5981A276DCBDC3A1EC6CB024C33C9@SYBPR01MB5981.ausprd01.prod.outlook.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <SYBPR01MB5981A276DCBDC3A1EC6CB024C33C9@SYBPR01MB5981.ausprd01.prod.outlook.com>
Message-ID: <97aceeb8-3326-fd1f-c35b-437d13a95d2a@gmail.com>

On 22/02/2022 8:20 p.m., Zhiqiang Wang wrote:
> Hi All
> 
> I am the maintainer of packages "chest" and "allestimates". With my employment change, I would like to change my work email to a gmail address.
> After reading https://cran.r-project.org/web/packages/policies.html, I am still not clear how to change my email and whether I need to resubmit package updates. Any suggestions would be appreciated.

While your old email address still works, you don't need to submit a 
package update.  If it will stop working, or you don't want CRAN to use 
it any more, then you should submit one.

When you (eventually) update your package, include the new email 
address, and mention in the submission message that you are changing the 
maintainer address.  CRAN will probably write to the old address to 
confirm the change, so it's a good idea to make the change before the 
old email goes away.

If the old address disappears before you have a chance to change the 
package it creates extra work for everyone, because it makes it hard for 
CRAN to verify that you aren't trying to hijack someone else's package.

Duncan Murdoch


From zh|q|@ng@w@ng @end|ng |rom menz|e@@edu@@u  Thu Feb 24 00:41:42 2022
From: zh|q|@ng@w@ng @end|ng |rom menz|e@@edu@@u (Zhiqiang Wang)
Date: Wed, 23 Feb 2022 23:41:42 +0000
Subject: [R-pkg-devel] Change email address
In-Reply-To: <97aceeb8-3326-fd1f-c35b-437d13a95d2a@gmail.com>
References: <005001d82754$0bf98e30$23ecaa90$@gmail.com>
 <007301d8275e$984f1bc0$c8ed5340$@gmail.com>
 <SYBPR01MB5981A276DCBDC3A1EC6CB024C33C9@SYBPR01MB5981.ausprd01.prod.outlook.com>
 <97aceeb8-3326-fd1f-c35b-437d13a95d2a@gmail.com>
Message-ID: <SYBPR01MB5981B377B6CFD6FB4DAF9F39C33C9@SYBPR01MB5981.ausprd01.prod.outlook.com>

Thanks a lot. That's helpful. I will update before my current work email disappears.

Zhiqiang
________________________________
From: Duncan Murdoch <murdoch.duncan at gmail.com>
Sent: Wednesday, 23 February 2022 11:07 PM
To: Zhiqiang Wang <zhiqiang.wang at menzies.edu.au>; r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Change email address

On 22/02/2022 8:20 p.m., Zhiqiang Wang wrote:
> Hi All
>
> I am the maintainer of packages "chest" and "allestimates". With my employment change, I would like to change my work email to a gmail address.
> After reading https://aus01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcran.r-project.org%2Fweb%2Fpackages%2Fpolicies.html&amp;data=04%7C01%7Czhiqiang.wang%40menzies.edu.au%7Cf7ae93fd04684cfbfce408d9f6d1972c%7C9f2487678e1a42f3836fc092ab95ff70%7C0%7C0%7C637812202459993670%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=BHWjkc8WFbRA8qfyOkTB7khq1Aal4ARCy6b%2FjSuqVag%3D&amp;reserved=0, I am still not clear how to change my email and whether I need to resubmit package updates. Any suggestions would be appreciated.

While your old email address still works, you don't need to submit a
package update.  If it will stop working, or you don't want CRAN to use
it any more, then you should submit one.

When you (eventually) update your package, include the new email
address, and mention in the submission message that you are changing the
maintainer address.  CRAN will probably write to the old address to
confirm the change, so it's a good idea to make the change before the
old email goes away.

If the old address disappears before you have a chance to change the
package it creates extra work for everyone, because it makes it hard for
CRAN to verify that you aren't trying to hijack someone else's package.

Duncan Murdoch

	[[alternative HTML version deleted]]


From no@h@gre||er @end|ng |rom gm@||@com  Fri Feb 25 18:49:49 2022
From: no@h@gre||er @end|ng |rom gm@||@com (Noah Greifer)
Date: Fri, 25 Feb 2022 12:49:49 -0500
Subject: [R-pkg-devel] Package manual build problem: ">" not rendered
 correctly
Message-ID: <CAPhhD8=T48YLHC1KwMJRuPe9j=HFqzsje1sNMQr12t=eHP2wgg@mail.gmail.com>

Hello,

I am using \Sexpr{} macros in my R package with render-time evaluation.
This means in my package source that I submit to CRAN, the package manual
must be pre-built and included in the tarball. I am able to build the PDF
manual using devtools::build_manual(), but in the manual that is produced,
greater-than signs (">") are replaced with upside-down question marks. See
the first page of the attached manual for reference. What can I do to have
this render correctly?

Running pdflatex --version in Terminal gives me the following:

pdfTeX 3.14159265-2.6-1.40.21 (TeX Live 2020)
kpathsea version 6.3.2
[Irrelevant stuff removed]
Compiled with libpng 1.6.37; using libpng 1.6.37
Compiled with zlib 1.2.11; using zlib 1.2.11
Compiled with xpdf version 4.02

I am on a Mac. I know very little about Latex (I don't use it for my
writing). Thank you!

Noah

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cobalt_manual.pdf
Type: application/pdf
Size: 71256 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20220225/3a9cac97/attachment.pdf>

From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Feb 25 19:42:24 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 25 Feb 2022 13:42:24 -0500
Subject: [R-pkg-devel] Package manual build problem: ">" not rendered
 correctly
In-Reply-To: <CAPhhD8=T48YLHC1KwMJRuPe9j=HFqzsje1sNMQr12t=eHP2wgg@mail.gmail.com>
References: <CAPhhD8=T48YLHC1KwMJRuPe9j=HFqzsje1sNMQr12t=eHP2wgg@mail.gmail.com>
Message-ID: <be714e28-d55a-20f8-48ee-bc5d8e070a0f@gmail.com>

On 25/02/2022 12:49 p.m., Noah Greifer wrote:
> Hello,
> 
> I am using \Sexpr{} macros in my R package with render-time evaluation.
> This means in my package source that I submit to CRAN, the package manual
> must be pre-built and included in the tarball. I am able to build the PDF
> manual using devtools::build_manual(), but in the manual that is produced,
> greater-than signs (">") are replaced with upside-down question marks. See
> the first page of the attached manual for reference. What can I do to have
> this render correctly?



> 
> Running pdflatex --version in Terminal gives me the following:
> 
> pdfTeX 3.14159265-2.6-1.40.21 (TeX Live 2020)
> kpathsea version 6.3.2
> [Irrelevant stuff removed]
> Compiled with libpng 1.6.37; using libpng 1.6.37
> Compiled with zlib 1.2.11; using zlib 1.2.11
> Compiled with xpdf version 4.02
> 

According to the embedded information, you didn't use pdf(la)tex to 
produce that PDF.  It says the "PDF Producer" was "macOS Version 12.0.1 
(Build 21A559) Quartz PDFContext."  I'd try using the standard tools to 
build the manual, and see if that is any different.  That is, in 
Terminal, run

R CMD Rd2pdf <path to your package>

Duncan Murdoch


> I am on a Mac. I know very little about Latex (I don't use it for my
> writing). Thank you!
> 
> Noah
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@turner @end|ng |rom @uck|@nd@@c@nz  Fri Feb 25 22:43:12 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sat, 26 Feb 2022 10:43:12 +1300
Subject: [R-pkg-devel] Package manual build problem: ">" not rendered
 correctly
In-Reply-To: <CAPhhD8=T48YLHC1KwMJRuPe9j=HFqzsje1sNMQr12t=eHP2wgg@mail.gmail.com>
References: <CAPhhD8=T48YLHC1KwMJRuPe9j=HFqzsje1sNMQr12t=eHP2wgg@mail.gmail.com>
Message-ID: <20220226104312.69ad996d@rolf-Latitude-E7470>

On Fri, 25 Feb 2022 12:49:49 -0500
Noah Greifer <noah.greifer at gmail.com> wrote:


<SNIP>

> I know very little about Latex (I don't use it for my writing). 

<SNIP>

IMHO that is a flaw in your character. :-)

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From no@h@gre||er @end|ng |rom gm@||@com  Fri Feb 25 23:39:33 2022
From: no@h@gre||er @end|ng |rom gm@||@com (Noah Greifer)
Date: Fri, 25 Feb 2022 17:39:33 -0500
Subject: [R-pkg-devel] Package manual build problem: ">" not rendered
 correctly
In-Reply-To: <20220226104312.69ad996d@rolf-Latitude-E7470>
References: <CAPhhD8=T48YLHC1KwMJRuPe9j=HFqzsje1sNMQr12t=eHP2wgg@mail.gmail.com>
 <20220226104312.69ad996d@rolf-Latitude-E7470>
Message-ID: <CAPhhD8nFHQhd5KT2Pq9QLPrbJzDQqFm7mEEnD4zop3iEGqDmJA@mail.gmail.com>

Thank you for the help! I found "TinyTeX" which according to its developer
is a lightweight version of TeX Live for use by R users. I thought I had
installed it previously, but maybe not. After doing so, I was able to
render the manual correctly. Thank you for taking a look and helping me
solve this problem.

Noah

@Rolf We are all flawed in our own ways :) The only dark magic I have ever
cast has been getting formula numbers in Microsoft Word.

On Fri, Feb 25, 2022 at 4:43 PM Rolf Turner <r.turner at auckland.ac.nz> wrote:

> On Fri, 25 Feb 2022 12:49:49 -0500
> Noah Greifer <noah.greifer at gmail.com> wrote:
>
>
> <SNIP>
>
> > I know very little about Latex (I don't use it for my writing).
>
> <SNIP>
>
> IMHO that is a flaw in your character. :-)
>
> cheers,
>
> Rolf Turner
>
> --
> Honorary Research Fellow
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>
>

	[[alternative HTML version deleted]]


From sps@@derso@ m@iii@g oii gm@ii@com  Sun Feb 27 19:15:43 2022
From: sps@@derso@ m@iii@g oii gm@ii@com (sps@@derso@ m@iii@g oii gm@ii@com)
Date: Sun, 27 Feb 2022 13:15:43 -0500
Subject: [R-pkg-devel] Submission did not pass incoming checks
Message-ID: <9EAAD7A4-03A8-4FF4-8EB4-871F535C07C6@gmail.com>

Hi everyone, I have submitted my package healthyR.au to you CRAN it passes all the Arhubb checks properly but when I submit the CRAN I get an error at the following link

https://win-builder.r-project.org/incoming_pretest/healthyR.ai_0.0.6_20220227_175008/

I?m a little confused.


Sent from my iPhone
www.spsanderson.com
	[[alternative HTML version deleted]]


From @ergue|@@oko| @end|ng |rom gm@||@com  Mon Feb 28 15:17:03 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Serguei Sokol)
Date: Mon, 28 Feb 2022 15:17:03 +0100
Subject: [R-pkg-devel] Submission did not pass incoming checks
In-Reply-To: <9EAAD7A4-03A8-4FF4-8EB4-871F535C07C6@gmail.com>
References: <9EAAD7A4-03A8-4FF4-8EB4-871F535C07C6@gmail.com>
Message-ID: <60b19da0-67fe-0489-8558-9487540f34fb@gmail.com>

Le 27/02/2022 ? 19:15, spsanderson at gmail.com a ?crit?:
> Hi everyone, I have submitted my package healthyR.au to you CRAN it passes all the Arhubb checks properly but when I submit the CRAN I get an error at the following link
> 
> https://win-builder.r-project.org/incoming_pretest/healthyR.ai_0.0.6_20220227_175008/
> 
> I?m a little confused.
I don't see any error, only notes and warning.
For notes, they are pretty explicit, saying
Found if() conditions comparing class() to string:
File ???healthyR.ai/R/vec-hai-fourier-discrete.R???: if (class(.x) == 
"Date") ...

As class(x) can be a vector of strings, not just a string, it is much 
safer to use constructs like 'if (inherits(.x, "Date")) ...'

As to the warning, it says that you did not increment the package 
version which should be done on every new submission.

Best,
Serguei.

> 
> 
> Sent from my iPhone
> www.spsanderson.com
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Feb 28 15:21:11 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 28 Feb 2022 17:21:11 +0300
Subject: [R-pkg-devel] Submission did not pass incoming checks
In-Reply-To: <9EAAD7A4-03A8-4FF4-8EB4-871F535C07C6@gmail.com>
References: <9EAAD7A4-03A8-4FF4-8EB4-871F535C07C6@gmail.com>
Message-ID: <20220228172111.32a59999@Tarkus>

On Sun, 27 Feb 2022 13:15:43 -0500
spsanderson at gmail.com wrote:

> https://win-builder.r-project.org/incoming_pretest/healthyR.ai_0.0.6_20220227_175008/

The important part is the following NOTE from
https://win-builder.r-project.org/incoming_pretest/healthyR.ai_0.0.6_20220227_175008/Debian/00check.log:

>> * checking R code for possible problems ... [10s/10s] NOTE
>> Found if() conditions comparing class() to string:
>> File ?healthyR.ai/R/vec-hai-fourier-discrete.R?: if (class(.x) == "Date") ...
>> File ?healthyR.ai/R/vec-hai-fourier-discrete.R?: if (class(.x) == "POSIXct") ...
>> File ?healthyR.ai/R/vec-hai-fourier.R?: if (class(.x) == "Date") ...
>> File ?healthyR.ai/R/vec-hai-fourier.R?: if (class(.x) == "POSIXct") ...
>> File ?healthyR.ai/R/vec-hai-hyperbolic.R?: if (class(.x) == "Date") ...
>> File ?healthyR.ai/R/vec-hai-hyperbolic.R?: if (class(.x) == "POSIXct") ...
>> Use inherits() (or maybe is()) instead.

It even suggests how to solve the problem: use inherits(.x, 'Date')
instead of class(.x) == 'Date'. For more information, see the R blog:
https://developer.r-project.org/Blog/public/2019/11/09/when-you-think-class.-think-again/index.html

-- 
Best regards,
Ivan


From @p@@nder@on @end|ng |rom gm@||@com  Mon Feb 28 16:00:25 2022
From: @p@@nder@on @end|ng |rom gm@||@com (Steven P Sanderson II)
Date: Mon, 28 Feb 2022 10:00:25 -0500
Subject: [R-pkg-devel] Submission did not pass incoming checks
In-Reply-To: <60b19da0-67fe-0489-8558-9487540f34fb@gmail.com>
References: <9EAAD7A4-03A8-4FF4-8EB4-871F535C07C6@gmail.com>
 <60b19da0-67fe-0489-8558-9487540f34fb@gmail.com>
Message-ID: <CALXsb3KtvqfodG8vrycTCY-7pDd83gRispWrsVH+zFBaW1sBig@mail.gmail.com>

Thank you all, I did change over to the suggested construct of
if(inherits(x = .x, "Date")) etc. and the package was sent off.

On Mon, Feb 28, 2022 at 9:23 AM Serguei Sokol <serguei.sokol at gmail.com>
wrote:

> Le 27/02/2022 ? 19:15, spsanderson at gmail.com a ?crit :
> > Hi everyone, I have submitted my package healthyR.au to you CRAN it
> passes all the Arhubb checks properly but when I submit the CRAN I get an
> error at the following link
> >
> >
> https://win-builder.r-project.org/incoming_pretest/healthyR.ai_0.0.6_20220227_175008/
> >
> > I?m a little confused.
> I don't see any error, only notes and warning.
> For notes, they are pretty explicit, saying
> Found if() conditions comparing class() to string:
> File ???healthyR.ai/R/vec-hai-fourier-discrete.R???: if (class(.x) ==
> "Date") ...
>
> As class(x) can be a vector of strings, not just a string, it is much
> safer to use constructs like 'if (inherits(.x, "Date")) ...'
>
> As to the warning, it says that you did not increment the package
> version which should be done on every new submission.
>
> Best,
> Serguei.
>
> >
> >
> > Sent from my iPhone
> > www.spsanderson.com
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


-- 
Steven P Sanderson II, MPH
Book on Lulu <http://goo.gl/lmrlFI>
Personal Site <http://www.spsanderson.com>

	[[alternative HTML version deleted]]


From m@rt|n@@m|th @end|ng |rom durh@m@@c@uk  Mon Feb 28 16:29:04 2022
From: m@rt|n@@m|th @end|ng |rom durh@m@@c@uk (Martin R. Smith)
Date: Mon, 28 Feb 2022 15:29:04 +0000
Subject: [R-pkg-devel] Profiling C++ code in R packages on Windows
Message-ID: <CANotEPvFV7h2C3MrcTDT6fHtmbqETuEZqW8T8GrELxLoTorbMg@mail.gmail.com>

Dear all,

I've been struggling to profile C++ code within an R package I'm writing on
Windows 10.

After finding various excellent online guides, I'm building the package
with g++ 8.3.0 using -Og -g -fpic -mstackrealign, and omitting the -s flag
when linking the DLL. AMD ?prof is showing time spent within
[~]/R/win-library/4.1/00LOCK-MYPACKAGE/00new/MYPACKAGE/libs/x64/MYPACKAGE.dll,
but when I double click for a line-by-line profile I see "Binary file []
missing! Unable to show source view...". I have a similar issue if I try
using Very Sleepy instead.

I wonder whether anyone would be able to suggest why my profiler can't
identify functions, or find the package source?



My ideas so far:
-- I noticed that the source files constructed when installing the package
are no longer present: no .o or tmp.def files are evident in my package's
"src" directory. But I can't work out how to make these files persist
beyond the compilation process, in a manner that a profiler can locate
them. I've tried:

* Installing using devtools::install(keep.source = TRUE)
* Including the  --with-keep.source option when installing the package via
R CMD INSTALL (within RStudio)

-- The profiler is identifying the dll in a temporary 00LOCK- folder,
rather than its final location in win-library/4.1/MYPACAKGE/MYPACKAGE.dll.
This 00LOCK folder only exists whilst the package is being installed. Could
the DLL contain links to this folder that are not updated when the package
files are moved to their final home?

Many thanks,

Martin Smith

--

*Dr. Martin R. Smith*
Associate Professor in Palaeontology
Durham University
Department of Earth Sciences
Mountjoy Site, South Road, Durham, DH1 3LE United Kingdom

*M*: +44 (0)774 353 7510
*E*: martin.smith at durham.ac.uk
*Zoom room*: durhamuniversity.zoom.us/my/smith

smithlabdurham.github.io
twitter.com/PalaeoSmith

My working days are Monday?Thursday.

The information in this e-mail and any attachments is co...{{dropped:13}}


From w||||@m@becker @end|ng |rom b|ue|oxd@t@@eu  Mon Feb 28 15:51:08 2022
From: w||||@m@becker @end|ng |rom b|ue|oxd@t@@eu (William Becker)
Date: Mon, 28 Feb 2022 15:51:08 +0100 (CET)
Subject: [R-pkg-devel] Notifying users of major changes
Message-ID: <2090933404.418988.1646059868205@privateemail.com>

Dear All,

I'm new to this list so my apologies if a similar question has been asked recently.

I'm the maintainer of a package released last year (COINr). I am working on some major upgrades to the package which will unfortunately change a lot of the syntax. I know this will disrupt the users but the upgrades are substantial improvements and the underlying code is a lot more stable and robust. Moreover the package is high level so there are no reverse dependencies, and I thought I might as well get this done as early as possible so as to minimise the number of people affected. Obviously this is a one-off and in future the package will be backwards compatible.

Anyway to the question: I would like to warn users up front about the upcoming disruptive changes. What's the best way to do this? I can put a notice on the package's GitHub page. Or would it make sense to release a minor update with a package startup message warning about the impending upgrade? Or is there another way?

Thanks for any help or thoughts on this.
Will
	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Feb 28 20:32:16 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 28 Feb 2022 14:32:16 -0500
Subject: [R-pkg-devel] Notifying users of major changes
In-Reply-To: <2090933404.418988.1646059868205@privateemail.com>
References: <2090933404.418988.1646059868205@privateemail.com>
Message-ID: <6aa635e9-626a-d896-a7ca-5886f19c2e35@gmail.com>

On 28/02/2022 9:51 a.m., William Becker wrote:
> Dear All,
> 
> I'm new to this list so my apologies if a similar question has been asked recently.
> 
> I'm the maintainer of a package released last year (COINr). I am working on some major upgrades to the package which will unfortunately change a lot of the syntax. I know this will disrupt the users but the upgrades are substantial improvements and the underlying code is a lot more stable and robust. Moreover the package is high level so there are no reverse dependencies, and I thought I might as well get this done as early as possible so as to minimise the number of people affected. Obviously this is a one-off and in future the package will be backwards compatible.
> 
> Anyway to the question: I would like to warn users up front about the upcoming disruptive changes. What's the best way to do this? I can put a notice on the package's GitHub page. Or would it make sense to release a minor update with a package startup message warning about the impending upgrade? Or is there another way?
> 

I don't think there's a good way to connect with your users, other than 
printing a notice in the startup code and trying to recognize that they 
are using syntax that doesn't work in the new version.  I wouldn't 
bother with the minor update that just warns about upcoming changes, 
because at the point the user sees those, they won't be able to do 
anything about them.

I would put warnings or errors about using obsolete syntax into the new 
version if you can recognize it.  Include a vignette that shows old and 
new ways to do some of the common operations, and tell users which is 
the last version that supports the old syntax in case they are desperate 
and need to switch back.

If your changes mean that the old syntax works but does something 
different now, well, I'd advise against that.  You could really mess up 
users who are using your package to automatically produce reports.

In the extreme, you could create a new package (e.g. COINr2), and have 
one last update of COINr that tells users they should switch because you 
are going to stop maintaining it.  But it is better all around if you 
make all your changes in the existing package.

Duncan Murdoch


From m|ke @end|ng |rom b|ke@ctu@ry@com  Tue Mar  1 02:26:31 2022
From: m|ke @end|ng |rom b|ke@ctu@ry@com (Michael Barr)
Date: Tue, 1 Mar 2022 01:26:31 +0000
Subject: [R-pkg-devel] First package submissions archived
Message-ID: <MWHPR01MB2237F3EB591B19A8BFD4CAE4D3029@MWHPR01MB2237.prod.exchangelabs.com>

Hi,

I recently submitted a package (first) to CRAN and notice today it is in the "archive" folder, indicating it was rejected. I did have the below NOTES prior to submitting and included explanation in cran_comments which appears was not sufficient. What must I do with the below in order to release this package? How can I resolve all or at least the critical notes? I was unable to eliminate the pdf note despite having the R_QPDF and R_GSCMD env vars set. I assume I must wrap examples >5s in /donntrun{}?Appreciate help on the others.

Mike


New submission

Possibly misspelled words in DESCRIPTION:
  JSON (10:67)
  RePORTER (3:31, 11:65)
  tibble (14:24)

* checking sizes of PDF files under 'inst/doc' ... NOTE
Unable to find GhostScript executable to run checks on size reduction

* checking examples ... NOTE
Examples with CPU (user + system) or elapsed time > 5s
             user system elapsed
get_nih_data 4.29   0.08   19.18

* checking for detritus in the temp directory ... NOTE
Found the following files/directories:
  'lastMiKTeXException'


	[[alternative HTML version deleted]]


From sps@@derso@ m@iii@g oii gm@ii@com  Tue Mar  1 10:47:40 2022
From: sps@@derso@ m@iii@g oii gm@ii@com (sps@@derso@ m@iii@g oii gm@ii@com)
Date: Tue, 1 Mar 2022 04:47:40 -0500
Subject: [R-pkg-devel] First package submissions archived
In-Reply-To: <MWHPR01MB2237F3EB591B19A8BFD4CAE4D3029@MWHPR01MB2237.prod.exchangelabs.com>
References: <MWHPR01MB2237F3EB591B19A8BFD4CAE4D3029@MWHPR01MB2237.prod.exchangelabs.com>
Message-ID: <B8DE4441-0804-42C9-B46E-C56524C25D02@gmail.com>

Yes, I would wrap that example in the \donrun{}

Not sure on the Ghostscript though

Sent from my iPhone
www.spsanderson.com

> On Mar 1, 2022, at 4:36 AM, Michael Barr <mike at bikeactuary.com> wrote:
> 
> ?Hi,
> 
> I recently submitted a package (first) to CRAN and notice today it is in the "archive" folder, indicating it was rejected. I did have the below NOTES prior to submitting and included explanation in cran_comments which appears was not sufficient. What must I do with the below in order to release this package? How can I resolve all or at least the critical notes? I was unable to eliminate the pdf note despite having the R_QPDF and R_GSCMD env vars set. I assume I must wrap examples >5s in /donntrun{}?Appreciate help on the others.
> 
> Mike
> 
> 
> New submission
> 
> Possibly misspelled words in DESCRIPTION:
>  JSON (10:67)
>  RePORTER (3:31, 11:65)
>  tibble (14:24)
> 
> * checking sizes of PDF files under 'inst/doc' ... NOTE
> Unable to find GhostScript executable to run checks on size reduction
> 
> * checking examples ... NOTE
> Examples with CPU (user + system) or elapsed time > 5s
>             user system elapsed
> get_nih_data 4.29   0.08   19.18
> 
> * checking for detritus in the temp directory ... NOTE
> Found the following files/directories:
>  'lastMiKTeXException'
> 
> 
>    [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From henr|k@bengt@@on @end|ng |rom gm@||@com  Tue Mar  1 14:14:09 2022
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Tue, 1 Mar 2022 05:14:09 -0800
Subject: [R-pkg-devel] First package submissions archived
In-Reply-To: <MWHPR01MB2237F3EB591B19A8BFD4CAE4D3029@MWHPR01MB2237.prod.exchangelabs.com>
References: <MWHPR01MB2237F3EB591B19A8BFD4CAE4D3029@MWHPR01MB2237.prod.exchangelabs.com>
Message-ID: <CAFDcVCRe6hjaEOGbfi=w7iHAj_Br2Gu_FJub3zJbq25ygB3Xbg@mail.gmail.com>

Hi, that's a bummer and unusual, especially since things are normally
caught at submission prior to publication.

If you share which the package is, others might give suggestions.

My $.02

Henrik

On Tue, Mar 1, 2022, 01:36 Michael Barr <mike at bikeactuary.com> wrote:

> Hi,
>
> I recently submitted a package (first) to CRAN and notice today it is in
> the "archive" folder, indicating it was rejected. I did have the below
> NOTES prior to submitting and included explanation in cran_comments which
> appears was not sufficient. What must I do with the below in order to
> release this package? How can I resolve all or at least the critical notes?
> I was unable to eliminate the pdf note despite having the R_QPDF and
> R_GSCMD env vars set. I assume I must wrap examples >5s in
> /donntrun{}?Appreciate help on the others.
>
> Mike
>
>
> New submission
>
> Possibly misspelled words in DESCRIPTION:
>   JSON (10:67)
>   RePORTER (3:31, 11:65)
>   tibble (14:24)
>
> * checking sizes of PDF files under 'inst/doc' ... NOTE
> Unable to find GhostScript executable to run checks on size reduction
>
> * checking examples ... NOTE
> Examples with CPU (user + system) or elapsed time > 5s
>              user system elapsed
> get_nih_data 4.29   0.08   19.18
>
> * checking for detritus in the temp directory ... NOTE
> Found the following files/directories:
>   'lastMiKTeXException'
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Tue Mar  1 16:59:47 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Tue, 1 Mar 2022 16:59:47 +0100
Subject: [R-pkg-devel] First package submissions archived
In-Reply-To: <B8DE4441-0804-42C9-B46E-C56524C25D02@gmail.com>
References: <MWHPR01MB2237F3EB591B19A8BFD4CAE4D3029@MWHPR01MB2237.prod.exchangelabs.com>
 <B8DE4441-0804-42C9-B46E-C56524C25D02@gmail.com>
Message-ID: <b1bce503-e3b5-34c7-eff1-763c53a05020@statistik.tu-dortmund.de>

Therelevant note is

Examples with CPU (user + system) or elapsed time > 5s
             user system elapsed
get_nih_data 4.29   0.08   19.18

(I doubt you got the other on a CRAN usbmission?)


Theb example tiem shoudl be reduced to less than 5 sec.
Ideally use toy data and few iterations and set time limits for web 
access. If you cannot reduce further, wrap in \donttest{}.

Best,
Uwe Ligges




On 01.03.2022 10:47, spsanderson at gmail.com wrote:
> Yes, I would wrap that example in the \donrun{}
> 
> Not sure on the Ghostscript though
> 
> Sent from my iPhone
> www.spsanderson.com
> 
>> On Mar 1, 2022, at 4:36 AM, Michael Barr <mike at bikeactuary.com> wrote:
>>
>> ?Hi,
>>
>> I recently submitted a package (first) to CRAN and notice today it is in the "archive" folder, indicating it was rejected. I did have the below NOTES prior to submitting and included explanation in cran_comments which appears was not sufficient. What must I do with the below in order to release this package? How can I resolve all or at least the critical notes? I was unable to eliminate the pdf note despite having the R_QPDF and R_GSCMD env vars set. I assume I must wrap examples >5s in /donntrun{}?Appreciate help on the others.
>>
>> Mike
>>
>>
>> New submission
>>
>> Possibly misspelled words in DESCRIPTION:
>>   JSON (10:67)
>>   RePORTER (3:31, 11:65)
>>   tibble (14:24)
>>
>> * checking sizes of PDF files under 'inst/doc' ... NOTE
>> Unable to find GhostScript executable to run checks on size reduction
>>
>> * checking examples ... NOTE
>> Examples with CPU (user + system) or elapsed time > 5s
>>              user system elapsed
>> get_nih_data 4.29   0.08   19.18
>>
>> * checking for detritus in the temp directory ... NOTE
>> Found the following files/directories:
>>   'lastMiKTeXException'
>>
>>
>>     [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m|ke @end|ng |rom b|ke@ctu@ry@com  Tue Mar  1 17:25:08 2022
From: m|ke @end|ng |rom b|ke@ctu@ry@com (Michael Barr)
Date: Tue, 1 Mar 2022 16:25:08 +0000
Subject: [R-pkg-devel] First package submissions archived
In-Reply-To: <b1bce503-e3b5-34c7-eff1-763c53a05020@statistik.tu-dortmund.de>
References: <MWHPR01MB2237F3EB591B19A8BFD4CAE4D3029@MWHPR01MB2237.prod.exchangelabs.com>
 <B8DE4441-0804-42C9-B46E-C56524C25D02@gmail.com>
 <b1bce503-e3b5-34c7-eff1-763c53a05020@statistik.tu-dortmund.de>
Message-ID: <MWHPR01MB22379CBDCB80B21108847587D3029@MWHPR01MB2237.prod.exchangelabs.com>

Thank you - I?ve wrapped in donttest and resubmitted.

This is related to repoRter.nih submission btw.

Sorry, a couple of those notes I probably pulled from my own cran-comments.md which was included in the submission response email and I mistook as coming from CRAN?s check.
________________________________
From: Uwe Ligges <ligges at statistik.tu-dortmund.de>
Sent: Tuesday, March 1, 2022 10:59 AM
To: spsanderson at gmail.com <spsanderson at gmail.com>; Michael Barr <mike at bikeactuary.com>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] First package submissions archived

Therelevant note is

Examples with CPU (user + system) or elapsed time > 5s
             user system elapsed
get_nih_data 4.29   0.08   19.18

(I doubt you got the other on a CRAN usbmission?)


Theb example tiem shoudl be reduced to less than 5 sec.
Ideally use toy data and few iterations and set time limits for web
access. If you cannot reduce further, wrap in \donttest{}.

Best,
Uwe Ligges




On 01.03.2022 10:47, spsanderson at gmail.com wrote:
> Yes, I would wrap that example in the \donrun{}
>
> Not sure on the Ghostscript though
>
> Sent from my iPhone
> www.spsanderson.com<http://www.spsanderson.com>
>
>> On Mar 1, 2022, at 4:36 AM, Michael Barr <mike at bikeactuary.com> wrote:
>>
>> ?Hi,
>>
>> I recently submitted a package (first) to CRAN and notice today it is in the "archive" folder, indicating it was rejected. I did have the below NOTES prior to submitting and included explanation in cran_comments which appears was not sufficient. What must I do with the below in order to release this package? How can I resolve all or at least the critical notes? I was unable to eliminate the pdf note despite having the R_QPDF and R_GSCMD env vars set. I assume I must wrap examples >5s in /donntrun{}?Appreciate help on the others.
>>
>> Mike
>>
>>
>> New submission
>>
>> Possibly misspelled words in DESCRIPTION:
>>   JSON (10:67)
>>   RePORTER (3:31, 11:65)
>>   tibble (14:24)
>>
>> * checking sizes of PDF files under 'inst/doc' ... NOTE
>> Unable to find GhostScript executable to run checks on size reduction
>>
>> * checking examples ... NOTE
>> Examples with CPU (user + system) or elapsed time > 5s
>>              user system elapsed
>> get_nih_data 4.29   0.08   19.18
>>
>> * checking for detritus in the temp directory ... NOTE
>> Found the following files/directories:
>>   'lastMiKTeXException'
>>
>>
>>     [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From v|ncentv@nhee@ @end|ng |rom gm@||@com  Wed Mar  2 08:37:24 2022
From: v|ncentv@nhee@ @end|ng |rom gm@||@com (Vincent van Hees)
Date: Wed, 2 Mar 2022 08:37:24 +0100
Subject: [R-pkg-devel] Notifying users of major changes
In-Reply-To: <6aa635e9-626a-d896-a7ca-5886f19c2e35@gmail.com>
References: <2090933404.418988.1646059868205@privateemail.com>
 <6aa635e9-626a-d896-a7ca-5886f19c2e35@gmail.com>
Message-ID: <CALnEB17jrfXAPwzJSfN6GvdnY4orj41UukrTbP3s=A6+-R1jTw@mail.gmail.com>

Dear Will,
I agree with the suggestions from Duncan. Additionally, you could consider
facilitating both new and old syntax for a certain transition period e.g. 1
year. During this transition period you would show a warning message to
users of the old syntax.
When the transition period is over you replace the warning by an error and
start deprecating code relating to the old syntax. This will make the
transition less abrupt for users. However, it comes with the cost of having
to maintain both syntaxes. I tend use this when I deprecate or change the
name of my function arguments.
Vincent





On Mon, 28 Feb 2022 at 20:32, Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 28/02/2022 9:51 a.m., William Becker wrote:
> > Dear All,
> >
> > I'm new to this list so my apologies if a similar question has been
> asked recently.
> >
> > I'm the maintainer of a package released last year (COINr). I am working
> on some major upgrades to the package which will unfortunately change a lot
> of the syntax. I know this will disrupt the users but the upgrades are
> substantial improvements and the underlying code is a lot more stable and
> robust. Moreover the package is high level so there are no reverse
> dependencies, and I thought I might as well get this done as early as
> possible so as to minimise the number of people affected. Obviously this is
> a one-off and in future the package will be backwards compatible.
> >
> > Anyway to the question: I would like to warn users up front about the
> upcoming disruptive changes. What's the best way to do this? I can put a
> notice on the package's GitHub page. Or would it make sense to release a
> minor update with a package startup message warning about the impending
> upgrade? Or is there another way?
> >
>
> I don't think there's a good way to connect with your users, other than
> printing a notice in the startup code and trying to recognize that they
> are using syntax that doesn't work in the new version.  I wouldn't
> bother with the minor update that just warns about upcoming changes,
> because at the point the user sees those, they won't be able to do
> anything about them.
>
> I would put warnings or errors about using obsolete syntax into the new
> version if you can recognize it.  Include a vignette that shows old and
> new ways to do some of the common operations, and tell users which is
> the last version that supports the old syntax in case they are desperate
> and need to switch back.
>
> If your changes mean that the old syntax works but does something
> different now, well, I'd advise against that.  You could really mess up
> users who are using your package to automatically produce reports.
>
> In the extreme, you could create a new package (e.g. COINr2), and have
> one last update of COINr that tells users they should switch because you
> are going to stop maintaining it.  But it is better all around if you
> make all your changes in the existing package.
>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ||u|@@rev|||@ @end|ng |rom gm@||@com  Wed Mar  2 10:14:30 2022
From: ||u|@@rev|||@ @end|ng |rom gm@||@com (=?UTF-8?Q?Llu=C3=ADs_Revilla?=)
Date: Wed, 2 Mar 2022 10:14:30 +0100
Subject: [R-pkg-devel] Notifying users of major changes
In-Reply-To: <CALnEB17jrfXAPwzJSfN6GvdnY4orj41UukrTbP3s=A6+-R1jTw@mail.gmail.com>
References: <2090933404.418988.1646059868205@privateemail.com>
 <6aa635e9-626a-d896-a7ca-5886f19c2e35@gmail.com>
 <CALnEB17jrfXAPwzJSfN6GvdnY4orj41UukrTbP3s=A6+-R1jTw@mail.gmail.com>
Message-ID: <CAN+W6_t3_XT--KaavM1b4FLYMR=KJavHtioaL+-x3gOhuTxuuQ@mail.gmail.com>

Dear all,

Doesn't R have a couple of functions for that?
On base there is a function to notify users of a close removal with
.Deprecated.
When the function is finally removed the .Defunct function can be used
to notify the users too.
Other packages use their own functions to notify users or those functions
on the lifecycle package.

Cheers,

Llu?s



On Wed, 2 Mar 2022 at 08:38, Vincent van Hees <vincentvanhees at gmail.com>
wrote:

> Dear Will,
> I agree with the suggestions from Duncan. Additionally, you could consider
> facilitating both new and old syntax for a certain transition period e.g. 1
> year. During this transition period you would show a warning message to
> users of the old syntax.
> When the transition period is over you replace the warning by an error and
> start deprecating code relating to the old syntax. This will make the
> transition less abrupt for users. However, it comes with the cost of having
> to maintain both syntaxes. I tend use this when I deprecate or change the
> name of my function arguments.
> Vincent
>
>
>
>
>
> On Mon, 28 Feb 2022 at 20:32, Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
>
> > On 28/02/2022 9:51 a.m., William Becker wrote:
> > > Dear All,
> > >
> > > I'm new to this list so my apologies if a similar question has been
> > asked recently.
> > >
> > > I'm the maintainer of a package released last year (COINr). I am
> working
> > on some major upgrades to the package which will unfortunately change a
> lot
> > of the syntax. I know this will disrupt the users but the upgrades are
> > substantial improvements and the underlying code is a lot more stable and
> > robust. Moreover the package is high level so there are no reverse
> > dependencies, and I thought I might as well get this done as early as
> > possible so as to minimise the number of people affected. Obviously this
> is
> > a one-off and in future the package will be backwards compatible.
> > >
> > > Anyway to the question: I would like to warn users up front about the
> > upcoming disruptive changes. What's the best way to do this? I can put a
> > notice on the package's GitHub page. Or would it make sense to release a
> > minor update with a package startup message warning about the impending
> > upgrade? Or is there another way?
> > >
> >
> > I don't think there's a good way to connect with your users, other than
> > printing a notice in the startup code and trying to recognize that they
> > are using syntax that doesn't work in the new version.  I wouldn't
> > bother with the minor update that just warns about upcoming changes,
> > because at the point the user sees those, they won't be able to do
> > anything about them.
> >
> > I would put warnings or errors about using obsolete syntax into the new
> > version if you can recognize it.  Include a vignette that shows old and
> > new ways to do some of the common operations, and tell users which is
> > the last version that supports the old syntax in case they are desperate
> > and need to switch back.
> >
> > If your changes mean that the old syntax works but does something
> > different now, well, I'd advise against that.  You could really mess up
> > users who are using your package to automatically produce reports.
> >
> > In the extreme, you could create a new package (e.g. COINr2), and have
> > one last update of COINr that tells users they should switch because you
> > are going to stop maintaining it.  But it is better all around if you
> > make all your changes in the existing package.
> >
> > Duncan Murdoch
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From w||||@m@becker @end|ng |rom b|ue|oxd@t@@eu  Wed Mar  2 11:19:16 2022
From: w||||@m@becker @end|ng |rom b|ue|oxd@t@@eu (William Becker)
Date: Wed, 2 Mar 2022 11:19:16 +0100 (CET)
Subject: [R-pkg-devel] Notifying users of major changes
In-Reply-To: <CAN+W6_t3_XT--KaavM1b4FLYMR=KJavHtioaL+-x3gOhuTxuuQ@mail.gmail.com>
References: <2090933404.418988.1646059868205@privateemail.com>
 <6aa635e9-626a-d896-a7ca-5886f19c2e35@gmail.com>
 <CALnEB17jrfXAPwzJSfN6GvdnY4orj41UukrTbP3s=A6+-R1jTw@mail.gmail.com>
 <CAN+W6_t3_XT--KaavM1b4FLYMR=KJavHtioaL+-x3gOhuTxuuQ@mail.gmail.com>
Message-ID: <198550864.557005.1646216356375@privateemail.com>

Dear All,

Thanks for all the advice on this. My plan is now to generate messages from old functions that point to the new function equivalent. The .Deprecated/.Defunct functions look very helpful in this regard. I will also write a vignette explaining all the changes as suggested, to try to ease the transition. I already put up an advance notice on the readme on GitHub which may also help a bit.

Thanks again for the help,
Will

> On 02/03/2022 10:14 Llu?s Revilla <lluis.revilla at gmail.com> wrote:
> 
>  
> Dear all,
> 
> Doesn't R have a couple of functions for that?
> On base there is a function to notify users of a close removal with
> .Deprecated.
> When the function is finally removed the .Defunct function can be used
> to notify the users too.
> Other packages use their own functions to notify users or those functions
> on the lifecycle package.
> 
> Cheers,
> 
> Llu?s
> 
> 
> 
> On Wed, 2 Mar 2022 at 08:38, Vincent van Hees <vincentvanhees at gmail.com>
> wrote:
> 
> > Dear Will,
> > I agree with the suggestions from Duncan. Additionally, you could consider
> > facilitating both new and old syntax for a certain transition period e.g. 1
> > year. During this transition period you would show a warning message to
> > users of the old syntax.
> > When the transition period is over you replace the warning by an error and
> > start deprecating code relating to the old syntax. This will make the
> > transition less abrupt for users. However, it comes with the cost of having
> > to maintain both syntaxes. I tend use this when I deprecate or change the
> > name of my function arguments.
> > Vincent
> >
> >
> >
> >
> >
> > On Mon, 28 Feb 2022 at 20:32, Duncan Murdoch <murdoch.duncan at gmail.com>
> > wrote:
> >
> > > On 28/02/2022 9:51 a.m., William Becker wrote:
> > > > Dear All,
> > > >
> > > > I'm new to this list so my apologies if a similar question has been
> > > asked recently.
> > > >
> > > > I'm the maintainer of a package released last year (COINr). I am
> > working
> > > on some major upgrades to the package which will unfortunately change a
> > lot
> > > of the syntax. I know this will disrupt the users but the upgrades are
> > > substantial improvements and the underlying code is a lot more stable and
> > > robust. Moreover the package is high level so there are no reverse
> > > dependencies, and I thought I might as well get this done as early as
> > > possible so as to minimise the number of people affected. Obviously this
> > is
> > > a one-off and in future the package will be backwards compatible.
> > > >
> > > > Anyway to the question: I would like to warn users up front about the
> > > upcoming disruptive changes. What's the best way to do this? I can put a
> > > notice on the package's GitHub page. Or would it make sense to release a
> > > minor update with a package startup message warning about the impending
> > > upgrade? Or is there another way?
> > > >
> > >
> > > I don't think there's a good way to connect with your users, other than
> > > printing a notice in the startup code and trying to recognize that they
> > > are using syntax that doesn't work in the new version.  I wouldn't
> > > bother with the minor update that just warns about upcoming changes,
> > > because at the point the user sees those, they won't be able to do
> > > anything about them.
> > >
> > > I would put warnings or errors about using obsolete syntax into the new
> > > version if you can recognize it.  Include a vignette that shows old and
> > > new ways to do some of the common operations, and tell users which is
> > > the last version that supports the old syntax in case they are desperate
> > > and need to switch back.
> > >
> > > If your changes mean that the old syntax works but does something
> > > different now, well, I'd advise against that.  You could really mess up
> > > users who are using your package to automatically produce reports.
> > >
> > > In the extreme, you could create a new package (e.g. COINr2), and have
> > > one last update of COINr that tells users they should switch because you
> > > are going to stop maintaining it.  But it is better all around if you
> > > make all your changes in the existing package.
> > >
> > > Duncan Murdoch
> > >
> > > ______________________________________________
> > > R-package-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> > >
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

William Becker PhD
www.bluefoxdata.eu (http://www.bluefoxdata.eu) | Researchgate (https://www.researchgate.net/profile/William_Becker4) | LinkedIn (https://www.linkedin.com/in/webecker/) | GitHub (https://github.com/bluefoxr)


From j|n||68 @end|ng |rom gm@||@com  Wed Mar  2 05:04:51 2022
From: j|n||68 @end|ng |rom gm@||@com (Jin Li)
Date: Wed, 2 Mar 2022 15:04:51 +1100
Subject: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'
Message-ID: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>

Hi All,

I have recently tried to update a package with a new function based on an
existing function `fastTpsMLE` in the `fields` package. It is working well
on my computer without any errors. However, when the package was submitted
to CRAN the following warning is received as detailed below:
Check: dependencies in R code, Result: WARNING
  Missing or unexported object: 'fields::fastTpsMLE'

I was wondering if anyone could please guide me to get rid of this warning.
Thanks a lot in advance.

Best regards,
-- 
Jin
------------------------------------------
Jin Li, PhD
Founder, Data2action, Australia
https://www.researchgate.net/profile/Jin_Li32
https://scholar.google.com/citations?user=Jeot53EAAAAJ&hl=en

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Wed Mar  2 15:54:07 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 2 Mar 2022 08:54:07 -0600
Subject: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'
In-Reply-To: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
References: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
Message-ID: <25119.34063.62449.926825@rob.eddelbuettel.com>


On 2 March 2022 at 15:04, Jin Li wrote:
| I have recently tried to update a package with a new function based on an
| existing function `fastTpsMLE` in the `fields` package. It is working well
| on my computer without any errors. However, when the package was submitted
| to CRAN the following warning is received as detailed below:
| Check: dependencies in R code, Result: WARNING
|   Missing or unexported object: 'fields::fastTpsMLE'
| 
| I was wondering if anyone could please guide me to get rid of this warning.
| Thanks a lot in advance.

Can you show us your sources?  Is there a public repository?

It might be as simple as you selectively importing from package 'fields' in
file NAMESPACE where you may just need to add an additinal import for the
newly added use of 'fastTplsMLE'.

But without access to a the code (== the minimally reproducible example) we
can only guess.

Hth, Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Mar  2 15:58:06 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 2 Mar 2022 17:58:06 +0300
Subject: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'
In-Reply-To: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
References: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
Message-ID: <20220302175806.39403596@Tarkus>

On Wed, 2 Mar 2022 15:04:51 +1100
Jin Li <jinli68 at gmail.com> wrote:

> Missing or unexported object: 'fields::fastTpsMLE'

The current CRAN version of fields doesn't seem to have "fastTpsMLE" in
its documentation:
https://cran.r-project.org/web/packages/fields/fields.pdf

I also can't seem to find fastTpsMLE in the GitHub repo of the package:
https://github.com/dnychka/fieldsRPackage/search?q=fastTpsMLE

Which version of fields do you have installed?

-- 
Best regards,
Ivan


From m|ke @end|ng |rom b|ke@ctu@ry@com  Wed Mar  2 16:35:20 2022
From: m|ke @end|ng |rom b|ke@ctu@ry@com (Michael Barr)
Date: Wed, 2 Mar 2022 15:35:20 +0000
Subject: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'
In-Reply-To: <20220302175806.39403596@Tarkus>
References: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
 <20220302175806.39403596@Tarkus>
Message-ID: <MWHPR01MB22371084A8A53F07809F813FD3039@MWHPR01MB2237.prod.exchangelabs.com>

fastTpsMLE is not in the current version of fields - latest version I see with it is 11.x. 12.x onward you use fastTps() and can specify REML=TRUE for the estimator. You are probably using 12.x and looking at older documentation. A quick glance at the older source for fastTpsMLE and I think that they were actually using REML in practice (holding some parameters fixed, optimizing others).
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Ivan Krylov <krylov.r00t at gmail.com>
Sent: Wednesday, March 2, 2022 9:58 AM
To: Jin Li <jinli68 at gmail.com>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'

On Wed, 2 Mar 2022 15:04:51 +1100
Jin Li <jinli68 at gmail.com> wrote:

> Missing or unexported object: 'fields::fastTpsMLE'

The current CRAN version of fields doesn't seem to have "fastTpsMLE" in
its documentation:
https://cran.r-project.org/web/packages/fields/fields.pdf

I also can't seem to find fastTpsMLE in the GitHub repo of the package:
https://github.com/dnychka/fieldsRPackage/search?q=fastTpsMLE

Which version of fields do you have installed?

--
Best regards,
Ivan

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From m@tthew@k@y @end|ng |rom gm@||@com  Wed Mar  2 21:08:39 2022
From: m@tthew@k@y @end|ng |rom gm@||@com (Matthew Kay)
Date: Wed, 2 Mar 2022 14:08:39 -0600
Subject: [R-pkg-devel] False negatives for CRAN url check on DOIs due to
 Cloudflare anti-DDoS
Message-ID: <CADHJc0H_dcjCH6NEnu5O2grEQavcr5z5TW3iEK7m_b8FJ628VQ@mail.gmail.com>

Hi,

I have recently noticed an increasing number of false negatives with the
CRAN url check on DOIs. The essence of the problem is that certain DOIs
will load fine in the browser, but return a 503 error to `curl -I -L` and
therefore trigger a NOTE on CMD CHECK.

Two example DOIs I have run into already, which used to pass fine without
NOTEs (and still load fine in a browser):

https://doi.org/10.1111/1467-985X.00120
https://doi.org/10.1177/096228029200100102

Here are the headers of the (final, after redirects) 503 response via curl:

HTTP/1.1 503 Service Temporarily Unavailable
> Date: Wed, 02 Mar 2022 19:19:39 GMT
> Content-Type: text/html; charset=UTF-8
> Connection: close
> X-Frame-Options: SAMEORIGIN
> Permissions-Policy:
> accelerometer=(),autoplay=(),camera=(),clipboard-read=(),clipboard-write=(),fullscreen=(),geoloca
>
> tion=(),gyroscope=(),hid=(),interest-cohort=(),magnetometer=(),microphone=(),payment=(),publickey-credentials-get=(),
> screen-wake-lock=(),serial=(),sync-xhr=(),usb=()
> Cache-Control: private, max-age=0, no-store, no-cache, must-revalidate,
> post-check=0, pre-check=0
> Expires: Thu, 01 Jan 1970 00:00:01 GMT
> Expect-CT: max-age=604800, report-uri="
> https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct"
> Set-Cookie:
> __cf_bm=3sNb43ySbB.qquj3NGAjnfBHzV_o5LYBOHjCtdj.HXo-1646248779-0-Aa4oCF746nYwQXhKGA2xJIJ5jvxJXbsPXtflcSqS
> q+AjMfQYuLyNSo3fFeCBGKEdS2rIjyDW0HkT40tB1OuDxZ2sWnUZG+y/4dpZsY54IWU4;
> path=/; expires=Wed, 02-Mar-22 19:49:39 GMT; do
> main=.onlinelibrary.wiley.com; HttpOnly; Secure; SameSite=None
> Strict-Transport-Security: max-age=15552000
> Server: cloudflare
> CF-RAY: 6e5c7c376d11c518-ORD


We can see the response is coming from Cloudflare, which runs an anti-DDoS
service. More discussion on that here
<https://superuser.com/questions/888507/problems-with-wget-to-a-cloudflare-hosted-site-503-service-unavailable>,
but the upshot seems to be that without a JavaScript enabled browser this
probably is not a solvable problem.

Anecdotally, this seems like a problem that could get worse: a few months
ago I had one false negative DOI in a package submission, more recently
(about a week ago) I had two. I have heard from other authors encountering
this problem lately as well.

Strategically, this disincentivizes package authors from accurately citing
sources in order to avoid spurious NOTEs (without which, a whitelisted
package can bypass human inspection and get to CRAN faster).

Perhaps a solution might be to use a dedicated API to check DOIs. CrossRef
offers one such, though it only works for CrossRef DOIs:
https://api.crossref.org/swagger-ui/index.html

For example, applying the API to one of the failing DOIs from above returns
200 OK:

curl -I -L https://api.crossref.org/works/10.1177/096228029200100102/agency

Another option might be to just look at the first response to the DOI
request (i.e., not to follow redirects; just curl -I not curl -I -L). I
*think* this should return 302 on valid DOIs and 404 on invalid DOIs. For
example, this returns 302 Found:

curl -I https://doi.org/10.1111/1467-985X.00120

And this non-existent DOI returns 404:

curl -I https://doi.org/10.1111/1467-985X.XXXXXX

So perhaps just using curl -I to check DOI urls would solve the problem?

Thanks,

---Matt


-- 
As an adherent of Email Friday
<https://mjskay.medium.com/the-doctrine-of-email-friday-add7f8332d80>, if
your email is not urgent I likely won't reply until the next Friday.
--
Matthew Kay
Assistant Professor
Northwestern University Computer Science and Communication Studies
mjskay at northwestern.edu
http://www.mjskay.com/

	[[alternative HTML version deleted]]


From j|n||68 @end|ng |rom gm@||@com  Thu Mar  3 05:41:13 2022
From: j|n||68 @end|ng |rom gm@||@com (Jin Li)
Date: Thu, 3 Mar 2022 15:41:13 +1100
Subject: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'
In-Reply-To: <20220302175806.39403596@Tarkus>
References: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
 <20220302175806.39403596@Tarkus>
Message-ID: <CAGu_3ZLG=dx8Z1QGux05dfcZ-G2wfJy4jTWo1w76ovQCCU9mXA@mail.gmail.com>

Thanks a lot Ivan. An old version (09/10/2020) was used.
Best,
Jin

On Thu, Mar 3, 2022 at 1:58 AM Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Wed, 2 Mar 2022 15:04:51 +1100
> Jin Li <jinli68 at gmail.com> wrote:
>
> > Missing or unexported object: 'fields::fastTpsMLE'
>
> The current CRAN version of fields doesn't seem to have "fastTpsMLE" in
> its documentation:
> https://cran.r-project.org/web/packages/fields/fields.pdf
>
> I also can't seem to find fastTpsMLE in the GitHub repo of the package:
> https://github.com/dnychka/fieldsRPackage/search?q=fastTpsMLE
>
> Which version of fields do you have installed?
>
> --
> Best regards,
> Ivan
>


-- 
Jin
------------------------------------------
Jin Li, PhD
Founder, Data2action, Australia
https://www.researchgate.net/profile/Jin_Li32
https://scholar.google.com/citations?user=Jeot53EAAAAJ&hl=en

	[[alternative HTML version deleted]]


From j|n||68 @end|ng |rom gm@||@com  Thu Mar  3 05:53:32 2022
From: j|n||68 @end|ng |rom gm@||@com (Jin Li)
Date: Thu, 3 Mar 2022 15:53:32 +1100
Subject: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'
In-Reply-To: <MWHPR01MB22371084A8A53F07809F813FD3039@MWHPR01MB2237.prod.exchangelabs.com>
References: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
 <20220302175806.39403596@Tarkus>
 <MWHPR01MB22371084A8A53F07809F813FD3039@MWHPR01MB2237.prod.exchangelabs.com>
Message-ID: <CAGu_3ZJB8V75vcGP5+yB1=rqejsfk+ocdBYK4fp0k1qF4vrA1g@mail.gmail.com>

Many thanks, Michael.

The `fastTpsMLE` was used to estimate `lambda` for `Tps` as below:

library(fields); library(spm); data(petrel)
x=petrel[, c(1,2)]; y=petrel[, 5]; theta = 3

lambda <- fields::fastTpsMLE(x, y, theta = theta)$lambda.best
lambda
[1] 0.9875504

I have just updated the `fields` package. However, `lambda` is not reported
by `fastTps`. But I need an estimate of `lamda` for `Tps`. Is there a
solution for this?

Best,
Jin

On Thu, Mar 3, 2022 at 2:35 AM Michael Barr <mike at bikeactuary.com> wrote:

> fastTpsMLE is not in the current version of fields - latest version I see
> with it is 11.x. 12.x onward you use fastTps() and can specify REML=TRUE
> for the estimator. You are probably using 12.x and looking at older
> documentation. A quick glance at the older source for fastTpsMLE and I
> think that they were actually using REML in practice (holding some
> parameters fixed, optimizing others).
> ------------------------------
> *From:* R-package-devel <r-package-devel-bounces at r-project.org> on behalf
> of Ivan Krylov <krylov.r00t at gmail.com>
> *Sent:* Wednesday, March 2, 2022 9:58 AM
> *To:* Jin Li <jinli68 at gmail.com>
> *Cc:* r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject:* Re: [R-pkg-devel] Warning from dependencies:
> 'fields::fastTpsMLE'
>
> On Wed, 2 Mar 2022 15:04:51 +1100
> Jin Li <jinli68 at gmail.com> wrote:
>
> > Missing or unexported object: 'fields::fastTpsMLE'
>
> The current CRAN version of fields doesn't seem to have "fastTpsMLE" in
> its documentation:
> https://cran.r-project.org/web/packages/fields/fields.pdf
>
> I also can't seem to find fastTpsMLE in the GitHub repo of the package:
> https://github.com/dnychka/fieldsRPackage/search?q=fastTpsMLE
>
> Which version of fields do you have installed?
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


-- 
Jin
------------------------------------------
Jin Li, PhD
Founder, Data2action, Australia
https://www.researchgate.net/profile/Jin_Li32
https://scholar.google.com/citations?user=Jeot53EAAAAJ&hl=en

	[[alternative HTML version deleted]]


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu Mar  3 08:53:44 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 3 Mar 2022 08:53:44 +0100
Subject: [R-pkg-devel] False positives for CRAN url check on DOIs due to
 Cloudflare anti-DDoS
In-Reply-To: <CADHJc0H_dcjCH6NEnu5O2grEQavcr5z5TW3iEK7m_b8FJ628VQ@mail.gmail.com>
References: <CADHJc0H_dcjCH6NEnu5O2grEQavcr5z5TW3iEK7m_b8FJ628VQ@mail.gmail.com>
Message-ID: <25120.29704.13117.95788@stat.math.ethz.ch>

[changed subject:  s/negative/positive/ ! ]
>>>>> Matthew Kay 
>>>>>     on Wed, 2 Mar 2022 14:08:39 -0600 writes:

    > Hi,

    > I have recently noticed an increasing number of false
    > negatives with the CRAN url check on DOIs. The essence of
    > the problem is that certain DOIs will load fine in the
    > browser, but return a 503 error to `curl -I -L` and
    > therefore trigger a NOTE on CMD CHECK.

    > Two example DOIs I have run into already, which used to
    > pass fine without NOTEs (and still load fine in a
    > browser):

    > https://doi.org/10.1111/1467-985X.00120
    > https://doi.org/10.1177/096228029200100102

This occurrence of false *positives* (not "negatives"), short
FPs, in url checks has been happening for a long time (more than
a year) and is a bit unfortunate.
As you allude to, it's from webservers where the maintainers do not want
non-interactive "mass download" or web scraping etc to happen.

I agree that it's particularly unpleasant in the case of DOIs;
OTOH, we can live with it, and I think the CRAN and Bioconductor
teams are well aware of the issue.

I also don't think it's worth starting a "fight" with the webservice
(trying to camouflage our url checking as coming from an
 interactive web browser),  but maybe we (R Core in conjunction
with the CRAN team) should introduce special 'URLNOTE' for the
URL checks, and be aware that these maybe FP.

Martin

    > Here are the headers of the (final, after redirects) 503
    > response via curl:

    > HTTP/1.1 503 Service Temporarily Unavailable
    >> Date: Wed, 02 Mar 2022 19:19:39 GMT Content-Type:
    >> text/html; charset=UTF-8 Connection: close
    >> X-Frame-Options: SAMEORIGIN Permissions-Policy:
    >> accelerometer=(),autoplay=(),camera=(),clipboard-read=(),clipboard-write=(),fullscreen=(),geoloca
    >> 
    >> tion=(),gyroscope=(),hid=(),interest-cohort=(),magnetometer=(),microphone=(),payment=(),publickey-credentials-get=(),
    >> screen-wake-lock=(),serial=(),sync-xhr=(),usb=()
    >> Cache-Control: private, max-age=0, no-store, no-cache,
    >> must-revalidate, post-check=0, pre-check=0 Expires: Thu,
    >> 01 Jan 1970 00:00:01 GMT Expect-CT: max-age=604800,
    >> report-uri="
    >> https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct"
    >> Set-Cookie:
    >> __cf_bm=3sNb43ySbB.qquj3NGAjnfBHzV_o5LYBOHjCtdj.HXo-1646248779-0-Aa4oCF746nYwQXhKGA2xJIJ5jvxJXbsPXtflcSqS
    >> q+AjMfQYuLyNSo3fFeCBGKEdS2rIjyDW0HkT40tB1OuDxZ2sWnUZG+y/4dpZsY54IWU4;
    >> path=/; expires=Wed, 02-Mar-22 19:49:39 GMT; do
    >> main=.onlinelibrary.wiley.com; HttpOnly; Secure;
    >> SameSite=None Strict-Transport-Security: max-age=15552000
    >> Server: cloudflare CF-RAY: 6e5c7c376d11c518-ORD


    > We can see the response is coming from Cloudflare, which
    > runs an anti-DDoS service. More discussion on that here
    > <https://superuser.com/questions/888507/problems-with-wget-to-a-cloudflare-hosted-site-503-service-unavailable>,
    > but the upshot seems to be that without a JavaScript
    > enabled browser this probably is not a solvable problem.

    > Anecdotally, this seems like a problem that could get
    > worse: a few months ago I had one false negative DOI in a
    > package submission, more recently (about a week ago) I had
    > two. I have heard from other authors encountering this
    > problem lately as well.

    > Strategically, this disincentivizes package authors from
    > accurately citing sources in order to avoid spurious NOTEs
    > (without which, a whitelisted package can bypass human
    > inspection and get to CRAN faster).

    > Perhaps a solution might be to use a dedicated API to
    > check DOIs. CrossRef offers one such, though it only works
    > for CrossRef DOIs:
    > https://api.crossref.org/swagger-ui/index.html

    > For example, applying the API to one of the failing DOIs
    > from above returns 200 OK:

    > curl -I -L
    > https://api.crossref.org/works/10.1177/096228029200100102/agency

    > Another option might be to just look at the first response
    > to the DOI request (i.e., not to follow redirects; just
    > curl -I not curl -I -L). I *think* this should return 302
    > on valid DOIs and 404 on invalid DOIs. For example, this
    > returns 302 Found:

    > curl -I https://doi.org/10.1111/1467-985X.00120

    > And this non-existent DOI returns 404:

    > curl -I https://doi.org/10.1111/1467-985X.XXXXXX

    > So perhaps just using curl -I to check DOI urls would
    > solve the problem?

    > Thanks,

    > ---Matt


    > -- 
    > As an adherent of Email Friday
    > <https://mjskay.medium.com/the-doctrine-of-email-friday-add7f8332d80>,
    > if your email is not urgent I likely won't reply until the
    > next Friday.
    > --
    > Matthew Kay Assistant Professor Northwestern University
    > Computer Science and Communication Studies
    > mjskay at northwestern.edu http://www.mjskay.com/

    > 	[[alternative HTML version deleted]]

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From C@L|oyd @end|ng |rom mb@@edu  Wed Mar  2 22:49:32 2022
From: C@L|oyd @end|ng |rom mb@@edu (Chris Lloyd)
Date: Wed, 2 Mar 2022 21:49:32 +0000
Subject: [R-pkg-devel] assistance needed
In-Reply-To: <ME2PR01MB355584857EDF1E850AF25E68E33D9@ME2PR01MB3555.ausprd01.prod.outlook.com>
References: <ME2PR01MB355584857EDF1E850AF25E68E33D9@ME2PR01MB3555.ausprd01.prod.outlook.com>
Message-ID: <ME2PR01MB3555A0E6897D5E96403A255BE3039@ME2PR01MB3555.ausprd01.prod.outlook.com>

I need to employ someone to massage my code into an R-package that is completely acceptable on CRAN. It gets rejected even though there are 0 errors or warnings when I check locally. I also have a more complex package that involves downloading data from an external site. (Unrelated to package development, I also want my lecture notes in word converted through Bookdown).

If nobody on this list is interested, or knows someone who might be appropriate, perhaps someone could suggest a good site to advertise? I tried Upworks but there did not seem to be any applicants with promising backgrounds.

Thanks

Chris J. Lloyd
Professor of Business Statistics
Melbourne Business School
200 Leicester Street, Carlton, Victoria 3053 Australia
T:  +61 3 9349 8228
E:  c.lloyd at mbs.edu<mailto:c.lloyd at mbs.edu>  |  www.mbs.edu<http://www.mbs.edu/>

----------------------------------------------------------------------
Notice from Melbourne Business School Ltd

The information contained in this e-mail is confidential...{{dropped:15}}


From m@tthew@k@y @end|ng |rom gm@||@com  Thu Mar  3 09:35:09 2022
From: m@tthew@k@y @end|ng |rom gm@||@com (Matthew Kay)
Date: Thu, 3 Mar 2022 02:35:09 -0600
Subject: [R-pkg-devel] False positives for CRAN url check on DOIs due to
 Cloudflare anti-DDoS
In-Reply-To: <25120.29704.13117.95788@stat.math.ethz.ch>
References: <CADHJc0H_dcjCH6NEnu5O2grEQavcr5z5TW3iEK7m_b8FJ628VQ@mail.gmail.com>
 <25120.29704.13117.95788@stat.math.ethz.ch>
Message-ID: <CADHJc0FBwKiCOGwTb+YgrWQ--ck6=yRGoSZHGPSFySjW5rOpaQ@mail.gmail.com>

On Thu, Mar 3, 2022, 1:53 AM Martin Maechler <maechler at stat.math.ethz.ch>
wrote:

>
>
> This occurrence of false *positives* (not "negatives"),


Ah, I took the glass-half-full view that the purpose of the check is to
verify URLs are correct rather than detect incorrect ones ;).

short
> FPs, in url checks has been happening for a long time (more than
> a year) and is a bit unfortunate.
> As you allude to, it's from webservers where the maintainers do not want
> non-interactive "mass download" or web scraping etc to happen.
>
> I agree that it's particularly unpleasant in the case of DOIs;
> OTOH, we can live with it, and I think the CRAN and Bioconductor
> teams are well aware of the issue.
>

Glad they're aware of it.


> I also don't think it's worth starting a "fight" with the webservice
> (trying to camouflage our url checking as coming from an
>  interactive web browser),  but maybe we (R Core in conjunction
> with the CRAN team) should introduce special 'URLNOTE' for the
> URL checks, and be aware that these maybe FP.
>

Thanks, something like this would be helpful. I do wonder if you considered
my other suggestion later in the message - that is, to not follow redirects
in the URL checks just for DOIs (i.e. to use curl -I for DOIs)? It is my
understanding DOI checks are already a special case compared to normal
URLs, and I think this solution would be more robust for DOIs than the
current approach. It also would be lower burden for CRAN reviewers and
package authors alike by eliminating the need for human review in some
cases.

Best,

---Matt



> Martin
>
>     > Here are the headers of the (final, after redirects) 503
>     > response via curl:
>
>     > HTTP/1.1 503 Service Temporarily Unavailable
>     >> Date: Wed, 02 Mar 2022 19:19:39 GMT Content-Type:
>     >> text/html; charset=UTF-8 Connection: close
>     >> X-Frame-Options: SAMEORIGIN Permissions-Policy:
>     >>
> accelerometer=(),autoplay=(),camera=(),clipboard-read=(),clipboard-write=(),fullscreen=(),geoloca
>     >>
>     >>
> tion=(),gyroscope=(),hid=(),interest-cohort=(),magnetometer=(),microphone=(),payment=(),publickey-credentials-get=(),
>     >> screen-wake-lock=(),serial=(),sync-xhr=(),usb=()
>     >> Cache-Control: private, max-age=0, no-store, no-cache,
>     >> must-revalidate, post-check=0, pre-check=0 Expires: Thu,
>     >> 01 Jan 1970 00:00:01 GMT Expect-CT: max-age=604800,
>     >> report-uri="
>     >> https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct"
>     >> Set-Cookie:
>     >>
> __cf_bm=3sNb43ySbB.qquj3NGAjnfBHzV_o5LYBOHjCtdj.HXo-1646248779-0-Aa4oCF746nYwQXhKGA2xJIJ5jvxJXbsPXtflcSqS
>     >>
> q+AjMfQYuLyNSo3fFeCBGKEdS2rIjyDW0HkT40tB1OuDxZ2sWnUZG+y/4dpZsY54IWU4;
>     >> path=/; expires=Wed, 02-Mar-22 19:49:39 GMT; do
>     >> main=.onlinelibrary.wiley.com; HttpOnly; Secure;
>     >> SameSite=None Strict-Transport-Security: max-age=15552000
>     >> Server: cloudflare CF-RAY: 6e5c7c376d11c518-ORD
>
>
>     > We can see the response is coming from Cloudflare, which
>     > runs an anti-DDoS service. More discussion on that here
>     > <
> https://superuser.com/questions/888507/problems-with-wget-to-a-cloudflare-hosted-site-503-service-unavailable
> >,
>     > but the upshot seems to be that without a JavaScript
>     > enabled browser this probably is not a solvable problem.
>
>     > Anecdotally, this seems like a problem that could get
>     > worse: a few months ago I had one false negative DOI in a
>     > package submission, more recently (about a week ago) I had
>     > two. I have heard from other authors encountering this
>     > problem lately as well.
>
>     > Strategically, this disincentivizes package authors from
>     > accurately citing sources in order to avoid spurious NOTEs
>     > (without which, a whitelisted package can bypass human
>     > inspection and get to CRAN faster).
>
>     > Perhaps a solution might be to use a dedicated API to
>     > check DOIs. CrossRef offers one such, though it only works
>     > for CrossRef DOIs:
>     > https://api.crossref.org/swagger-ui/index.html
>
>     > For example, applying the API to one of the failing DOIs
>     > from above returns 200 OK:
>
>     > curl -I -L
>     > https://api.crossref.org/works/10.1177/096228029200100102/agency
>
>     > Another option might be to just look at the first response
>     > to the DOI request (i.e., not to follow redirects; just
>     > curl -I not curl -I -L). I *think* this should return 302
>     > on valid DOIs and 404 on invalid DOIs. For example, this
>     > returns 302 Found:
>
>     > curl -I https://doi.org/10.1111/1467-985X.00120
>
>     > And this non-existent DOI returns 404:
>
>     > curl -I https://doi.org/10.1111/1467-985X.XXXXXX
>
>     > So perhaps just using curl -I to check DOI urls would
>     > solve the problem?
>
>     > Thanks,
>
>     > ---Matt
>
>
>     > --
>     > As an adherent of Email Friday
>     > <https://mjskay.medium.com/the-doctrine-of-email-friday-add7f8332d80
> >,
>     > if your email is not urgent I likely won't reply until the
>     > next Friday.
>     > --
>     > Matthew Kay Assistant Professor Northwestern University
>     > Computer Science and Communication Studies
>     > mjskay at northwestern.edu http://www.mjskay.com/
>
>     >   [[alternative HTML version deleted]]
>
>     > ______________________________________________
>     > R-package-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From v|ncentv@nhee@ @end|ng |rom gm@||@com  Thu Mar  3 13:32:08 2022
From: v|ncentv@nhee@ @end|ng |rom gm@||@com (Vincent van Hees)
Date: Thu, 3 Mar 2022 13:32:08 +0100
Subject: [R-pkg-devel] assistance needed
In-Reply-To: <ME2PR01MB3555A0E6897D5E96403A255BE3039@ME2PR01MB3555.ausprd01.prod.outlook.com>
References: <ME2PR01MB355584857EDF1E850AF25E68E33D9@ME2PR01MB3555.ausprd01.prod.outlook.com>
 <ME2PR01MB3555A0E6897D5E96403A255BE3039@ME2PR01MB3555.ausprd01.prod.outlook.com>
Message-ID: <CALnEB17hp4S=Sq23qmxVn+XhrnFu_ojoDNHNjtgY5LfNK5uu9A@mail.gmail.com>

Does your code already live somewhere online? If yes, can you share a link?
If not, a more elaborate summary of what the code does and what the error
messages are would be great.

I am a freelancer myself, but I do not know whether R-pkg-devel list
maintainers are happy for us to offer/find consultancy projects via this
list?
So, I would also be interested to know what people here consider the
preferred platform for finding and offering consultancy work relating to R
package development?

Vincent
https://www.accelting.com/

On Thu, 3 Mar 2022 at 09:12, Chris Lloyd <C.Lloyd at mbs.edu> wrote:

> I need to employ someone to massage my code into an R-package that is
> completely acceptable on CRAN. It gets rejected even though there are 0
> errors or warnings when I check locally. I also have a more complex package
> that involves downloading data from an external site. (Unrelated to package
> development, I also want my lecture notes in word converted through
> Bookdown).
>
> If nobody on this list is interested, or knows someone who might be
> appropriate, perhaps someone could suggest a good site to advertise? I
> tried Upworks but there did not seem to be any applicants with promising
> backgrounds.
>
> Thanks
>
> Chris J. Lloyd
> Professor of Business Statistics
> Melbourne Business School
> 200 Leicester Street, Carlton, Victoria 3053 Australia
> T:  +61 3 9349 8228
> E:  c.lloyd at mbs.edu<mailto:c.lloyd at mbs.edu>  |  www.mbs.edu<
> http://www.mbs.edu/>
>
> ----------------------------------------------------------------------
> Notice from Melbourne Business School Ltd
>
> The information contained in this e-mail is confidenti...{{dropped:10}}


From sps@@derso@ m@iii@g oii gm@ii@com  Thu Mar  3 13:39:47 2022
From: sps@@derso@ m@iii@g oii gm@ii@com (sps@@derso@ m@iii@g oii gm@ii@com)
Date: Thu, 3 Mar 2022 07:39:47 -0500
Subject: [R-pkg-devel] assistance needed
In-Reply-To: <CALnEB17hp4S=Sq23qmxVn+XhrnFu_ojoDNHNjtgY5LfNK5uu9A@mail.gmail.com>
References: <CALnEB17hp4S=Sq23qmxVn+XhrnFu_ojoDNHNjtgY5LfNK5uu9A@mail.gmail.com>
Message-ID: <7CF1EA0E-2004-4A44-A40E-D65D852A3B2A@gmail.com>

I would say maybe the R group on LinkedIn would be maybe more appropriate. 

Not sure that lecture notes and a book are appropriate for a package though, those would be better maybe on GitHub 

Sent from my iPhone
www.spsanderson.com

> On Mar 3, 2022, at 7:33 AM, Vincent van Hees <vincentvanhees at gmail.com> wrote:
> 
> ?Does your code already live somewhere online? If yes, can you share a link?
> If not, a more elaborate summary of what the code does and what the error
> messages are would be great.
> 
> I am a freelancer myself, but I do not know whether R-pkg-devel list
> maintainers are happy for us to offer/find consultancy projects via this
> list?
> So, I would also be interested to know what people here consider the
> preferred platform for finding and offering consultancy work relating to R
> package development?
> 
> Vincent
> https://www.accelting.com/
> 
>> On Thu, 3 Mar 2022 at 09:12, Chris Lloyd <C.Lloyd at mbs.edu> wrote:
>> 
>> I need to employ someone to massage my code into an R-package that is
>> completely acceptable on CRAN. It gets rejected even though there are 0
>> errors or warnings when I check locally. I also have a more complex package
>> that involves downloading data from an external site. (Unrelated to package
>> development, I also want my lecture notes in word converted through
>> Bookdown).
>> 
>> If nobody on this list is interested, or knows someone who might be
>> appropriate, perhaps someone could suggest a good site to advertise? I
>> tried Upworks but there did not seem to be any applicants with promising
>> backgrounds.
>> 
>> Thanks
>> 
>> Chris J. Lloyd
>> Professor of Business Statistics
>> Melbourne Business School
>> 200 Leicester Street, Carlton, Victoria 3053 Australia
>> T:  +61 3 9349 8228
>> E:  c.lloyd at mbs.edu<mailto:c.lloyd at mbs.edu>  |  www.mbs.edu<
>> http://www.mbs.edu/>
>> 
>> ----------------------------------------------------------------------
>> Notice from Melbourne Business School Ltd
>> 
>> The information contained in this e-mail is confident...{{dropped:6}}


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu Mar  3 16:27:39 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 3 Mar 2022 16:27:39 +0100
Subject: [R-pkg-devel] CRAN incoming checks / winbuilder will be down Fri
 5pm to Sat 5pm CET
Message-ID: <e046f89b-91e6-6ade-f163-47e33fc39abb@statistik.tu-dortmund.de>

Dear package maintainers,

CRAN incoming checks / winbuilder will be down Fri 5pm to Sat 5pm CET as 
there is need to shut down some CRAN hardware for maintainance work in 
the building.

Best,
Uwe Ligges


From j|n||68 @end|ng |rom gm@||@com  Fri Mar  4 04:36:25 2022
From: j|n||68 @end|ng |rom gm@||@com (Jin Li)
Date: Fri, 4 Mar 2022 14:36:25 +1100
Subject: [R-pkg-devel] Warning from dependencies: 'fields::fastTpsMLE'
In-Reply-To: <CAGu_3ZJB8V75vcGP5+yB1=rqejsfk+ocdBYK4fp0k1qF4vrA1g@mail.gmail.com>
References: <CAGu_3ZLL0n4doDf9Rk-FeFVqkbEzJ=84UykdOpu0_i35dce3cQ@mail.gmail.com>
 <20220302175806.39403596@Tarkus>
 <MWHPR01MB22371084A8A53F07809F813FD3039@MWHPR01MB2237.prod.exchangelabs.com>
 <CAGu_3ZJB8V75vcGP5+yB1=rqejsfk+ocdBYK4fp0k1qF4vrA1g@mail.gmail.com>
Message-ID: <CAGu_3ZKS85+=QDJ8BFHyHhRU3qvn88txs3Ck9fZJdh=VfrR8Aw@mail.gmail.com>

Hi All,

The way to solve the problem has been found. Thank you all for your kind
help.

Best,
Jin

On Thu, Mar 3, 2022 at 3:53 PM Jin Li <jinli68 at gmail.com> wrote:

> Many thanks, Michael.
>
> The `fastTpsMLE` was used to estimate `lambda` for `Tps` as below:
>
> library(fields); library(spm); data(petrel)
> x=petrel[, c(1,2)]; y=petrel[, 5]; theta = 3
>
> lambda <- fields::fastTpsMLE(x, y, theta = theta)$lambda.best
> lambda
> [1] 0.9875504
>
> I have just updated the `fields` package. However, `lambda` is not
> reported by `fastTps`. But I need an estimate of `lamda` for `Tps`. Is
> there a solution for this?
>
> Best,
> Jin
>
> On Thu, Mar 3, 2022 at 2:35 AM Michael Barr <mike at bikeactuary.com> wrote:
>
>> fastTpsMLE is not in the current version of fields - latest version I see
>> with it is 11.x. 12.x onward you use fastTps() and can specify REML=TRUE
>> for the estimator. You are probably using 12.x and looking at older
>> documentation. A quick glance at the older source for fastTpsMLE and I
>> think that they were actually using REML in practice (holding some
>> parameters fixed, optimizing others).
>> ------------------------------
>> *From:* R-package-devel <r-package-devel-bounces at r-project.org> on
>> behalf of Ivan Krylov <krylov.r00t at gmail.com>
>> *Sent:* Wednesday, March 2, 2022 9:58 AM
>> *To:* Jin Li <jinli68 at gmail.com>
>> *Cc:* r-package-devel at r-project.org <r-package-devel at r-project.org>
>> *Subject:* Re: [R-pkg-devel] Warning from dependencies:
>> 'fields::fastTpsMLE'
>>
>> On Wed, 2 Mar 2022 15:04:51 +1100
>> Jin Li <jinli68 at gmail.com> wrote:
>>
>> > Missing or unexported object: 'fields::fastTpsMLE'
>>
>> The current CRAN version of fields doesn't seem to have "fastTpsMLE" in
>> its documentation:
>> https://cran.r-project.org/web/packages/fields/fields.pdf
>>
>> I also can't seem to find fastTpsMLE in the GitHub repo of the package:
>> https://github.com/dnychka/fieldsRPackage/search?q=fastTpsMLE
>>
>> Which version of fields do you have installed?
>>
>> --
>> Best regards,
>> Ivan
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
>
> --
> Jin
> ------------------------------------------
> Jin Li, PhD
> Founder, Data2action, Australia
> https://www.researchgate.net/profile/Jin_Li32
> https://scholar.google.com/citations?user=Jeot53EAAAAJ&hl=en
>


-- 
Jin
------------------------------------------
Jin Li, PhD
Founder, Data2action, Australia
https://www.researchgate.net/profile/Jin_Li32
https://scholar.google.com/citations?user=Jeot53EAAAAJ&hl=en

	[[alternative HTML version deleted]]


From m@tth|@@-gond@n @end|ng |rom gmx@de  Sat Mar  5 18:17:57 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (matthias-gondan)
Date: Sat, 05 Mar 2022 18:17:57 +0100
Subject: [R-pkg-devel] cmake, Windows
Message-ID: <1MWzjt-1nfkS83uNV-00XORX@mail.gmx.net>

Dear package developers,?I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias?
	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Sat Mar  5 21:36:43 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sat, 5 Mar 2022 14:36:43 -0600
Subject: [R-pkg-devel] cmake, Windows
In-Reply-To: <1MWzjt-1nfkS83uNV-00XORX@mail.gmx.net>
References: <1MWzjt-1nfkS83uNV-00XORX@mail.gmx.net>
Message-ID: <25123.51675.251153.862729@rob.eddelbuettel.com>


On 5 March 2022 at 18:17, matthias-gondan wrote:
| Dear package developers,?I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias?

You can treat the corpus of CRAN packages as a reference, and search it
either directly (GitHub search works as https://github.com/cran is an
informal mirror of CRAN), or in the aggregate via base R tools"

> db <- tools::CRAN_package_db()
> db[ grepl("cmake", db[,"SystemRequirements"]), "Package" ]
[1] "nanonext"    "neuronorm"   "nloptr"      "rkeops"      "ROpenCVLite" "symengine"   "tiledb"     
> 

These seven packages may provide an example. (I am behind 'tiledb' and we
only use cmake iff compilation of the underlying TileDB Embedded library is
selected, and which is not the default on Windows so that one is of no use to
you. Package 'nloptr' uses 'cmake' to build libnlopt.a (unless nlopt is
already installed).

Hth, Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Mar  5 23:19:53 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sun, 6 Mar 2022 11:19:53 +1300
Subject: [R-pkg-devel] cmake, Windows
In-Reply-To: <1MWzjt-1nfkS83uNV-00XORX@mail.gmx.net>
References: <1MWzjt-1nfkS83uNV-00XORX@mail.gmx.net>
Message-ID: <E9C6983A-6C7E-4E24-8018-EF8C7DF33993@R-project.org>

Matthias,

You didn't supply any output, so we can only guess. From what I can see in your package you are hard-coding incorrect paths to compilers and tools in your Makevars.{win|ucrt}. Please make sure you use R's compilers - never hard-code paths to tools, you need to use R's settings since the toolchain can be installed in any location.

Cheers,
Simon


> On Mar 6, 2022, at 6:17 AM, matthias-gondan <matthias-gondan at gmx.de> wrote:
> 
> Dear package developers, I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m@tth|@@-gond@n @end|ng |rom gmx@de  Sun Mar  6 00:37:59 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (matthias-gondan)
Date: Sun, 06 Mar 2022 00:37:59 +0100
Subject: [R-pkg-devel] cmake, Windows
In-Reply-To: <E9C6983A-6C7E-4E24-8018-EF8C7DF33993@R-project.org>
Message-ID: <1N0X8u-1oMiEg2f5A-00wWI9@mail.gmx.net>

Thanks Simon,I'll remove the paths and report the results. I'll also check Dirks suggestion (the other response).For what it's worth, the error message was simply "cmake not found"; when I added the path it was "/ucrt64/bin/cmake not found"https://win-builder.r-project.org/incoming_pretest/rolog_0.9_20220305_172741/Windows/00install.outBest wishes,Matthias?
-------- Urspr?ngliche Nachricht --------Von: Simon Urbanek <simon.urbanek at R-project.org> Datum: 05.03.22  23:19  (GMT+01:00) An: matthias-gondan <matthias-gondan at gmx.de> Cc: r-package-devel at r-project.org Betreff: Re: [R-pkg-devel] cmake, Windows Matthias,You didn't supply any output, so we can only guess. From what I can see in your package you are hard-coding incorrect paths to compilers and tools in your Makevars.{win|ucrt}. Please make sure you use R's compilers - never hard-code paths to tools, you need to use R's settings since the toolchain can be installed in any location.Cheers,Simon> On Mar 6, 2022, at 6:17 AM, matthias-gondan <matthias-gondan at gmx.de> wrote:> > Dear package developers, I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias > 	[[alternative HTML version deleted]]> > ______________________________________________> R-package-devel at r-project.org mailing list> https://stat.ethz.ch/mailman/listinfo/r-package-devel
	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Sun Mar  6 18:00:43 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sun, 6 Mar 2022 11:00:43 -0600
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
Message-ID: <25124.59579.987161.996173@rob.eddelbuettel.com>


R CMD check --use-valgrind is a very useful option.  But I am puzzled by the
fact that we have code that is clearly incorrect, detected by valgrind, yet
given a pass by R CMD check.

A tiny demo package is at https://github.com/eddelbuettel/demovalgrindnonfail

Its sole C function (included below in [1]) copies a vector by allocating --
and not releasing.  Valgrind sees that: in tests/ we pass a numeric vector of
four so we get 'definitely lost: 32 bytes in 1 blocks' (see [2]). Yet R CMD
check is happy as a clam (see [3]).

Is that a bug? Should we extend package tools to error here?

Dirk



[1] C function which allocates but does not release

SEXP simpleCall_impl(SEXP x) {
    int n = Rf_length(x);
    int m = n * sizeof(double);

    double* srcptr = REAL(x);
    double* dstptr = malloc(m);			// allocate, never release --> leak
    memcpy((void*)dstptr, (void*)srcptr, m);	// so compiler does not complain about unused ptr

    Rprintf("n=%d x[1]=%f\n", n, (double) dstptr[1]);
    return R_NilValue;
}


[2] Valgrind summary with as-expected finding

==1485886== HEAP SUMMARY:
==1485886==     in use at exit: 53,538,524 bytes in 10,178 blocks
==1485886==   total heap usage: 27,543 allocs, 17,365 frees, 87,496,835 bytes allocated
==1485886== 
==1485886== LEAK SUMMARY:
==1485886==    definitely lost: 32 bytes in 1 blocks
==1485886==    indirectly lost: 0 bytes in 0 blocks
==1485886==      possibly lost: 0 bytes in 0 blocks
==1485886==    still reachable: 53,538,492 bytes in 10,177 blocks
==1485886==         suppressed: 0 bytes in 0 blocks
==1485886== Rerun with --leak-check=full to see details of leaked memory
==1485886== 
==1485886== For lists of detected and suppressed errors, rerun with: -s
==1485886== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)


[3] R CMD check, with valgrind and its error detection

edd at rob:~/git/demovalgrindnonfail(master)$ R CMD check --use-valgrind demovalgrindnonfail_0.0.1.tar.gz
* using log directory ?/home/edd/git/demovalgrindnonfail/demovalgrindnonfail.Rcheck?
* using R version 4.1.2 (2021-11-01)
* using platform: x86_64-pc-linux-gnu (64-bit)
* using session charset: UTF-8
* using option ?--use-valgrind?        
* checking for file ?demovalgrindnonfail/DESCRIPTION? ... OK
* checking extension type ... Package
* this is package ?demovalgrindnonfail? version ?0.0.1?
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for executable files ... OK
* checking for hidden files and directories ... OK
* checking for portable file names ... OK
* checking for sufficient/correct file permissions ... OK
* checking whether package ?demovalgrindnonfail? can be installed ... OK
* checking installed package size ... OK
* checking package directory ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking for left-over files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* checking whether the package can be loaded ... OK
* checking whether the package can be loaded with stated dependencies ... OK
* checking whether the package can be unloaded cleanly ... OK
* checking whether the namespace can be loaded with stated dependencies ... OK
* checking whether the namespace can be unloaded cleanly ... OK
* checking loading without being on the library search path ... OK
* checking dependencies in R code ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking R code for possible problems ... OK
* checking Rd files ... OK
* checking Rd metadata ... OK
* checking Rd cross-references ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking Rd contents ... OK
* checking for unstated dependencies in examples ... OK
* checking line endings in C/C++/Fortran sources/headers ... OK
* checking compilation flags used ... OK
* checking compiled code ... OK
* checking examples ... NONE
* checking for unstated dependencies in ?tests? ... OK
* checking tests ...
  Running ?simpleCall.R?
 OK
* checking PDF version of manual ... OK
* DONE

Status: OK

edd at rob:~/git/demovalgrindnonfail(master)$ 

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From m@tth|@@-gond@n @end|ng |rom gmx@de  Sun Mar  6 18:57:00 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Sun, 6 Mar 2022 18:57:00 +0100
Subject: [R-pkg-devel] cmake, Windows
In-Reply-To: <25123.51675.251153.862729@rob.eddelbuettel.com>
References: <1MWzjt-1nfkS83uNV-00XORX@mail.gmx.net>
 <25123.51675.251153.862729@rob.eddelbuettel.com>
Message-ID: <1N8GMq-1oD3hF3hp2-014Ek3@mail.gmx.net>

Dear Dirk, dear others,

thank you for the helpful hints. I have looked into each package in turn,

1. nanonext: under Windows, invokes a script named winlibs.R in the folder tools that downloads a preconfigured (precompiled?) zip file. At the end of winlibs.R, a comment # cmake -DCMAKE_C_FLAGS="${CMAKE_C_FLAGS} -fPIC" -G "MSYS Makefiles" .. indicates that this is probably meant to mimic cmake?s behavior.

2. neuronorm: Does not seem to use cmake at all.

3. nloptr: Under Rtools4, downloads nlopt binaries using again a winlibs.R workaround. Under Rtools42 (Makevars.ucrt), links to nlopt which is provided by the build system. Again, cmake is not involved.

4. rkeops: Windows Version is not available on CRAN

5. ROpenCVLite: pure source package, and Windows users are told to install Rtools and cmake

6. symengine: winlibs.R again.

What I am wondering, sorry for this beginner?s question: what do I need to do to mimic R?s winbuilder behavior on my computer? So far, I 

? downloaded rtools40 and rtools42, 
? did a pacman -Syu 
? and then installed, also using pacman -S, the libraries and tools (including cmake) that I needed to build the package

It seems as if I broke compatibility with the winbuilder in the last step? So, where can I find information which RTools packages are compatible with CRAN?s winbuilder?

Thank you all in advance for your support.

Best regards,

Matthias





Von: Dirk Eddelbuettel
Gesendet: Samstag, 5. M?rz 2022 21:36
An: matthias-gondan
Cc: r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] cmake, Windows


On 5 March 2022 at 18:17, matthias-gondan wrote:
| Dear package developers,?I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias?

You can treat the corpus of CRAN packages as a reference, and search it
either directly (GitHub search works as https://github.com/cran is an
informal mirror of CRAN), or in the aggregate via base R tools"

> db <- tools::CRAN_package_db()
> db[ grepl("cmake", db[,"SystemRequirements"]), "Package" ]
[1] "nanonext"    "neuronorm"   "nloptr"      "rkeops"      "ROpenCVLite" "symengine"   "tiledb"     
> 

These seven packages may provide an example. (I am behind 'tiledb' and we
only use cmake iff compilation of the underlying TileDB Embedded library is
selected, and which is not the default on Windows so that one is of no use to
you. Package 'nloptr' uses 'cmake' to build libnlopt.a (unless nlopt is
already installed).

Hth, Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Mar  6 21:00:50 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 6 Mar 2022 15:00:50 -0500
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <25124.59579.987161.996173@rob.eddelbuettel.com>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
Message-ID: <8589a824-b476-ef16-64aa-1f8f7def7b79@gmail.com>

On 06/03/2022 12:00 p.m., Dirk Eddelbuettel wrote:
> 
> R CMD check --use-valgrind is a very useful option.  But I am puzzled by the
> fact that we have code that is clearly incorrect, detected by valgrind, yet
> given a pass by R CMD check.
> 
> A tiny demo package is at https://github.com/eddelbuettel/demovalgrindnonfail
> 
> Its sole C function (included below in [1]) copies a vector by allocating --
> and not releasing.  Valgrind sees that: in tests/ we pass a numeric vector of
> four so we get 'definitely lost: 32 bytes in 1 blocks' (see [2]). Yet R CMD
> check is happy as a clam (see [3]).
> 
> Is that a bug? Should we extend package tools to error here?
> 
> Dirk
> 
> 
> 
> [1] C function which allocates but does not release
> 
> SEXP simpleCall_impl(SEXP x) {
>      int n = Rf_length(x);
>      int m = n * sizeof(double);
> 
>      double* srcptr = REAL(x);
>      double* dstptr = malloc(m);			// allocate, never release --> leak
>      memcpy((void*)dstptr, (void*)srcptr, m);	// so compiler does not complain about unused ptr
> 
>      Rprintf("n=%d x[1]=%f\n", n, (double) dstptr[1]);
>      return R_NilValue;
> }
> 
> 
> [2] Valgrind summary with as-expected finding
> 
> ==1485886== HEAP SUMMARY:
> ==1485886==     in use at exit: 53,538,524 bytes in 10,178 blocks
> ==1485886==   total heap usage: 27,543 allocs, 17,365 frees, 87,496,835 bytes allocated
> ==1485886==
> ==1485886== LEAK SUMMARY:
> ==1485886==    definitely lost: 32 bytes in 1 blocks
> ==1485886==    indirectly lost: 0 bytes in 0 blocks
> ==1485886==      possibly lost: 0 bytes in 0 blocks
> ==1485886==    still reachable: 53,538,492 bytes in 10,177 blocks
> ==1485886==         suppressed: 0 bytes in 0 blocks
> ==1485886== Rerun with --leak-check=full to see details of leaked memory
> ==1485886==
> ==1485886== For lists of detected and suppressed errors, rerun with: -s
> ==1485886== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
> 
> 
> [3] R CMD check, with valgrind and its error detection
> 
> edd at rob:~/git/demovalgrindnonfail(master)$ R CMD check --use-valgrind demovalgrindnonfail_0.0.1.tar.gz
> * using log directory ?/home/edd/git/demovalgrindnonfail/demovalgrindnonfail.Rcheck?
> * using R version 4.1.2 (2021-11-01)
> * using platform: x86_64-pc-linux-gnu (64-bit)
> * using session charset: UTF-8
> * using option ?--use-valgrind?
> * checking for file ?demovalgrindnonfail/DESCRIPTION? ... OK
> * checking extension type ... Package
> * this is package ?demovalgrindnonfail? version ?0.0.1?
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for executable files ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking for sufficient/correct file permissions ... OK
> * checking whether package ?demovalgrindnonfail? can be installed ... OK
> * checking installed package size ... OK
> * checking package directory ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking for left-over files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ... OK
> * checking whether the package can be loaded with stated dependencies ... OK
> * checking whether the package can be unloaded cleanly ... OK
> * checking whether the namespace can be loaded with stated dependencies ... OK
> * checking whether the namespace can be unloaded cleanly ... OK
> * checking loading without being on the library search path ... OK
> * checking dependencies in R code ... OK
> * checking S3 generic/method consistency ... OK
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... OK
> * checking Rd files ... OK
> * checking Rd metadata ... OK
> * checking Rd cross-references ... OK
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> * checking Rd \usage sections ... OK
> * checking Rd contents ... OK
> * checking for unstated dependencies in examples ... OK
> * checking line endings in C/C++/Fortran sources/headers ... OK
> * checking compilation flags used ... OK
> * checking compiled code ... OK
> * checking examples ... NONE
> * checking for unstated dependencies in ?tests? ... OK
> * checking tests ...
>    Running ?simpleCall.R?
>   OK
> * checking PDF version of manual ... OK
> * DONE
> 
> Status: OK
> 
> edd at rob:~/git/demovalgrindnonfail(master)$
> 

What does simpleCall.R do?  If it only calls your bad function once, R 
might ignore the 32 bytes lost.  As WRE says, R itself loses small 
amounts of memory:  "We know there will be some small memory leaks from 
@code{readline} and @R{} itself --- these are memory areas that are in 
use right up to the end of the @R{} session. "

I took a quick look but didn't spot where (if?) R analyzes the valgrind 
output.

Duncan Murdoch


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Mar  6 21:05:39 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 7 Mar 2022 09:05:39 +1300
Subject: [R-pkg-devel] cmake, Windows
In-Reply-To: <1N0X8u-1oMiEg2f5A-00wWI9@mail.gmx.net>
References: <1N0X8u-1oMiEg2f5A-00wWI9@mail.gmx.net>
Message-ID: <92781C58-7A10-45F9-AF69-7427DD1A9A04@R-project.org>

Matthias,

that, that is helpful. So we are talking about UCRT here. The toolchain from https://github.com/kalibera/ucrt3 appears to not include the cmake binary. I suspect the reason is that since it is based on MXE, the cmake binary used for the toolchain is native (Linux) and not the Windows binary. I think there are two options: either use the CMake officially released binary or have the toolchain supply cmake.exe. I'd defer to Tomas who is maintaining the UCRT toolchain to advise which is the better option. 

Cheers,
Simon



> On Mar 6, 2022, at 12:37 PM, matthias-gondan <matthias-gondan at gmx.de> wrote:
> 
> Thanks Simon,
> 
> I'll remove the paths and report the results. I'll also check Dirks suggestion (the other response).
> 
> For what it's worth, the error message was simply "cmake not found"; when I added the path it was "/ucrt64/bin/cmake not found"
> 
> https://win-builder.r-project.org/incoming_pretest/rolog_0.9_20220305_172741/Windows/00install.out
> 
> Best wishes,
> 
> Matthias 
> 
> -------- Urspr?ngliche Nachricht --------
> Von: Simon Urbanek <simon.urbanek at R-project.org>
> Datum: 05.03.22 23:19 (GMT+01:00)
> An: matthias-gondan <matthias-gondan at gmx.de>
> Cc: r-package-devel at r-project.org
> Betreff: Re: [R-pkg-devel] cmake, Windows
> 
> Matthias,
> 
> You didn't supply any output, so we can only guess. From what I can see in your package you are hard-coding incorrect paths to compilers and tools in your Makevars.{win|ucrt}. Please make sure you use R's compilers - never hard-code paths to tools, you need to use R's settings since the toolchain can be installed in any location.
> 
> Cheers,
> Simon
> 
> 
> > On Mar 6, 2022, at 6:17 AM, matthias-gondan <matthias-gondan at gmx.de> wrote:
> > 
> > Dear package developers, I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias 
> > [[alternative HTML version deleted]]
> > 
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Mar  6 21:46:45 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 7 Mar 2022 09:46:45 +1300
Subject: [R-pkg-devel] cmake, Windows
In-Reply-To: <92781C58-7A10-45F9-AF69-7427DD1A9A04@R-project.org>
References: <1N0X8u-1oMiEg2f5A-00wWI9@mail.gmx.net>
 <92781C58-7A10-45F9-AF69-7427DD1A9A04@R-project.org>
Message-ID: <E5866827-EA36-40F3-AA09-39CA4D966347@R-project.org>

BTW: one option I forgot to mention would be to add SWI-Prolog to the toolchain instead so you don't need to build it. However, I don't know how tied you are to the development branch that you're using. There is also the official SWI release Windows binary which may be another option, but I didn't look at the details if that fits your bill. I would suggest setting up the UCRT environment locally and testing the different options so you can decide which is the best path forward.

Cheers,
Simon


> On Mar 7, 2022, at 9:05 AM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> Matthias,
> 
> that, that is helpful. So we are talking about UCRT here. The toolchain from https://github.com/kalibera/ucrt3 appears to not include the cmake binary. I suspect the reason is that since it is based on MXE, the cmake binary used for the toolchain is native (Linux) and not the Windows binary. I think there are two options: either use the CMake officially released binary or have the toolchain supply cmake.exe. I'd defer to Tomas who is maintaining the UCRT toolchain to advise which is the better option. 
> 
> Cheers,
> Simon
> 
> 
> 
>> On Mar 6, 2022, at 12:37 PM, matthias-gondan <matthias-gondan at gmx.de> wrote:
>> 
>> Thanks Simon,
>> 
>> I'll remove the paths and report the results. I'll also check Dirks suggestion (the other response).
>> 
>> For what it's worth, the error message was simply "cmake not found"; when I added the path it was "/ucrt64/bin/cmake not found"
>> 
>> https://win-builder.r-project.org/incoming_pretest/rolog_0.9_20220305_172741/Windows/00install.out
>> 
>> Best wishes,
>> 
>> Matthias 
>> 
>> -------- Urspr?ngliche Nachricht --------
>> Von: Simon Urbanek <simon.urbanek at R-project.org>
>> Datum: 05.03.22 23:19 (GMT+01:00)
>> An: matthias-gondan <matthias-gondan at gmx.de>
>> Cc: r-package-devel at r-project.org
>> Betreff: Re: [R-pkg-devel] cmake, Windows
>> 
>> Matthias,
>> 
>> You didn't supply any output, so we can only guess. From what I can see in your package you are hard-coding incorrect paths to compilers and tools in your Makevars.{win|ucrt}. Please make sure you use R's compilers - never hard-code paths to tools, you need to use R's settings since the toolchain can be installed in any location.
>> 
>> Cheers,
>> Simon
>> 
>> 
>>> On Mar 6, 2022, at 6:17 AM, matthias-gondan <matthias-gondan at gmx.de> wrote:
>>> 
>>> Dear package developers, I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias 
>>> [[alternative HTML version deleted]]
>>> 
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> 
> 


From @|ex|o@ @end|ng |rom 4d@c@pe@com  Sun Mar  6 01:54:08 2022
From: @|ex|o@ @end|ng |rom 4d@c@pe@com (alexios galanos)
Date: Sat, 5 Mar 2022 16:54:08 -0800
Subject: [R-pkg-devel] table lacks "summary" attribute
Message-ID: <a391d173-0f40-08ad-3ee6-63aab893d7b8@4dscape.com>

Hi,

I'm running a check of my rmgarch package against R development 
(unstable) (2022-03-04 r81849) -- "Unsuffered Consequences"
and getting a lot of NOTES around a lack of a summary attribute:

example:

* checking HTML version of manual ... NOTE
Found the following problems:
DCCfilter-class.Rd:7:1: Warning: <table> lacks "summary" attribute

Any pointers/documentation on this?

Thanks,

Alexios


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Mon Mar  7 10:45:30 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Mon, 7 Mar 2022 10:45:30 +0100
Subject: [R-pkg-devel] cmake, Windows
In-Reply-To: <E5866827-EA36-40F3-AA09-39CA4D966347@R-project.org>
References: <1N0X8u-1oMiEg2f5A-00wWI9@mail.gmx.net>
 <92781C58-7A10-45F9-AF69-7427DD1A9A04@R-project.org>
 <E5866827-EA36-40F3-AA09-39CA4D966347@R-project.org>
Message-ID: <03145bdf-22e5-6ed9-35d0-dd3f2facdfd9@gmail.com>

On 3/6/22 21:46, Simon Urbanek wrote:
> BTW: one option I forgot to mention would be to add SWI-Prolog to the toolchain instead so you don't need to build it. However, I don't know how tied you are to the development branch that you're using. There is also the official SWI release Windows binary which may be another option, but I didn't look at the details if that fits your bill. I would suggest setting up the UCRT environment locally and testing the different options so you can decide which is the best path forward.

Right, primarily the package should use an existing installation of SWI 
Prolog in the system. This is also required by the CRAN repository 
policy, see "Using external C/C++/Fortran libraries.").

So if SWI Prolog official release for Windows has the necessary headers 
and DLLs, your R package could link to them. One example of R package 
doing this is rjags, dynamically linking to JAGS (though when there is a 
plain C interface, it is preferable as it is easier to maintain, see 
WRE). This would be the simplest option and you could use dynamically 
linked SWI Prolog.

Adding a complete language runtime into an R package feels a bit odd to 
me, but in principle is possible. If Rtools42 libraries included a 
static library of SWI Prolog, your package could link to that. Rtools42 
doesn't include it, but in principle it could be added (Rtools42 
libraries themselves are built on Linux and indeed cmake is available 
there, some of those use it), I could help with that. This wouldn't work 
well if you needed to use dynamic linking.

Building SWI Prolog from source included in the R package should not be 
needed and it won't be any easier than adding it to Rtools42. Rtools42 
currently doesn't have cmake ready for use (adding it is trivial via 
pacman, but some work and documentation would be needed to make it find 
the libraries).

Best
Tomas

>
> Cheers,
> Simon
>
>
>> On Mar 7, 2022, at 9:05 AM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
>>
>> Matthias,
>>
>> that, that is helpful. So we are talking about UCRT here. The toolchain from https://github.com/kalibera/ucrt3 appears to not include the cmake binary. I suspect the reason is that since it is based on MXE, the cmake binary used for the toolchain is native (Linux) and not the Windows binary. I think there are two options: either use the CMake officially released binary or have the toolchain supply cmake.exe. I'd defer to Tomas who is maintaining the UCRT toolchain to advise which is the better option.
>>
>> Cheers,
>> Simon
>>
>>
>>
>>> On Mar 6, 2022, at 12:37 PM, matthias-gondan <matthias-gondan at gmx.de> wrote:
>>>
>>> Thanks Simon,
>>>
>>> I'll remove the paths and report the results. I'll also check Dirks suggestion (the other response).
>>>
>>> For what it's worth, the error message was simply "cmake not found"; when I added the path it was "/ucrt64/bin/cmake not found"
>>>
>>> https://win-builder.r-project.org/incoming_pretest/rolog_0.9_20220305_172741/Windows/00install.out
>>>
>>> Best wishes,
>>>
>>> Matthias
>>>
>>> -------- Urspr?ngliche Nachricht --------
>>> Von: Simon Urbanek <simon.urbanek at R-project.org>
>>> Datum: 05.03.22 23:19 (GMT+01:00)
>>> An: matthias-gondan <matthias-gondan at gmx.de>
>>> Cc: r-package-devel at r-project.org
>>> Betreff: Re: [R-pkg-devel] cmake, Windows
>>>
>>> Matthias,
>>>
>>> You didn't supply any output, so we can only guess. From what I can see in your package you are hard-coding incorrect paths to compilers and tools in your Makevars.{win|ucrt}. Please make sure you use R's compilers - never hard-code paths to tools, you need to use R's settings since the toolchain can be installed in any location.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>> On Mar 6, 2022, at 6:17 AM, matthias-gondan <matthias-gondan at gmx.de> wrote:
>>>>
>>>> Dear package developers, I have submitted a source package to CRAN, and it is rejected because installation fails on Windows.https://github.com/mgondan/rologThe compilation needs cmake, which is available on RTools4+.Is there any chance that cmake is included on the build system? If not, does anyone know a good solution for this problem?Best regards,Matthias
>>>> [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Mar  7 10:59:33 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 7 Mar 2022 12:59:33 +0300
Subject: [R-pkg-devel] table lacks "summary" attribute
In-Reply-To: <a391d173-0f40-08ad-3ee6-63aab893d7b8@4dscape.com>
References: <a391d173-0f40-08ad-3ee6-63aab893d7b8@4dscape.com>
Message-ID: <20220307125933.3f989d11@Tarkus>

On Sat, 5 Mar 2022 16:54:08 -0800
alexios galanos <alexios at 4dscape.com> wrote:

> * checking HTML version of manual ... NOTE
> Found the following problems:
> DCCfilter-class.Rd:7:1: Warning: <table> lacks "summary" attribute
> 
> Any pointers/documentation on this?

This seems to be the new check for HTML documentation validity as part
of accessibility enhancements in R. As far as I'm aware, HTML5 doesn't
_require_ tables to have summaries, nor does Rd provide a way to
specify them. This could be a bug in Tidy-html5, except it's been
apparently fixed in 2016: https://github.com/htacg/tidy-html5/issues/377

-- 
Best regards,
Ivan


From edd @end|ng |rom deb|@n@org  Tue Mar  8 00:00:37 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 7 Mar 2022 17:00:37 -0600
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <8589a824-b476-ef16-64aa-1f8f7def7b79@gmail.com>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
 <8589a824-b476-ef16-64aa-1f8f7def7b79@gmail.com>
Message-ID: <25126.36501.155170.488660@rob.eddelbuettel.com>


On 6 March 2022 at 15:00, Duncan Murdoch wrote:
| What does simpleCall.R do?

I supplied sources so you could have check -- but it's not relevant. It was a
four-element vector leaking 4 x 8 bytes "by design". But make it a 4 million
element vector and you leak 32 mb. 

| I took a quick look but didn't spot where (if?) R analyzes the valgrind 
| output.

That was my point. If R supports valgrind, why does it ignore its findings?

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Mar  8 11:09:54 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 8 Mar 2022 05:09:54 -0500
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <25126.36501.155170.488660@rob.eddelbuettel.com>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
 <8589a824-b476-ef16-64aa-1f8f7def7b79@gmail.com>
 <25126.36501.155170.488660@rob.eddelbuettel.com>
Message-ID: <d61ffdb2-47e1-b1eb-888f-3bcbae31d3ae@gmail.com>

On 07/03/2022 6:00 p.m., Dirk Eddelbuettel wrote:
> 
> On 6 March 2022 at 15:00, Duncan Murdoch wrote:
> | What does simpleCall.R do?
> 
> I supplied sources so you could have check -- but it's not relevant. It was a
> four-element vector leaking 4 x 8 bytes "by design". But make it a 4 million
> element vector and you leak 32 mb.
> 
> | I took a quick look but didn't spot where (if?) R analyzes the valgrind
> | output.
> 
> That was my point. If R supports valgrind, why does it ignore its findings?
> 

Sorry, I missed the link to the full package, but I did try to answer 
your question: maybe trivial losses are ignored.  Your example would be 
more definitive if it really did lose 32 MB.

It's also possible that only some losses are reported (which would be a 
bug, I think).  Your package had the loss in test code, but not in 
example code.

I'd make the changes myself to see, but I don't have valgrind installed, 
and don't have a Linux system handy right now.

Duncan Murdoch


From edd @end|ng |rom deb|@n@org  Tue Mar  8 15:32:24 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 8 Mar 2022 08:32:24 -0600
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <d61ffdb2-47e1-b1eb-888f-3bcbae31d3ae@gmail.com>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
 <8589a824-b476-ef16-64aa-1f8f7def7b79@gmail.com>
 <25126.36501.155170.488660@rob.eddelbuettel.com>
 <d61ffdb2-47e1-b1eb-888f-3bcbae31d3ae@gmail.com>
Message-ID: <25127.26872.159340.805579@rob.eddelbuettel.com>


On 8 March 2022 at 05:09, Duncan Murdoch wrote:
| Sorry, I missed the link to the full package, but I did try to answer 
| your question: maybe trivial losses are ignored.  Your example would be 
| more definitive if it really did lose 32 MB.

As you probably realize you could call the same function one million times
and you would have your 32mb loss. Or, if it really is important to you, send
a PR to the demo repo to make the vector bigger.
 
| It's also possible that only some losses are reported (which would be a 
| bug, I think).  Your package had the loss in test code, but not in 
| example code.

Ditto. Add one line to the source file, re-run roxygenize. Or do it by hand
in the Rd (and the source) file(s).

Both changes are orthogonal to them problem at hand.

| I'd make the changes myself to see, but I don't have valgrind installed, 
| and don't have a Linux system handy right now.

Bummer.

My motivation for sending patches to R's bugzilla is a little dampened by the
fact that the last one I sent (and put some effort in) is still lingering ten
months later. Oh well.

We could cooperate in the sense that you 'just' need valgrind output files,
and we could (fairly simply) create those via CI at the repo.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Mar  8 16:46:13 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 8 Mar 2022 18:46:13 +0300
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <25124.59579.987161.996173@rob.eddelbuettel.com>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
Message-ID: <20220308184613.7dd27e77@Tarkus>

On Sun, 6 Mar 2022 11:00:43 -0600
Dirk Eddelbuettel <edd at debian.org> wrote:

> ==1485886== LEAK SUMMARY:
> ==1485886==    definitely lost: 32 bytes in 1 blocks

> ==1485886== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0
> from 0)

R CMD check only looks at the exit code of the process.

Valgrind crashes the process on invalid memory access, but doesn't
consider leaks to be errors, unless you turn on --leak-check=full, and
even then still returns the exit code of the child process by default,
i.e. zero:

$ cat leak.c 
#include <stdlib.h>

int main(void) {
        malloc(42);
        return 0;
}
$ cc -o leak -g -O0 leak.c
$ valgrind ./leak; echo exitcode=$?
...
==14675==    definitely lost: 42 bytes in 1 blocks
...
==14675== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
exitcode=0
$ valgrind --leak-check=full ./leak; echo exitcode=$?
...

==14688==    definitely lost: 42 bytes in 1 blocks
...
==14688== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
exitcode=0
$ valgrind --leak-check=full --error-exitcode=42 ./leak; \
 echo exitcode=$?
...
==14729==    definitely lost: 42 bytes in 1 blocks
...
==14729== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
exitcode=42

R CMD check could be patched to run 
R -d 'valgrind --leak-check=full --error-exitcode=255' instead of just
R -d valgrind to produce warnings on Valgrind-detected leaks.

The problem with this approach is the need for Valgrind suppression
files. I've run an interactive example of a pure R package under R -d
'valgrind --leak-check=full --error-exitcode=255' (a relatively fresh
SVN build) and got "definitely lost: 15,744 bytes in 41 blocks", mostly
in plot-related code, allocations originating in Pango and GObject.

-- 
Best regards,
Ivan


From edd @end|ng |rom deb|@n@org  Tue Mar  8 17:23:43 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 8 Mar 2022 10:23:43 -0600
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <20220308184613.7dd27e77@Tarkus>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
 <20220308184613.7dd27e77@Tarkus>
Message-ID: <25127.33551.613976.547674@rob.eddelbuettel.com>


On 8 March 2022 at 18:46, Ivan Krylov wrote:
| On Sun, 6 Mar 2022 11:00:43 -0600
| Dirk Eddelbuettel <edd at debian.org> wrote:
| 
| > ==1485886== LEAK SUMMARY:
| > ==1485886==    definitely lost: 32 bytes in 1 blocks
| 
| > ==1485886== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0
| > from 0)
| 
| R CMD check only looks at the exit code of the process.
| 
| Valgrind crashes the process on invalid memory access, but doesn't
| consider leaks to be errors, unless you turn on --leak-check=full, and

That is a related problem I did not stress. We can pass debugger arguments to
the debugger used (here: valgrind) when we call R, but we cannot for R CMD check.
That should be added.

| even then still returns the exit code of the child process by default,
| i.e. zero:
| 
| $ cat leak.c 
| #include <stdlib.h>
| 
| int main(void) {
|         malloc(42);
|         return 0;
| }
| $ cc -o leak -g -O0 leak.c
| $ valgrind ./leak; echo exitcode=$?
| ...
| ==14675==    definitely lost: 42 bytes in 1 blocks
| ...
| ==14675== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
| exitcode=0
| $ valgrind --leak-check=full ./leak; echo exitcode=$?
| ...
| 
| ==14688==    definitely lost: 42 bytes in 1 blocks
| ...
| ==14688== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
| exitcode=0
| $ valgrind --leak-check=full --error-exitcode=42 ./leak; \
|  echo exitcode=$?
| ...
| ==14729==    definitely lost: 42 bytes in 1 blocks
| ...
| ==14729== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
| exitcode=42
| 
| R CMD check could be patched to run 
| R -d 'valgrind --leak-check=full --error-exitcode=255' instead of just
| R -d valgrind to produce warnings on Valgrind-detected leaks.
| 
| The problem with this approach is the need for Valgrind suppression
| files. I've run an interactive example of a pure R package under R -d
| 'valgrind --leak-check=full --error-exitcode=255' (a relatively fresh
| SVN build) and got "definitely lost: 15,744 bytes in 41 blocks", mostly
| in plot-related code, allocations originating in Pango and GObject.

I have setup a CI setting using valgrind via R CMD check (and hence lacking
'--leak-check=full' though one could add a wrapper...) and it is a little
frustrating to not have it fail.

But of course it looks like it is a missing feature and we all could work
towards adding it.  All always that would require cooperation by R Core.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From m|ke @end|ng |rom b|ke@ctu@ry@com  Tue Mar  8 17:37:44 2022
From: m|ke @end|ng |rom b|ke@ctu@ry@com (Michael Barr)
Date: Tue, 8 Mar 2022 16:37:44 +0000
Subject: [R-pkg-devel] Package accepted, then an error to fix by 3/22
Message-ID: <MWHPR01MB22377598BBC01442A0DA8751D3099@MWHPR01MB2237.prod.exchangelabs.com>

Hi - had my first package accepted yesterday and published on CRAN. Immediately after, I get an auto email from Prof Ripley stating there is an error to be corrected or else the package  will be archived. See the relevant message from check results link below.

>From Google it appears to be related to a graphic in my vignette though not entirely certain of that. I have precisely one image in my vignette; I?ve passed all the checks locally and for the CRAN submission, so I am stumped how to go about reproducing this error or fixing it. Looking for advice.

Thanks
Mike


   ! Dimension too large.
    \lsthk at InitVarsEOL ->\ifdim \lst at currlwidth
     >\lst at maxwidth \global \lst at maxw...
    l.857 ...nt  pharmacologic  approaches.    "

    Error: processing vignette 'repoRter_nih.Rmd' failed with diagnostics:
    LaTeX failed to compile /data/gannet/ripley/R/packages/tests-clang/repoRter.nih.Rcheck/vign_test/repoRter.nih/vignettes/repoRter_nih.tex. See https://yihui.org/tinytex/r/#debugging for debugging tips. See repoRter_nih.log for more info.
    --- failed re-building ?repoRter_nih.Rmd?

    SUMMARY: processing the following file failed:
     ?repoRter_nih.Rmd?

    Error: Vignette re-building failed.
    Execution halted
Flavor: r-devel-linux-x86_64-fedora-clang<https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-fedora-clang/repoRter.nih-00check.html>


<https://cran.r-project.org/web/checks/check_results_repoRter.nih.html>





	[[alternative HTML version deleted]]


From @eb@meyer @end|ng |rom |@u@de  Tue Mar  8 18:01:41 2022
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Tue, 8 Mar 2022 18:01:41 +0100
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <25127.33551.613976.547674@rob.eddelbuettel.com>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
 <20220308184613.7dd27e77@Tarkus>
 <25127.33551.613976.547674@rob.eddelbuettel.com>
Message-ID: <273a622f-f51b-1bd9-f271-c4499ed7a4d7@fau.de>

Am 08.03.22 um 17:23 schrieb Dirk Eddelbuettel:
> 
> On 8 March 2022 at 18:46, Ivan Krylov wrote:
> | On Sun, 6 Mar 2022 11:00:43 -0600
> | Dirk Eddelbuettel <edd at debian.org> wrote:
> |
> | > ==1485886== LEAK SUMMARY:
> | > ==1485886==    definitely lost: 32 bytes in 1 blocks
> |
> | > ==1485886== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0
> | > from 0)
> |
> | R CMD check only looks at the exit code of the process.
> |
> | Valgrind crashes the process on invalid memory access, but doesn't
> | consider leaks to be errors, unless you turn on --leak-check=full, and
> 
> That is a related problem I did not stress. We can pass debugger arguments to
> the debugger used (here: valgrind) when we call R, but we cannot for R CMD check.
> That should be added.

Not an expert here, but that does seem to be possible, according to WRE 
(Section 4.3.2):

> It is possible to run all the examples, tests and vignettes covered by R CMD check under valgrind by using the option --use-valgrind. If you do this you will need to select the valgrind options some other way, for example by having a ~/.valgrindrc file containing
> 
> --leak-check=full
> --track-origins=yes
> 
> or setting the environment variable VALGRIND_OPTS. As from R 4.2.0, --use-valgrind also uses valgrind when re-building the vignettes. 

Best,

	Sebastian

> 
> | even then still returns the exit code of the child process by default,
> | i.e. zero:
> |
> | $ cat leak.c
> | #include <stdlib.h>
> |
> | int main(void) {
> |         malloc(42);
> |         return 0;
> | }
> | $ cc -o leak -g -O0 leak.c
> | $ valgrind ./leak; echo exitcode=$?
> | ...
> | ==14675==    definitely lost: 42 bytes in 1 blocks
> | ...
> | ==14675== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
> | exitcode=0
> | $ valgrind --leak-check=full ./leak; echo exitcode=$?
> | ...
> |
> | ==14688==    definitely lost: 42 bytes in 1 blocks
> | ...
> | ==14688== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
> | exitcode=0
> | $ valgrind --leak-check=full --error-exitcode=42 ./leak; \
> |  echo exitcode=$?
> | ...
> | ==14729==    definitely lost: 42 bytes in 1 blocks
> | ...
> | ==14729== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
> | exitcode=42
> |
> | R CMD check could be patched to run
> | R -d 'valgrind --leak-check=full --error-exitcode=255' instead of just
> | R -d valgrind to produce warnings on Valgrind-detected leaks.
> |
> | The problem with this approach is the need for Valgrind suppression
> | files. I've run an interactive example of a pure R package under R -d
> | 'valgrind --leak-check=full --error-exitcode=255' (a relatively fresh
> | SVN build) and got "definitely lost: 15,744 bytes in 41 blocks", mostly
> | in plot-related code, allocations originating in Pango and GObject.
> 
> I have setup a CI setting using valgrind via R CMD check (and hence lacking
> '--leak-check=full' though one could add a wrapper...) and it is a little
> frustrating to not have it fail.
> 
> But of course it looks like it is a missing feature and we all could work
> towards adding it.  All always that would require cooperation by R Core.
> 
> Dirk
>


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Mar  9 00:06:09 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 9 Mar 2022 12:06:09 +1300
Subject: [R-pkg-devel] Package accepted, then an error to fix by 3/22
In-Reply-To: <MWHPR01MB22377598BBC01442A0DA8751D3099@MWHPR01MB2237.prod.exchangelabs.com>
References: <MWHPR01MB22377598BBC01442A0DA8751D3099@MWHPR01MB2237.prod.exchangelabs.com>
Message-ID: <555D5D80-10C2-4B63-89E7-13A7ABC3531C@R-project.org>

Michael,

I can replicate the problem on macOS so this is not system-specific - did you actually try to re-build the vignette? As can be seen from the output the problem is is the following line:

one_rec %>% pull(abstract_text) %>% print                                                                         

because it is an extremely long output line (4712 characters) that exceeds the LaTeX limit. The actual content is quite messy so I wouldn't try to output the whole content, but if you really want to, you may need to wrap it first since R output is not soft-wrapped.

Cheers,
Simon



> On Mar 9, 2022, at 5:37 AM, Michael Barr <mike at bikeactuary.com> wrote:
> 
> Hi - had my first package accepted yesterday and published on CRAN. Immediately after, I get an auto email from Prof Ripley stating there is an error to be corrected or else the package  will be archived. See the relevant message from check results link below.
> 
> From Google it appears to be related to a graphic in my vignette though not entirely certain of that. I have precisely one image in my vignette; I?ve passed all the checks locally and for the CRAN submission, so I am stumped how to go about reproducing this error or fixing it. Looking for advice.
> 
> Thanks
> Mike
> 
> 
>   ! Dimension too large.
>    \lsthk at InitVarsEOL ->\ifdim \lst at currlwidth
>> \lst at maxwidth \global \lst at maxw...
>    l.857 ...nt  pharmacologic  approaches.    "
> 
>    Error: processing vignette 'repoRter_nih.Rmd' failed with diagnostics:
>    LaTeX failed to compile /data/gannet/ripley/R/packages/tests-clang/repoRter.nih.Rcheck/vign_test/repoRter.nih/vignettes/repoRter_nih.tex. See https://yihui.org/tinytex/r/#debugging for debugging tips. See repoRter_nih.log for more info.
>    --- failed re-building ?repoRter_nih.Rmd?
> 
>    SUMMARY: processing the following file failed:
>     ?repoRter_nih.Rmd?
> 
>    Error: Vignette re-building failed.
>    Execution halted
> Flavor: r-devel-linux-x86_64-fedora-clang<https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-fedora-clang/repoRter.nih-00check.html>
> 
> 
> <https://cran.r-project.org/web/checks/check_results_repoRter.nih.html>
> 
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Wed Mar  9 01:24:07 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 8 Mar 2022 18:24:07 -0600
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <273a622f-f51b-1bd9-f271-c4499ed7a4d7@fau.de>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
 <20220308184613.7dd27e77@Tarkus>
 <25127.33551.613976.547674@rob.eddelbuettel.com>
 <273a622f-f51b-1bd9-f271-c4499ed7a4d7@fau.de>
Message-ID: <25127.62375.577332.268454@rob.eddelbuettel.com>


On 8 March 2022 at 18:01, Sebastian Meyer wrote:
| Not an expert here, but that does seem to be possible, according to WRE 
| (Section 4.3.2):
| 
| > It is possible to run all the examples, tests and vignettes covered by R CMD check under valgrind by using the option --use-valgrind. If you do this you will need to select the valgrind options some other way, for example by having a ~/.valgrindrc file containing
| > 
| > --leak-check=full
| > --track-origins=yes
| > 
| > or setting the environment variable VALGRIND_OPTS. As from R 4.2.0, --use-valgrind also uses valgrind when re-building the vignettes. 

Oh, a most excellent find, thank you.

I completely missed that towards the end of Section 4.3.2 in WRE.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From m|ke @end|ng |rom b|ke@ctu@ry@com  Wed Mar  9 01:29:03 2022
From: m|ke @end|ng |rom b|ke@ctu@ry@com (Michael Barr)
Date: Wed, 9 Mar 2022 00:29:03 +0000
Subject: [R-pkg-devel] Package accepted, then an error to fix by 3/22
In-Reply-To: <555D5D80-10C2-4B63-89E7-13A7ABC3531C@R-project.org>
References: <MWHPR01MB22377598BBC01442A0DA8751D3099@MWHPR01MB2237.prod.exchangelabs.com>
 <555D5D80-10C2-4B63-89E7-13A7ABC3531C@R-project.org>
Message-ID: <MWHPR01MB2237B9790B0E426943261C32D30A9@MWHPR01MB2237.prod.exchangelabs.com>

Hi - thanks for the reply. Yes I built this vignette probably over 150 times through the course of working out other NOTES, via rhub::check_for_cran, devtools::check, devtools::build_vignette, R CMD CHECK, some other devtools function which checks for win devel the exact name of which escapes me atm?

Also this made it past the CRAN submission process, newbies pipeline == higher touch as I understand.

I?m curious why I make it past so many different checks prior to publishing. Not surprised it is latex related though. I will look up the character limit for latex to fix this.

One follow up question - after I make this correction, would the expectation be to increment the version for a patch (0.1.1) when I submit to cran?

Thanks
Mike
________________________________
From: Simon Urbanek <simon.urbanek at R-project.org>
Sent: Tuesday, March 8, 2022 6:06 PM
To: Michael Barr <mike at bikeactuary.com>
Cc: r-package-devel at r-project.org <R-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Package accepted, then an error to fix by 3/22

Michael,

I can replicate the problem on macOS so this is not system-specific - did you actually try to re-build the vignette? As can be seen from the output the problem is is the following line:

one_rec %>% pull(abstract_text) %>% print

because it is an extremely long output line (4712 characters) that exceeds the LaTeX limit. The actual content is quite messy so I wouldn't try to output the whole content, but if you really want to, you may need to wrap it first since R output is not soft-wrapped.

Cheers,
Simon



> On Mar 9, 2022, at 5:37 AM, Michael Barr <mike at bikeactuary.com> wrote:
>
> Hi - had my first package accepted yesterday and published on CRAN. Immediately after, I get an auto email from Prof Ripley stating there is an error to be corrected or else the package  will be archived. See the relevant message from check results link below.
>
> From Google it appears to be related to a graphic in my vignette though not entirely certain of that. I have precisely one image in my vignette; I?ve passed all the checks locally and for the CRAN submission, so I am stumped how to go about reproducing this error or fixing it. Looking for advice.
>
> Thanks
> Mike
>
>
>   ! Dimension too large.
>    \lsthk at InitVarsEOL ->\ifdim \lst at currlwidth
>> \lst at maxwidth \global \lst at maxw...
>    l.857 ...nt  pharmacologic  approaches.    "
>
>    Error: processing vignette 'repoRter_nih.Rmd' failed with diagnostics:
>    LaTeX failed to compile /data/gannet/ripley/R/packages/tests-clang/repoRter.nih.Rcheck/vign_test/repoRter.nih/vignettes/repoRter_nih.tex. See https://yihui.org/tinytex/r/#debugging for debugging tips. See repoRter_nih.log for more info.
>    --- failed re-building ?repoRter_nih.Rmd?
>
>    SUMMARY: processing the following file failed:
>     ?repoRter_nih.Rmd?
>
>    Error: Vignette re-building failed.
>    Execution halted
> Flavor: r-devel-linux-x86_64-fedora-clang<https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-fedora-clang/repoRter.nih-00check.html>
>
>
> <https://cran.r-project.org/web/checks/check_results_repoRter.nih.html>
>
>
>
>
>
>        [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Mar  9 01:54:52 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 9 Mar 2022 13:54:52 +1300
Subject: [R-pkg-devel] Package accepted, then an error to fix by 3/22
In-Reply-To: <MWHPR01MB2237B9790B0E426943261C32D30A9@MWHPR01MB2237.prod.exchangelabs.com>
References: <MWHPR01MB22377598BBC01442A0DA8751D3099@MWHPR01MB2237.prod.exchangelabs.com>
 <555D5D80-10C2-4B63-89E7-13A7ABC3531C@R-project.org>
 <MWHPR01MB2237B9790B0E426943261C32D30A9@MWHPR01MB2237.prod.exchangelabs.com>
Message-ID: <758F741E-CDC6-4933-9923-33FEC8174CF4@R-project.org>

Michael,

responses inline.


> On Mar 9, 2022, at 1:29 PM, Michael Barr <mike at bikeactuary.com> wrote:
> 
> Hi - thanks for the reply. Yes I built this vignette probably over 150 times through the course of working out other NOTES, via rhub::check_for_cran, devtools::check, devtools::build_vignette, R CMD CHECK, some other devtools function which checks for win devel the exact name of which escapes me atm?
> 
> Also this made it past the CRAN submission process, newbies pipeline == higher touch as I understand. 
> 
> I?m curious why I make it past so many different checks prior to publishing.


I would suspect it's because the results in your vignette are not fixed, but rely on web queries, so it just so happens that the first entry that you print changed in the NIH database and now triggers the problem. This issue has not been picked up because presumably the previous result was shorter.



> Not surprised it is latex related though. I will look up the character limit for latex to fix this.
> 
> One follow up question - after I make this correction, would the expectation be to increment the version for a patch (0.1.1) when I submit to cran?
> 


Yes, you have to increase the version number on each submission.

Cheers,
Simon



> Thanks
> Mike
> From: Simon Urbanek <simon.urbanek at R-project.org>
> Sent: Tuesday, March 8, 2022 6:06 PM
> To: Michael Barr <mike at bikeactuary.com>
> Cc: r-package-devel at r-project.org <R-package-devel at r-project.org>
> Subject: Re: [R-pkg-devel] Package accepted, then an error to fix by 3/22
>  
> Michael,
> 
> I can replicate the problem on macOS so this is not system-specific - did you actually try to re-build the vignette? As can be seen from the output the problem is is the following line:
> 
> one_rec %>% pull(abstract_text) %>% print                                                                         
> 
> because it is an extremely long output line (4712 characters) that exceeds the LaTeX limit. The actual content is quite messy so I wouldn't try to output the whole content, but if you really want to, you may need to wrap it first since R output is not soft-wrapped.
> 
> Cheers,
> Simon
> 
> 
> 
> > On Mar 9, 2022, at 5:37 AM, Michael Barr <mike at bikeactuary.com> wrote:
> > 
> > Hi - had my first package accepted yesterday and published on CRAN. Immediately after, I get an auto email from Prof Ripley stating there is an error to be corrected or else the package  will be archived. See the relevant message from check results link below.
> > 
> > From Google it appears to be related to a graphic in my vignette though not entirely certain of that. I have precisely one image in my vignette; I?ve passed all the checks locally and for the CRAN submission, so I am stumped how to go about reproducing this error or fixing it. Looking for advice.
> > 
> > Thanks
> > Mike
> > 
> > 
> >   ! Dimension too large.
> >    \lsthk at InitVarsEOL ->\ifdim \lst at currlwidth
> >> \lst at maxwidth \global \lst at maxw...
> >    l.857 ...nt  pharmacologic  approaches.    "
> > 
> >    Error: processing vignette 'repoRter_nih.Rmd' failed with diagnostics:
> >    LaTeX failed to compile /data/gannet/ripley/R/packages/tests-clang/repoRter.nih.Rcheck/vign_test/repoRter.nih/vignettes/repoRter_nih.tex. See https://yihui.org/tinytex/r/#debugging for debugging tips. See repoRter_nih.log for more info.
> >    --- failed re-building ?repoRter_nih.Rmd?
> > 
> >    SUMMARY: processing the following file failed:
> >     ?repoRter_nih.Rmd?
> > 
> >    Error: Vignette re-building failed.
> >    Execution halted
> > Flavor: r-devel-linux-x86_64-fedora-clang<https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-fedora-clang/repoRter.nih-00check.html>
> > 
> > 
> > <https://cran.r-project.org/web/checks/check_results_repoRter.nih.html>
> > 
> > 
> > 
> > 
> > 
> >        [[alternative HTML version deleted]]
> > 
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From pro|jcn@@h @end|ng |rom gm@||@com  Wed Mar  9 18:15:28 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Wed, 9 Mar 2022 09:15:28 -0800
Subject: [R-pkg-devel] Failing Valgrind Passing R CMD check
In-Reply-To: <25127.62375.577332.268454@rob.eddelbuettel.com>
References: <25124.59579.987161.996173@rob.eddelbuettel.com>
 <20220308184613.7dd27e77@Tarkus>
 <25127.33551.613976.547674@rob.eddelbuettel.com>
 <273a622f-f51b-1bd9-f271-c4499ed7a4d7@fau.de>
 <25127.62375.577332.268454@rob.eddelbuettel.com>
Message-ID: <f8689475-24da-ec55-4b46-f18367d6283c@gmail.com>

I've not used valgrind before, but by request have installed it and
run R CMD check with and without --use-valgrind on the lbfgsb3c package
that Matt Fidler maintains and I contributed to. Using my own rmaiib.pl
to clear out what did NOT change between the two (ReMove from A If In
B -- a tool that strips dirtree A of content that byte-for-byte matches
that in B on basis of file size, not names), I then compared what was
left using meld. As far as I can tell, there are no valgrind complaints,
so nothing that should trip a "check" message here. Or am I missing
something? I'll be happy to rerun with changes if requested. Below is
output from inxi detailing my linux setup

System:
   Host: HP21 Kernel: 5.13.0-27-generic x86_64 bits: 64 Desktop: MATE 1.26.0
   Distro: Linux Mint 20.3 Una
Machine:
   Type: Laptop System: HP product: HP Laptop 14-fq1xxx v: N/A
   serial: <superuser/root required>
   Mobo: HP model: 887C v: 59.08 serial: <superuser/root required> UEFI: AMI
   v: F.03 date: 03/09/2021
CPU:
   Topology: 8-Core model: AMD Ryzen 7 5700U with Radeon Graphics bits: 64
   type: MT MCP L2 cache: 4096 KiB
   Speed: 1929 MHz min/max: 1400/1800 MHz Core speeds (MHz): 1: 1690 2: 1603
   3: 1397 4: 1397 5: 1397 6: 1394 7: 1397 8: 1397 9: 4342 10: 3677 11: 1721
   12: 1930 13: 1930 14: 1427 15: 1397 16: 1397
Drives:
   Local Storage: total: 1.16 TiB used: 469.07 GiB (39.6%)
   ID-1: /dev/nvme0n1 vendor: Samsung model: MZVLQ1T0HALB-000H1
   size: 953.87 GiB
   ID-2: /dev/sda type: USB model: Multiple Card Reader size: 231.81 GiB
Info:
   Processes: 344 Uptime: 30m Memory: 14.98 GiB used: 2.00 GiB (13.4%)
   Shell: bash inxi: 3.0.38

Here is the typical extra material at the end of a check of a test in the pkg,
in this case the cyq test (Chebyquad function minimized with lbfgsb3c).

> ==4111== 
> ==4111== HEAP SUMMARY:
> ==4111==     in use at exit: 61,844,734 bytes in 9,151 blocks
> ==4111==   total heap usage: 28,318 allocs, 19,167 frees, 122,346,551 bytes allocated
> ==4111== 
> ==4111== LEAK SUMMARY:
> ==4111==    definitely lost: 0 bytes in 0 blocks
> ==4111==    indirectly lost: 0 bytes in 0 blocks
> ==4111==      possibly lost: 0 bytes in 0 blocks
> ==4111==    still reachable: 61,844,734 bytes in 9,151 blocks
> ==4111==         suppressed: 0 bytes in 0 blocks
> ==4111== Rerun with --leak-check=full to see details of leaked memory
> ==4111== 
> ==4111== For lists of detected and suppressed errors, rerun with: -s
> ==4111== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

Cheers,

John Nash



On 2022-03-08 16:24, Dirk Eddelbuettel wrote:
> 
> On 8 March 2022 at 18:01, Sebastian Meyer wrote:
> | Not an expert here, but that does seem to be possible, according to WRE
> | (Section 4.3.2):
> |
> | > It is possible to run all the examples, tests and vignettes covered by R CMD check under valgrind by using the option --use-valgrind. If you do this you will need to select the valgrind options some other way, for example by having a ~/.valgrindrc file containing
> | >
> | > --leak-check=full
> | > --track-origins=yes
> | >
> | > or setting the environment variable VALGRIND_OPTS. As from R 4.2.0, --use-valgrind also uses valgrind when re-building the vignettes.
> 
> Oh, a most excellent find, thank you.
> 
> I completely missed that towards the end of Section 4.3.2 in WRE.
> 
> Dirk
>


From bbo|ker @end|ng |rom gm@||@com  Thu Mar 10 01:38:59 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 9 Mar 2022 19:38:59 -0500
Subject: [R-pkg-devel] crowdsourcing/help with
Message-ID: <d45ef5fc-653c-5ed1-db49-a2a4a7cac0a0@gmail.com>


   We (the glmmTMB developers) are having a hard-to-reproduce problem on 
Windows.  When run on CRAN's check platform or win-builder with r-devel, 
the code fails on the first example, when trying to reconstruct a 'TMB' 
object (TMB is a C++-based package we depend on). The problem is that we 
can't find a Windows system *other* than win-builder on which it fails 
-- it works on r-hub, and with 2 or 3 other Windows 10/11 systems we've 
tried it on.

   I suspect this has to do with an incompatibility in the binary stack 
- there is a dependency chain Matrix ? TMB ? glmmTMB, and we know that 
weird stuff can happen if the stack is incompatible (e.g. TMB was built 
with an older version of Matrix than is currently installed), but 
haven't managed to put together a stack that fails.

   If anyone with a Windows system handy would be willing to try this 
out and see if it works that would be *super* handy (especially if you 
can get it to fail!)

   You can read all about it here:

https://github.com/glmmTMB/glmmTMB/issues/787

    If you just want to grab the tarball so you can run R CMD check on 
it, try:

r <- remotes::remote_download(github_remote("glmmTMB/glmmTMB/glmmTMB"))
file.rename(r, "my_glmmtmb_tarball.tar.gz")

    If you do manage to get it to fail, it would be great to see 
detailed output from

library(glmmTMB)
up2date(readRDS(system.file("example_files","salamander1.rds",package="glmmTMB")))

   Any other debugging/diagnostic suggestions are of course welcome.
   (If this fails we will probably have to put "skip if on Windows" 
logic around most of our examples and tests.)

   cheers
     Ben Bolker


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu Mar 10 09:19:42 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 10 Mar 2022 09:19:42 +0100
Subject: [R-pkg-devel] crowdsourcing/help with
In-Reply-To: <d45ef5fc-653c-5ed1-db49-a2a4a7cac0a0@gmail.com>
References: <d45ef5fc-653c-5ed1-db49-a2a4a7cac0a0@gmail.com>
Message-ID: <73e459ef-5c09-9a38-31a1-54ed23a3abf0@gmail.com>


On 3/10/22 01:38, Ben Bolker wrote:
>
> ? We (the glmmTMB developers) are having a hard-to-reproduce problem 
> on Windows.? When run on CRAN's check platform or win-builder with 
> r-devel, the code fails on the first example, when trying to 
> reconstruct a 'TMB' object (TMB is a C++-based package we depend on). 
> The problem is that we can't find a Windows system *other* than 
> win-builder on which it fails -- it works on r-hub, and with 2 or 3 
> other Windows 10/11 systems we've tried it on.
>
> ? I suspect this has to do with an incompatibility in the binary stack 
> - there is a dependency chain Matrix ? TMB ? glmmTMB, and we know that 
> weird stuff can happen if the stack is incompatible (e.g. TMB was 
> built with an older version of Matrix than is currently installed), 
> but haven't managed to put together a stack that fails.
>
> ? If anyone with a Windows system handy would be willing to try this 
> out and see if it works that would be *super* handy (especially if you 
> can get it to fail!)
>
> ? You can read all about it here:
>
> https://github.com/glmmTMB/glmmTMB/issues/787
>
> ?? If you just want to grab the tarball so you can run R CMD check on 
> it, try:
>
> r <- remotes::remote_download(github_remote("glmmTMB/glmmTMB/glmmTMB"))
> file.rename(r, "my_glmmtmb_tarball.tar.gz")
>
> ?? If you do manage to get it to fail, it would be great to see 
> detailed output from
>
> library(glmmTMB)
> up2date(readRDS(system.file("example_files","salamander1.rds",package="glmmTMB"))) 
>
>
> ? Any other debugging/diagnostic suggestions are of course welcome.
> ? (If this fails we will probably have to put "skip if on Windows" 
> logic around most of our examples and tests.)

As you have a machine where it fails, which is winbuilder, could you 
perhaps instrument your package to print the information you need to 
debug the issue, and re-submit it? Also, to get more specific advice, 
perhaps you could paste the actual output or a link to it.

Best
Tomas

>
> ? cheers
> ??? Ben Bolker
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Thu Mar 10 15:51:01 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 10 Mar 2022 09:51:01 -0500
Subject: [R-pkg-devel] crowdsourcing/help with
In-Reply-To: <73e459ef-5c09-9a38-31a1-54ed23a3abf0@gmail.com>
References: <d45ef5fc-653c-5ed1-db49-a2a4a7cac0a0@gmail.com>
 <73e459ef-5c09-9a38-31a1-54ed23a3abf0@gmail.com>
Message-ID: <b422f5f0-78a5-2631-f5f2-719b17e19daf@gmail.com>

   The win-builder output is here: 
https://win-builder.r-project.org/ce55MsIkho3o/00check.log

   Key points:

  the Anova.glmmTMB example fails, but this is the only output provided:

 >
 > ### ** Examples
 >
 > warp.lm <- glmmTMB(breaks ~ wool * tension, data = warpbreaks)
 > salamander1 <- 
up2date(readRDS(system.file("example_files","salamander1.rds",package="glmmTMB")))

  (I was wrong that examples fail immediately: 
https://win-builder.r-project.org/ce55MsIkho3o/examples_and_tests/glmmTMB-Ex.Rout 
shows that some examples do succeed)

    I will try to make a test-A.R that runs first that *only* runs 
up2date (which is pretty much just a call to TMB::MakeADFun).  I might 
try a call to library(TMB), which might (?) throw an informative warning 
about a Matrix/TMB binary mismatch ...

   thanks
   Ben



On 3/10/22 3:19 AM, Tomas Kalibera wrote:
> 
> On 3/10/22 01:38, Ben Bolker wrote:
>>
>> ? We (the glmmTMB developers) are having a hard-to-reproduce problem 
>> on Windows.? When run on CRAN's check platform or win-builder with 
>> r-devel, the code fails on the first example, when trying to 
>> reconstruct a 'TMB' object (TMB is a C++-based package we depend on). 
>> The problem is that we can't find a Windows system *other* than 
>> win-builder on which it fails -- it works on r-hub, and with 2 or 3 
>> other Windows 10/11 systems we've tried it on.
>>
>> ? I suspect this has to do with an incompatibility in the binary stack 
>> - there is a dependency chain Matrix ? TMB ? glmmTMB, and we know that 
>> weird stuff can happen if the stack is incompatible (e.g. TMB was 
>> built with an older version of Matrix than is currently installed), 
>> but haven't managed to put together a stack that fails.
>>
>> ? If anyone with a Windows system handy would be willing to try this 
>> out and see if it works that would be *super* handy (especially if you 
>> can get it to fail!)
>>
>> ? You can read all about it here:
>>
>> https://github.com/glmmTMB/glmmTMB/issues/787
>>
>> ?? If you just want to grab the tarball so you can run R CMD check on 
>> it, try:
>>
>> r <- remotes::remote_download(github_remote("glmmTMB/glmmTMB/glmmTMB"))
>> file.rename(r, "my_glmmtmb_tarball.tar.gz")
>>
>> ?? If you do manage to get it to fail, it would be great to see 
>> detailed output from
>>
>> library(glmmTMB)
>> up2date(readRDS(system.file("example_files","salamander1.rds",package="glmmTMB"))) 
>>
>>
>> ? Any other debugging/diagnostic suggestions are of course welcome.
>> ? (If this fails we will probably have to put "skip if on Windows" 
>> logic around most of our examples and tests.)
> 
> As you have a machine where it fails, which is winbuilder, could you 
> perhaps instrument your package to print the information you need to 
> debug the issue, and re-submit it? Also, to get more specific advice, 
> perhaps you could paste the actual output or a link to it.
> 
> Best
> Tomas
> 
>>
>> ? cheers
>> ??? Ben Bolker
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From henr|k@bengt@@on @end|ng |rom gm@||@com  Thu Mar 10 16:04:00 2022
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Thu, 10 Mar 2022 07:04:00 -0800
Subject: [R-pkg-devel] crowdsourcing/help with
In-Reply-To: <b422f5f0-78a5-2631-f5f2-719b17e19daf@gmail.com>
References: <d45ef5fc-653c-5ed1-db49-a2a4a7cac0a0@gmail.com>
 <73e459ef-5c09-9a38-31a1-54ed23a3abf0@gmail.com>
 <b422f5f0-78a5-2631-f5f2-719b17e19daf@gmail.com>
Message-ID: <CAFDcVCQLGRAEZZyLYzA=e_JWozcERRh6dJ9QV8oU_WiT62CWSQ@mail.gmail.com>

FWIW, you might want to do

loadNamespace("TMB")
library("TMB")

as loadNamespace() may give more informative error messages, cf.
https://github.com/HenrikBengtsson/Wishlist-for-R/issues/26.

Henrik


On Thu, Mar 10, 2022, 06:51 Ben Bolker <bbolker at gmail.com> wrote:

>    The win-builder output is here:
> https://win-builder.r-project.org/ce55MsIkho3o/00check.log
>
>    Key points:
>
>   the Anova.glmmTMB example fails, but this is the only output provided:
>
>  >
>  > ### ** Examples
>  >
>  > warp.lm <- glmmTMB(breaks ~ wool * tension, data = warpbreaks)
>  > salamander1 <-
>
> up2date(readRDS(system.file("example_files","salamander1.rds",package="glmmTMB")))
>
>   (I was wrong that examples fail immediately:
>
> https://win-builder.r-project.org/ce55MsIkho3o/examples_and_tests/glmmTMB-Ex.Rout
> shows that some examples do succeed)
>
>     I will try to make a test-A.R that runs first that *only* runs
> up2date (which is pretty much just a call to TMB::MakeADFun).  I might
> try a call to library(TMB), which might (?) throw an informative warning
> about a Matrix/TMB binary mismatch ...
>
>    thanks
>    Ben
>
>
>
> On 3/10/22 3:19 AM, Tomas Kalibera wrote:
> >
> > On 3/10/22 01:38, Ben Bolker wrote:
> >>
> >>   We (the glmmTMB developers) are having a hard-to-reproduce problem
> >> on Windows.  When run on CRAN's check platform or win-builder with
> >> r-devel, the code fails on the first example, when trying to
> >> reconstruct a 'TMB' object (TMB is a C++-based package we depend on).
> >> The problem is that we can't find a Windows system *other* than
> >> win-builder on which it fails -- it works on r-hub, and with 2 or 3
> >> other Windows 10/11 systems we've tried it on.
> >>
> >>   I suspect this has to do with an incompatibility in the binary stack
> >> - there is a dependency chain Matrix ? TMB ? glmmTMB, and we know that
> >> weird stuff can happen if the stack is incompatible (e.g. TMB was
> >> built with an older version of Matrix than is currently installed),
> >> but haven't managed to put together a stack that fails.
> >>
> >>   If anyone with a Windows system handy would be willing to try this
> >> out and see if it works that would be *super* handy (especially if you
> >> can get it to fail!)
> >>
> >>   You can read all about it here:
> >>
> >> https://github.com/glmmTMB/glmmTMB/issues/787
> >>
> >>    If you just want to grab the tarball so you can run R CMD check on
> >> it, try:
> >>
> >> r <- remotes::remote_download(github_remote("glmmTMB/glmmTMB/glmmTMB"))
> >> file.rename(r, "my_glmmtmb_tarball.tar.gz")
> >>
> >>    If you do manage to get it to fail, it would be great to see
> >> detailed output from
> >>
> >> library(glmmTMB)
> >>
> up2date(readRDS(system.file("example_files","salamander1.rds",package="glmmTMB")))
>
> >>
> >>
> >>   Any other debugging/diagnostic suggestions are of course welcome.
> >>   (If this fails we will probably have to put "skip if on Windows"
> >> logic around most of our examples and tests.)
> >
> > As you have a machine where it fails, which is winbuilder, could you
> > perhaps instrument your package to print the information you need to
> > debug the issue, and re-submit it? Also, to get more specific advice,
> > perhaps you could paste the actual output or a link to it.
> >
> > Best
> > Tomas
> >
> >>
> >>   cheers
> >>     Ben Bolker
> >>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> Dr. Benjamin Bolker
> Professor, Mathematics & Statistics and Biology, McMaster University
> Director, School of Computational Science and Engineering
> (Acting) Graduate chair, Mathematics & Statistics
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From m|ke @end|ng |rom b|ke@ctu@ry@com  Thu Mar 10 16:28:57 2022
From: m|ke @end|ng |rom b|ke@ctu@ry@com (Michael Barr)
Date: Thu, 10 Mar 2022 15:28:57 +0000
Subject: [R-pkg-devel] Package accepted, then an error to fix by 3/22
In-Reply-To: <16A7F0C4-17AF-432D-BD7F-48587E06955D@R-project.org>
References: <MWHPR01MB22377598BBC01442A0DA8751D3099@MWHPR01MB2237.prod.exchangelabs.com>
 <555D5D80-10C2-4B63-89E7-13A7ABC3531C@R-project.org>
 <MWHPR01MB2237B9790B0E426943261C32D30A9@MWHPR01MB2237.prod.exchangelabs.com>
 <758F741E-CDC6-4933-9923-33FEC8174CF4@R-project.org>
 <16A7F0C4-17AF-432D-BD7F-48587E06955D@R-project.org>
Message-ID: <MWHPR01MB223783CC1428726D5A26994DD30B9@MWHPR01MB2237.prod.exchangelabs.com>

Thanks Simon - that definitely was a possible explanation. However I?ve ruled it out as the explanation - the same record comes through in one_rec since I last ran during initial development. I and fairly confident that the explanation must involve a discrepancy between the check process for a submission (and prior to submission) and the auto check after acceptance.

I don?t know how I raise this issue for investigation so I?m just adding back to the list in case anyone has an interest.

Thanks
Mike


________________________________
From: Simon Urbanek <simon.urbanek at R-project.org>
Sent: Tuesday, March 8, 2022 8:00 PM
To: Michael Barr <mike at bikeactuary.com>
Subject: Re: [R-pkg-devel] Package accepted, then an error to fix by 3/22



> On Mar 9, 2022, at 1:54 PM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
>
> Michael,
>
> responses inline.
>
>
>> On Mar 9, 2022, at 1:29 PM, Michael Barr <mike at bikeactuary.com> wrote:
>>
>> Hi - thanks for the reply. Yes I built this vignette probably over 150 times through the course of working out other NOTES, via rhub::check_for_cran, devtools::check, devtools::build_vignette, R CMD CHECK, some other devtools function which checks for win devel the exact name of which escapes me atm?
>>
>> Also this made it past the CRAN submission process, newbies pipeline == higher touch as I understand.
>>
>> I?m curious why I make it past so many different checks prior to publishing.
>
>
> I would suspect it's because the results in your vignette are not fixed, but rely on web queries, so it just so happens that the first entry that you print changed in the NIH database and now triggers the problem. This issue has not been picked up because presumably the previous result was shorter.
>
>
>
>> Not surprised it is latex related though. I will look up the character limit for latex to fix this.
>>


I forgot to add that this has rally nothing to do with latex limits - it's simply a bug in the example that tries to produce an insanely long line - I don't think it makes any sense to try to print an abstract as one line. I would suggest either use str() just to illustrate the idea or if you really want to print it, you have to split it into lines and use cat()  [or let knitr soft-wrap the output].

Cheers,
Simon



	[[alternative HTML version deleted]]


From m|ke @end|ng |rom b|ke@ctu@ry@com  Thu Mar 10 22:00:09 2022
From: m|ke @end|ng |rom b|ke@ctu@ry@com (Michael Barr)
Date: Thu, 10 Mar 2022 21:00:09 +0000
Subject: [R-pkg-devel] R-bloggers and vignettes
Message-ID: <MWHPR01MB22373DFF705EDC6999D5BCC6D30B9@MWHPR01MB2237.prod.exchangelabs.com>

Hi again -

Hope this is not misplaced, but I have a question related more to publishing a release note on r-bloggers. My site is already fed into r-bloggers and I've put a couple posts there. But with my first package I'm wondering if it is bad form to blog the entire vignette on your own site (and by extension on r-bloggers) when it is rather long with many examples. Is there any convention here, for example:

- publish just the first x% of the vignette, with a read more link to the full write up posted elsewhere (either the CRAN hosted or somewhere else on your own blog)
- write a separate, more condensed version that gets across the main points (say with less examples)
- publish the whole thing and it's fine

Just looking for thoughts on what others like or expect to see. Thanks

Mike

	[[alternative HTML version deleted]]


From m@e||e@@@|mon @end|ng |rom y@hoo@@e  Fri Mar 11 07:53:35 2022
From: m@e||e@@@|mon @end|ng |rom y@hoo@@e (=?UTF-8?Q?Ma=C3=ABlle_SALMON?=)
Date: Fri, 11 Mar 2022 06:53:35 +0000 (UTC)
Subject: [R-pkg-devel] R-bloggers and vignettes
In-Reply-To: <MWHPR01MB22373DFF705EDC6999D5BCC6D30B9@MWHPR01MB2237.prod.exchangelabs.com>
References: <MWHPR01MB22373DFF705EDC6999D5BCC6D30B9@MWHPR01MB2237.prod.exchangelabs.com>
Message-ID: <1720849465.1341634.1646981615866@mail.yahoo.com>

Hello,


To me, if you have the time, the second solution sounds the best as reading a shorter post might be appealing to more readers, who can then explore your package docs or just put the existence of your package in a corner of their memory for later when they actually need it. And then you can keep this habit and blog again when your package has a new release. :-)

Here's an example of a blog post by Neal Richardson advertising a package in a different way than in the package vignettes (that are published on a pkgdown website): https://enpiar.com/2017/06/21/7-hard-testing-problems-made-easy-by-httptest/

Curious to read others' opinions. Good luck in any case!

Ma?lle.

Den torsdag 10 mars 2022 22:00:32 CET, Michael Barr <mike at bikeactuary.com> skrev: 





Hi again -

Hope this is not misplaced, but I have a question related more to publishing a release note on r-bloggers. My site is already fed into r-bloggers and I've put a couple posts there. But with my first package I'm wondering if it is bad form to blog the entire vignette on your own site (and by extension on r-bloggers) when it is rather long with many examples. Is there any convention here, for example:

- publish just the first x% of the vignette, with a read more link to the full write up posted elsewhere (either the CRAN hosted or somewhere else on your own blog)
- write a separate, more condensed version that gets across the main points (say with less examples)
- publish the whole thing and it's fine

Just looking for thoughts on what others like or expect to see. Thanks

Mike

??? [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Mon Mar 14 01:11:08 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sun, 13 Mar 2022 20:11:08 -0400
Subject: [R-pkg-devel] debugging remote vignette build failure
Message-ID: <4453ba22-73bc-e298-e334-bc5c264b9b13@gmail.com>

   After switching some vignette elements of the form

https://doi.org/10.1214/09-AOAS306

to

\doi{10.1214/09-AOAS306}

   in the glmmTMB package,

GitHub Actions under Ubuntu 20.04 is throwing an error of the form

Running 'texi2dvi' on 'glmmTMB.tex' failed.
LaTeX errors:
! Undefined control sequence.
l.172 doi:\nobreakspace{}\Rhref
 
{[https://doi.org/10.32614/RJ-2017-066}{10.326...](https://doi.org/10.32614/RJ-2017-066%7D%7B10.326...)
The control sequence at the end of the top line
of your error message was never \def'ed. If you have


    This does **not** happen with rhub::check_on_ubuntu, which tests 
with R-release under Ubuntu Linux 20.04.1 LTS

    It would be nice to fix our GH Actions workflow.  Has anyone seen 
this before/have suggestions for where to start looking for problems?

   cheers
     Ben Bolker


From edd @end|ng |rom deb|@n@org  Mon Mar 14 01:56:00 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sun, 13 Mar 2022 19:56:00 -0500
Subject: [R-pkg-devel] debugging remote vignette build failure
In-Reply-To: <4453ba22-73bc-e298-e334-bc5c264b9b13@gmail.com>
References: <4453ba22-73bc-e298-e334-bc5c264b9b13@gmail.com>
Message-ID: <25134.37536.498638.264493@rob.eddelbuettel.com>


On 13 March 2022 at 20:11, Ben Bolker wrote:
|    After switching some vignette elements of the form
| 
| https://doi.org/10.1214/09-AOAS306
| 
| to
| 
| \doi{10.1214/09-AOAS306}
| 
|    in the glmmTMB package,
| 
| GitHub Actions under Ubuntu 20.04 is throwing an error of the form
| 
| Running 'texi2dvi' on 'glmmTMB.tex' failed.
| LaTeX errors:
| ! Undefined control sequence.
| l.172 doi:\nobreakspace{}\Rhref
|  
| {[https://doi.org/10.32614/RJ-2017-066}{10.326...](https://doi.org/10.32614/RJ-2017-066%7D%7B10.326...)
| The control sequence at the end of the top line
| of your error message was never \def'ed. If you have
| 
| 
|     This does **not** happen with rhub::check_on_ubuntu, which tests 
| with R-release under Ubuntu Linux 20.04.1 LTS
| 
|     It would be nice to fix our GH Actions workflow.  Has anyone seen 
| this before/have suggestions for where to start looking for problems?

Long shot: can you identify the respective jss.sty version (or alike,
i.e. whichever latex code is dealing with expanding \doi{}) ?  And then maybe
locally provide the presumably more capable newer one?

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


