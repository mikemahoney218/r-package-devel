From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Jan  1 20:11:56 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 1 Jan 2022 14:11:56 -0500
Subject: [R-pkg-devel] doi confusion and Data codoc mismatches
In-Reply-To: <12a47080-a803-45e5-9feb-b501e658ddb0@gmail.com>
References: <9e255e07-f32d-c3ad-a677-f2c6190f44db@effectivedefense.org>
 <32fe7d16-cf04-cb2d-6513-047b61d5c5b7@gmail.com>
 <12a47080-a803-45e5-9feb-b501e658ddb0@gmail.com>
Message-ID: <ff6d01c2-63b4-d827-468d-f891d5db09a5@gmail.com>

On 26/12/2021 8:03 a.m., Duncan Murdoch wrote:
> I've now submitted a bug report for R:
> https://bugs.r-project.org/show_bug.cgi?id=18266 along with a suggested
> patch to remove the first of these.

And this patch was committed to the trunk by Kurt Hornik, so it should 
appear in R 4.2.0 or maybe some 4.1.x release.  Thanks Kurt!

Duncan Murdoch

> 
> Duncan Murdoch
> 
> 
> On 26/12/2021 5:55 a.m., Duncan Murdoch wrote:
>> On 26/12/2021 12:07 a.m., Spencer Graves wrote:
>>> Hello, All:
>>>
>>>
>>> 	  The latest checks on
>>> "https://github.com/sbgraves237/Ecdat/runs/4634725654?check_suite_focus=true"
>>> identify two problems I don't know how to fix:
>>>
>>>
>>> FIRST:  Data codoc mismatches from documentation object 'USnewspapers':
>>>       Variables in data frame 'USnewspapers'
>>>         Code: AdsProportion Ads_G2012dollars Ads_currentGdollars
>>>               Circ_G2012dollars Circ_currentGdollars GDP_G2012 GDP_nominalG
>>>               Population_M RevenuePerCap_2012 RevenuePerCap_nominal
>>>               Revenue_G2012dollars Revenue_currentGdollars Year
>>>               newspapers_p_GDP
>>>         Docs: Ads_G2012dollars Circ_G2012dollars Circ_currentGdollars
>>>               Revenue_G2012dollars Revenue_currentGdollars AdsProportion
>>>               Ads_currentGdollars GDP_G2012 GDP_nominalG Population_M
>>>               RevenuePerCap_2012 RevenuePerCap_nominal Year newspapers_p_GDP
>>>
>>>
>>> 	  I believe that the column names in the data.frame 'USnewspapers'
>>> match the names in the order given in the *.Rd file and the variable
>>> list following "Code" here matches that following "Docs" using, e.g.,
>>> sort(scan(what=character())).
>>
>> You can debug this by running tools::codocData("Ecdat") after the
>> package is installed.  It appears that some of the names in the docs are
>> picking up newlines, specifically the ones documented like this:
>>
>> \item{Ads_currentGdollars,
>>              Ads_G2012dollars,
>>              Circ_currentGdollars,
>>              Circ_G2012dollars,
>>              Revenue_currentGdollars,
>>              Revenue_G2012dollars}
>>
>> I think that's a bug in codocData.  A workaround is to put those all on
>> one line.  You don't get a "line too long" warning, because they'll be
>> reformatted in the display.
>>
>>>
>>>
>>> SECOND:  Found the following URLs which should use \doi (with the DOI
>>> name only):
>>>         File 'AccountantsAuditorsPct.Rd':
>>>           https://doi.org/10.18128/D010.V8.0
>>>         File 'OCC1950.Rd':
>>>           https://doi.org/10.18128/D010.V10.0
>>>
>>>
>>> 	  My concern here is that these two urls are in, e.g.,
>>> \href{https://doi.org/10.18128/D010.V8.0}{text to display to click to
>>> link to the doi url}.  If it were, e.g.,
>>> \url{https://doi.org/10.18128/D010.V8.0} I would try replacing it with
>>> \doi{10.18128/D010.V8.0}.  However, if I do that, I don't know what to
>>> do with the "text to display to click to link to the doi url".
>>
>> The first of those links to a page with this version of the reference:
>>
>> Steven Ruggles, Sarah Flood, Ronald Goeken, Josiah Grover, Erin Meyer,
>> Jose Pacas, and Matthew Sobek. Integrated Public Use Microdata Series:
>> Version 8.0 [dataset]. Minneapolis: University of Minnesota, 2018.
>> http://doi.org/10.18128/D010.V8.0
>>
>>
>> You'd get a format pretty close to that if you don't try to make the
>> title into a link, just enter it as
>>
>>      Steven Ruggles, Sarah Flood, Ronald Goeken,
>>        Josiah Grover, Erin Meyer, Jose Pacas, and
>>        Matthew Sobek (2018)
>> IPUMS
>>        USA: Version 8.0 [dataset]. Minneapolis, MN:
>>        IPUMS. \doi{10.18128/D010.V8.0}
>>
>> Duncan Murdoch
>


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Mon Jan  3 10:43:45 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Mon, 3 Jan 2022 10:43:45 +0100
Subject: [R-pkg-devel] 
 Error in inDL(x, as.logical(local), as.logical(now),
 ...) unable to load shared object
In-Reply-To: <a891864b-ec31-d8ef-6b62-c1845048bdf2@landtucker.com>
References: <a6607f62-79d0-af0a-be36-8d052157ada4@landtucker.com>
 <34471861-2063-33b7-3605-6ecdff815ea6@gmail.com>
 <25028.35062.869522.630615@rob.eddelbuettel.com>
 <76bab54d-53a6-b181-d2ae-3a485c45c62d@landtucker.com>
 <114a796c-9951-01a5-b6f6-c6e69381ab9f@gmail.com>
 <a891864b-ec31-d8ef-6b62-c1845048bdf2@landtucker.com>
Message-ID: <b4830673-4c60-e160-48e5-a448dea0bf5a@gmail.com>


On 12/27/21 4:04 PM, Ezra Tucker wrote:
> Hi Tomas,
>
>
> Thanks again for all your great info. One last question- and maybe it's
> a stupid one. You mention the JAGS package-- I've been using xml2 as my
> kind-of template. Installing it on linux for example will fail unless
> you have the libxml2-dev package installed (at least for debian-based),
> whereas for windows it just goes and downloads the dll as part of the
> install process. Why would/should this package NOT just perform this
> action for linux as well (namely, automatically download the precompiled
> .so from somewhere else and package it in so you don't need root
> privileges to install the package)? Is this just a difference in install
> philosophy between linux and windows?

Hi Ezra,

Dirk responded in detail re Unix.

On Windows, static libraries (not dynamic) are used by R and are part of 
the toolchain (Rtools42 for R-devel and R 4.2), you just link the 
libraries from there via PKG_LIBS in your Makevars.ucrt or Makevars.win 
file. See for example rgdal for the recommended way how to do this, and 
[1] for a description.

Best
Tomas

[1] https://developer.r-project.org/WindowsBuilds/winutf8/ucrt3/howto.html

>
>
> Thanks again!
>
> -Ezra
>
> On 12/23/21 17:20, Tomas Kalibera wrote:
>> On 12/23/21 4:52 PM, Ezra Tucker wrote:
>>> Hi Tomas and Dirk,
>>>
>>>
>>> Thanks for your suggestions! Between the two, got it working. I didn't
>>> know Windows didn't do rpath, I think that you're right that setting the
>>> PATH would have helped. I haven't seen that in an R package before, so I
>>> did what was in the Rblpapi package, which was creating a couple of
>>> copies of the dll in question.
>> Well it is very exceptional that packages link to an external DLL, only
>> very few CRAN packages do (another example is packages linking to JAGS).
>> I know about these as some of them caused trouble with staged
>> installation and other with the switch to UCRT, they certainly make
>> maintaining and improving R harder. They typically won't work correctly
>> with encodings on Windows. The C++ interface is particularly tricky and
>> fragile. So, one thing is getting this to work in your package you need
>> another question is whether at all it should be published on CRAN, and
>> if that was your plan that'd be best discussed with the CRAN repository
>> maintainers. In some cases there is no other way thank linking to an
>> external DLL, but the question is always whether such package should be
>> on CRAN.
>>> On a related note, in Rblpapi Makevars.win line 47 it's downloading and
>>> extracting the compiled library from GitHub. My understanding is that
>>> one shouldn't include pre-compiled libraries in R packages for security
>>> reasons, at least not for submitting to CRAN. Is doing it this way a
>>> good way around that?
>> No, those concerns apply and are unrelated in principle to using an
>> external DLL. My understanding is that this was also an exception
>> discussed with the CRAN repository maintainers, but I don't know the
>> case specifically.
>>
>> Best
>> Tomas
>>
>>
>>> Thanks again!
>>>
>>> -Ezra
>>>
>>>
>>> On 12/23/21 09:34, Dirk Eddelbuettel wrote:
>>>> On 23 December 2021 at 11:07, Tomas Kalibera wrote:
>>>> | You can have a look at CRAN package Rblpapi which is using an external DLL.
>>>>
>>>> Yes with one big caveat: You have to make sure the library follows what is
>>>> the "hour-glass pattern": it needs to have an internal (the "narrow" part) C
>>>> library covering the wider underlying library and offered via a wider header.
>>>>
>>>> Only C linkage works across different compiler families. You just cannot use
>>>> a Virtual C++-made Windows DLL from R's MinGW g++ compiler with C++.
>>>>
>>>> But you can use C linkage.  So some libraries (such as the Bloomberg API used
>>>> in Rblpapi and the TileDB API used in the tiledb package (when not using a
>>>> local build) can use a library following the hourglass pattern:
>>>>
>>>>      - "wide" bottom layer (may be C++ or C) with the core implementation
>>>>
>>>>      - "narrow" C layer accessing the bottom and priving an API providing via C
>>>>        which profits from C's portable foreign function interface
>>>>
>>>>      - "wide" layer on top via a header-only C++ file accesssing the C and
>>>>        which the C++ compiler optimizes away so that the C API is used for linking
>>>>
>>>> Sounds complicated, but works great.
>>>>
>>>> Good detail is in a hour-long but not-too-technical talk here
>>>>
>>>>      https://www.youtube.com/watch?v=PVYdHDm0q6Y
>>>>
>>>> and slides etc are here
>>>>
>>>>      https://github.com/CppCon/CppCon2014/tree/master/Presentations/Hourglass%20Interfaces%20for%20C%2B%2B%20APIs
>>>>
>>>> Dirk
>>>>
>>>> --
>>>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jan  4 19:28:09 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 4 Jan 2022 12:28:09 -0600
Subject: [R-pkg-devel] doi confusion and Data codoc mismatches--AND THE
 VALUE OF GITHUB
In-Reply-To: <ff6d01c2-63b4-d827-468d-f891d5db09a5@gmail.com>
References: <9e255e07-f32d-c3ad-a677-f2c6190f44db@effectivedefense.org>
 <32fe7d16-cf04-cb2d-6513-047b61d5c5b7@gmail.com>
 <12a47080-a803-45e5-9feb-b501e658ddb0@gmail.com>
 <ff6d01c2-63b4-d827-468d-f891d5db09a5@gmail.com>
Message-ID: <e8acb9ff-52f9-6288-5515-0626ccfe44be@effectivedefense.org>

	  Thanks to Duncan and Kurt for looking into this, recommending a patch 
for my code, and implementing a change to codocData.


VALUE OF GITHUB:  This exchange illustrates the value of GitHub:


	  1.  It made it easier for Duncan to diagnose the problem and 
recommend fixes both to me and to Kurt.


	  2.  I missed this email when it arrived five days after my post but 
found it after noticing a pull request from Duncan on GitHub.  I 
implemented it, and it worked!  Then I checked for a reply to my earlier 
post, and found Duncan's comment below.


	  Spencer


On 1/1/22 1:11 PM, Duncan Murdoch wrote:
> On 26/12/2021 8:03 a.m., Duncan Murdoch wrote:
>> I've now submitted a bug report for R:
>> https://bugs.r-project.org/show_bug.cgi?id=18266 along with a suggested
>> patch to remove the first of these.
> 
> And this patch was committed to the trunk by Kurt Hornik, so it should 
> appear in R 4.2.0 or maybe some 4.1.x release.? Thanks Kurt!
> 
> Duncan Murdoch
> 
>>
>> Duncan Murdoch
>>
>>
>> On 26/12/2021 5:55 a.m., Duncan Murdoch wrote:
>>> On 26/12/2021 12:07 a.m., Spencer Graves wrote:
>>>> Hello, All:
>>>>
>>>>
>>>> ????? The latest checks on
>>>> "https://github.com/sbgraves237/Ecdat/runs/4634725654?check_suite_focus=true" 
>>>>
>>>> identify two problems I don't know how to fix:
>>>>
>>>>
>>>> FIRST:? Data codoc mismatches from documentation object 'USnewspapers':
>>>> ????? Variables in data frame 'USnewspapers'
>>>> ??????? Code: AdsProportion Ads_G2012dollars Ads_currentGdollars
>>>> ????????????? Circ_G2012dollars Circ_currentGdollars GDP_G2012 
>>>> GDP_nominalG
>>>> ????????????? Population_M RevenuePerCap_2012 RevenuePerCap_nominal
>>>> ????????????? Revenue_G2012dollars Revenue_currentGdollars Year
>>>> ????????????? newspapers_p_GDP
>>>> ??????? Docs: Ads_G2012dollars Circ_G2012dollars Circ_currentGdollars
>>>> ????????????? Revenue_G2012dollars Revenue_currentGdollars 
>>>> AdsProportion
>>>> ????????????? Ads_currentGdollars GDP_G2012 GDP_nominalG Population_M
>>>> ????????????? RevenuePerCap_2012 RevenuePerCap_nominal Year 
>>>> newspapers_p_GDP
>>>>
>>>>
>>>> ????? I believe that the column names in the data.frame 'USnewspapers'
>>>> match the names in the order given in the *.Rd file and the variable
>>>> list following "Code" here matches that following "Docs" using, e.g.,
>>>> sort(scan(what=character())).
>>>
>>> You can debug this by running tools::codocData("Ecdat") after the
>>> package is installed.? It appears that some of the names in the docs are
>>> picking up newlines, specifically the ones documented like this:
>>>
>>> \item{Ads_currentGdollars,
>>> ???????????? Ads_G2012dollars,
>>> ???????????? Circ_currentGdollars,
>>> ???????????? Circ_G2012dollars,
>>> ???????????? Revenue_currentGdollars,
>>> ???????????? Revenue_G2012dollars}
>>>
>>> I think that's a bug in codocData.? A workaround is to put those all on
>>> one line.? You don't get a "line too long" warning, because they'll be
>>> reformatted in the display.
>>>
>>>>
>>>>
>>>> SECOND:? Found the following URLs which should use \doi (with the DOI
>>>> name only):
>>>> ??????? File 'AccountantsAuditorsPct.Rd':
>>>> ????????? https://doi.org/10.18128/D010.V8.0
>>>> ??????? File 'OCC1950.Rd':
>>>> ????????? https://doi.org/10.18128/D010.V10.0
>>>>
>>>>
>>>> ????? My concern here is that these two urls are in, e.g.,
>>>> \href{https://doi.org/10.18128/D010.V8.0}{text to display to click to
>>>> link to the doi url}.? If it were, e.g.,
>>>> \url{https://doi.org/10.18128/D010.V8.0} I would try replacing it with
>>>> \doi{10.18128/D010.V8.0}.? However, if I do that, I don't know what to
>>>> do with the "text to display to click to link to the doi url".
>>>
>>> The first of those links to a page with this version of the reference:
>>>
>>> Steven Ruggles, Sarah Flood, Ronald Goeken, Josiah Grover, Erin Meyer,
>>> Jose Pacas, and Matthew Sobek. Integrated Public Use Microdata Series:
>>> Version 8.0 [dataset]. Minneapolis: University of Minnesota, 2018.
>>> http://doi.org/10.18128/D010.V8.0
>>>
>>>
>>> You'd get a format pretty close to that if you don't try to make the
>>> title into a link, just enter it as
>>>
>>> ???? Steven Ruggles, Sarah Flood, Ronald Goeken,
>>> ?????? Josiah Grover, Erin Meyer, Jose Pacas, and
>>> ?????? Matthew Sobek (2018)
>>> IPUMS
>>> ?????? USA: Version 8.0 [dataset]. Minneapolis, MN:
>>> ?????? IPUMS. \doi{10.18128/D010.V8.0}
>>>
>>> Duncan Murdoch
>>
>


From |gor|@|tu| @end|ng |rom gm@||@com  Wed Jan  5 21:15:20 2022
From: |gor|@|tu| @end|ng |rom gm@||@com (Igor L)
Date: Wed, 5 Jan 2022 17:15:20 -0300
Subject: [R-pkg-devel] Possible bug report/false positive
Message-ID: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>

To whom it may concern,
I'm using devtools::check() and trying to upload my package to CRAN (The
code is available in github
<https://github.com/igorlaltuf/dail/blob/main/R/requests.R>), but I'm not
able to understand why the function is showing 1 NOTE:


-- R CMD check results
------------------------------------------------------------------------------------
dail 0.0.0.9000 ----
Duration: 17.9s
> checking R code for possible problems ... NOTE
  Found an obsolete/platform-specific call in the following function:
    'requests'
  Found the platform-specific device:
    'X11'
  dev.new() is the preferred way to open a new device, in the unlikely
  event one is needed.
  requests: no visible binding for global variable 'protocolo'
  Undefined global functions or variables:
    protocolo
0 errors ? | 0 warnings ? | 1 note x


After uploading it to CRAN, I noticed that: (1) this only happens on
debian; and (2) as pointed out in this answer
<https://stackoverflow.com/questions/70585796/unable-to-understand-1-note-in-devtoolscheck-caused-by-a-platform-specific-d>,
the code might be understanding X11 as a function from package::grDevices
<https://github.com/wch/r-source/blob/b1434842427cc01b7e8301495fe0f75ef519ac01/src/library/tools/R/QC.R#L6384-L6391>
.
Does anyone know the reason for this and how to solve it?

Best regards,
*Igor Laltuf Marques*
https://igorlaltuf.github.io/

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Jan  6 15:37:01 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 6 Jan 2022 17:37:01 +0300
Subject: [R-pkg-devel] Possible bug report/false positive
In-Reply-To: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>
References: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>
Message-ID: <20220106173701.45dd00d6@Tarkus>

On Wed, 5 Jan 2022 17:15:20 -0300
Igor L <igorlaltuf at gmail.com> wrote:

>   Found the platform-specific device:
>    'X11'

> how to solve it?

One of the tricks that work (in the sense that calls to functions using
non-standard evaluation don't result in warnings about "Undefined
global functions or variables") is to declare the variables locally,
inside the function:

protocolo <- X1 <- X2 <- ... X21 <- NULL
var <- readr::read_csv2(...) ...

Alternatively, since you know that the file always has 21 columns,
you can pass the variable to `colnames<-` instead of dplyr::rename,
together with a vector of column names you already have in the
nomes.colunas vector. This way, you won't need to declare the 21 dummy
variable.

By the way, you shouldn't declare at least download.file and unzip
functions as global variables. Instead, import them from the utils
package in your NAMESPACE (or using the @importFrom Roxygen tag, if you
use Roxygen).

There are other ways the package code could be improved:

 - There doesn't seem to be a need for the dynamically-named variable
   you create using assign(paste0('pedidos', i), var) and remove soon
   after; you can just use `var` instead of get(paste0('pedidos', i)).
 - If you're worried about leaving temporary variables around, move
   the loop body into a separate function so that anything you don't
   return from it would be cleaned up automatically.
 - You can future-proof your package by creating the URLs with
   paste0('https://dadosabertos-download.cgu.gov.br/FalaBR/Arquivos_FalaBR_Filtrado/Arquivos_csv_',
   year, '.zip') instead of hard-coding their list. It seems likely to
   me that once the 2022 Right to Information Law report is available,
   it'll have a predictable URL. If not, then you'll update the
   package (as you were going to anyway).
 - If you need to iterate over indices in a vector, use for (idx in
   seq_along(vector)) instead of for (i in vector) and match() to
   find the index. Though in this case, the code can be modified to
   avoid the need for the index in the loop body.

-- 
Best regards,
Ivan


From |gor|@|tu| @end|ng |rom gm@||@com  Thu Jan  6 22:56:45 2022
From: |gor|@|tu| @end|ng |rom gm@||@com (Igor L)
Date: Thu, 6 Jan 2022 18:56:45 -0300
Subject: [R-pkg-devel] Possible bug report/false positive
In-Reply-To: <20220106173701.45dd00d6@Tarkus>
References: <CAHGVjrnkv6tR_rm4ZTfU4kX8Ud0DsrB_n3MrndR5w74T=Ahm4A@mail.gmail.com>
 <20220106173701.45dd00d6@Tarkus>
Message-ID: <CAHGVjrnm2hj2bTPKru6rVcCbF_fL_M1wuK8X5zoD+o7jjQEo2Q@mail.gmail.com>

Ivan,
Declaring the variables inside the function solved the problem (protocolo
<- X1 <- X2 <- ... X21 <- NULL).
Thanks for the help and suggestions for improving the code.
Best Regards,
Igor

Em qui., 6 de jan. de 2022 ?s 11:37, Ivan Krylov <krylov.r00t at gmail.com>
escreveu:

> On Wed, 5 Jan 2022 17:15:20 -0300
> Igor L <igorlaltuf at gmail.com> wrote:
>
> >   Found the platform-specific device:
> >    'X11'
>
> > how to solve it?
>
> One of the tricks that work (in the sense that calls to functions using
> non-standard evaluation don't result in warnings about "Undefined
> global functions or variables") is to declare the variables locally,
> inside the function:
>
> protocolo <- X1 <- X2 <- ... X21 <- NULL
> var <- readr::read_csv2(...) ...
>
> Alternatively, since you know that the file always has 21 columns,
> you can pass the variable to `colnames<-` instead of dplyr::rename,
> together with a vector of column names you already have in the
> nomes.colunas vector. This way, you won't need to declare the 21 dummy
> variable.
>
> By the way, you shouldn't declare at least download.file and unzip
> functions as global variables. Instead, import them from the utils
> package in your NAMESPACE (or using the @importFrom Roxygen tag, if you
> use Roxygen).
>
> There are other ways the package code could be improved:
>
>  - There doesn't seem to be a need for the dynamically-named variable
>    you create using assign(paste0('pedidos', i), var) and remove soon
>    after; you can just use `var` instead of get(paste0('pedidos', i)).
>  - If you're worried about leaving temporary variables around, move
>    the loop body into a separate function so that anything you don't
>    return from it would be cleaned up automatically.
>  - You can future-proof your package by creating the URLs with
>    paste0('
> https://dadosabertos-download.cgu.gov.br/FalaBR/Arquivos_FalaBR_Filtrado/Arquivos_csv_
> ',
>    year, '.zip') instead of hard-coding their list. It seems likely to
>    me that once the 2022 Right to Information Law report is available,
>    it'll have a predictable URL. If not, then you'll update the
>    package (as you were going to anyway).
>  - If you need to iterate over indices in a vector, use for (idx in
>    seq_along(vector)) instead of for (i in vector) and match() to
>    find the index. Though in this case, the code can be modified to
>    avoid the need for the index in the loop body.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From r|cc@r| @end|ng |rom hotm@||@|t  Tue Jan 11 18:44:03 2022
From: r|cc@r| @end|ng |rom hotm@||@|t (riccardo)
Date: Tue, 11 Jan 2022 18:44:03 +0100
Subject: [R-pkg-devel] Fix JFM package problem
Message-ID: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>

Hallo,

I wish to submit the following error rising running an example in a rcpp 
function *only *in Debian check:

> ### Name: least_square_plane_rcpp
> ### Title: returns the coefficients of the least square plane and the
> ###   relative medium square error
> ### Aliases: least_square_plane_rcpp
> 
> ### ** Examples
> 
> list_xyz<-matrix(data = c(-10.0, -10.0, -15.0 ,10.0, -10.0,
+  -5.0, -10.0, 10.0, 5.0, 10.0, 10.0 ,15.0)
+ ,nrow = 4,ncol = 3, byrow = TRUE)
> least_square_plane_rcpp(list_xyz)

warning: eig_sym(): given matrix is not symmetric
Error in least_square_plane_rcpp(list_xyz) :
   Mat::operator(): index out of bounds
Execution halted

This error raised also in window OS, but was fixed changing input 
variable in Rcpp::NumericMatrix.

Complete check is at:
https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220111_170553/Debian/00check.log

Every suggestion is welcome.

Thank you in advance

Best Regards

Riccardo

	[[alternative HTML version deleted]]


From em@nue|e@cord@no @end|ng |rom gm@||@com  Fri Jan 14 10:47:22 2022
From: em@nue|e@cord@no @end|ng |rom gm@||@com (Emanuele Cordano)
Date: Fri, 14 Jan 2022 10:47:22 +0100
Subject: [R-pkg-devel] Mac OS X builds and checksf for CRAN
Message-ID: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>

Dear list,

Is this service currently working?

https://mac.r-project.org/macbuilder/submit.html

server returns 504 Gateway Time-out error.
I found out this after trying to using the service because I have to fix
some issues in one of my packages before CRAN submission.

Thank you
Best

Emanuele Cordano
-- 
Emanuele Cordano, PhD
Environmental Engineer / Ingegnere per l' Ambiente e il territorio nr.
3587 (Albo A - Provincia di Trento)
cell: +39 3282818564
email: emanuele.cordano at gmail.com,emanuele.cordano at rendena100.eu,
emanuele.cordano at eurac.edu
PEC: emanuele.cordano at ingpec.eu
URL: www.rendena100.eu
LinkedIn: https://www.linkedin.com/in/emanuele-cordano-31995333
GitHub: https://github.com/ecor

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Jan 14 11:39:08 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 14 Jan 2022 05:39:08 -0500
Subject: [R-pkg-devel] Mac OS X builds and checksf for CRAN
In-Reply-To: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>
References: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>
Message-ID: <934a3152-4f1e-a55e-b14c-e4af87648774@gmail.com>

On 14/01/2022 4:47 a.m., Emanuele Cordano wrote:
> Dear list,
> 
> Is this service currently working?
> 
> https://mac.r-project.org/macbuilder/submit.html
> 
> server returns 504 Gateway Time-out error.
> I found out this after trying to using the service because I have to fix
> some issues in one of my packages before CRAN submission.
> 

It is offline until at least Monday -- there's a message about this on 
the R-sig-mac list.

Duncan Murdoch


From em@nue|e@cord@no @end|ng |rom gm@||@com  Fri Jan 14 12:06:18 2022
From: em@nue|e@cord@no @end|ng |rom gm@||@com (Emanuele Cordano)
Date: Fri, 14 Jan 2022 12:06:18 +0100
Subject: [R-pkg-devel] Mac OS X builds and checksf for CRAN
In-Reply-To: <934a3152-4f1e-a55e-b14c-e4af87648774@gmail.com>
References: <CAKw81f_ODF7L4fye4OK5PS-Aza9NEK7Y7Uouo-o+w1sFLsik9g@mail.gmail.com>
 <934a3152-4f1e-a55e-b14c-e4af87648774@gmail.com>
Message-ID: <CAKw81f8mmBDekMK5yhdtSbsVQfs9X2nP9tKaNMPFizsBidt64g@mail.gmail.com>

Thank you
best
Emanuele Cordano

Il giorno ven 14 gen 2022 alle ore 11:39 Duncan Murdoch <
murdoch.duncan at gmail.com> ha scritto:

> On 14/01/2022 4:47 a.m., Emanuele Cordano wrote:
> > Dear list,
> >
> > Is this service currently working?
> >
> > https://mac.r-project.org/macbuilder/submit.html
> >
> > server returns 504 Gateway Time-out error.
> > I found out this after trying to using the service because I have to fix
> > some issues in one of my packages before CRAN submission.
> >
>
> It is offline until at least Monday -- there's a message about this on
> the R-sig-mac list.
>
> Duncan Murdoch
>


-- 
Emanuele Cordano, PhD
Environmental Engineer / Ingegnere per l' Ambiente e il territorio nr.
3587 (Albo A - Provincia di Trento)
cell: +39 3282818564
email: emanuele.cordano at gmail.com,emanuele.cordano at rendena100.eu,
emanuele.cordano at eurac.edu
PEC: emanuele.cordano at ingpec.eu
URL: www.rendena100.eu
LinkedIn: https://www.linkedin.com/in/emanuele-cordano-31995333
GitHub: https://github.com/ecor

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Fri Jan 14 14:22:47 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 14 Jan 2022 07:22:47 -0600
Subject: [R-pkg-devel] Fix JFM package problem
In-Reply-To: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
References: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
Message-ID: <25057.31015.865393.985033@rob.eddelbuettel.com>


On 11 January 2022 at 18:44, riccardo wrote:
| Hallo,
| 
| I wish to submit the following error rising running an example in a rcpp 
| function *only *in Debian check:
| 
| > ### Name: least_square_plane_rcpp
| > ### Title: returns the coefficients of the least square plane and the
| > ###   relative medium square error
| > ### Aliases: least_square_plane_rcpp
| > 
| > ### ** Examples
| > 
| > list_xyz<-matrix(data = c(-10.0, -10.0, -15.0 ,10.0, -10.0,
| +  -5.0, -10.0, 10.0, 5.0, 10.0, 10.0 ,15.0)
| + ,nrow = 4,ncol = 3, byrow = TRUE)
| > least_square_plane_rcpp(list_xyz)
| 
| warning: eig_sym(): given matrix is not symmetric
| Error in least_square_plane_rcpp(list_xyz) :
|    Mat::operator(): index out of bounds
| Execution halted
| 
| This error raised also in window OS, but was fixed changing input 
| variable in Rcpp::NumericMatrix.
| 
| Complete check is at:
| https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220111_170553/Debian/00check.log
| 
| Every suggestion is welcome.

This is a general packaging list; Rcpp has a dedicated list. Could you please
there, or if you cannot, on StackOverflow, or post a GitHub issue?

There are some decent tutorials out here about how to post a _minimally
verifiable complete example_, see eg
   https://stackoverflow.com/help/minimal-reproducible-example
This post would not allow to do any meaningful investigation yet.

Thanks in advance for your help,  Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From r@m@krug @end|ng |rom gm@||@com  Fri Jan 14 15:14:11 2022
From: r@m@krug @end|ng |rom gm@||@com (Rainer M Krug)
Date: Fri, 14 Jan 2022 06:14:11 -0800
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
Message-ID: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>

Hi

I want to re-submit an archived package to CRAN, and I get, when checking
on hub builder, the following Note:

* checking for detritus in the temp directory ... NOTE
Found the following files/directories:
  'lastMiKTeXException'


See
https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159


Any suggestions how this can be fixed?

Thanks.

I also get from the following,

* checking for non-standard things in the check directory ... NOTE
Found the following files/directories:
  ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
  ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
  ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
  ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
  ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
  ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
  ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
  ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
  ?wikitaxa? ?worrms? ?zoo?


(
https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
)
but I assume that is not relevant.
?

Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology,
UCT), Dipl. Phys. (Germany)

Orcid ID: 0000-0002-7490-0066

Department of Evolutionary Biology and Environmental Studies
University of Z?rich
Office Y34-J-74
Winterthurerstrasse 190
8075 Z?rich
Switzerland

Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Orcid ID: 0000-0002-7490-0066

Department of Evolutionary Biology and Environmental Studies
University of Z?rich
Office Y34-J-74
Winterthurerstrasse 190
8075 Z?rich
Switzerland

Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich
Office Y34-J-74
Winterthurerstrasse 190
8075 Z?rich
Switzerland

Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


Office: +41 (0)44 635 47 64
Cell:        +41 (0)78 630 66 57
email:      Rainer.Krug at uzh.ch
Rainer at krugs.de
Skype:     RMkrug

PGP: 0x0F52F982



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich





Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Ke


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Keug@


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Keug at gmail.


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Keug at gmail.com


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com



Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com




Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com


---

Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Sat Jan 15 00:40:00 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Sat, 15 Jan 2022 00:40:00 +0100
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
In-Reply-To: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
References: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
Message-ID: <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>



On 14.01.2022 15:14, Rainer M Krug wrote:
> Hi
> 
> I want to re-submit an archived package to CRAN, and I get, when checking
> on hub builder, the following Note:
> 
> * checking for detritus in the temp directory ... NOTE
> Found the following files/directories:
>    'lastMiKTeXException'

If it is not part of your package it may be related due to failing 
MikTeX when building, e.g., the manual or vignettes?
If hat worked otherwise I'd ignore it unless it also happens on CRAN.

Best,
Uwe Ligges

> 
> 
> See
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159
> 
> 
> Any suggestions how this can be fixed?
> 
> Thanks.
> 
> I also get from the following,
> 
> * checking for non-standard things in the check directory ... NOTE
> Found the following files/directories:
>    ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
>    ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
>    ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
>    ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
>    ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
>    ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
>    ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
>    ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
>    ?wikitaxa? ?worrms? ?zoo?
> 
> 
> (
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
> )
> but I assume that is not relevant.
> ?
> 
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology,
> UCT), Dipl. Phys. (Germany)
> 
> Orcid ID: 0000-0002-7490-0066
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> Office Y34-J-74
> Winterthurerstrasse 190
> 8075 Z?rich
> Switzerland
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Orcid ID: 0000-0002-7490-0066
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> Office Y34-J-74
> Winterthurerstrasse 190
> 8075 Z?rich
> Switzerland
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> Office Y34-J-74
> Winterthurerstrasse 190
> 8075 Z?rich
> Switzerland
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> Office: +41 (0)44 635 47 64
> Cell:        +41 (0)78 630 66 57
> email:      Rainer.Krug at uzh.ch
> Rainer at krugs.de
> Skype:     RMkrug
> 
> PGP: 0x0F52F982
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Ke
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Keug@
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Keug at gmail.
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Keug at gmail.com
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 
> 
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 
> ---
> 
> Rainer M. Krug
> 
> Department of Evolutionary Biology and Environmental Studies
> University of Z?rich
> 
> 
> R.M.Krug at gmail.com
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@m@krug @end|ng |rom gm@||@com  Sun Jan 16 13:12:25 2022
From: r@m@krug @end|ng |rom gm@||@com (Rainer M Krug)
Date: Sun, 16 Jan 2022 04:12:25 -0800
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
In-Reply-To: <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>
References: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
 <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>
Message-ID: <CAGhLh6HjNHC0GoEqGpr2ifYzMG8-8Uxog-vEhybDfbfQ2otNyQ@mail.gmail.com>

Thanks Uwe,

I?ll try submission to CRAN beginning of next week.

Rainer



On 15 Jan 2022 at 00:40:00, Uwe Ligges <ligges at statistik.tu-dortmund.de>
wrote:

>
>
> On 14.01.2022 15:14, Rainer M Krug wrote:
>
> Hi
>
>
> I want to re-submit an archived package to CRAN, and I get, when checking
>
> on hub builder, the following Note:
>
>
> * checking for detritus in the temp directory ... NOTE
>
> Found the following files/directories:
>
>    'lastMiKTeXException'
>
>
> If it is not part of your package it may be related due to failing
> MikTeX when building, e.g., the manual or vignettes?
> If hat worked otherwise I'd ignore it unless it also happens on CRAN.
>
> Best,
> Uwe Ligges
>
>
>
> See
>
>
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159
>
>
>
> Any suggestions how this can be fixed?
>
>
> Thanks.
>
>
> I also get from the following,
>
>
> * checking for non-standard things in the check directory ... NOTE
>
> Found the following files/directories:
>
>    ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
>
>    ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
>
>    ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
>
>    ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
>
>    ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
>
>    ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
>
>    ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
>
>    ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
>
>    ?wikitaxa? ?worrms? ?zoo?
>
>
>
> (
>
>
> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
>
> )
>
> but I assume that is not relevant.
>
> ?
>
>
> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation Biology,
>
> UCT), Dipl. Phys. (Germany)
>
>
> Orcid ID: 0000-0002-7490-0066
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
> Office Y34-J-74
>
> Winterthurerstrasse 190
>
> 8075 Z?rich
>
> Switzerland
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Orcid ID: 0000-0002-7490-0066
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
> Office Y34-J-74
>
> Winterthurerstrasse 190
>
> 8075 Z?rich
>
> Switzerland
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
> Office Y34-J-74
>
> Winterthurerstrasse 190
>
> 8075 Z?rich
>
> Switzerland
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> Office: +41 (0)44 635 47 64
>
> Cell:        +41 (0)78 630 66 57
>
> email:      Rainer.Krug at uzh.ch
>
> Rainer at krugs.de
>
> Skype:     RMkrug
>
>
> PGP: 0x0F52F982
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Ke
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Keug@
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Keug at gmail.
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Keug at gmail.com
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
>
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
>
> ---
>
>
> Rainer M. Krug
>
>
> Department of Evolutionary Biology and Environmental Studies
>
> University of Z?rich
>
>
>
> R.M.Krug at gmail.com
>
>
> [[alternative HTML version deleted]]
>
>
> ______________________________________________
>
> R-package-devel at r-project.org mailing list
>
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r  Mon Jan 17 16:06:40 2022
From: @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r (=?UTF-8?Q?Aur=c3=a9lie_Siberchicot?=)
Date: Mon, 17 Jan 2022 16:06:40 +0100
Subject: [R-pkg-devel] package with datasets requiring sp
Message-ID: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>

Hi,

I maintain the 'ade4' package which contains data with S4 objects from 
the package 'sp'.
Some functions of the 'sp' package are also used in examples in some Rd 
files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {} --).
In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports' 
according to an email received from Brian Ripley, because "At least one 
of the datasets cannot be loaded without a package declared in Suggests: 
-- typically this is because it loads a namespace defining S4 classes, 
and such imports should be declared in Imports or (as Matrix does) use a 
.R wrapper."

For a few months, I have had the following NOTE:
* checking dependencies in R code ... NOTE
Namespace in Imports field not imported from: ?sp?
All declared Imports should be used.

In 'Writing R Extensions', I found: "Packages needed to use datasets 
from the package should be in ?Imports?: this includes those needed to 
define S4 classes used."

Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary 
to the recommendations of 'Writing R Extensions' and Brian Ripley.
I'm a bit confused to solve this note and the best way to declare the 
dependency of 'ade4' to 'sp'.
Is anyone in my situation? Does anyone have any advice?

Thanks in advande for any help.
Cheers.
Aur?lie.





-- 
Aur?lie SIBERCHICOT
Ing?nieure en Ing?nierie Logicielle
04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr

Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
Universit? Claude Bernard - Lyon 1
B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
69622 Villeurbanne cedex


	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Mon Jan 17 17:24:34 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Mon, 17 Jan 2022 11:24:34 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
Message-ID: <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>

If a package is declared in Imports, it means that there must be some kind
of import expression in the NAMESPACE file. For example:

import(sp) # imports the whole sp package, probably NOT what you want
importFrom(sp, Polygon)  # import object Polygon from sp namespace

Theoretically, your import statement could import any of the sp namespace
objects, but it probably makes far more sense to import the datasets from
sp that you're using

On Mon, Jan 17, 2022, 11:11 Aur?lie Siberchicot <
aurelie.siberchicot at univ-lyon1.fr> wrote:

> Hi,
>
> I maintain the 'ade4' package which contains data with S4 objects from
> the package 'sp'.
> Some functions of the 'sp' package are also used in examples in some Rd
> files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {} --).
> In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports'
> according to an email received from Brian Ripley, because "At least one
> of the datasets cannot be loaded without a package declared in Suggests:
> -- typically this is because it loads a namespace defining S4 classes,
> and such imports should be declared in Imports or (as Matrix does) use a
> .R wrapper."
>
> For a few months, I have had the following NOTE:
> * checking dependencies in R code ... NOTE
> Namespace in Imports field not imported from: ?sp?
> All declared Imports should be used.
>
> In 'Writing R Extensions', I found: "Packages needed to use datasets
> from the package should be in ?Imports?: this includes those needed to
> define S4 classes used."
>
> Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary
> to the recommendations of 'Writing R Extensions' and Brian Ripley.
> I'm a bit confused to solve this note and the best way to declare the
> dependency of 'ade4' to 'sp'.
> Is anyone in my situation? Does anyone have any advice?
>
> Thanks in advande for any help.
> Cheers.
> Aur?lie.
>
>
>
>
>
> --
> Aur?lie SIBERCHICOT
> Ing?nieure en Ing?nierie Logicielle
> 04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>
> Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
> Universit? Claude Bernard - Lyon 1
> B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
> 69622 Villeurbanne cedex
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Jan 17 19:17:19 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 17 Jan 2022 13:17:19 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
Message-ID: <2e2885d5-a6f6-7a10-0cef-ff046c4f2a6e@gmail.com>

On 17/01/2022 10:06 a.m., Aur?lie Siberchicot wrote:
> Hi,
> 
> I maintain the 'ade4' package which contains data with S4 objects from
> the package 'sp'.
> Some functions of the 'sp' package are also used in examples in some Rd
> files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {} --).
> In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports'
> according to an email received from Brian Ripley, because "At least one
> of the datasets cannot be loaded without a package declared in Suggests:
> -- typically this is because it loads a namespace defining S4 classes,
> and such imports should be declared in Imports or (as Matrix does) use a
> .R wrapper."
> 
> For a few months, I have had the following NOTE:
> * checking dependencies in R code ... NOTE
> Namespace in Imports field not imported from: ?sp?
> All declared Imports should be used.
> 
> In 'Writing R Extensions', I found: "Packages needed to use datasets
> from the package should be in ?Imports?: this includes those needed to
> define S4 classes used."
> 
> Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary
> to the recommendations of 'Writing R Extensions' and Brian Ripley.
> I'm a bit confused to solve this note and the best way to declare the
> dependency of 'ade4' to 'sp'.
> Is anyone in my situation? Does anyone have any advice?

I think the easiest is to follow Prof Ripley's second suggestion:  "use 
a .R wrapper".  To do this, you don't put the .rda file in the data 
directory, you put it somewhere else.  Matrix uses inst/external.  In 
your data directory, you put a small script.

For example, if the object name is foo, you might have the saved object 
in inst/external/foo.rda, and in the data directory a script foo.R that 
looks something like this:

   if (!requireNamespace("sp")) stop("The sp package is required for foo.")

   foo <- readRDS(system.file("external/foo.rda", package = "ade4"))

Duncan Murdoch


From @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r  Tue Jan 18 10:03:09 2022
From: @ure||e@@|berch|cot @end|ng |rom un|v-|yon1@|r (=?UTF-8?Q?Aur=c3=a9lie_Siberchicot?=)
Date: Tue, 18 Jan 2022 10:03:09 +0100
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
Message-ID: <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>

Thank you Andrew !
I think I didn't explain my context correctly.
I'm not importing datasets from 'sp'. I have datasets that are built 
from S4 objects of sp.
In pratical terms, I don't import anything from 'sp' but I need 'sp' for 
my datasets to exist.

Cheers.
Aur?lie.


Le 17/01/2022 ? 17:24, Andrew Simmons a ?crit?:
> If a package is declared in Imports, it means that there must be some 
> kind of import expression in the NAMESPACE file. For example:
>
> import(sp) # imports the whole sp package, probably NOT what you want
> importFrom(sp, Polygon)? # import object Polygon from sp namespace
>
> Theoretically, your import statement could import any of the sp 
> namespace objects, but it probably makes far more sense to import the 
> datasets from sp that you're using
>
> On Mon, Jan 17, 2022, 11:11 Aur?lie Siberchicot 
> <aurelie.siberchicot at univ-lyon1.fr 
> <mailto:aurelie.siberchicot at univ-lyon1.fr>> wrote:
>
>     Hi,
>
>     I maintain the 'ade4' package which contains data with S4 objects
>     from
>     the package 'sp'.
>     Some functions of the 'sp' package are also used in examples in
>     some Rd
>     files (using the code -- if(requireNamespace("sp", quietly =
>     TRUE)) {} --).
>     In February 2020, I moved the 'sp' package from 'Suggests' to
>     'Imports'
>     according to an email received from Brian Ripley, because "At
>     least one
>     of the datasets cannot be loaded without a package declared in
>     Suggests:
>     -- typically this is because it loads a namespace defining S4
>     classes,
>     and such imports should be declared in Imports or (as Matrix does)
>     use a
>     .R wrapper."
>
>     For a few months, I have had the following NOTE:
>     * checking dependencies in R code ... NOTE
>     Namespace in Imports field not imported from: ?sp?
>     All declared Imports should be used.
>
>     In 'Writing R Extensions', I found: "Packages needed to use datasets
>     from the package should be in ?Imports?: this includes those
>     needed to
>     define S4 classes used."
>
>     Moving back 'sp' in 'Suggests' seems to solves the NOTE but is
>     contrary
>     to the recommendations of 'Writing R Extensions' and Brian Ripley.
>     I'm a bit confused to solve this note and the best way to declare the
>     dependency of 'ade4' to 'sp'.
>     Is anyone in my situation? Does anyone have any advice?
>
>     Thanks in advande for any help.
>     Cheers.
>     Aur?lie.
>
>
>
>
>
>     -- 
>     Aur?lie SIBERCHICOT
>     Ing?nieure en Ing?nierie Logicielle
>     04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>     <mailto:aurelie.siberchicot at univ-lyon1.fr>
>
>     Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
>     Universit? Claude Bernard - Lyon 1
>     B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
>     69622 Villeurbanne cedex
>
>
>     ? ? ? ? [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>

-- 
Aur?lie SIBERCHICOT
Ing?nieure en Ing?nierie Logicielle
04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr

Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
Universit? Claude Bernard - Lyon 1
B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
69622 Villeurbanne cedex


	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Tue Jan 18 23:02:31 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Wed, 19 Jan 2022 11:02:31 +1300
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
 <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
Message-ID: <20220119110231.16e8bc8a@rolf-Latitude-E7470>

On Tue, 18 Jan 2022 10:03:09 +0100
Aur?lie Siberchicot <aurelie.siberchicot at univ-lyon1.fr> wrote:

> Thank you Andrew !
> I think I didn't explain my context correctly.
> I'm not importing datasets from 'sp'. I have datasets that are built 
> from S4 objects of sp.
> In pratical terms, I don't import anything from 'sp' but I need 'sp'
> for my datasets to exist.

I'm probably misunderstanding/missing the point --- but it seems to me
that the obvious procedure would be to obtain the necessary objects
from sp, build your data sets, put them into the data directory of your
package, and then make no further reference to sp (other than perhaps
duly acknowledging the provenance of your data sets in the help files
that you write for them).

If my comment is totally out to lunch, please ignore it.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Jan 19 11:34:38 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 19 Jan 2022 05:34:38 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <20220119110231.16e8bc8a@rolf-Latitude-E7470>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
 <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
 <20220119110231.16e8bc8a@rolf-Latitude-E7470>
Message-ID: <a4df1cfd-a80b-3f16-9cd9-40c23f9f7fcc@gmail.com>

On 18/01/2022 5:02 p.m., Rolf Turner wrote:
> On Tue, 18 Jan 2022 10:03:09 +0100
> Aur?lie Siberchicot <aurelie.siberchicot at univ-lyon1.fr> wrote:
> 
>> Thank you Andrew !
>> I think I didn't explain my context correctly.
>> I'm not importing datasets from 'sp'. I have datasets that are built
>> from S4 objects of sp.
>> In pratical terms, I don't import anything from 'sp' but I need 'sp'
>> for my datasets to exist.
> 
> I'm probably misunderstanding/missing the point --- but it seems to me
> that the obvious procedure would be to obtain the necessary objects
> from sp, build your data sets, put them into the data directory of your
> package, and then make no further reference to sp (other than perhaps
> duly acknowledging the provenance of your data sets in the help files
> that you write for them).
> 
> If my comment is totally out to lunch, please ignore it.

The issue is that the data sets are S4 objects whose class definition is 
in sp.  You can't load such an object without having the class 
definition available.  Copying the class definition to another package 
would not be a reasonable solution.

R's check code doesn't recognize that using a class from another package 
is a hard reference to the other package, and it complains if sp is 
listed in the Imports list.

Really it should be equivalent to having a package in the Imports list, 
with all imports done using :: at runtime.  Then ade4 couldn't be 
installed without having sp present, and loading the data could trigger 
a namespace load of sp.  But that logic isn't in place.

The solution given by Prof. Ripley allows a workaround:  list sp in 
Suggests, and have a script that checks for sp before trying to load the 
data.  This is fine if loading that dataset is optional, with most users 
not needing it.  However, if it happens to be a dataset that most users 
will need to load, it's not good:  most users will need sp, and it 
should be a hard dependency for the package.

Duncan Murdoch


From @kw@|mmo @end|ng |rom gm@||@com  Wed Jan 19 16:50:11 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Wed, 19 Jan 2022 10:50:11 -0500
Subject: [R-pkg-devel] package with datasets requiring sp
In-Reply-To: <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
References: <386872d6-493a-9e7a-0945-cec2cdfe41df@univ-lyon1.fr>
 <CAPcHnpQJvgV5mjPiDYRDF=uaXd+gBrrzq_EA=RH_z84rPfJQWA@mail.gmail.com>
 <947d32f8-46c0-75ed-08e7-c071e0b1770e@univ-lyon1.fr>
Message-ID: <CAPcHnpShVv1ExTz6K3O=PPJu+T2p7EGb+4XUirhpJfZmZPLm=Q@mail.gmail.com>

It seems like I did misunderstand. What I'd suggest instead is adding:

importClassesFrom(sp, ...)
importMethodsFrom(sp, ...)

in your NAMESPACE file, and then put the class names and method names that
you need. This is (probably) the best solution; it imports only the things
you absolutely need from sp, while making sp a hard dependency (your
package namespace cannot by load without the sp namespace also loaded).

On Tue, Jan 18, 2022, 04:03 Aur?lie Siberchicot <
aurelie.siberchicot at univ-lyon1.fr> wrote:

> Thank you Andrew !
> I think I didn't explain my context correctly.
> I'm not importing datasets from 'sp'. I have datasets that are built from
> S4 objects of sp.
> In pratical terms, I don't import anything from 'sp' but I need 'sp' for
> my datasets to exist.
>
> Cheers.
> Aur?lie.
>
>
> Le 17/01/2022 ? 17:24, Andrew Simmons a ?crit :
>
> If a package is declared in Imports, it means that there must be some kind
> of import expression in the NAMESPACE file. For example:
>
> import(sp) # imports the whole sp package, probably NOT what you want
> importFrom(sp, Polygon)  # import object Polygon from sp namespace
>
> Theoretically, your import statement could import any of the sp namespace
> objects, but it probably makes far more sense to import the datasets from
> sp that you're using
>
> On Mon, Jan 17, 2022, 11:11 Aur?lie Siberchicot <
> aurelie.siberchicot at univ-lyon1.fr> wrote:
>
>> Hi,
>>
>> I maintain the 'ade4' package which contains data with S4 objects from
>> the package 'sp'.
>> Some functions of the 'sp' package are also used in examples in some Rd
>> files (using the code -- if(requireNamespace("sp", quietly = TRUE)) {}
>> --).
>> In February 2020, I moved the 'sp' package from 'Suggests' to 'Imports'
>> according to an email received from Brian Ripley, because "At least one
>> of the datasets cannot be loaded without a package declared in Suggests:
>> -- typically this is because it loads a namespace defining S4 classes,
>> and such imports should be declared in Imports or (as Matrix does) use a
>> .R wrapper."
>>
>> For a few months, I have had the following NOTE:
>> * checking dependencies in R code ... NOTE
>> Namespace in Imports field not imported from: ?sp?
>> All declared Imports should be used.
>>
>> In 'Writing R Extensions', I found: "Packages needed to use datasets
>> from the package should be in ?Imports?: this includes those needed to
>> define S4 classes used."
>>
>> Moving back 'sp' in 'Suggests' seems to solves the NOTE but is contrary
>> to the recommendations of 'Writing R Extensions' and Brian Ripley.
>> I'm a bit confused to solve this note and the best way to declare the
>> dependency of 'ade4' to 'sp'.
>> Is anyone in my situation? Does anyone have any advice?
>>
>> Thanks in advande for any help.
>> Cheers.
>> Aur?lie.
>>
>>
>>
>>
>>
>> --
>> Aur?lie SIBERCHICOT
>> Ing?nieure en Ing?nierie Logicielle
>> 04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>>
>> Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
>> Universit? Claude Bernard - Lyon 1
>> B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
>> 69622 Villeurbanne cedex
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
> --
> Aur?lie SIBERCHICOT
> Ing?nieure en Ing?nierie Logicielle
> 04 72 44 85 98 - aurelie.siberchicot at univ-lyon1.fr
>
> Laboratoire Biom?trie et Biologie Evolutive - UMR CNRS 5558
> Universit? Claude Bernard - Lyon 1
> B?timent Gr?gor Mendel, 43 boulevard du 11 novembre 1918
> 69622 Villeurbanne cedex
>
>
>

	[[alternative HTML version deleted]]


From Ke|th@Go|d|e|d @end|ng |rom nyu|@ngone@org  Wed Jan 19 22:37:49 2022
From: Ke|th@Go|d|e|d @end|ng |rom nyu|@ngone@org (Goldfeld, Keith)
Date: Wed, 19 Jan 2022 21:37:49 +0000
Subject: [R-pkg-devel] PREPERROR on Debian Linux, R-devel
Message-ID: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>

Good afternoon/evening ?



I maintain the R package ?simstudy? (https://cran.r-project.org/web/packages/simstudy/index.html) and recently made a few bug fixes and simple enhancements. I am preparing to submit a new version 0.4.0 to CRAN. In doing the rhub checks (rhub::check_for_cran()), I received a curious PREPERROR from ?Debian Linux, R-Devel, GCC ASAN/UBSAN?. I am wondering if this is something on my end that I can and should fix, or if it is something that is out of my hands.



Thanks so much.



-          Keith



------------------------------------------------------------
This email message, including any attachments, is for the sole use of the intended recipient(s) and may contain information that is proprietary, confidential, and exempt from disclosure under applicable law. Any unauthorized review, use, disclosure, or distribution is prohibited. If you have received this email in error please notify the sender by return email and delete the original message. Please note, the recipient should check this email and any attachments for the presence of viruses. The organization accepts no liability for any damage caused by any virus transmitted by this email.
=================================

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu Jan 20 09:44:39 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 20 Jan 2022 09:44:39 +0100
Subject: [R-pkg-devel] PREPERROR on Debian Linux, R-devel
In-Reply-To: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
References: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
Message-ID: <e1c47bb4-b916-def3-854d-1693036c7482@statistik.tu-dortmund.de>



On 19.01.2022 22:37, Goldfeld, Keith via R-package-devel wrote:
> Good afternoon/evening ?
> 
> 
> 
> I maintain the R package ?simstudy? (https://cran.r-project.org/web/packages/simstudy/index.html) and recently made a few bug fixes and simple enhancements. I am preparing to submit a new version 0.4.0 to CRAN. In doing the rhub checks (rhub::check_for_cran()), I received a curious PREPERROR from ?Debian Linux, R-Devel, GCC ASAN/UBSAN?. I am wondering if this is something on my end that I can and should fix, or if it is something that is out of my hands.


Perhaps people can answer your querstion if you provide full logs.

Best,
Uwe Ligges



> 
> 
> Thanks so much.
> 
> 
> 
> -          Keith
> 
> 
> 
> ------------------------------------------------------------
> This email message, including any attachments, is for the sole use of the intended recipient(s) and may contain information that is proprietary, confidential, and exempt from disclosure under applicable law. Any unauthorized review, use, disclosure, or distribution is prohibited. If you have received this email in error please notify the sender by return email and delete the original message. Please note, the recipient should check this email and any attachments for the presence of viruses. The organization accepts no liability for any damage caused by any virus transmitted by this email.
> =================================
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Thu Jan 20 14:05:04 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 20 Jan 2022 07:05:04 -0600
Subject: [R-pkg-devel] PREPERROR on Debian Linux, R-devel
In-Reply-To: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
References: <B2C2A029-0CA9-4CC5-B21C-D3FF22BC278D@contoso.com>
Message-ID: <25065.24064.272686.642975@rob.eddelbuettel.com>


On 19 January 2022 at 21:37, Goldfeld, Keith via R-package-devel wrote:
| In doing the rhub checks (rhub::check_for_cran()), I received a curious PREPERROR from ?Debian Linux, R-Devel, GCC ASAN/UBSAN?. I am wondering if this is something on my end that I can and should fix, or if it is something that is out of my hands.

I suggest "out of your hands" as I also often run there too (as the platform
is included in a 'wrapper' function in the rhub package) and always get that
PREPERROR. The logs often show OK but under ASAN/UBSAN something seems to
propagate the wrong way leading to an overall 'error'.  <man_shrugging_emoji_here>

I would just move on and ignore it. It seems like a long-lasting 'bug' but on
balance it is more valuable to actually have a ASAN/UBSAN instance than not.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From r@m@krug @end|ng |rom gm@||@com  Thu Jan 20 20:29:20 2022
From: r@m@krug @end|ng |rom gm@||@com (Rainer M Krug)
Date: Thu, 20 Jan 2022 14:29:20 -0500
Subject: [R-pkg-devel] Detritus reported by r-hub builder check_for_cran
In-Reply-To: <CAGhLh6HjNHC0GoEqGpr2ifYzMG8-8Uxog-vEhybDfbfQ2otNyQ@mail.gmail.com>
References: <CAGhLh6HAeEHz3a1XQLMPc-MFV6TZ3CrYB8CeyL6WBgWn5ARGSg@mail.gmail.com>
 <b98a5fba-7e21-4305-cc3c-f3243faa9ea5@statistik.tu-dortmund.de>
 <CAGhLh6HjNHC0GoEqGpr2ifYzMG8-8Uxog-vEhybDfbfQ2otNyQ@mail.gmail.com>
Message-ID: <CAGhLh6FfPp5=zLroVPA4+QtPgG6J37PEQTQALDw_DxwboU5mRg@mail.gmail.com>

OK - I resubmitted, and got the following response:

###############
Dear maintainer,

package dmdScheme_1.2.8.tar.gz does not pass the incoming checks
automatically, please see the following pre-tests:
Windows: <
https://win-builder.r-project.org/incoming_pretest/dmdScheme_1.2.8_20220120_195907/Windows/00check.log
>
Status: 1 NOTE
Debian: <
https://win-builder.r-project.org/incoming_pretest/dmdScheme_1.2.8_20220120_195907/Debian/00check.log
>
Status: 2 NOTEs



Please fix all problems and resubmit a fixed version via the webform.
If you are not sure how to fix the problems shown, please ask for help on
the R-package-devel mailing list:
<https://stat.ethz.ch/mailman/listinfo/r-package-devel>
If you are fairly certain the rejection is a false positive, please
reply-all to this message and explain.

More details are given in the directory:
<
https://win-builder.r-project.org/incoming_pretest/dmdScheme_1.2.8_20220120_195907/
>
The files will be removed after roughly 7 days.

No strong reverse dependencies to be checked.

Best regards,
CRAN teams' auto-check service
Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: CRAN incoming feasibility, Result: NOTE
 Maintainer: 'Rainer M. Krug <Rainer.Krug at uzh.ch>'

 New submission

 Package was archived on CRAN

 Possibly misspelled words in DESCRIPTION:
   Krug (5:41)
   MetaData (2:24)
   Petchey (5:55)

 CRAN repository db overrides:
   X-CRAN-Comment: Archived on 2021-09-06 as check problems were not
     corrected in time.

Flavor: r-devel-linux-x86_64-debian-gcc
Check: for non-standard things in the check directory, Result: NOTE
 Found the following files/directories:
   ?emeScheme'

###############

So that brings me back to square zero. Not reproducible anywhere, only on
Debian on CRAN.

Do you have any suggestions on how I can proceed?

Thanks,

Rainer

---


Rainer M. Krug

Department of Evolutionary Biology and Environmental Studies
University of Z?rich


R.M.Krug at gmail.com



On 16 Jan 2022 at 13:12:25, Rainer M Krug <r.m.krug at gmail.com> wrote:

> Thanks Uwe,
>
> I?ll try submission to CRAN beginning of next week.
>
> Rainer
>
>
>
> On 15 Jan 2022 at 00:40:00, Uwe Ligges <ligges at statistik.tu-dortmund.de>
> wrote:
>
>>
>>
>> On 14.01.2022 15:14, Rainer M Krug wrote:
>>
>> Hi
>>
>>
>> I want to re-submit an archived package to CRAN, and I get, when checking
>>
>> on hub builder, the following Note:
>>
>>
>> * checking for detritus in the temp directory ... NOTE
>>
>> Found the following files/directories:
>>
>>    'lastMiKTeXException'
>>
>>
>> If it is not part of your package it may be related due to failing
>> MikTeX when building, e.g., the manual or vignettes?
>> If hat worked otherwise I'd ignore it unless it also happens on CRAN.
>>
>> Best,
>> Uwe Ligges
>>
>>
>>
>> See
>>
>>
>> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-b5319e2e45f14b43b997198525243159
>>
>>
>>
>> Any suggestions how this can be fixed?
>>
>>
>> Thanks.
>>
>>
>> I also get from the following,
>>
>>
>> * checking for non-standard things in the check directory ... NOTE
>>
>> Found the following files/directories:
>>
>>    ?Formula? ?Hmisc? ?WikidataQueryServiceR? ?WikidataR? ?WikipediR?
>>
>>    ?XML? ?ape? ?assertthat? ?backports? ?bit? ?bit64? ?bold? ?checkmate?
>>
>>    ?clipr? ?conditionz? ?crul? ?data.table? ?emeScheme? ?fastmatch?
>>
>>    ?foreach? ?ggplot2? ?gridExtra? ?gtable? ?htmlTable? ?htmlwidgets?
>>
>>    ?httpcode? ?igraph? ?isoband? ?iterators? ?jpeg? ?latticeExtra?
>>
>>    ?natserv? ?pbapply? ?phangorn? ?plyr? ?png? ?quadprog? ?ratelimitr?
>>
>>    ?readr? ?rentrez? ?reshape? ?ritis? ?rncl? ?rotl? ?rredlist?
>>
>>    ?solrium? ?taxize? ?triebeard? ?tzdb? ?urltools? ?viridis? ?vroom?
>>
>>    ?wikitaxa? ?worrms? ?zoo?
>>
>>
>>
>> (
>>
>>
>> https://builder.r-hub.io/status/dmdScheme_1.2.7.tar.gz-396cbbe5d27d4707add4317628dd6cf8
>>
>> )
>>
>> but I assume that is not relevant.
>>
>> ?
>>
>>
>> Rainer M. Krug, PhD (Conservation Ecology, SUN), MSc (Conservation
>> Biology,
>>
>> UCT), Dipl. Phys. (Germany)
>>
>>
>> Orcid ID: 0000-0002-7490-0066
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>> Office Y34-J-74
>>
>> Winterthurerstrasse 190
>>
>> 8075 Z?rich
>>
>> Switzerland
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Orcid ID: 0000-0002-7490-0066
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>> Office Y34-J-74
>>
>> Winterthurerstrasse 190
>>
>> 8075 Z?rich
>>
>> Switzerland
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>> Office Y34-J-74
>>
>> Winterthurerstrasse 190
>>
>> 8075 Z?rich
>>
>> Switzerland
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> Office: +41 (0)44 635 47 64
>>
>> Cell:        +41 (0)78 630 66 57
>>
>> email:      Rainer.Krug at uzh.ch
>>
>> Rainer at krugs.de
>>
>> Skype:     RMkrug
>>
>>
>> PGP: 0x0F52F982
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Ke
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Keug@
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Keug at gmail.
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Keug at gmail.com
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>>
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>>
>> ---
>>
>>
>> Rainer M. Krug
>>
>>
>> Department of Evolutionary Biology and Environmental Studies
>>
>> University of Z?rich
>>
>>
>>
>> R.M.Krug at gmail.com
>>
>>
>> [[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>>
>> R-package-devel at r-project.org mailing list
>>
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>

	[[alternative HTML version deleted]]


From yut@n|@|n| @end|ng |rom gm@||@com  Sat Jan 22 10:50:09 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Sat, 22 Jan 2022 18:50:09 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on Windows
Message-ID: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>

Hi,

I'm trying to create a Rust library that can implement an R graphic
device[1], but the R session crashes on `dev.off()` on Windows with R
4.1.2. Strangely, it works without errors on Linux, on macOS, and even
on Windows with R-devel.

Looking at the stack trace below by WinDbg, the problem is probably
that either of the two free()s in GEdestroyDevDesc() tries to free
some memory that was already freed (I'm a very beginner of this kind
of debugging, so I might be wrong).

    # Child-SP          RetAddr               Call Site
    00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
    01 00000000`0441cbc0 00007ffb`3df14c82
ntdll!RtlReportCriticalFailure+0x97
    ...snip...
    08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
    09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
    0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
    0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
    0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
    ...snip...

But, I found no difference in the related code (around devoff() and
GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
lot of feature additions in R-devel, but I don't think it affects
here. Is there anyone who suffered from similar crashes? Am I missing
something?

I would appreciate any advice.

Best,
Yutani

[1]: https://github.com/extendr/extendr/pull/360


From r|cc@r| @end|ng |rom hotm@||@|t  Sat Jan 22 12:40:25 2022
From: r|cc@r| @end|ng |rom hotm@||@|t (riccardo)
Date: Sat, 22 Jan 2022 12:40:25 +0100
Subject: [R-pkg-devel] Fix JFM package problem
In-Reply-To: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
References: <AM5PR0601MB224466DDB533913F015A036FD7519@AM5PR0601MB2244.eurprd06.prod.outlook.com>
Message-ID: <AM5PR0601MB2244FECEB8EA7218865E8446D75C9@AM5PR0601MB2244.eurprd06.prod.outlook.com>

Hallo,

I re-submitted the JFM package and the following error raised again running an example in a rcpp
function only in Debian check:

package JFM_1.0.tar.gz does not pass the incoming checks automatically, please see the following pre-tests:
Windows:<https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220122_111558/Windows/00check.log>
Status: 1 NOTE
Debian:<https://win-builder.r-project.org/incoming_pretest/JFM_1.0_20220122_111558/Debian/00check.log>
Status: 1 ERROR, 1 NOTE

Running examples in ???JFM-Ex.R??? failed
The error most likely occurred in:

> base::assign(".ptime", proc.time(), pos = "CheckExEnv")
> ### Name: least_square_plane_rcpp
> ### Title: returns the coefficients of the least square plane and the
> ###   relative medium square error
> ### Aliases: least_square_plane_rcpp
> 
> ### ** Examples
> 
> list_xyz<-matrix(data = c(-10.0, -10.0, -15.0 ,10.0, -10.0,
+ -5.0, -10.0, 10.0, 5.0, 10.0, 10.0 ,15.0),
+ nrow = 4,ncol = 3, byrow = TRUE)
> least_square_plane_rcpp(list_xyz)

warning: eig_sym(): given matrix is not symmetric
Error in least_square_plane_rcpp(list_xyz) :
   Mat::operator(): index out of bounds
Execution halted

as you suggested I posted an issue with complete function code athttps://github.com/riccarl/JFM/issues/1

the correct result in windows is:

3.333333e-01  6.666667e-01 -6.666667e-01  0.000000e+00  6.280370e-16

Thank you in advance
Riccardo


	[[alternative HTML version deleted]]


From r@|@@pere|r@@br @end|ng |rom gm@||@com  Mon Jan 24 02:54:35 2022
From: r@|@@pere|r@@br @end|ng |rom gm@||@com (Rafael H. M. Pereira)
Date: Sun, 23 Jan 2022 22:54:35 -0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
Message-ID: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>

Hi all.

In one of the functions of my package (flightsbr), I have a vector with
character strings where I need to replace the degree symbol ? with a point
'.' So this is what I do:

vec <- gsub("[?]", ".", vec)

However, I keep getting this Warning from devtools::check():
  Found the following file with non-ASCII characters:
    utils.R
  Portable packages must use only ASCII characters in their R code,
  except perhaps in comments.
  Use \uxxxx escapes for other characters.

I assume there is a ASCII representation of ?, but I cannot really find a
way to do this using ASCII  characters. Any ideas?

best,
Rafael Pereira

	[[alternative HTML version deleted]]


From @vr@h@m@@d|er @end|ng |rom gm@||@com  Mon Jan 24 02:56:37 2022
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Mon, 24 Jan 2022 01:56:37 +0000
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
Message-ID: <CAL6gwnKK7O+KnkYyvE13kiqJBCdcFY_eu-NRwHz=iV=mzY+mVA@mail.gmail.com>

https://theasciicode.com.ar/extended-ascii-code/degree-symbol-ascii-code-248.html

On Mon, Jan 24, 2022 at 1:55 AM Rafael H. M. Pereira
<rafa.pereira.br at gmail.com> wrote:
>
> Hi all.
>
> In one of the functions of my package (flightsbr), I have a vector with
> character strings where I need to replace the degree symbol ? with a point
> '.' So this is what I do:
>
> vec <- gsub("[?]", ".", vec)
>
> However, I keep getting this Warning from devtools::check():
>   Found the following file with non-ASCII characters:
>     utils.R
>   Portable packages must use only ASCII characters in their R code,
>   except perhaps in comments.
>   Use \uxxxx escapes for other characters.
>
> I assume there is a ASCII representation of ?, but I cannot really find a
> way to do this using ASCII  characters. Any ideas?
>
> best,
> Rafael Pereira
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From dbos@k01 m@iii@g oii gm@ii@com  Mon Jan 24 03:09:09 2022
From: dbos@k01 m@iii@g oii gm@ii@com (dbos@k01 m@iii@g oii gm@ii@com)
Date: Sun, 23 Jan 2022 21:09:09 -0500
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
Message-ID: <007601d810c7$6050bd30$20f23790$@gmail.com>

vec <- c("one", "two", "three?")
vec
# [1] "one"    "two"    "three?"

vec1 <- gsub("[\xB0]", ".", vec)
vec1
# [1] "one"    "two"    "three."

-----Original Message-----
From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf Of Rafael H. M. Pereira
Sent: Sunday, January 23, 2022 8:55 PM
To: r-package-devel at r-project.org
Subject: [R-pkg-devel] ASCII code for Degree symbol ?

Hi all.

In one of the functions of my package (flightsbr), I have a vector with character strings where I need to replace the degree symbol ? with a point '.' So this is what I do:

vec <- gsub("[?]", ".", vec)

However, I keep getting this Warning from devtools::check():
  Found the following file with non-ASCII characters:
    utils.R
  Portable packages must use only ASCII characters in their R code,
  except perhaps in comments.
  Use \uxxxx escapes for other characters.

I assume there is a ASCII representation of ?, but I cannot really find a way to do this using ASCII  characters. Any ideas?

best,
Rafael Pereira

	[[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@|@@pere|r@@br @end|ng |rom gm@||@com  Mon Jan 24 03:20:37 2022
From: r@|@@pere|r@@br @end|ng |rom gm@||@com (Rafael H. M. Pereira)
Date: Sun, 23 Jan 2022 23:20:37 -0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <007601d810c7$6050bd30$20f23790$@gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
Message-ID: <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>

Thank you, dbosak01. This was really  really  helpful !

best wishes,
Rafael Pereira

On Sun, Jan 23, 2022 at 11:09 PM <dbosak01 at gmail.com> wrote:

> vec <- c("one", "two", "three?")
> vec
> # [1] "one"    "two"    "three?"
>
> vec1 <- gsub("[\xB0]", ".", vec)
> vec1
> # [1] "one"    "two"    "three."
>
> -----Original Message-----
> From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf
> Of Rafael H. M. Pereira
> Sent: Sunday, January 23, 2022 8:55 PM
> To: r-package-devel at r-project.org
> Subject: [R-pkg-devel] ASCII code for Degree symbol ?
>
> Hi all.
>
> In one of the functions of my package (flightsbr), I have a vector with
> character strings where I need to replace the degree symbol ? with a point
> '.' So this is what I do:
>
> vec <- gsub("[?]", ".", vec)
>
> However, I keep getting this Warning from devtools::check():
>   Found the following file with non-ASCII characters:
>     utils.R
>   Portable packages must use only ASCII characters in their R code,
>   except perhaps in comments.
>   Use \uxxxx escapes for other characters.
>
> I assume there is a ASCII representation of ?, but I cannot really find a
> way to do this using ASCII  characters. Any ideas?
>
> best,
> Rafael Pereira
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Jan 24 09:23:42 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 24 Jan 2022 11:23:42 +0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <007601d810c7$6050bd30$20f23790$@gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
Message-ID: <20220124112342.6673a75d@parabola>

On Sun, 23 Jan 2022 21:09:09 -0500
<dbosak01 at gmail.com> wrote:

> vec1 <- gsub("[\xB0]", ".", vec)

A great degree of care is needed with this.

Encoding('\xB0') is "unknown", i.e. \xXX escape codes are assumed to be
bytes in your native system encoding. On GNU/Linux and other systems
where native encoding is UTF-8 (and not Latin-1 or an ANSI code page),
'\xB0' is an invalid byte sequence, not a degree symbol:

'\xB0' == '?'
# [1] FALSE

On the other hand, the code point for ? is also U+00B0:

as.hexmode(utf8ToInt('?'))
# [1] "b0"
'\ub0'
# [1] "?"

The difference is that Encoding('\ub0') is "UTF-8" and is therefore
portable between systems with different native encodings.

-- 
Best regards,
Ivan


From md @end|ng |rom @und@ku@dk  Mon Jan 24 11:03:44 2022
From: md @end|ng |rom @und@ku@dk (Matt Denwood)
Date: Mon, 24 Jan 2022 10:03:44 +0000
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
 <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>
Message-ID: <49974CCA-A9ED-4735-BE45-7BB5CF5FD230@sund.ku.dk>

Hi Rafael

I find ?stringi::stri_escape_unicode to be extremely useful for generating \uxxxx escapes, for example:

> stringi::stri_escape_unicode("?") |> cat("\n")
\u00b0

Which can be reversed (for checking) using:

> stringi::stri_unescape_unicode("\u00b0") |> cat("\n")
?

This also works with non-ASCII characters embedded in longer sentences:

> stringi::stri_escape_unicode("?v ? m?rkelige tegn!") |> cat("\n")
\u00c5v \u2014 m\u00e6rkelige tegn!

> stringi::stri_unescape_unicode("\u00c5v \u2014 m\u00e6rkelige tegn!") |> cat("\n")
?v ? m?rkelige tegn!

Big thanks to the authors of the stringi package if they are reading this!

Cheers,

Matt


?On 24/01/2022, 03:26, "R-package-devel on behalf of Rafael H. M. Pereira" <r-package-devel-bounces at r-project.org on behalf of rafa.pereira.br at gmail.com> wrote:

    Thank you, dbosak01. This was really  really  helpful !

    best wishes,
    Rafael Pereira

    On Sun, Jan 23, 2022 at 11:09 PM <dbosak01 at gmail.com> wrote:

    > vec <- c("one", "two", "three?")
    > vec
    > # [1] "one"    "two"    "three?"
    >
    > vec1 <- gsub("[\xB0]", ".", vec)
    > vec1
    > # [1] "one"    "two"    "three."
    >
    > -----Original Message-----
    > From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf
    > Of Rafael H. M. Pereira
    > Sent: Sunday, January 23, 2022 8:55 PM
    > To: r-package-devel at r-project.org
    > Subject: [R-pkg-devel] ASCII code for Degree symbol ?
    >
    > Hi all.
    >
    > In one of the functions of my package (flightsbr), I have a vector with
    > character strings where I need to replace the degree symbol ? with a point
    > '.' So this is what I do:
    >
    > vec <- gsub("[?]", ".", vec)
    >
    > However, I keep getting this Warning from devtools::check():
    >   Found the following file with non-ASCII characters:
    >     utils.R
    >   Portable packages must use only ASCII characters in their R code,
    >   except perhaps in comments.
    >   Use \uxxxx escapes for other characters.
    >
    > I assume there is a ASCII representation of ?, but I cannot really find a
    > way to do this using ASCII  characters. Any ideas?
    >
    > best,
    > Rafael Pereira
    >
    >         [[alternative HTML version deleted]]
    >
    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0
    >
    >

    	[[alternative HTML version deleted]]

    ______________________________________________
    R-package-devel at r-project.org mailing list
    https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0


From @gqh@mmond @end|ng |rom gm@||@com  Mon Jan 24 11:58:20 2022
From: @gqh@mmond @end|ng |rom gm@||@com (Anthony Hammond)
Date: Mon, 24 Jan 2022 10:58:20 +0000
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
Message-ID: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>

Hello,

Since updating to the current version of R (4.1.2) I can't seem to pass the
R cmd checks, I get the below message. I've read a lot online about
installing and linking MikTex, which I've done. Another suggests I need the
function texi2dvi(), which is available in the tools package. So I'm not
sure what to do. Any assistance would be appreciated

Thank you
Anthony

checking PDF version of manual ... WARNING
LaTeX errors when creating PDF version.
This typically indicates Rd problems.
* checking PDF version of manual without hyperrefs or index ... ERROR
Re-running with no redirection of stdout/stderr.
Hmm ... looks like a package
You may want to clean up by 'rm -Rf
C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in running tools::texi2pdf()
* DONE
Status: 1 ERROR, 1 WARNING

	[[alternative HTML version deleted]]


From r@|@@pere|r@@br @end|ng |rom gm@||@com  Mon Jan 24 13:49:00 2022
From: r@|@@pere|r@@br @end|ng |rom gm@||@com (Rafael H. M. Pereira)
Date: Mon, 24 Jan 2022 09:49:00 -0300
Subject: [R-pkg-devel] =?utf-8?q?ASCII_code_for_Degree_symbol_=C2=B0?=
In-Reply-To: <49974CCA-A9ED-4735-BE45-7BB5CF5FD230@sund.ku.dk>
References: <CAA42DG=iUZjksgJ-L=VY-V9K6Ou-qMCaG4uteUgHpCdjtPTbRg@mail.gmail.com>
 <007601d810c7$6050bd30$20f23790$@gmail.com>
 <CAA42DGkRikin1K6hAGuVvPWabxf_BkOkKgqWqBHqyu1NOyVd-A@mail.gmail.com>
 <49974CCA-A9ED-4735-BE45-7BB5CF5FD230@sund.ku.dk>
Message-ID: <CAA42DG=tCYCZuW72TJt2_2Y-zvRwRQw7PqxjeRUz6ffeV6GcGw@mail.gmail.com>

Thank you Matt and Ivan. This is all much appreciated. The concern with
portability across OS is also very important! thanks again!

Rafael

On Mon, Jan 24, 2022 at 7:03 AM Matt Denwood <md at sund.ku.dk> wrote:

> Hi Rafael
>
> I find ?stringi::stri_escape_unicode to be extremely useful for generating
> \uxxxx escapes, for example:
>
> > stringi::stri_escape_unicode("?") |> cat("\n")
> \u00b0
>
> Which can be reversed (for checking) using:
>
> > stringi::stri_unescape_unicode("\u00b0") |> cat("\n")
> ?
>
> This also works with non-ASCII characters embedded in longer sentences:
>
> > stringi::stri_escape_unicode("?v ? m?rkelige tegn!") |> cat("\n")
> \u00c5v \u2014 m\u00e6rkelige tegn!
>
> > stringi::stri_unescape_unicode("\u00c5v \u2014 m\u00e6rkelige tegn!") |>
> cat("\n")
> ?v ? m?rkelige tegn!
>
> Big thanks to the authors of the stringi package if they are reading this!
>
> Cheers,
>
> Matt
>
>
> ?On 24/01/2022, 03:26, "R-package-devel on behalf of Rafael H. M. Pereira"
> <r-package-devel-bounces at r-project.org on behalf of
> rafa.pereira.br at gmail.com> wrote:
>
>     Thank you, dbosak01. This was really  really  helpful !
>
>     best wishes,
>     Rafael Pereira
>
>     On Sun, Jan 23, 2022 at 11:09 PM <dbosak01 at gmail.com> wrote:
>
>     > vec <- c("one", "two", "three?")
>     > vec
>     > # [1] "one"    "two"    "three?"
>     >
>     > vec1 <- gsub("[\xB0]", ".", vec)
>     > vec1
>     > # [1] "one"    "two"    "three."
>     >
>     > -----Original Message-----
>     > From: R-package-devel <r-package-devel-bounces at r-project.org> On
> Behalf
>     > Of Rafael H. M. Pereira
>     > Sent: Sunday, January 23, 2022 8:55 PM
>     > To: r-package-devel at r-project.org
>     > Subject: [R-pkg-devel] ASCII code for Degree symbol ?
>     >
>     > Hi all.
>     >
>     > In one of the functions of my package (flightsbr), I have a vector
> with
>     > character strings where I need to replace the degree symbol ? with a
> point
>     > '.' So this is what I do:
>     >
>     > vec <- gsub("[?]", ".", vec)
>     >
>     > However, I keep getting this Warning from devtools::check():
>     >   Found the following file with non-ASCII characters:
>     >     utils.R
>     >   Portable packages must use only ASCII characters in their R code,
>     >   except perhaps in comments.
>     >   Use \uxxxx escapes for other characters.
>     >
>     > I assume there is a ASCII representation of ?, but I cannot really
> find a
>     > way to do this using ASCII  characters. Any ideas?
>     >
>     > best,
>     > Rafael Pereira
>     >
>     >         [[alternative HTML version deleted]]
>     >
>     > ______________________________________________
>     > R-package-devel at r-project.org mailing list
>     >
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0
>     >
>     >
>
>         [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmd%40sund.ku.dk%7Cb335bac4a0fa4a169dbb08d9dee0beed%7Ca3927f91cda14696af898c9f1ceffa91%7C0%7C0%7C637785879700256001%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EdbzG%2BVYzo%2Bgw20O4GUAwDFVz2JK4AFVc7gAzScg7a8%3D&amp;reserved=0
>
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Jan 24 13:50:01 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 24 Jan 2022 07:50:01 -0500
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
In-Reply-To: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
References: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
Message-ID: <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>

On 24/01/2022 5:58 a.m., Anthony Hammond wrote:
> Hello,
> 
> Since updating to the current version of R (4.1.2) I can't seem to pass the
> R cmd checks, I get the below message. I've read a lot online about
> installing and linking MikTex, which I've done. Another suggests I need the
> function texi2dvi(), which is available in the tools package. So I'm not
> sure what to do. Any assistance would be appreciated
> 
> Thank you
> Anthony
> 
> checking PDF version of manual ... WARNING
> LaTeX errors when creating PDF version.
> This typically indicates Rd problems.
> * checking PDF version of manual without hyperrefs or index ... ERROR
> Re-running with no redirection of stdout/stderr.
> Hmm ... looks like a package
> You may want to clean up by 'rm -Rf
> C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available
> Error in running tools::texi2pdf()
> * DONE
> Status: 1 ERROR, 1 WARNING

You should fix the ERROR first.  It's saying that the `pdflatex` program 
isn't being found.  Since you say you've installed MikTeX, that probably 
means that it isn't on the system path.  You need to do 2 things:

1.  Find out where pdflatex.exe is on your system.
2.  Make sure its directory is on the PATH that R sees.

You do step 1 using Windows search tools.  For step 2, use 
Sys.getenv("PATH") in R to see the current path.

If you found pdflatex.exe in C:\Miktex\bin\pdflatex.exe then you'd need 
to add "C:\Miktex\bin" to your path.  You can do this temporarily within 
R using

     Sys.setenv(PATH = paste0(Sys.getenv("PATH"), ";C:\\Miktex\\bin")

but this will only last for the current session.  To add it permanently, 
you'll need to use some Windows configuration tools.

Duncan Murdoch


From o||ver@p@m@d@en @end|ng |rom gm@||@com  Mon Jan 24 17:30:41 2022
From: o||ver@p@m@d@en @end|ng |rom gm@||@com (Oliver Madsen)
Date: Mon, 24 Jan 2022 17:30:41 +0100
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
In-Reply-To: <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>
References: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
 <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>
Message-ID: <CAFL8AHqM09+ZEj4zgCuKfw1VOYkT_RPY6XJC4m-Lg-QO33snWg@mail.gmail.com>

For windows simply search "environment variable" which will allow you to
open the environment variable gui. In thete append the folder to the
pdfmatex executable under user variables, and then it should be found by R
after restarting the session.

/Oli er

On Mon, 24 Jan 2022, 13:50 Duncan Murdoch, <murdoch.duncan at gmail.com> wrote:

> On 24/01/2022 5:58 a.m., Anthony Hammond wrote:
> > Hello,
> >
> > Since updating to the current version of R (4.1.2) I can't seem to pass
> the
> > R cmd checks, I get the below message. I've read a lot online about
> > installing and linking MikTex, which I've done. Another suggests I need
> the
> > function texi2dvi(), which is available in the tools package. So I'm not
> > sure what to do. Any assistance would be appreciated
> >
> > Thank you
> > Anthony
> >
> > checking PDF version of manual ... WARNING
> > LaTeX errors when creating PDF version.
> > This typically indicates Rd problems.
> > * checking PDF version of manual without hyperrefs or index ... ERROR
> > Re-running with no redirection of stdout/stderr.
> > Hmm ... looks like a package
> > You may want to clean up by 'rm -Rf
> > C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in running tools::texi2pdf()
> > * DONE
> > Status: 1 ERROR, 1 WARNING
>
> You should fix the ERROR first.  It's saying that the `pdflatex` program
> isn't being found.  Since you say you've installed MikTeX, that probably
> means that it isn't on the system path.  You need to do 2 things:
>
> 1.  Find out where pdflatex.exe is on your system.
> 2.  Make sure its directory is on the PATH that R sees.
>
> You do step 1 using Windows search tools.  For step 2, use
> Sys.getenv("PATH") in R to see the current path.
>
> If you found pdflatex.exe in C:\Miktex\bin\pdflatex.exe then you'd need
> to add "C:\Miktex\bin" to your path.  You can do this temporarily within
> R using
>
>      Sys.setenv(PATH = paste0(Sys.getenv("PATH"), ";C:\\Miktex\\bin")
>
> but this will only last for the current session.  To add it permanently,
> you'll need to use some Windows configuration tools.
>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From berryboe@@enkoo| @end|ng |rom hotm@||@com  Tue Jan 25 08:24:09 2022
From: berryboe@@enkoo| @end|ng |rom hotm@||@com (Berry Boessenkool)
Date: Tue, 25 Jan 2022 07:24:09 +0000
Subject: [R-pkg-devel] LaTeX errors when creating PDF version,
 Error in texi2dvi
In-Reply-To: <CAFL8AHqM09+ZEj4zgCuKfw1VOYkT_RPY6XJC4m-Lg-QO33snWg@mail.gmail.com>
References: <CAGX=S7wJaYcWUha0y2oonb1=7UG1VuH-CFq6yTogJ5kydWMyJw@mail.gmail.com>
 <61f1c5d9-28d0-d6e4-ba41-fec9d308bcfe@gmail.com>
 <CAFL8AHqM09+ZEj4zgCuKfw1VOYkT_RPY6XJC4m-Lg-QO33snWg@mail.gmail.com>
Message-ID: <DB9P193MB15635A6AA6AA44403D6E5AA5D55F9@DB9P193MB1563.EURP193.PROD.OUTLOOK.COM>


> to add "C:\Miktex\bin" to your path.  You can do this temporarily within

a last thing I'd like to add to this:
You can change the path as perceived by R permantly with this:
writeLines('PATH="C:\\Miktex\\bin;${PATH}"', con = "~/.Renviron")
Not sure if this is good practice, but it works for unzip, see https://bookdown.org/brry/rdwd/fread.html

Regards,
Berry

________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Oliver Madsen <oliver.p.madsen at gmail.com>
Sent: Monday, January 24, 2022 17:30
To: Duncan Murdoch <murdoch.duncan at gmail.com>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] LaTeX errors when creating PDF version, Error in texi2dvi

For windows simply search "environment variable" which will allow you to
open the environment variable gui. In thete append the folder to the
pdfmatex executable under user variables, and then it should be found by R
after restarting the session.

/Oli er

On Mon, 24 Jan 2022, 13:50 Duncan Murdoch, <murdoch.duncan at gmail.com> wrote:

> On 24/01/2022 5:58 a.m., Anthony Hammond wrote:
> > Hello,
> >
> > Since updating to the current version of R (4.1.2) I can't seem to pass
> the

> > installing and linking MikTex, which I've done. Another suggests I need
> the
> > function texi2dvi(), which is available in the tools package. So I'm not
> > sure what to do. Any assistance would be appreciated
> >
> > Thank you
> > Anthony
> >
> > checking PDF version of manual ... WARNING
> > LaTeX errors when creating PDF version.
> > This typically indicates Rd problems.
> > * checking PDF version of manual without hyperrefs or index ... ERROR
> > Re-running with no redirection of stdout/stderr.
> > Hmm ... looks like a package
> > You may want to clean up by 'rm -Rf
> > C:/Users/ANTHON~1/AppData/Local/Temp/RtmpqkDPxl/Rd2pdf3bb84cc32d1c'
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet =
> quiet,  :
> >    pdflatex is not available
> > Error in running tools::texi2pdf()
> > * DONE
> > Status: 1 ERROR, 1 WARNING
>
> You should fix the ERROR first.  It's saying that the `pdflatex` program
> isn't being found.  Since you say you've installed MikTeX, that probably
> means that it isn't on the system path.  You need to do 2 things:
>
> 1.  Find out where pdflatex.exe is on your system.
> 2.  Make sure its directory is on the PATH that R sees.
>

> Sys.getenv("PATH") in R to see the current path.
>
> If you found pdflatex.exe in C:\Miktex\bin\pdflatex.exe then you'd need
> to add "C:\Miktex\bin" to your path.  You can do this temporarily within
> R using
>
>      Sys.setenv(PATH = paste0(Sys.getenv("PATH"), ";C:\\Miktex\\bin")
>
> but this will only last for the current session.  To add it permanently,

>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From @|ex@ndru@vod@ @end|ng |rom @eh@ox@@c@uk  Tue Jan 25 01:02:38 2022
From: @|ex@ndru@vod@ @end|ng |rom @eh@ox@@c@uk (Alexandru Voda)
Date: Tue, 25 Jan 2022 00:02:38 +0000
Subject: [R-pkg-devel] Question on best approach to develop R package that
 wraps old complex Python2 software
Message-ID: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>

Hi!

How would one best write an R wrapper package over a complex Python2 software (such as https://github.com/bulik/ldsc), that is still very widely used in statistical genetics?

I'm writting an R package (that currently passes all --as-cran checks) for multiple other C++ softwares on the same topic as the one above, but this Python2 one I've difficulties with - it just looks like a bunch of hackish system() calls... And while it works on Linux and Mac, I've no idea whether it'd work on Windows.

While it may seem easy to dismiss, actually LDSC is widely used in the statistical genetics field, and lots of people find it difficult to work with because of all the dependency files and weirdly documented commands, and because... well... Python2...

Any tips? Or do you know anyone that I should contact/ask?

Best wishes,
Alexandru

	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Tue Jan 25 16:27:05 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Tue, 25 Jan 2022 10:27:05 -0500
Subject: [R-pkg-devel] 
 Question on best approach to develop R package that
 wraps old complex Python2 software
In-Reply-To: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
References: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>

I would suggest the reticulate library in R. The few most important for
your case are reticulate::use_python_version and reticulate::import.
For example, in your R package, you should start with:


# change this to the name of the module you need
numpy <- NULL


.onLoad <- function (libname, pkgname)
{
    reticulate::use_python_version("2.7")  # change this as you need to


    # .onLoad happens before the namespace is locked, so this is legitimate
    numpy <<- reticulate::import("numpy", delay_load = list(
        on_error = function(c) stop(
            "unable to import 'numpy', try ",
            sQuote("reticulate::py_install(\"numpy\")"),
            " if it is not installed:\n  ",
            conditionMessage(c)
        )
    ))
}


when your package's namespace is loaded, this will load the version of
python you need to use, and will lazy-import the module you need for your
python session.

On Tue, Jan 25, 2022 at 8:52 AM Alexandru Voda <alexandru.voda at seh.ox.ac.uk>
wrote:

> Hi!
>
> How would one best write an R wrapper package over a complex Python2
> software (such as https://github.com/bulik/ldsc), that is still very
> widely used in statistical genetics?
>
> I'm writting an R package (that currently passes all --as-cran checks) for
> multiple other C++ softwares on the same topic as the one above, but this
> Python2 one I've difficulties with - it just looks like a bunch of hackish
> system() calls... And while it works on Linux and Mac, I've no idea whether
> it'd work on Windows.
>
> While it may seem easy to dismiss, actually LDSC is widely used in the
> statistical genetics field, and lots of people find it difficult to work
> with because of all the dependency files and weirdly documented commands,
> and because... well... Python2...
>
> Any tips? Or do you know anyone that I should contact/ask?
>
> Best wishes,
> Alexandru
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @me @end|ng |rom |y@|k@com  Tue Jan 25 17:45:02 2022
From: @me @end|ng |rom |y@|k@com (=?UTF-8?Q?Stefan_McKinnon_H=C3=B8j=2DEdwards?=)
Date: Tue, 25 Jan 2022 17:45:02 +0100
Subject: [R-pkg-devel] 
 Question on best approach to develop R package that
 wraps old complex Python2 software
In-Reply-To: <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>
References: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
 <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>
Message-ID: <CAHJFP8TgOCEtLHaid-vMSXQymamCjgvOk7uWv0gUJLur3JjAew@mail.gmail.com>

If the Python2 package is mainly system() calls, I would write an R package
that essentially did the same, without relaying calls via the Python
routines. I.e. let R call the commands directly.

The only downside to this approach, is that R doesn't handle multithreading
as well as Python does. In Python, you have the subcommand (subprocess?)
module, I believe, with which you can call an external command and send it
input, check its output, send new input, or just leave it be, until you
want to check in on your subcommand. But to my knowledge, no similar method
exists in R.
Which brings us to the point: for how long do these external commands run?
Regardless of module used in Python or directly called from R, the R
process will wait. Mostly an issue for interactive uses.

Another approach could be to have your R package handle data formatting,
setup settings etc. and compiling a command with arguments, that the user
may call at their leisure, whether on their laptop, cloud or HPC. When
results have been factualised, they can return to your package to analyse
the results.
I used this approach for my badly named R package Siccuracy, for aiding
with the imputation software AlphaImpute.

Kindly,
Stefan

tir. 25. jan. 2022 16.27 skrev Andrew Simmons <akwsimmo at gmail.com>:

> I would suggest the reticulate library in R. The few most important for
> your case are reticulate::use_python_version and reticulate::import.
> For example, in your R package, you should start with:
>
>
> # change this to the name of the module you need
> numpy <- NULL
>
>
> .onLoad <- function (libname, pkgname)
> {
>     reticulate::use_python_version("2.7")  # change this as you need to
>
>
>     # .onLoad happens before the namespace is locked, so this is legitimate
>     numpy <<- reticulate::import("numpy", delay_load = list(
>         on_error = function(c) stop(
>             "unable to import 'numpy', try ",
>             sQuote("reticulate::py_install(\"numpy\")"),
>             " if it is not installed:\n  ",
>             conditionMessage(c)
>         )
>     ))
> }
>
>
> when your package's namespace is loaded, this will load the version of
> python you need to use, and will lazy-import the module you need for your
> python session.
>
> On Tue, Jan 25, 2022 at 8:52 AM Alexandru Voda <
> alexandru.voda at seh.ox.ac.uk>
> wrote:
>
> > Hi!
> >
> > How would one best write an R wrapper package over a complex Python2
> > software (such as https://github.com/bulik/ldsc), that is still very
> > widely used in statistical genetics?
> >
> > I'm writting an R package (that currently passes all --as-cran checks)
> for
> > multiple other C++ softwares on the same topic as the one above, but this
> > Python2 one I've difficulties with - it just looks like a bunch of
> hackish
> > system() calls... And while it works on Linux and Mac, I've no idea
> whether
> > it'd work on Windows.
> >
> > While it may seem easy to dismiss, actually LDSC is widely used in the
> > statistical genetics field, and lots of people find it difficult to work
> > with because of all the dependency files and weirdly documented commands,
> > and because... well... Python2...
> >
> > Any tips? Or do you know anyone that I should contact/ask?
> >
> > Best wishes,
> > Alexandru
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Tue Jan 25 21:12:07 2022
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Tue, 25 Jan 2022 15:12:07 -0500 (EST)
Subject: [R-pkg-devel] 
 Question on best approach to develop R package that
 wraps old complex Python2 software
In-Reply-To: <CAHJFP8TgOCEtLHaid-vMSXQymamCjgvOk7uWv0gUJLur3JjAew@mail.gmail.com>
References: <CWXSPR01MB0039FE96F0768FF9931DD3DEEF5F9@CWXSPR01MB0039.GBRP265.PROD.OUTLOOK.COM>
 <CAPcHnpS4XCEfCCHRODr+oyxhm0iPg0cmhdGObSj=VkPv9mKg=A@mail.gmail.com>
 <CAHJFP8TgOCEtLHaid-vMSXQymamCjgvOk7uWv0gUJLur3JjAew@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2201251508330.2405@iridium>



On Tue, 25 Jan 2022, Stefan McKinnon H?j-Edwards wrote:

> If the Python2 package is mainly system() calls, I would write an R package
> that essentially did the same, without relaying calls via the Python
> routines. I.e. let R call the commands directly.
>
> The only downside to this approach, is that R doesn't handle multithreading
> as well as Python does. In Python, you have the subcommand (subprocess?)
> module, I believe, with which you can call an external command and send it
> input, check its output, send new input, or just leave it be, until you
> want to check in on your subcommand. But to my knowledge, no similar method
> exists in R.

In R, you can use Tcl (tcltk) to do the same, which actually works better 
than Python.

The problem with python is that last time I checked there were three 
different interfaces for process control and none of the them were 
complete - it was impossible to reliably control a third-party program, 
while performing other tasks.

In contrast, Tcl has a well-designed interface that you can use in 
non-blocking mode.

best

Vladimir Dergachev

> Which brings us to the point: for how long do these external commands run?
> Regardless of module used in Python or directly called from R, the R
> process will wait. Mostly an issue for interactive uses.
>
> Another approach could be to have your R package handle data formatting,
> setup settings etc. and compiling a command with arguments, that the user
> may call at their leisure, whether on their laptop, cloud or HPC. When
> results have been factualised, they can return to your package to analyse
> the results.
> I used this approach for my badly named R package Siccuracy, for aiding
> with the imputation software AlphaImpute.
>
> Kindly,
> Stefan
>
> tir. 25. jan. 2022 16.27 skrev Andrew Simmons <akwsimmo at gmail.com>:
>
>> I would suggest the reticulate library in R. The few most important for
>> your case are reticulate::use_python_version and reticulate::import.
>> For example, in your R package, you should start with:
>>
>>
>> # change this to the name of the module you need
>> numpy <- NULL
>>
>>
>> .onLoad <- function (libname, pkgname)
>> {
>>     reticulate::use_python_version("2.7")  # change this as you need to
>>
>>
>>     # .onLoad happens before the namespace is locked, so this is legitimate
>>     numpy <<- reticulate::import("numpy", delay_load = list(
>>         on_error = function(c) stop(
>>             "unable to import 'numpy', try ",
>>             sQuote("reticulate::py_install(\"numpy\")"),
>>             " if it is not installed:\n  ",
>>             conditionMessage(c)
>>         )
>>     ))
>> }
>>
>>
>> when your package's namespace is loaded, this will load the version of
>> python you need to use, and will lazy-import the module you need for your
>> python session.
>>
>> On Tue, Jan 25, 2022 at 8:52 AM Alexandru Voda <
>> alexandru.voda at seh.ox.ac.uk>
>> wrote:
>>
>>> Hi!
>>>
>>> How would one best write an R wrapper package over a complex Python2
>>> software (such as https://github.com/bulik/ldsc), that is still very
>>> widely used in statistical genetics?
>>>
>>> I'm writting an R package (that currently passes all --as-cran checks)
>> for
>>> multiple other C++ softwares on the same topic as the one above, but this
>>> Python2 one I've difficulties with - it just looks like a bunch of
>> hackish
>>> system() calls... And while it works on Linux and Mac, I've no idea
>> whether
>>> it'd work on Windows.
>>>
>>> While it may seem easy to dismiss, actually LDSC is widely used in the
>>> statistical genetics field, and lots of people find it difficult to work
>>> with because of all the dependency files and weirdly documented commands,
>>> and because... well... Python2...
>>>
>>> Any tips? Or do you know anyone that I should contact/ask?
>>>
>>> Best wishes,
>>> Alexandru
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jan 26 15:20:16 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 26 Jan 2022 15:20:16 +0100
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
Message-ID: <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>

Hi Yutani,

if you haven't done that already, I would recommend building R with 
debug symbols (DEBUG=T, so that make file don't strip them) and with -O0 
(no optimizations), so that the debug symbols are more accurate. Without 
that, the stack traces can be very misleading. You might try both with 
windbg and gdb, sometimes one of them provides an extra hint. Ideally 
you would also build the involved package(s) the same way.

Then, it is important to check where the free() is called from, whether 
it is directly or from the GC. In both cases (but more likely in the 
latter), it could be caused by somewhat unrelated memory corruption, 
which may be hard to find - e.g. possibly a PROTECT error. Running with 
gctorture() might help, if gctorture() changes where the crash happens, 
it is more likely a somewhat unrelated memory corruption.

If it were a double-free or similar allocation error inside R itself (or 
some of the involved packages), it would be easy to find with a debugger.

If debugging this way does not help, you can try narrowing down the 
example, while preserving the crash. That may make debugging easier, and 
if you eventually get to a point that you have a reproducible example 
involving only base R and base packages, you know it is a bug in R, and 
can submit that in a bug report for others to debug.

Best
Tomas

On 1/22/22 10:50, Hiroaki Yutani wrote:
> Hi,
>
> I'm trying to create a Rust library that can implement an R graphic
> device[1], but the R session crashes on `dev.off()` on Windows with R
> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> on Windows with R-devel.
>
> Looking at the stack trace below by WinDbg, the problem is probably
> that either of the two free()s in GEdestroyDevDesc() tries to free
> some memory that was already freed (I'm a very beginner of this kind
> of debugging, so I might be wrong).
>
>      # Child-SP          RetAddr               Call Site
>      00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
>      01 00000000`0441cbc0 00007ffb`3df14c82
> ntdll!RtlReportCriticalFailure+0x97
>      ...snip...
>      08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
>      09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
>      0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
>      0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
>      0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
>      ...snip...
>
> But, I found no difference in the related code (around devoff() and
> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> lot of feature additions in R-devel, but I don't think it affects
> here. Is there anyone who suffered from similar crashes? Am I missing
> something?
>
> I would appreciate any advice.
>
> Best,
> Yutani
>
> [1]: https://github.com/extendr/extendr/pull/360
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Wed Jan 26 15:44:18 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Wed, 26 Jan 2022 23:44:18 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
Message-ID: <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>

Hi Tomas,

Thanks for your helpful advice. This time, it seems the cause of the
error was an allocator mismatch; I mistakenly allocated the struct on
Rust's side, which means it's allocated by Rust's allocator, but a
`DevDesc` is to be freed on R's side. The problem is solved by using
libc::calloc(), which allocates using the C runtime's allocator, and
compiling it with the same toolchain that compiles R.

I also saw some errors when it relates to GC, so it might be some
PROTECT issue. Thanks for the hint.

During debugging, I learned a lot about how to build R with DEBUG=T
and use gdb, and it really helped me. I'm yet to unlock the power of
WinDBG, but I will try next time...

Best,
Yutani

2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:

>
> Hi Yutani,
>
> if you haven't done that already, I would recommend building R with
> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
> (no optimizations), so that the debug symbols are more accurate. Without
> that, the stack traces can be very misleading. You might try both with
> windbg and gdb, sometimes one of them provides an extra hint. Ideally
> you would also build the involved package(s) the same way.
>
> Then, it is important to check where the free() is called from, whether
> it is directly or from the GC. In both cases (but more likely in the
> latter), it could be caused by somewhat unrelated memory corruption,
> which may be hard to find - e.g. possibly a PROTECT error. Running with
> gctorture() might help, if gctorture() changes where the crash happens,
> it is more likely a somewhat unrelated memory corruption.
>
> If it were a double-free or similar allocation error inside R itself (or
> some of the involved packages), it would be easy to find with a debugger.
>
> If debugging this way does not help, you can try narrowing down the
> example, while preserving the crash. That may make debugging easier, and
> if you eventually get to a point that you have a reproducible example
> involving only base R and base packages, you know it is a bug in R, and
> can submit that in a bug report for others to debug.
>
> Best
> Tomas
>
> On 1/22/22 10:50, Hiroaki Yutani wrote:
> > Hi,
> >
> > I'm trying to create a Rust library that can implement an R graphic
> > device[1], but the R session crashes on `dev.off()` on Windows with R
> > 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> > on Windows with R-devel.
> >
> > Looking at the stack trace below by WinDbg, the problem is probably
> > that either of the two free()s in GEdestroyDevDesc() tries to free
> > some memory that was already freed (I'm a very beginner of this kind
> > of debugging, so I might be wrong).
> >
> >      # Child-SP          RetAddr               Call Site
> >      00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
> >      01 00000000`0441cbc0 00007ffb`3df14c82
> > ntdll!RtlReportCriticalFailure+0x97
> >      ...snip...
> >      08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
> >      09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
> >      0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
> >      0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
> >      0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
> >      ...snip...
> >
> > But, I found no difference in the related code (around devoff() and
> > GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> > lot of feature additions in R-devel, but I don't think it affects
> > here. Is there anyone who suffered from similar crashes? Am I missing
> > something?
> >
> > I would appreciate any advice.
> >
> > Best,
> > Yutani
> >
> > [1]: https://github.com/extendr/extendr/pull/360
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jan 26 16:21:17 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 26 Jan 2022 16:21:17 +0100
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
Message-ID: <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>


On 1/26/22 15:44, Hiroaki Yutani wrote:
> Hi Tomas,
>
> Thanks for your helpful advice. This time, it seems the cause of the
> error was an allocator mismatch; I mistakenly allocated the struct on
> Rust's side, which means it's allocated by Rust's allocator, but a
> `DevDesc` is to be freed on R's side. The problem is solved by using
> libc::calloc(), which allocates using the C runtime's allocator, and
> compiling it with the same toolchain that compiles R.

Hi Yutani,

congratulations on tracing it down.

Particularly on Windows, whenever a DLL (or any API) is providing a 
function to allocate anything, it should provide also a function to free 
it, and only that function should be used to do so, even if it is just a 
wrapper for malloc() etc. So I would recommend following that, there 
should be a Rust allocator's "free" function which you could then call 
from R.

Best
Tomas

>
> I also saw some errors when it relates to GC, so it might be some
> PROTECT issue. Thanks for the hint.
>
> During debugging, I learned a lot about how to build R with DEBUG=T
> and use gdb, and it really helped me. I'm yet to unlock the power of
> WinDBG, but I will try next time...
>
> Best,
> Yutani
>
> 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
>
>> Hi Yutani,
>>
>> if you haven't done that already, I would recommend building R with
>> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
>> (no optimizations), so that the debug symbols are more accurate. Without
>> that, the stack traces can be very misleading. You might try both with
>> windbg and gdb, sometimes one of them provides an extra hint. Ideally
>> you would also build the involved package(s) the same way.
>>
>> Then, it is important to check where the free() is called from, whether
>> it is directly or from the GC. In both cases (but more likely in the
>> latter), it could be caused by somewhat unrelated memory corruption,
>> which may be hard to find - e.g. possibly a PROTECT error. Running with
>> gctorture() might help, if gctorture() changes where the crash happens,
>> it is more likely a somewhat unrelated memory corruption.
>>
>> If it were a double-free or similar allocation error inside R itself (or
>> some of the involved packages), it would be easy to find with a debugger.
>>
>> If debugging this way does not help, you can try narrowing down the
>> example, while preserving the crash. That may make debugging easier, and
>> if you eventually get to a point that you have a reproducible example
>> involving only base R and base packages, you know it is a bug in R, and
>> can submit that in a bug report for others to debug.
>>
>> Best
>> Tomas
>>
>> On 1/22/22 10:50, Hiroaki Yutani wrote:
>>> Hi,
>>>
>>> I'm trying to create a Rust library that can implement an R graphic
>>> device[1], but the R session crashes on `dev.off()` on Windows with R
>>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
>>> on Windows with R-devel.
>>>
>>> Looking at the stack trace below by WinDbg, the problem is probably
>>> that either of the two free()s in GEdestroyDevDesc() tries to free
>>> some memory that was already freed (I'm a very beginner of this kind
>>> of debugging, so I might be wrong).
>>>
>>>       # Child-SP          RetAddr               Call Site
>>>       00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
>>>       01 00000000`0441cbc0 00007ffb`3df14c82
>>> ntdll!RtlReportCriticalFailure+0x97
>>>       ...snip...
>>>       08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
>>>       09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
>>>       0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
>>>       0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
>>>       0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
>>>       ...snip...
>>>
>>> But, I found no difference in the related code (around devoff() and
>>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
>>> lot of feature additions in R-devel, but I don't think it affects
>>> here. Is there anyone who suffered from similar crashes? Am I missing
>>> something?
>>>
>>> I would appreciate any advice.
>>>
>>> Best,
>>> Yutani
>>>
>>> [1]: https://github.com/extendr/extendr/pull/360
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Wed Jan 26 16:42:37 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Thu, 27 Jan 2022 00:42:37 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
 <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
Message-ID: <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>

Hi Tomas,

Thanks, but, if I understand correctly, there's no room to call the
Rust allocator's "free" function in the case of `DevDesc`. A `DevDesc`
is supposed to be freed in `GEdestroyDevDesc()` when the device is
closed. If I free it by myself, it would cause double-free.

So, now I'm wondering if it makes sense that R provides either an API
that creates a `DevDesc` instance, or one that accepts a custom
allocator for DevDesc. But, as I expect this is a minor use case, I'm
not confident enough this would be meaningful.
I might end up filing such a feature request on Bugzilla, but let me
hold off for a while.

Best,
Yutani

2022?1?27?(?) 0:21 Tomas Kalibera <tomas.kalibera at gmail.com>:
>
>
> On 1/26/22 15:44, Hiroaki Yutani wrote:
> > Hi Tomas,
> >
> > Thanks for your helpful advice. This time, it seems the cause of the
> > error was an allocator mismatch; I mistakenly allocated the struct on
> > Rust's side, which means it's allocated by Rust's allocator, but a
> > `DevDesc` is to be freed on R's side. The problem is solved by using
> > libc::calloc(), which allocates using the C runtime's allocator, and
> > compiling it with the same toolchain that compiles R.
>
> Hi Yutani,
>
> congratulations on tracing it down.
>
> Particularly on Windows, whenever a DLL (or any API) is providing a
> function to allocate anything, it should provide also a function to free
> it, and only that function should be used to do so, even if it is just a
> wrapper for malloc() etc. So I would recommend following that, there
> should be a Rust allocator's "free" function which you could then call
> from R.
>
> Best
> Tomas
>
> >
> > I also saw some errors when it relates to GC, so it might be some
> > PROTECT issue. Thanks for the hint.
> >
> > During debugging, I learned a lot about how to build R with DEBUG=T
> > and use gdb, and it really helped me. I'm yet to unlock the power of
> > WinDBG, but I will try next time...
> >
> > Best,
> > Yutani
> >
> > 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
> >
> >> Hi Yutani,
> >>
> >> if you haven't done that already, I would recommend building R with
> >> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
> >> (no optimizations), so that the debug symbols are more accurate. Without
> >> that, the stack traces can be very misleading. You might try both with
> >> windbg and gdb, sometimes one of them provides an extra hint. Ideally
> >> you would also build the involved package(s) the same way.
> >>
> >> Then, it is important to check where the free() is called from, whether
> >> it is directly or from the GC. In both cases (but more likely in the
> >> latter), it could be caused by somewhat unrelated memory corruption,
> >> which may be hard to find - e.g. possibly a PROTECT error. Running with
> >> gctorture() might help, if gctorture() changes where the crash happens,
> >> it is more likely a somewhat unrelated memory corruption.
> >>
> >> If it were a double-free or similar allocation error inside R itself (or
> >> some of the involved packages), it would be easy to find with a debugger.
> >>
> >> If debugging this way does not help, you can try narrowing down the
> >> example, while preserving the crash. That may make debugging easier, and
> >> if you eventually get to a point that you have a reproducible example
> >> involving only base R and base packages, you know it is a bug in R, and
> >> can submit that in a bug report for others to debug.
> >>
> >> Best
> >> Tomas
> >>
> >> On 1/22/22 10:50, Hiroaki Yutani wrote:
> >>> Hi,
> >>>
> >>> I'm trying to create a Rust library that can implement an R graphic
> >>> device[1], but the R session crashes on `dev.off()` on Windows with R
> >>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> >>> on Windows with R-devel.
> >>>
> >>> Looking at the stack trace below by WinDbg, the problem is probably
> >>> that either of the two free()s in GEdestroyDevDesc() tries to free
> >>> some memory that was already freed (I'm a very beginner of this kind
> >>> of debugging, so I might be wrong).
> >>>
> >>>       # Child-SP          RetAddr               Call Site
> >>>       00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
> >>>       01 00000000`0441cbc0 00007ffb`3df14c82
> >>> ntdll!RtlReportCriticalFailure+0x97
> >>>       ...snip...
> >>>       08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
> >>>       09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
> >>>       0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
> >>>       0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
> >>>       0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
> >>>       ...snip...
> >>>
> >>> But, I found no difference in the related code (around devoff() and
> >>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> >>> lot of feature additions in R-devel, but I don't think it affects
> >>> here. Is there anyone who suffered from similar crashes? Am I missing
> >>> something?
> >>>
> >>> I would appreciate any advice.
> >>>
> >>> Best,
> >>> Yutani
> >>>
> >>> [1]: https://github.com/extendr/extendr/pull/360
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jan 26 17:35:44 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 26 Jan 2022 17:35:44 +0100
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
 <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
 <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>
Message-ID: <a57fcbdf-b97f-28c4-3051-0a3e29afec76@gmail.com>

Hi Yutani,

On 1/26/22 16:42, Hiroaki Yutani wrote:
> Hi Tomas,
>
> Thanks, but, if I understand correctly, there's no room to call the
> Rust allocator's "free" function in the case of `DevDesc`. A `DevDesc`
> is supposed to be freed in `GEdestroyDevDesc()` when the device is
> closed. If I free it by myself, it would cause double-free.
>
> So, now I'm wondering if it makes sense that R provides either an API
> that creates a `DevDesc` instance, or one that accepts a custom
> allocator for DevDesc. But, as I expect this is a minor use case, I'm
> not confident enough this would be meaningful.
> I might end up filing such a feature request on Bugzilla, but let me
> hold off for a while.

I see. If you are using the public interface and it allows you to 
(indirectly) free the devices, it should allow you also to allocate 
them. So yes, please file a bug report and please provide enough context 
there so that the report is self-sufficient.

Beyond the general rule than any API allowing to allocate or free needs 
to allow both, I'd leave this to the experts on graphics in R.

Thanks,
Tomas

>
> Best,
> Yutani
>
> 2022?1?27?(?) 0:21 Tomas Kalibera <tomas.kalibera at gmail.com>:
>>
>> On 1/26/22 15:44, Hiroaki Yutani wrote:
>>> Hi Tomas,
>>>
>>> Thanks for your helpful advice. This time, it seems the cause of the
>>> error was an allocator mismatch; I mistakenly allocated the struct on
>>> Rust's side, which means it's allocated by Rust's allocator, but a
>>> `DevDesc` is to be freed on R's side. The problem is solved by using
>>> libc::calloc(), which allocates using the C runtime's allocator, and
>>> compiling it with the same toolchain that compiles R.
>> Hi Yutani,
>>
>> congratulations on tracing it down.
>>
>> Particularly on Windows, whenever a DLL (or any API) is providing a
>> function to allocate anything, it should provide also a function to free
>> it, and only that function should be used to do so, even if it is just a
>> wrapper for malloc() etc. So I would recommend following that, there
>> should be a Rust allocator's "free" function which you could then call
>> from R.
>>
>> Best
>> Tomas
>>
>>> I also saw some errors when it relates to GC, so it might be some
>>> PROTECT issue. Thanks for the hint.
>>>
>>> During debugging, I learned a lot about how to build R with DEBUG=T
>>> and use gdb, and it really helped me. I'm yet to unlock the power of
>>> WinDBG, but I will try next time...
>>>
>>> Best,
>>> Yutani
>>>
>>> 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
>>>
>>>> Hi Yutani,
>>>>
>>>> if you haven't done that already, I would recommend building R with
>>>> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
>>>> (no optimizations), so that the debug symbols are more accurate. Without
>>>> that, the stack traces can be very misleading. You might try both with
>>>> windbg and gdb, sometimes one of them provides an extra hint. Ideally
>>>> you would also build the involved package(s) the same way.
>>>>
>>>> Then, it is important to check where the free() is called from, whether
>>>> it is directly or from the GC. In both cases (but more likely in the
>>>> latter), it could be caused by somewhat unrelated memory corruption,
>>>> which may be hard to find - e.g. possibly a PROTECT error. Running with
>>>> gctorture() might help, if gctorture() changes where the crash happens,
>>>> it is more likely a somewhat unrelated memory corruption.
>>>>
>>>> If it were a double-free or similar allocation error inside R itself (or
>>>> some of the involved packages), it would be easy to find with a debugger.
>>>>
>>>> If debugging this way does not help, you can try narrowing down the
>>>> example, while preserving the crash. That may make debugging easier, and
>>>> if you eventually get to a point that you have a reproducible example
>>>> involving only base R and base packages, you know it is a bug in R, and
>>>> can submit that in a bug report for others to debug.
>>>>
>>>> Best
>>>> Tomas
>>>>
>>>> On 1/22/22 10:50, Hiroaki Yutani wrote:
>>>>> Hi,
>>>>>
>>>>> I'm trying to create a Rust library that can implement an R graphic
>>>>> device[1], but the R session crashes on `dev.off()` on Windows with R
>>>>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
>>>>> on Windows with R-devel.
>>>>>
>>>>> Looking at the stack trace below by WinDbg, the problem is probably
>>>>> that either of the two free()s in GEdestroyDevDesc() tries to free
>>>>> some memory that was already freed (I'm a very beginner of this kind
>>>>> of debugging, so I might be wrong).
>>>>>
>>>>>        # Child-SP          RetAddr               Call Site
>>>>>        00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
>>>>>        01 00000000`0441cbc0 00007ffb`3df14c82
>>>>> ntdll!RtlReportCriticalFailure+0x97
>>>>>        ...snip...
>>>>>        08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
>>>>>        09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
>>>>>        0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
>>>>>        0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
>>>>>        0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
>>>>>        ...snip...
>>>>>
>>>>> But, I found no difference in the related code (around devoff() and
>>>>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
>>>>> lot of feature additions in R-devel, but I don't think it affects
>>>>> here. Is there anyone who suffered from similar crashes? Am I missing
>>>>> something?
>>>>>
>>>>> I would appreciate any advice.
>>>>>
>>>>> Best,
>>>>> Yutani
>>>>>
>>>>> [1]: https://github.com/extendr/extendr/pull/360
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Thu Jan 27 00:55:48 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Thu, 27 Jan 2022 08:55:48 +0900
Subject: [R-pkg-devel] R session crash on closing a graphic device on
 Windows
In-Reply-To: <a57fcbdf-b97f-28c4-3051-0a3e29afec76@gmail.com>
References: <CALyqOb_AdcYoWXTS1LyK5O=K5cPtxinA99t+fdr9DyRnfdMaRA@mail.gmail.com>
 <0e12a9a0-0088-f975-15c1-063c5be7d925@gmail.com>
 <CALyqOb9-qo76-joyqkxRDShAJPvAHa6JHNB-cDDmKbcmLeK3wA@mail.gmail.com>
 <8bd3f10a-bc98-08e3-c54c-8ee10aa35db2@gmail.com>
 <CALyqOb_OOQQg+UXiv1yvxo5nDGmaAucuNRqa9Sn43H9sE6xmZw@mail.gmail.com>
 <a57fcbdf-b97f-28c4-3051-0a3e29afec76@gmail.com>
Message-ID: <CALyqOb8c41vV_uHPPzAqtRnLWxr6BTGnY60ZYkyxeJhfjf-3QQ@mail.gmail.com>

I see, thanks. I filed here:

https://bugs.r-project.org/show_bug.cgi?id=18292

Best,
Yutani

2022?1?27?(?) 1:35 Tomas Kalibera <tomas.kalibera at gmail.com>:
>
> Hi Yutani,
>
> On 1/26/22 16:42, Hiroaki Yutani wrote:
> > Hi Tomas,
> >
> > Thanks, but, if I understand correctly, there's no room to call the
> > Rust allocator's "free" function in the case of `DevDesc`. A `DevDesc`
> > is supposed to be freed in `GEdestroyDevDesc()` when the device is
> > closed. If I free it by myself, it would cause double-free.
> >
> > So, now I'm wondering if it makes sense that R provides either an API
> > that creates a `DevDesc` instance, or one that accepts a custom
> > allocator for DevDesc. But, as I expect this is a minor use case, I'm
> > not confident enough this would be meaningful.
> > I might end up filing such a feature request on Bugzilla, but let me
> > hold off for a while.
>
> I see. If you are using the public interface and it allows you to
> (indirectly) free the devices, it should allow you also to allocate
> them. So yes, please file a bug report and please provide enough context
> there so that the report is self-sufficient.
>
> Beyond the general rule than any API allowing to allocate or free needs
> to allow both, I'd leave this to the experts on graphics in R.
>
> Thanks,
> Tomas
>
> >
> > Best,
> > Yutani
> >
> > 2022?1?27?(?) 0:21 Tomas Kalibera <tomas.kalibera at gmail.com>:
> >>
> >> On 1/26/22 15:44, Hiroaki Yutani wrote:
> >>> Hi Tomas,
> >>>
> >>> Thanks for your helpful advice. This time, it seems the cause of the
> >>> error was an allocator mismatch; I mistakenly allocated the struct on
> >>> Rust's side, which means it's allocated by Rust's allocator, but a
> >>> `DevDesc` is to be freed on R's side. The problem is solved by using
> >>> libc::calloc(), which allocates using the C runtime's allocator, and
> >>> compiling it with the same toolchain that compiles R.
> >> Hi Yutani,
> >>
> >> congratulations on tracing it down.
> >>
> >> Particularly on Windows, whenever a DLL (or any API) is providing a
> >> function to allocate anything, it should provide also a function to free
> >> it, and only that function should be used to do so, even if it is just a
> >> wrapper for malloc() etc. So I would recommend following that, there
> >> should be a Rust allocator's "free" function which you could then call
> >> from R.
> >>
> >> Best
> >> Tomas
> >>
> >>> I also saw some errors when it relates to GC, so it might be some
> >>> PROTECT issue. Thanks for the hint.
> >>>
> >>> During debugging, I learned a lot about how to build R with DEBUG=T
> >>> and use gdb, and it really helped me. I'm yet to unlock the power of
> >>> WinDBG, but I will try next time...
> >>>
> >>> Best,
> >>> Yutani
> >>>
> >>> 2022?1?26?(?) 23:20 Tomas Kalibera <tomas.kalibera at gmail.com>:
> >>>
> >>>> Hi Yutani,
> >>>>
> >>>> if you haven't done that already, I would recommend building R with
> >>>> debug symbols (DEBUG=T, so that make file don't strip them) and with -O0
> >>>> (no optimizations), so that the debug symbols are more accurate. Without
> >>>> that, the stack traces can be very misleading. You might try both with
> >>>> windbg and gdb, sometimes one of them provides an extra hint. Ideally
> >>>> you would also build the involved package(s) the same way.
> >>>>
> >>>> Then, it is important to check where the free() is called from, whether
> >>>> it is directly or from the GC. In both cases (but more likely in the
> >>>> latter), it could be caused by somewhat unrelated memory corruption,
> >>>> which may be hard to find - e.g. possibly a PROTECT error. Running with
> >>>> gctorture() might help, if gctorture() changes where the crash happens,
> >>>> it is more likely a somewhat unrelated memory corruption.
> >>>>
> >>>> If it were a double-free or similar allocation error inside R itself (or
> >>>> some of the involved packages), it would be easy to find with a debugger.
> >>>>
> >>>> If debugging this way does not help, you can try narrowing down the
> >>>> example, while preserving the crash. That may make debugging easier, and
> >>>> if you eventually get to a point that you have a reproducible example
> >>>> involving only base R and base packages, you know it is a bug in R, and
> >>>> can submit that in a bug report for others to debug.
> >>>>
> >>>> Best
> >>>> Tomas
> >>>>
> >>>> On 1/22/22 10:50, Hiroaki Yutani wrote:
> >>>>> Hi,
> >>>>>
> >>>>> I'm trying to create a Rust library that can implement an R graphic
> >>>>> device[1], but the R session crashes on `dev.off()` on Windows with R
> >>>>> 4.1.2. Strangely, it works without errors on Linux, on macOS, and even
> >>>>> on Windows with R-devel.
> >>>>>
> >>>>> Looking at the stack trace below by WinDbg, the problem is probably
> >>>>> that either of the two free()s in GEdestroyDevDesc() tries to free
> >>>>> some memory that was already freed (I'm a very beginner of this kind
> >>>>> of debugging, so I might be wrong).
> >>>>>
> >>>>>        # Child-SP          RetAddr               Call Site
> >>>>>        00 00000000`0441cb70 00007ffb`3df0be63     ntdll!RtlReportFatalFailure+0x9
> >>>>>        01 00000000`0441cbc0 00007ffb`3df14c82
> >>>>> ntdll!RtlReportCriticalFailure+0x97
> >>>>>        ...snip...
> >>>>>        08 00000000`0441cfc0 00007ffb`3c30c6ac     ntdll!RtlFreeHeap+0x51
> >>>>>        09 00000000`0441d000 00000000`6c7bcf99     msvcrt!free+0x1c
> >>>>>        0a 00000000`0441d030 00000000`6c79e7de     R!GEdestroyDevDesc+0x59
> >>>>>        0b 00000000`0441d080 00000000`6fc828e9     R!GEcurrentDevice+0x37e
> >>>>>        0c 00000000`0441d0f0 00000000`6c7a15fa     grDevices!devoff+0x59
> >>>>>        ...snip...
> >>>>>
> >>>>> But, I found no difference in the related code (around devoff() and
> >>>>> GEdestroyDevDesc()) between R 4.1.2 and R-devel. I know there are a
> >>>>> lot of feature additions in R-devel, but I don't think it affects
> >>>>> here. Is there anyone who suffered from similar crashes? Am I missing
> >>>>> something?
> >>>>>
> >>>>> I would appreciate any advice.
> >>>>>
> >>>>> Best,
> >>>>> Yutani
> >>>>>
> >>>>> [1]: https://github.com/extendr/extendr/pull/360
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-package-devel at r-project.org mailing list
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 15:55:49 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 08:55:49 -0600
Subject: [R-pkg-devel] Is using global assignment in package tests allowed?
Message-ID: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>

Hello,

I'm writing unit tests using testthat for a package that we want to submit
to CRAN. Because of some aspect of how testthat works (which is beyond my
ken), I have only been able to get my tests to work by using global
assignment (<<-) to create some objects on which the tests are then run.
However, per CRAN policy: "Packages should not modify the global
environment (user?s workspace)."

Does anyone know whether this policy applies to all code within the
package, including unit tests? Or does it apply just to the code and
functions in /R?
Or to all code that is executed as part of checking the package (i.e., code
that is never run can use <<-)?

James

	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Thu Jan 27 16:20:57 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Thu, 27 Jan 2022 07:20:57 -0800
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
Message-ID: <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>

I don't know the answer to your question, but "beyond my ken" doesn't sound like a very convincing reason. Mucking with any environment that isn't yours is asking for trouble... the behavior you depend on today may come into conflict with the code you are coordinating with when you least expect it.

Is your code in a public version control repo?

On January 27, 2022 6:55:49 AM PST, James Pustejovsky <jepusto at gmail.com> wrote:
>Hello,
>
>I'm writing unit tests using testthat for a package that we want to submit
>to CRAN. Because of some aspect of how testthat works (which is beyond my
>ken), I have only been able to get my tests to work by using global
>assignment (<<-) to create some objects on which the tests are then run.
>However, per CRAN policy: "Packages should not modify the global
>environment (user?s workspace)."
>
>Does anyone know whether this policy applies to all code within the
>package, including unit tests? Or does it apply just to the code and
>functions in /R?
>Or to all code that is executed as part of checking the package (i.e., code
>that is never run can use <<-)?
>
>James
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Jan 27 16:26:59 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 27 Jan 2022 18:26:59 +0300
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
Message-ID: <20220127182659.12cc391c@Tarkus>

On Thu, 27 Jan 2022 08:55:49 -0600
James Pustejovsky <jepusto at gmail.com> wrote:

> Because of some aspect of how testthat works (which is beyond my
> ken), I have only been able to get my tests to work by using global
> assignment (<<-) to create some objects on which the tests are then
> run.

What are you trying to achieve? Perhaps there's a better way to do
that. I think that you can ask testthat-specific questions at
<https://community.rstudio.com/> if they turn out to be too far from
base R.

> Does anyone know whether this policy applies to all code within the
> package, including unit tests? Or does it apply just to the code and
> functions in /R?

I'm not a CRAN member, but I think that the spirit of the rule only
covers the user-accessible code, and tests aren't typically run in the
same R session where the user objects live. For the same reason, I
think that it's acceptable to test internal interfaces you don't want
to export by calling them by means of package:::function.

-- 
Best regards,
Ivan


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 16:28:58 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 09:28:58 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
Message-ID: <CAFUVuJyDaNeEQizLn5L8u6+x55=YkbKR2w-qxN88NXRPwFLaig@mail.gmail.com>

Thanks for your perspective. Re: "beyond my ken" I'm just being honest. My
operating assumption was that the unit testing code is run in its own
process and therefore that using global assignment would be okay (i.e., not
mucking with someone else's environment). But perhaps I'm being naive.

The package is on Github here: https://github.com/meghapsimatrix/wildmeta/
The tests that use global assignment are:
https://github.com/meghapsimatrix/wildmeta/blob/main/tests/testthat/test-rma-mv-methods.R
https://github.com/meghapsimatrix/wildmeta/blob/main/tests/testthat/test-missing-value-handling.R


On Thu, Jan 27, 2022 at 9:20 AM Jeff Newmiller <jdnewmil at dcn.davis.ca.us>
wrote:

> I don't know the answer to your question, but "beyond my ken" doesn't
> sound like a very convincing reason. Mucking with any environment that
> isn't yours is asking for trouble... the behavior you depend on today may
> come into conflict with the code you are coordinating with when you least
> expect it.
>
> Is your code in a public version control repo?
>
> On January 27, 2022 6:55:49 AM PST, James Pustejovsky <jepusto at gmail.com>
> wrote:
> >Hello,
> >
> >I'm writing unit tests using testthat for a package that we want to submit
> >to CRAN. Because of some aspect of how testthat works (which is beyond my
> >ken), I have only been able to get my tests to work by using global
> >assignment (<<-) to create some objects on which the tests are then run.
> >However, per CRAN policy: "Packages should not modify the global
> >environment (user?s workspace)."
> >
> >Does anyone know whether this policy applies to all code within the
> >package, including unit tests? Or does it apply just to the code and
> >functions in /R?
> >Or to all code that is executed as part of checking the package (i.e.,
> code
> >that is never run can use <<-)?
> >
> >James
> >
> >       [[alternative HTML version deleted]]
> >
> >______________________________________________
> >R-package-devel at r-project.org mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> Sent from my phone. Please excuse my brevity.
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Thu Jan 27 16:40:14 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 27 Jan 2022 09:40:14 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
Message-ID: <25074.48350.241616.702973@rob.eddelbuettel.com>


On 27 January 2022 at 07:20, Jeff Newmiller wrote:
| I don't know the answer to your question, but "beyond my ken" doesn't sound like a very convincing reason. Mucking with any environment that isn't yours is asking for trouble... the behavior you depend on today may come into conflict with the code you are coordinating with when you least expect it.

Right on.

Yes a number of packages (of mine and other people) use a different approach
to maintain 'global state' without ... using 'global variables' (== bad).

The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then also
set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <- "foo"`
which you can later test for, alter, ... at will.

All without running afould of what `R CMD check --as-cran` may hate, all the
while maintaining your logic flow.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 16:56:17 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 09:56:17 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <25074.48350.241616.702973@rob.eddelbuettel.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
Message-ID: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>

But I am not using global variables at all in the package code (in
/R)---only for unit testing. Is this distinction relevant? Or do I need to
avoid global assignment even in the unit tests?

On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
> | I don't know the answer to your question, but "beyond my ken" doesn't
> sound like a very convincing reason. Mucking with any environment that
> isn't yours is asking for trouble... the behavior you depend on today may
> come into conflict with the code you are coordinating with when you least
> expect it.
>
> Right on.
>
> Yes a number of packages (of mine and other people) use a different
> approach
> to maintain 'global state' without ... using 'global variables' (== bad).
>
> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
> also
> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
> "foo"`
> which you can later test for, alter, ... at will.
>
> All without running afould of what `R CMD check --as-cran` may hate, all
> the
> while maintaining your logic flow.
>
> Dirk
>
> --
> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 17:11:49 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 11:11:49 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
Message-ID: <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>

On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
> But I am not using global variables at all in the package code (in
> /R)---only for unit testing. Is this distinction relevant? Or do I need to
> avoid global assignment even in the unit tests?

CRAN may let you do what you are doing, but as Dirk and Jeff said, it 
could come back to bite you later.  For example, you may create a 
variable named foo containing extremely valuable data, and then run your 
test.  (Tests can be run outside of R CMD check.)  If your test stomps 
on foo, you'll lose all that data.

It's worth using some trick like Dirk's to avoid this possibility.

Duncan Murdoch
> 
> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>>
>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>> | I don't know the answer to your question, but "beyond my ken" doesn't
>> sound like a very convincing reason. Mucking with any environment that
>> isn't yours is asking for trouble... the behavior you depend on today may
>> come into conflict with the code you are coordinating with when you least
>> expect it.
>>
>> Right on.
>>
>> Yes a number of packages (of mine and other people) use a different
>> approach
>> to maintain 'global state' without ... using 'global variables' (== bad).
>>
>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>> also
>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>> "foo"`
>> which you can later test for, alter, ... at will.
>>
>> All without running afould of what `R CMD check --as-cran` may hate, all
>> the
>> while maintaining your logic flow.
>>
>> Dirk
>>
>> --
>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Thu Jan 27 17:18:28 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 27 Jan 2022 11:18:28 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
Message-ID: <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>

   I will chime in briefly.

   I have spent hours trying to understand the scoping behaviour of 
testthat, mostly without success. I have lots of examples where I have 
tests that fail *only* when running devtools::check(), but not when 
running test_that in an interactive session, or in the same code run via 
source() or in an R batch session.  So I am quite sympathetic to "beyond 
my ken".

   I agree that it's best to understand everything so that you can know 
when you might run into trouble in the future, but I have sometimes 
reconciled myself to giving up when it seemed I was spending much more 
time debugging my tests than debugging the actual package code ...

   For what it's worth, I have found that running <<- in these contexts 
doesn't seem to bother CRAN at all -- possibly because it's the *tests* 
that are potentially modifying the global environment, not the package 
itself.

   If you think about it, a prohibition on modifying the global 
environment in tests would mean that a plain old test file that assigned 
variables as part of testing flow would change the environment.

On 1/27/22 10:56 AM, James Pustejovsky wrote:
> But I am not using global variables at all in the package code (in
> /R)---only for unit testing. Is this distinction relevant? Or do I need to
> avoid global assignment even in the unit tests?
> 
> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>>
>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>> | I don't know the answer to your question, but "beyond my ken" doesn't
>> sound like a very convincing reason. Mucking with any environment that
>> isn't yours is asking for trouble... the behavior you depend on today may
>> come into conflict with the code you are coordinating with when you least
>> expect it.
>>
>> Right on.
>>
>> Yes a number of packages (of mine and other people) use a different
>> approach
>> to maintain 'global state' without ... using 'global variables' (== bad).
>>
>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>> also
>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>> "foo"`
>> which you can later test for, alter, ... at will.
>>
>> All without running afould of what `R CMD check --as-cran` may hate, all
>> the
>> while maintaining your logic flow.
>>
>> Dirk
>>
>> --
>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 17:24:54 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 10:24:54 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
Message-ID: <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>

I suppose, but this seems like kind of a far-fetched possibility if you're
following any sort of reasonable scripting/development practices. Why in
the world would someone be working with extremely valuable data and then
decide to run all my package's unit tests interactively in the same session?

In any case, it sounds like I should either just skip these unit tests or
try to figure out what the heck is causing my namespace problems with
testthat.

On Thu, Jan 27, 2022 at 10:11 AM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
> > But I am not using global variables at all in the package code (in
> > /R)---only for unit testing. Is this distinction relevant? Or do I need
> to
> > avoid global assignment even in the unit tests?
>
> CRAN may let you do what you are doing, but as Dirk and Jeff said, it
> could come back to bite you later.  For example, you may create a
> variable named foo containing extremely valuable data, and then run your
> test.  (Tests can be run outside of R CMD check.)  If your test stomps
> on foo, you'll lose all that data.
>
> It's worth using some trick like Dirk's to avoid this possibility.
>
> Duncan Murdoch
> >
> > On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org>
> wrote:
> >
> >>
> >> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
> >> | I don't know the answer to your question, but "beyond my ken" doesn't
> >> sound like a very convincing reason. Mucking with any environment that
> >> isn't yours is asking for trouble... the behavior you depend on today
> may
> >> come into conflict with the code you are coordinating with when you
> least
> >> expect it.
> >>
> >> Right on.
> >>
> >> Yes a number of packages (of mine and other people) use a different
> >> approach
> >> to maintain 'global state' without ... using 'global variables' (==
> bad).
> >>
> >> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
> >> also
> >> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
> >> "foo"`
> >> which you can later test for, alter, ... at will.
> >>
> >> All without running afould of what `R CMD check --as-cran` may hate, all
> >> the
> >> while maintaining your logic flow.
> >>
> >> Dirk
> >>
> >> --
> >> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From @ergue|@@oko| @end|ng |rom gm@||@com  Thu Jan 27 17:31:12 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Thu, 27 Jan 2022 17:31:12 +0100
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
Message-ID: <535a87a2-8393-3c86-ca77-48e89404d9e0@gmail.com>

On 27/01/2022 16:56, James Pustejovsky wrote:
> But I am not using global variables at all in the package code (in
> /R)---only for unit testing.
The response of Dirk can be seen as: create myenv in your package but 
use it in your tests instead of globalenv. This way you must be safe.

Serguei.


>   Is this distinction relevant? Or do I need to
> avoid global assignment even in the unit tests?
>
> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
>
>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>> | I don't know the answer to your question, but "beyond my ken" doesn't
>> sound like a very convincing reason. Mucking with any environment that
>> isn't yours is asking for trouble... the behavior you depend on today may
>> come into conflict with the code you are coordinating with when you least
>> expect it.
>>
>> Right on.
>>
>> Yes a number of packages (of mine and other people) use a different
>> approach
>> to maintain 'global state' without ... using 'global variables' (== bad).
>>
>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>> also
>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>> "foo"`
>> which you can later test for, alter, ... at will.
>>
>> All without running afould of what `R CMD check --as-cran` may hate, all
>> the
>> while maintaining your logic flow.
>>
>> Dirk
>>
>> --
>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From n|u|tz @end|ng |rom gm@||@com  Thu Jan 27 17:35:10 2022
From: n|u|tz @end|ng |rom gm@||@com (Neal Fultz)
Date: Thu, 27 Jan 2022 08:35:10 -0800
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
 <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
Message-ID: <CAL9B2vdVKYg=hqD-HuS4B2UEcvRvmXxcH99RLmgQxnu73ocTzA@mail.gmail.com>

I believe, in base R, package tests scripts are run sequentially in clean
sessions via R CMD BATCH. Test scripts can load packages, load data, etc,
but the state is lost from script to script.

Not sure about testthat tests / rstudio run tests button, because iirc it
recursively loads other scripts from a shim within a single job.

If I had to choose between writing a normal function, or a complicated
function that works with testthat scoping, I'd opt for the normal one.

On Thu, Jan 27, 2022 at 8:25 AM James Pustejovsky <jepusto at gmail.com> wrote:

> I suppose, but this seems like kind of a far-fetched possibility if you're
> following any sort of reasonable scripting/development practices. Why in
> the world would someone be working with extremely valuable data and then
> decide to run all my package's unit tests interactively in the same
> session?
>
> In any case, it sounds like I should either just skip these unit tests or
> try to figure out what the heck is causing my namespace problems with
> testthat.
>
> On Thu, Jan 27, 2022 at 10:11 AM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
>
> > On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
> > > But I am not using global variables at all in the package code (in
> > > /R)---only for unit testing. Is this distinction relevant? Or do I need
> > to
> > > avoid global assignment even in the unit tests?
> >
> > CRAN may let you do what you are doing, but as Dirk and Jeff said, it
> > could come back to bite you later.  For example, you may create a
> > variable named foo containing extremely valuable data, and then run your
> > test.  (Tests can be run outside of R CMD check.)  If your test stomps
> > on foo, you'll lose all that data.
> >
> > It's worth using some trick like Dirk's to avoid this possibility.
> >
> > Duncan Murdoch
> > >
> > > On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org>
> > wrote:
> > >
> > >>
> > >> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
> > >> | I don't know the answer to your question, but "beyond my ken"
> doesn't
> > >> sound like a very convincing reason. Mucking with any environment that
> > >> isn't yours is asking for trouble... the behavior you depend on today
> > may
> > >> come into conflict with the code you are coordinating with when you
> > least
> > >> expect it.
> > >>
> > >> Right on.
> > >>
> > >> Yes a number of packages (of mine and other people) use a different
> > >> approach
> > >> to maintain 'global state' without ... using 'global variables' (==
> > bad).
> > >>
> > >> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to
> then
> > >> also
> > >> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]]
> <-
> > >> "foo"`
> > >> which you can later test for, alter, ... at will.
> > >>
> > >> All without running afould of what `R CMD check --as-cran` may hate,
> all
> > >> the
> > >> while maintaining your logic flow.
> > >>
> > >> Dirk
> > >>
> > >> --
> > >> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> > >>
> > >
> > >       [[alternative HTML version deleted]]
> > >
> > > ______________________________________________
> > > R-package-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Thu Jan 27 17:43:16 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 27 Jan 2022 10:43:16 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
Message-ID: <25074.52132.158815.121498@rob.eddelbuettel.com>


On 27 January 2022 at 11:18, Ben Bolker wrote:
|    I have spent hours trying to understand the scoping behaviour of 
| testthat, mostly without success. 

It may bear repeating that use of a test runner package is NOT required by
CRAN Repo Policy, Writing R Extensions, or any other official text.

If any one of these candidate packages is too complicated, or confusing, or
lengthens your test setup, or [your reason here] then consider not using it.

Choice is a good thing, and we have a free option of using one or none of the
different available testing packages. 

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 17:53:12 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 11:53:12 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <363e7ba5-8f5d-40ae-401b-2121b820d92b@gmail.com>
 <CAFUVuJx2WVYYdCQAMWr64WJzj7p805jLrXxGaXh9rqCty5dpyw@mail.gmail.com>
Message-ID: <0934f48c-3654-0fcd-873d-3c0b3ed21c08@gmail.com>

On 27/01/2022 11:24 a.m., James Pustejovsky wrote:
> I suppose, but this seems like kind of a far-fetched possibility if 
> you're following any sort of reasonable scripting/development practices. 
> Why in the world would someone be working with extremely valuable data 
> and then decide to run all my package's unit tests interactively in the 
> same session?

Perhaps "extremely" was an exaggeration, but it's not that far-fetched 
for someone to notice a problem in your package and want to make a 
change and test it.

Your first test stomps on oswald2013, V, mod_A, mod_B, mod_C1, and about 
20 other variables.  That seems kind of excessive to me.

Duncan Murdoch

> 
> In any case, it sounds like I should either just skip these unit tests 
> or try to figure out what the heck is causing my namespace problems with 
> testthat.
> 
> On Thu, Jan 27, 2022 at 10:11 AM Duncan Murdoch 
> <murdoch.duncan at gmail.com <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     On 27/01/2022 10:56 a.m., James Pustejovsky wrote:
>      > But I am not using global variables at all in the package code (in
>      > /R)---only for unit testing. Is this distinction relevant? Or do
>     I need to
>      > avoid global assignment even in the unit tests?
> 
>     CRAN may let you do what you are doing, but as Dirk and Jeff said, it
>     could come back to bite you later.? For example, you may create a
>     variable named foo containing extremely valuable data, and then run
>     your
>     test.? (Tests can be run outside of R CMD check.)? If your test stomps
>     on foo, you'll lose all that data.
> 
>     It's worth using some trick like Dirk's to avoid this possibility.
> 
>     Duncan Murdoch
>      >
>      > On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org
>     <mailto:edd at debian.org>> wrote:
>      >
>      >>
>      >> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>      >> | I don't know the answer to your question, but "beyond my ken"
>     doesn't
>      >> sound like a very convincing reason. Mucking with any
>     environment that
>      >> isn't yours is asking for trouble... the behavior you depend on
>     today may
>      >> come into conflict with the code you are coordinating with when
>     you least
>      >> expect it.
>      >>
>      >> Right on.
>      >>
>      >> Yes a number of packages (of mine and other people) use a different
>      >> approach
>      >> to maintain 'global state' without ... using 'global variables'
>     (== bad).
>      >>
>      >> The trick is something like `pkgenv <- new.env()` in R/zzz.R and
>     to then
>      >> also
>      >> set an option or two you need in .onLoad as eg 
>     `pkgenv[["prefence"]] <-
>      >> "foo"`
>      >> which you can later test for, alter, ... at will.
>      >>
>      >> All without running afould of what `R CMD check --as-cran` may
>     hate, all
>      >> the
>      >> while maintaining your logic flow.
>      >>
>      >> Dirk
>      >>
>      >> --
>      >> https://dirk.eddelbuettel.com <https://dirk.eddelbuettel.com> |
>     @eddelbuettel | edd at debian.org <mailto:edd at debian.org>
>      >>
>      >
>      >? ? ? ?[[alternative HTML version deleted]]
>      >
>      > ______________________________________________
>      > R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From jepu@to @end|ng |rom gm@||@com  Thu Jan 27 18:02:39 2022
From: jepu@to @end|ng |rom gm@||@com (James Pustejovsky)
Date: Thu, 27 Jan 2022 11:02:39 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <25074.52132.158815.121498@rob.eddelbuettel.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <25074.52132.158815.121498@rob.eddelbuettel.com>
Message-ID: <CAFUVuJxEimhAHXKgV6UD3NCedWzj+D6bNo9f0x7V7t3BzOYRJA@mail.gmail.com>

Yes, that's a good point. Thanks for the reminder.

On Thu, Jan 27, 2022 at 10:52 AM Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 27 January 2022 at 11:18, Ben Bolker wrote:
> |    I have spent hours trying to understand the scoping behaviour of
> | testthat, mostly without success.
>
> It may bear repeating that use of a test runner package is NOT required by
> CRAN Repo Policy, Writing R Extensions, or any other official text.
>
> If any one of these candidate packages is too complicated, or confusing, or
> lengthens your test setup, or [your reason here] then consider not using
> it.
>
> Choice is a good thing, and we have a free option of using one or none of
> the
> different available testing packages.
>
> Dirk
>
> --
> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 18:07:31 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 12:07:31 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
Message-ID: <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>

On 27/01/2022 11:18 a.m., Ben Bolker wrote:
>     I will chime in briefly.
> 
>     I have spent hours trying to understand the scoping behaviour of
> testthat, mostly without success. I have lots of examples where I have
> tests that fail *only* when running devtools::check(), but not when
> running test_that in an interactive session, or in the same code run via
> source() or in an R batch session.  So I am quite sympathetic to "beyond
> my ken".
> 
>     I agree that it's best to understand everything so that you can know
> when you might run into trouble in the future, but I have sometimes
> reconciled myself to giving up when it seemed I was spending much more
> time debugging my tests than debugging the actual package code ...
> 
>     For what it's worth, I have found that running <<- in these contexts
> doesn't seem to bother CRAN at all -- possibly because it's the *tests*
> that are potentially modifying the global environment, not the package
> itself.
> 
>     If you think about it, a prohibition on modifying the global
> environment in tests would mean that a plain old test file that assigned
> variables as part of testing flow would change the environment.

Yes, tests should be able to create variables, but they shouldn't go 
overboard.  A test like

    x <- 1
    stopifnot(x == 1)

will wipe out x, but that's probably not such a big deal.  On the other 
hand, a test like

    c <<- function(...) stop('do not do this!')
    testthat::expect_error(c(1))

is probably not a good idea.

Duncan Murdoch

> 
> On 1/27/22 10:56 AM, James Pustejovsky wrote:
>> But I am not using global variables at all in the package code (in
>> /R)---only for unit testing. Is this distinction relevant? Or do I need to
>> avoid global assignment even in the unit tests?
>>
>> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> wrote:
>>
>>>
>>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>>> | I don't know the answer to your question, but "beyond my ken" doesn't
>>> sound like a very convincing reason. Mucking with any environment that
>>> isn't yours is asking for trouble... the behavior you depend on today may
>>> come into conflict with the code you are coordinating with when you least
>>> expect it.
>>>
>>> Right on.
>>>
>>> Yes a number of packages (of mine and other people) use a different
>>> approach
>>> to maintain 'global state' without ... using 'global variables' (== bad).
>>>
>>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to then
>>> also
>>> set an option or two you need in .onLoad as eg  `pkgenv[["prefence"]] <-
>>> "foo"`
>>> which you can later test for, alter, ... at will.
>>>
>>> All without running afould of what `R CMD check --as-cran` may hate, all
>>> the
>>> while maintaining your logic flow.
>>>
>>> Dirk
>>>
>>> --
>>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From bbo|ker @end|ng |rom gm@||@com  Thu Jan 27 18:11:55 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 27 Jan 2022 12:11:55 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
Message-ID: <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>



On 1/27/22 12:07 PM, Duncan Murdoch wrote:
> On 27/01/2022 11:18 a.m., Ben Bolker wrote:
>> ??? I will chime in briefly.
>>
>> ??? I have spent hours trying to understand the scoping behaviour of
>> testthat, mostly without success. I have lots of examples where I have
>> tests that fail *only* when running devtools::check(), but not when
>> running test_that in an interactive session, or in the same code run via
>> source() or in an R batch session.? So I am quite sympathetic to "beyond
>> my ken".
>>
>> ??? I agree that it's best to understand everything so that you can know
>> when you might run into trouble in the future, but I have sometimes
>> reconciled myself to giving up when it seemed I was spending much more
>> time debugging my tests than debugging the actual package code ...
>>
>> ??? For what it's worth, I have found that running <<- in these contexts
>> doesn't seem to bother CRAN at all -- possibly because it's the *tests*
>> that are potentially modifying the global environment, not the package
>> itself.
>>
>> ??? If you think about it, a prohibition on modifying the global
>> environment in tests would mean that a plain old test file that assigned
>> variables as part of testing flow would change the environment.
> 
> Yes, tests should be able to create variables, but they shouldn't go 
> overboard.? A test like
> 
>  ?? x <- 1
>  ?? stopifnot(x == 1)
> 
> will wipe out x, but that's probably not such a big deal.? On the other 
> hand, a test like
> 
>  ?? c <<- function(...) stop('do not do this!')
>  ?? testthat::expect_error(c(1))
> 
> is probably not a good idea.
> 
> Duncan Murdoch

   Fair enough.

   As to Dirk's comments about not being required to use a particular 
test platform, I'll just say: inertia/sunk costs. I will definitely 
consider using tinytest, or something else, in future projects ... (I do 
like some of the extra features offered by testing platforms over the 
base-R/vanilla "source() everything in the tests/ directory" approach.)

   cheers
     Ben Bolker
> 
>>
>> On 1/27/22 10:56 AM, James Pustejovsky wrote:
>>> But I am not using global variables at all in the package code (in
>>> /R)---only for unit testing. Is this distinction relevant? Or do I 
>>> need to
>>> avoid global assignment even in the unit tests?
>>>
>>> On Thu, Jan 27, 2022 at 9:40 AM Dirk Eddelbuettel <edd at debian.org> 
>>> wrote:
>>>
>>>>
>>>> On 27 January 2022 at 07:20, Jeff Newmiller wrote:
>>>> | I don't know the answer to your question, but "beyond my ken" doesn't
>>>> sound like a very convincing reason. Mucking with any environment that
>>>> isn't yours is asking for trouble... the behavior you depend on 
>>>> today may
>>>> come into conflict with the code you are coordinating with when you 
>>>> least
>>>> expect it.
>>>>
>>>> Right on.
>>>>
>>>> Yes a number of packages (of mine and other people) use a different
>>>> approach
>>>> to maintain 'global state' without ... using 'global variables' (== 
>>>> bad).
>>>>
>>>> The trick is something like `pkgenv <- new.env()` in R/zzz.R and to 
>>>> then
>>>> also
>>>> set an option or two you need in .onLoad as eg  
>>>> `pkgenv[["prefence"]] <-
>>>> "foo"`
>>>> which you can later test for, alter, ... at will.
>>>>
>>>> All without running afould of what `R CMD check --as-cran` may hate, 
>>>> all
>>>> the
>>>> while maintaining your logic flow.
>>>>
>>>> Dirk
>>>>
>>>> -- 
>>>> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>>
>>>
>>> ????[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jan 27 18:40:15 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 27 Jan 2022 12:40:15 -0500
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
 <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
Message-ID: <5ccd0375-5d85-9e33-f358-1c92ef284998@gmail.com>

On 27/01/2022 12:11 p.m., Ben Bolker wrote:
> 
> 
> On 1/27/22 12:07 PM, Duncan Murdoch wrote:
>> On 27/01/2022 11:18 a.m., Ben Bolker wrote:
>>>  ??? I will chime in briefly.
>>>
>>>  ??? I have spent hours trying to understand the scoping behaviour of
>>> testthat, mostly without success. I have lots of examples where I have
>>> tests that fail *only* when running devtools::check(), but not when
>>> running test_that in an interactive session, or in the same code run via
>>> source() or in an R batch session.? So I am quite sympathetic to "beyond
>>> my ken".
>>>
>>>  ??? I agree that it's best to understand everything so that you can know
>>> when you might run into trouble in the future, but I have sometimes
>>> reconciled myself to giving up when it seemed I was spending much more
>>> time debugging my tests than debugging the actual package code ...
>>>
>>>  ??? For what it's worth, I have found that running <<- in these contexts
>>> doesn't seem to bother CRAN at all -- possibly because it's the *tests*
>>> that are potentially modifying the global environment, not the package
>>> itself.
>>>
>>>  ??? If you think about it, a prohibition on modifying the global
>>> environment in tests would mean that a plain old test file that assigned
>>> variables as part of testing flow would change the environment.
>>
>> Yes, tests should be able to create variables, but they shouldn't go
>> overboard.? A test like
>>
>>   ?? x <- 1
>>   ?? stopifnot(x == 1)
>>
>> will wipe out x, but that's probably not such a big deal.? On the other
>> hand, a test like
>>
>>   ?? c <<- function(...) stop('do not do this!')
>>   ?? testthat::expect_error(c(1))
>>
>> is probably not a good idea.
>>
>> Duncan Murdoch
> 
>     Fair enough.
> 
>     As to Dirk's comments about not being required to use a particular
> test platform, I'll just say: inertia/sunk costs. I will definitely
> consider using tinytest, or something else, in future projects ... (I do
> like some of the extra features offered by testing platforms over the
> base-R/vanilla "source() everything in the tests/ directory" approach.)

Rather than just complaining, I'll try to offer some constructive 
advice.  The answer I just posted to this 9 year old question on 
StackOverflow probably won't help the original author, but maybe it's 
helpful to others:  https://stackoverflow.com/q/70702130/2554330 .

Though I don't use testthat enough to know if it will actually work.

Duncan Murdoch


From edd @end|ng |rom deb|@n@org  Thu Jan 27 19:18:46 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 27 Jan 2022 12:18:46 -0600
Subject: [R-pkg-devel] 
 Is using global assignment in package tests allowed?
In-Reply-To: <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
References: <CAFUVuJxhGcxgF-s5ebY7y9j2_9SbwawSm4VjpAfed7Y8UMuczA@mail.gmail.com>
 <954B6ACA-AAF4-459A-93AB-2156963E0054@dcn.davis.ca.us>
 <25074.48350.241616.702973@rob.eddelbuettel.com>
 <CAFUVuJyem4Luo87KdGLyhGMRaSWBHJBA+BQZm7CAG8p2JYfwtg@mail.gmail.com>
 <22b4c5b0-489c-be15-4f98-42d1431c25cc@gmail.com>
 <27a426bb-5d06-f6bb-5780-d611f82e49d3@gmail.com>
 <9d116419-9118-a6be-65d2-890641eb0260@gmail.com>
Message-ID: <25074.57862.271667.22128@rob.eddelbuettel.com>


On 27 January 2022 at 12:11, Ben Bolker wrote:
| I will definitely consider using tinytest, or something else, in future projects ... 

Every tinytest test file is a regular R script. That is the core feature.

No metaphysics, astrology, or tarot reading needed know what is happening. 

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Fri Jan 28 08:37:52 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Fri, 28 Jan 2022 08:37:52 +0100
Subject: [R-pkg-devel] =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
Message-ID: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>

Dear listers,

One user (in cc) has signaled a problem installing the package pgirmess 
(versin 1.7.1 on CRAN), with this message on loading:

> library(pgirmess)

Error: package or namespace load failed for ?pgirmess?:

Function found when exporting methods from the namespace ?raster? which 
is not S4 generic: ?all.equal?

In addition: Warning message:

no function found corresponding to methods exports from ?raster? for: 
?direction?, ?gridDistance?

I cannot identify where the trouble comes from since:

- pgirmess goes through OK in all the checks on CRAN

- I can install/remove it with correct loading on my own platform

- pgirmess 1.7.1 does not import 'raster' and the functions mentioned above

The user has installed the last R version on Windows.? However, she gets 
a correct loading only if she loads 'Matrix' before (or 'lme4' - but to 
my knowlege, lme4 actually loads Matrix).

She meets also the same issuer with pgirmess 2.0 (not on CRAN yet, see 
https://github.com/pgiraudoux/pgirmess however this version (still on 
test) has deprecated/dropped all functions related to dealing with rasters.

This occurs in R directly (not necessarily within RStudio).

On the web, Iook likes this issue has is already been spotted for some 
other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw 
that installing rtools might solve the problem (e.g. 
https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914) 
however, it seems to me a strange workaround since rtools should not be 
made necessary for lay R user (not developers).

Best,





	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Fri Jan 28 09:22:58 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Fri, 28 Jan 2022 09:22:58 +0100
Subject: [R-pkg-devel] =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
Message-ID: <b762d962-1e17-a944-6c13-8d5829d76c90@univ-fcomte.fr>

Dear listers,

One user (in cc) has signaled a problem installing the package pgirmess 
(versin 1.7.1 on CRAN), with this message on loading:

> library(pgirmess)

Error: package or namespace load failed for ?pgirmess?:

Function found when exporting methods from the namespace ?raster? which 
is not S4 generic: ?all.equal?

In addition: Warning message:

no function found corresponding to methods exports from ?raster? for: 
?direction?, ?gridDistance?

I cannot identify where the trouble comes from since:

- pgirmess goes through OK in all the checks on CRAN

- I can install/remove it with correct loading on my own platform

- pgirmess 1.7.1 does not import 'raster' and the functions mentioned above

The user has installed the last R version on Windows.? However, she gets 
a correct loading only if she loads 'Matrix' before (or 'lme4' - but to 
my knowlege, lme4 actually loads Matrix).

She meets also the same issuer with pgirmess 2.0 (not on CRAN yet, see 
https://github.com/pgiraudoux/pgirmess however this version (still on 
test) has deprecated/dropped all functions related to dealing with rasters.

This occurs in R directly (not necessarily within RStudio).

On the web, Iook likes this issue has is already been spotted for some 
other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw 
that installing rtools might solve the problem (e.g. 
https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914) 
however, it seems to me a strange workaround since rtools should not be 
made necessary for lay R user (not developers).

Best,





	[[alternative HTML version deleted]]


From zk@mv@r @end|ng |rom gm@||@com  Fri Jan 28 16:26:58 2022
From: zk@mv@r @end|ng |rom gm@||@com (Zhian Kamvar)
Date: Fri, 28 Jan 2022 07:26:58 -0800
Subject: [R-pkg-devel] 
	=?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
	=?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which?=
	=?utf-8?b?IGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwuZXF1YWzigJk=?=
In-Reply-To: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
Message-ID: <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>

The reason why Rtools was suggested was because CRAN takes some time for
the binaries to be built and people were trying to install it just after
raster was released.
The solution is for the user to re-install the raster package from CRAN in
a fresh R environment.

All the best,
Zhian


On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux <
patrick.giraudoux at univ-fcomte.fr> wrote:

> Dear listers,
>
> One user (in cc) has signaled a problem installing the package pgirmess
> (versin 1.7.1 on CRAN), with this message on loading:
>
> > library(pgirmess)
>
> Error: package or namespace load failed for ?pgirmess?:
>
> Function found when exporting methods from the namespace ?raster? which
> is not S4 generic: ?all.equal?
>
> In addition: Warning message:
>
> no function found corresponding to methods exports from ?raster? for:
> ?direction?, ?gridDistance?
>
> I cannot identify where the trouble comes from since:
>
> - pgirmess goes through OK in all the checks on CRAN
>
> - I can install/remove it with correct loading on my own platform
>
> - pgirmess 1.7.1 does not import 'raster' and the functions mentioned above
>
> The user has installed the last R version on Windows.  However, she gets
> a correct loading only if she loads 'Matrix' before (or 'lme4' - but to
> my knowlege, lme4 actually loads Matrix).
>
> She meets also the same issuer with pgirmess 2.0 (not on CRAN yet, see
> https://github.com/pgiraudoux/pgirmess however this version (still on
> test) has deprecated/dropped all functions related to dealing with rasters.
>
> This occurs in R directly (not necessarily within RStudio).
>
> On the web, Iook likes this issue has is already been spotted for some
> other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw
> that installing rtools might solve the problem (e.g.
>
> https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914)
>
> however, it seems to me a strange workaround since rtools should not be
> made necessary for lay R user (not developers).
>
> Best,
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Fri Jan 28 16:45:38 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Fri, 28 Jan 2022 16:45:38 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
In-Reply-To: <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
 <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
Message-ID: <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>

OK. Thanks Zhian. However what suprises me is that pgirmess namespace 
does not import any function from raster nor uses ?direction? or 
?gridDistance? and the package raster is not imported from the 
description file. raster is not in the Suggests either...

So I wonder why loading pgirmess can trigger such an error... and 
depends on loading other packages before (such as Matrix !)? in such 
case (but generally not, and never on CRAN checks).


Le 28/01/2022 ? 16:26, Zhian Kamvar a ?crit?:
> The reason why Rtools was suggested was because CRAN takes some time 
> for the binaries to be built and people were trying to install it just 
> after raster was released.
> The solution is for the user to re-install the raster package from 
> CRAN in a fresh R environment.
>
> All the best,
> Zhian
>
>
> On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux 
> <patrick.giraudoux at univ-fcomte.fr> wrote:
>
>     Dear listers,
>
>     One user (in cc) has signaled a problem installing the package
>     pgirmess
>     (versin 1.7.1 on CRAN), with this message on loading:
>
>     > library(pgirmess)
>
>     Error: package or namespace load failed for ?pgirmess?:
>
>     Function found when exporting methods from the namespace ?raster?
>     which
>     is not S4 generic: ?all.equal?
>
>     In addition: Warning message:
>
>     no function found corresponding to methods exports from ?raster? for:
>     ?direction?, ?gridDistance?
>
>     I cannot identify where the trouble comes from since:
>
>     - pgirmess goes through OK in all the checks on CRAN
>
>     - I can install/remove it with correct loading on my own platform
>
>     - pgirmess 1.7.1 does not import 'raster' and the functions
>     mentioned above
>
>     The user has installed the last R version on Windows. However, she
>     gets
>     a correct loading only if she loads 'Matrix' before (or 'lme4' -
>     but to
>     my knowlege, lme4 actually loads Matrix).
>
>     She meets also the same issuer with pgirmess 2.0 (not on CRAN yet,
>     see
>     https://github.com/pgiraudoux/pgirmess however this version (still on
>     test) has deprecated/dropped all functions related to dealing with
>     rasters.
>
>     This occurs in R directly (not necessarily within RStudio).
>
>     On the web, Iook likes this issue has is already been spotted for
>     some
>     other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw
>     that installing rtools might solve the problem (e.g.
>     https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914)
>
>     however, it seems to me a strange workaround since rtools should
>     not be
>     made necessary for lay R user (not developers).
>
>     Best,
>
>
>
>
>
>     ? ? ? ? [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From zk@mv@r @end|ng |rom gm@||@com  Fri Jan 28 17:35:47 2022
From: zk@mv@r @end|ng |rom gm@||@com (Zhian Kamvar)
Date: Fri, 28 Jan 2022 08:35:47 -0800
Subject: [R-pkg-devel] 
	=?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
	=?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which?=
	=?utf-8?b?IGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwuZXF1YWzigJk=?=
In-Reply-To: <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
 <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
 <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>
Message-ID: <CAPsXksJ_WjjQQkjNQyyjmqOkknm-3GufOVVXYvygn0EvgUVHPw@mail.gmail.com>

I've run into deep dependencies registering methods that mess things up
before: https://github.com/thibautjombart/adegenet/issues/308.
AFAICT, it has something to do with the way R deploys methods where they
can be available if the namespace is available. In this case, it's via
spdep -> spData -> raster. That being said, I am NOT an expert on this and
would like to know more if anyone has better insight.


On Fri, Jan 28, 2022 at 7:46 AM Patrick Giraudoux <
patrick.giraudoux at univ-fcomte.fr> wrote:

> OK. Thanks Zhian. However what suprises me is that pgirmess namespace
> does not import any function from raster nor uses ?direction? or
> ?gridDistance? and the package raster is not imported from the
> description file. raster is not in the Suggests either...
>
> So I wonder why loading pgirmess can trigger such an error... and
> depends on loading other packages before (such as Matrix !)  in such
> case (but generally not, and never on CRAN checks).
>
>
> Le 28/01/2022 ? 16:26, Zhian Kamvar a ?crit :
> > The reason why Rtools was suggested was because CRAN takes some time
> > for the binaries to be built and people were trying to install it just
> > after raster was released.
> > The solution is for the user to re-install the raster package from
> > CRAN in a fresh R environment.
> >
> > All the best,
> > Zhian
> >
> >
> > On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux
> > <patrick.giraudoux at univ-fcomte.fr> wrote:
> >
> >     Dear listers,
> >
> >     One user (in cc) has signaled a problem installing the package
> >     pgirmess
> >     (versin 1.7.1 on CRAN), with this message on loading:
> >
> >     > library(pgirmess)
> >
> >     Error: package or namespace load failed for ?pgirmess?:
> >
> >     Function found when exporting methods from the namespace ?raster?
> >     which
> >     is not S4 generic: ?all.equal?
> >
> >     In addition: Warning message:
> >
> >     no function found corresponding to methods exports from ?raster? for:
> >     ?direction?, ?gridDistance?
> >
> >     I cannot identify where the trouble comes from since:
> >
> >     - pgirmess goes through OK in all the checks on CRAN
> >
> >     - I can install/remove it with correct loading on my own platform
> >
> >     - pgirmess 1.7.1 does not import 'raster' and the functions
> >     mentioned above
> >
> >     The user has installed the last R version on Windows. However, she
> >     gets
> >     a correct loading only if she loads 'Matrix' before (or 'lme4' -
> >     but to
> >     my knowlege, lme4 actually loads Matrix).
> >
> >     She meets also the same issuer with pgirmess 2.0 (not on CRAN yet,
> >     see
> >     https://github.com/pgiraudoux/pgirmess however this version (still
> on
> >     test) has deprecated/dropped all functions related to dealing with
> >     rasters.
> >
> >     This occurs in R directly (not necessarily within RStudio).
> >
> >     On the web, Iook likes this issue has is already been spotted for
> >     some
> >     other packages (e.g. mapview, tmap, etc.). Checking help-lists I saw
> >     that installing rtools might solve the problem (e.g.
> >
> https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914
> )
> >
> >     however, it seems to me a strange workaround since rtools should
> >     not be
> >     made necessary for lay R user (not developers).
> >
> >     Best,
> >
> >
> >
> >
> >
> >             [[alternative HTML version deleted]]
> >
> >     ______________________________________________
> >     R-package-devel at r-project.org mailing list
> >     https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Sat Jan 29 07:43:03 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Sat, 29 Jan 2022 07:43:03 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?Issue=3A_Function_found_when_exporting_m?=
 =?utf-8?q?ethods_from_the_namespace_=E2=80=98raster=E2=80=99_which_is_not?=
 =?utf-8?b?IFM0IGdlbmVyaWM6IOKAmGFsbC5lcXVhbOKAmQ==?=
In-Reply-To: <CAPsXksJ_WjjQQkjNQyyjmqOkknm-3GufOVVXYvygn0EvgUVHPw@mail.gmail.com>
References: <61c20e5b-434c-1207-bc30-583226146a22@univ-fcomte.fr>
 <CAPsXks+cqQzWbMg_ezEnJ73x78UNOGiM5gBBnSS9mg=ng=pLQw@mail.gmail.com>
 <93d4871f-63d4-342a-552d-a7b43a1e0717@univ-fcomte.fr>
 <CAPsXksJ_WjjQQkjNQyyjmqOkknm-3GufOVVXYvygn0EvgUVHPw@mail.gmail.com>
Message-ID: <ed7b6070-2a00-4836-14fe-5601493ac93c@univ-fcomte.fr>

Clear enough ! Many thanks. Me too I am not an expert in this but at 
least, now, I understand it is not due to some mis-programming in the 
package. Hope that people able to deal with the R core an namespace 
management will handle this one day.

Best,

Patrick


Le 28/01/2022 ? 17:35, Zhian Kamvar a ?crit?:
> I've run into deep dependencies registering methods that mess things 
> up before: https://github.com/thibautjombart/adegenet/issues/308.
> AFAICT, it has something to do with the way R deploys methods where 
> they can be available if the namespace is available. In this case, 
> it's via spdep -> spData -> raster. That being said, I am NOT an 
> expert on this and would?like to know more if anyone has better insight.
>
>
> On Fri, Jan 28, 2022 at 7:46 AM Patrick Giraudoux 
> <patrick.giraudoux at univ-fcomte.fr> wrote:
>
>     OK. Thanks Zhian. However what suprises me is that pgirmess namespace
>     does not import any function from raster nor uses ?direction? or
>     ?gridDistance? and the package raster is not imported from the
>     description file. raster is not in the Suggests either...
>
>     So I wonder why loading pgirmess can trigger such an error... and
>     depends on loading other packages before (such as Matrix !) in such
>     case (but generally not, and never on CRAN checks).
>
>
>     Le 28/01/2022 ? 16:26, Zhian Kamvar a ?crit?:
>     > The reason why Rtools was suggested was because CRAN takes some
>     time
>     > for the binaries to be built and people were trying to install
>     it just
>     > after raster was released.
>     > The solution is for the user to re-install the raster package from
>     > CRAN in a fresh R environment.
>     >
>     > All the best,
>     > Zhian
>     >
>     >
>     > On Fri, Jan 28, 2022 at 6:03 AM Patrick Giraudoux
>     > <patrick.giraudoux at univ-fcomte.fr> wrote:
>     >
>     >? ? ?Dear listers,
>     >
>     >? ? ?One user (in cc) has signaled a problem installing the package
>     >? ? ?pgirmess
>     >? ? ?(versin 1.7.1 on CRAN), with this message on loading:
>     >
>     >? ? ?> library(pgirmess)
>     >
>     >? ? ?Error: package or namespace load failed for ?pgirmess?:
>     >
>     >? ? ?Function found when exporting methods from the namespace
>     ?raster?
>     >? ? ?which
>     >? ? ?is not S4 generic: ?all.equal?
>     >
>     >? ? ?In addition: Warning message:
>     >
>     >? ? ?no function found corresponding to methods exports from
>     ?raster? for:
>     >? ? ??direction?, ?gridDistance?
>     >
>     >? ? ?I cannot identify where the trouble comes from since:
>     >
>     >? ? ?- pgirmess goes through OK in all the checks on CRAN
>     >
>     >? ? ?- I can install/remove it with correct loading on my own
>     platform
>     >
>     >? ? ?- pgirmess 1.7.1 does not import 'raster' and the functions
>     >? ? ?mentioned above
>     >
>     >? ? ?The user has installed the last R version on Windows.
>     However, she
>     >? ? ?gets
>     >? ? ?a correct loading only if she loads 'Matrix' before (or 'lme4' -
>     >? ? ?but to
>     >? ? ?my knowlege, lme4 actually loads Matrix).
>     >
>     >? ? ?She meets also the same issuer with pgirmess 2.0 (not on
>     CRAN yet,
>     >? ? ?see
>     > https://github.com/pgiraudoux/pgirmess however this version
>     (still on
>     >? ? ?test) has deprecated/dropped all functions related to
>     dealing with
>     >? ? ?rasters.
>     >
>     >? ? ?This occurs in R directly (not necessarily within RStudio).
>     >
>     >? ? ?On the web, Iook likes this issue has is already been
>     spotted for
>     >? ? ?some
>     >? ? ?other packages (e.g. mapview, tmap, etc.). Checking
>     help-lists I saw
>     >? ? ?that installing rtools might solve the problem (e.g.
>     >
>     https://community.rstudio.com/t/error-package-or-namespace-load-failed-for-mapview/126914)
>     >
>     >? ? ?however, it seems to me a strange workaround since rtools should
>     >? ? ?not be
>     >? ? ?made necessary for lay R user (not developers).
>     >
>     >? ? ?Best,
>     >
>     >
>     >
>     >
>     >
>     >? ? ?? ? ? ? [[alternative HTML version deleted]]
>     >
>     >? ? ?______________________________________________
>     > R-package-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     >
>
>     ? ? ? ? [[alternative HTML version deleted]]
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Mon Jan 31 13:53:12 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Mon, 31 Jan 2022 13:53:12 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?=5BRd=5D_trouble_with_package_loading=3A?=
 =?utf-8?q?_Function_found_when_exporting_methods_from_the_namespace_?=
 =?utf-8?b?4oCYcmFzdGVy4oCZIHdoaWNoIGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwu?=
 =?utf-8?b?ZXF1YWzigJk=?=
In-Reply-To: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
References: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
Message-ID: <67417606-90c4-4107-ed5b-a1062fd2a158@univ-fcomte.fr>

This contribution below from Roger Bivand seems to answer the issue 
raised on this thread.

Actually it matches quite well Zhian and Duncan's suspicions, doesn'it ?

Best,

Patrick


-------- Message transf?r? --------
Sujet?: 	Follow-up on R-devel
Date?: 	Mon, 31 Jan 2022 12:23:57 +0000
De?: 	Roger Bivand <Roger.Bivand at nhh.no>
Pour?: 	Patrick Giraudoux <patrick.giraudoux at univ-fcomte.fr>



Dear Patrick,

Could you follow up on R-package-devel and R-devel that (from 
https://github.com/rspatial/terra/issues/514):
CRAN has not yet updated terra to 1.5-12 for R 4.1.2 (since two weeks it 
is still the previous version).

I will send a new version to CRAN this weekend, hopefully it will get 
build for windows. What happens is that raster is dependent on that 
version of terra (or later), so you should first do

install.packages('terra')

(once Windows terra_1.5-17.zip is published and on your mirror) and then

install.packages('raster')

Best wishes,

Roger
	[[alternative HTML version deleted]]


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 14:27:54 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 08:27:54 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
Message-ID: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>

Hi,

I am preparing a package for submission and having issues with R CMD check, both using the r-lib GitHub actions and r-hub. I keep getting the warning message:

* checking whether package ?toxpiR? can be installed ... WARNING
Found the following significant warnings:
  Warning: namespace ?DBI? is not available and has been replaced
See ?.../00install.out? for details.

I cannot replicate the warning while checking as-cran on my local machine. Going through the logs it?s clear that DBI is not getting installed, but I also do not know who/what is calling it. I see that knitr lists DBI in imports, so it?s odd to me that it?s not getting installed. I do not directly import or use any DBI functions. The easy solution would be to add DBI to ?Suggests? ? and that feels more like a bandaid than a good solution.

DBI is also being loaded into the Namespace when loading the package. From a clean session:

> library(toxpiR)
> sessionInfo()
R version 4.1.2 (2021-11-01)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Monterey 12.1

Matrix products: default
LAPACK: /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] toxpiR_0.1.0

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.8          knitr_1.37          magrittr_2.0.2      BiocGenerics_0.40.0 tidyselect_1.1.1    R6_2.5.1            rlang_1.0.0        
 [8] fastmap_1.1.0       fansi_1.0.2         stringr_1.4.0       dplyr_1.0.7         tools_4.1.2         grid_4.1.2          xfun_0.29          
[15] utf8_1.2.2          DBI_1.1.2           cli_3.1.1           ellipsis_0.3.2      htmltools_0.5.2     assertthat_0.2.1    yaml_2.2.2         
[22] digest_0.6.29       tibble_3.1.6        lifecycle_1.0.1     crayon_1.4.2        purrr_0.3.4         pryr_0.1.5          tidyr_1.1.4        
[29] vctrs_0.3.8         S4Vectors_0.32.3    codetools_0.2-18    glue_1.6.1          evaluate_0.14       rmarkdown_2.11      stringi_1.7.6      
[36] pillar_1.6.5        compiler_4.1.2      generics_0.1.1      stats4_4.1.2        pkgconfig_2.0.3    

Any help is greatly appreciated!! Below I have linked to the  r-hub results and the pasted the Desc/Namespace. 

Thank you!

Dayne Filer, PhD
UNC School of Medicine
Renaissance Computing Institute 

Links to the r-hub results:

Windows/dev: https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-36c4ff0f5ae348e7a5b28c15ca9d761d <https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-36c4ff0f5ae348e7a5b28c15ca9d761d>
Linux/release: https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-f631ce3fc55d44b98bc328f2886caf6c/ <https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-f631ce3fc55d44b98bc328f2886caf6c/>
Linux/dev: https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-d64875065b744735bd4991da2d2dc185/ <https://artifacts.r-hub.io/toxpiR_0.1.0.tar.gz-d64875065b744735bd4991da2d2dc185/>

The package DESCRIPTION:

Package: toxpiR
Type: Package
Title: Create ToxPi Prioritization Models
Version: 0.1.0
Authors at R: 
    c(person("Dayne L", "Filer", 
             role = c("aut"), 
             email = "dayne.filer at gmail.com",
             comment = c(ORCID = "0000-0002-3443-5315")),
      person("Dillon T", "Lloyd",
             role = "aut"),
      person("Preethi", "Thunga",
             role = "aut",
             comment = c(ORCID = "0000-0001-5447-0129")),
      person("Skylar W", "Marvel",
             role = "aut"),      
      person("David M", "Reif",
             role = c("aut", "cre"),
             email = "reif.david at gmail.com",
             comment = c(ORCID = "0000-0001-7815-6767")))
Description: 
  Enables users to build ToxPi prioritization models and provides 
  functionality within the grid framework for plotting ToxPi graphs.
  toxpiR allows for more customization than the ToxPi GUI (toxpi.org)
  and integration into existing workflows for greater ease-of-use, 
  reproducibility, and transparency.
  toxpiR package behaves nearly identically to the GUI; the package 
  documentation includes notes about all differences.
Imports: 
    grDevices,
    methods,
    S4Vectors,
    grid,
    rlang,
    stats,
    BiocGenerics,
    pryr,
    tidyr,
    utils
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.1.2
Roxygen: list(markdown = TRUE)
Depends: 
    R (>= 3.5.0)
Suggests: 
    rmarkdown,
    knitr,
    testthat (>= 3.0.0),
    covr
Config/testthat/edition: 3
Config/testthat/parallel: true
VignetteBuilder: knitr
License: GPL (>= 3)

Package NAMESPACE:

S3method(editDetails,pieGrob)
export(TxpModel)
export(TxpModelList)
export(TxpResultList)
export(TxpSlice)
export(TxpSliceList)
export(TxpTransFunc)
export(TxpTransFuncList)
export(as.TxpModelList)
export(as.TxpResultList)
export(as.TxpSliceList)
export(as.TxpTransFuncList)
export(grid.pieGridGrob)
export(grid.pieGrob)
export(pieGridGrob)
export(pieGrob)
export(txpCalculateScores)
export(txpImportGui)
exportClasses(TxpModel)
exportClasses(TxpModelList)
exportClasses(TxpResult)
exportClasses(TxpResultList)
exportClasses(TxpSlice)
exportClasses(TxpSliceList)
exportClasses(TxpTransFunc)
exportClasses(TxpTransFuncList)
exportMethods("[")
exportMethods("names<-")
exportMethods("txpIDs<-")
exportMethods("txpSlices<-")
exportMethods("txpTransFuncs<-")
exportMethods("txpValueNames<-")
exportMethods("txpWeights<-")
exportMethods(as.data.frame)
exportMethods(duplicated)
exportMethods(length)
exportMethods(merge)
exportMethods(names)
exportMethods(plot)
exportMethods(sort)
exportMethods(txpCalculateScores)
exportMethods(txpIDs)
exportMethods(txpModel)
exportMethods(txpRanks)
exportMethods(txpScores)
exportMethods(txpSliceScores)
exportMethods(txpSlices)
exportMethods(txpTransFuncs)
exportMethods(txpValueNames)
exportMethods(txpWeights)
import(grid)
import(methods)
importClassesFrom(S4Vectors,List)
importClassesFrom(S4Vectors,SimpleList)
importClassesFrom(S4Vectors,character_OR_NULL)
importFrom(BiocGenerics,as.data.frame)
importFrom(BiocGenerics,duplicated)
importFrom(BiocGenerics,sort)
importFrom(BiocGenerics,updateObject)
importFrom(S4Vectors,List)
importFrom(S4Vectors,classNameForDisplay)
importFrom(S4Vectors,coolcat)
importFrom(S4Vectors,new2)
importFrom(S4Vectors,setValidity2)
importFrom(grDevices,colorRampPalette)
importFrom(grDevices,extendrange)
importFrom(pryr,make_function)
importFrom(pryr,substitute_q)
importFrom(rlang,is_integerish)
importFrom(rlang,is_named)
importFrom(rlang,is_scalar_character)
importFrom(rlang,is_scalar_integerish)
importFrom(rlang,is_scalar_logical)
importFrom(stats,sd)
importFrom(tidyr,separate)
importFrom(utils,data)
importFrom(utils,read.csv)
importFrom(utils,type.convert)


	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Feb  1 15:27:44 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 1 Feb 2022 08:27:44 -0600
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
Message-ID: <25081.17248.899480.628292@rob.eddelbuettel.com>


Dayne,

When debugging, splitting concerns into separable buckets ofteb helps.
Submission to CRAN, contrary what an increasing number of people appear to
believe does _not_ require use of certain packages (none or in fact
required), documentation styles (though WRE mentioned markdown now, still no
requirement), testing frameworks -- or for that matter where you store your
code and how you test it. 

So in brief you could first concentrate on uploading your package, and
dealing with what R CMD check --as-cran and the test platforms (win-builder,
macbuilder, rhub, personal use of Docker or local machines, ...) give you.

And with that done, or in parallel, work out what goes off for you with
GitHub Actions_ which you are after all not required to use.  While there are
plenty of resources, I personally find the (widely used) GitHub Actions too
opaque and hard to debug / diagnose. I prefer a simpler scheme that relies on
a Docker container I provide (for my own use and use by others), and a setup
I can decompose and run (way more easily) locally. You can take a look at
https://eddelbuettel.github.io/r-ci/ and GitHub search should provide you
with a couple of usage examples.  That said, I am sure you will also find
helpful tips for use of GitHub Actions.

Cheers, Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Feb  1 16:14:01 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 1 Feb 2022 18:14:01 +0300
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
Message-ID: <20220201181401.0d1510e6@Tarkus>

On Tue, 1 Feb 2022 08:27:54 -0500
Dayne Filer <dayne.filer at gmail.com> wrote:

> I do not directly import or use any DBI functions.

00install.out says:

>> Warning: namespace ?DBI? is not available and has been replaced
>> by .GlobalEnv when processing object ?txp_example_model?

Should the txp_example_model object reference the DBI namespace?

I don't know the "right" solution here, but a similar problem has been
discussed here in R-pkg-devel some time ago:
https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html

You might have to depend on DBI explicitly because your data() object
uses it, but then `R CMD check` might object that you don't explicitly
import anything from it. One admittedly verbose way to work around that
would be to move the data file to inst/ and load it from
data/txp_example_model.R only after loadNamespace('DBI'), like some
data scripts do in the Matrix package.

-- 
Best regards,
Ivan


From p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r  Tue Feb  1 16:16:47 2022
From: p@tr|ck@g|r@udoux @end|ng |rom un|v-|comte@|r (Patrick Giraudoux)
Date: Tue, 1 Feb 2022 16:16:47 +0100
Subject: [R-pkg-devel] 
 =?utf-8?q?=5BRd=5D_trouble_with_package_loading=3A?=
 =?utf-8?q?_Function_found_when_exporting_methods_from_the_namespace_?=
 =?utf-8?b?4oCYcmFzdGVy4oCZIHdoaWNoIGlzIG5vdCBTNCBnZW5lcmljOiDigJhhbGwu?=
 =?utf-8?b?ZXF1YWzigJk=?=
In-Reply-To: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
References: <SV0P279MB04758AD91D4739D2BAA5F067EE259@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
Message-ID: <d18b5037-d2a2-3d1e-1400-b2bc2f29f5b5@univ-fcomte.fr>

A Master student of? us has just send us the way he has found to get out 
of the problem met. Here is the translation of his mail:

I have updated R to 4.1.2 using updateR() of the package installr from 
the R consol, specifying I want to keep the packages.

I have installed Rtools from there: 
https://cran.rstudio.com/bin/windows/Rtools/rtools40.html

Then I have opened the consol and applied:

write('PATH="${RTOOLS40_HOME}\\usr\\bin;${PATH}"', file = "~/.Renviron", 
append = TRUE)

then restarted R, and checked the RTools path applying:

Restart R, and verify that make can be found, which should show the path 
to your Rtools installation.

Sys.which("make")
## "C:\\rtools40\\usr\\bin\\make.exe"

then install.packages("terra", type = "source")

It has solved the problem, pgirmess work without trouble now.

This fit with Roger's info about late updates from *.tar.gz and *.zip? 
on CRAN messing a standard installation.

Best,

Patrick

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Feb  1 16:34:47 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 1 Feb 2022 09:34:47 -0600
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <20220201181401.0d1510e6@Tarkus>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
Message-ID: <25081.21271.277625.67460@rob.eddelbuettel.com>


On 1 February 2022 at 18:14, Ivan Krylov wrote:
| You might have to depend on DBI explicitly

Good point. That same issue hit me with two little test packages I built on
the weekend which started with a Imports: RPostgres and Imports: RPostgreSQL
(trying to compare something here) and when R / R CMD check whined (on the
simple attempt to connect) I shrugged I just added DBI.  Which shouldn't have
been necessary as DBI gets imported by either but I was in no mood to fight.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 18:13:33 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 12:13:33 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <20220201181401.0d1510e6@Tarkus>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
Message-ID: <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>

Thanks, Ivan! 

I completely missed the warning in the install.out file and had no idea where this was coming from. The object has a slot with a class inheriting from the S4Vectors package. Based on the very helpful thread you suggested, it appears that is the crux. The odd thing is that unlike the ade4 package which was NOT importing anything from the offending sp package, I list S4Vectors as an import. Why would, if the S4Vectors package has some dependencies on the DBI package (probably by way of the AnnotationDbi package?) would DBI not be installed? 

Thanks, All!

Dayne


> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
> 
> On Tue, 1 Feb 2022 08:27:54 -0500
> Dayne Filer <dayne.filer at gmail.com> wrote:
> 
>> I do not directly import or use any DBI functions.
> 
> 00install.out says:
> 
>>> Warning: namespace ?DBI? is not available and has been replaced
>>> by .GlobalEnv when processing object ?txp_example_model?
> 
> Should the txp_example_model object reference the DBI namespace?
> 
> I don't know the "right" solution here, but a similar problem has been
> discussed here in R-pkg-devel some time ago:
> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html
> 
> You might have to depend on DBI explicitly because your data() object
> uses it, but then `R CMD check` might object that you don't explicitly
> import anything from it. One admittedly verbose way to work around that
> would be to move the data file to inst/ and load it from
> data/txp_example_model.R only after loadNamespace('DBI'), like some
> data scripts do in the Matrix package.
> 
> -- 
> Best regards,
> Ivan


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 18:24:18 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 12:24:18 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <25081.21271.277625.67460@rob.eddelbuettel.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <25081.21271.277625.67460@rob.eddelbuettel.com>
Message-ID: <B4EE5953-B8E0-47F5-89A7-825C371ECC67@gmail.com>

Thanks, Dirk! 

I apologize ? your fist message went to my junk folder so I didn?t see until after my first response. I totally understand re: CRAN requirements. I thought maybe the issue was with how the GitHub actions script was setup, hence moving to r-hub. When they both gave the same answer, I then assumed it was real. 

I am also leaning towards adding to suggests and seeing if I can pass checks. It doesn?t detract from the package per se, I just find it odd that it doesn?t get installed, when it?s not MY package that requires it. You can go down the requirement trees (I haven?t done this for every package I import/suggest), but at least knitr -> DBI and S4Vectors -> AnnotationDbi -> DBI. How are these packages being installed during the test check without installing DBI?

Thanks, again!

Dayne

> On Feb 1, 2022, at 10:34 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> On 1 February 2022 at 18:14, Ivan Krylov wrote:
> | You might have to depend on DBI explicitly
> 
> Good point. That same issue hit me with two little test packages I built on
> the weekend which started with a Imports: RPostgres and Imports: RPostgreSQL
> (trying to compare something here) and when R / R CMD check whined (on the
> simple attempt to connect) I shrugged I just added DBI.  Which shouldn't have
> been necessary as DBI gets imported by either but I was in no mood to fight.
> 
> Dirk
> 
> -- 
> https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Feb  1 18:25:45 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 1 Feb 2022 12:25:45 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
Message-ID: <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>

On 01/02/2022 12:13 p.m., Dayne Filer wrote:
> Thanks, Ivan!
> 
> I completely missed the warning in the install.out file and had no idea where this was coming from. The object has a slot with a class inheriting from the S4Vectors package. Based on the very helpful thread you suggested, it appears that is the crux. The odd thing is that unlike the ade4 package which was NOT importing anything from the offending sp package, I list S4Vectors as an import. Why would, if the S4Vectors package has some dependencies on the DBI package (probably by way of the AnnotationDbi package?) would DBI not be installed?

S4Vectors is a Bioconductor package, and its current version (0.32.3) 
doesn't list any imports.  It has just one non-base dependency 
(BiocGenerics) and a list of 10 suggested packages.  These dependencies 
may be different if you have a different version.

Normally suggested packages of the one being tested are loaded, but not 
suggested packages of packages it uses.  So it's probably one of those 
suggested packages that needs DBI.

Duncan Murdoch

> 
> Thanks, All!
> 
> Dayne
> 
> 
>> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>
>> On Tue, 1 Feb 2022 08:27:54 -0500
>> Dayne Filer <dayne.filer at gmail.com> wrote:
>>
>>> I do not directly import or use any DBI functions.
>>
>> 00install.out says:
>>
>>>> Warning: namespace ?DBI? is not available and has been replaced
>>>> by .GlobalEnv when processing object ?txp_example_model?
>>
>> Should the txp_example_model object reference the DBI namespace?
>>
>> I don't know the "right" solution here, but a similar problem has been
>> discussed here in R-pkg-devel some time ago:
>> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html
>>
>> You might have to depend on DBI explicitly because your data() object
>> uses it, but then `R CMD check` might object that you don't explicitly
>> import anything from it. One admittedly verbose way to work around that
>> would be to move the data file to inst/ and load it from
>> data/txp_example_model.R only after loadNamespace('DBI'), like some
>> data scripts do in the Matrix package.
>>
>> -- 
>> Best regards,
>> Ivan
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@yne@|||er @end|ng |rom gm@||@com  Tue Feb  1 18:29:01 2022
From: d@yne@|||er @end|ng |rom gm@||@com (Dayne Filer)
Date: Tue, 1 Feb 2022 12:29:01 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
 <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>
Message-ID: <5EF08F68-A5C4-41C3-BBC1-2C5572C9E6DF@gmail.com>

I see. And yes, I could only track DBI down though suggests from knitr & S4Vectors. The best answer then, it to suggest DBI?

Thanks,

Dayne

> On Feb 1, 2022, at 12:25 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> On 01/02/2022 12:13 p.m., Dayne Filer wrote:
>> Thanks, Ivan!
>> I completely missed the warning in the install.out file and had no idea where this was coming from. The object has a slot with a class inheriting from the S4Vectors package. Based on the very helpful thread you suggested, it appears that is the crux. The odd thing is that unlike the ade4 package which was NOT importing anything from the offending sp package, I list S4Vectors as an import. Why would, if the S4Vectors package has some dependencies on the DBI package (probably by way of the AnnotationDbi package?) would DBI not be installed?
> 
> S4Vectors is a Bioconductor package, and its current version (0.32.3) doesn't list any imports.  It has just one non-base dependency (BiocGenerics) and a list of 10 suggested packages. These dependencies may be different if you have a different version.
> 
> Normally suggested packages of the one being tested are loaded, but not suggested packages of packages it uses.  So it's probably one of those suggested packages that needs DBI.
> 
> Duncan Murdoch
> 
>> Thanks, All!
>> Dayne
>>> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>>> 
>>> On Tue, 1 Feb 2022 08:27:54 -0500
>>> Dayne Filer <dayne.filer at gmail.com> wrote:
>>> 
>>>> I do not directly import or use any DBI functions.
>>> 
>>> 00install.out says:
>>> 
>>>>> Warning: namespace ?DBI? is not available and has been replaced
>>>>> by .GlobalEnv when processing object ?txp_example_model?
>>> 
>>> Should the txp_example_model object reference the DBI namespace?
>>> 
>>> I don't know the "right" solution here, but a similar problem has been
>>> discussed here in R-pkg-devel some time ago:
>>> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html
>>> 
>>> You might have to depend on DBI explicitly because your data() object
>>> uses it, but then `R CMD check` might object that you don't explicitly
>>> import anything from it. One admittedly verbose way to work around that
>>> would be to move the data file to inst/ and load it from
>>> data/txp_example_model.R only after loadNamespace('DBI'), like some
>>> data scripts do in the Matrix package.
>>> 
>>> -- 
>>> Best regards,
>>> Ivan
>> ______________________________________________
>> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel <https://stat.ethz.ch/mailman/listinfo/r-package-devel>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Feb  1 19:31:06 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 1 Feb 2022 13:31:06 -0500
Subject: [R-pkg-devel] DBI namespace not found on check
In-Reply-To: <5EF08F68-A5C4-41C3-BBC1-2C5572C9E6DF@gmail.com>
References: <14E5B75A-D31E-4132-815D-24B58ABFE035@gmail.com>
 <20220201181401.0d1510e6@Tarkus>
 <A3E12460-C098-4C35-9C2F-9458EB9B2007@gmail.com>
 <8e4c7123-c3d6-752f-165e-9e16a9f5a99d@gmail.com>
 <5EF08F68-A5C4-41C3-BBC1-2C5572C9E6DF@gmail.com>
Message-ID: <1dafe58d-bc4a-da69-925e-519bc74440ba@gmail.com>

On 01/02/2022 12:29 p.m., Dayne Filer wrote:
> I see. And yes, I could only track DBI down though suggests from knitr & 
> S4Vectors. The best answer then, it to suggest DBI?

That should be sufficient, but I think in the previous case it may have 
triggered a different message.

The theory is that your package should gracefully handle situations 
where suggested packages aren't present, by testing for them and falling 
back to some message to the user if they are not present.  The only way 
I know to do that for objects in the data directory is with a script to 
load them, as described in the previous thread.  Your script should work 
whether or not DBI can be loaded. If it can't be, it's fine to give a 
message (not an error) that you loaded a stub instead of the requested 
dataset (or maybe not to load anything at all, I'm not sure).

Duncan Murdoch

> 
> Thanks,
> 
> Dayne
> 
>> On Feb 1, 2022, at 12:25 PM, Duncan Murdoch <murdoch.duncan at gmail.com 
>> <mailto:murdoch.duncan at gmail.com>> wrote:
>>
>> On 01/02/2022 12:13 p.m., Dayne Filer wrote:
>>> Thanks, Ivan!
>>> I completely missed the warning in the install.out file and had no 
>>> idea where this was coming from. The object has a slot with a class 
>>> inheriting from the S4Vectors package. Based on the very helpful 
>>> thread you suggested, it appears that is the crux. The odd thing is 
>>> that unlike the ade4 package which was NOT importing anything from 
>>> the offending sp package, I list S4Vectors as an import. Why would, 
>>> if the S4Vectors package has some dependencies on the DBI package 
>>> (probably by way of the AnnotationDbi package?) would DBI not be 
>>> installed?
>>
>> S4Vectors is a Bioconductor package, and its current version (0.32.3) 
>> doesn't list any imports. ?It has just one non-base dependency 
>> (BiocGenerics) and a list of 10 suggested packages. These dependencies 
>> may be different if you have a different version.
>>
>> Normally suggested packages of the one being tested are loaded, but 
>> not suggested packages of packages it uses. ?So it's probably one of 
>> those suggested packages that needs DBI.
>>
>> Duncan Murdoch
>>
>>> Thanks, All!
>>> Dayne
>>>> On Feb 1, 2022, at 10:14 AM, Ivan Krylov <krylov.r00t at gmail.com 
>>>> <mailto:krylov.r00t at gmail.com>> wrote:
>>>>
>>>> On Tue, 1 Feb 2022 08:27:54 -0500
>>>> Dayne Filer <dayne.filer at gmail.com <mailto:dayne.filer at gmail.com>> 
>>>> wrote:
>>>>
>>>>> I do not directly import or use any DBI functions.
>>>>
>>>> 00install.out says:
>>>>
>>>>>> Warning: namespace ?DBI? is not available and has been replaced
>>>>>> by .GlobalEnv when processing object ?txp_example_model?
>>>>
>>>> Should the txp_example_model object reference the DBI namespace?
>>>>
>>>> I don't know the "right" solution here, but a similar problem has been
>>>> discussed here in R-pkg-devel some time ago:
>>>> https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html 
>>>> <https://stat.ethz.ch/pipermail/r-package-devel/2022q1/007633.html>
>>>>
>>>> You might have to depend on DBI explicitly because your data() object
>>>> uses it, but then `R CMD check` might object that you don't explicitly
>>>> import anything from it. One admittedly verbose way to work around that
>>>> would be to move the data file to inst/ and load it from
>>>> data/txp_example_model.R only after loadNamespace('DBI'), like some
>>>> data scripts do in the Matrix package.
>>>>
>>>> --
>>>> Best regards,
>>>> Ivan
>>> ______________________________________________
>>> R-package-devel at r-project.org 
>>> <mailto:R-package-devel at r-project.org>mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel 
>>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From p|owr|ght@@ndrew @end|ng |rom gm@||@com  Tue Feb  1 21:20:08 2022
From: p|owr|ght@@ndrew @end|ng |rom gm@||@com (Andrew Plowright)
Date: Tue, 1 Feb 2022 12:20:08 -0800
Subject: [R-pkg-devel] New 'extptr.as.ref' argument in identical() causing
 check failures
Message-ID: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>

Hello, I have an 'identical()' method in my library

https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198

I recently started getting a warning message regarding a new
'extptr.as.ref' argument that was added to R-devel in December. When
running devtools::check_rhub() I get:

```
* checking for code/documentation mismatches ... WARNING
identical
                 TRUE, ignore.bytecode = TRUE, ignore.environment =
                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
Codoc mismatches from documentation object 'identical':
  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
                 TRUE, ignore.bytecode = TRUE, ignore.environment =
                 FALSE, ignore.srcref = TRUE)
  Argument names in code not in docs:
    extptr.as.ref
```

I tried adding the 'extptr.as.ref' argument to my documentation, but now I
get a new warning:

```
  Documented arguments not in \usage in documentation object 'identical':

    'extptr.as.ref'
  Functions with \usage entries need to have the appropriate \alias
  entries, and all their arguments documented.
  The \usage entries must correspond to syntactically valid R code.
  See chapter 'Writing R documentation files' in the 'Writing R
  Extensions' manual.
```

So it seems that a warning is being generated both with or without the
extptr.as.ref in my documentation. Any help would be appreciated, thanks!

Andrew

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Feb  2 01:45:00 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 2 Feb 2022 13:45:00 +1300
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
Message-ID: <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>

Andrew,

you should not re-define identical, it is not a semantic operation and does NOT test equality. Did you mean to write a `==` method instead?

Cheers,
Simon



> On Feb 2, 2022, at 9:20 AM, Andrew Plowright <plowright.andrew at gmail.com> wrote:
> 
> Hello, I have an 'identical()' method in my library
> 
> https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> 
> I recently started getting a warning message regarding a new
> 'extptr.as.ref' argument that was added to R-devel in December. When
> running devtools::check_rhub() I get:
> 
> ```
> * checking for code/documentation mismatches ... WARNING
> identical
>                 TRUE, ignore.bytecode = TRUE, ignore.environment =
>                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
>  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> Codoc mismatches from documentation object 'identical':
>  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
>                 TRUE, ignore.bytecode = TRUE, ignore.environment =
>                 FALSE, ignore.srcref = TRUE)
>  Argument names in code not in docs:
>    extptr.as.ref
> ```
> 
> I tried adding the 'extptr.as.ref' argument to my documentation, but now I
> get a new warning:
> 
> ```
>  Documented arguments not in \usage in documentation object 'identical':
> 
>    'extptr.as.ref'
>  Functions with \usage entries need to have the appropriate \alias
>  entries, and all their arguments documented.
>  The \usage entries must correspond to syntactically valid R code.
>  See chapter 'Writing R documentation files' in the 'Writing R
>  Extensions' manual.
> ```
> 
> So it seems that a warning is being generated both with or without the
> extptr.as.ref in my documentation. Any help would be appreciated, thanks!
> 
> Andrew
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From p|owr|ght@@ndrew @end|ng |rom gm@||@com  Wed Feb  2 03:01:40 2022
From: p|owr|ght@@ndrew @end|ng |rom gm@||@com (Andrew Plowright)
Date: Tue, 1 Feb 2022 18:01:40 -0800
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
 <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
Message-ID: <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>

Hi Simon,

Thanks for your reply. I guess I could use == instead. What I want is a
method for checking if two S4 class objects are the same. I thought that ==
was strictly meant for atomic and list types?

Andrew

On Tue, Feb 1, 2022 at 4:45 PM Simon Urbanek <simon.urbanek at r-project.org>
wrote:

> Andrew,
>
> you should not re-define identical, it is not a semantic operation and
> does NOT test equality. Did you mean to write a `==` method instead?
>
> Cheers,
> Simon
>
>
>
> > On Feb 2, 2022, at 9:20 AM, Andrew Plowright <plowright.andrew at gmail.com>
> wrote:
> >
> > Hello, I have an 'identical()' method in my library
> >
> >
> https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> >
> > I recently started getting a warning message regarding a new
> > 'extptr.as.ref' argument that was added to R-devel in December. When
> > running devtools::check_rhub() I get:
> >
> > ```
> > * checking for code/documentation mismatches ... WARNING
> > identical
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
> >  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > Codoc mismatches from documentation object 'identical':
> >  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE)
> >  Argument names in code not in docs:
> >    extptr.as.ref
> > ```
> >
> > I tried adding the 'extptr.as.ref' argument to my documentation, but now
> I
> > get a new warning:
> >
> > ```
> >  Documented arguments not in \usage in documentation object 'identical':
> >
> >    'extptr.as.ref'
> >  Functions with \usage entries need to have the appropriate \alias
> >  entries, and all their arguments documented.
> >  The \usage entries must correspond to syntactically valid R code.
> >  See chapter 'Writing R documentation files' in the 'Writing R
> >  Extensions' manual.
> > ```
> >
> > So it seems that a warning is being generated both with or without the
> > extptr.as.ref in my documentation. Any help would be appreciated, thanks!
> >
> > Andrew
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Feb  2 03:57:24 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 2 Feb 2022 15:57:24 +1300
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
 <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
 <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>
Message-ID: <9136D82D-675B-4F9B-A391-0017D0EB94CC@R-project.org>



> On Feb 2, 2022, at 3:01 PM, Andrew Plowright <plowright.andrew at gmail.com> wrote:
> 
> Hi Simon,
> 
> Thanks for your reply. I guess I could use == instead. What I want is a method for checking if two S4 class objects are the same. I thought that == was strictly meant for atomic and list types?
> 


identical() already checks that two objects S4 are the same - so if that's what you want, then you don't need to do anything, R provides.

I assumed you want to decide if two objects are semantically equal even if the two objects are not identical, but can still be equal - let's say because you include some additional information in the object that you want to skip when deciding equivalence. In that case == is the way to go. If your object does not have vector semantics, then you just return a scalar, e.g. let's take an example from a class you're familiar with:

WGS84 and EPSG: 4326 are the same CRS:

> st_crs("WGS84") == st_crs(4326)
[1] TRUE

but the objects are not necessarily identical:

> identical(st_crs("WGS84"), st_crs(4326))
[1] FALSE

Cheers,
Simon



> Andrew
> 
> On Tue, Feb 1, 2022 at 4:45 PM Simon Urbanek <simon.urbanek at r-project.org> wrote:
> Andrew,
> 
> you should not re-define identical, it is not a semantic operation and does NOT test equality. Did you mean to write a `==` method instead?
> 
> Cheers,
> Simon
> 
> 
> 
> > On Feb 2, 2022, at 9:20 AM, Andrew Plowright <plowright.andrew at gmail.com> wrote:
> > 
> > Hello, I have an 'identical()' method in my library
> > 
> > https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> > 
> > I recently started getting a warning message regarding a new
> > 'extptr.as.ref' argument that was added to R-devel in December. When
> > running devtools::check_rhub() I get:
> > 
> > ```
> > * checking for code/documentation mismatches ... WARNING
> > identical
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
> >  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > Codoc mismatches from documentation object 'identical':
> >  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> >                 FALSE, ignore.srcref = TRUE)
> >  Argument names in code not in docs:
> >    extptr.as.ref
> > ```
> > 
> > I tried adding the 'extptr.as.ref' argument to my documentation, but now I
> > get a new warning:
> > 
> > ```
> >  Documented arguments not in \usage in documentation object 'identical':
> > 
> >    'extptr.as.ref'
> >  Functions with \usage entries need to have the appropriate \alias
> >  entries, and all their arguments documented.
> >  The \usage entries must correspond to syntactically valid R code.
> >  See chapter 'Writing R documentation files' in the 'Writing R
> >  Extensions' manual.
> > ```
> > 
> > So it seems that a warning is being generated both with or without the
> > extptr.as.ref in my documentation. Any help would be appreciated, thanks!
> > 
> > Andrew
> > 
> >       [[alternative HTML version deleted]]
> > 
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> > 
> 


From p|owr|ght@@ndrew @end|ng |rom gm@||@com  Wed Feb  2 06:16:49 2022
From: p|owr|ght@@ndrew @end|ng |rom gm@||@com (Andrew Plowright)
Date: Tue, 1 Feb 2022 21:16:49 -0800
Subject: [R-pkg-devel] 
 New 'extptr.as.ref' argument in identical() causing check failures
In-Reply-To: <9136D82D-675B-4F9B-A391-0017D0EB94CC@R-project.org>
References: <CAOHs3k2+ho4pnhepyAEHSdtivkSD8g9K64BHAk_eLE07uYqTmQ@mail.gmail.com>
 <04E8D81E-6815-49ED-AC37-B5D207AB4070@R-project.org>
 <CAOHs3k0k8e8npjJPv-p-fTMbKyhSyCT_DQpbWm89185yfuWPWQ@mail.gmail.com>
 <9136D82D-675B-4F9B-A391-0017D0EB94CC@R-project.org>
Message-ID: <CAOHs3k2kNUA4NomLxtGckx4UR-QsCS1yQXDO9YXmuTVqaM-R7Q@mail.gmail.com>

Great example, that makes perfect sense.

I'll just drop the identical method. Easy fix!

Thanks,
Andrew

On Tue, Feb 1, 2022 at 6:57 PM Simon Urbanek <simon.urbanek at r-project.org>
wrote:

>
>
> > On Feb 2, 2022, at 3:01 PM, Andrew Plowright <plowright.andrew at gmail.com>
> wrote:
> >
> > Hi Simon,
> >
> > Thanks for your reply. I guess I could use == instead. What I want is a
> method for checking if two S4 class objects are the same. I thought that ==
> was strictly meant for atomic and list types?
> >
>
>
> identical() already checks that two objects S4 are the same - so if that's
> what you want, then you don't need to do anything, R provides.
>
> I assumed you want to decide if two objects are semantically equal even if
> the two objects are not identical, but can still be equal - let's say
> because you include some additional information in the object that you want
> to skip when deciding equivalence. In that case == is the way to go. If
> your object does not have vector semantics, then you just return a scalar,
> e.g. let's take an example from a class you're familiar with:
>
> WGS84 and EPSG: 4326 are the same CRS:
>
> > st_crs("WGS84") == st_crs(4326)
> [1] TRUE
>
> but the objects are not necessarily identical:
>
> > identical(st_crs("WGS84"), st_crs(4326))
> [1] FALSE
>
> Cheers,
> Simon
>
>
>
> > Andrew
> >
> > On Tue, Feb 1, 2022 at 4:45 PM Simon Urbanek <
> simon.urbanek at r-project.org> wrote:
> > Andrew,
> >
> > you should not re-define identical, it is not a semantic operation and
> does NOT test equality. Did you mean to write a `==` method instead?
> >
> > Cheers,
> > Simon
> >
> >
> >
> > > On Feb 2, 2022, at 9:20 AM, Andrew Plowright <
> plowright.andrew at gmail.com> wrote:
> > >
> > > Hello, I have an 'identical()' method in my library
> > >
> > >
> https://github.com/andrew-plowright/TileManager/blob/0f213a6bcce4bc4b6d0f5e6672660409e09c22c5/R/tileScheme-methods.R#L198
> > >
> > > I recently started getting a warning message regarding a new
> > > 'extptr.as.ref' argument that was added to R-devel in December. When
> > > running devtools::check_rhub() I get:
> > >
> > > ```
> > > * checking for code/documentation mismatches ... WARNING
> > > identical
> > >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> > >                 FALSE, ignore.srcref = TRUE, extptr.as.ref = FALSE)
> > >  Code: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > > Codoc mismatches from documentation object 'identical':
> > >  Docs: function(x, y, num.eq = TRUE, single.NA = TRUE, attrib.as.set =
> > >                 TRUE, ignore.bytecode = TRUE, ignore.environment =
> > >                 FALSE, ignore.srcref = TRUE)
> > >  Argument names in code not in docs:
> > >    extptr.as.ref
> > > ```
> > >
> > > I tried adding the 'extptr.as.ref' argument to my documentation, but
> now I
> > > get a new warning:
> > >
> > > ```
> > >  Documented arguments not in \usage in documentation object
> 'identical':
> > >
> > >    'extptr.as.ref'
> > >  Functions with \usage entries need to have the appropriate \alias
> > >  entries, and all their arguments documented.
> > >  The \usage entries must correspond to syntactically valid R code.
> > >  See chapter 'Writing R documentation files' in the 'Writing R
> > >  Extensions' manual.
> > > ```
> > >
> > > So it seems that a warning is being generated both with or without the
> > > extptr.as.ref in my documentation. Any help would be appreciated,
> thanks!
> > >
> > > Andrew
> > >
> > >       [[alternative HTML version deleted]]
> > >
> > > ______________________________________________
> > > R-package-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> > >
> >
>
>

	[[alternative HTML version deleted]]


From v|ncentv@nhee@ @end|ng |rom gm@||@com  Wed Feb  2 10:46:57 2022
From: v|ncentv@nhee@ @end|ng |rom gm@||@com (Vincent van Hees)
Date: Wed, 2 Feb 2022 10:46:57 +0100
Subject: [R-pkg-devel] invalid file URI: 5%B
Message-ID: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>

Hello,
I received the following response from CRAN after submitting my package:

Thanks, we see:
Found the following (possibly) invalid file URI:
  URI: %5B
    From: inst/doc/GGIR.html
Please fix and resubmit.

Link to win-builder log:
https://win-builder.r-project.org/incoming_pretest/GGIR_2.6-0_20220201_151400/Windows/00check.log

May I assume that this relates to a link inside my package vignette?

My vignette has many links of various types. How can I find out which one
is the problematic one? For example, does %5B provide an indication of the
location in the code or does it tell me the type of link (internal link to
file, internal link to vignette section, or external url)?

My vignette code is here:
https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd

Any help will be much appreciated,
Vincent

	[[alternative HTML version deleted]]


From e@ @end|ng |rom enr|co@chum@nn@net  Wed Feb  2 10:56:12 2022
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Wed, 02 Feb 2022 10:56:12 +0100
Subject: [R-pkg-devel] invalid file URI: 5%B
In-Reply-To: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
 (Vincent van Hees's message of "Wed, 2 Feb 2022 10:46:57 +0100")
References: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
Message-ID: <87sft18udf.fsf@enricoschumann.net>

On Wed, 02 Feb 2022, Vincent van Hees writes:

> Hello,
> I received the following response from CRAN after submitting my package:
>
> Thanks, we see:
> Found the following (possibly) invalid file URI:
>   URI: %5B
>     From: inst/doc/GGIR.html
> Please fix and resubmit.
>
> Link to win-builder log:
> https://win-builder.r-project.org/incoming_pretest/GGIR_2.6-0_20220201_151400/Windows/00check.log
>
> May I assume that this relates to a link inside my package vignette?
>
> My vignette has many links of various types. How can I find out which one
> is the problematic one? For example, does %5B provide an indication of the
> location in the code or does it tell me the type of link (internal link to
> file, internal link to vignette section, or external url)?
>
> My vignette code is here:
> https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd
>
> Any help will be much appreciated,
> Vincent
>

URLencode("[", reserved = TRUE)
## [1] "%5B"

Do you have any links with brackets?


-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Feb  2 11:07:29 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 2 Feb 2022 13:07:29 +0300
Subject: [R-pkg-devel] invalid file URI: 5%B
In-Reply-To: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
References: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
Message-ID: <20220202130729.65fd18d9@Tarkus>

On Wed, 2 Feb 2022 10:46:57 +0100
Vincent van Hees <vincentvanhees at gmail.com> wrote:

> May I assume that this relates to a link inside my package vignette?

That's true.

> My vignette has many links of various types. How can I find out which
> one is the problematic one?

Take a look at inst/doc/GGIR.html in the R CMD build output and search
for "%5B".

> For example, does %5B provide an indication of the location in the
> code or does it tell me the type of link (internal link to file,
> internal link to vignette section, or external url)?

Unfortunately, there's no indication of the location. According to the
code of R CMD check (src/library/tools/R/QC.R in the R source code),
"%5B" is the whole link. Apparently, a square bracket got wrongly
interpreted as a link destination somewhere inside your document. Most
likely, the link on line 1158 has an unnecessary "[":
https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd#L1158

-- 
Best regards,
Ivan


From v|ncentv@nhee@ @end|ng |rom gm@||@com  Wed Feb  2 11:54:35 2022
From: v|ncentv@nhee@ @end|ng |rom gm@||@com (Vincent van Hees)
Date: Wed, 2 Feb 2022 11:54:35 +0100
Subject: [R-pkg-devel] invalid file URI: 5%B
In-Reply-To: <20220202130729.65fd18d9@Tarkus>
References: <CALnEB1479uRJXGStbsConOiRmCoBCVrYTM=2qORo8+1NwLbTPw@mail.gmail.com>
 <20220202130729.65fd18d9@Tarkus>
Message-ID: <CALnEB15xKi3W3DU9VRf8UOAduE+WcUuM1mb5w5VJZOZQZQNdYg@mail.gmail.com>

That fixed the issue. Thanks a lot Ivan and Enrico!

On Wed, 2 Feb 2022 at 11:07, Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Wed, 2 Feb 2022 10:46:57 +0100
> Vincent van Hees <vincentvanhees at gmail.com> wrote:
>
> > May I assume that this relates to a link inside my package vignette?
>
> That's true.
>
> > My vignette has many links of various types. How can I find out which
> > one is the problematic one?
>
> Take a look at inst/doc/GGIR.html in the R CMD build output and search
> for "%5B".
>
> > For example, does %5B provide an indication of the location in the
> > code or does it tell me the type of link (internal link to file,
> > internal link to vignette section, or external url)?
>
> Unfortunately, there's no indication of the location. According to the
> code of R CMD check (src/library/tools/R/QC.R in the R source code),
> "%5B" is the whole link. Apparently, a square bracket got wrongly
> interpreted as a link destination somewhere inside your document. Most
> likely, the link on line 1158 has an unnecessary "[":
> https://github.com/wadpac/GGIR/blob/master/vignettes/GGIR.Rmd#L1158
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Feb  6 04:32:05 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 6 Feb 2022 16:32:05 +1300
Subject: [R-pkg-devel] Stack smashing detected (dynamically loaded Fortran).
Message-ID: <20220206163205.7d4121e3@rolf-Latitude-E7470>


In the past when I've got the "stack smashing detected" error, it turned
out to be due to that fact that I'd omitted an argument in a call to a
Fortran subroutine, or had in some similar way buggered up an argument
list.

In this instance, I've been tearing my hair out all day and can find no
discrepancies between argument lists in calls and in the code of
subroutines called.

The output that I get from valgrind (see the attached file "smash.txt")
does not enlighten me.  Perhaps someone cleverer than I can extract
useful information from it.  Or perhaps someone can suggest some other
means of discerning what is going wrong.

Should anyone have the inclination and patience to delve further, I have
made a tarball of (a somewhat stripped down version of) the problematic
code and put it up on my web page.  To get to it, go to

    https://www.stat.auckland.ac.nz/~rolf/

scroll down to the bottom and click on "Smash".

If you feel motivated to do so, download the tarball, extract the
contents ("tar xvf smash.tar.gz"), execute "R -d valgrind" in the
directory into which you downloaded smash.tar.gz, and then execute
source("demo.R").

If you amend the Fortran code you will of course need to rebuild the
shared library object:  R CMD SHLIB -o demo.so *.f

The Fortran code is pretty opaque since I actually wrote the code in
ratfor and then compiled it into Fortran.  If you have ratfor on your
system you could amend the *.r files (included in the tarball) and then
execute "makefor" (also in the tarball) to build the Fortran code.
    
I'd be grateful for any insight that anyone can provide.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: smash.txt
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20220206/13526cac/attachment.txt>

From kry|ov@r00t @end|ng |rom gm@||@com  Sun Feb  6 10:45:15 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 6 Feb 2022 12:45:15 +0300
Subject: [R-pkg-devel] 
 Stack smashing detected (dynamically loaded Fortran).
In-Reply-To: <20220206163205.7d4121e3@rolf-Latitude-E7470>
References: <20220206163205.7d4121e3@rolf-Latitude-E7470>
Message-ID: <20220206124515.1257c6b4@Tarkus>

On Sun, 6 Feb 2022 16:32:05 +1300
Rolf Turner <r.turner at auckland.ac.nz> wrote:

> The output that I get from valgrind (see the attached file
> "smash.txt") does not enlighten me.

For whatever reason, Valgrind doesn't see the error. I think it's the
compiler-provided stack canary that complains.

I've been able to get a slightly more informative error from
AddressSanitizer, by putting the following in ~/.R/Makevars:

FFLAGS=-g -Og -fsanitize=address
FCFLAGS=-g -Og -fsanitize=address

(you'll probably want to comment that out once you're done)

then building demo.so like this:

R CMD SHLIB -o demo.so *.f -fsanitize=address

*and* starting R like this (GNU/Linux-specific):

LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libasan.so.5 R

(The ASan version could be different on your machine.)

This gives us a line number (stack overflow in prephi.f:50). Somehow,
d2u is only of size 8 bytes (one double?) and is being overflown by
accessing its second index, despite it being declared as containing
`kstate` doubles and `k` being limited by `kstate`.

Here's how we can combine GDB and AddressSanitizer in dynamically
loaded code in R without recompililng R itself with ASan support:

R -d gdb
set environment LD_PRELOAD /usr/lib/x86_64-linux-gnu/libasan.so.5
set environment ASAN_OPTIONS abort_on_error=1
run

(GDB stops when ASan raises SIGABRT and lets us explore the program at
the time of the crash.)

Here I realised that d2u is a parameter, not a local variable. I
climbed two frames up into the getgl subroutine and found out that d2u
is defined as real(kind=8), without a dimension. This must be the
reason for the stack corruption. Same goes for d2zeta.

Unfortunately, demo.so keeps crashing R, seemingly because of memory
corruption (e.g. the function name turns out to be overwritten when
producing the error message 'array overflow in .Fortran("%s")'), but
only with certain combinations of build options, and ASan isn't helping
any more. An ASan build of R would probably help.

-- 
Best regards,
Ivan

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: asan_crash.txt
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20220206/047d26f2/attachment.txt>

From kry|ov@r00t @end|ng |rom gm@||@com  Sun Feb  6 11:25:48 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 6 Feb 2022 13:25:48 +0300
Subject: [R-pkg-devel] 
 Stack smashing detected (dynamically loaded Fortran).
In-Reply-To: <20220206124515.1257c6b4@Tarkus>
References: <20220206163205.7d4121e3@rolf-Latitude-E7470>
 <20220206124515.1257c6b4@Tarkus>
Message-ID: <20220206132548.0c9b08c8@Tarkus>

On Sun, 6 Feb 2022 12:45:15 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

> Unfortunately, demo.so keeps crashing R, seemingly because of memory
> corruption (e.g. the function name turns out to be overwritten when
> producing the error message 'array overflow in .Fortran("%s")')

I installed debugging symbols for R, set a watchpoint on the local
symName in function do_dotCode, one call frame above subroutine getgl,
and it hit:

Thread 1 "R" hit Watchpoint 3: symName

0x00007ffff24bb6a3 in derivf (fy=..., ndistr=4, zeta=..., sigma=...,
size=1, y=1, ymiss=0, dmat=..., kstate=2, npar=10, nphi=8, nyv=5,
nxc=1, d1f=..., d2f=..., d1zeta=..., d2zeta=..., d1u=..., d2u=...,
nd=1, epars=..., den=...) at derivf.f:59
 59            d2f(j,k,l) = epars(iy,j)*(a-b+c)/den(j)**2

d2f is declared to have dimensions (kstate,npar,npar) in derivf.f, but
is only a real(kind=8) in its caller, getgl.f. Setting the correct
dimensions in getgl.f seems to fix the crash.

-- 
Best regards,
Ivan


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun Feb  6 21:00:58 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Mon, 7 Feb 2022 09:00:58 +1300
Subject: [R-pkg-devel] 
 Stack smashing detected (dynamically loaded Fortran).
In-Reply-To: <20220206132548.0c9b08c8@Tarkus>
References: <20220206163205.7d4121e3@rolf-Latitude-E7470>
 <20220206124515.1257c6b4@Tarkus> <20220206132548.0c9b08c8@Tarkus>
Message-ID: <20220207090058.637e9e27@rolf-Latitude-E7470>


On Sun, 6 Feb 2022 13:25:48 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

<SNIP>

> d2f is declared to have dimensions (kstate,npar,npar) in derivf.f, but
> is only a real(kind=8) in its caller, getgl.f. Setting the correct
> dimensions in getgl.f seems to fix the crash.

Aaaarrrghhhh!  Yes, that must be it. (And likewise with d2u, d2zeta,
...).  I was trying to use derivf to handle settings in which I only
wanted first derivatives as well as ones in which I wanted both first
and second derivatives.  And I buggered it up. As me high school mates
used to tell me, if I had a brain, I'd be sitting on the floor playing
with it!

Thanks Ivan for your diligent, well organised and clever tracking down
of the problem.  I shall retain your email with the illustration of
using "AddressSanitizer" etc., for future reference.

Thanks again.  I owe you, big-time!

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From th|erry@onke||nx @end|ng |rom |nbo@be  Mon Feb  7 15:55:18 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Mon, 7 Feb 2022 15:55:18 +0100
Subject: [R-pkg-devel] using a class from a suggested package
Message-ID: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>

Dear all,

My package A defines an S4 method for the "inla" S3 class. The INLA package
defines this class. That package has a huge source, making the build fail
on r-universe.dev. The solution is to not importClassesFrom(INLA, inla) but
use setOldClass("inla"). Then I can list INLA under Suggests instead of
Imports. So far so good.

My package B defines S4 objects with a superclass "maybeINLA" defined
as setClassUnion("maybeInla", c("inla", "NULL")). It also imports the
method from package A which handles the "inla" class. This is where I'm
gettin stuck.
- importClassesFrom(INLA, inla) works, but then I can't Suggests INLA.
- using setOldClass("inla") yields an R CMD check warning: "class "inla" is
defined (with package slot ?A?) but no metadata object found to revise
superClass information---not imported?  Making a copy in package ?B? "
- having exportClasses(inla) in package A and importClassesFrom(A, inla) in
package B works but this displays the message "Found more than one class
"inla" in cache; using the first, from namespace 'A' Also defined by 'INLA'
".

How can I use the "inla" class in package B while Suggesting the INLA
package and not have the warnings/messages?

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>

	[[alternative HTML version deleted]]


From |j|ytt|e @end|ng |rom me@com  Tue Feb  8 01:58:08 2022
From: |j|ytt|e @end|ng |rom me@com (Ian Lyttle)
Date: Mon, 7 Feb 2022 18:58:08 -0600
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
Message-ID: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>

?I am trying to check a package release-candidate on win-builder r-devel. This package imports a recently-released version of another package, {vegawidget}.
The check on win-builder (r-devel) fails:
* checking package dependencies ... ERROR
Package required and available but unsuitable version: 'vegawidget'
{vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently not available to win-builder r-devel.
For what it?s worth, the check passes for win-builder r-release and r-oldrel.
Is this just a matter of me needing to be more patient, or could there be something ?stuck? at win-builder?
Thanks!



	[[alternative HTML version deleted]]


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Tue Feb  8 15:55:17 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Tue, 8 Feb 2022 09:55:17 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
Message-ID: <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>

For what it's worth, I am seeing a similar issue.

I am trying to make a release that depends on the hardhat package, which
made a release on 2022-01-24, and it's still unavailable to check on
WinDevel. I am also depending on the newest release of gtsummary which was
made available on CRAN on 2022-01-29 (after hardhat's release). The
gtsummary package, however, became available on WinDevel a few days later.

Thank you,
Daniel

On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
>
> I am trying to check a package release-candidate on win-builder r-devel.
This package imports a recently-released version of another package,
{vegawidget}.
> The check on win-builder (r-devel) fails:
> * checking package dependencies ... ERROR
> Package required and available but unsuitable version: 'vegawidget'
> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently
not available to win-builder r-devel.
> For what it?s worth, the check passes for win-builder r-release and
r-oldrel.
> Is this just a matter of me needing to be more patient, or could there be
something ?stuck? at win-builder?
> Thanks!
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Feb  9 10:45:05 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 9 Feb 2022 12:45:05 +0300
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
Message-ID: <20220209124505.352ebbee@arachnoid>

On Mon, 7 Feb 2022 15:55:18 +0100
Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:

> My package A defines an S4 method for the "inla" S3 class. The INLA
> package defines this class. That package has a huge source, making
> the build fail on r-universe.dev. The solution is to not
> importClassesFrom(INLA, inla) but use setOldClass("inla"). Then I can
> list INLA under Suggests instead of Imports. So far so good.

This is a really complicated situation to be in.

On the one hand, the only documented way to use S4 classes from another
package is NAMESPACE and importClassesFrom(), which leads to stronger
dependencies than you would like. On the other hand, you're likely to
get warnings if more than one loaded namespace define S4 classes with
the same name, to it's a good idea to avoid calling setOldClass('inla')
in the A package if INLA can be loaded.

Could it be an option to define the "maybeInla" class in the A package,
initially as "NULL", and then extend it at runtime using getClassDef?

setClassUnion('maybeInla', 'NULL')

.onLoad <- function(...) {
# ...
 if (requireNamespace('INLA', quietly = TRUE)) {
  setIs(getClassDef('inla', package = 'INLA'), 'maybeInla')
 }
# ...
}

If INLA can't be loaded, then there's (ostensibly) no way to create
"inla" objects in the current session, and "NULL" is as good a
definition as it would get. Then B could import the maybeInla class
from A.

-- 
Best regards,
Ivan


From th|erry@onke||nx @end|ng |rom |nbo@be  Wed Feb  9 12:25:14 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Wed, 9 Feb 2022 12:25:14 +0100
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <20220209124505.352ebbee@arachnoid>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
 <20220209124505.352ebbee@arachnoid>
Message-ID: <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>

Dear Ivan,

Thanks for the suggestion. Something strange is happening. When I run
getClassDef("inla", package = "INLA") is a fresh session I get.

Virtual Class "inla" [package "INLA"]

Slots:

Name:   .S3Class
Class: character

Extends: "oldClass"

However when package A is loaded first, I get. Since package B imports
package A, the namespace of A is loaded when building B.

Virtual Class "inla" [package "A"]

Slots:

Name:   .S3Class
Class: character

Extends: "oldClass"
Building package B with the code below yields Warning: class "inla" is
defined (with package slot ?A?) but no metadata object found to revise
superClass information---not imported?  Making a copy in package ?B?

setClassUnion("maybeInla", "NULL")
#' @importFrom methods getClassDef setIs
.onLoad <- function(...) {
  if (requireNamespace("INLA", quietly = TRUE)) {
    setIs("inla", "maybeInla", classDef = getClassDef("inla", package =
"INLA"))
  }
}
Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op wo 9 feb. 2022 om 10:45 schreef Ivan Krylov <krylov.r00t at gmail.com>:

> On Mon, 7 Feb 2022 15:55:18 +0100
> Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>
> > My package A defines an S4 method for the "inla" S3 class. The INLA
> > package defines this class. That package has a huge source, making
> > the build fail on r-universe.dev. The solution is to not
> > importClassesFrom(INLA, inla) but use setOldClass("inla"). Then I can
> > list INLA under Suggests instead of Imports. So far so good.
>
> This is a really complicated situation to be in.
>
> On the one hand, the only documented way to use S4 classes from another
> package is NAMESPACE and importClassesFrom(), which leads to stronger
> dependencies than you would like. On the other hand, you're likely to
> get warnings if more than one loaded namespace define S4 classes with
> the same name, to it's a good idea to avoid calling setOldClass('inla')
> in the A package if INLA can be loaded.
>
> Could it be an option to define the "maybeInla" class in the A package,
> initially as "NULL", and then extend it at runtime using getClassDef?
>
> setClassUnion('maybeInla', 'NULL')
>
> .onLoad <- function(...) {
> # ...
>  if (requireNamespace('INLA', quietly = TRUE)) {
>   setIs(getClassDef('inla', package = 'INLA'), 'maybeInla')
>  }
> # ...
> }
>
> If INLA can't be loaded, then there's (ostensibly) no way to create
> "inla" objects in the current session, and "NULL" is as good a
> definition as it would get. Then B could import the maybeInla class
> from A.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Feb  9 14:05:55 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 9 Feb 2022 16:05:55 +0300
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
 <20220209124505.352ebbee@arachnoid>
 <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>
Message-ID: <20220209160555.50183736@arachnoid>

On Wed, 9 Feb 2022 12:25:14 +0100
Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:

> However when package A is loaded first, I get

> Virtual Class "inla" [package "A"]

Since you own both packages A and B, how much work would it be to
export maybeInla from package A instead of importing inla in package B?
I'm afraid you won't avoid the warning if package A creates its own
inla and you load package INLA in the same process.

-- 
Best regards,
Ivan


From th|erry@onke||nx @end|ng |rom |nbo@be  Wed Feb  9 16:43:37 2022
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Wed, 9 Feb 2022 16:43:37 +0100
Subject: [R-pkg-devel] using a class from a suggested package
In-Reply-To: <20220209160555.50183736@arachnoid>
References: <CAJuCY5xz1OKKRG6eMyHZcEorpVVGwVYKoeeex2FoAt=BUEzqQQ@mail.gmail.com>
 <20220209124505.352ebbee@arachnoid>
 <CAJuCY5zVJBC8wd85-wXyrK9QcKXOvR3AoOhUsJSVR3RKnNL2aQ@mail.gmail.com>
 <20220209160555.50183736@arachnoid>
Message-ID: <CAJuCY5yg9JWH3jFQm=-nt73UPj1ODpXobUdGs2yWFdmLv9iQyw@mail.gmail.com>

Dear Ivan,

Defining "maybeInla" in package A and importing that in package B solved
the problem. Thanks for your assistance.

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op wo 9 feb. 2022 om 14:05 schreef Ivan Krylov <krylov.r00t at gmail.com>:

> On Wed, 9 Feb 2022 12:25:14 +0100
> Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>
> > However when package A is loaded first, I get
>
> > Virtual Class "inla" [package "A"]
>
> Since you own both packages A and B, how much work would it be to
> export maybeInla from package A instead of importing inla in package B?
> I'm afraid you won't avoid the warning if package A creates its own
> inla and you load package INLA in the same process.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Fri Feb 11 23:22:10 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Fri, 11 Feb 2022 22:22:10 +0000
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
Message-ID: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>

I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).

No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.

I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check? 

Murray

From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Feb 11 23:44:12 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 11 Feb 2022 17:44:12 -0500
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
Message-ID: <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>

On 11/02/2022 5:22 p.m., Murray Efford wrote:
> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
> 
> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
> 
> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?

It's not easy to run just that test, but you can see it if you look here:

https://github.com/wch/r-source/blob/988077a792e628677bd5884b351fe08b2c17b8c8/src/library/tools/R/check.R#L4866-L4941

The basic idea is that it uses the "file" command.  There are some known 
false positives.

If you are on Linux, try running "file OVforest.dbf" and see what it says.

Duncan Murdoch


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Sat Feb 12 00:33:40 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Fri, 11 Feb 2022 23:33:40 +0000
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
Message-ID: <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>

Many thanks for your guidance. Indeed there is a radical change:

$ file OVforest.dbf
OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"

$ file OVforest2.dbf
OVforest2.dbf: amd 29k coff prebar executable

I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...

Murray

________________________________________
From: Duncan Murdoch <murdoch.duncan at gmail.com>
Sent: 12 February 2022 11:44
To: Murray Efford; R-package-devel at r-project.org
Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable

On 11/02/2022 5:22 p.m., Murray Efford wrote:
> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>
> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>
> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?

It's not easy to run just that test, but you can see it if you look here:

https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Ce242631c41c342f47d8908d9edb008b8%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802163497599994%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=Z77T09j1sONATxupZGSmkayrpjt3Ra1g%2FS6vxQq8CJs%3D&amp;reserved=0

The basic idea is that it uses the "file" command.  There are some known
false positives.

If you are on Linux, try running "file OVforest.dbf" and see what it says.

Duncan Murdoch


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Feb 12 00:38:48 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sat, 12 Feb 2022 12:38:48 +1300
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
 <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
Message-ID: <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>

FWIW this seems to be a known issue (for some definition of known):

https://bugs.astron.com/view.php?id=316

A fix is to set your date when writing the DBF file to year 2021 instead of 2022 (which also explains why it worked last year ;)).

Cheers,
Simon





> On Feb 12, 2022, at 12:33 PM, Murray Efford <murray.efford at otago.ac.nz> wrote:
> 
> Many thanks for your guidance. Indeed there is a radical change:
> 
> $ file OVforest.dbf
> OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"
> 
> $ file OVforest2.dbf
> OVforest2.dbf: amd 29k coff prebar executable
> 
> I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...
> 
> Murray
> 
> ________________________________________
> From: Duncan Murdoch <murdoch.duncan at gmail.com>
> Sent: 12 February 2022 11:44
> To: Murray Efford; R-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable
> 
> On 11/02/2022 5:22 p.m., Murray Efford wrote:
>> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>> 
>> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>> 
>> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?
> 
> It's not easy to run just that test, but you can see it if you look here:
> 
> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Ce242631c41c342f47d8908d9edb008b8%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802163497599994%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=Z77T09j1sONATxupZGSmkayrpjt3Ra1g%2FS6vxQq8CJs%3D&amp;reserved=0
> 
> The basic idea is that it uses the "file" command.  There are some known
> false positives.
> 
> If you are on Linux, try running "file OVforest.dbf" and see what it says.
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Feb 12 00:58:28 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sat, 12 Feb 2022 12:58:28 +1300
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
 <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
Message-ID: <BF0395CF-DF50-4472-B2A6-00BB270C59EB@R-project.org>

Also if you just want to "fix" the file, you can simply change the second byte using R:

fn = "myfile.dbf"
sz = file.info(fn)$size
r = readBin(fn, raw(), sz)
r[2] = as.raw(121) ## make it 2021 instead of 2022
writeBin(r, fn)



> On Feb 12, 2022, at 12:38 PM, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> FWIW this seems to be a known issue (for some definition of known):
> 
> https://bugs.astron.com/view.php?id=316
> 
> A fix is to set your date when writing the DBF file to year 2021 instead of 2022 (which also explains why it worked last year ;)).
> 
> Cheers,
> Simon
> 
> 
> 
> 
> 
>> On Feb 12, 2022, at 12:33 PM, Murray Efford <murray.efford at otago.ac.nz> wrote:
>> 
>> Many thanks for your guidance. Indeed there is a radical change:
>> 
>> $ file OVforest.dbf
>> OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"
>> 
>> $ file OVforest2.dbf
>> OVforest2.dbf: amd 29k coff prebar executable
>> 
>> I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...
>> 
>> Murray
>> 
>> ________________________________________
>> From: Duncan Murdoch <murdoch.duncan at gmail.com>
>> Sent: 12 February 2022 11:44
>> To: Murray Efford; R-package-devel at r-project.org
>> Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable
>> 
>> On 11/02/2022 5:22 p.m., Murray Efford wrote:
>>> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>>> 
>>> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>>> 
>>> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?
>> 
>> It's not easy to run just that test, but you can see it if you look here:
>> 
>> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Ce242631c41c342f47d8908d9edb008b8%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802163497599994%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=Z77T09j1sONATxupZGSmkayrpjt3Ra1g%2FS6vxQq8CJs%3D&amp;reserved=0
>> 
>> The basic idea is that it uses the "file" command.  There are some known
>> false positives.
>> 
>> If you are on Linux, try running "file OVforest.dbf" and see what it says.
>> 
>> Duncan Murdoch
>> 
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Sat Feb 12 01:41:04 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Sat, 12 Feb 2022 00:41:04 +0000
Subject: [R-pkg-devel] shapefile .dbf recognised as executable
In-Reply-To: <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
References: <SY4PR01MB5658FBF4675400CF6DC6E63CAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <4b0e638c-162e-a6de-203a-3bfe90460808@gmail.com>
 <SY4PR01MB5658328F16504375B5092DBEAC309@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <46A0A0A7-C3B3-4F5B-8351-6B8D04422E19@R-project.org>
Message-ID: <SY4PR01MB5658C193B4C72CB1FF2924BEAC319@SY4PR01MB5658.ausprd01.prod.outlook.com>

Amazing. Who would have thought? This works:

OVforest <- sf::st_read("OVforest.shp")
sf::st_write(OVforest, "OVforest3.shp", layer_options = "DBF_DATE_LAST_UPDATE=2021-12-31")

$ file OVforest3.dbf
OVforest3.dbf: FoxBase+/dBase III DBF, 3 records * 12, update-date 121-12-31, codepage ID=0x57, at offset 65 1st record "          0           1           2\032"

Murray

________________________________________
From: Simon Urbanek <simon.urbanek at R-project.org>
Sent: 12 February 2022 12:38
To: Murray Efford
Cc: Duncan Murdoch; R-package-devel at r-project.org
Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable

FWIW this seems to be a known issue (for some definition of known):

https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fbugs.astron.com%2Fview.php%3Fid%3D316&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Cf4c62a1b8f424575c75608d9edb7aa72%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802195379474238%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=EGkZIRKQNcdcqXqHJaN7i%2FhCbaJn8r%2FosFUTrPE39ts%3D&amp;reserved=0

A fix is to set your date when writing the DBF file to year 2021 instead of 2022 (which also explains why it worked last year ;)).

Cheers,
Simon





> On Feb 12, 2022, at 12:33 PM, Murray Efford <murray.efford at otago.ac.nz> wrote:
>
> Many thanks for your guidance. Indeed there is a radical change:
>
> $ file OVforest.dbf
> OVforest.dbf: FoxBase+/dBase III DBF, 3 records * 22, update-date 95-7-26, at offset 97 1st record "beech        beech    leftnonbeech nonbeech rightnonbeechnonbeech"
>
> $ file OVforest2.dbf
> OVforest2.dbf: amd 29k coff prebar executable
>
> I don't recognize the file descriptors (amd, coff, prebar). I guess I need to call in help from the GIS people...
>
> Murray
>
> ________________________________________
> From: Duncan Murdoch <murdoch.duncan at gmail.com>
> Sent: 12 February 2022 11:44
> To: Murray Efford; R-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] shapefile .dbf recognised as executable
>
> On 11/02/2022 5:22 p.m., Murray Efford wrote:
>> I have long distributed a small spatial ESRI shapefile as demonstration data in the extdata directory of 'secr'. It comprises the three files OVforest.shp, OVforest.dbf and OVforest.shx. I wanted to make minor changes (adding a coordinate reference system, dropping an attribute). I find that after merely reading (sf::st_read("OVforest.shp") and re-writing the same (sf::st_write("OVforest.shp")) the .dbf file is recognised by R CMD check as executable and raises a Warning (on GNU/Linux, but not in Windows).
>>
>> No doubt this can be blamed on specifics of the driver used by sf::st_write, but I have been unable to find any settings that might change the behaviour.
>>
>> I would like to know: Is this a false positive, and if not, How can I remove the executable component(s)? Can I apply the test used by R CMD check outside of R CMD check?
>
> It's not easy to run just that test, but you can see it if you look here:
>
> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwch%2Fr-source%2Fblob%2F988077a792e628677bd5884b351fe08b2c17b8c8%2Fsrc%2Flibrary%2Ftools%2FR%2Fcheck.R%23L4866-L4941&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Cf4c62a1b8f424575c75608d9edb7aa72%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802195379474238%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=1SkmfSqsvOpA%2Brs3DNCU86VJi6YXuGcSDxLIpjsQ720%3D&amp;reserved=0
>
> The basic idea is that it uses the "file" command.  There are some known
> false positives.
>
> If you are on Linux, try running "file OVforest.dbf" and see what it says.
>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=04%7C01%7Cmurray.efford%40otago.ac.nz%7Cf4c62a1b8f424575c75608d9edb7aa72%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637802195379474238%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=q9urWht4opl4qfGzLCKDSD8VzDbxo8dquJm14jsxhxc%3D&amp;reserved=0
>


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Sun Feb 13 16:32:14 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Sun, 13 Feb 2022 10:32:14 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
Message-ID: <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>

Is there something wrong with the Windows Dev machine? It's now been 3
weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
still not available in the Win Dev check.

I have this in my DESCRIPTION file:
Imports:
    hardhat (>= 0.2.0)

And still getting this note when running devtools::check_win_devel().

Package required and available but unsuitable version: 'hardhat'

https://cran.r-project.org/package=hardhat

Daniel


On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com>
wrote:

> For what it's worth, I am seeing a similar issue.
>
> I am trying to make a release that depends on the hardhat package, which
> made a release on 2022-01-24, and it's still unavailable to check on
> WinDevel. I am also depending on the newest release of gtsummary which was
> made available on CRAN on 2022-01-29 (after hardhat's release). The
> gtsummary package, however, became available on WinDevel a few days later.
>
> Thank you,
> Daniel
>
> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
> >
> > I am trying to check a package release-candidate on win-builder r-devel.
> This package imports a recently-released version of another package,
> {vegawidget}.
> > The check on win-builder (r-devel) fails:
> > * checking package dependencies ... ERROR
> > Package required and available but unsuitable version: 'vegawidget'
> > {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently
> not available to win-builder r-devel.
> > For what it?s worth, the check passes for win-builder r-release and
> r-oldrel.
> > Is this just a matter of me needing to be more patient, or could there
> be something ?stuck? at win-builder?
> > Thanks!
> >
> >
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Feb 13 20:29:31 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 13 Feb 2022 14:29:31 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
Message-ID: <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>

I'd suggest writing to CRAN to point out that they may need to take a 
look, if you haven't already done so.  In the meantime, you can test 
elsewhere (R-hub, Github, your own Windows machine or image, etc.)

Duncan Murdoch

On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
> Is there something wrong with the Windows Dev machine? It's now been 3
> weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
> still not available in the Win Dev check.
> 
> I have this in my DESCRIPTION file:
> Imports:
>      hardhat (>= 0.2.0)
> 
> And still getting this note when running devtools::check_win_devel().
> 
> Package required and available but unsuitable version: 'hardhat'
> 
> https://cran.r-project.org/package=hardhat
> 
> Daniel
> 
> 
> On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com>
> wrote:
> 
>> For what it's worth, I am seeing a similar issue.
>>
>> I am trying to make a release that depends on the hardhat package, which
>> made a release on 2022-01-24, and it's still unavailable to check on
>> WinDevel. I am also depending on the newest release of gtsummary which was
>> made available on CRAN on 2022-01-29 (after hardhat's release). The
>> gtsummary package, however, became available on WinDevel a few days later.
>>
>> Thank you,
>> Daniel
>>
>> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
>>>
>>> I am trying to check a package release-candidate on win-builder r-devel.
>> This package imports a recently-released version of another package,
>> {vegawidget}.
>>> The check on win-builder (r-devel) fails:
>>> * checking package dependencies ... ERROR
>>> Package required and available but unsuitable version: 'vegawidget'
>>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is apparently
>> not available to win-builder r-devel.
>>> For what it?s worth, the check passes for win-builder r-release and
>> r-oldrel.
>>> Is this just a matter of me needing to be more patient, or could there
>> be something ?stuck? at win-builder?
>>> Thanks!
>>>
>>>
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Sun Feb 13 20:33:51 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Sun, 13 Feb 2022 14:33:51 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
 <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
Message-ID: <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>

Thank you so much for the response Duncan!

How does one go about writing to CRAN?

The package is tested and ready to be shipped to CRAN, but since it's
failing on Win Devel, I assumed it would be auto-rejected if I submitted
for a CRAN release.

On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> I'd suggest writing to CRAN to point out that they may need to take a
> look, if you haven't already done so.  In the meantime, you can test
> elsewhere (R-hub, Github, your own Windows machine or image, etc.)
>
> Duncan Murdoch
>
> On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
> > Is there something wrong with the Windows Dev machine? It's now been 3
> > weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
> > still not available in the Win Dev check.
> >
> > I have this in my DESCRIPTION file:
> > Imports:
> >      hardhat (>= 0.2.0)
> >
> > And still getting this note when running devtools::check_win_devel().
> >
> > Package required and available but unsuitable version: 'hardhat'
> >
> > https://cran.r-project.org/package=hardhat
> >
> > Daniel
> >
> >
> > On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com
> >
> > wrote:
> >
> >> For what it's worth, I am seeing a similar issue.
> >>
> >> I am trying to make a release that depends on the hardhat package, which
> >> made a release on 2022-01-24, and it's still unavailable to check on
> >> WinDevel. I am also depending on the newest release of gtsummary which
> was
> >> made available on CRAN on 2022-01-29 (after hardhat's release). The
> >> gtsummary package, however, became available on WinDevel a few days
> later.
> >>
> >> Thank you,
> >> Daniel
> >>
> >> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
> >>>
> >>> I am trying to check a package release-candidate on win-builder
> r-devel.
> >> This package imports a recently-released version of another package,
> >> {vegawidget}.
> >>> The check on win-builder (r-devel) fails:
> >>> * checking package dependencies ... ERROR
> >>> Package required and available but unsuitable version: 'vegawidget'
> >>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
> apparently
> >> not available to win-builder r-devel.
> >>> For what it?s worth, the check passes for win-builder r-release and
> >> r-oldrel.
> >>> Is this just a matter of me needing to be more patient, or could there
> >> be something ?stuck? at win-builder?
> >>> Thanks!
> >>>
> >>>
> >>>
> >>>          [[alternative HTML version deleted]]
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Sun Feb 13 20:40:52 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sun, 13 Feb 2022 14:40:52 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
 <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
 <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
Message-ID: <974fe4a5-ef30-01dc-bd36-4eaf0de34ce8@gmail.com>

   Write to cran at r-project.org , I think ...

On 2/13/22 2:33 PM, Daniel Sjoberg wrote:
> Thank you so much for the response Duncan!
> 
> How does one go about writing to CRAN?
> 
> The package is tested and ready to be shipped to CRAN, but since it's
> failing on Win Devel, I assumed it would be auto-rejected if I submitted
> for a CRAN release.
> 
> On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
> 
>> I'd suggest writing to CRAN to point out that they may need to take a
>> look, if you haven't already done so.  In the meantime, you can test
>> elsewhere (R-hub, Github, your own Windows machine or image, etc.)
>>
>> Duncan Murdoch
>>
>> On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
>>> Is there something wrong with the Windows Dev machine? It's now been 3
>>> weeks since the release of the hardhat package v 0.2.0 on CRAN, and it's
>>> still not available in the Win Dev check.
>>>
>>> I have this in my DESCRIPTION file:
>>> Imports:
>>>       hardhat (>= 0.2.0)
>>>
>>> And still getting this note when running devtools::check_win_devel().
>>>
>>> Package required and available but unsuitable version: 'hardhat'
>>>
>>> https://cran.r-project.org/package=hardhat
>>>
>>> Daniel
>>>
>>>
>>> On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg <danield.sjoberg at gmail.com
>>>
>>> wrote:
>>>
>>>> For what it's worth, I am seeing a similar issue.
>>>>
>>>> I am trying to make a release that depends on the hardhat package, which
>>>> made a release on 2022-01-24, and it's still unavailable to check on
>>>> WinDevel. I am also depending on the newest release of gtsummary which
>> was
>>>> made available on CRAN on 2022-01-29 (after hardhat's release). The
>>>> gtsummary package, however, became available on WinDevel a few days
>> later.
>>>>
>>>> Thank you,
>>>> Daniel
>>>>
>>>> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com> wrote:
>>>>>
>>>>> I am trying to check a package release-candidate on win-builder
>> r-devel.
>>>> This package imports a recently-released version of another package,
>>>> {vegawidget}.
>>>>> The check on win-builder (r-devel) fails:
>>>>> * checking package dependencies ... ERROR
>>>>> Package required and available but unsuitable version: 'vegawidget'
>>>>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
>> apparently
>>>> not available to win-builder r-devel.
>>>>> For what it?s worth, the check passes for win-builder r-release and
>>>> r-oldrel.
>>>>> Is this just a matter of me needing to be more patient, or could there
>>>> be something ?stuck? at win-builder?
>>>>> Thanks!
>>>>>
>>>>>
>>>>>
>>>>>           [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Feb 13 21:39:44 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 13 Feb 2022 15:39:44 -0500
Subject: [R-pkg-devel] Update of CRAN repository at win-builder r-devel?
In-Reply-To: <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
References: <0A18B60D-4C2C-4FDE-BE81-6C0A8611D1E6@me.com>
 <CAG5xu54s6RhnkfDfVXb8tfPCiYahnW1LJ513jv8vwFM=2yJMxw@mail.gmail.com>
 <CAG5xu56LjDsbTmTrp7kRM1WvjoT0uuAPfSeHD_bGsRgRy81SQA@mail.gmail.com>
 <5744a3a6-39f9-4a51-def2-f5f3957eafc9@gmail.com>
 <CAG5xu55=ZCDAjn0ftX807SWjdeX6L3+53Ui5Ton-64uXs8N_mw@mail.gmail.com>
Message-ID: <ee24c0a5-4194-4354-3ede-3c010699fd5c@gmail.com>

On 13/02/2022 2:33 p.m., Daniel Sjoberg wrote:
> Thank you so much for the response Duncan!
> 
> How does one go about writing to CRAN?

Ben gave you the address:  cran at r-project.org.
> 
> The package is tested and ready to be shipped to CRAN, but since it's 
> failing on Win Devel, I assumed it would be auto-rejected if I submitted 
> for a CRAN release.

I think CRAN and Winbuilder are separate machines. If CRAN isn't showing 
errors in its tests of the hardhat package then it has probably 
successfully built it and will use it in tests.   Currently it looks fine:

  https://cran.r-project.org/web/checks/check_results_hardhat.html

I do recommend testing on Windows R-devel on one of the other platforms 
I listed before submitting to CRAN.  I don't think auto-rejects waste a 
lot of their time, but it's better to get accepted on the first try.

Duncan Murdoch



>   
> On Sun, Feb 13, 2022 at 2:29 PM Duncan Murdoch <murdoch.duncan at gmail.com 
> <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     I'd suggest writing to CRAN to point out that they may need to take a
>     look, if you haven't already done so.? In the meantime, you can test
>     elsewhere (R-hub, Github, your own Windows machine or image, etc.)
> 
>     Duncan Murdoch
> 
>     On 13/02/2022 10:32 a.m., Daniel Sjoberg wrote:
>      > Is there something wrong with the Windows Dev machine? It's now
>     been 3
>      > weeks since the release of the hardhat package v 0.2.0 on CRAN,
>     and it's
>      > still not available in the Win Dev check.
>      >
>      > I have this in my DESCRIPTION file:
>      > Imports:
>      >? ? ? hardhat (>= 0.2.0)
>      >
>      > And still getting this note when running devtools::check_win_devel().
>      >
>      > Package required and available but unsuitable version: 'hardhat'
>      >
>      > https://cran.r-project.org/package=hardhat
>     <https://cran.r-project.org/package=hardhat>
>      >
>      > Daniel
>      >
>      >
>      > On Tue, Feb 8, 2022 at 9:55 AM Daniel Sjoberg
>     <danield.sjoberg at gmail.com <mailto:danield.sjoberg at gmail.com>>
>      > wrote:
>      >
>      >> For what it's worth, I am seeing a similar issue.
>      >>
>      >> I am trying to make a release that depends on the hardhat
>     package, which
>      >> made a release on 2022-01-24, and it's still unavailable to check on
>      >> WinDevel. I am also depending on the newest release of gtsummary
>     which was
>      >> made available on CRAN on 2022-01-29 (after hardhat's release). The
>      >> gtsummary package, however, became available on WinDevel a few
>     days later.
>      >>
>      >> Thank you,
>      >> Daniel
>      >>
>      >> On Tue, Feb 8, 2022 at 9:06 AM Ian Lyttle <ijlyttle at me.com
>     <mailto:ijlyttle at me.com>> wrote:
>      >>>
>      >>> I am trying to check a package release-candidate on win-builder
>     r-devel.
>      >> This package imports a recently-released version of another package,
>      >> {vegawidget}.
>      >>> The check on win-builder (r-devel) fails:
>      >>> * checking package dependencies ... ERROR
>      >>> Package required and available but unsuitable version: 'vegawidget'
>      >>> {vegawidget} 0.4.1 was released on CRAN on 2022-01-29, but is
>     apparently
>      >> not available to win-builder r-devel.
>      >>> For what it?s worth, the check passes for win-builder r-release and
>      >> r-oldrel.
>      >>> Is this just a matter of me needing to be more patient, or
>     could there
>      >> be something ?stuck? at win-builder?
>      >>> Thanks!
>      >>>
>      >>>
>      >>>
>      >>>? ? ? ? ? [[alternative HTML version deleted]]
>      >>>
>      >>> ______________________________________________
>      >>> R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>      >>
>      >
>      >? ? ? ?[[alternative HTML version deleted]]
>      >
>      > ______________________________________________
>      > R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


