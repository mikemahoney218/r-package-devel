From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Fri Apr  1 00:49:19 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Fri, 1 Apr 2022 00:49:19 +0200
Subject: [R-pkg-devel] 
 "Setting LC_CTYPE=en_US.UTF-8" failed and "qpdf28.dll
 was not found" on Win 10
In-Reply-To: <f6aaf5e9-466b-c43b-f4a8-4828e25a3488@effectivedefense.org>
References: <1fbf0809-9e2f-448d-3809-5883ddfb94f9@effectivedefense.org>
 <20220331093934.51b68e24@Tarkus>
 <13e5ac7d-e559-90f1-3d5e-c5a0e212565b@gmail.com>
 <f6aaf5e9-466b-c43b-f4a8-4828e25a3488@effectivedefense.org>
Message-ID: <2d80665e-87c7-70b4-ea15-b466251ef62b@statistik.tu-dortmund.de>

Spencer, the suggestion are for chcks with R-4.2.0 alpha, for R-4.1.3 
the older toolchain is needed (but if no compiled code is used it may be 
fine to use the new one).

But then your qpdf is really in the Windows system32 directoy as 
suggested by
"C:\Windows\System32\qpdf_bin\qpdf.exe"
? I guess this is not the one from the new toolchain?


Best,
Uwe



On 31.03.2022 23:58, Spencer Graves wrote:
> Hi, Tomas and Ivan:
> 
> 
> On 3/31/22 1:52 AM, Tomas Kalibera wrote:
>>
>> On 3/31/22 08:39, Ivan Krylov wrote:
>>> On Wed, 30 Mar 2022 16:46:52 -0500
>>> Spencer Graves <spencer.graves at effectivedefense.org> wrote:
>>>
>>>> I'm getting different errors with MINGW64 and "Git CMD" under Windows
>>>> 10
>>> All these shortcuts do is launch cmd.exe or bash, optionally after
>>> setting %PATH%, optionally in a non-standard terminal application.
>>> Evidently, something in the %PATH% set by the shortcuts conflicts with
>>> the R CMD check process.
>>>
>>> For a package that doesn't have any compiled code, there should be no
>>> need for these tricks. Just start cmd.exe (for example, using Win+R,
>>> "cmd", Enter), navigate to your package and run something like
>>> "C:\Program Files\R-version\bin\R.exe" CMD check sos_2.1-4.tar.gz.
>>>
>>> If you're still having problems, try editing your %PATH% and trimming
>>> anything you don't need from there.
>>>
>>> If you're sure you need a special shortcut to launch a command line to
>>> check your package in, try installing Rtools and performing checks from
>>> "Rtools bash".
>>
>> With Rtools42, you don't need to run the Rtools bash, either, to check 
>> packages. You can use cmd.exe (or any other console/shell) or you can 
>> run the checks from R? (e.g. via tools::Rcmd). This has more details 
>> for R 4.2 with Rtools42 (but the same applies to R-devel):
>>
>> https://cran.r-project.org/bin/windows/base/howto-R-4.2.html
>>
>> With Rtools40 and R 4.0-4.1, this is almost the same but you need to 
>> adjust PATH in the running session of R (see 6.3.1 in R admin manual 
>> for the respective R release).
>>
>> Best
>> Tomas
> 
> Thanks.? On March 29, I upgraded to the latest version of R, RStudio 
> (free version), and installed rtools4.2.? I now have "Rtools", 
> "rtools40" and "rtools42" installed in the "C:\" root directory.? In a 
> terminal, I got "path", and noted that it does NOT contain anything 
> matching "rtools".
> 
> 
> After reviewing "howto-R-4.3.html", I ran "tools::Rcmd('check 
> sos_2.1-4.tar.gz')" as suggested there, with results given below.? I 
> have the sos package installed in "~Documents\R\sos\sos".? I have an R 
> project in "~Documents\R\sos", and I used devtools::load_all('sos') to 
> get RStudio to recognize the package.? With that, I pressed "Install and 
> Restart" and then "Check", and got seemingly the same results as 
> recorded below.
> 
> 
>  ????? What do you think?
>  ????? Thanks for the help.
>  ????? Spencer Graves
> 
> p.s.? On my Mac, "R CMD check sos_2.1-4.tar.gz" works fine, as does the 
> check process from within RStudio.? Something's wrong in my setup on my 
> Windows machine.
> 
> 
> tools::Rcmd('check sos_2.1-4.tar.gz')
> 
>  > tools::Rcmd('check sos_2.1-4.tar.gz')
> * using log directory 'C:/Users/spenc/Documents/R/sos/sos.Rcheck'
> * using R version 4.1.3 (2022-03-10)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: ISO8859-1
> * checking for file 'sos/DESCRIPTION' ... OK
> * this is package 'sos' version '2.1-4'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for executable files ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking whether package 'sos' can be installed ... OK
> * checking installed package size ... OK
> * checking package directory ... OK
> * checking 'build' directory ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking for left-over files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ... OK
> * checking whether the package can be loaded with stated dependencies 
> ... OK
> * checking whether the package can be unloaded cleanly ... OK
> * checking whether the namespace can be loaded with stated dependencies 
> ... OK
> * checking whether the namespace can be unloaded cleanly ... OK
> * checking dependencies in R code ... OK
> * checking S3 generic/method consistency ... OK
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... OK
> * checking Rd files ... OK
> * checking Rd metadata ... OK
> * checking Rd cross-references ... OK
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> * checking Rd \usage sections ... OK
> * checking Rd contents ... OK
> * checking for unstated dependencies in examples ... OK
> * checking sizes of PDF files under 'inst/doc' ...Warning in 
> system2(qpdf, "--version", TRUE) :
>  ? running command '"C:\Windows\System32\qpdf_bin\qpdf.exe" --version' 
> had status 309
> Error: invalid version specification 'NA'
> Execution halted
> 
> 
> R version 4.1.3 (2022-03-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 19043)
> 
> Matrix products: default
> 
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats???? graphics? grDevices utils???? datasets
> [6] methods?? base
> 
> other attached packages:
> [1] sos_2.1-4? brew_1.0-7
> 
> loaded via a namespace (and not attached):
> [1] compiler_4.1.3 tools_4.1.3
> 
>>
>>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Apr  1 11:59:57 2022
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 1 Apr 2022 10:59:57 +0100
Subject: [R-pkg-devel] 
 "Setting LC_CTYPE=en_US.UTF-8" failed and "qpdf28.dll
 was not found" on Win 10
In-Reply-To: <f6aaf5e9-466b-c43b-f4a8-4828e25a3488@effectivedefense.org>
References: <1fbf0809-9e2f-448d-3809-5883ddfb94f9@effectivedefense.org>
 <20220331093934.51b68e24@Tarkus>
 <13e5ac7d-e559-90f1-3d5e-c5a0e212565b@gmail.com>
 <f6aaf5e9-466b-c43b-f4a8-4828e25a3488@effectivedefense.org>
Message-ID: <6bb5d84b-cf4f-1923-60fd-b54a3e327b46@dewey.myzen.co.uk>

Dear Spencer

If I understand correctly your package sos does not have compiled code 
so as someone suggested earlier you do not need Rtools at all. The only 
drawback is that when I check my packages I get a note that it cannot 
find qpdf but they all pass checks on CRAN (which obviously does have qpdf).

Michael

On 31/03/2022 22:58, Spencer Graves wrote:
> Hi, Tomas and Ivan:
> 
> 
> On 3/31/22 1:52 AM, Tomas Kalibera wrote:
>>
>> On 3/31/22 08:39, Ivan Krylov wrote:
>>> On Wed, 30 Mar 2022 16:46:52 -0500
>>> Spencer Graves <spencer.graves at effectivedefense.org> wrote:
>>>
>>>> I'm getting different errors with MINGW64 and "Git CMD" under Windows
>>>> 10
>>> All these shortcuts do is launch cmd.exe or bash, optionally after
>>> setting %PATH%, optionally in a non-standard terminal application.
>>> Evidently, something in the %PATH% set by the shortcuts conflicts with
>>> the R CMD check process.
>>>
>>> For a package that doesn't have any compiled code, there should be no
>>> need for these tricks. Just start cmd.exe (for example, using Win+R,
>>> "cmd", Enter), navigate to your package and run something like
>>> "C:\Program Files\R-version\bin\R.exe" CMD check sos_2.1-4.tar.gz.
>>>
>>> If you're still having problems, try editing your %PATH% and trimming
>>> anything you don't need from there.
>>>
>>> If you're sure you need a special shortcut to launch a command line to
>>> check your package in, try installing Rtools and performing checks from
>>> "Rtools bash".
>>
>> With Rtools42, you don't need to run the Rtools bash, either, to check 
>> packages. You can use cmd.exe (or any other console/shell) or you can 
>> run the checks from R? (e.g. via tools::Rcmd). This has more details 
>> for R 4.2 with Rtools42 (but the same applies to R-devel):
>>
>> https://cran.r-project.org/bin/windows/base/howto-R-4.2.html
>>
>> With Rtools40 and R 4.0-4.1, this is almost the same but you need to 
>> adjust PATH in the running session of R (see 6.3.1 in R admin manual 
>> for the respective R release).
>>
>> Best
>> Tomas
> 
> Thanks.? On March 29, I upgraded to the latest version of R, RStudio 
> (free version), and installed rtools4.2.? I now have "Rtools", 
> "rtools40" and "rtools42" installed in the "C:\" root directory.? In a 
> terminal, I got "path", and noted that it does NOT contain anything 
> matching "rtools".
> 
> 
> After reviewing "howto-R-4.3.html", I ran "tools::Rcmd('check 
> sos_2.1-4.tar.gz')" as suggested there, with results given below.? I 
> have the sos package installed in "~Documents\R\sos\sos".? I have an R 
> project in "~Documents\R\sos", and I used devtools::load_all('sos') to 
> get RStudio to recognize the package.? With that, I pressed "Install and 
> Restart" and then "Check", and got seemingly the same results as 
> recorded below.
> 
> 
>  ????? What do you think?
>  ????? Thanks for the help.
>  ????? Spencer Graves
> 
> p.s.? On my Mac, "R CMD check sos_2.1-4.tar.gz" works fine, as does the 
> check process from within RStudio.? Something's wrong in my setup on my 
> Windows machine.
> 
> 
> tools::Rcmd('check sos_2.1-4.tar.gz')
> 
>  > tools::Rcmd('check sos_2.1-4.tar.gz')
> * using log directory 'C:/Users/spenc/Documents/R/sos/sos.Rcheck'
> * using R version 4.1.3 (2022-03-10)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: ISO8859-1
> * checking for file 'sos/DESCRIPTION' ... OK
> * this is package 'sos' version '2.1-4'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for executable files ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking whether package 'sos' can be installed ... OK
> * checking installed package size ... OK
> * checking package directory ... OK
> * checking 'build' directory ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking for left-over files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ... OK
> * checking whether the package can be loaded with stated dependencies 
> ... OK
> * checking whether the package can be unloaded cleanly ... OK
> * checking whether the namespace can be loaded with stated dependencies 
> ... OK
> * checking whether the namespace can be unloaded cleanly ... OK
> * checking dependencies in R code ... OK
> * checking S3 generic/method consistency ... OK
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... OK
> * checking Rd files ... OK
> * checking Rd metadata ... OK
> * checking Rd cross-references ... OK
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> * checking Rd \usage sections ... OK
> * checking Rd contents ... OK
> * checking for unstated dependencies in examples ... OK
> * checking sizes of PDF files under 'inst/doc' ...Warning in 
> system2(qpdf, "--version", TRUE) :
>  ? running command '"C:\Windows\System32\qpdf_bin\qpdf.exe" --version' 
> had status 309
> Error: invalid version specification 'NA'
> Execution halted
> 
> 
> R version 4.1.3 (2022-03-10)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 19043)
> 
> Matrix products: default
> 
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats???? graphics? grDevices utils???? datasets
> [6] methods?? base
> 
> other attached packages:
> [1] sos_2.1-4? brew_1.0-7
> 
> loaded via a namespace (and not attached):
> [1] compiler_4.1.3 tools_4.1.3
> 
>>
>>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 

-- 
Michael
http://www.dewey.myzen.co.uk/home.html


From m@pjg @end|ng |rom br|@to|@@c@uk  Fri Apr  1 17:46:51 2022
From: m@pjg @end|ng |rom br|@to|@@c@uk (Peter Green)
Date: Fri, 1 Apr 2022 16:46:51 +0100
Subject: [R-pkg-devel] Obscure-to-me parallel make issue
Message-ID: <8d05c5f1-1be0-f20e-45a3-747c015ffc2b@bristol.ac.uk>

I am having persistent but difficult-to-reproduce compilation errors for 
some CRAN tests on my package Nmix. These may be instances of the 
'parallel make' problem. A typical error message is
---
 ?? 30 |???????? use f2cio
 ????? |???????????????? 1
Fatal Error: Cannot open module file ?f2cio.mod? for reading at (1): No 
such file or directory
---

Apart from Nmix_init.c, my src directory has 8 source files:
---
.f : Nmix-sub3z, Nmix-aux, pnorm, rgamma, RNGfns
.c: wrapper.c
.f90: fef2cio, f2cio (each defining modules of the same name)
---

The dependency structure among them is summarised by:
---
Nmix-sub3z.f
 ?? ?calls pnorm.f rgamma.f Nmix-aux.f RNGfns.f
 ?? ?uses??? fef2cio.mod f2cio.mod
fef2cio.f90
 ?? ?uses? f2cio.mod
Nmix-aux.f
 ?? ?calls rgamma.f RNGfns.f
pnorm.f
 ?? ?calls RNGfns.f
rgamma.f
 ?? ?calls RNGfns.f
RNGfns.f
 ?? ?calls wrapper.c
---

My Makevars is:
---
C_OBJS = wrapper.o Nmix_init.o
FT_OBJS = Nmix-aux.o Nmix-sub3z.o RNGfns.o f2cio.o fef2cio.o pnorm.o 
rgamma2.o
all: $(SHLIB) clean
$(SHLIB): $(FT_OBJS) $(C_OBJS)
f2cio.mod: f2cio.o
fef2cio.mod: fef2cio.o f2cio.o
Nmix-sub3z.o: f2cio.mod fef2cio.mod
clean:
 ??? @rm -rf *.mod *.o
---

What dependency am I failing to capture? Or is there some other fault in 
the Makevars? Any clues welcome!

Peter Green



From tom@@@k@||ber@ @end|ng |rom gm@||@com  Fri Apr  1 18:09:29 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Fri, 1 Apr 2022 18:09:29 +0200
Subject: [R-pkg-devel] Obscure-to-me parallel make issue
In-Reply-To: <8d05c5f1-1be0-f20e-45a3-747c015ffc2b@bristol.ac.uk>
References: <8d05c5f1-1be0-f20e-45a3-747c015ffc2b@bristol.ac.uk>
Message-ID: <c31ef7d5-4d24-778c-2577-a9489f91bcea@gmail.com>


On 4/1/22 17:46, Peter Green wrote:
> I am having persistent but difficult-to-reproduce compilation errors 
> for some CRAN tests on my package Nmix. These may be instances of the 
> 'parallel make' problem. A typical error message is
> ---
> ?? 30 |???????? use f2cio
> ????? |???????????????? 1
> Fatal Error: Cannot open module file ?f2cio.mod? for reading at (1): 
> No such file or directory
> ---
>
> Apart from Nmix_init.c, my src directory has 8 source files:
> ---
> .f : Nmix-sub3z, Nmix-aux, pnorm, rgamma, RNGfns
> .c: wrapper.c
> .f90: fef2cio, f2cio (each defining modules of the same name)
> ---
>
> The dependency structure among them is summarised by:
> ---
> Nmix-sub3z.f
> ?? ?calls pnorm.f rgamma.f Nmix-aux.f RNGfns.f
> ?? ?uses??? fef2cio.mod f2cio.mod
> fef2cio.f90
> ?? ?uses? f2cio.mod
> Nmix-aux.f
> ?? ?calls rgamma.f RNGfns.f
> pnorm.f
> ?? ?calls RNGfns.f
> rgamma.f
> ?? ?calls RNGfns.f
> RNGfns.f
> ?? ?calls wrapper.c
> ---
>
> My Makevars is:
> ---
> C_OBJS = wrapper.o Nmix_init.o
> FT_OBJS = Nmix-aux.o Nmix-sub3z.o RNGfns.o f2cio.o fef2cio.o pnorm.o 
> rgamma2.o
> all: $(SHLIB) clean
> $(SHLIB): $(FT_OBJS) $(C_OBJS)
> f2cio.mod: f2cio.o
> fef2cio.mod: fef2cio.o f2cio.o
> Nmix-sub3z.o: f2cio.mod fef2cio.mod
> clean:
> ??? @rm -rf *.mod *.o
> ---
>
> What dependency am I failing to capture? Or is there some other fault 
> in the Makevars? Any clues welcome!

Maybe that fef2cio.o depends on f2cio.mod

make -d might be useful for finding out what is make doing and why.

It might be easier to debug via an incremental serial build - once the 
build succeeds (e.g. by coincidence), touch specific files and run 
"make" again to see if things that should be rebuilt actually are.

Tomas

>
> Peter Green
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Apr  1 18:36:12 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 1 Apr 2022 19:36:12 +0300
Subject: [R-pkg-devel] Obscure-to-me parallel make issue
In-Reply-To: <8d05c5f1-1be0-f20e-45a3-747c015ffc2b@bristol.ac.uk>
References: <8d05c5f1-1be0-f20e-45a3-747c015ffc2b@bristol.ac.uk>
Message-ID: <20220401193612.613a56e3@arachnoid>

On Fri, 1 Apr 2022 16:46:51 +0100
Peter Green <mapjg at bristol.ac.uk> wrote:

> f2cio.mod: f2cio.o
> fef2cio.mod: fef2cio.o f2cio.o
> Nmix-sub3z.o: f2cio.mod fef2cio.mod

What rule does Make use for the f2cio.o -> f2cio.mod transition? GNU
Make could have a built-in rule for .mod files and get confused thinking
it has a circular dependency:

Nmix/src$ make -n Nmix-sub3z.o -f Makevars
make: Circular f2cio.o <- f2cio.mod dependency dropped.
m2c    -o f2cio.o
make: Circular fef2cio.o <- fef2cio.mod dependency dropped.
m2c    -o fef2cio.o
f77   -c -o Nmix-sub3z.o Nmix-sub3z.f

In my experience, it can be easier to express the Fortran module
dependencies by lying to Make and telling it that the .o file depends
on the .o file corresponding to the .mod file, not the .mod file
itself. This way, the dependent rule shouldn't be started until the
parent rule is finished producing both files.

If you have a quick way of reproducing the problem, does it help to use

Nmix-sub3z.o: f2cio.o fef2cio.o

in your dependencies and avoid mentioning *.mod at all?

-- 
Best regards,
Ivan


From edd @end|ng |rom deb|@n@org  Mon Apr  4 20:46:49 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 4 Apr 2022 13:46:49 -0500
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
Message-ID: <25163.15641.715595.766989@rob.eddelbuettel.com>


Is anybody else looking into trying to come to terms with MXE for
cross-compiling for UCRT for R 4.2.0 and its updated Windows toolchain?  I
have been bugging Tomas in private email for a bit and figured it might be
useful to spread the load a little.

Is anybody else looking into this?  Any interest in pooling resources around
some virtual meeting place? New mailing list? Or an ad-hoc slack (or channel
on existing one)?

Dirk

PS My current status:
- MXE installed on Ubuntu as cross-compilation. Pretty straightforward.
- One initial test build (using cmake) failed:
     fatal error: Windows.h: No such file or directory
- Another of a known cmake-using library (nlopt) succeeded. Good. 

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From m@tth|@@-gond@n @end|ng |rom gmx@de  Mon Apr  4 21:05:12 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (matthias-gondan)
Date: Mon, 04 Apr 2022 21:05:12 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <25163.15641.715595.766989@rob.eddelbuettel.com>
Message-ID: <1MZTmY-1nXadl3z6c-00WXR3@mail.gmx.net>

Still compiling... but when it is done, I might also need some advice. I don't mind if mxe help is given on this mailing list.Best wishesMatthias?
-------- Urspr?ngliche Nachricht --------Von: Dirk Eddelbuettel <edd at debian.org> Datum: 04.04.22  20:47  (GMT+01:00) An: r-package-devel at r-project.org Betreff: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds Is anybody else looking into trying to come to terms with MXE forcross-compiling for UCRT for R 4.2.0 and its updated Windows toolchain?? Ihave been bugging Tomas in private email for a bit and figured it might beuseful to spread the load a little.Is anybody else looking into this?? Any interest in pooling resources aroundsome virtual meeting place? New mailing list? Or an ad-hoc slack (or channelon existing one)?DirkPS My current status:- MXE installed on Ubuntu as cross-compilation. Pretty straightforward.- One initial test build (using cmake) failed:???? fatal error: Windows.h: No such file or directory- Another of a known cmake-using library (nlopt) succeeded. Good. -- dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org______________________________________________R-package-devel@r-project.org mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Tue Apr  5 08:55:32 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Tue, 5 Apr 2022 08:55:32 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <25163.15641.715595.766989@rob.eddelbuettel.com>
References: <25163.15641.715595.766989@rob.eddelbuettel.com>
Message-ID: <0d2831a0-bdbb-aeb8-c8a6-3ced81e2772a@gmail.com>


On 4/4/22 20:46, Dirk Eddelbuettel wrote:
> Is anybody else looking into trying to come to terms with MXE for
> cross-compiling for UCRT for R 4.2.0 and its updated Windows toolchain?  I
> have been bugging Tomas in private email for a bit and figured it might be
> useful to spread the load a little.
>
> Is anybody else looking into this?  Any interest in pooling resources around
> some virtual meeting place? New mailing list? Or an ad-hoc slack (or channel
> on existing one)?
>
> Dirk
>
> PS My current status:
> - MXE installed on Ubuntu as cross-compilation. Pretty straightforward.
> - One initial test build (using cmake) failed:
>       fatal error: Windows.h: No such file or directory

It might be you will have to patch the software for this one (to 
"windows.h"). Some software doesn't get regularly built on case 
sensitive filesystems.

See the "src" directory of MXE, grepping the ".patch" files,
grep Windows\.h *patch

for adaptations that had to be done for some software already

Best
Tomas

> - Another of a known cmake-using library (nlopt) succeeded. Good.
>


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Tue Apr  5 09:08:32 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Tue, 5 Apr 2022 09:08:32 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <1MZTmY-1nXadl3z6c-00WXR3@mail.gmx.net>
References: <1MZTmY-1nXadl3z6c-00WXR3@mail.gmx.net>
Message-ID: <e3b3316d-3778-0800-eaa5-39efcf9b1d8e@gmail.com>

On 4/4/22 21:05, matthias-gondan wrote:
> Still compiling... but when it is done, I might also need some advice. I don't mind if mxe help is given on this mailing list.Best wishesMatthias

I am happy to help if you run into specific issues. If you decided to 
build SWI Prolog in the end from source, please note I've recently added 
a host build of cmake to Rtools42. The Berkeley db is part of MXE and 
can trivially be added to Rtools42 if you need it (simply would be 
listed in settings.mk, running "make db" succeeds on my system, 
producing libdb.a). Libuuid is already part of Rtools42.

Best
Tomas

> -------- Urspr?ngliche Nachricht --------Von: Dirk Eddelbuettel <edd at debian.org> Datum: 04.04.22  20:47  (GMT+01:00) An: r-package-devel at r-project.org Betreff: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds Is anybody else looking into trying to come to terms with MXE forcross-compiling for UCRT for R 4.2.0 and its updated Windows toolchain?? Ihave been bugging Tomas in private email for a bit and figured it might beuseful to spread the load a little.Is anybody else looking into this?? Any interest in pooling resources aroundsome virtual meeting place? New mailing list? Or an ad-hoc slack (or channelon existing one)?DirkPS My current status:- MXE installed on Ubuntu as cross-compilation. Pretty straightforward.- One initial test build (using cmake) failed:???? fatal error: Windows.h: No such file or directory- Another of a known cmake-using library (nlopt) succeeded. Good. -- dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org______________________________________________R-package-devel@r-project.org mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

From m@tth|@@-gond@n @end|ng |rom gmx@de  Tue Apr  5 09:51:15 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Tue, 5 Apr 2022 09:51:15 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <e3b3316d-3778-0800-eaa5-39efcf9b1d8e@gmail.com>
References: <1MZTmY-1nXadl3z6c-00WXR3@mail.gmx.net>
 <e3b3316d-3778-0800-eaa5-39efcf9b1d8e@gmail.com>
Message-ID: <1MWics-1nUvqF0wu0-00X4RV@mail.gmx.net>

Dear Tomas,

Wow, thanks! Having cmake is, of course, a great improvement, of use for many people. Thanks a lot! 

Best wishes,

Matthias



Von: Tomas Kalibera
Gesendet: Dienstag, 5. April 2022 09:08
An: matthias-gondan; Dirk Eddelbuettel; r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds

On 4/4/22 21:05, matthias-gondan wrote:
> Still compiling... but when it is done, I might also need some advice. I don't mind if mxe help is given on this mailing list.Best wishesMatthias

I am happy to help if you run into specific issues. If you decided to 
build SWI Prolog in the end from source, please note I've recently added 
a host build of cmake to Rtools42. The Berkeley db is part of MXE and 
can trivially be added to Rtools42 if you need it (simply would be 
listed in settings.mk, running "make db" succeeds on my system, 
producing libdb.a). Libuuid is already part of Rtools42.

Best
Tomas

> -------- Urspr?ngliche Nachricht --------Von: Dirk Eddelbuettel <edd at debian.org> Datum: 04.04.22  20:47  (GMT+01:00) An: r-package-devel at r-project.org Betreff: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds Is anybody else looking into trying to come to terms with MXE forcross-compiling for UCRT for R 4.2.0 and its updated Windows toolchain?? Ihave been bugging Tomas in private email for a bit and figured it might beuseful to spread the load a little.Is anybody else looking into this?? Any interest in pooling resources aroundsome virtual meeting place? New mailing list? Or an ad-hoc slack (or channelon existing one)?DirkPS My current status:- MXE installed on Ubuntu as cross-compilation. Pretty straightforward.- One initial test build (using cmake) failed:???? fatal error: Windows.h: No such file or directory- Another of a known cmake-using library (nlopt) succeeded. Good. -- dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org______________________________________________R-package-devel@r-project.org mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Tue Apr  5 18:00:22 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Tue, 5 Apr 2022 12:00:22 -0400
Subject: [R-pkg-devel] rmarkdown vignette build failures?
Message-ID: <ddcff059-5672-eb28-0a71-93955e4ac859@gmail.com>

   I'm sure I'm doing something silly, but I've recently started having 
a problem building vignettes (with R Under development (unstable) 
(2022-04-05 r82094) -- "Unsuffered Consequences")

   Is anyone else seeing this?

$ R CMD build broom.mixed
* checking for file ?broom.mixed/DESCRIPTION? ... OK
* preparing ?broom.mixed?:
* checking DESCRIPTION meta-information ... OK
* installing the package to build vignettes
* creating vignettes ...Error in find_vignette_product(name, by = 
"weave", dir = docdir, engine = engine) :
   Failed to locate ?weave? output file ?broom_mixed_intro.pdf? or 
?broom_mixed_intro.html? for vignette with name ?broom_mixed_intro? and 
engine ?utils::Sweave?. The following files exist in working directory 
?/tmp/Rtmp7rjAe4/Rbuild3978f3146b8cd8/broom.mixed/vignettes?: 
?broom_mixed_intro.rmd? (6322 bytes)
Execution halted

   The weird thing here is that I don't see why R is trying to use 
utils::Sweave ?  The DESCRIPTION file has VignetteBuilder: knitr and the 
head of the vignette file has

vignette: >
   %\VignetteIndexEntry{introduction to broom.mixed}
   %\VignetteEngine{knitr::rmarkdown}
   \usepackage[utf8]{inputenc}

  ...

  I could swear this used to work ...

   cheers
   Ben Bolker


From bbo|ker @end|ng |rom gm@||@com  Tue Apr  5 20:10:57 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Tue, 5 Apr 2022 14:10:57 -0400
Subject: [R-pkg-devel] rmarkdown vignette build failures?
In-Reply-To: <ddcff059-5672-eb28-0a71-93955e4ac859@gmail.com>
References: <ddcff059-5672-eb28-0a71-93955e4ac859@gmail.com>
Message-ID: <cf600942-f0e2-0f6e-b8d7-7abf87c1f2fe@gmail.com>

   Follow-up: the problem goes away if I revert from SVN r82094 to 
r81000.  Will try some more bisection ...

On 4/5/22 12:00 PM, Ben Bolker wrote:
>  ? I'm sure I'm doing something silly, but I've recently started having 
> a problem building vignettes (with R Under development (unstable) 
> (2022-04-05 r82094) -- "Unsuffered Consequences")
> 
>  ? Is anyone else seeing this?
> 
> $ R CMD build broom.mixed
> * checking for file ?broom.mixed/DESCRIPTION? ... OK
> * preparing ?broom.mixed?:
> * checking DESCRIPTION meta-information ... OK
> * installing the package to build vignettes
> * creating vignettes ...Error in find_vignette_product(name, by = 
> "weave", dir = docdir, engine = engine) :
>  ? Failed to locate ?weave? output file ?broom_mixed_intro.pdf? or 
> ?broom_mixed_intro.html? for vignette with name ?broom_mixed_intro? and 
> engine ?utils::Sweave?. The following files exist in working directory 
> ?/tmp/Rtmp7rjAe4/Rbuild3978f3146b8cd8/broom.mixed/vignettes?: 
> ?broom_mixed_intro.rmd? (6322 bytes)
> Execution halted
> 
>  ? The weird thing here is that I don't see why R is trying to use 
> utils::Sweave ?? The DESCRIPTION file has VignetteBuilder: knitr and the 
> head of the vignette file has
> 
> vignette: >
>  ? %\VignetteIndexEntry{introduction to broom.mixed}
>  ? %\VignetteEngine{knitr::rmarkdown}
>  ? \usepackage[utf8]{inputenc}
> 
>  ?...
> 
>  ?I could swear this used to work ...
> 
>  ? cheers
>  ? Ben Bolker
> 
> 
> 
> 

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Tue Apr  5 20:20:37 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Tue, 5 Apr 2022 20:20:37 +0200
Subject: [R-pkg-devel] handling of byte-order-mark on
 r-devel-linux-x86_64-debian-clang machine
In-Reply-To: <20220328141610.0cd17f38@arachnoid>
References: <AF437760-5DD5-41D6-A8AF-4C0BA064570F@dal.ca>
 <20220326165842.3605c913@Tarkus>
 <20a2da52-6488-6fd2-e6a3-bfca617a87c7@gmail.com>
 <20220328141610.0cd17f38@arachnoid>
Message-ID: <ba71d463-d19f-35ba-20c8-0e65cb37e45e@gmail.com>


On 3/28/22 13:16, Ivan Krylov wrote:
> On Mon, 28 Mar 2022 09:54:57 +0200
> Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>
>> Could you please clarify which part you found somewhat confusing,
>> could that be improved?
> Perhaps "somewhat confusing" is an overstatement, sorry about that. All
> the information is already there in both ?file and ?readLines, it just
> requires a bit of thought to understand it.
>
>>> When reading from a text connection, the connections code, after
>>> re-encoding based on the ?encoding? argument, returns text that is
>>> assumed to be in native encoding; an encoding mark is only added by
>>> functions that read from the connection, so e.g.  ?readLines? can
>>> be instructed to mark the text as ?"UTF-8"? or ?"latin1"?, but
>>> ?readLines? does no further conversion.  To allow reading text in
>>> ?"UTF-8"? on a system that cannot represent all such characters in
>>> native encoding (currently only Windows), a connection can be
>>> internally configured to return the read text in UTF-8 even though
>>> it is not the native encoding; currently ?readLines? and ?scan? use
>>> this feature when given a connection that is not yet open and, when
>>> using the feature, they unconditionally mark the text as ?"UTF-8"?.
> The paragraph starts by telling the user that the text is decoded into
> the native encoding, then tells about marking the encoding (which is
> counter-productive when decoding arbitrarily-encoded text into native
> encoding) and only then presents the exception to the native encoding
> output rule (decoding into UTF-8). If I'm trying to read a
> CP1252-encoded file on a Windows 7 machine with CP1251 as the session
> encoding, I might get confused by the mention of encoding mark between
> the parts that are important to me.
>
> It could be an improvement to mention that exception closer to the
> first point of the paragraph and, perhaps, to split the "encoding mark"
> part from the "text connection decoding" part:
>
>>> Functions that read from the connection can add an encoding mark
>>> to the returned text. For example, ?readLines? can be instructed
>>> to mark the text as ?"UTF-8"? or ?"latin1"?, but does no further
>>> conversion.
>>>
>>> When given a connection that is not yet open and has a non-default
>>> ?encoding? argument, ?readLines? and ?scan? internally configure the
>>> connection to read text in UTF-8. Otherwise, the text after decoding
>>> is assumed to be in native encoding.
> (Maybe this is omitting too much and should be expanded.)
>
> It could also be helpful to mention the fact that the encoding argument
> to readLines() can be ignored right in the description of that
> argument, inviting the user to read the Details section for more
> information.

Thanks for the suggestions, I've rewritten the paragraphs, biasing 
towards users who have UTF-8 as the native encoding as this is going to 
be the majority. These users should not have to worry much about the 
encoding marks anymore, nor about the internal UTF-8 mode of the 
connections code. But the level of detail I think needs to remain as 
long as these features are supported - the level of detail is based on 
numerous questions and bug reports.

Best
Tomas


From @eb@meyer @end|ng |rom |@u@de  Tue Apr  5 22:57:46 2022
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Tue, 5 Apr 2022 22:57:46 +0200
Subject: [R-pkg-devel] rmarkdown vignette build failures?
In-Reply-To: <ddcff059-5672-eb28-0a71-93955e4ac859@gmail.com>
References: <ddcff059-5672-eb28-0a71-93955e4ac859@gmail.com>
Message-ID: <1f5678a5-0e70-7c37-ee3c-200c0f807ca0@fau.de>

Am 05.04.22 um 18:00 schrieb Ben Bolker:
>  ? I'm sure I'm doing something silly, but I've recently started having 
> a problem building vignettes (with R Under development (unstable) 
> (2022-04-05 r82094) -- "Unsuffered Consequences")
> 
>  ? Is anyone else seeing this?
> 
> $ R CMD build broom.mixed
> * checking for file ?broom.mixed/DESCRIPTION? ... OK
> * preparing ?broom.mixed?:
> * checking DESCRIPTION meta-information ... OK
> * installing the package to build vignettes
> * creating vignettes ...Error in find_vignette_product(name, by = 
> "weave", dir = docdir, engine = engine) :
>  ? Failed to locate ?weave? output file ?broom_mixed_intro.pdf? or 
> ?broom_mixed_intro.html? for vignette with name ?broom_mixed_intro? and 
> engine ?utils::Sweave?. The following files exist in working directory 
> ?/tmp/Rtmp7rjAe4/Rbuild3978f3146b8cd8/broom.mixed/vignettes?: 
> ?broom_mixed_intro.rmd? (6322 bytes)
> Execution halted
> 
>  ? The weird thing here is that I don't see why R is trying to use 
> utils::Sweave ?  

I wasn't able to reproduce the build failure, but the reported vignette 
engine seems to be wrong. Indeed, there was an old (2013) bug in 
tools::pkgVignettes() that caused the reported engine in that error 
message to *always* be 'utils::Sweave'. I have just fixed that in 
R-devel (c82097, also ported to R-alpha, to be rebuilt in a few hours) 
but that won't solve the build failure itself.

The build failure most likely comes from

     # Rescan for weave and tangle output files
     vigns <- pkgVignettes(dir = '.', output = TRUE, source = TRUE)

after "successful" (only in the sense of not throwing an error) 
'buildVignettes(dir = '.', tangle = TRUE)', where 'dir' is the package 
source directory. Running these commands (from library("tools")) 
interactively should help debugging the problem at your end. From the 
error message it seems that buildVignettes() did not produce any output 
files.

	Sebastian Meyer


> The DESCRIPTION file has VignetteBuilder: knitr and the 
> head of the vignette file has
> 
> vignette: >
>  ? %\VignetteIndexEntry{introduction to broom.mixed}
>  ? %\VignetteEngine{knitr::rmarkdown}
>  ? \usepackage[utf8]{inputenc}
> 
>  ?...
> 
>  ?I could swear this used to work ...
> 
>  ? cheers
>  ? Ben Bolker
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Wed Apr  6 00:02:41 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 05 Apr 2022 15:02:41 -0700
Subject: [R-pkg-devel] handling of byte-order-mark on
 r-devel-linux-x86_64-debian-clang machine
In-Reply-To: <ba71d463-d19f-35ba-20c8-0e65cb37e45e@gmail.com>
References: <AF437760-5DD5-41D6-A8AF-4C0BA064570F@dal.ca>
 <20220326165842.3605c913@Tarkus>
 <20a2da52-6488-6fd2-e6a3-bfca617a87c7@gmail.com>
 <20220328141610.0cd17f38@arachnoid>
 <ba71d463-d19f-35ba-20c8-0e65cb37e45e@gmail.com>
Message-ID: <76224FE3-C4E9-4B67-94C3-F17CF1DAFBCB@dcn.davis.ca.us>

Thanks to the ubiquity of Excel and its misguided inclusion of BOM codes in its UTF-8 CSV format, this optimism about encoding being a corner case seems premature. There are actually multiple options in Excel for writing CSV files, and only one of them (not the first one fortunately) has this "feature", but I (and various beginners I end up helping) seem to encounter these silly files far more frequently than seems reasonable.

On April 5, 2022 11:20:37 AM PDT, Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>
>On 3/28/22 13:16, Ivan Krylov wrote:
>> On Mon, 28 Mar 2022 09:54:57 +0200
>> Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>>
>>> Could you please clarify which part you found somewhat confusing,
>>> could that be improved?
>> Perhaps "somewhat confusing" is an overstatement, sorry about that. All
>> the information is already there in both ?file and ?readLines, it just
>> requires a bit of thought to understand it.
>>
>>>> When reading from a text connection, the connections code, after
>>>> re-encoding based on the ?encoding? argument, returns text that is
>>>> assumed to be in native encoding; an encoding mark is only added by
>>>> functions that read from the connection, so e.g.  ?readLines? can
>>>> be instructed to mark the text as ?"UTF-8"? or ?"latin1"?, but
>>>> ?readLines? does no further conversion.  To allow reading text in
>>>> ?"UTF-8"? on a system that cannot represent all such characters in
>>>> native encoding (currently only Windows), a connection can be
>>>> internally configured to return the read text in UTF-8 even though
>>>> it is not the native encoding; currently ?readLines? and ?scan? use
>>>> this feature when given a connection that is not yet open and, when
>>>> using the feature, they unconditionally mark the text as ?"UTF-8"?.
>> The paragraph starts by telling the user that the text is decoded into
>> the native encoding, then tells about marking the encoding (which is
>> counter-productive when decoding arbitrarily-encoded text into native
>> encoding) and only then presents the exception to the native encoding
>> output rule (decoding into UTF-8). If I'm trying to read a
>> CP1252-encoded file on a Windows 7 machine with CP1251 as the session
>> encoding, I might get confused by the mention of encoding mark between
>> the parts that are important to me.
>>
>> It could be an improvement to mention that exception closer to the
>> first point of the paragraph and, perhaps, to split the "encoding mark"
>> part from the "text connection decoding" part:
>>
>>>> Functions that read from the connection can add an encoding mark
>>>> to the returned text. For example, ?readLines? can be instructed
>>>> to mark the text as ?"UTF-8"? or ?"latin1"?, but does no further
>>>> conversion.
>>>>
>>>> When given a connection that is not yet open and has a non-default
>>>> ?encoding? argument, ?readLines? and ?scan? internally configure the
>>>> connection to read text in UTF-8. Otherwise, the text after decoding
>>>> is assumed to be in native encoding.
>> (Maybe this is omitting too much and should be expanded.)
>>
>> It could also be helpful to mention the fact that the encoding argument
>> to readLines() can be ignored right in the description of that
>> argument, inviting the user to read the Details section for more
>> information.
>
>Thanks for the suggestions, I've rewritten the paragraphs, biasing 
>towards users who have UTF-8 as the native encoding as this is going to 
>be the majority. These users should not have to worry much about the 
>encoding marks anymore, nor about the internal UTF-8 mode of the 
>connections code. But the level of detail I think needs to remain as 
>long as these features are supported - the level of detail is based on 
>numerous questions and bug reports.
>
>Best
>Tomas
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Apr  6 09:08:28 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 6 Apr 2022 09:08:28 +0200
Subject: [R-pkg-devel] handling of byte-order-mark on
 r-devel-linux-x86_64-debian-clang machine
In-Reply-To: <76224FE3-C4E9-4B67-94C3-F17CF1DAFBCB@dcn.davis.ca.us>
References: <AF437760-5DD5-41D6-A8AF-4C0BA064570F@dal.ca>
 <20220326165842.3605c913@Tarkus>
 <20a2da52-6488-6fd2-e6a3-bfca617a87c7@gmail.com>
 <20220328141610.0cd17f38@arachnoid>
 <ba71d463-d19f-35ba-20c8-0e65cb37e45e@gmail.com>
 <76224FE3-C4E9-4B67-94C3-F17CF1DAFBCB@dcn.davis.ca.us>
Message-ID: <4ee89513-81cb-cefc-a482-811eef8acd30@gmail.com>

On 4/6/22 00:02, Jeff Newmiller wrote:
> Thanks to the ubiquity of Excel and its misguided inclusion of BOM codes in its UTF-8 CSV format, this optimism about encoding being a corner case seems premature. There are actually multiple options in Excel for writing CSV files, and only one of them (not the first one fortunately) has this "feature", but I (and various beginners I end up helping) seem to encounter these silly files far more frequently than seems reasonable.

I was rather referring to encoding marks in R which declare an encoding 
of an R string, that is what you see by Encoding(). And to other 
measures to avoid the problem when the native encoding in R cannot 
represent all characters users need to work with (when the native 
encoding cannot be UTF-8). From R 4.2, the native encoding will be UTF-8 
also on (recent) Windows systems; on most Unix systems, it has been 
UTF-8 for years. But this change will not impact the handling of BOMs in 
input.

Is the problem reading CSV files from Excel (even when Excel is at 
fault) reported anywhere? If not, please report, maybe there is 
something that could be done to help processing those files on the R 
side. R handles BOMs in the "connections" code, ?connections, and it 
uses iconv for input conversion.

Thanks
Tomas

>
> On April 5, 2022 11:20:37 AM PDT, Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>> On 3/28/22 13:16, Ivan Krylov wrote:
>>> On Mon, 28 Mar 2022 09:54:57 +0200
>>> Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>>>
>>>> Could you please clarify which part you found somewhat confusing,
>>>> could that be improved?
>>> Perhaps "somewhat confusing" is an overstatement, sorry about that. All
>>> the information is already there in both ?file and ?readLines, it just
>>> requires a bit of thought to understand it.
>>>
>>>>> When reading from a text connection, the connections code, after
>>>>> re-encoding based on the ?encoding? argument, returns text that is
>>>>> assumed to be in native encoding; an encoding mark is only added by
>>>>> functions that read from the connection, so e.g.  ?readLines? can
>>>>> be instructed to mark the text as ?"UTF-8"? or ?"latin1"?, but
>>>>> ?readLines? does no further conversion.  To allow reading text in
>>>>> ?"UTF-8"? on a system that cannot represent all such characters in
>>>>> native encoding (currently only Windows), a connection can be
>>>>> internally configured to return the read text in UTF-8 even though
>>>>> it is not the native encoding; currently ?readLines? and ?scan? use
>>>>> this feature when given a connection that is not yet open and, when
>>>>> using the feature, they unconditionally mark the text as ?"UTF-8"?.
>>> The paragraph starts by telling the user that the text is decoded into
>>> the native encoding, then tells about marking the encoding (which is
>>> counter-productive when decoding arbitrarily-encoded text into native
>>> encoding) and only then presents the exception to the native encoding
>>> output rule (decoding into UTF-8). If I'm trying to read a
>>> CP1252-encoded file on a Windows 7 machine with CP1251 as the session
>>> encoding, I might get confused by the mention of encoding mark between
>>> the parts that are important to me.
>>>
>>> It could be an improvement to mention that exception closer to the
>>> first point of the paragraph and, perhaps, to split the "encoding mark"
>>> part from the "text connection decoding" part:
>>>
>>>>> Functions that read from the connection can add an encoding mark
>>>>> to the returned text. For example, ?readLines? can be instructed
>>>>> to mark the text as ?"UTF-8"? or ?"latin1"?, but does no further
>>>>> conversion.
>>>>>
>>>>> When given a connection that is not yet open and has a non-default
>>>>> ?encoding? argument, ?readLines? and ?scan? internally configure the
>>>>> connection to read text in UTF-8. Otherwise, the text after decoding
>>>>> is assumed to be in native encoding.
>>> (Maybe this is omitting too much and should be expanded.)
>>>
>>> It could also be helpful to mention the fact that the encoding argument
>>> to readLines() can be ignored right in the description of that
>>> argument, inviting the user to read the Details section for more
>>> information.
>> Thanks for the suggestions, I've rewritten the paragraphs, biasing
>> towards users who have UTF-8 as the native encoding as this is going to
>> be the majority. These users should not have to worry much about the
>> encoding marks anymore, nor about the internal UTF-8 mode of the
>> connections code. But the level of detail I think needs to remain as
>> long as these features are supported - the level of detail is based on
>> numerous questions and bug reports.
>>
>> Best
>> Tomas
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Apr  6 10:23:52 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 6 Apr 2022 11:23:52 +0300
Subject: [R-pkg-devel] handling of byte-order-mark on
 r-devel-linux-x86_64-debian-clang machine
In-Reply-To: <ba71d463-d19f-35ba-20c8-0e65cb37e45e@gmail.com>
References: <AF437760-5DD5-41D6-A8AF-4C0BA064570F@dal.ca>
 <20220326165842.3605c913@Tarkus>
 <20a2da52-6488-6fd2-e6a3-bfca617a87c7@gmail.com>
 <20220328141610.0cd17f38@arachnoid>
 <ba71d463-d19f-35ba-20c8-0e65cb37e45e@gmail.com>
Message-ID: <20220406112352.6629711b@Tarkus>

On Tue, 5 Apr 2022 20:20:37 +0200
Tomas Kalibera <tomas.kalibera at gmail.com> wrote:

> I've rewritten the paragraphs, biasing towards users who have UTF-8
> as the native encoding as this is going to be the majority.

Thank you!

> But the level of detail I think needs to remain as long as these
> features are supported - the level of detail is based on numerous
> questions and bug reports.

Of course, all these features have their use cases and it's important
to stay backwards compatible, including the documentation.

I would also like to apologise to Dan for leading him on a wild goose
chase that didn't bring him passing read.csv-related tests in the end.

-- 
Best regards,
Ivan


From bbo|ker @end|ng |rom gm@||@com  Thu Apr  7 03:54:16 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 6 Apr 2022 21:54:16 -0400
Subject: [R-pkg-devel] rmarkdown vignette build failures?
In-Reply-To: <cf600942-f0e2-0f6e-b8d7-7abf87c1f2fe@gmail.com>
References: <ddcff059-5672-eb28-0a71-93955e4ac859@gmail.com>
 <cf600942-f0e2-0f6e-b8d7-7abf87c1f2fe@gmail.com>
Message-ID: <49e3c4ae-c267-b770-0334-5cec278daf57@gmail.com>

   Follow-up.

* I was wrong about the reversion to an earlier SVN commit helping

* Sebastian Meyer provided **enormously** useful feedback in telling me 
that these are the steps required to replicate what "R CMD build" is 
doing internally when it fails

   tools::buildVignettes(dir = ".", tangle = TRUE)
   vigns <- tools::pkgVignettes(dir = '.', output = TRUE, source = TRUE)

* running this code interactively allowed me to see that my build was 
failing with these errors:

Error: processing vignette 'lmer.Rnw' failed with diagnostics:
Running 'texi2dvi' on 'lmer.tex' failed.
LaTeX errors:
! Package inputenc Error: Unicode character ? (U+250C)
(inputenc)                not set up for use with LaTeX.

* further digging showed that for some reason I **absolutely still do 
not understand**, a simple Rnw chunk that printed a data frame was for 
some reason finding a 'huxtable' package printing method and trying to 
print the table using weird Unicode outline characters (e.g. the U+250C 
complained about above was being used as a box-corner character)

* I still don't really understand what's going on, but I'm getting there ...

   cheers
    Ben Bolker





On 4/5/22 2:10 PM, Ben Bolker wrote:
>  ? Follow-up: the problem goes away if I revert from SVN r82094 to 
> r81000.? Will try some more bisection ...
> 
> On 4/5/22 12:00 PM, Ben Bolker wrote:
>> ?? I'm sure I'm doing something silly, but I've recently started 
>> having a problem building vignettes (with R Under development 
>> (unstable) (2022-04-05 r82094) -- "Unsuffered Consequences")
>>
>> ?? Is anyone else seeing this?
>>
>> $ R CMD build broom.mixed
>> * checking for file ?broom.mixed/DESCRIPTION? ... OK
>> * preparing ?broom.mixed?:
>> * checking DESCRIPTION meta-information ... OK
>> * installing the package to build vignettes
>> * creating vignettes ...Error in find_vignette_product(name, by = 
>> "weave", dir = docdir, engine = engine) :
>> ?? Failed to locate ?weave? output file ?broom_mixed_intro.pdf? or 
>> ?broom_mixed_intro.html? for vignette with name ?broom_mixed_intro? 
>> and engine ?utils::Sweave?. The following files exist in working 
>> directory 
>> ?/tmp/Rtmp7rjAe4/Rbuild3978f3146b8cd8/broom.mixed/vignettes?: 
>> ?broom_mixed_intro.rmd? (6322 bytes)
>> Execution halted
>>
>> ?? The weird thing here is that I don't see why R is trying to use 
>> utils::Sweave ?? The DESCRIPTION file has VignetteBuilder: knitr and 
>> the head of the vignette file has
>>
>> vignette: >
>> ?? %\VignetteIndexEntry{introduction to broom.mixed}
>> ?? %\VignetteEngine{knitr::rmarkdown}
>> ?? \usepackage[utf8]{inputenc}
>>
>> ??...
>>
>> ??I could swear this used to work ...
>>
>> ?? cheers
>> ?? Ben Bolker
>>
>>
>>
>>
> 

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics


From m@tth|@@-gond@n @end|ng |rom gmx@de  Fri Apr  8 12:49:12 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (matthias-gondan)
Date: Fri, 08 Apr 2022 12:49:12 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <e3b3316d-3778-0800-eaa5-39efcf9b1d8e@gmail.com>
Message-ID: <1MY68T-1nTFXB3kzN-00YV30@mail.gmx.net>

Dear Thomas,This is great news, thank you. I understand that I use the /usr/bin/cmake from Rtools42, not /ucrt64/bin/cmake, correct? Which generator should I select, "Unix Makefiles"? I ask because this requires a few more #defines for Swi-Prolog, but that should be feasible.Best wishes,?Matthias?
-------- Urspr?ngliche Nachricht --------Von: Tomas Kalibera <tomas.kalibera at gmail.com> Datum: 05.04.22  09:08  (GMT+01:00) An: matthias-gondan <matthias-gondan at gmx.de>, Dirk Eddelbuettel <edd at debian.org>, r-package-devel at r-project.org Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds On 4/4/22 21:05, matthias-gondan wrote:> Still compiling... but when it is done, I might also need some advice. I don't mind if mxe help is given on this mailing list.Best wishesMatthiasI am happy to help if you run into specific issues. If you decided to build SWI Prolog in the end from source, please note I've recently added a host build of cmake to Rtools42. The Berkeley db is part of MXE and can trivially be added to Rtools42 if you need it (simply would be listed in settings.mk, running "make db" succeeds on my system, producing libdb.a). Libuuid is already part of Rtools42.BestTomas> -------- Urspr?ngliche Nachricht --------Von: Dirk Eddelbuettel <edd at debian.org> Datum: 04.04.22? 20:47? (GMT+01:00) An: r-package-devel at r-project.org Betreff: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds Is anybody else looking into trying to come to terms with MXE forcross-compiling for UCRT for R 4.2.0 and its updated Windows toolchain?? Ihave been bugging Tomas in private email for a bit and figured it might beuseful to spread the load a little.Is anybody else looking into this?? Any interest in pooling resources aroundsome virtual meeting place? New mailing list? Or an ad-hoc slack (or channelon existing one)?DirkPS My current status:- MXE installed on Ubuntu as cross-compilation. Pretty straightforward.- One initial test build (using cmake) failed:???? fatal error: Windows.h: No such file or directory- Another of a known cmake-using library (nlopt) succeeded. Good. -- dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org______________________________________________R-package-devel@r-project.org mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel> 	[[alternative HTML version deleted]]>> ______________________________________________> R-package-devel at r-project.org mailing list> https://stat.ethz.ch/mailman/listinfo/r-package-devel
	[[alternative HTML version deleted]]


From m@tth|@@-gond@n @end|ng |rom gmx@de  Fri Apr  8 12:51:38 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Fri, 8 Apr 2022 12:51:38 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <1MY68T-1nTFXB3kzN-00YV30@mail.gmx.net>
References: <e3b3316d-3778-0800-eaa5-39efcf9b1d8e@gmail.com>
 <1MY68T-1nTFXB3kzN-00YV30@mail.gmx.net>
Message-ID: <1MqJqD-1oHLkP1W55-00nNAe@mail.gmx.net>

Sorry for the terrible formatting?



Von: matthias-gondan
Gesendet: Freitag, 8. April 2022 12:49
An: Tomas Kalibera; Dirk Eddelbuettel; r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds

Dear Thomas,This is great news, thank you. I understand that I use the /usr/bin/cmake from Rtools42, not /ucrt64/bin/cmake, correct? Which generator should I select, "Unix Makefiles"? I ask because this requires a few more #defines for Swi-Prolog, but that should be feasible.Best wishes,?Matthias?
-------- Urspr?ngliche Nachricht --------Von: Tomas Kalibera <tomas.kalibera at gmail.com> Datum: 05.04.22  09:08  (GMT+01:00) An: matthias-gondan <matthias-gondan at gmx.de>, Dirk Eddelbuettel <edd at debian.org>, r-package-devel at r-project.org Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds On 4/4/22 21:05, matthias-gondan wrote:> Still compiling... but when it is done, I might also need some advice. I don't mind if mxe help is given on this mailing list.Best wishesMatthiasI am happy to help if you run into specific issues. If you decided to build SWI Prolog in the end from source, please note I've recently added a host build of cmake to Rtools42. The Berkeley db is part of MXE and can trivially be added to Rtools42 if you need it (simply would be listed in settings.mk, running "make db" succeeds on my system, producing libdb.a). Libuuid is already part of Rtools42.BestTomas> -------- Urspr?ngliche Nachricht --------Von: Dirk Eddelbuettel <edd at debian.org> Datum: 04.04.22? 20:47? (GMT+01:00) An: r-package-devel at r-project.org Betreff: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds Is anybody else looking into trying to come to terms with MXE forcross-compiling for UCRT for R 4.2.0 and its updated Windows toolchain?? Ihave been bugging Tomas in private email for a bit and figured it might beuseful to spread the load a little.Is anybody else looking into this?? Any interest in pooling resources aroundsome virtual meeting place? New mailing list? Or an ad-hoc slack (or channelon existing one)?DirkPS My current status:- MXE installed on Ubuntu as cross-compilation. Pretty straightforward.- One initial test build (using cmake) failed:???? fatal error: Windows.h: No such file or directory- Another of a known cmake-using library (nlopt) succeeded. Good. -- dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org______________________________________________R-package-devel@r-project.org mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel> 	[[alternative HTML version deleted]]>> ______________________________________________> R-package-devel at r-project.org mailing list> https://stat.ethz.ch/mailman/listinfo/r-package-devel
	[[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel


	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Fri Apr  8 13:01:45 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Fri, 8 Apr 2022 13:01:45 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <1MY68T-1nTFXB3kzN-00YV30@mail.gmx.net>
References: <1MY68T-1nTFXB3kzN-00YV30@mail.gmx.net>
Message-ID: <0ba70122-e4b4-1019-477f-fb0cd319c212@gmail.com>


On 4/8/22 12:49, matthias-gondan wrote:
> Dear Thomas,
>
> This is great news, thank you. I understand that I use the 
> /usr/bin/cmake from Rtools42, not /ucrt64/bin/cmake, correct? Which 
> generator should I select, "Unix Makefiles"? I ask because this 
> requires a few more #defines for Swi-Prolog, but that should be feasible.

Hi Matthias,

please see https://cran.r-project.org/bin/windows/base/howto-R-4.2.html 
and look for cmake, there is now a simple example for native (and 
cross-) compilation. Though your case might be harder and if you run 
into problems, please let me know.

Please use "cmake" that is on PATH with Rtools42 (currently it is under 
x86_64-w64-mingw32.static.posix). It will use "Unix Makefiles" by 
default and you can assume it is available. It will find headers and 
libraries from Rtools42 as needed.

If your installation of Rtools42 doesn't have cmake, please upgrade it.

Best
Tomas

>
> Best wishes,
>
> Matthias
>
> -------- Urspr?ngliche Nachricht --------
> Von: Tomas Kalibera <tomas.kalibera at gmail.com>
> Datum: 05.04.22 09:08 (GMT+01:00)
> An: matthias-gondan <matthias-gondan at gmx.de>, Dirk Eddelbuettel 
> <edd at debian.org>, r-package-devel at r-project.org
> Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
>
> On 4/4/22 21:05, matthias-gondan wrote:
> > Still compiling... but when it is done, I might also need some 
> advice. I don't mind if mxe help is given on this mailing list.Best 
> wishesMatthias
>
> I am happy to help if you run into specific issues. If you decided to
> build SWI Prolog in the end from source, please note I've recently added
> a host build of cmake to Rtools42. The Berkeley db is part of MXE and
> can trivially be added to Rtools42 if you need it (simply would be
> listed in settings.mk, running "make db" succeeds on my system,
> producing libdb.a). Libuuid is already part of Rtools42.
>
> Best
> Tomas
>
> > -------- Urspr?ngliche Nachricht --------Von: Dirk Eddelbuettel 
> <edd at debian.org> Datum: 04.04.22? 20:47 (GMT+01:00) An: 
> r-package-devel at r-project.org Betreff: [R-pkg-devel] Preparing for R 
> 4.2.0 and UCRT via MXE builds Is anybody else looking into trying to 
> come to terms with MXE forcross-compiling for UCRT for R 4.2.0 and its 
> updated Windows toolchain?? Ihave been bugging Tomas in private email 
> for a bit and figured it might beuseful to spread the load a little.Is 
> anybody else looking into this?? Any interest in pooling resources 
> aroundsome virtual meeting place? New mailing list? Or an ad-hoc slack 
> (or channelon existing one)?DirkPS My current status:- MXE installed 
> on Ubuntu as cross-compilation. Pretty straightforward.- One initial 
> test build (using cmake) failed:???? fatal error: Windows.h: No such 
> file or directory- Another of a known cmake-using library (nlopt) 
> succeeded. Good. -- dirk.eddelbuettel.com | @eddelbuettel | 
> edd at debian.org______________________________________________R-package-devel@r-project.org 
> mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
> > [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
	[[alternative HTML version deleted]]


From dr@go@p|ecko @end|ng |rom @t@t@m@th@ethz@ch  Fri Apr  8 15:48:39 2022
From: dr@go@p|ecko @end|ng |rom @t@t@m@th@ethz@ch (Drago Plecko)
Date: Fri, 8 Apr 2022 15:48:39 +0200
Subject: [R-pkg-devel] Possible Tinytex issue on CRAN Windows machines
Message-ID: <CAKmJU=7t01m3xoaVwuvaMuY=L-01Rvhse6mW3Q_RAXLK7LG9bg@mail.gmail.com>

Dear all,

I attempted to submit an update for a CRAN package fairadapt
<https://cran.rstudio.com/web/packages/fairadapt/index.html> (version
0.2.2). When running checks locally (OS X, R 4.1.0) and/or on Github CI
workflows, there are no errors or warnings appearing. Furthermore, when
running checks on win-builder provided by R-project, all the checks are
successful, both for R-devel (see log
<https://win-builder.r-project.org/0Y3mj5lAiSA9/00check.log>) and R-release
(see log <https://win-builder.r-project.org/9BmncrRlr17N/00check.log>).

However, when submitting to CRAN, an error in rebuilding the vignette pops
up on Windows (the log
<https://win-builder.r-project.org/incoming_pretest/fairadapt_0.2.2_20220408_111131/Windows/00check.log>
is
here). The source code in the vignette that causes the issue is here
<https://github.com/dplecko/fairadapt/blob/26a1ae735abfb018a696cb32430fc6ff85b7fca4/vignettes/jss.Rmd#L307-L354>.
On linux there are no issues (log
<https://win-builder.r-project.org/incoming_pretest/fairadapt_0.2.2_20220408_111131/Debian/00check.log>).
Also, in the previous CRAN release of the package, the same code did not
cause any issues on Windows.

The problem could be due to an outdated installation of Tinytex on the CRAN
machines (the issue <https://github.com/yihui/tinytex/issues/293> appeared
last year around 1st of April). However, without being able to reproduce
the problem, it is very difficult to solve it.

Would anyone have a suggestion on whether this is a "false positive" check?
Otherwise, any pointers on how to troubleshoot such a problem in general
would be really welcome.

Thank you in advance,
Drago

	[[alternative HTML version deleted]]


From jeroen @end|ng |rom berke|ey@edu  Sat Apr  9 17:04:58 2022
From: jeroen @end|ng |rom berke|ey@edu (Jeroen Ooms)
Date: Sat, 9 Apr 2022 17:04:58 +0200
Subject: [R-pkg-devel] Single page reference manual in html format
Message-ID: <CABFfbXtcZF8WfDu+qK30pUof01b9SFkEdTd5exw5=DjpiC49nQ@mail.gmail.com>

Is there a way to generate the package reference manual in a (one
page) html format? It would be nice to access reference manuals from
devices without a pdf reader.

We can use `R CMD Rd2pdf {pkgdir}` to generate the reference manual in
pdf format, but afaict `R CMD Rd2text` and `R CMD rdconv` only convert
single Rd files, and do not support generating a full package
reference manual.


From ge|bjeremy22 @end|ng |rom gm@||@com  Sun Apr 10 20:32:23 2022
From: ge|bjeremy22 @end|ng |rom gm@||@com (=?UTF-8?B?asOpcsOpbXkgR2VsYg==?=)
Date: Sun, 10 Apr 2022 14:32:23 -0400
Subject: [R-pkg-devel] CRAN check linux gcc12 Boost error
Message-ID: <CACSk529OUxo0ftfvhDaP6wyX==dVphWYBOovXCmSLW5q_ht7zA@mail.gmail.com>

Dear all,

A package I am developing is encountering an error on the platform
(r-devel-linux-x86_64-debian-gcc) since CRAN decided to force the use of
gcc12.

The error is caused by the use of the bh package and the c++ Boost geometry
library. Boost is not supposed to be compiled with gcc12 (
https://www.boost.org/users/history/version_1_78_0.html), but I really
would like to continue to use it in my package.

Is there a way to ensure that an "older" version (11 should be fine) is
available and used when the package is installed and display an error
message otherwise?

Thank you !
-- 

*J?r?my GELB*
Assistant de recherche ? l'*INRS*
Docteur en ?tudes Urbaines

514 658 6054
gelbjeremy22 at gmail.com
F-4221 Avenue Coloniale H2W2C3 Montr?al Quebec

	[[alternative HTML version deleted]]


From |uc@r @end|ng |rom |edor@project@org  Sun Apr 10 21:23:56 2022
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Sun, 10 Apr 2022 21:23:56 +0200
Subject: [R-pkg-devel] CRAN check linux gcc12 Boost error
In-Reply-To: <CACSk529OUxo0ftfvhDaP6wyX==dVphWYBOovXCmSLW5q_ht7zA@mail.gmail.com>
References: <CACSk529OUxo0ftfvhDaP6wyX==dVphWYBOovXCmSLW5q_ht7zA@mail.gmail.com>
Message-ID: <CALEXWq1+OMUNoc5haxrm_mnvNfY2Y2PF54-vdProkFqH5qSvyw@mail.gmail.com>

El dom., 10 abr. 2022 20:33, j?r?my Gelb <gelbjeremy22 at gmail.com> escribi?:

> Dear all,
>
> A package I am developing is encountering an error on the platform
> (r-devel-linux-x86_64-debian-gcc) since CRAN decided to force the use of
> gcc12.
>

What's the package and what's the error? A link to the report would be
useful.

The error is caused by the use of the bh package and the c++ Boost geometry
> library. Boost is not supposed to be compiled with gcc12 (
> https://www.boost.org/users/history/version_1_78_0.html), but I really
> would like to continue to use it in my package.
>

What does this mean? Is there any known issue? Fedora 36+ ships gcc12 and
Boost 1.76 and there's no issue AFAIK.

>
> Is there a way to ensure that an "older" version (11 should be fine) is
> available and used when the package is installed and display an error
> message otherwise?
>

I don't think so. But anyway that's rarely a good strategy. It could be a
regression, of course, but I tend to think that the problem is in my code,
rather than in gcc.

I?aki


> Thank you !
> --
>
> *J?r?my GELB*
> Assistant de recherche ? l'*INRS*
> Docteur en ?tudes Urbaines
>
> 514 658 6054
> gelbjeremy22 at gmail.com
> F-4221 Avenue Coloniale H2W2C3 Montr?al Quebec
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From m@tth|@@-gond@n @end|ng |rom gmx@de  Sun Apr 10 22:08:20 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (matthias-gondan)
Date: Sun, 10 Apr 2022 22:08:20 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <0ba70122-e4b4-1019-477f-fb0cd319c212@gmail.com>
Message-ID: <1MrQEn-1oHbd31Xc7-00oVsO@mail.gmx.net>

Hi Tomas,Using your description below, and thanks to the availability of cmake under a recent Rtools, I got quite far: rolog now passes for R-devel on rhub, and so does it on winbuilder, thank you! The only thing is that I need to "depend" on R 4.2 in the package description, but I guess this will be R-release in a few weeks.Best regards,Matthias?
-------- Urspr?ngliche Nachricht --------Von: Tomas Kalibera <tomas.kalibera at gmail.com> Datum: 08.04.22  13:01  (GMT+01:00) An: matthias-gondan <matthias-gondan at gmx.de>, Dirk Eddelbuettel <edd at debian.org>, r-package-devel at r-project.org Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds 
    
    
    On 4/8/22 12:49, matthias-gondan wrote:
    
    
      
      Dear Thomas,
      
      
      This is great news, thank you. I understand that I
        use the /usr/bin/cmake from Rtools42, not /ucrt64/bin/cmake,
        correct? Which generator should I select, "Unix Makefiles"? I
        ask because this requires a few more #defines for Swi-Prolog,
        but that should be feasible.
    
    Hi Matthias,
    please see
      https://cran.r-project.org/bin/windows/base/howto-R-4.2.html and
      look for cmake, there is now a simple example for native (and
      cross-) compilation. Though your case might be harder and if you
      run into problems, please let me know.
    
    Please use "cmake" that is on PATH with Rtools42 (currently it is
      under x86_64-w64-mingw32.static.posix). It will use "Unix
      Makefiles" by default and you can assume it is available. It will
      find headers and libraries from Rtools42 as needed.
    If your installation of Rtools42 doesn't have cmake, please
      upgrade it.
    
    Best
      Tomas
    
    
      
      
      Best wishes,?
      
      
      Matthias?
      
      
      
        -------- Urspr?ngliche Nachricht --------
        Von: Tomas Kalibera <tomas.kalibera at gmail.com> 
        Datum: 05.04.22 09:08 (GMT+01:00) 
        An: matthias-gondan <matthias-gondan at gmx.de>, Dirk
          Eddelbuettel <edd at debian.org>,
          r-package-devel at r-project.org 
        Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT
          via MXE builds 
        
        
      
      On 4/4/22 21:05, matthias-gondan wrote:
      > Still compiling... but when it is done, I might also need
      some advice. I don't mind if mxe help is given on this mailing
      list.Best wishesMatthias
      
      I am happy to help if you run into specific issues. If you decided
      to 
      build SWI Prolog in the end from source, please note I've recently
      added 
      a host build of cmake to Rtools42. The Berkeley db is part of MXE
      and 
      can trivially be added to Rtools42 if you need it (simply would be
      
      listed in settings.mk, running "make db" succeeds on my system, 
      producing libdb.a). Libuuid is already part of Rtools42.
      
      Best
      Tomas
      
      > -------- Urspr?ngliche Nachricht --------Von: Dirk
      Eddelbuettel <edd at debian.org> Datum: 04.04.22? 20:47?
      (GMT+01:00) An: r-package-devel at r-project.org Betreff:
      [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds Is
      anybody else looking into trying to come to terms with MXE
      forcross-compiling for UCRT for R 4.2.0 and its updated Windows
      toolchain?? Ihave been bugging Tomas in private email for a bit
      and figured it might beuseful to spread the load a little.Is
      anybody else looking into this?? Any interest in pooling resources
      aroundsome virtual meeting place? New mailing list? Or an ad-hoc
      slack (or channelon existing one)?DirkPS My current status:- MXE
      installed on Ubuntu as cross-compilation. Pretty straightforward.-
      One initial test build (using cmake) failed:???? fatal error:
      Windows.h: No such file or directory- Another of a known
      cmake-using library (nlopt) succeeded. Good. --
      dirk.eddelbuettel.com | @eddelbuettel |
edd at debian.org______________________________________________R-package-devel@r-project.org
      mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
      > [[alternative HTML version deleted]]
      >
      > ______________________________________________
      > R-package-devel at r-project.org mailing list
      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
    
  


	[[alternative HTML version deleted]]


From ||@t@ @end|ng |rom reve||e@net  Sun Apr 10 22:32:38 2022
From: ||@t@ @end|ng |rom reve||e@net (William Revelle)
Date: Sun, 10 Apr 2022 15:32:38 -0500
Subject: [R-pkg-devel] table lacks "summary" attribute
In-Reply-To: <20220307125933.3f989d11@Tarkus>
References: <a391d173-0f40-08ad-3ee6-63aab893d7b8@4dscape.com>
 <20220307125933.3f989d11@Tarkus>
Message-ID: <7C12F8E8-721B-45A1-97EA-679FAE386C3E@revelle.net>

As of R.4.2.0 (beta) 04-08)  R CMD check as-cran is still throwing that warning. 

Bill


> On Mar 7, 2022, at 3:59 AM, Ivan Krylov <krylov.r00t at gmail.com> wrote:
> 
> On Sat, 5 Mar 2022 16:54:08 -0800
> alexios galanos <alexios at 4dscape.com> wrote:
> 
>> * checking HTML version of manual ... NOTE
>> Found the following problems:
>> DCCfilter-class.Rd:7:1: Warning: <table> lacks "summary" attribute
>> 
>> Any pointers/documentation on this?
> 
> This seems to be the new check for HTML documentation validity as part
> of accessibility enhancements in R. As far as I'm aware, HTML5 doesn't
> _require_ tables to have summaries, nor does Rd provide a way to
> specify them. This could be a bug in Tidy-html5, except it's been
> apparently fixed in 2016: https://github.com/htacg/tidy-html5/issues/377
> 
> -- 
> Best regards,
> Ivan
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Mon Apr 11 10:26:41 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Mon, 11 Apr 2022 10:26:41 +0200
Subject: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
In-Reply-To: <1MrQEn-1oHbd31Xc7-00oVsO@mail.gmx.net>
References: <1MrQEn-1oHbd31Xc7-00oVsO@mail.gmx.net>
Message-ID: <d8d5ea22-86a8-f9c5-4b9e-342132de738b@gmail.com>


On 4/10/22 22:08, matthias-gondan wrote:
> Hi Tomas,
>
> Using your description below, and thanks to the availability of cmake 
> under a recent Rtools, I got quite far: rolog now passes for R-devel 
> on rhub, and so does it on winbuilder, thank you! The only thing is 
> that I need to "depend" on R 4.2 in the package description, but I 
> guess this will be R-release in a few weeks.

Hi Matthias,

I am glad it worked.
R 4.2 is to be released on the 22nd of April, see 
https://developer.r-project.org/

Friday 2022-04-15: CODE FREEZE (4.2.0 RC)
Tuesday 2022-04-19: PRERELEASE
Friday 2022-04-22: RELEASE (4.2.0)

Best
Tomas

>
> Best regards,
>
> Matthias
>
>
> -------- Urspr?ngliche Nachricht --------
> Von: Tomas Kalibera <tomas.kalibera at gmail.com>
> Datum: 08.04.22 13:01 (GMT+01:00)
> An: matthias-gondan <matthias-gondan at gmx.de>, Dirk Eddelbuettel 
> <edd at debian.org>, r-package-devel at r-project.org
> Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
>
>
> On 4/8/22 12:49, matthias-gondan wrote:
>> Dear Thomas,
>>
>> This is great news, thank you. I understand that I use the 
>> /usr/bin/cmake from Rtools42, not /ucrt64/bin/cmake, correct? Which 
>> generator should I select, "Unix Makefiles"? I ask because this 
>> requires a few more #defines for Swi-Prolog, but that should be feasible.
>
> Hi Matthias,
>
> please see 
> https://cran.r-project.org/bin/windows/base/howto-R-4.2.html and look 
> for cmake, there is now a simple example for native (and cross-) 
> compilation. Though your case might be harder and if you run into 
> problems, please let me know.
>
> Please use "cmake" that is on PATH with Rtools42 (currently it is 
> under x86_64-w64-mingw32.static.posix). It will use "Unix Makefiles" 
> by default and you can assume it is available. It will find headers 
> and libraries from Rtools42 as needed.
>
> If your installation of Rtools42 doesn't have cmake, please upgrade it.
>
> Best
> Tomas
>
>>
>> Best wishes,
>>
>> Matthias
>>
>> -------- Urspr?ngliche Nachricht --------
>> Von: Tomas Kalibera <tomas.kalibera at gmail.com>
>> Datum: 05.04.22 09:08 (GMT+01:00)
>> An: matthias-gondan <matthias-gondan at gmx.de>, Dirk Eddelbuettel 
>> <edd at debian.org>, r-package-devel at r-project.org
>> Betreff: Re: [R-pkg-devel] Preparing for R 4.2.0 and UCRT via MXE builds
>>
>> On 4/4/22 21:05, matthias-gondan wrote:
>> > Still compiling... but when it is done, I might also need some 
>> advice. I don't mind if mxe help is given on this mailing list.Best 
>> wishesMatthias
>>
>> I am happy to help if you run into specific issues. If you decided to
>> build SWI Prolog in the end from source, please note I've recently added
>> a host build of cmake to Rtools42. The Berkeley db is part of MXE and
>> can trivially be added to Rtools42 if you need it (simply would be
>> listed in settings.mk, running "make db" succeeds on my system,
>> producing libdb.a). Libuuid is already part of Rtools42.
>>
>> Best
>> Tomas
>>
>> > -------- Urspr?ngliche Nachricht --------Von: Dirk Eddelbuettel 
>> <edd at debian.org> Datum: 04.04.22? 20:47? (GMT+01:00) An: 
>> r-package-devel at r-project.org Betreff: [R-pkg-devel] Preparing for R 
>> 4.2.0 and UCRT via MXE builds Is anybody else looking into trying to 
>> come to terms with MXE forcross-compiling for UCRT for R 4.2.0 and 
>> its updated Windows toolchain?? Ihave been bugging Tomas in private 
>> email for a bit and figured it might beuseful to spread the load a 
>> little.Is anybody else looking into this?? Any interest in pooling 
>> resources aroundsome virtual meeting place? New mailing list? Or an 
>> ad-hoc slack (or channelon existing one)?DirkPS My current status:- 
>> MXE installed on Ubuntu as cross-compilation. Pretty 
>> straightforward.- One initial test build (using cmake) failed:???? 
>> fatal error: Windows.h: No such file or directory- Another of a known 
>> cmake-using library (nlopt) succeeded. Good. -- dirk.eddelbuettel.com 
>> | @eddelbuettel | 
>> edd at debian.org______________________________________________R-package-devel@r-project.org 
>> mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
>> > [[alternative HTML version deleted]]
>> >
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
	[[alternative HTML version deleted]]


From ru@@e||@g@@|mond @end|ng |rom gm@||@com  Tue Apr 12 01:30:53 2022
From: ru@@e||@g@@|mond @end|ng |rom gm@||@com (Russell Almond)
Date: Mon, 11 Apr 2022 19:30:53 -0400
Subject: [R-pkg-devel] Build Environment for Mac OS Catalina
Message-ID: <9f465b29-0d9d-a692-b356-95fc22fed9d6@gmail.com>

I'm doing my development on an older version of Mac OS, running 
Catalina.  I'm a bit confused as to what the proper development 
environment is because the stuff on https://mac.r-project.org/tools 
seems to be for either more recent or older versions of MacOS.  I also 
seem to have screwed up something in my toolchain (the curious can see 
my question at 
https://stackoverflow.com/questions/71790401/otool-is-referencing-an-old-version-of-libffi 
).

I have a couple of related questions:

1) What is the right set of instructions for setting up the tool chain 
for Mac OS Catalina?

2) I'm currently using the R install from homebrew, but I thought I saw 
something about a different version of R that I should be using.  Is 
that still current advise?

Thanks, Googling the answers to these questions points me at some pages 
that are clearly out of date.


From @|mon@urb@nek @end|ng |rom R-project@org  Tue Apr 12 01:57:20 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Tue, 12 Apr 2022 11:57:20 +1200
Subject: [R-pkg-devel] Build Environment for Mac OS Catalina
In-Reply-To: <9f465b29-0d9d-a692-b356-95fc22fed9d6@gmail.com>
References: <9f465b29-0d9d-a692-b356-95fc22fed9d6@gmail.com>
Message-ID: <0ABF6EE1-858D-47F5-A00E-15316C608100@R-project.org>

Russel,

this is Mac-specific hence more appropriate for R-SIG-Mac, so moving there.

If you are running Catalina then you have Intel Mac so for CRAN R you simply need XCode and that's it (on a clean Mac you can simply run sudo xcode-select --install). There is nothing special - the only exception is if your package contains Fortran code in which case you just install a Fortran compilers from https://mac.r-project.org/tools/gfortran-8.2-Mojave.dmg

However, since you are using Homebrew then things are a lot more complicated. Homebrew toolchains are not compatible with native Mac binaries and they create its own ecosystem which seems to be broken according to your post.

I would recommend deleting /opt/local then check if you have other incompatible libraries in /usr/local. For severe case of misconfiguration best way to remove (or move aside) everything from /usr/local and start from scratch.

Typically the easiest is to install CRAN R as that does not conflict with anything native and it does not require special tools. You can still use Homebrew to install 3rd party libraries that you may need, but make sure you do NOT install any compilers as they tend to wreak havoc on the system with the conflicting libraries. If your dependencies are supported by CRAN then you can fetch them from https://mac.r-project.org/bin/ or you can re-build them yourself using https://github.com/R-macos/recipes

Cheers,
Simon


> On 12/04/2022, at 11:30 AM, Russell Almond <russell.g.almond at gmail.com> wrote:
> 
> I'm doing my development on an older version of Mac OS, running Catalina.  I'm a bit confused as to what the proper development environment is because the stuff on https://mac.r-project.org/tools seems to be for either more recent or older versions of MacOS.  I also seem to have screwed up something in my toolchain (the curious can see my question at https://stackoverflow.com/questions/71790401/otool-is-referencing-an-old-version-of-libffi ).
> 
> I have a couple of related questions:
> 
> 1) What is the right set of instructions for setting up the tool chain for Mac OS Catalina?
> 
> 2) I'm currently using the R install from homebrew, but I thought I saw something about a different version of R that I should be using.  Is that still current advise?
> 
> Thanks, Googling the answers to these questions points me at some pages that are clearly out of date.
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From bbo|ker @end|ng |rom gm@||@com  Tue Apr 12 02:33:22 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 11 Apr 2022 20:33:22 -0400
Subject: [R-pkg-devel] help with BLAS/LAPACK version debugging
Message-ID: <5b19da9f-b413-e5ad-91dd-51a5eb88e27a@mcmaster.ca>

   Hi folks,

   Apologies for long post. (Part 1, overview; part 2, list of attempts 
so far; part 3, test code.)

OVERVIEW

   CRAN is reporting check errors with the latest release of lme4 
<https://cran.r-project.org/web/checks/check_results_lme4.html> that 
*may* (best guess) be caused by some linear algebra returning NA values 
rather than throwing an error as expected.

   Kurt Hornik says:

   > The failing check runs are using an external LAPACK 3.10.0. To be 
even more precise, Brian does not get this on Fedora with a system 
reference (netlib) 3.10 LAPACK, whereas I do on Debian with OpenBLAS.  Hth.

   The relevant test code is below.

   Further notes: 
https://github.com/lme4/lme4/blob/master/misc/R_lapackstuff.md ; 
https://github.com/lme4/lme4/issues/677

   I think I probably know how to fix/work around the problem, but I 
would dearly love to have a test system where I could (a) confirm that 
things are failing in the way/for the reason I expect; and (b) test that 
my proposed fix actually works.

   Any ideas (or reports that the test code fails on your system) would 
be greatly appreciated ...

   cheers
     Ben Bolker
=====

ATTEMPTS SO FAR (none reproduce the error)

* running on r-hub debian-gcc-devel, both remotely and in a local Docker 
container. AFAICT it is running

BLAS:   /opt/R-devel/lib/R/lib/libRblas.so
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

   I was unsuccessful in using Debian's update-defaults command to mess 
around with the LAPACK version.

  * running on the `rocker/verse` image from the Rocker project.

The default is openblas-pthread/liblapack.so.3; I don't get any errors 
with this. I can use update-defaults to switch to liblapack.so.3.9.0 
(not 3.10.0, this is using Debian stable I think), also no errors that way.

* running on my own machine (PopOS!, r-devel)

This is using openblas-pthread/libopenblasp-r0.3.13.so, and I can't for 
the life of me figure out how to switch BLAS/LAPACK versions (have tried 
reinstalling both with (--with-lapack --with-blas) and without, using 
update-alternatives doesn't seem to make any difference?  Have read 
various online docs about how this is supposed to work ...


=======

TEST CODE

## 1. this succeeds for me, fails for CRAN

set.seed(101)
d <- data.frame(z=rnorm(200),
                 f=factor(sample(1:10,200, replace=TRUE)))
library(lme4)
library(testthat)
fm1 <- lmer(z~ as.numeric(f) + 1|f, d)
fm1 at optinfo$derivs$Hessian[2,2] <- NA
expect_warning(lme4:::checkConv(fm1 at optinfo\$derivs,
                                 coefs=c(1,1),
                                 ctrl=lmerControl()$checkConv,lbound=0),
                "Problem with Hessian check")

## 2. this throws 'system is computationally singular' for me, returns a 
vector containing NAs for CRAN (I think)

dd <- list(gradient = c(0.00132136676711525, 0.00898197413334856, 0
), Hessian = structure(c(195.253128051758, 962.483270645142,
0, 962.483270645142, NA, 0, 0, 0, 6542.44775390625), dim = c(3L,
3L)))
with(dd, solve(chol(Hessian),gradient))

## 3. report BLAS/LAPACK info

s <- sessionInfo()
cat(s$BLAS, s$LAPACK, sep = "\n")


From edd @end|ng |rom deb|@n@org  Tue Apr 12 03:18:29 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 11 Apr 2022 20:18:29 -0500
Subject: [R-pkg-devel] help with BLAS/LAPACK version debugging
In-Reply-To: <5b19da9f-b413-e5ad-91dd-51a5eb88e27a@mcmaster.ca>
References: <5b19da9f-b413-e5ad-91dd-51a5eb88e27a@mcmaster.ca>
Message-ID: <25172.54117.83291.878439@rob.eddelbuettel.com>


Ben,

I fear your post is too short on specifics on versions tested, and results
seen. We need more drill-down on what-version-where and the results it got.

So to bootstrap, "here" on my personal dev box I where I tend to keep an
installation of R-devel (using its embedded LAPACK/BLAS sources) as well as
the standard R package I stand behind for Debian/Ubuntu (which tends to use
external libraries for BLAS/LAPACK).


Now, here I seem to get a different error between reference BLAS/LAPACK and
external BLAS/LAPACK:


1) R-devel (as SVN r82134) 
   using libRblas.so + libRlapack.so (i.e. "reference BLAS") gets me
   
   Error in chol.default(Hessian) : 
     the leading minor of order 2 is not positive definite


2) R-devel as I upload to Debian, same SVN r82134
   using external blas: openblas-pthread/{libblas.so.3 + libopenblasp-r0.3.20.so}

   package version libopenblas0 0.3.20, liblapack 3.10.0
  
   Error in solve.default(chol(Hessian), gradient) : 
     system is computationally singular: reciprocal condition number = 0


3) For what it is worth every release R version I put into Debian and which
   is still available (easily, I find) via rocker/r-base or r-base images

   Using 4.0.4 here (again: openblas-pthread/{libblas.so.3 + libopenblasp-r0.3.13.so}
   (but possibly an older version -- libopenblas 0.3.13, liblapack 3.9.0-3)

   Error in solve.default(chol(Hessian), gradient) : 
     system is computationally singular: reciprocal condition number = 0


I don't claim that the above is complete; I am only pointing out that both
LAPACK 0.3.9 and 0.3.10 _get me the same error_.  Conrad and I recently did
dig up an issue for (Rcpp)Armadillo where 0.3.10 _was_ different from 0.3.9,
but that was for complex-value variables.

The bigger difference seems to be between using R's reference blas, and
external blas.  I have for a decade+ used external BLAS even when the
official word to prefer reference BLAS. Now, and very recently NEWS in R seem
to go the same way prefering 0.3.10 where available.

I hope this helps. I can give you pointers (off-list) if you want to dig some
more via Docker and different combinations.


Cheers, Dirk


-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @vr@h@m@@d|er @end|ng |rom gm@||@com  Tue Apr 12 06:29:56 2022
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Tue, 12 Apr 2022 04:29:56 +0000
Subject: [R-pkg-devel] help with BLAS/LAPACK version debugging
In-Reply-To: <25172.54117.83291.878439@rob.eddelbuettel.com>
References: <5b19da9f-b413-e5ad-91dd-51a5eb88e27a@mcmaster.ca>
 <25172.54117.83291.878439@rob.eddelbuettel.com>
Message-ID: <CAL6gwnJ=QwX-LWDGoQ2KtDtpZ8GzLiJVFQranrFY641zeRg6UQ@mail.gmail.com>

If it helps, this is on Windows 10 64bit, R 4.2.0alpha, OpenBLAS
0.3.17 (single threaded, custom compiled for i7-8700K Skylake which
functions as a Haswell), but default R LAPACK since I still have not
figured out how to link to a precompiled LAPACK when building natively
on Windows.

Thanks,

Avi

# 1
set.seed(101)
d <- data.frame(z=rnorm(200),
                  f=factor(sample(1:10,200, replace=TRUE)))
library(lme4)
library(testthat)
fm1 <- lmer(z~ as.numeric(f) + 1|f, d)

R throws--> "boundary (singular) fit: see help('isSingular')"

> fm1 at optinfo$derivs$Hessian[2,2] <- NA

> expect_warning(lme4:::checkConv(fm1 at optinfo$derivs,
                                  coefs=c(1,1),
                                  ctrl=lmerControl()$checkConv,lbound=0),
                 "Problem with Hessian check")

(No warning thrown)

# 2
dd <- list(gradient = c(0.00132136676711525, 0.00898197413334856, 0),
   Hessian = structure(c(195.253128051758, 962.483270645142,
                         0, 962.483270645142, NA, 0, 0, 0, 6542.44775390625),
                         dim = c(3L, 3L)))
with(dd, solve(chol(Hessian),gradient))

R throws--> Error in h(simpleError(msg, call)) :
  error in evaluating the argument 'a' in selecting a method for
function 'solve': the leading minor of order 2 is not positive
definite

# 3 (Windows returns empty strings for BLAS and LAPACK)

R version 4.2.0 alpha (2022-04-03 r82074 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19043)

Matrix products: default

locale:
[1] LC_COLLATE=English_United States.utf8  LC_CTYPE=English_United
States.utf8    LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                           LC_TIME=English_United
States.utf8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] testthat_3.1.3 lme4_1.1-29    Matrix_1.4-1

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.8.3    lattice_0.20-45 rprojroot_2.0.3 withr_2.5.0
brio_1.1.3      MASS_7.3-56     grid_4.2.0
 [8] R6_2.5.1        nlme_3.1-157    magrittr_2.0.3  rlang_1.0.2
cli_3.2.0       minqa_1.2.4     nloptr_2.0.0
[15] boot_1.3-28     desc_1.4.1      splines_4.2.0   tools_4.2.0
pkgload_1.2.4   compiler_4.2.0

On Tue, Apr 12, 2022 at 1:18 AM Dirk Eddelbuettel <edd at debian.org> wrote:
>
>
> Ben,
>
> I fear your post is too short on specifics on versions tested, and results
> seen. We need more drill-down on what-version-where and the results it got.
>
> So to bootstrap, "here" on my personal dev box I where I tend to keep an
> installation of R-devel (using its embedded LAPACK/BLAS sources) as well as
> the standard R package I stand behind for Debian/Ubuntu (which tends to use
> external libraries for BLAS/LAPACK).
>
>
> Now, here I seem to get a different error between reference BLAS/LAPACK and
> external BLAS/LAPACK:
>
>
> 1) R-devel (as SVN r82134)
>    using libRblas.so + libRlapack.so (i.e. "reference BLAS") gets me
>
>    Error in chol.default(Hessian) :
>      the leading minor of order 2 is not positive definite
>
>
> 2) R-devel as I upload to Debian, same SVN r82134
>    using external blas: openblas-pthread/{libblas.so.3 + libopenblasp-r0.3.20.so}
>
>    package version libopenblas0 0.3.20, liblapack 3.10.0
>
>    Error in solve.default(chol(Hessian), gradient) :
>      system is computationally singular: reciprocal condition number = 0
>
>
> 3) For what it is worth every release R version I put into Debian and which
>    is still available (easily, I find) via rocker/r-base or r-base images
>
>    Using 4.0.4 here (again: openblas-pthread/{libblas.so.3 + libopenblasp-r0.3.13.so}
>    (but possibly an older version -- libopenblas 0.3.13, liblapack 3.9.0-3)
>
>    Error in solve.default(chol(Hessian), gradient) :
>      system is computationally singular: reciprocal condition number = 0
>
>
> I don't claim that the above is complete; I am only pointing out that both
> LAPACK 0.3.9 and 0.3.10 _get me the same error_.  Conrad and I recently did
> dig up an issue for (Rcpp)Armadillo where 0.3.10 _was_ different from 0.3.9,
> but that was for complex-value variables.
>
> The bigger difference seems to be between using R's reference blas, and
> external blas.  I have for a decade+ used external BLAS even when the
> official word to prefer reference BLAS. Now, and very recently NEWS in R seem
> to go the same way prefering 0.3.10 where available.
>
> I hope this helps. I can give you pointers (off-list) if you want to dig some
> more via Docker and different combinations.
>
>
> Cheers, Dirk
>
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From |uc@r @end|ng |rom |edor@project@org  Tue Apr 12 11:32:01 2022
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Tue, 12 Apr 2022 11:32:01 +0200
Subject: [R-pkg-devel] help with BLAS/LAPACK version debugging
In-Reply-To: <5b19da9f-b413-e5ad-91dd-51a5eb88e27a@mcmaster.ca>
References: <5b19da9f-b413-e5ad-91dd-51a5eb88e27a@mcmaster.ca>
Message-ID: <CALEXWq2yEx5K1WvS1dWoF+RBBu1tNEQXV-TBYH2tS1-T=bzSBw@mail.gmail.com>

Hi Ben,

I see:

$ FLEXIBLAS=openblas-serial Rscript test.R
Loading required package: Matrix
boundary (singular) fit: see help('isSingular')
Error in solve.default(chol(Hessian), gradient) :
 system is computationally singular: reciprocal condition number = 0
Calls: with ... with.default -> eval -> eval -> solve -> solve -> solve.default

$ FLEXIBLAS=netlib Rscript test.R
Loading required package: Matrix
boundary (singular) fit: see help('isSingular')
Error in h(simpleError(msg, call)) :
 error in evaluating the argument 'a' in selecting a method for
function 'solve': the leading minor of order 2 is not positive
definite
Calls: with ... chol -> chol -> chol.default -> .handleSimpleError -> h

This is for Fedora 35 with R 4.1.3 and FlexiBLAS 3.1.3, which allows
you to easily switch (as shown above) between several implementations
available, including NETLIB 3.10.0, OpenBLAS 0.3.19 (serial, openmp,
threads), BLIS 0.7.0 (serial, openmp, threads) and ATLAS 3.10.3, but
also other libraries you already have if you tell FlexiBLAS where they
are. If you want to play with those, more info at [1], [2], and of
course [3].

I?aki

[1] https://cran.r-project.org/bin/linux/fedora/#blaslapack-switching
[2] https://docs.fedoraproject.org/en-US/packaging-guidelines/BLAS_LAPACK/#_backend_selection
[3] https://github.com/mpimd-csc/flexiblas/#documentation

On Tue, 12 Apr 2022 at 02:34, Ben Bolker <bbolker at gmail.com> wrote:
>
>    Hi folks,
>
>    Apologies for long post. (Part 1, overview; part 2, list of attempts
> so far; part 3, test code.)
>
> OVERVIEW
>
>    CRAN is reporting check errors with the latest release of lme4
> <https://cran.r-project.org/web/checks/check_results_lme4.html> that
> *may* (best guess) be caused by some linear algebra returning NA values
> rather than throwing an error as expected.
>
>    Kurt Hornik says:
>
>    > The failing check runs are using an external LAPACK 3.10.0. To be
> even more precise, Brian does not get this on Fedora with a system
> reference (netlib) 3.10 LAPACK, whereas I do on Debian with OpenBLAS.  Hth.
>
>    The relevant test code is below.
>
>    Further notes:
> https://github.com/lme4/lme4/blob/master/misc/R_lapackstuff.md ;
> https://github.com/lme4/lme4/issues/677
>
>    I think I probably know how to fix/work around the problem, but I
> would dearly love to have a test system where I could (a) confirm that
> things are failing in the way/for the reason I expect; and (b) test that
> my proposed fix actually works.
>
>    Any ideas (or reports that the test code fails on your system) would
> be greatly appreciated ...
>
>    cheers
>      Ben Bolker
> =====
>
> ATTEMPTS SO FAR (none reproduce the error)
>
> * running on r-hub debian-gcc-devel, both remotely and in a local Docker
> container. AFAICT it is running
>
> BLAS:   /opt/R-devel/lib/R/lib/libRblas.so
> LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0
>
>    I was unsuccessful in using Debian's update-defaults command to mess
> around with the LAPACK version.
>
>   * running on the `rocker/verse` image from the Rocker project.
>
> The default is openblas-pthread/liblapack.so.3; I don't get any errors
> with this. I can use update-defaults to switch to liblapack.so.3.9.0
> (not 3.10.0, this is using Debian stable I think), also no errors that way.
>
> * running on my own machine (PopOS!, r-devel)
>
> This is using openblas-pthread/libopenblasp-r0.3.13.so, and I can't for
> the life of me figure out how to switch BLAS/LAPACK versions (have tried
> reinstalling both with (--with-lapack --with-blas) and without, using
> update-alternatives doesn't seem to make any difference?  Have read
> various online docs about how this is supposed to work ...
>
>
> =======
>
> TEST CODE
>
> ## 1. this succeeds for me, fails for CRAN
>
> set.seed(101)
> d <- data.frame(z=rnorm(200),
>                  f=factor(sample(1:10,200, replace=TRUE)))
> library(lme4)
> library(testthat)
> fm1 <- lmer(z~ as.numeric(f) + 1|f, d)
> fm1 at optinfo$derivs$Hessian[2,2] <- NA
> expect_warning(lme4:::checkConv(fm1 at optinfo\$derivs,
>                                  coefs=c(1,1),
>                                  ctrl=lmerControl()$checkConv,lbound=0),
>                 "Problem with Hessian check")
>
> ## 2. this throws 'system is computationally singular' for me, returns a
> vector containing NAs for CRAN (I think)
>
> dd <- list(gradient = c(0.00132136676711525, 0.00898197413334856, 0
> ), Hessian = structure(c(195.253128051758, 962.483270645142,
> 0, 962.483270645142, NA, 0, 0, 0, 6542.44775390625), dim = c(3L,
> 3L)))
> with(dd, solve(chol(Hessian),gradient))
>
> ## 3. report BLAS/LAPACK info
>
> s <- sessionInfo()
> cat(s$BLAS, s$LAPACK, sep = "\n")
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
I?aki ?car


From ru@@e||@g@@|mond @end|ng |rom gm@||@com  Tue Apr 12 16:19:34 2022
From: ru@@e||@g@@|mond @end|ng |rom gm@||@com (Russell Almond)
Date: Tue, 12 Apr 2022 10:19:34 -0400
Subject: [R-pkg-devel] Build Environment for Mac OS Catalina
In-Reply-To: <0ABF6EE1-858D-47F5-A00E-15316C608100@R-project.org>
References: <9f465b29-0d9d-a692-b356-95fc22fed9d6@gmail.com>
 <0ABF6EE1-858D-47F5-A00E-15316C608100@R-project.org>
Message-ID: <EBB0FBAE-32ED-4BFC-B414-1A372A73822C@gmail.com>

Thanks for your help.  An older version of homebrew had installed a conflicting older version of `otool` in /opt/local/bin.  Updating was not cleaning the old version.  Once I cleaned manually cleaned that out, it seemed to work.  

I posted details on stack exchange for the curious.  https://stackoverflow.com/questions/71790401/otool-is-referencing-an-old-version-of-libffi/71844231#71844231 <https://stackoverflow.com/questions/71790401/otool-is-referencing-an-old-version-of-libffi/71844231#71844231>

So my R package is now compiling!

	?Russell
(I?m not subscribed to R-SIG-Mac, so if somebody who is could forward this answer, that would be good.)
 

> On Apr 11, 2022, at 19:57, Simon Urbanek <simon.urbanek at R-project.org> wrote:
> 
> Russel,
> 
> this is Mac-specific hence more appropriate for R-SIG-Mac, so moving there.
> 
> If you are running Catalina then you have Intel Mac so for CRAN R you simply need XCode and that's it (on a clean Mac you can simply run sudo xcode-select --install). There is nothing special - the only exception is if your package contains Fortran code in which case you just install a Fortran compilers from https://mac.r-project.org/tools/gfortran-8.2-Mojave.dmg
> 
> However, since you are using Homebrew then things are a lot more complicated. Homebrew toolchains are not compatible with native Mac binaries and they create its own ecosystem which seems to be broken according to your post.
> 
> I would recommend deleting /opt/local then check if you have other incompatible libraries in /usr/local. For severe case of misconfiguration best way to remove (or move aside) everything from /usr/local and start from scratch.
> 
> Typically the easiest is to install CRAN R as that does not conflict with anything native and it does not require special tools. You can still use Homebrew to install 3rd party libraries that you may need, but make sure you do NOT install any compilers as they tend to wreak havoc on the system with the conflicting libraries. If your dependencies are supported by CRAN then you can fetch them from https://mac.r-project.org/bin/ or you can re-build them yourself using https://github.com/R-macos/recipes
> 
> Cheers,
> Simon
> 
> 
>> On 12/04/2022, at 11:30 AM, Russell Almond <russell.g.almond at gmail.com> wrote:
>> 
>> I'm doing my development on an older version of Mac OS, running Catalina.  I'm a bit confused as to what the proper development environment is because the stuff on https://mac.r-project.org/tools seems to be for either more recent or older versions of MacOS.  I also seem to have screwed up something in my toolchain (the curious can see my question at https://stackoverflow.com/questions/71790401/otool-is-referencing-an-old-version-of-libffi ).
>> 
>> I have a couple of related questions:
>> 
>> 1) What is the right set of instructions for setting up the tool chain for Mac OS Catalina?
>> 
>> 2) I'm currently using the R install from homebrew, but I thought I saw something about a different version of R that I should be using.  Is that still current advise?
>> 
>> Thanks, Googling the answers to these questions points me at some pages that are clearly out of date.
>> 
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> 
> 


	[[alternative HTML version deleted]]


From kev|n@r@coombe@ @end|ng |rom gm@||@com  Tue Apr 12 19:29:58 2022
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Tue, 12 Apr 2022 13:29:58 -0400
Subject: [R-pkg-devel] function name conflict
Message-ID: <bc6fda62-73d0-4a33-572c-5b310119d2b2@gmail.com>

Hi,

I am writing a package that Imports several other packages. One of my 
imported packages eventually imports (through a chain of dependencies) 
"lifecycle", and another eventually imports "rlang". Both "rlang" and 
"lifecycle" define and export functions called "last_warnings".? As a 
result, when I first execute "library(MYPACKAGE)" in a script, I get a 
warning of the form
 ? " replacing previous import 'lifecycle::last_warnings' by 
'rlang::last_warnings' when loading 'tibble' "

I don't want the users of MYPACKAGE to have to see this warning (since I 
know it will spook novices). Is there anything I can do with Imports, 
Depends, or something else to prevent this warning from occurring? (I 
know that I can suppress warnings in each script, but I also don't want 
to explain to my users that they have to do that.

Note that I have tried reversing the order of the two functions that I 
import in the Imports declaration in the DESCRIPTION file, to no effect. 
I also only use one function from each of the two imported pakages, and 
they are explicitly listed in importFrom directives in the NAMESPACE file.

Thank in advance,
 ? Kevin


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Apr 12 19:50:51 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 12 Apr 2022 20:50:51 +0300
Subject: [R-pkg-devel] function name conflict
In-Reply-To: <bc6fda62-73d0-4a33-572c-5b310119d2b2@gmail.com>
References: <bc6fda62-73d0-4a33-572c-5b310119d2b2@gmail.com>
Message-ID: <20220412205051.5b3cd910@Tarkus>

On Tue, 12 Apr 2022 13:29:58 -0400
"Kevin R. Coombes" <kevin.r.coombes at gmail.com> wrote:

> I also only use one function from each of the two imported pakages,
> and they are explicitly listed in importFrom directives in the
> NAMESPACE file.

This should be the right thing to do: list them in Imports and either
use importFrom() or qualify the names of the functions you use with
their namespaces; but don't list them in Depends.

Are you sure you're not importing some other package (or listing it in
Depends) that, in turn, Depends on rlang and/or lifecycle, bringing
them into your namespace too?

Can you show us the code?

-- 
Best regards,
Ivan


From kev|n@r@coombe@ @end|ng |rom gm@||@com  Tue Apr 12 20:14:33 2022
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Tue, 12 Apr 2022 14:14:33 -0400
Subject: [R-pkg-devel] function name conflict
In-Reply-To: <20220412205051.5b3cd910@Tarkus>
References: <bc6fda62-73d0-4a33-572c-5b310119d2b2@gmail.com>
 <20220412205051.5b3cd910@Tarkus>
Message-ID: <d3f5d55f-b2c8-954b-0a29-91aeac8777b4@gmail.com>

Thanks for the answer. In the process of going back to try making a 
minimal example, I realized that the problem isn't my package; it 
already occurs in one of the packages I import. (I could have sworn I 
checked this previously, but apparently missed the true culprit.) In any 
event, I'll report a bug to them and suggest more careful use of 
importFrom to get around it.

Best,
 ? Kevin

On 4/12/2022 1:50 PM, Ivan Krylov wrote:
> On Tue, 12 Apr 2022 13:29:58 -0400
> "Kevin R. Coombes" <kevin.r.coombes at gmail.com> wrote:
>
>> I also only use one function from each of the two imported pakages,
>> and they are explicitly listed in importFrom directives in the
>> NAMESPACE file.
> This should be the right thing to do: list them in Imports and either
> use importFrom() or qualify the names of the functions you use with
> their namespaces; but don't list them in Depends.
>
> Are you sure you're not importing some other package (or listing it in
> Depends) that, in turn, Depends on rlang and/or lifecycle, bringing
> them into your namespace too?
>
> Can you show us the code?
>


