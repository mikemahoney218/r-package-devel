From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Mon Jan  2 19:20:11 2023
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Mon, 2 Jan 2023 12:20:11 -0600
Subject: [R-pkg-devel] Current recommendations re. GitHub Action?
Message-ID: <869a200d-ed9a-232e-795e-e459849ce164@effectivedefense.org>

Hello, All:


	  What are current recommendations for GitHub Action?


	  My most recent change to "sos" generated "Failed to get R" for 
ubuntu-latest (release, devel, and oldrel-1).


https://github.com/sbgraves237/sos/actions/runs/3820307473/jobs/6498527786


	  I would happily rtfm if I only knew which fmtr.


	  Thanks,
	  Spencer Graves


From zk@mv@r @end|ng |rom gm@||@com  Mon Jan  2 19:34:41 2023
From: zk@mv@r @end|ng |rom gm@||@com (Zhian Kamvar)
Date: Mon, 2 Jan 2023 10:34:41 -0800
Subject: [R-pkg-devel] Current recommendations re. GitHub Action?
In-Reply-To: <869a200d-ed9a-232e-795e-e459849ce164@effectivedefense.org>
References: <869a200d-ed9a-232e-795e-e459849ce164@effectivedefense.org>
Message-ID: <CAPsXksJ=MPS=979NnD4hJGeg5hDk80JF-KPhYoMtDv64ZKxXWw@mail.gmail.com>

This warning says to update to v2 of the action from r-lib:

Warning: r-lib/actions/setup-r at v1 is deprecated. Please update your
> workflow to use the 'v2' version. Also look at the examples at
> https://github.com/r-lib/actions/tree/v2/examples because '@v2' workflows
> are much simpler than 'v1' workflows.


We ran into a similar problem and switching to v2 did the trick.

Best,
Zhian

On Mon, Jan 2, 2023 at 10:20 AM Spencer Graves <
spencer.graves at effectivedefense.org> wrote:

> Hello, All:
>
>
>           What are current recommendations for GitHub Action?
>
>
>           My most recent change to "sos" generated "Failed to get R" for
> ubuntu-latest (release, devel, and oldrel-1).
>
>
> https://github.com/sbgraves237/sos/actions/runs/3820307473/jobs/6498527786
>
>
>           I would happily rtfm if I only knew which fmtr.
>
>
>           Thanks,
>           Spencer Graves
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Mon Jan  2 19:38:16 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 2 Jan 2023 12:38:16 -0600
Subject: [R-pkg-devel] Current recommendations re. GitHub Action?
In-Reply-To: <869a200d-ed9a-232e-795e-e459849ce164@effectivedefense.org>
References: <869a200d-ed9a-232e-795e-e459849ce164@effectivedefense.org>
Message-ID: <25523.9368.854032.549309@rob.eddelbuettel.com>


As the error is common against your _all three_ of your Ubuntu runs, you
could consider the possibility that the events are correlated.  Most often it
simply means a (temporary, usually) network or server outage.  I would wait,
and then relaunch (which these days you can do just for the failed jobs).

It is also worth paying attention to warnings such as

   Warning: r-lib/actions/setup-r at v1 is deprecated. Please update your
   workflow to use the 'v2' version. Also look at the examples at
   https://github.com/r-lib/actions/tree/v2/examples because '@v2' workflows
   are much simpler than 'v1' workflows.

Hth,  Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jan  3 02:18:33 2023
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Mon, 2 Jan 2023 19:18:33 -0600
Subject: [R-pkg-devel] Current recommendations re. GitHub Action?
In-Reply-To: <25523.9368.854032.549309@rob.eddelbuettel.com>
References: <869a200d-ed9a-232e-795e-e459849ce164@effectivedefense.org>
 <25523.9368.854032.549309@rob.eddelbuettel.com>
Message-ID: <b97fe385-c884-1365-3ab2-d86a293d9a27@effectivedefense.org>



On 1/2/23 12:38 PM, Dirk Eddelbuettel wrote:
> 
> As the error is common against your _all three_ of your Ubuntu runs, you
> could consider the possibility that the events are correlated.  Most often it
> simply means a (temporary, usually) network or server outage.  I would wait,
> and then relaunch (which these days you can do just for the failed jobs).
> 
> It is also worth paying attention to warnings such as
> 
>     Warning: r-lib/actions/setup-r at v1 is deprecated. Please update your
>     workflow to use the 'v2' version. Also look at the examples at
>     https://github.com/r-lib/actions/tree/v2/examples because '@v2' workflows
>     are much simpler than 'v1' workflows.


	  Thanks to Zhian Kamvar and Dirk Eddelbuettel for encouraging me to 
look at the warning.


	  I replaced a few lined of my "R-CMD-check.yaml" file with the the 
"v3" and "v2" versions in the example in 
"https://github.com/r-lib/actions/tree/v2/examples" and deleted 
subsequent lines that I didn't understand, and I got an instant failure: 
  It didn't run even one of the 5 tests.  Then I did "git revert" with 
the version number from GitHub and changed several lines to match the 
example with the succeeding yaml code.  GitHub Action ran and failed on 
all 5 platforms.  I did "git revert" with that and changed 
"r-lib/actions/setup-r at v1" to "r-lib/actions/setup-r at v2".  With that, 
R-release ran successfully on Unbuntu as well as Windows and macOS.


	  However, Ubuntu failed with devel and oldrel1, complaining, "there is 
no package called ?rcmdcheck?".


	  See:


https://github.com/sbgraves237/sos


	  Suggestions?
	  Thanks,
	  Spencer Graves

> 
> Hth,  Dirk
>


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Jan  4 10:18:40 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 4 Jan 2023 12:18:40 +0300
Subject: [R-pkg-devel] Current recommendations re. GitHub Action?
In-Reply-To: <b97fe385-c884-1365-3ab2-d86a293d9a27@effectivedefense.org>
References: <869a200d-ed9a-232e-795e-e459849ce164@effectivedefense.org>
 <25523.9368.854032.549309@rob.eddelbuettel.com>
 <b97fe385-c884-1365-3ab2-d86a293d9a27@effectivedefense.org>
Message-ID: <20230104121840.7dc90239@Tarkus>

On Mon, 2 Jan 2023 19:18:33 -0600
Spencer Graves <spencer.graves at effectivedefense.org> wrote:

> 	  However, Ubuntu failed with devel and oldrel1, complaining,
> "there is no package called ?rcmdcheck?".

If we start from the error message and work backwards, it's easy to see
that `rcmdcheck` fails to install because it depends on `curl`, which
also fails to install. `curl` fails to install because the virtual
machine running the GitHub Action doesn't have libcurl headers
installed; there's even an error message about that, but it's not fatal:

------------------------- ANTICONF ERROR ---------------------------
Configuration failed because libcurl was not found. Try installing:
 * deb: libcurl4-openssl-dev (Debian, Ubuntu, etc)
 * rpm: libcurl-devel (Fedora, CentOS, RHEL)
If libcurl is already installed, check that 'pkg-config' is in your
PATH and PKG_CONFIG_PATH contains a libcurl.pc file. If pkg-config
is unavailable you can set INCLUDE_DIR and LIB_DIR manually via:
R CMD INSTALL --configure-vars='INCLUDE_DIR=... LIB_DIR=...'
--------------------------------------------------------------------

I don't have enough experience in the abstraction layers involved, but
if you stuff a `sudo apt install libcurl4-openssl-dev` (which should
run as a system command line, just like the "Install system
dependencies" step) somewhere before the "Install dependencies" step,
it should work.

-- 
Best regards,
Ivan


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Jan  4 11:50:20 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 4 Jan 2023 11:50:20 +0100
Subject: [R-pkg-devel] new toolchain "RTools43" for building devel binaries
 (both R base and packages)
Message-ID: <2d486a48-087d-4bbe-b8cd-021025cfabc8@statistik.tu-dortmund.de>

Dear developers,

for those building from source on Windows:

A new toolchain called "RTools43" has been prepared by Tomas Kalibera.
It is now used to build the Windows binaries (R base and contributed 
packages) for R-devel on Windows. See
<https://cran.r-project.org/bin/windows/Rtools/rtools43/rtools.html>.

Best,
Uwe Ligges


From k|ng@@ @end|ng |rom um|ch@edu  Wed Jan  4 21:54:52 2023
From: k|ng@@ @end|ng |rom um|ch@edu (Aaron A. King)
Date: Wed, 4 Jan 2023 15:54:52 -0500
Subject: [R-pkg-devel] S3 generic/method consistency false positive when
 dplyr imported
Message-ID: <CAGPRvNDXHT-ZB4H6if_RRRwSFahUFDWbuKeppFBihvVQ4DodWA@mail.gmail.com>

Hi all,

I'm modifying a package so as to remove its dependence on the superseded
packages *reshape2* and *plyr*, in favor of dependence on *dplyr*.  In
particular, I'm just importing the one function `dplyr::bind_rows`.

A curious thing happens, however, as soon as I include this among the
imports.  I begin to get R CMD check NOTEs alerting me to the presence of
S3 generic inconsistencies.  These are associated with two functions in the
package: `filter.mean` and `filter.traj`, which the checker mistakes for S3
methods based on the generic `stats::filter` function.  Actually, these are
not S3 methods.  In fact, they are S4 generics and declared as such.

When *dplyr* is not imported, R CMD check is happy with these functions.
When it is imported, R CMD check complains.

Now I understand that it may be preferable to move away from functions with
names containing dots for this reason, and in fact I am already doing so,
but I think the question is a good one:

Why does inclusion of *dplyr* in the import list appear to trigger these
warnings when they were not there before?

Thanks in advance for any insight you can give!

Aaron A. King, Ph.D.
Nelson G. Hairston Professor of Ecology, Evolutionary Biology, and Complex
Systems
University of Michigan
kinglab.eeb.lsa.umich.edu
GPG Public Key: 0x15780975

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Jan  4 22:22:09 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 5 Jan 2023 00:22:09 +0300
Subject: [R-pkg-devel] S3 generic/method consistency false positive when
 dplyr imported
In-Reply-To: <CAGPRvNDXHT-ZB4H6if_RRRwSFahUFDWbuKeppFBihvVQ4DodWA@mail.gmail.com>
References: <CAGPRvNDXHT-ZB4H6if_RRRwSFahUFDWbuKeppFBihvVQ4DodWA@mail.gmail.com>
Message-ID: <20230105002209.6e1fae5d@Tarkus>

On Wed, 4 Jan 2023 15:54:52 -0500
"Aaron A. King" <kingaa at umich.edu> wrote:

> Why does inclusion of *dplyr* in the import list appear to trigger
> these warnings when they were not there before?

I think that's because dplyr itself contains an S3 generic named
"filter", and having a package namespace loaded (not even attached) is
enough to take its registered S3 methods into consideration for method
dispatch. Here we have an opposite situation, though, and your
functions aren't registered as S3 methods. Will your function still be
called if you artificially construct a wrong object and feed it to
dplyr::filter while your package namespace is attached?

library(YOURPACKAGE)
dplyr::filter(structure(list(), class = 'traj'))

Additionally, stats::filter doesn't seem to be an S3 generic, so that's
one thing that the check gets confused about.

-- 
Best regards,
Ivan


From k|ng@@ @end|ng |rom um|ch@edu  Thu Jan  5 23:58:47 2023
From: k|ng@@ @end|ng |rom um|ch@edu (Aaron A. King)
Date: Thu, 5 Jan 2023 17:58:47 -0500
Subject: [R-pkg-devel] S3 generic/method consistency false positive when
 dplyr imported
In-Reply-To: <20230105002209.6e1fae5d@Tarkus>
References: <CAGPRvNDXHT-ZB4H6if_RRRwSFahUFDWbuKeppFBihvVQ4DodWA@mail.gmail.com>
 <20230105002209.6e1fae5d@Tarkus>
Message-ID: <CAGPRvNAsbNQdVYiJbOTaoPow3CK-5q8fiB6tj4cpdLx22xPCfw@mail.gmail.com>

Thanks for the fast reply!

When I follow your suggestion above, I get

library(pomp)
dplyr::filter(structure(list(), class = 'traj'))

Error in UseMethod("filter") :
  no applicable method for 'filter' applied to an object of class "traj"

Which is not what would happen if my filter.traj function were called.  So
the S3 dispatch system is not confused.  Thus this really is a false
positive.

It still leaves open the question, why does this suddenly appear when dplyr
is loaded?  If I understand you correctly, it would be triggered by the
inclusion of the generic 'filter' in dplyr, which was previously not
present. However, since the S3 dispatch system is not itself confused, I
suppose it must be the case that the S3 generic/method consistency checker
itself is confused.  I wonder, how does the checker decide when to throw a
NOTE?  Is it a simple pattern-matching system, something like "If X.Y is
exported, where X is a generic and Y is any string and X.Y is not declared
as an S3 method, then throw NOTE"?

Dr. Aaron A. King
University of Michigan


On Wed, Jan 4, 2023 at 4:22 PM Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Wed, 4 Jan 2023 15:54:52 -0500
> "Aaron A. King" <kingaa at umich.edu> wrote:
>
> > Why does inclusion of *dplyr* in the import list appear to trigger
> > these warnings when they were not there before?
>
> I think that's because dplyr itself contains an S3 generic named
> "filter", and having a package namespace loaded (not even attached) is
> enough to take its registered S3 methods into consideration for method
> dispatch. Here we have an opposite situation, though, and your
> functions aren't registered as S3 methods. Will your function still be
> called if you artificially construct a wrong object and feed it to
> dplyr::filter while your package namespace is attached?
>
> library(YOURPACKAGE)
> dplyr::filter(structure(list(), class = 'traj'))
>
> Additionally, stats::filter doesn't seem to be an S3 generic, so that's
> one thing that the check gets confused about.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Jan  6 09:21:49 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 6 Jan 2023 11:21:49 +0300
Subject: [R-pkg-devel] S3 generic/method consistency false positive when
 dplyr imported
In-Reply-To: <CAGPRvNAsbNQdVYiJbOTaoPow3CK-5q8fiB6tj4cpdLx22xPCfw@mail.gmail.com>
References: <CAGPRvNDXHT-ZB4H6if_RRRwSFahUFDWbuKeppFBihvVQ4DodWA@mail.gmail.com>
 <20230105002209.6e1fae5d@Tarkus>
 <CAGPRvNAsbNQdVYiJbOTaoPow3CK-5q8fiB6tj4cpdLx22xPCfw@mail.gmail.com>
Message-ID: <20230106112149.10207568@Tarkus>

On Thu, 5 Jan 2023 17:58:47 -0500
"Aaron A. King" <kingaa at umich.edu> wrote:

> However, since the S3 dispatch system is not itself confused, I
> suppose it must be the case that the S3 generic/method consistency
> checker itself is confused.  I wonder, how does the checker decide
> when to throw a NOTE?  Is it a simple pattern-matching system,
> something like "If X.Y is exported, where X is a generic and Y is any
> string and X.Y is not declared as an S3 method, then throw NOTE"?

The aim of the check is a bit different: "if an S3 method for generic X
and class Y exists, and the formal arguments of X.Y don't extend the
formal arguments of X in a certain way, then throw a NOTE", but then
something gets wrong about deciding whether X.Y is an S3 method, and
once filter.mean is decided to be an S3 method, of course it doesn't
match the formals of filter.

This function is even a public API of the tools package, see
?tools::checkS3methods:
https://github.com/r-devel/r-svn/blob/b57918fd104962415a752ea7db12dcf4f3f5219f/src/library/tools/R/QC.R#L2310-L2560

> When I follow your suggestion above, I get
> 
> library(pomp)
> dplyr::filter(structure(list(), class = 'traj'))
> 
> Error in UseMethod("filter") :
> no applicable method for 'filter' applied to an object of class "traj"

Interesting. I wonder if there's are other remaining ways to confuse
the S3 dispatch system into thinking your function is an S3 method that
the check is supposed to guard against. For instance, the following is
likely to work with your package:

library(pomp)
library(dplyr)
identical(filter.traj, getS3method('filter', 'traj'))
# as long as there's a visible 'filter' generic, getS3method will
# locate filter.traj as the method

...despite the method lookup seems to (correctly) fail, as you've just
demonstrated. But on older versions of R, this used to wrongly resolve
the call:

library(Ropj)
read <- function(x, ...) UseMethod('read')
identical(read.opj, getS3method('read','opj')) # works in R-devel
# [1] TRUE
read(structure(0, class = 'opj')) # calls read.opj in old R
# Error in read_opj(file, encoding, tree) :
#   Expecting a single string value: [type=double; extent=1].

I'm afraid I'm out of my depth here. The old, wrong behaviour seems to
match the R language definition
<https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Definition>.
The current behaviour seems to do the right thing? by letting the
functions opt into being methods, but then getS3method() seems to
contradict what actually gets called. Should we be fixing the
documentation, the implementation, or the check?

Can you try stepping through tools::checkS3methods('pomp') (or
tools::checkS3methods(dir = 'path/to/source/directory')) to see where
'filter' appears in the list of generics and where the 

-- 
Best regards,
Ivan


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Jan  6 09:24:13 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 6 Jan 2023 11:24:13 +0300
Subject: [R-pkg-devel] S3 generic/method consistency false positive when
 dplyr imported
In-Reply-To: <20230106112149.10207568@Tarkus>
References: <CAGPRvNDXHT-ZB4H6if_RRRwSFahUFDWbuKeppFBihvVQ4DodWA@mail.gmail.com>
 <20230105002209.6e1fae5d@Tarkus>
 <CAGPRvNAsbNQdVYiJbOTaoPow3CK-5q8fiB6tj4cpdLx22xPCfw@mail.gmail.com>
 <20230106112149.10207568@Tarkus>
Message-ID: <20230106112413.478d82da@Tarkus>

(Sorry for the unfinished message. I've got to do something about my
mailer to make it harder to send them accidentally.)

On Fri, 6 Jan 2023 11:21:49 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

> to see where 'filter' appears in the list of generics and where the

filter.traj function gets matched to it as a method?

-- 
Best regards,
Ivan


From k|ng@@ @end|ng |rom um|ch@edu  Fri Jan  6 19:56:10 2023
From: k|ng@@ @end|ng |rom um|ch@edu (Aaron A. King)
Date: Fri, 6 Jan 2023 13:56:10 -0500
Subject: [R-pkg-devel] S3 generic/method consistency false positive when
 dplyr imported
In-Reply-To: <20230106112413.478d82da@Tarkus>
References: <CAGPRvNDXHT-ZB4H6if_RRRwSFahUFDWbuKeppFBihvVQ4DodWA@mail.gmail.com>
 <20230105002209.6e1fae5d@Tarkus>
 <CAGPRvNAsbNQdVYiJbOTaoPow3CK-5q8fiB6tj4cpdLx22xPCfw@mail.gmail.com>
 <20230106112149.10207568@Tarkus> <20230106112413.478d82da@Tarkus>
Message-ID: <CAGPRvNC2T5Ce-ZdcKdwsmh53uQ1JVYf75CTC=i6Bbf2mL7B0Jw@mail.gmail.com>

Excellent suggestion, Ivan. Thanks for pointing out just where to look.

I stepped through tools::checkS3methods("pomp") and it does appear to be
roughly as I conjectured.  Namely, all functions are extracted from the
pomp namespace and checked against a list of generics.  The check that is
performed is a simple pattern-match (i.e.,
startsWith(paste0(genericname,"."), functionname)).  Clearly this is prone
to false positives.  I wonder what would be involved in tightening this up
so that it agrees with what the actual dispatch mechanism gives....

Interestingly, there is a whitelist, implemented mostly via
tools::nonS3methods().  The function (plyr::rbind.fill) that I had been
importing is there but its replacement (dplyr::bind_rows) is not. So this
answers my original question.

The whitelist appears to be a somewhat arbitrary compilation of functions
from various packages, with no obvious theme.  For example, dplyr is not on
the list, but ElectoGraph is; reshape is on the list but reshape2 is not.
The impression of arbitrariness is reinforced by the fact that packages
that Wickham has for whatever reason decided are superseded are present in
that list and packages he considers for the moment to be worth maintaining
are not.  Doing a quick 'git blame' I see that the whitelist was mostly put
together in 2013, with a few additions in 2015 and much more occasionally
since.

It occurs to me that there ought to be a mechanism whereby a package author
could add to the list of non-S3 methods.  I see from the mailing list
archives that there was discussion of this back in 2015 (
https://stat.ethz.ch/pipermail/r-devel/2015-June/071356.html), with what
looked like consensus that there ought to be such a facility, but nothing
seems to have actually been done about it.  I conjecture that the decision
was to just fold false positives into the whitelist on an ad hoc basis.

Dr. Aaron A. King
University of Michigan


On Fri, Jan 6, 2023 at 3:24 AM Ivan Krylov <krylov.r00t at gmail.com> wrote:

> (Sorry for the unfinished message. I've got to do something about my
> mailer to make it harder to send them accidentally.)
>
> On Fri, 6 Jan 2023 11:21:49 +0300
> Ivan Krylov <krylov.r00t at gmail.com> wrote:
>
> > to see where 'filter' appears in the list of generics and where the
>
> filter.traj function gets matched to it as a method?
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]


