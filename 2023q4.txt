From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 10:29:18 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 08:29:18 +0000
Subject: [R-pkg-devel] Testing.
Message-ID: <20231001212918.326ab18c@rolf-Latitude-E7470>


I'm having a problem .... please excuse the noise.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 10:31:31 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 08:31:31 +0000
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
Message-ID: <20231001211547.4c46512e@rolf-Latitude-E7470>


When I submitted an update of my Iso package a short time ago, it was
rejected as not passing the incoming checks automatically.  Explicitly,
I got a WARNING:

> * checking sizes of PDF files under 'inst/doc' ... WARNING
> 'gs+qpdf' made some significant size reductions:
>      compacted 'algorithm.pdf' from 394Kb to 99Kb
>   consider running tools::compactPDF(gs_quality = "ebook") on these
> files

I did as instructed and ran

    tools::compactPDF("./algorithm.pdf",gs_quality="ebook")

having started R in the inst/vignettes directory, which is where the
file algorithm.pdf is to be found.

According to "ls -l" the size of algorithm.pdf was about 109 Kb. before
I ran compactPDF() and about 90 Kb. afterward.

I do not understand:

    * the reference to inst/doc (there is no such directory)
    * where the sizes 349 Kb and 99 Kb come from
    * what I have to do to get Iso to pass the required checks

The email that I received from CRAN (under the return address
ligges at statistik.tu-dortmund.de) said:

> If you are not sure how to fix the problems shown, please ask for
> help on the R-package-devel mailing list:

Consequently I am asking! Can anyone set me on the path to
enlightenment?  Thanks.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From kry|ov@r00t @end|ng |rom gm@||@com  Sun Oct  1 14:22:34 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 1 Oct 2023 15:22:34 +0300
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
In-Reply-To: <20231001211547.4c46512e@rolf-Latitude-E7470>
References: <20231001211547.4c46512e@rolf-Latitude-E7470>
Message-ID: <20231001152234.6bdd40ec@Tarkus>

On Sun,  1 Oct 2023 08:31:31 +0000
Rolf Turner <rolfturner at posteo.net> wrote:

> I do not understand:

>    * the reference to inst/doc (there is no such directory)

When you run R CMD build in order to produce a new Iso-*.tar.gz, R runs
Sweave and pdflatex on vignettes/algorithm.Rnw in order to produce
inst/doc/algorithm.pdf inside the resulting tarball (but not the
original source tree on your computer).

>    * what I have to do to get Iso to pass the required checks

Does it help to run R CMD build --compact-vignettes=both? This should
let R run tools::compactPDF on inst/doc/algorithm.pdf it generates
before placing it inside the package tarball.

I think that R doesn't know anything about files under inst/vignettes
in the source tree.

-- 
Best regards,
Ivan


From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 23:01:13 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 21:01:13 +0000
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
In-Reply-To: <20231001152234.6bdd40ec@Tarkus>
References: <20231001211547.4c46512e@rolf-Latitude-E7470>
 <20231001152234.6bdd40ec@Tarkus>
Message-ID: <20231002100113.2ce1c902@rolf-Latitude-E7470>

On Sun, 1 Oct 2023 15:22:34 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Sun,  1 Oct 2023 08:31:31 +0000
> Rolf Turner <rolfturner at posteo.net> wrote:
> 
> > I do not understand:
> 
> >    * the reference to inst/doc (there is no such directory)
> 
> When you run R CMD build in order to produce a new Iso-*.tar.gz, R
> runs Sweave and pdflatex on vignettes/algorithm.Rnw in order to
> produce inst/doc/algorithm.pdf inside the resulting tarball (but not
> the original source tree on your computer).
> 
> >    * what I have to do to get Iso to pass the required checks
> 
> Does it help to run R CMD build --compact-vignettes=both? This should
> let R run tools::compactPDF on inst/doc/algorithm.pdf it generates
> before placing it inside the package tarball.
> 
> I think that R doesn't know anything about files under inst/vignettes
> in the source tree.

Thanks Ivan.  That may well be the key.  When I unpacked the tarball
created without the --compact-vignettes=both flag, I found that
inst/doc/algorithm.pdf had size 403 Kb, whereas with that flag set
it had size 108 Kb.

I'll re-submit now and see what happens.

I *really* think that the instructions from CRAN could have been
clearer!  Without your guidance I'd have been at a total loss.

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From j@goreck| @end|ng |rom w|t@edu@p|  Tue Oct  3 16:45:26 2023
From: j@goreck| @end|ng |rom w|t@edu@p| (Jan Gorecki)
Date: Tue, 3 Oct 2023 16:45:26 +0200
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
Message-ID: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>

Hello,

I noticed some packages define Imports in DESCRIPTION file listing base R
packages like methods, utils, etc.

My question is that if it is necessary to list those* dependencies in
DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

* by "those" I mean packages listed by:

in tools:::.get_standard_package_names()$base

	[[alternative HTML version deleted]]


From henr|k@bengt@@on @end|ng |rom gm@||@com  Tue Oct  3 17:50:14 2023
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Tue, 3 Oct 2023 08:50:14 -0700
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
In-Reply-To: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>
References: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>
Message-ID: <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>

On Tue, Oct 3, 2023 at 7:46?AM Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
>
> Hello,
>
> I noticed some packages define Imports in DESCRIPTION file listing base R
> packages like methods, utils, etc.
>
> My question is that if it is necessary to list those* dependencies in
> DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

You do *not* have to declare base-R packages as dependencies in the
DESCRIPTION file.  'R CMD check' and 'R CMD check --as-cran' will not
complain about them.

I can't speak for others, but, I choose to declare all(*) my base-R
package dependencies in my DESCRIPTION files for a reason.  This makes
it explicit what packages my package rely on, including which of the
base-R packages.  For instance, it's nice to be able to tell when the
'parallel' or 'tcltk' package is used from the DESCRIPTION file (and
the online CRAN package page, if on CRAN).

(*) The exception is the 'base' package, because that is such a
fundamental package in R and is always loaded.  The other base-R
packages are theoretically optional when it comes to running R, e.g.

$ R_ENABLE_JIT=0 Rscript --vanilla --default-packages=base -e
"loadedNamespaces()"
[1] "base"

/Henrik

>
> * by "those" I mean packages listed by:
>
> in tools:::.get_standard_package_names()$base
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @|j|@ng @end|ng |rom bccrc@c@  Tue Oct  3 19:34:04 2023
From: @|j|@ng @end|ng |rom bccrc@c@ (Aixiang Jiang)
Date: Tue, 3 Oct 2023 17:34:04 +0000
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
In-Reply-To: <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>
References: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>,
 <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>
Message-ID: <1696354445275.65575@bccrc.ca>

Thank you - all!

Aixiang
________________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Henrik Bengtsson <henrik.bengtsson at gmail.com>
Sent: Tuesday, October 3, 2023 8:50 AM
To: Jan Gorecki
Cc: List r-package-devel
Subject: Re: [R-pkg-devel] DESCRIPTION file Imports of base R packages

This email came from an EXTERNAL SENDER. If you think this message is suspicious, please do not open any attached files or links, and forward it as an attachment to spammail at bccrc.ca



On Tue, Oct 3, 2023 at 7:46?AM Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
>
> Hello,
>
> I noticed some packages define Imports in DESCRIPTION file listing base R
> packages like methods, utils, etc.
>
> My question is that if it is necessary to list those* dependencies in
> DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

You do *not* have to declare base-R packages as dependencies in the
DESCRIPTION file.  'R CMD check' and 'R CMD check --as-cran' will not
complain about them.

I can't speak for others, but, I choose to declare all(*) my base-R
package dependencies in my DESCRIPTION files for a reason.  This makes
it explicit what packages my package rely on, including which of the
base-R packages.  For instance, it's nice to be able to tell when the
'parallel' or 'tcltk' package is used from the DESCRIPTION file (and
the online CRAN package page, if on CRAN).

(*) The exception is the 'base' package, because that is such a
fundamental package in R and is always loaded.  The other base-R
packages are theoretically optional when it comes to running R, e.g.

$ R_ENABLE_JIT=0 Rscript --vanilla --default-packages=base -e
"loadedNamespaces()"
[1] "base"

/Henrik

>
> * by "those" I mean packages listed by:
>
> in tools:::.get_standard_package_names()$base
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

From v|nhd|zzo @end|ng |rom gm@||@com  Tue Oct  3 23:52:26 2023
From: v|nhd|zzo @end|ng |rom gm@||@com (Vinh Nguyen)
Date: Tue, 3 Oct 2023 14:52:26 -0700
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
Message-ID: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>

Dear members of R-package-devel,

CRAN has the following policy: Packages which use Internet resources
should fail gracefully with an informative message if the resource is
not available or has changed (and not give a check warning nor error).

I have a CRAN-accepted package with vignettes that use Rmarkdown. One
of the vignettes involves a lot of images, so rather than embed the
raw images in the vignette, I reference the images on Flickr (to keep
the package size small enough to be hosted on CRAN). Every half year
or so, I'll get a message from CRAN maintainers that the package is
not failing gracefully on one of their servers due to their build and
testing processes.  The error message looks as follows:

Could not fetch
https://live.staticflickr.com/65535/52281215570_5f9cc90a12_o.png
     HttpExceptionRequest Request {
      host = "live.staticflickr.com"
      port = 443
      secure = True
      requestHeaders = []
      path = "/65535/52281215570_5f9cc90a12_o.png"
      queryString = ""
      method = "GET"
      proxy = Nothing
      rawBody = False
      redirectCount = 10
      responseTimeout = ResponseTimeoutDefault
      requestVersion = HTTP/1.1
     }
      (ConnectionFailure Network.Socket.getAddrInfo (called with
preferred socket type/protocol: AddrInfo {addrFlags = [AI_ADDRCONFIG],
addrFamily = AF_UNSPEC, addrSocketType = Stream, addrProtocol = 0,
addrAddress = <assumed to be undefined>, addrCanonName = <assumed to be
undefined>}, host name: Just "live.staticflickr.com", service name: Just
"443"): does not exist (Name or service not known))
     Error: processing vignette
'Ex-04-Webscraping-Online-Data-Files.Rmd' failed with diagnostics:
     pandoc document conversion failed with error 61

What's the recommended way for making this fail gracefully?  Again, I
am pointing to the images online.  I am aware of .Rbuildignore, but
using this would make the vignettes not hosted on the CRAN package
page.

Thanks in advance for your help.

-- Vinh


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct  4 10:34:08 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 4 Oct 2023 11:34:08 +0300
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
In-Reply-To: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
References: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
Message-ID: <20231004113408.2734534a@Tarkus>

On Tue, 3 Oct 2023 14:52:26 -0700
Vinh Nguyen <vinhdizzo at gmail.com> wrote:

> Could not fetch
> https://live.staticflickr.com/65535/52281215570_5f9cc90a12_o.png

This is Pandoc failing to bundle external resources from the final
Markdown file, not your R code.

>      Error: processing vignette
> 'Ex-04-Webscraping-Online-Data-Files.Rmd' failed with diagnostics:
>      pandoc document conversion failed with error 61

My psychic debugging powers tell me that this is the vignette you're
having problems with:
https://github.com/vinhdizzo/IRexamples/blob/main/vignettes/Ex-04-Webscraping-Online-Data-Files.Rmd

If you look at the vignette as it is on CRAN, you can see that the
images aren't actually loaded from live.staticflickr.com, but are
included as base64 PNG blobs in the HTML file. This is much less
efficient than a plain PNG file. I think that your package will become
smaller if you disable this bundling and include the original PNG files
in your package. You may be able to squeeze some more savings by using
pngcrush / optipng to compress the images further.

The parameter responsible for this base64 encoding is called
self_contained, which defaults to TRUE in the rmarkdown::html_document
format, which prettydoc::html_pretty inherits from. Set it to FALSE in
the YAML header of the vignette.

Note that some other scripts and CSS files may be loaded from external
sources if you do that. As a user, I would prefer this not to be the
case, but I don't know enough about rmarkdown to set your vignette up
to bundle everything except the images.

-- 
Best regards,
Ivan


From dewey @end|ng |rom dunn|ngton@c@  Thu Oct  5 03:38:35 2023
From: dewey @end|ng |rom dunn|ngton@c@ (Dewey Dunnington)
Date: Wed, 04 Oct 2023 22:38:35 -0300
Subject: [R-pkg-devel] Status of adbcpostgresql
Message-ID: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>

Hi all,

I submitted the first release of adbcpostgresql (an R repackaging of 
ADBC's Postgres driver) about a month ago and it has been pending human 
inspection (I think) since then. I did reply-all to the email once to 
inquire about status but haven't heard back. Where is the best place to 
direct communication about the status of the package? I am certainly 
happy to fix any problems that arise.

Cheers,

-dewey


From ||u|@@rev|||@ @end|ng |rom gm@||@com  Thu Oct  5 09:39:45 2023
From: ||u|@@rev|||@ @end|ng |rom gm@||@com (=?UTF-8?Q?Llu=C3=ADs_Revilla?=)
Date: Thu, 5 Oct 2023 09:39:45 +0200
Subject: [R-pkg-devel] Status of adbcpostgresql
In-Reply-To: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>
References: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>
Message-ID: <CAN+W6_v35eQziWhYqHdMgSqtY3H+Ht-N7v64z+jJ_0sw7PYt8A@mail.gmail.com>

Hi Dewey,

Currently there are several packages on a subfolder for human inspection.
I don't think you can do anything else: sending this email might help
drawing attention from your reviewer to your package.
There might be some issues in the package that you'll need to address, try
to find them in advance or prepare a reply for them.

Probably the reviewer is busy with other non-CRAN related things. Or maybe
the review fell between emails.
After a couple of weeks you could try again sending an email to the
reviewer.

Best,

Llu?s

On Thu, 5 Oct 2023 at 03:39, Dewey Dunnington <dewey at dunnington.ca> wrote:

> Hi all,
>
> I submitted the first release of adbcpostgresql (an R repackaging of
> ADBC's Postgres driver) about a month ago and it has been pending human
> inspection (I think) since then. I did reply-all to the email once to
> inquire about status but haven't heard back. Where is the best place to
> direct communication about the status of the package? I am certainly
> happy to fix any problems that arise.
>
> Cheers,
>
> -dewey
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From v|nhd|zzo @end|ng |rom gm@||@com  Fri Oct  6 14:59:10 2023
From: v|nhd|zzo @end|ng |rom gm@||@com (Vinh Nguyen)
Date: Fri, 6 Oct 2023 05:59:10 -0700
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
In-Reply-To: <20231004113408.2734534a@Tarkus>
References: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
 <20231004113408.2734534a@Tarkus>
Message-ID: <CA+2DmwhmPgnDomuP23vnRTz8tD5wBXpfwbt4eiyw_Hy+_9Nq9Q@mail.gmail.com>

>
>
> The parameter responsible for this base64 encoding is called
> self_contained, which defaults to TRUE in the rmarkdown::html_document
> format, which prettydoc::html_pretty inherits from. Set it to FALSE in
> the YAML header of the vignette.
>
> Note that some other scripts and CSS files may be loaded from external
> sources if you do that. As a user, I would prefer this not to be the
> case, but I don't know enough about rmarkdown to set your vignette up
> to bundle everything except the images
>


Thanks for the detailed investigation and analysis, Ivan. For now, I've
followed your suggestion and added the option `self_contained: false`. The
revised package is now on CRAN, and you are correct that css files are no
longer contained for the version sitting on CRAN, so the vignette is less
pretty looking. I'll investigate if there are any other workarounds.

Your assistance is much appreciated.

>

	[[alternative HTML version deleted]]


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Oct  6 16:36:45 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 6 Oct 2023 15:36:45 +0100
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
Message-ID: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>

I am trying to update my CRAN package metap. When I ran a final check on 
winbuilder I got the warning

* checking sizes of PDF files under 'inst/doc' ... WARNING
   'gs+qpdf' made some significant size reductions:
      compacted 'compare.pdf' from 498Kb to 243Kb
      compacted 'plotmetap.pdf' from 349Kb to 91Kb
   consider running tools::compactPDF(gs_quality = "ebook") on these files,
   or build the source package with --compact-vignettes=both

But I did use the option --compact-vignettes=both when I built the tarball.

I do have gs installed but not qpdf. I built the package under Windows 
if that is relevant.

Any suggestions?

-- 
Michael


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Oct  6 16:48:28 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 6 Oct 2023 17:48:28 +0300
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
In-Reply-To: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
Message-ID: <20231006174828.651b58c7@arachnoid>

? Fri, 6 Oct 2023 15:36:45 +0100
Michael Dewey <lists at dewey.myzen.co.uk> ?????:

> But I did use the option --compact-vignettes=both when I built the
> tarball.

> I do have gs installed but not qpdf. I built the package under
> Windows if that is relevant.

Is the Ghostscript executable on the %PATH%? It might help to install a
newer version. It may also be informative to extract the vignette *.pdf
files from the source package tarball and run tools::compactPDF(pdfs,
gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
point.

-- 
Best regards,
Ivan


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Oct  6 17:30:26 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 6 Oct 2023 16:30:26 +0100
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
In-Reply-To: <20231006174828.651b58c7@arachnoid>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
Message-ID: <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>

Dear Ivan

You must have psychic powers. After some digging I find that the copy 
installed by TexLive is hidden from other software so I need to install 
it again. I suppose while I am at it I should try installing qpdf.

Michael

On 06/10/2023 15:48, Ivan Krylov wrote:
> ? Fri, 6 Oct 2023 15:36:45 +0100
> Michael Dewey <lists at dewey.myzen.co.uk> ?????:
> 
>> But I did use the option --compact-vignettes=both when I built the
>> tarball.
> 
>> I do have gs installed but not qpdf. I built the package under
>> Windows if that is relevant.
> 
> Is the Ghostscript executable on the %PATH%? It might help to install a
> newer version. It may also be informative to extract the vignette *.pdf
> files from the source package tarball and run tools::compactPDF(pdfs,
> gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
> point.
> 

-- 
Michael


From w@chte||k @end|ng |rom gm@||@com  Sat Oct  7 12:25:14 2023
From: w@chte||k @end|ng |rom gm@||@com (Wojciech Achtelik)
Date: Sat, 7 Oct 2023 12:25:14 +0200
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
Message-ID: <CABYZkg=KbFch1WsJN_E-nfrMfoNBNjX2rZyVpLpZgdY507eaAQ@mail.gmail.com>

Hi,

I recently submitted my first R package to CRAN, and I encountered a NOTE
during the checking process. The NOTE looks like this:

=============================================================
Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: whether the namespace can be loaded with stated dependencies,
Result: NOTE
  Warning: no function found corresponding to methods exports from 'hmsr'
for: 'show'

  A namespace must be able to be loaded with just the base namespace
  loaded: otherwise if the namespace gets loaded by a saved object, the
  session will be unable to start.

  Probably some imports need to be declared in the NAMESPACE file.
=============================================================

I'm seeking help to understand and address this issue. show is defined like
this:

#' Show method for class "hms".#'#' @param object - hms s4 object#'#'
@return It returns the names of the slots and the classes associated
with the#' slots in the "hms" class. It prints call details.#'#'
@export#'#' @examples
#' f <- function(x) x
#' result <- hms(fitness = f, lower = -5, upper = 5)
#' show(result)
setMethod("show", "hms", function(object) {
  cat("An object of class \"hms\"\n")
  cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
  cat("Available slots:\n")
  print(methods::slotNames(object))})

And in the NAMESPACE there is a line that looks like this:

exportMethods(show)

I was investigating if the show is defined correctly and the GA package has
a very similar method:

setMethod("show", "ga",function(object)
 { cat("An object of class \"ga\"\n")
   cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
   cat("Available slots:\n")
   print(slotNames(object))})

I could not reproduce this NOTE on my personal machine with Windows.
On Mac OS I have never experienced this NOTE.


Best regards

Wojciech Achtelik

	[[alternative HTML version deleted]]


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Sun Oct  8 17:47:41 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Sun, 8 Oct 2023 16:47:41 +0100
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
Message-ID: <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>

Following on from Ivan's advice I have now installed qpdf and Ghostview. 
I have checked that they are both on my path by typing their name at the 
command line and verifying they open. I then built the package with the 
--compress-vignettes=both and then checked it with --as-cran I still get 
a complaint that it needs qpdf to check compression.

I notice that in the Writing R Extensions manual in section 1.6.1 it states
"The full path to the qpdf command can be supplied as environment 
variable R_QPDF ..."

Is that a typo for "must be supplied"? If it is where can I find the 
answers to questions about how R accepts Windows paths? Do I need to 
enclose parts of names containing spaces in "" signs? Does it mean the 
path up to, in this case, bin or must I include qpdf.exe after it?

I assume I do not need to do anything special to get it to find Ghostscript?

Michael

On 06/10/2023 16:30, Michael Dewey wrote:
> Dear Ivan
> 
> You must have psychic powers. After some digging I find that the copy 
> installed by TexLive is hidden from other software so I need to install 
> it again. I suppose while I am at it I should try installing qpdf.
> 
> Michael
> 
> On 06/10/2023 15:48, Ivan Krylov wrote:
>> ? Fri, 6 Oct 2023 15:36:45 +0100
>> Michael Dewey <lists at dewey.myzen.co.uk> ?????:
>>
>>> But I did use the option --compact-vignettes=both when I built the
>>> tarball.
>>
>>> I do have gs installed but not qpdf. I built the package under
>>> Windows if that is relevant.
>>
>> Is the Ghostscript executable on the %PATH%? It might help to install a
>> newer version. It may also be informative to extract the vignette *.pdf
>> files from the source package tarball and run tools::compactPDF(pdfs,
>> gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
>> point.
>>
> 

-- 
Michael


From m@tth|@@-gond@n @end|ng |rom gmx@de  Sun Oct  8 21:41:14 2023
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Sun, 8 Oct 2023 21:41:14 +0200
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
Message-ID: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>

Dear developers and CRAN people,

I get some linker warnings on the macOS build server,

ld: warning: direct access in function '?' from file '?' to global weak symbol '?' from file '?' means the weak symbol cannot be overridden at runtime. This was likely caused by different translation units being compiled with different visibility settings.

Writing R Extensions (Section 6.16) says that visibility attributes are not supported on macOS nor Windows. If I add $(CXX_VISIBILITY) to PKG_CXXFLAGS, the warnings are still there, and I can see from the compiler log that the flags do not have any effect on macOS. However, if I add -fvisibility=hidden to PKG_CXXFLAGS, the warnings disappear (but I get a reminder from R CMD check that -fvisibility=hidden is not portable). I am wondering if $(CXX_VISIBILITY) could be supported on macOS.

Best wishes,

Matthias

This is the build log of the package: https://www.r-project.org/nosvn/R.check/r-release-macos-arm64/rswipl-00install.html


	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Oct  8 22:29:50 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 9 Oct 2023 09:29:50 +1300
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
In-Reply-To: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
References: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
Message-ID: <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>

Matthias,

this has nothing to do with R, but rather your code. You have the wrong order of headers: the SWI headers mess up visibility macros, so you have to include them *after* Rcpp.h.

Cheers,
Simon


> On 9/10/2023, at 8:41 AM, Matthias Gondan <matthias-gondan at gmx.de> wrote:
> 
> Dear developers and CRAN people,
> 
> I get some linker warnings on the macOS build server,
> 
> ld: warning: direct access in function '?' from file '?' to global weak symbol '?' from file '?' means the weak symbol cannot be overridden at runtime. This was likely caused by different translation units being compiled with different visibility settings.
> 
> Writing R Extensions (Section 6.16) says that visibility attributes are not supported on macOS nor Windows. If I add $(CXX_VISIBILITY) to PKG_CXXFLAGS, the warnings are still there, and I can see from the compiler log that the flags do not have any effect on macOS. However, if I add -fvisibility=hidden to PKG_CXXFLAGS, the warnings disappear (but I get a reminder from R CMD check that -fvisibility=hidden is not portable). I am wondering if $(CXX_VISIBILITY) could be supported on macOS.
> 
> Best wishes,
> 
> Matthias
> 
> This is the build log of the package: https://www.r-project.org/nosvn/R.check/r-release-macos-arm64/rswipl-00install.html
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From j@g@nmn2 @end|ng |rom gm@||@com  Sun Oct  8 23:43:57 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Sun, 8 Oct 2023 17:43:57 -0400
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
In-Reply-To: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
References: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
Message-ID: <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>

> Hi,
> 
> I recently submitted my first R package to CRAN, and I encountered a NOTE
> during the checking process. The NOTE looks like this:
> 
> =============================================================
> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
> Check: whether the namespace can be loaded with stated dependencies,
> Result: NOTE
>    Warning: no function found corresponding to methods exports from 'hmsr'
> for: 'show'
> 
>    A namespace must be able to be loaded with just the base namespace
>    loaded: otherwise if the namespace gets loaded by a saved object, the
>    session will be unable to start.
> 
>    Probably some imports need to be declared in the NAMESPACE file.

Sounds like your NAMESPACE is missing importFrom(methods, show) ... ?
I'm not sure why you could not reproduce the problem locally, given that
check uses _R_CHECK_CODE_USAGE_WITH_ONLY_BASE_ATTACHED_=true by default.
But it is hard to say anything without a link to the package sources ...

Mikael

> =============================================================
> 
> I'm seeking help to understand and address this issue. show is defined like
> this:
> 
> #' Show method for class "hms".#'#' @param object - hms s4 object#'#'
> @return It returns the names of the slots and the classes associated
> with the#' slots in the "hms" class. It prints call details.#'#'
> @export#'#' @examples
> #' f <- function(x) x
> #' result <- hms(fitness = f, lower = -5, upper = 5)
> #' show(result)
> setMethod("show", "hms", function(object) {
>    cat("An object of class \"hms\"\n")
>    cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
>    cat("Available slots:\n")
>    print(methods::slotNames(object))})
> 
> And in the NAMESPACE there is a line that looks like this:
> 
> exportMethods(show)
> 
> I was investigating if the show is defined correctly and the GA package has
> a very similar method:
> 
> setMethod("show", "ga",function(object)
>   { cat("An object of class \"ga\"\n")
>     cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
>     cat("Available slots:\n")
>     print(slotNames(object))})
> 
> I could not reproduce this NOTE on my personal machine with Windows.
> On Mac OS I have never experienced this NOTE.
> 
> 
> Best regards
> 
> Wojciech Achtelik


From |r@nzk|r@|y @end|ng |rom |n|@e|te@hu  Sun Oct  8 23:28:31 2023
From: |r@nzk|r@|y @end|ng |rom |n|@e|te@hu (=?iso-8859-1?Q?Dr=2E_Franz_Kir=E1ly?=)
Date: Sun, 8 Oct 2023 21:28:31 +0000
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
Message-ID: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>

Dear all,

can someone explain to me what exactly happened to mlr3proba on CRAN?
https://cran.r-project.org/web/packages/mlr3proba/index.html

Thanks
Franz


	[[alternative HTML version deleted]]


From @vr@h@m@@d|er @end|ng |rom gm@||@com  Mon Oct  9 02:39:47 2023
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Mon, 9 Oct 2023 00:39:47 +0000
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <CAL6gwnKcQcJv_+ajSmawF64z0wYLW1Zvj=r8h+p1TaXmpvMYAw@mail.gmail.com>

https://cran-archive.r-project.org/web/checks/2022/2022-05-16_check_results_mlr3proba.html

On Mon, Oct 9, 2023 at 12:37?AM Dr. Franz Kir?ly <franzkiraly at inf.elte.hu>
wrote:

> Dear all,
>
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
>
> Thanks
> Franz
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Mon Oct  9 02:43:02 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 9 Oct 2023 13:43:02 +1300
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <7ACF837C-971C-4C15-AD5E-6C7DA2EFB98A@R-project.org>

Franz,

it means that the author(s) have abandoned the package: as the note says it was failing checks and the authors have not fixed the problems so it has been removed from CRAN (more than a year ago).

Cheers,
Simon



> On 9/10/2023, at 10:28 AM, Dr. Franz Kir?ly <franzkiraly at inf.elte.hu> wrote:
> 
> Dear all,
> 
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
> 
> Thanks
> Franz
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From m@tth|@@-gond@n @end|ng |rom gmx@de  Mon Oct  9 08:32:20 2023
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Mon, 9 Oct 2023 08:32:20 +0200
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
In-Reply-To: <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>
References: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
 <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>
Message-ID: <1N49h5-1rXQX43IqP-0106qV@mail.gmx.net>

You found the problem, thanks!



Matthias,

this has nothing to do with R, but rather your code. You have the wrong order of headers: the SWI headers mess up visibility macros, so you have to include them *after* Rcpp.h.

Cheers,
Simon


	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Oct  9 09:51:30 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 9 Oct 2023 10:51:30 +0300
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
Message-ID: <20231009105130.3f0d269c@Tarkus>

On Sun, 8 Oct 2023 16:47:41 +0100
Michael Dewey <lists at dewey.myzen.co.uk> wrote:

> Following on from Ivan's advice I have now installed qpdf and
> Ghostview. I have checked that they are both on my path by typing
> their name at the command line and verifying they open.

> I then built the package with the --compress-vignettes=both and then
> checked it with --as-cran I still get a complaint that it needs qpdf
> to check compression.

While running R, does Sys.which('qpdf') return the path to qpdf.exe?
Does Sys.getenv('PATH') match your expectations?

> I notice that in the Writing R Extensions manual in section 1.6.1 it
> states "The full path to the qpdf command can be supplied as
> environment variable R_QPDF ..."
> 
> Is that a typo for "must be supplied"?

Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
must work if it's on the %PATH%, but if all else fails, setting this
environment variable should help.

> If it is where can I find the answers to questions about how R
> accepts Windows paths? Do I need to enclose parts of names containing
> spaces in "" signs?

It always depends on how the final command line is built by a
particular function, but it should work by taking plain file paths
without any escaping and quotation. The directory separators shouldn't
matter either.

(tools::compactPDF uses system2(), so it quotes the path to the
executable by itself.)

> Does it mean the path up to, in this case, bin or must I include
> qpdf.exe after it?

It must be the full path to the executable, including the final
qpdf.exe.

> I assume I do not need to do anything special to get it to find
> Ghostscript?

tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
If it's not there, R_GSCMD must be set to the full path to the
executable. Judging by the NOTE you've received, it's Ghostscript that
performed most of the compaction in your case.

-- 
Best regards,
Ivan


From j@g@nmn2 @end|ng |rom gm@||@com  Mon Oct  9 15:05:41 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Mon, 9 Oct 2023 09:05:41 -0400
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
In-Reply-To: <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>
References: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
 <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>
Message-ID: <bb2a5822-d127-4e6e-bf88-eabe542875cc@gmail.com>



On 2023-10-08 5:43 pm, Mikael Jagan wrote:
>> Hi,
>>
>> I recently submitted my first R package to CRAN, and I encountered a NOTE
>> during the checking process. The NOTE looks like this:
>>
>> =============================================================
>> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
>> Check: whether the namespace can be loaded with stated dependencies,
>> Result: NOTE
>>     Warning: no function found corresponding to methods exports from 'hmsr'
>> for: 'show'
>>
>>     A namespace must be able to be loaded with just the base namespace
>>     loaded: otherwise if the namespace gets loaded by a saved object, the
>>     session will be unable to start.
>>
>>     Probably some imports need to be declared in the NAMESPACE file.
> 
> Sounds like your NAMESPACE is missing importFrom(methods, show) ... ?
> I'm not sure why you could not reproduce the problem locally, given that
> check uses _R_CHECK_CODE_USAGE_WITH_ONLY_BASE_ATTACHED_=true by default.

Reading tools:::.check_packages I see that this environment variable is
not relevant to this particular test.  Still, do import generic functions
for which you define methods, from all packages != "base".

Mikael

> But it is hard to say anything without a link to the package sources ...
> 
> Mikael
> 
>> =============================================================
>>
>> I'm seeking help to understand and address this issue. show is defined like
>> this:
>>
>> #' Show method for class "hms".#'#' @param object - hms s4 object#'#'
>> @return It returns the names of the slots and the classes associated
>> with the#' slots in the "hms" class. It prints call details.#'#'
>> @export#'#' @examples
>> #' f <- function(x) x
>> #' result <- hms(fitness = f, lower = -5, upper = 5)
>> #' show(result)
>> setMethod("show", "hms", function(object) {
>>     cat("An object of class \"hms\"\n")
>>     cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
>>     cat("Available slots:\n")
>>     print(methods::slotNames(object))})
>>
>> And in the NAMESPACE there is a line that looks like this:
>>
>> exportMethods(show)
>>
>> I was investigating if the show is defined correctly and the GA package has
>> a very similar method:
>>
>> setMethod("show", "ga",function(object)
>>    { cat("An object of class \"ga\"\n")
>>      cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
>>      cat("Available slots:\n")
>>      print(slotNames(object))})
>>
>> I could not reproduce this NOTE on my personal machine with Windows.
>> On Mac OS I have never experienced this NOTE.
>>
>>
>> Best regards
>>
>> Wojciech Achtelik


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Mon Oct  9 17:22:17 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Mon, 9 Oct 2023 16:22:17 +0100
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <20231009105130.3f0d269c@Tarkus>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
 <20231009105130.3f0d269c@Tarkus>
Message-ID: <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>

Dear Ivan (and list)

Using Ivan's advice I traced the problem to a difference of opinio 
between Microsoft and R about paht names. I had mistakenly enclosed 
parts of the names in "" which was fine for MS but not R. Sys.which() 
was my saviour here.

Many thanks to Ivan for broadening my knowledge of useful functions like 
Sys.which().

Michael

On 09/10/2023 08:51, Ivan Krylov wrote:
> On Sun, 8 Oct 2023 16:47:41 +0100
> Michael Dewey <lists at dewey.myzen.co.uk> wrote:
> 
>> Following on from Ivan's advice I have now installed qpdf and
>> Ghostview. I have checked that they are both on my path by typing
>> their name at the command line and verifying they open.
> 
>> I then built the package with the --compress-vignettes=both and then
>> checked it with --as-cran I still get a complaint that it needs qpdf
>> to check compression.
> 
> While running R, does Sys.which('qpdf') return the path to qpdf.exe?
> Does Sys.getenv('PATH') match your expectations?
> 
>> I notice that in the Writing R Extensions manual in section 1.6.1 it
>> states "The full path to the qpdf command can be supplied as
>> environment variable R_QPDF ..."
>>
>> Is that a typo for "must be supplied"?
> 
> Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
> must work if it's on the %PATH%, but if all else fails, setting this
> environment variable should help.
> 
>> If it is where can I find the answers to questions about how R
>> accepts Windows paths? Do I need to enclose parts of names containing
>> spaces in "" signs?
> 
> It always depends on how the final command line is built by a
> particular function, but it should work by taking plain file paths
> without any escaping and quotation. The directory separators shouldn't
> matter either.
> 
> (tools::compactPDF uses system2(), so it quotes the path to the
> executable by itself.)
> 
>> Does it mean the path up to, in this case, bin or must I include
>> qpdf.exe after it?
> 
> It must be the full path to the executable, including the final
> qpdf.exe.
> 
>> I assume I do not need to do anything special to get it to find
>> Ghostscript?
> 
> tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
> If it's not there, R_GSCMD must be set to the full path to the
> executable. Judging by the NOTE you've received, it's Ghostscript that
> performed most of the compaction in your case.
> 

-- 
Michael


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Mon Oct  9 17:32:48 2023
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Mon, 09 Oct 2023 08:32:48 -0700
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
 <20231009105130.3f0d269c@Tarkus>
 <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>
Message-ID: <375250EA-92CA-4378-B754-8F871D8DA37F@dcn.davis.ca.us>

R could care less about what is in PATH... there is however a difference between Windows parsing PATH and how CMD lets you quote things interactively.

The whole point of PATH is to let you or R provide simple program names like qpdf without knowing where they are... Windows takes over and looks up where the program actually is based on the contents of PATH. How you get things into that environment variable can vary depending on which software you are using (CMD and R are two possible options), but the actual content is handled by the operating system (which is why PATH on Linux is formatted differently than PATH on Windows).

On October 9, 2023 8:22:17 AM PDT, Michael Dewey <lists at dewey.myzen.co.uk> wrote:
>Dear Ivan (and list)
>
>Using Ivan's advice I traced the problem to a difference of opinio between Microsoft and R about paht names. I had mistakenly enclosed parts of the names in "" which was fine for MS but not R. Sys.which() was my saviour here.
>
>Many thanks to Ivan for broadening my knowledge of useful functions like Sys.which().
>
>Michael
>
>On 09/10/2023 08:51, Ivan Krylov wrote:
>> On Sun, 8 Oct 2023 16:47:41 +0100
>> Michael Dewey <lists at dewey.myzen.co.uk> wrote:
>> 
>>> Following on from Ivan's advice I have now installed qpdf and
>>> Ghostview. I have checked that they are both on my path by typing
>>> their name at the command line and verifying they open.
>> 
>>> I then built the package with the --compress-vignettes=both and then
>>> checked it with --as-cran I still get a complaint that it needs qpdf
>>> to check compression.
>> 
>> While running R, does Sys.which('qpdf') return the path to qpdf.exe?
>> Does Sys.getenv('PATH') match your expectations?
>> 
>>> I notice that in the Writing R Extensions manual in section 1.6.1 it
>>> states "The full path to the qpdf command can be supplied as
>>> environment variable R_QPDF ..."
>>> 
>>> Is that a typo for "must be supplied"?
>> 
>> Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
>> must work if it's on the %PATH%, but if all else fails, setting this
>> environment variable should help.
>> 
>>> If it is where can I find the answers to questions about how R
>>> accepts Windows paths? Do I need to enclose parts of names containing
>>> spaces in "" signs?
>> 
>> It always depends on how the final command line is built by a
>> particular function, but it should work by taking plain file paths
>> without any escaping and quotation. The directory separators shouldn't
>> matter either.
>> 
>> (tools::compactPDF uses system2(), so it quotes the path to the
>> executable by itself.)
>> 
>>> Does it mean the path up to, in this case, bin or must I include
>>> qpdf.exe after it?
>> 
>> It must be the full path to the executable, including the final
>> qpdf.exe.
>> 
>>> I assume I do not need to do anything special to get it to find
>>> Ghostscript?
>> 
>> tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
>> If it's not there, R_GSCMD must be set to the full path to the
>> executable. Judging by the NOTE you've received, it's Ghostscript that
>> performed most of the compaction in your case.
>> 
>

-- 
Sent from my phone. Please excuse my brevity.


From kke@h@v @end|ng |rom u||@edu  Mon Oct  9 20:59:05 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Mon, 9 Oct 2023 18:59:05 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
Message-ID: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>

Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Oct  9 22:08:43 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 9 Oct 2023 16:08:43 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>

What were you using as "outdir"?


On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
> Hi,
> 
> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
> 
>    if (is.null(outdir) || length(outdir) == 0) {
>      outdir <- tempdir()
>    }
> 
>    # Save the plot as a raster file
>    fp <- file.path(outdir, paste("plots", "/",
>                                  typ, "_",
>                                  stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>                                  ".tif", sep = ""))
>      # Create the "plots" directory if it doesn't exist
>    if (!dir.exists(fp)) {
>      dir.create(fp, recursive = TRUE)
>    }
> 
>    terra::writeRaster(rast, overwrite = TRUE,
>                       filename = fp,
>                       gdal = c("COMPRESS=NONE"))
>    message(paste("raster created", fp, sep = ": "), "\n")
> }
> 
> Error ?V
> 
>    Error: [writeRaster] cannot write file
>     12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>     13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     15.             ?|?wterra (local) .local(x, filename, ...)
>     16.               ?|?wterra:::messages(x, "writeRaster")
>     17.                 ?|?wterra:::error(f, x at pnt$getError())
> 
> 
> 
> Best Regards,
> Krishna Keshav
> 
> 	[[alternative HTML version deleted]]
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From berryboe@@enkoo| @end|ng |rom hotm@||@com  Mon Oct  9 22:13:15 2023
From: berryboe@@enkoo| @end|ng |rom hotm@||@com (Berry Boessenkool)
Date: Mon, 9 Oct 2023 20:13:15 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <GV2PR02MB877038BD348BA8712953B3EAD5CEA@GV2PR02MB8770.eurprd02.prod.outlook.com>


Are you intentionally running dir.exists on _file_names?
dir.exists("existing_folder/imaginary.file") shows FALSE, somwhat counterintuitively.
You might want to wrap the filenames in dirname...

Regards,
Berry
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Keshav, Krishna <kkeshav at ufl.edu>
Sent: Monday, October 9, 2023 20:59
To: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file

Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

        [[alternative HTML version deleted]]


	[[alternative HTML version deleted]]


From kke@h@v @end|ng |rom u||@edu  Tue Oct 10 00:56:50 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Mon, 9 Oct 2023 22:56:50 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
Message-ID: <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>

Outdir is either a directory like getwd(), tempdir() etc or empty/null. If it is empty/null, then I set it to tempdir().

if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
}
I am not sure how to debug when running it in Rbuilder. But you can look at results here - https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5

Best Regards,
Krishna Keshav

From: Duncan Murdoch <murdoch.duncan at gmail.com>
Date: Monday, October 9, 2023 at 4:08 PM
To: Keshav, Krishna <kkeshav at ufl.edu>, r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Error: [writeRaster] cannot write file
[External Email]

What were you using as "outdir"?


On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
> Hi,
>
> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
>
>    if (is.null(outdir) || length(outdir) == 0) {
>      outdir <- tempdir()
>    }
>
>    # Save the plot as a raster file
>    fp <- file.path(outdir, paste("plots", "/",
>                                  typ, "_",
>                                  stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>                                  ".tif", sep = ""))
>      # Create the "plots" directory if it doesn't exist
>    if (!dir.exists(fp)) {
>      dir.create(fp, recursive = TRUE)
>    }
>
>    terra::writeRaster(rast, overwrite = TRUE,
>                       filename = fp,
>                       gdal = c("COMPRESS=NONE"))
>    message(paste("raster created", fp, sep = ": "), "\n")
> }
>
> Error ?V
>
>    Error: [writeRaster] cannot write file
>     12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>     13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     15.             ?|?wterra (local) .local(x, filename, ...)
>     16.               ?|?wterra:::messages(x, "writeRaster")
>     17.                 ?|?wterra:::error(f, x at pnt$getError())
>
>
>
> Best Regards,
> Krishna Keshav
>
>       [[alternative HTML version deleted]]
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Ckkeshav%40ufl.edu%7Cddd83781762040d664dc08dbc9038ec7%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638324789348072931%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=mBzV%2BSJoOTTnSpRzu0EvLT8sZ2NJ1OlhSGXqNCvGWB4%3D&reserved=0<https://stat.ethz.ch/mailman/listinfo/r-package-devel>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 10 01:16:17 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 9 Oct 2023 19:16:17 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
 <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <c0c1ff56-b2ab-4810-a897-265ba52ba28b@gmail.com>

On 09/10/2023 6:56 p.m., Keshav, Krishna wrote:
> Outdir is either a directory like getwd(), tempdir() etc or empty/null. 
> If it is empty/null, then I set it to tempdir().

That doesn't answer the question, and the link you provided doesn't 
answer it either, as far as I can see.  In the test and the vignette 
that generated the errors, something specific was passed as outdir.  But 
what? If it was getwd(), that's bound to fail -- you don't have 
permission to write there.  tempdir() should have worked, but Berry 
pointed out some other things that might be problems.

Duncan Murdoch

> 
> /if (is.null(outdir) || length(outdir) == 0) {
>  ??? outdir <- tempdir()/
> 
> /}///
> 
> I am not sure how to debug when running it in Rbuilder. But you can look 
> at results here - 
> https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5 <https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5>
> 
> Best Regards,
> 
> Krishna Keshav
> 
> *From: *Duncan Murdoch <murdoch.duncan at gmail.com>
> *Date: *Monday, October 9, 2023 at 4:08 PM
> *To: *Keshav, Krishna <kkeshav at ufl.edu>, r-package-devel at r-project.org 
> <r-package-devel at r-project.org>
> *Subject: *Re: [R-pkg-devel] Error: [writeRaster] cannot write file
> 
> [External Email]
> 
> What were you using as "outdir"?
> 
> 
> On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
>> Hi,
>>
>> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
>> Snippet ?V
>> .saverast <- function(typ, rast, outdir) {
>>
>>??? if (is.null(outdir) || length(outdir) == 0) {
>>????? outdir <- tempdir()
>>??? }
>>
>>??? # Save the plot as a raster file
>>??? fp <- file.path(outdir, paste("plots", "/",
>>????????????????????????????????? typ, "_",
>>????????????????????????????????? stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>>????????????????????????????????? ".tif", sep = ""))
>>????? # Create the "plots" directory if it doesn't exist
>>??? if (!dir.exists(fp)) {
>>????? dir.create(fp, recursive = TRUE)
>>??? }
>>
>>??? terra::writeRaster(rast, overwrite = TRUE,
>>?????????????????????? filename = fp,
>>?????????????????????? gdal = c("COMPRESS=NONE"))
>>??? message(paste("raster created", fp, sep = ": "), "\n")
>> }
>>
>> Error ?V
>>
>>??? Error: [writeRaster] cannot write file
>>???? 12.???????? ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>>???? 13.?????????? ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>>???? 14.?????????? ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>>???? 15.???????????? ?|?wterra (local) .local(x, filename, ...)
>>???? 16.?????????????? ?|?wterra:::messages(x, "writeRaster")
>>???? 17.???????????????? ?|?wterra:::error(f, x at pnt$getError())
>>
>>
>>
>> Best Regards,
>> Krishna Keshav
>>
>>?????? [[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Ckkeshav%40ufl.edu%7Cddd83781762040d664dc08dbc9038ec7%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638324789348072931%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=mBzV%2BSJoOTTnSpRzu0EvLT8sZ2NJ1OlhSGXqNCvGWB4%3D&reserved=0 <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From |kw@|mmo @end|ng |rom gm@||@com  Tue Oct 10 01:36:44 2023
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Mon, 9 Oct 2023 19:36:44 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>

You wrote

# create the plots directory if it does not exist

but then created a directory named outdir/plots/typ_Sys.time.tif

You need to rewrite the code like:

plotsdir <- file.path(outdir, "plots")
fp <- file.path(plotsdir,  paste(typ, "_",
    stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
# Create the "plots" directory if it doesn't exist
  if (!dir.exists(plotsdir)) {
    dir.create(plotsdir, recursive = TRUE)
  }

On Mon, Oct 9, 2023, 15:49 Keshav, Krishna <kkeshav at ufl.edu> wrote:

> Hi,
>
> I am developing an R package where I need to save Raster file with .tif
> extension to the tempdir(). I am using terra::writeRaster for the same.
> While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
>
>   if (is.null(outdir) || length(outdir) == 0) {
>     outdir <- tempdir()
>   }
>
>   # Save the plot as a raster file
>   fp <- file.path(outdir, paste("plots", "/",
>                                 typ, "_",
>                                 stringr::str_replace_all(Sys.time(),
> "[^a-zA-Z0-9]", ""),
>                                 ".tif", sep = ""))
>     # Create the "plots" directory if it doesn't exist
>   if (!dir.exists(fp)) {
>     dir.create(fp, recursive = TRUE)
>   }
>
>   terra::writeRaster(rast, overwrite = TRUE,
>                      filename = fp,
>                      gdal = c("COMPRESS=NONE"))
>   message(paste("raster created", fp, sep = ": "), "\n")
> }
>
> Error ?V
>
>   Error: [writeRaster] cannot write file
>    12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>    13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename =
> fp, gdal = c("COMPRESS=NONE"))
>    14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename =
> fp, gdal = c("COMPRESS=NONE"))
>    15.             ?|?wterra (local) .local(x, filename, ...)
>    16.               ?|?wterra:::messages(x, "writeRaster")
>    17.                 ?|?wterra:::error(f, x at pnt$getError())
>
>
>
> Best Regards,
> Krishna Keshav
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From kke@h@v @end|ng |rom u||@edu  Tue Oct 10 02:30:36 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Tue, 10 Oct 2023 00:30:36 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>
Message-ID: <CO6PR22MB2433A9762FB9A549590D9ECEB6CDA@CO6PR22MB2433.namprd22.prod.outlook.com>

Hi,

This works. I think this is also an implementation of what Berry and Duncan suggested earlier. Thanks.

Best Regards,
Krishna Keshav

From: Iris Simmons <ikwsimmo at gmail.com>
Date: Monday, October 9, 2023 at 7:37 PM
To: Keshav, Krishna <kkeshav at ufl.edu>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Error: [writeRaster] cannot write file
[External Email]
You wrote

# create the plots directory if it does not exist

but then created a directory named outdir/plots/typ_Sys.time.tif

You need to rewrite the code like:

plotsdir <- file.path(outdir, "plots")
fp <- file.path(plotsdir,  paste(typ, "_",
    stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
# Create the "plots" directory if it doesn't exist
  if (!dir.exists(plotsdir)) {
    dir.create(plotsdir, recursive = TRUE)
  }

On Mon, Oct 9, 2023, 15:49 Keshav, Krishna <kkeshav at ufl.edu<mailto:kkeshav at ufl.edu>> wrote:
Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org<mailto:R-package-devel at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From cdr|ver@@u@ @end|ng |rom gm@||@com  Tue Oct 10 16:36:31 2023
From: cdr|ver@@u@ @end|ng |rom gm@||@com (Charles Driver)
Date: Tue, 10 Oct 2023 16:36:31 +0200
Subject: [R-pkg-devel] pkg check: SyntaxError: break must be inside loop or
 switch
Message-ID: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>

R-under-devel via winbuilder is giving me the following note, for the
ctsem package. I have no idea what it refers to -- I chased down the
few instances of using the break function in my package and reworked
the code to get rid of them, but didn't help. Any clues, or idea why
this note is so uninformative, would be welcome...

* checking data for non-ASCII characters ... NOTE
  SyntaxError: break must be inside loop or switch
      at :2513

Cheers,
Charles


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct 11 09:40:32 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 11 Oct 2023 10:40:32 +0300
Subject: [R-pkg-devel] 
 pkg check: SyntaxError: break must be inside loop or switch
In-Reply-To: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>
References: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>
Message-ID: <20231011104032.47cd0f47@Tarkus>

? Tue, 10 Oct 2023 16:36:31 +0200
Charles Driver <cdriver.aus at gmail.com> ?????:

>   SyntaxError: break must be inside loop or switch

This looks like an error coming from a JavaScript engine or from a
JavaScript-derived language:

https://github.com/blld/libecc/blob/88877a46ba9b0a47567aa999a4380b9e793783a8/src/main.c#L714
https://github.com/ynezz/openwrt-ucode/blob/5163867269fc04fa01ec5e9f8df3384c933339f2/compiler.c#L2930https://github.com/Bobris/Njsast/blob/930f59a9694432580a7b1367680c56672cfe4cd2/Njsast/Compress/LoopControlFinderTreeWalker.cs#L34

(Most modern implementations say "_unlabeled_ break must be inside loop
or switch", but this may come from an older version.)

This seems to have nothing to do with Stan either; at the very least I
cannot find this exact error message in https://github.com/stan-dev.
When R complains about a wrongly placed `break`, it also looks
differently:

break
# Error: no loop for break/next, jumping to top level

An infrastructure hiccup on Win-Builder? 

-- 
Best regards,
Ivan


From tony_@_w||ke@ @end|ng |rom out|ook@com  Wed Oct 11 09:06:40 2023
From: tony_@_w||ke@ @end|ng |rom out|ook@com (Tony Wilkes)
Date: Wed, 11 Oct 2023 07:06:40 +0000
Subject: [R-pkg-devel] Question regarding CRAN submission with notes
Message-ID: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>

Dear all,

I'm trying to publish an R package to CRAN. Their checks come back with 2 NOTES. The first one is saying that the package is a new submission, and the second one is that there is a subdirectory with a package inside my package. Both notes are correct. I have explained in my submission comments that this is indeed a new submission. I also gave the following explanation for the second note in my submission comments: "There is 1 NOTE given by the R CMD check results. This is due to the fact that I have placed fake libraries with fake packages inside the "inst/tinytest/" folder. This was necessary to test the various import-system related functions in my package. As stated, these are fake packages, and only contain trivial functions of no consequence. These fake libraries with fake packages ONLY exist because it is necessary for proper and extensive unit testing, that is all."

They asked me to fix these notes a few days ago. I replied (politely) repeating my comments a few days ago. I have not heard back from CRAN since. I am assuming that I am missing something, but CRAN won't explain what exactly I am missing.

Here are the NOTES:
Windows: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FWindows%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Xh6fZd6iQjW6AOFtCAwwzhNO%2B5vyCh%2Fy5%2FEi25z7D%2Fg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Windows/00check.log>>
Status: 1 NOTE
Debian: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FDebian%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=0jOFqYf9Ar%2FBp1YVSZjfRHRdChzGPi5lSSuyLT2HAoM%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Debian/00check.log>>
Status: 2 NOTEs

More details are given in the directory:
<https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2F&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=73zTGLwQVRlTMnk20rbgTBOn5dCdu16y%2BmhlLS8GIpg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/>>

Could anyone tell me what exactly I'm doing wrong? Thank you in advance.

Kind regards,

Tony

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Oct 11 16:01:13 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 11 Oct 2023 16:01:13 +0200
Subject: [R-pkg-devel] Question regarding CRAN submission with notes
In-Reply-To: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <c5e6811a-cd19-980d-ea52-eee362aee0dd@statistik.tu-dortmund.de>

This is under discussion with the CRAN team now.

Best,
Uwe Ligges


On 11.10.2023 09:06, Tony Wilkes wrote:
> Dear all,
> 
> I'm trying to publish an R package to CRAN. Their checks come back with 2 NOTES. The first one is saying that the package is a new submission, and the second one is that there is a subdirectory with a package inside my package. Both notes are correct. I have explained in my submission comments that this is indeed a new submission. I also gave the following explanation for the second note in my submission comments: "There is 1 NOTE given by the R CMD check results. This is due to the fact that I have placed fake libraries with fake packages inside the "inst/tinytest/" folder. This was necessary to test the various import-system related functions in my package. As stated, these are fake packages, and only contain trivial functions of no consequence. These fake libraries with fake packages ONLY exist because it is necessary for proper and extensive unit testing, that is all."
> 
> They asked me to fix these notes a few days ago. I replied (politely) repeating my comments a few days ago. I have not heard back from CRAN since. I am assuming that I am missing something, but CRAN won't explain what exactly I am missing.
> 
> Here are the NOTES:
> Windows: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FWindows%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Xh6fZd6iQjW6AOFtCAwwzhNO%2B5vyCh%2Fy5%2FEi25z7D%2Fg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Windows/00check.log>>
> Status: 1 NOTE
> Debian: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FDebian%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=0jOFqYf9Ar%2FBp1YVSZjfRHRdChzGPi5lSSuyLT2HAoM%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Debian/00check.log>>
> Status: 2 NOTEs
> 
> More details are given in the directory:
> <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2F&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=73zTGLwQVRlTMnk20rbgTBOn5dCdu16y%2BmhlLS8GIpg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/>>
> 
> Could anyone tell me what exactly I'm doing wrong? Thank you in advance.
> 
> Kind regards,
> 
> Tony
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Oct 11 16:04:38 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 11 Oct 2023 10:04:38 -0400
Subject: [R-pkg-devel] Question regarding CRAN submission with notes
In-Reply-To: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <91cad114-b6e7-418b-9de0-82890c81a333@gmail.com>

The note says it contains "an installed version" of the package, 
presumably referring to your test package.

I think you shouldn't do that.  For a trivial package it might be true 
that the installed version is the same on all systems, but it won't 
continue to be as the installation code evolves.

What you could try is to include files that would let you install the 
test package into a library under tempdir().  Your tests would start by 
installing the test package there, then run the tests, then clean up 
afterwards.

It's possible the tests will still complain about that, in which case 
I'd go one step further back, and write a function to create the source 
package, rather than including it.  For example, have a file 
DESCRIPTION.txt which your test renames to DESCRIPTION, etc.

Duncan Murdoch



On 11/10/2023 3:06 a.m., Tony Wilkes wrote:
> Dear all,
> 
> I'm trying to publish an R package to CRAN. Their checks come back with 2 NOTES. The first one is saying that the package is a new submission, and the second one is that there is a subdirectory with a package inside my package. Both notes are correct. I have explained in my submission comments that this is indeed a new submission. I also gave the following explanation for the second note in my submission comments: "There is 1 NOTE given by the R CMD check results. This is due to the fact that I have placed fake libraries with fake packages inside the "inst/tinytest/" folder. This was necessary to test the various import-system related functions in my package. As stated, these are fake packages, and only contain trivial functions of no consequence. These fake libraries with fake packages ONLY exist because it is necessary for proper and extensive unit testing, that is all."
> 
> They asked me to fix these notes a few days ago. I replied (politely) repeating my comments a few days ago. I have not heard back from CRAN since. I am assuming that I am missing something, but CRAN won't explain what exactly I am missing.
> 
> Here are the NOTES:
> Windows: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FWindows%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Xh6fZd6iQjW6AOFtCAwwzhNO%2B5vyCh%2Fy5%2FEi25z7D%2Fg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Windows/00check.log>>
> Status: 1 NOTE
> Debian: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FDebian%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=0jOFqYf9Ar%2FBp1YVSZjfRHRdChzGPi5lSSuyLT2HAoM%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Debian/00check.log>>
> Status: 2 NOTEs
> 
> More details are given in the directory:
> <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2F&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=73zTGLwQVRlTMnk20rbgTBOn5dCdu16y%2BmhlLS8GIpg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/>>
> 
> Could anyone tell me what exactly I'm doing wrong? Thank you in advance.
> 
> Kind regards,
> 
> Tony
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@c@rtwr|ght @end|ng |rom gm@||@com  Thu Oct 12 04:51:55 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 11 Oct 2023 19:51:55 -0700
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
Message-ID: <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>

Update: I submitted a new version of the package, but it did not fix the
issue. The package has now been archived and I do not have access to the
error log output anymore from r-devel-linux-x86_64-fedora-clang.

I did reproduce CRAN's configuration in a VM using the information provided
by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot reproduce the
error and at this point I believe that there is a chance that CRAN's
machine is misconfigured.

The specific error happens after rbedrock has been compiled and linked
successfully. The specific error is that the symbol
_ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
to be happening to cause the error is that Clang++ 17 is adding a reference
to this symbol when compiling and linking rbedrock.so but the dynamic
linker is loading an older version of libc++.so when trying to load
rbedrock.so and the symbol is not found.

If this is the cause, then I think that the CRAN machine needs to configure
the dynamic linker to use the Clang++ 17 libc++.so, or add the proper
command line options to R's config variables.

It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
fine and I've missed something, and I would be happy if someone could help
me figure out what it is.

Also, a new issue cropped up when 0.3.1 was tested on the
r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
an archive. The other Mac versions did fine, so I'm not sure if this is a
random error or something related to my package. The error log is here:
https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html

If anyone can help me resolve this, I'd appreciate it.


On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
wrote:

> Is there any way to submit packages directly to the CRAN's clang17 setup?
> I can enable verbose output for CMake and compare the output, but I'd
> rather not clog up the CRAN incoming queue just to debug a linker error?
>
> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <simon.urbanek at r-project.org>
> wrote:
>
>> It looks like a C++ run-time mismatch between what cmake is using to
>> build the static library and what is used by R. Unfortunately, cmake hides
>> the actual compiler calls so it's hard to tell the difference, but that
>> setup relies on the correct sequence of library paths.
>>
>> The rhub manually forces -stdlib=libc++ to all its CXX flags
>>
>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
>> so it is quite different from the gannet tests-clang-trunk setup (also
>> note the different library paths), but that's not something you can do
>> universally in the package, because it strongly depends on the toolchain
>> setup.
>>
>> Cheers,
>> Simon
>>
>>
>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
>> wrote:
>> >
>> > I was unable to reproduce the error on the rhub's clang17 docker image.
>> >
>> > I notice that the linking command is slightly different between systems.
>> > And this suggests that I need to find some way to get CRAN to pass
>> -stdlib
>> > flag at the linking stage.
>> >
>> > CRAN:
>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
>> -L/usr/local/gcc13/lib64
>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>> init.o
>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>> > -pthread -lleveldb -lz
>> >
>> > RHUB:
>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>> init.o
>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
>> >
>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
>> > wrote:
>> >
>> >> You might be able to reproduce it with the clang17 container here:
>> >>
>> >>
>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
>> >> You can either run it directly or with the rhub2 package:
>> >>
>> >>
>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
>> >>
>> >> Gabor
>> >>
>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
>> >> <racartwright at gmail.com> wrote:
>> >>>
>> >>> My package, RBedrock, is now throwing an error when compiled against
>> >>> Clang17. The error log is here:
>> >>>
>> >>>
>> >>
>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
>> >>>
>> >>> The important part is
>> >>> """
>> >>> Error: package or namespace load failed for ?rbedrock? in
>> dyn.load(file,
>> >>> DLLpath = DLLpath, ...):
>> >>> unable to load shared object
>> >>>
>> >>
>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
>> >>>
>> >>>
>> >>
>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
>> >>> Error: loading failed
>> >>> """
>> >>>
>> >>> From what I can gather through googling, this error can be caused by
>> >> using
>> >>> the C linker when one of the dependent libraries is a C++ library.
>> >>>
>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
>> >>> clang17 setup (less likely).
>> >>>
>> >>> Background about the package: rbedrock is written in C but links
>> against
>> >> a
>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
>> functions. I
>> >>> use a dummy .cpp file in the source directory to trigger R into using
>> the
>> >>> C++ linker. That does still seem to be happening according to the log.
>> >>>
>> >>> Has anyone seen this before and know where I should start looking to
>> fix
>> >> it?
>> >>>
>> >>> Thanks.
>> >>>
>> >>> --
>> >>> Reed A. Cartwright, PhD
>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
>> >>> School of Life Sciences and The Biodesign Institute
>> >>> Arizona State University
>> >>> ==================
>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ 85287-6401
>> USA
>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
>> >>> 85287-6401 USA
>> >>> Office: Biodesign B-220C, 1-480-965-9949
>> >>> Website:
>> >>
>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
>> >>>
>> >>>        [[alternative HTML version deleted]]
>> >>>
>> >>> ______________________________________________
>> >>> R-package-devel at r-project.org mailing list
>> >>>
>> >>
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
>> >>
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> >
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
>> >
>>
>>

	[[alternative HTML version deleted]]


From r@c@rtwr|ght @end|ng |rom gm@||@com  Thu Oct 12 04:54:19 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 11 Oct 2023 19:54:19 -0700
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
Message-ID: <CALOkxuw3cf31BrT0yFyqVMXD815qjEVATbTBVToE3+SqLO=+wQ@mail.gmail.com>

Also the most recent source code tested by CRAN is here:

https://github.com/reedacartwright/rbedrock/tree/v0.3.1

On Wed, Oct 11, 2023 at 7:51?PM Reed A. Cartwright <racartwright at gmail.com>
wrote:

> Update: I submitted a new version of the package, but it did not fix the
> issue. The package has now been archived and I do not have access to the
> error log output anymore from r-devel-linux-x86_64-fedora-clang.
>
> I did reproduce CRAN's configuration in a VM using the information
> provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot
> reproduce the error and at this point I believe that there is a chance that
> CRAN's machine is misconfigured.
>
> The specific error happens after rbedrock has been compiled and linked
> successfully. The specific error is that the symbol
> _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
> loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
> to be happening to cause the error is that Clang++ 17 is adding a reference
> to this symbol when compiling and linking rbedrock.so but the dynamic
> linker is loading an older version of libc++.so when trying to load
> rbedrock.so and the symbol is not found.
>
> If this is the cause, then I think that the CRAN machine needs to
> configure the dynamic linker to use the Clang++ 17 libc++.so, or add the
> proper command line options to R's config variables.
>
> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
> fine and I've missed something, and I would be happy if someone could help
> me figure out what it is.
>
> Also, a new issue cropped up when 0.3.1 was tested on the
> r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
> an archive. The other Mac versions did fine, so I'm not sure if this is a
> random error or something related to my package. The error log is here:
> https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html
>
> If anyone can help me resolve this, I'd appreciate it.
>
>
> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
> wrote:
>
>> Is there any way to submit packages directly to the CRAN's clang17 setup?
>> I can enable verbose output for CMake and compare the output, but I'd
>> rather not clog up the CRAN incoming queue just to debug a linker error?
>>
>> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <
>> simon.urbanek at r-project.org> wrote:
>>
>>> It looks like a C++ run-time mismatch between what cmake is using to
>>> build the static library and what is used by R. Unfortunately, cmake hides
>>> the actual compiler calls so it's hard to tell the difference, but that
>>> setup relies on the correct sequence of library paths.
>>>
>>> The rhub manually forces -stdlib=libc++ to all its CXX flags
>>>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
>>> so it is quite different from the gannet tests-clang-trunk setup (also
>>> note the different library paths), but that's not something you can do
>>> universally in the package, because it strongly depends on the toolchain
>>> setup.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
>>> wrote:
>>> >
>>> > I was unable to reproduce the error on the rhub's clang17 docker image.
>>> >
>>> > I notice that the linking command is slightly different between
>>> systems.
>>> > And this suggests that I need to find some way to get CRAN to pass
>>> -stdlib
>>> > flag at the linking stage.
>>> >
>>> > CRAN:
>>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
>>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
>>> -L/usr/local/gcc13/lib64
>>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz
>>> >
>>> > RHUB:
>>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
>>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
>>> >
>>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
>>> > wrote:
>>> >
>>> >> You might be able to reproduce it with the clang17 container here:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
>>> >> You can either run it directly or with the rhub2 package:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
>>> >>
>>> >> Gabor
>>> >>
>>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
>>> >> <racartwright at gmail.com> wrote:
>>> >>>
>>> >>> My package, RBedrock, is now throwing an error when compiled against
>>> >>> Clang17. The error log is here:
>>> >>>
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
>>> >>>
>>> >>> The important part is
>>> >>> """
>>> >>> Error: package or namespace load failed for ?rbedrock? in
>>> dyn.load(file,
>>> >>> DLLpath = DLLpath, ...):
>>> >>> unable to load shared object
>>> >>>
>>> >>
>>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
>>> >>>
>>> >>>
>>> >>
>>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
>>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
>>> >>> Error: loading failed
>>> >>> """
>>> >>>
>>> >>> From what I can gather through googling, this error can be caused by
>>> >> using
>>> >>> the C linker when one of the dependent libraries is a C++ library.
>>> >>>
>>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
>>> >>> clang17 setup (less likely).
>>> >>>
>>> >>> Background about the package: rbedrock is written in C but links
>>> against
>>> >> a
>>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
>>> functions. I
>>> >>> use a dummy .cpp file in the source directory to trigger R into
>>> using the
>>> >>> C++ linker. That does still seem to be happening according to the
>>> log.
>>> >>>
>>> >>> Has anyone seen this before and know where I should start looking to
>>> fix
>>> >> it?
>>> >>>
>>> >>> Thanks.
>>> >>>
>>> >>> --
>>> >>> Reed A. Cartwright, PhD
>>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
>>> >>> School of Life Sciences and The Biodesign Institute
>>> >>> Arizona State University
>>> >>> ==================
>>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ
>>> 85287-6401 USA
>>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
>>> >>> 85287-6401 USA
>>> >>> Office: Biodesign B-220C, 1-480-965-9949
>>> >>> Website:
>>> >>
>>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
>>> >>>
>>> >>>        [[alternative HTML version deleted]]
>>> >>>
>>> >>> ______________________________________________
>>> >>> R-package-devel at r-project.org mailing list
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
>>> >>
>>> > ______________________________________________
>>> > R-package-devel at r-project.org mailing list
>>> >
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
>>> >
>>>
>>>

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Thu Oct 12 07:22:04 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Thu, 12 Oct 2023 18:22:04 +1300
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
Message-ID: <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>

Reed,

please contact CRAN - this list can only help with general developer's questions, not specific issues with a particular CRAN setup - only the corresponding member of CRAN running the setup can help. I don't see anything obvious - we can see that it's a mismatch of run-times between the cmake build and the R linking, but from the package alone it's not clear to me why.

Cheers,
Simon


> On Oct 12, 2023, at 3:51 PM, Reed A. Cartwright <racartwright at gmail.com> wrote:
> 
> Update: I submitted a new version of the package, but it did not fix the issue. The package has now been archived and I do not have access to the error log output anymore from r-devel-linux-x86_64-fedora-clang.
> 
> I did reproduce CRAN's configuration in a VM using the information provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot reproduce the error and at this point I believe that there is a chance that CRAN's machine is misconfigured.
> 
> The specific error happens after rbedrock has been compiled and linked successfully. The specific error is that the symbol _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe to be happening to cause the error is that Clang++ 17 is adding a reference to this symbol when compiling and linking rbedrock.so but the dynamic linker is loading an older version of libc++.so when trying to load rbedrock.so and the symbol is not found.
> 
> If this is the cause, then I think that the CRAN machine needs to configure the dynamic linker to use the Clang++ 17 libc++.so, or add the proper command line options to R's config variables.
> 
> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is fine and I've missed something, and I would be happy if someone could help me figure out what it is.
> 
> Also, a new issue cropped up when 0.3.1 was tested on the r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce an archive. The other Mac versions did fine, so I'm not sure if this is a random error or something related to my package. The error log is here: https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html <https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html>
> 
> If anyone can help me resolve this, I'd appreciate it.
> 
> 
> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com <mailto:racartwright at gmail.com>> wrote:
> Is there any way to submit packages directly to the CRAN's clang17 setup? I can enable verbose output for CMake and compare the output, but I'd rather not clog up the CRAN incoming queue just to debug a linker error?
> 
> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <simon.urbanek at r-project.org <mailto:simon.urbanek at r-project.org>> wrote:
> It looks like a C++ run-time mismatch between what cmake is using to build the static library and what is used by R. Unfortunately, cmake hides the actual compiler calls so it's hard to tell the difference, but that setup relies on the correct sequence of library paths.
> 
> The rhub manually forces -stdlib=libc++ to all its CXX flags
> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$ <https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$> 
> so it is quite different from the gannet tests-clang-trunk setup (also note the different library paths), but that's not something you can do universally in the package, because it strongly depends on the toolchain setup.
> 
> Cheers,
> Simon
> 
> 
> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com <mailto:racartwright at gmail.com>> wrote:
> > 
> > I was unable to reproduce the error on the rhub's clang17 docker image.
> > 
> > I notice that the linking command is slightly different between systems.
> > And this suggests that I need to find some way to get CRAN to pass -stdlib
> > flag at the linking stage.
> > 
> > CRAN:
> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib -L/usr/local/gcc13/lib64
> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o init.o
> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
> > -pthread -lleveldb -lz
> > 
> > RHUB:
> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o init.o
> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
> > 
> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com <mailto:csardi.gabor at gmail.com>>
> > wrote:
> > 
> >> You might be able to reproduce it with the clang17 container here:
> >> 
> >> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$ <https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$>
> >> You can either run it directly or with the rhub2 package:
> >> 
> >> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$ <https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$>
> >> 
> >> Gabor
> >> 
> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
> >> <racartwright at gmail.com <mailto:racartwright at gmail.com>> wrote:
> >>> 
> >>> My package, RBedrock, is now throwing an error when compiled against
> >>> Clang17. The error log is here:
> >>> 
> >>> 
> >> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$ <https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$>
> >>> 
> >>> The important part is
> >>> """
> >>> Error: package or namespace load failed for ?rbedrock? in dyn.load(file,
> >>> DLLpath = DLLpath, ...):
> >>> unable to load shared object
> >>> 
> >> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
> >>> 
> >>> 
> >> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
> >>> Error: loading failed
> >>> """
> >>> 
> >>> From what I can gather through googling, this error can be caused by
> >> using
> >>> the C linker when one of the dependent libraries is a C++ library.
> >>> 
> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
> >>> clang17 setup (less likely).
> >>> 
> >>> Background about the package: rbedrock is written in C but links against
> >> a
> >>> C++ library (Mojang's leveldb fork)  via the library's C-API functions. I
> >>> use a dummy .cpp file in the source directory to trigger R into using the
> >>> C++ linker. That does still seem to be happening according to the log.
> >>> 
> >>> Has anyone seen this before and know where I should start looking to fix
> >> it?
> >>> 
> >>> Thanks.
> >>> 
> >>> --
> >>> Reed A. Cartwright, PhD
> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
> >>> School of Life Sciences and The Biodesign Institute
> >>> Arizona State University
> >>> ==================
> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ 85287-6401 USA
> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
> >>> 85287-6401 USA
> >>> Office: Biodesign B-220C, 1-480-965-9949
> >>> Website:
> >> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$ <https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$>
> >>> 
> >>>        [[alternative HTML version deleted]]
> >>> 
> >>> ______________________________________________
> >>> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
> >>> 
> >> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$ <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$>
> >> 
> > ______________________________________________
> > R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
> > https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$ <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$> 
> > 
> 


	[[alternative HTML version deleted]]


From r@c@rtwr|ght @end|ng |rom gm@||@com  Thu Oct 12 07:25:35 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 11 Oct 2023 22:25:35 -0700
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
 <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>
Message-ID: <CALOkxuxSOOiPkZLSNim58-3eYvqirnZge0tJdG=TkZJJiCfsTQ@mail.gmail.com>

Okay, I'll reach out to the CRAN team shortly.

I wanted to run it by the group here first because my interactions with the
CRAN team haven't always been positive and I need to make sure that I'm not
missing something "obvious".

On Wed, Oct 11, 2023, 22:22 Simon Urbanek <simon.urbanek at r-project.org>
wrote:

> Reed,
>
> please contact CRAN - this list can only help with general developer's
> questions, not specific issues with a particular CRAN setup - only the
> corresponding member of CRAN running the setup can help. I don't see
> anything obvious - we can see that it's a mismatch of run-times between the
> cmake build and the R linking, but from the package alone it's not clear to
> me why.
>
> Cheers,
> Simon
>
>
> On Oct 12, 2023, at 3:51 PM, Reed A. Cartwright <racartwright at gmail.com>
> wrote:
>
> Update: I submitted a new version of the package, but it did not fix the
> issue. The package has now been archived and I do not have access to the
> error log output anymore from r-devel-linux-x86_64-fedora-clang.
>
> I did reproduce CRAN's configuration in a VM using the information
> provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot
> reproduce the error and at this point I believe that there is a chance that
> CRAN's machine is misconfigured.
>
> The specific error happens after rbedrock has been compiled and linked
> successfully. The specific error is that the symbol
> _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
> loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
> to be happening to cause the error is that Clang++ 17 is adding a reference
> to this symbol when compiling and linking rbedrock.so but the dynamic
> linker is loading an older version of libc++.so when trying to load
> rbedrock.so and the symbol is not found.
>
> If this is the cause, then I think that the CRAN machine needs to
> configure the dynamic linker to use the Clang++ 17 libc++.so, or add the
> proper command line options to R's config variables.
>
> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
> fine and I've missed something, and I would be happy if someone could help
> me figure out what it is.
>
> Also, a new issue cropped up when 0.3.1 was tested on the
> r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
> an archive. The other Mac versions did fine, so I'm not sure if this is a
> random error or something related to my package. The error log is here:
> https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html
> <https://urldefense.com/v3/__https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html__;!!IKRxdwAv5BmarQ!bn6F_bNAOxSfAFbevyOMVGtmTQT-u-wuccyvwupscx__4Spd0Z8C0FoUWbCPQ8QfDC_9g64_bzdKRZTTqo2U99WvIfoR$>
>
> If anyone can help me resolve this, I'd appreciate it.
>
>
> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
> wrote:
>
>> Is there any way to submit packages directly to the CRAN's clang17 setup?
>> I can enable verbose output for CMake and compare the output, but I'd
>> rather not clog up the CRAN incoming queue just to debug a linker error?
>>
>> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <
>> simon.urbanek at r-project.org> wrote:
>>
>>> It looks like a C++ run-time mismatch between what cmake is using to
>>> build the static library and what is used by R. Unfortunately, cmake hides
>>> the actual compiler calls so it's hard to tell the difference, but that
>>> setup relies on the correct sequence of library paths.
>>>
>>> The rhub manually forces -stdlib=libc++ to all its CXX flags
>>>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
>>> so it is quite different from the gannet tests-clang-trunk setup (also
>>> note the different library paths), but that's not something you can do
>>> universally in the package, because it strongly depends on the toolchain
>>> setup.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
>>> wrote:
>>> >
>>> > I was unable to reproduce the error on the rhub's clang17 docker image.
>>> >
>>> > I notice that the linking command is slightly different between
>>> systems.
>>> > And this suggests that I need to find some way to get CRAN to pass
>>> -stdlib
>>> > flag at the linking stage.
>>> >
>>> > CRAN:
>>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
>>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
>>> -L/usr/local/gcc13/lib64
>>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz
>>> >
>>> > RHUB:
>>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
>>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
>>> >
>>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
>>> > wrote:
>>> >
>>> >> You might be able to reproduce it with the clang17 container here:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
>>> >> You can either run it directly or with the rhub2 package:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
>>> >>
>>> >> Gabor
>>> >>
>>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
>>> >> <racartwright at gmail.com> wrote:
>>> >>>
>>> >>> My package, RBedrock, is now throwing an error when compiled against
>>> >>> Clang17. The error log is here:
>>> >>>
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
>>> >>>
>>> >>> The important part is
>>> >>> """
>>> >>> Error: package or namespace load failed for ?rbedrock? in
>>> dyn.load(file,
>>> >>> DLLpath = DLLpath, ...):
>>> >>> unable to load shared object
>>> >>>
>>> >>
>>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
>>> >>>
>>> >>>
>>> >>
>>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
>>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
>>> >>> Error: loading failed
>>> >>> """
>>> >>>
>>> >>> From what I can gather through googling, this error can be caused by
>>> >> using
>>> >>> the C linker when one of the dependent libraries is a C++ library.
>>> >>>
>>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
>>> >>> clang17 setup (less likely).
>>> >>>
>>> >>> Background about the package: rbedrock is written in C but links
>>> against
>>> >> a
>>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
>>> functions. I
>>> >>> use a dummy .cpp file in the source directory to trigger R into
>>> using the
>>> >>> C++ linker. That does still seem to be happening according to the
>>> log.
>>> >>>
>>> >>> Has anyone seen this before and know where I should start looking to
>>> fix
>>> >> it?
>>> >>>
>>> >>> Thanks.
>>> >>>
>>> >>> --
>>> >>> Reed A. Cartwright, PhD
>>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
>>> >>> School of Life Sciences and The Biodesign Institute
>>> >>> Arizona State University
>>> >>> ==================
>>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ
>>> 85287-6401 USA
>>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
>>> >>> 85287-6401 USA
>>> >>> Office: Biodesign B-220C, 1-480-965-9949
>>> >>> Website:
>>> >>
>>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
>>> >>>
>>> >>>        [[alternative HTML version deleted]]
>>> >>>
>>> >>> ______________________________________________
>>> >>> R-package-devel at r-project.org mailing list
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
>>> >>
>>> > ______________________________________________
>>> > R-package-devel at r-project.org mailing list
>>> >
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
>>> >
>>>
>>>
>

	[[alternative HTML version deleted]]


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu Oct 12 09:35:11 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 12 Oct 2023 09:35:11 +0200
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuxSOOiPkZLSNim58-3eYvqirnZge0tJdG=TkZJJiCfsTQ@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
 <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>
 <CALOkxuxSOOiPkZLSNim58-3eYvqirnZge0tJdG=TkZJJiCfsTQ@mail.gmail.com>
Message-ID: <25895.41391.656822.288527@stat.math.ethz.ch>

>>>>> Reed A Cartwright 
>>>>>     on Wed, 11 Oct 2023 22:25:35 -0700 writes:

    > Okay, I'll reach out to the CRAN team shortly.
    > I wanted to run it by the group here first because my interactions with the
    > CRAN team haven't always been positive and I need to make sure that I'm not
    > missing something "obvious".

well..  one thing not enough obvious:  Simon Urbanek _is_
part of the CRAN team (*).   So at least you had a positive
interaction with "them", now ! ;-)

---
*) https://cran.r-project.org/CRAN_team.htm
  (which is the *first* hit when I web search "CRAN team" {with
  DuckDuckGo, a reasonable non-prying Google-alternative I})


Best,
Martin


    > On Wed, Oct 11, 2023, 22:22 Simon Urbanek <simon.urbanek at r-project.org>
    > wrote:

    >> Reed,
    >> 
    >> please contact CRAN - this list can only help with general developer's
    >> questions, not specific issues with a particular CRAN setup - only the
    >> corresponding member of CRAN running the setup can help. I don't see
    >> anything obvious - we can see that it's a mismatch of run-times between the
    >> cmake build and the R linking, but from the package alone it's not clear to
    >> me why.
    >> 
    >> Cheers,
    >> Simon
    >> 
    >> 
    >> On Oct 12, 2023, at 3:51 PM, Reed A. Cartwright <racartwright at gmail.com>
    >> wrote:
    >> 
    >> Update: I submitted a new version of the package, but it did not fix the
    >> issue. The package has now been archived and I do not have access to the
    >> error log output anymore from r-devel-linux-x86_64-fedora-clang.
    >> 
    >> I did reproduce CRAN's configuration in a VM using the information
    >> provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot
    >> reproduce the error and at this point I believe that there is a chance that
    >> CRAN's machine is misconfigured.
    >> 
    >> The specific error happens after rbedrock has been compiled and linked
    >> successfully. The specific error is that the symbol
    >> _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
    >> loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
    >> to be happening to cause the error is that Clang++ 17 is adding a reference
    >> to this symbol when compiling and linking rbedrock.so but the dynamic
    >> linker is loading an older version of libc++.so when trying to load
    >> rbedrock.so and the symbol is not found.
    >> 
    >> If this is the cause, then I think that the CRAN machine needs to
    >> configure the dynamic linker to use the Clang++ 17 libc++.so, or add the
    >> proper command line options to R's config variables.
    >> 
    >> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
    >> fine and I've missed something, and I would be happy if someone could help
    >> me figure out what it is.
    >> 
    >> Also, a new issue cropped up when 0.3.1 was tested on the
    >> r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
    >> an archive. The other Mac versions did fine, so I'm not sure if this is a
    >> random error or something related to my package. The error log is here:
    >> https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html
    >> <https://urldefense.com/v3/__https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html__;!!IKRxdwAv5BmarQ!bn6F_bNAOxSfAFbevyOMVGtmTQT-u-wuccyvwupscx__4Spd0Z8C0FoUWbCPQ8QfDC_9g64_bzdKRZTTqo2U99WvIfoR$>
    >> 
    >> If anyone can help me resolve this, I'd appreciate it.
    >> 
    >> 
    >> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
    >> wrote:
    >> 
    >>> Is there any way to submit packages directly to the CRAN's clang17 setup?
    >>> I can enable verbose output for CMake and compare the output, but I'd
    >>> rather not clog up the CRAN incoming queue just to debug a linker error?
    >>> 
    >>> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <
    >>> simon.urbanek at r-project.org> wrote:
    >>> 
    >>>> It looks like a C++ run-time mismatch between what cmake is using to
    >>>> build the static library and what is used by R. Unfortunately, cmake hides
    >>>> the actual compiler calls so it's hard to tell the difference, but that
    >>>> setup relies on the correct sequence of library paths.
    >>>> 
    >>>> The rhub manually forces -stdlib=libc++ to all its CXX flags
    >>>> 
    >>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
    >>>> so it is quite different from the gannet tests-clang-trunk setup (also
    >>>> note the different library paths), but that's not something you can do
    >>>> universally in the package, because it strongly depends on the toolchain
    >>>> setup.
    >>>> 
    >>>> Cheers,
    >>>> Simon
    >>>> 
    >>>> 
    >>>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
    >>>> wrote:
    >>>> >
    >>>> > I was unable to reproduce the error on the rhub's clang17 docker image.
    >>>> >
    >>>> > I notice that the linking command is slightly different between
    >>>> systems.
    >>>> > And this suggests that I need to find some way to get CRAN to pass
    >>>> -stdlib
    >>>> > flag at the linking stage.
    >>>> >
    >>>> > CRAN:
    >>>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
    >>>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
    >>>> -L/usr/local/gcc13/lib64
    >>>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
    >>>> init.o
    >>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
    >>>> > -pthread -lleveldb -lz
    >>>> >
    >>>> > RHUB:
    >>>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
    >>>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
    >>>> init.o
    >>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
    >>>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
    >>>> >
    >>>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
    >>>> > wrote:
    >>>> >
    >>>> >> You might be able to reproduce it with the clang17 container here:
    >>>> >>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
    >>>> >> You can either run it directly or with the rhub2 package:
    >>>> >>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
    >>>> >>
    >>>> >> Gabor
    >>>> >>
    >>>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
    >>>> >> <racartwright at gmail.com> wrote:
    >>>> >>>
    >>>> >>> My package, RBedrock, is now throwing an error when compiled against
    >>>> >>> Clang17. The error log is here:
    >>>> >>>
    >>>> >>>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
    >>>> >>>
    >>>> >>> The important part is
    >>>> >>> """
    >>>> >>> Error: package or namespace load failed for ?rbedrock? in
    >>>> dyn.load(file,
    >>>> >>> DLLpath = DLLpath, ...):
    >>>> >>> unable to load shared object
    >>>> >>>
    >>>> >>
    >>>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
    >>>> >>>
    >>>> >>>
    >>>> >>
    >>>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
    >>>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
    >>>> >>> Error: loading failed
    >>>> >>> """
    >>>> >>>
    >>>> >>> From what I can gather through googling, this error can be caused by
    >>>> >> using
    >>>> >>> the C linker when one of the dependent libraries is a C++ library.
    >>>> >>>
    >>>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
    >>>> >>> clang17 setup (less likely).
    >>>> >>>
    >>>> >>> Background about the package: rbedrock is written in C but links
    >>>> against
    >>>> >> a
    >>>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
    >>>> functions. I
    >>>> >>> use a dummy .cpp file in the source directory to trigger R into
    >>>> using the
    >>>> >>> C++ linker. That does still seem to be happening according to the
    >>>> log.
    >>>> >>>
    >>>> >>> Has anyone seen this before and know where I should start looking to
    >>>> fix
    >>>> >> it?
    >>>> >>>
    >>>> >>> Thanks.
    >>>> >>>
    >>>> >>> --
    >>>> >>> Reed A. Cartwright, PhD
    >>>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
    >>>> >>> School of Life Sciences and The Biodesign Institute
    >>>> >>> Arizona State University
    >>>> >>> ==================
    >>>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ
    >>>> 85287-6401 USA
    >>>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
    >>>> >>> 85287-6401 USA
    >>>> >>> Office: Biodesign B-220C, 1-480-965-9949
    >>>> >>> Website:
    >>>> >>
    >>>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
    >>>> >>>
    >>>> >>>        [[alternative HTML version deleted]]
    >>>> >>>
    >>>> >>> ______________________________________________
    >>>> >>> R-package-devel at r-project.org mailing list
    >>>> >>>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
    >>>> >>
    >>>> > ______________________________________________
    >>>> > R-package-devel at r-project.org mailing list
    >>>> >
    >>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
    >>>> >
    >>>> 
    >>>> 
    >> 

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tony_@_w||ke@ @end|ng |rom out|ook@com  Thu Oct 12 14:34:12 2023
From: tony_@_w||ke@ @end|ng |rom out|ook@com (Tony Wilkes)
Date: Thu, 12 Oct 2023 12:34:12 +0000
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
Message-ID: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>

Dear all,

In my R package that I'm developing, I use `installed.packages(priority = "base")` to programmatically get all core/base R packages (i.e. base, stats, etc.). And similarly, I use installed.packages(priority = "recommended")?` to programmatically get the recommended R packages (i.e. mgcv, lattice, etc.).

However, CRAN has requested to not use `installed.packages()`, as it is slow. I fully get and agree with that assesment. I used installed.packages()?` anyway because I could not find a better, fool-proof alternative.

Nonetheless, I was asked to change this code for optimalisation. So I would like to ask: how do I programmatically get all base/core R packages safely and efficiently, but without using `installed.packages()`? And the same question for recommended R packages. I have of course Googled it, and looked at R's documentation (though R's documentation is large, so it's easy to miss something); no solution found. So if any of you has a smart idea: I'm all ears.

Thank you in advance.

Kind regards,

Tony.

	[[alternative HTML version deleted]]


From th|erry@onke||nx @end|ng |rom |nbo@be  Thu Oct 12 14:39:07 2023
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Thu, 12 Oct 2023 14:39:07 +0200
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <CAJuCY5z9GquTQMWPHbq9i=chungVzJHzAauL1_J+hf1BWMRprA@mail.gmail.com>

Dear Tony,

Much will depend on what information you need from the output of
installed.packages()?

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op do 12 okt 2023 om 14:34 schreef Tony Wilkes <tony_a_wilkes at outlook.com>:

> Dear all,
>
> In my R package that I'm developing, I use `installed.packages(priority =
> "base")` to programmatically get all core/base R packages (i.e. base,
> stats, etc.). And similarly, I use installed.packages(priority =
> "recommended")?` to programmatically get the recommended R packages (i.e.
> mgcv, lattice, etc.).
>
> However, CRAN has requested to not use `installed.packages()`, as it is
> slow. I fully get and agree with that assesment. I used
> installed.packages()?` anyway because I could not find a better, fool-proof
> alternative.
>
> Nonetheless, I was asked to change this code for optimalisation. So I
> would like to ask: how do I programmatically get all base/core R packages
> safely and efficiently, but without using `installed.packages()`? And the
> same question for recommended R packages. I have of course Googled it, and
> looked at R's documentation (though R's documentation is large, so it's
> easy to miss something); no solution found. So if any of you has a smart
> idea: I'm all ears.
>
> Thank you in advance.
>
> Kind regards,
>
> Tony.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Oct 12 14:46:36 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 12 Oct 2023 08:46:36 -0400
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>

It would be much faster (but slightly less reliable) to use 
list.files(.libPaths()) to get the names of all installed packages, and 
then filter them to the known list of base and recommended packages, 
which changes very rarely.

Duncan Murdoch

On 12/10/2023 8:34 a.m., Tony Wilkes wrote:
> Dear all,
> 
> In my R package that I'm developing, I use `installed.packages(priority = "base")` to programmatically get all core/base R packages (i.e. base, stats, etc.). And similarly, I use installed.packages(priority = "recommended")?` to programmatically get the recommended R packages (i.e. mgcv, lattice, etc.).
> 
> However, CRAN has requested to not use `installed.packages()`, as it is slow. I fully get and agree with that assesment. I used installed.packages()?` anyway because I could not find a better, fool-proof alternative.
> 
> Nonetheless, I was asked to change this code for optimalisation. So I would like to ask: how do I programmatically get all base/core R packages safely and efficiently, but without using `installed.packages()`? And the same question for recommended R packages. I have of course Googled it, and looked at R's documentation (though R's documentation is large, so it's easy to miss something); no solution found. So if any of you has a smart idea: I'm all ears.
> 
> Thank you in advance.
> 
> Kind regards,
> 
> Tony.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From cdr|ver@@u@ @end|ng |rom gm@||@com  Thu Oct 12 15:32:28 2023
From: cdr|ver@@u@ @end|ng |rom gm@||@com (Charles Driver)
Date: Thu, 12 Oct 2023 15:32:28 +0200
Subject: [R-pkg-devel] 
 pkg check: SyntaxError: break must be inside loop or switch
In-Reply-To: <20231011104032.47cd0f47@Tarkus>
References: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>
 <20231011104032.47cd0f47@Tarkus>
Message-ID: <940063f5-7f33-4a92-b709-d0418515f1e3@gmail.com>

So apparently there is a corrupted file in the current Stanheaders, 
which is hopefully fixed soon...

On 11/10/2023 9:40 am, Ivan Krylov wrote:
> ? Tue, 10 Oct 2023 16:36:31 +0200
> Charles Driver<cdriver.aus at gmail.com>  ?????:
>
>>    SyntaxError: break must be inside loop or switch
> This looks like an error coming from a JavaScript engine or from a
> JavaScript-derived language:
>
> https://github.com/blld/libecc/blob/88877a46ba9b0a47567aa999a4380b9e793783a8/src/main.c#L714
> https://github.com/ynezz/openwrt-ucode/blob/5163867269fc04fa01ec5e9f8df3384c933339f2/compiler.c#L2930https://github.com/Bobris/Njsast/blob/930f59a9694432580a7b1367680c56672cfe4cd2/Njsast/Compress/LoopControlFinderTreeWalker.cs#L34
>
> (Most modern implementations say "_unlabeled_ break must be inside loop
> or switch", but this may come from an older version.)
>
> This seems to have nothing to do with Stan either; at the very least I
> cannot find this exact error message inhttps://github.com/stan-dev.
> When R complains about a wrongly placed `break`, it also looks
> differently:
>
> break
> # Error: no loop for break/next, jumping to top level
>
> An infrastructure hiccup on Win-Builder?
>

	[[alternative HTML version deleted]]


From j@g@nmn2 @end|ng |rom gm@||@com  Thu Oct 12 17:32:24 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Thu, 12 Oct 2023 11:32:24 -0400
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
References: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
Message-ID: <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>

Maybe something like this:

     > isRecommendedPkg <- utils:::isBasePkg
     > body(isRecommendedPkg)[[c(3L, 3L)]] <- "recommended"
     > installed <- unique(list.files(.libPaths()))
     > installed[vapply(installed, isRecommendedPkg, NA)]
      [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
      [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
     [11] "nlme"       "nnet"       "rpart"      "spatial"    "survival"

where in your package you would define isRecommendedPkg "manually".

Another (but quite undocumented and so maybe not "recommended" :-))
possibility is this:

     > mk <- file.path(R.home("share"), "make", "vars.mk")
     > pp <- sub("^.*= +", "", grep("^R_PKGS_RECOMMENDED", readLines(mk), value 
= TRUE))
     > sort(strsplit(pp, " ")[[1L]])
      [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
      [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
     [11] "nlme"       "nnet"       "rpart"      "spatial"    "survival"

I grepped around and did not find variables in any base namespace containing
the names of these packages.  It wouldn't be too hard to define such variables
when R is configured/built, but maybe there are "reasons" to not do that ... ?

Mikael

 > It would be much faster (but slightly less reliable) to use
 > list.files(.libPaths()) to get the names of all installed packages, and
 > then filter them to the known list of base and recommended packages,
 > which changes very rarely.
 >
 > Duncan Murdoch
 >
 > On 12/10/2023 8:34 a.m., Tony Wilkes wrote:
 > > Dear all,
 > >
 > > In my R package that I'm developing, I use `installed.packages(priority = 
"base")` to programmatically get all core/base R packages (i.e. base, stats, 
etc.). And similarly, I use installed.packages(priority = "recommended")?` to 
programmatically get the recommended R packages (i.e. mgcv, lattice, etc.).
 > >
 > > However, CRAN has requested to not use `installed.packages()`, as it is 
slow. I fully get and agree with that assesment. I used installed.packages()?` 
anyway because I could not find a better, fool-proof alternative.
 > >
 > > Nonetheless, I was asked to change this code for optimalisation. So I would 
like to ask: how do I programmatically get all base/core R packages safely and 
efficiently, but without using `installed.packages()`? And the same question for 
recommended R packages. I have of course Googled it, and looked at R's 
documentation (though R's documentation is large, so it's easy to miss 
something); no solution found. So if any of you has a smart idea: I'm all ears.
 > >
 > > Thank you in advance.
 > >
 > > Kind regards,
 > >
 > > Tony.


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct 12 17:50:30 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 12 Oct 2023 18:50:30 +0300
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>
References: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
 <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>
Message-ID: <20231012185030.14a43f26@Tarkus>

On Thu, 12 Oct 2023 11:32:24 -0400
Mikael Jagan <jaganmn2 at gmail.com> wrote:

>      > mk <- file.path(R.home("share"), "make", "vars.mk")
>      > pp <- sub("^.*= +", "", grep("^R_PKGS_RECOMMENDED",
>      > readLines(mk), value = TRUE))
>      > sort(strsplit(pp, " ")[[1L]])  
>       [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
>       [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
>      [11] "nlme"       "nnet"       "rpart"      "spatial" "survival"
> 
> I grepped around and did not find variables in any base namespace
> containing the names of these packages.  It wouldn't be too hard to
> define such variables when R is configured/built, but maybe there are
> "reasons" to not do that ... ?

tools:::.get_standard_package_names does that at package installation
time, but it's still not public API.

A call to installed.packages() may take a long while because it has to
list files in every library (some of which can be large and/or
network-mounted) and parse each Meta/package.rds file, but at least
list.files() is faster than that.

If I had to make a choice at this point, I would hard-code the list of
packages, but a better option may surface once we know what Tony needs
the package lists for.

-- 
Best regards,
Ivan


From tony_@_w||ke@ @end|ng |rom out|ook@com  Fri Oct 13 11:11:20 2023
From: tony_@_w||ke@ @end|ng |rom out|ook@com (Tony Wilkes)
Date: Fri, 13 Oct 2023 09:11:20 +0000
Subject: [R-pkg-devel] published CRAN check results give error for only
 r-oldrel-macos-arm64
Message-ID: <AS4P195MB143061979866A2C583D4BEB2BED2A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>

Dear all,

My R package has yesterday been accepted by CRAN. I'm super happy about this, of course.
But when I look at the package's CRAN check results (see https://cran.r-project.org/web/checks/check_results_tinycodet.html), I see that r-oldrel-macos-arm64 has latex errors.
I find it very odd that the package runs fine on all OS, except this particular one. And I don't see why latex errors would be OS-specific. (Btw: I actually checked my R package personally on Mac OS before giving to CRAN, and there were no errors then.)

As stated, my package is published, so it's not the end of the world. But I don't want certain people to be left out, so I would prefer to fix this particular error also. The latex errors are not very enlightening.

Can anyone please explain why these latex errors are there, and how I could fix them in the future?

Thank you in advance.

Kind regards,

Tony.

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Oct 13 12:01:50 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 13 Oct 2023 13:01:50 +0300
Subject: [R-pkg-devel] published CRAN check results give error for only
 r-oldrel-macos-arm64
In-Reply-To: <AS4P195MB143061979866A2C583D4BEB2BED2A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB143061979866A2C583D4BEB2BED2A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <20231013130150.04323d1e@Tarkus>

On Fri, 13 Oct 2023 09:11:20 +0000
Tony Wilkes <tony_a_wilkes at outlook.com> wrote:

> My R package has yesterday been accepted by CRAN. I'm super happy
> about this, of course. But when I look at the package's CRAN check
> results (see
> https://cran.r-project.org/web/checks/check_results_tinycodet.html),
> I see that r-oldrel-macos-arm64 has latex errors.

The difference is that the r-oldrel-windows-x86_64 checks are running
R-4.2.3, but r-oldrel-macos-arm64 are running R-4.2.0. I can reproduce
the issue with R-4.2.0, and it's in the s_regex help page. Here's the
relevant difference in the intermediate *.tex files:

 The \LinkA{\Rpercent{}s-\Rpercent{}}{.Rpcent.s.Rdash..Rpcent.} and \LinkA{\Rpercent{}s/\Rpercent{}}{.Rpcent.s/.Rpcent.} operators,
-as well as the string detection operators (\LinkA{\Rpercent{}s\textbraceleft{\textbraceright{}\textbraceright{}\Rpercent{}}{.Rpcent.s.Rlbrace..Rrbrace..Rpcent.}, \LinkA{\Rpercent{}s!\textbraceleft{\textbraceright{}\textbraceright{}\Rpercent{}}{.Rpcent.s!.Rlbrace..Rrbrace..Rpcent.}),
+as well as the string detection operators (\LinkA{\Rpercent{}s\{\}\Rpercent{}}{.Rpcent.s.Rlbrace..Rrbrace..Rpcent.}, \LinkA{\Rpercent{}s!\{\}\Rpercent{}}{.Rpcent.s!.Rlbrace..Rrbrace..Rpcent.}),
 perform pattern matching for some purpose,
 where the pattern is given on the right hand side. \\{}
 When a character vector or string is given on the right hand side,

This seems to correspond to R-devel revision 82224 made on 2022-04-20
that fixed the use of {} inside \code{\link{}}.

If you'd like a clean PDF manual build on R-4.2.0 and older, it may
help to give a different \alias to the %s{}% help page and use that
inside \link.

-- 
Best regards,
Ivan


From bbo|ker @end|ng |rom gm@||@com  Fri Oct 13 21:05:11 2023
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Fri, 13 Oct 2023 15:05:11 -0400
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <4ff3d6c8-bc8d-4849-8682-bad27162b91e@gmail.com>

Based on 
https://cran-archive.r-project.org/web/checks/2022/2022-05-16_check_results_mlr3proba.html

   it looks like there were problems with the code (possibly harmless, 
but very unlikely to be exactly as intended) when R started throwing an 
error when vectors of length >1 were used with the && operator; this 
happened with R 4.3.0

https://cran-archive.r-project.org/web/checks/2022/2022-05-16_check_results_mlr3proba.html

\subsection{SIGNIFICANT USER-VISIBLE CHANGES}{
     \itemize{
       \item Calling \code{&&} or \code{||} with LHS or (if evaluated) 
RHS of
       length greater than one is now always an error, with a report of
       the form
\preformatted{    'length = 4' in coercion to 'logical(1)'}

   Since the errors weren't corrected, the package was archived.

   You can find the maintainer's email in the DESCRIPTION file here: 
https://cran.r-project.org/src/contrib/Archive/mlr3proba/mlr3proba_0.4.9.tar.gz 
   if you want to follow up with them ...

   cheers
    Ben Bolker


On 2023-10-08 5:28 p.m., Dr. Franz Kir?ly wrote:
> Dear all,
> 
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
> 
> Thanks
> Franz
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


