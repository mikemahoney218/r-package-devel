From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 10:29:18 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 08:29:18 +0000
Subject: [R-pkg-devel] Testing.
Message-ID: <20231001212918.326ab18c@rolf-Latitude-E7470>


I'm having a problem .... please excuse the noise.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 10:31:31 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 08:31:31 +0000
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
Message-ID: <20231001211547.4c46512e@rolf-Latitude-E7470>


When I submitted an update of my Iso package a short time ago, it was
rejected as not passing the incoming checks automatically.  Explicitly,
I got a WARNING:

> * checking sizes of PDF files under 'inst/doc' ... WARNING
> 'gs+qpdf' made some significant size reductions:
>      compacted 'algorithm.pdf' from 394Kb to 99Kb
>   consider running tools::compactPDF(gs_quality = "ebook") on these
> files

I did as instructed and ran

    tools::compactPDF("./algorithm.pdf",gs_quality="ebook")

having started R in the inst/vignettes directory, which is where the
file algorithm.pdf is to be found.

According to "ls -l" the size of algorithm.pdf was about 109 Kb. before
I ran compactPDF() and about 90 Kb. afterward.

I do not understand:

    * the reference to inst/doc (there is no such directory)
    * where the sizes 349 Kb and 99 Kb come from
    * what I have to do to get Iso to pass the required checks

The email that I received from CRAN (under the return address
ligges at statistik.tu-dortmund.de) said:

> If you are not sure how to fix the problems shown, please ask for
> help on the R-package-devel mailing list:

Consequently I am asking! Can anyone set me on the path to
enlightenment?  Thanks.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From kry|ov@r00t @end|ng |rom gm@||@com  Sun Oct  1 14:22:34 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 1 Oct 2023 15:22:34 +0300
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
In-Reply-To: <20231001211547.4c46512e@rolf-Latitude-E7470>
References: <20231001211547.4c46512e@rolf-Latitude-E7470>
Message-ID: <20231001152234.6bdd40ec@Tarkus>

On Sun,  1 Oct 2023 08:31:31 +0000
Rolf Turner <rolfturner at posteo.net> wrote:

> I do not understand:

>    * the reference to inst/doc (there is no such directory)

When you run R CMD build in order to produce a new Iso-*.tar.gz, R runs
Sweave and pdflatex on vignettes/algorithm.Rnw in order to produce
inst/doc/algorithm.pdf inside the resulting tarball (but not the
original source tree on your computer).

>    * what I have to do to get Iso to pass the required checks

Does it help to run R CMD build --compact-vignettes=both? This should
let R run tools::compactPDF on inst/doc/algorithm.pdf it generates
before placing it inside the package tarball.

I think that R doesn't know anything about files under inst/vignettes
in the source tree.

-- 
Best regards,
Ivan


From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 23:01:13 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 21:01:13 +0000
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
In-Reply-To: <20231001152234.6bdd40ec@Tarkus>
References: <20231001211547.4c46512e@rolf-Latitude-E7470>
 <20231001152234.6bdd40ec@Tarkus>
Message-ID: <20231002100113.2ce1c902@rolf-Latitude-E7470>

On Sun, 1 Oct 2023 15:22:34 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Sun,  1 Oct 2023 08:31:31 +0000
> Rolf Turner <rolfturner at posteo.net> wrote:
> 
> > I do not understand:
> 
> >    * the reference to inst/doc (there is no such directory)
> 
> When you run R CMD build in order to produce a new Iso-*.tar.gz, R
> runs Sweave and pdflatex on vignettes/algorithm.Rnw in order to
> produce inst/doc/algorithm.pdf inside the resulting tarball (but not
> the original source tree on your computer).
> 
> >    * what I have to do to get Iso to pass the required checks
> 
> Does it help to run R CMD build --compact-vignettes=both? This should
> let R run tools::compactPDF on inst/doc/algorithm.pdf it generates
> before placing it inside the package tarball.
> 
> I think that R doesn't know anything about files under inst/vignettes
> in the source tree.

Thanks Ivan.  That may well be the key.  When I unpacked the tarball
created without the --compact-vignettes=both flag, I found that
inst/doc/algorithm.pdf had size 403 Kb, whereas with that flag set
it had size 108 Kb.

I'll re-submit now and see what happens.

I *really* think that the instructions from CRAN could have been
clearer!  Without your guidance I'd have been at a total loss.

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From j@goreck| @end|ng |rom w|t@edu@p|  Tue Oct  3 16:45:26 2023
From: j@goreck| @end|ng |rom w|t@edu@p| (Jan Gorecki)
Date: Tue, 3 Oct 2023 16:45:26 +0200
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
Message-ID: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>

Hello,

I noticed some packages define Imports in DESCRIPTION file listing base R
packages like methods, utils, etc.

My question is that if it is necessary to list those* dependencies in
DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

* by "those" I mean packages listed by:

in tools:::.get_standard_package_names()$base

	[[alternative HTML version deleted]]


From henr|k@bengt@@on @end|ng |rom gm@||@com  Tue Oct  3 17:50:14 2023
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Tue, 3 Oct 2023 08:50:14 -0700
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
In-Reply-To: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>
References: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>
Message-ID: <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>

On Tue, Oct 3, 2023 at 7:46?AM Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
>
> Hello,
>
> I noticed some packages define Imports in DESCRIPTION file listing base R
> packages like methods, utils, etc.
>
> My question is that if it is necessary to list those* dependencies in
> DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

You do *not* have to declare base-R packages as dependencies in the
DESCRIPTION file.  'R CMD check' and 'R CMD check --as-cran' will not
complain about them.

I can't speak for others, but, I choose to declare all(*) my base-R
package dependencies in my DESCRIPTION files for a reason.  This makes
it explicit what packages my package rely on, including which of the
base-R packages.  For instance, it's nice to be able to tell when the
'parallel' or 'tcltk' package is used from the DESCRIPTION file (and
the online CRAN package page, if on CRAN).

(*) The exception is the 'base' package, because that is such a
fundamental package in R and is always loaded.  The other base-R
packages are theoretically optional when it comes to running R, e.g.

$ R_ENABLE_JIT=0 Rscript --vanilla --default-packages=base -e
"loadedNamespaces()"
[1] "base"

/Henrik

>
> * by "those" I mean packages listed by:
>
> in tools:::.get_standard_package_names()$base
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @|j|@ng @end|ng |rom bccrc@c@  Tue Oct  3 19:34:04 2023
From: @|j|@ng @end|ng |rom bccrc@c@ (Aixiang Jiang)
Date: Tue, 3 Oct 2023 17:34:04 +0000
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
In-Reply-To: <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>
References: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>,
 <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>
Message-ID: <1696354445275.65575@bccrc.ca>

Thank you - all!

Aixiang
________________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Henrik Bengtsson <henrik.bengtsson at gmail.com>
Sent: Tuesday, October 3, 2023 8:50 AM
To: Jan Gorecki
Cc: List r-package-devel
Subject: Re: [R-pkg-devel] DESCRIPTION file Imports of base R packages

This email came from an EXTERNAL SENDER. If you think this message is suspicious, please do not open any attached files or links, and forward it as an attachment to spammail at bccrc.ca



On Tue, Oct 3, 2023 at 7:46?AM Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
>
> Hello,
>
> I noticed some packages define Imports in DESCRIPTION file listing base R
> packages like methods, utils, etc.
>
> My question is that if it is necessary to list those* dependencies in
> DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

You do *not* have to declare base-R packages as dependencies in the
DESCRIPTION file.  'R CMD check' and 'R CMD check --as-cran' will not
complain about them.

I can't speak for others, but, I choose to declare all(*) my base-R
package dependencies in my DESCRIPTION files for a reason.  This makes
it explicit what packages my package rely on, including which of the
base-R packages.  For instance, it's nice to be able to tell when the
'parallel' or 'tcltk' package is used from the DESCRIPTION file (and
the online CRAN package page, if on CRAN).

(*) The exception is the 'base' package, because that is such a
fundamental package in R and is always loaded.  The other base-R
packages are theoretically optional when it comes to running R, e.g.

$ R_ENABLE_JIT=0 Rscript --vanilla --default-packages=base -e
"loadedNamespaces()"
[1] "base"

/Henrik

>
> * by "those" I mean packages listed by:
>
> in tools:::.get_standard_package_names()$base
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

From v|nhd|zzo @end|ng |rom gm@||@com  Tue Oct  3 23:52:26 2023
From: v|nhd|zzo @end|ng |rom gm@||@com (Vinh Nguyen)
Date: Tue, 3 Oct 2023 14:52:26 -0700
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
Message-ID: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>

Dear members of R-package-devel,

CRAN has the following policy: Packages which use Internet resources
should fail gracefully with an informative message if the resource is
not available or has changed (and not give a check warning nor error).

I have a CRAN-accepted package with vignettes that use Rmarkdown. One
of the vignettes involves a lot of images, so rather than embed the
raw images in the vignette, I reference the images on Flickr (to keep
the package size small enough to be hosted on CRAN). Every half year
or so, I'll get a message from CRAN maintainers that the package is
not failing gracefully on one of their servers due to their build and
testing processes.  The error message looks as follows:

Could not fetch
https://live.staticflickr.com/65535/52281215570_5f9cc90a12_o.png
     HttpExceptionRequest Request {
      host = "live.staticflickr.com"
      port = 443
      secure = True
      requestHeaders = []
      path = "/65535/52281215570_5f9cc90a12_o.png"
      queryString = ""
      method = "GET"
      proxy = Nothing
      rawBody = False
      redirectCount = 10
      responseTimeout = ResponseTimeoutDefault
      requestVersion = HTTP/1.1
     }
      (ConnectionFailure Network.Socket.getAddrInfo (called with
preferred socket type/protocol: AddrInfo {addrFlags = [AI_ADDRCONFIG],
addrFamily = AF_UNSPEC, addrSocketType = Stream, addrProtocol = 0,
addrAddress = <assumed to be undefined>, addrCanonName = <assumed to be
undefined>}, host name: Just "live.staticflickr.com", service name: Just
"443"): does not exist (Name or service not known))
     Error: processing vignette
'Ex-04-Webscraping-Online-Data-Files.Rmd' failed with diagnostics:
     pandoc document conversion failed with error 61

What's the recommended way for making this fail gracefully?  Again, I
am pointing to the images online.  I am aware of .Rbuildignore, but
using this would make the vignettes not hosted on the CRAN package
page.

Thanks in advance for your help.

-- Vinh


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct  4 10:34:08 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 4 Oct 2023 11:34:08 +0300
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
In-Reply-To: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
References: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
Message-ID: <20231004113408.2734534a@Tarkus>

On Tue, 3 Oct 2023 14:52:26 -0700
Vinh Nguyen <vinhdizzo at gmail.com> wrote:

> Could not fetch
> https://live.staticflickr.com/65535/52281215570_5f9cc90a12_o.png

This is Pandoc failing to bundle external resources from the final
Markdown file, not your R code.

>      Error: processing vignette
> 'Ex-04-Webscraping-Online-Data-Files.Rmd' failed with diagnostics:
>      pandoc document conversion failed with error 61

My psychic debugging powers tell me that this is the vignette you're
having problems with:
https://github.com/vinhdizzo/IRexamples/blob/main/vignettes/Ex-04-Webscraping-Online-Data-Files.Rmd

If you look at the vignette as it is on CRAN, you can see that the
images aren't actually loaded from live.staticflickr.com, but are
included as base64 PNG blobs in the HTML file. This is much less
efficient than a plain PNG file. I think that your package will become
smaller if you disable this bundling and include the original PNG files
in your package. You may be able to squeeze some more savings by using
pngcrush / optipng to compress the images further.

The parameter responsible for this base64 encoding is called
self_contained, which defaults to TRUE in the rmarkdown::html_document
format, which prettydoc::html_pretty inherits from. Set it to FALSE in
the YAML header of the vignette.

Note that some other scripts and CSS files may be loaded from external
sources if you do that. As a user, I would prefer this not to be the
case, but I don't know enough about rmarkdown to set your vignette up
to bundle everything except the images.

-- 
Best regards,
Ivan


From dewey @end|ng |rom dunn|ngton@c@  Thu Oct  5 03:38:35 2023
From: dewey @end|ng |rom dunn|ngton@c@ (Dewey Dunnington)
Date: Wed, 04 Oct 2023 22:38:35 -0300
Subject: [R-pkg-devel] Status of adbcpostgresql
Message-ID: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>

Hi all,

I submitted the first release of adbcpostgresql (an R repackaging of 
ADBC's Postgres driver) about a month ago and it has been pending human 
inspection (I think) since then. I did reply-all to the email once to 
inquire about status but haven't heard back. Where is the best place to 
direct communication about the status of the package? I am certainly 
happy to fix any problems that arise.

Cheers,

-dewey


From ||u|@@rev|||@ @end|ng |rom gm@||@com  Thu Oct  5 09:39:45 2023
From: ||u|@@rev|||@ @end|ng |rom gm@||@com (=?UTF-8?Q?Llu=C3=ADs_Revilla?=)
Date: Thu, 5 Oct 2023 09:39:45 +0200
Subject: [R-pkg-devel] Status of adbcpostgresql
In-Reply-To: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>
References: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>
Message-ID: <CAN+W6_v35eQziWhYqHdMgSqtY3H+Ht-N7v64z+jJ_0sw7PYt8A@mail.gmail.com>

Hi Dewey,

Currently there are several packages on a subfolder for human inspection.
I don't think you can do anything else: sending this email might help
drawing attention from your reviewer to your package.
There might be some issues in the package that you'll need to address, try
to find them in advance or prepare a reply for them.

Probably the reviewer is busy with other non-CRAN related things. Or maybe
the review fell between emails.
After a couple of weeks you could try again sending an email to the
reviewer.

Best,

Llu?s

On Thu, 5 Oct 2023 at 03:39, Dewey Dunnington <dewey at dunnington.ca> wrote:

> Hi all,
>
> I submitted the first release of adbcpostgresql (an R repackaging of
> ADBC's Postgres driver) about a month ago and it has been pending human
> inspection (I think) since then. I did reply-all to the email once to
> inquire about status but haven't heard back. Where is the best place to
> direct communication about the status of the package? I am certainly
> happy to fix any problems that arise.
>
> Cheers,
>
> -dewey
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From v|nhd|zzo @end|ng |rom gm@||@com  Fri Oct  6 14:59:10 2023
From: v|nhd|zzo @end|ng |rom gm@||@com (Vinh Nguyen)
Date: Fri, 6 Oct 2023 05:59:10 -0700
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
In-Reply-To: <20231004113408.2734534a@Tarkus>
References: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
 <20231004113408.2734534a@Tarkus>
Message-ID: <CA+2DmwhmPgnDomuP23vnRTz8tD5wBXpfwbt4eiyw_Hy+_9Nq9Q@mail.gmail.com>

>
>
> The parameter responsible for this base64 encoding is called
> self_contained, which defaults to TRUE in the rmarkdown::html_document
> format, which prettydoc::html_pretty inherits from. Set it to FALSE in
> the YAML header of the vignette.
>
> Note that some other scripts and CSS files may be loaded from external
> sources if you do that. As a user, I would prefer this not to be the
> case, but I don't know enough about rmarkdown to set your vignette up
> to bundle everything except the images
>


Thanks for the detailed investigation and analysis, Ivan. For now, I've
followed your suggestion and added the option `self_contained: false`. The
revised package is now on CRAN, and you are correct that css files are no
longer contained for the version sitting on CRAN, so the vignette is less
pretty looking. I'll investigate if there are any other workarounds.

Your assistance is much appreciated.

>

	[[alternative HTML version deleted]]


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Oct  6 16:36:45 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 6 Oct 2023 15:36:45 +0100
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
Message-ID: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>

I am trying to update my CRAN package metap. When I ran a final check on 
winbuilder I got the warning

* checking sizes of PDF files under 'inst/doc' ... WARNING
   'gs+qpdf' made some significant size reductions:
      compacted 'compare.pdf' from 498Kb to 243Kb
      compacted 'plotmetap.pdf' from 349Kb to 91Kb
   consider running tools::compactPDF(gs_quality = "ebook") on these files,
   or build the source package with --compact-vignettes=both

But I did use the option --compact-vignettes=both when I built the tarball.

I do have gs installed but not qpdf. I built the package under Windows 
if that is relevant.

Any suggestions?

-- 
Michael


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Oct  6 16:48:28 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 6 Oct 2023 17:48:28 +0300
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
In-Reply-To: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
Message-ID: <20231006174828.651b58c7@arachnoid>

? Fri, 6 Oct 2023 15:36:45 +0100
Michael Dewey <lists at dewey.myzen.co.uk> ?????:

> But I did use the option --compact-vignettes=both when I built the
> tarball.

> I do have gs installed but not qpdf. I built the package under
> Windows if that is relevant.

Is the Ghostscript executable on the %PATH%? It might help to install a
newer version. It may also be informative to extract the vignette *.pdf
files from the source package tarball and run tools::compactPDF(pdfs,
gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
point.

-- 
Best regards,
Ivan


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Oct  6 17:30:26 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 6 Oct 2023 16:30:26 +0100
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
In-Reply-To: <20231006174828.651b58c7@arachnoid>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
Message-ID: <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>

Dear Ivan

You must have psychic powers. After some digging I find that the copy 
installed by TexLive is hidden from other software so I need to install 
it again. I suppose while I am at it I should try installing qpdf.

Michael

On 06/10/2023 15:48, Ivan Krylov wrote:
> ? Fri, 6 Oct 2023 15:36:45 +0100
> Michael Dewey <lists at dewey.myzen.co.uk> ?????:
> 
>> But I did use the option --compact-vignettes=both when I built the
>> tarball.
> 
>> I do have gs installed but not qpdf. I built the package under
>> Windows if that is relevant.
> 
> Is the Ghostscript executable on the %PATH%? It might help to install a
> newer version. It may also be informative to extract the vignette *.pdf
> files from the source package tarball and run tools::compactPDF(pdfs,
> gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
> point.
> 

-- 
Michael


From w@chte||k @end|ng |rom gm@||@com  Sat Oct  7 12:25:14 2023
From: w@chte||k @end|ng |rom gm@||@com (Wojciech Achtelik)
Date: Sat, 7 Oct 2023 12:25:14 +0200
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
Message-ID: <CABYZkg=KbFch1WsJN_E-nfrMfoNBNjX2rZyVpLpZgdY507eaAQ@mail.gmail.com>

Hi,

I recently submitted my first R package to CRAN, and I encountered a NOTE
during the checking process. The NOTE looks like this:

=============================================================
Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: whether the namespace can be loaded with stated dependencies,
Result: NOTE
  Warning: no function found corresponding to methods exports from 'hmsr'
for: 'show'

  A namespace must be able to be loaded with just the base namespace
  loaded: otherwise if the namespace gets loaded by a saved object, the
  session will be unable to start.

  Probably some imports need to be declared in the NAMESPACE file.
=============================================================

I'm seeking help to understand and address this issue. show is defined like
this:

#' Show method for class "hms".#'#' @param object - hms s4 object#'#'
@return It returns the names of the slots and the classes associated
with the#' slots in the "hms" class. It prints call details.#'#'
@export#'#' @examples
#' f <- function(x) x
#' result <- hms(fitness = f, lower = -5, upper = 5)
#' show(result)
setMethod("show", "hms", function(object) {
  cat("An object of class \"hms\"\n")
  cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
  cat("Available slots:\n")
  print(methods::slotNames(object))})

And in the NAMESPACE there is a line that looks like this:

exportMethods(show)

I was investigating if the show is defined correctly and the GA package has
a very similar method:

setMethod("show", "ga",function(object)
 { cat("An object of class \"ga\"\n")
   cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
   cat("Available slots:\n")
   print(slotNames(object))})

I could not reproduce this NOTE on my personal machine with Windows.
On Mac OS I have never experienced this NOTE.


Best regards

Wojciech Achtelik

	[[alternative HTML version deleted]]


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Sun Oct  8 17:47:41 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Sun, 8 Oct 2023 16:47:41 +0100
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
Message-ID: <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>

Following on from Ivan's advice I have now installed qpdf and Ghostview. 
I have checked that they are both on my path by typing their name at the 
command line and verifying they open. I then built the package with the 
--compress-vignettes=both and then checked it with --as-cran I still get 
a complaint that it needs qpdf to check compression.

I notice that in the Writing R Extensions manual in section 1.6.1 it states
"The full path to the qpdf command can be supplied as environment 
variable R_QPDF ..."

Is that a typo for "must be supplied"? If it is where can I find the 
answers to questions about how R accepts Windows paths? Do I need to 
enclose parts of names containing spaces in "" signs? Does it mean the 
path up to, in this case, bin or must I include qpdf.exe after it?

I assume I do not need to do anything special to get it to find Ghostscript?

Michael

On 06/10/2023 16:30, Michael Dewey wrote:
> Dear Ivan
> 
> You must have psychic powers. After some digging I find that the copy 
> installed by TexLive is hidden from other software so I need to install 
> it again. I suppose while I am at it I should try installing qpdf.
> 
> Michael
> 
> On 06/10/2023 15:48, Ivan Krylov wrote:
>> ? Fri, 6 Oct 2023 15:36:45 +0100
>> Michael Dewey <lists at dewey.myzen.co.uk> ?????:
>>
>>> But I did use the option --compact-vignettes=both when I built the
>>> tarball.
>>
>>> I do have gs installed but not qpdf. I built the package under
>>> Windows if that is relevant.
>>
>> Is the Ghostscript executable on the %PATH%? It might help to install a
>> newer version. It may also be informative to extract the vignette *.pdf
>> files from the source package tarball and run tools::compactPDF(pdfs,
>> gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
>> point.
>>
> 

-- 
Michael


From m@tth|@@-gond@n @end|ng |rom gmx@de  Sun Oct  8 21:41:14 2023
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Sun, 8 Oct 2023 21:41:14 +0200
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
Message-ID: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>

Dear developers and CRAN people,

I get some linker warnings on the macOS build server,

ld: warning: direct access in function '?' from file '?' to global weak symbol '?' from file '?' means the weak symbol cannot be overridden at runtime. This was likely caused by different translation units being compiled with different visibility settings.

Writing R Extensions (Section 6.16) says that visibility attributes are not supported on macOS nor Windows. If I add $(CXX_VISIBILITY) to PKG_CXXFLAGS, the warnings are still there, and I can see from the compiler log that the flags do not have any effect on macOS. However, if I add -fvisibility=hidden to PKG_CXXFLAGS, the warnings disappear (but I get a reminder from R CMD check that -fvisibility=hidden is not portable). I am wondering if $(CXX_VISIBILITY) could be supported on macOS.

Best wishes,

Matthias

This is the build log of the package: https://www.r-project.org/nosvn/R.check/r-release-macos-arm64/rswipl-00install.html


	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Oct  8 22:29:50 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 9 Oct 2023 09:29:50 +1300
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
In-Reply-To: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
References: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
Message-ID: <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>

Matthias,

this has nothing to do with R, but rather your code. You have the wrong order of headers: the SWI headers mess up visibility macros, so you have to include them *after* Rcpp.h.

Cheers,
Simon


> On 9/10/2023, at 8:41 AM, Matthias Gondan <matthias-gondan at gmx.de> wrote:
> 
> Dear developers and CRAN people,
> 
> I get some linker warnings on the macOS build server,
> 
> ld: warning: direct access in function '?' from file '?' to global weak symbol '?' from file '?' means the weak symbol cannot be overridden at runtime. This was likely caused by different translation units being compiled with different visibility settings.
> 
> Writing R Extensions (Section 6.16) says that visibility attributes are not supported on macOS nor Windows. If I add $(CXX_VISIBILITY) to PKG_CXXFLAGS, the warnings are still there, and I can see from the compiler log that the flags do not have any effect on macOS. However, if I add -fvisibility=hidden to PKG_CXXFLAGS, the warnings disappear (but I get a reminder from R CMD check that -fvisibility=hidden is not portable). I am wondering if $(CXX_VISIBILITY) could be supported on macOS.
> 
> Best wishes,
> 
> Matthias
> 
> This is the build log of the package: https://www.r-project.org/nosvn/R.check/r-release-macos-arm64/rswipl-00install.html
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From j@g@nmn2 @end|ng |rom gm@||@com  Sun Oct  8 23:43:57 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Sun, 8 Oct 2023 17:43:57 -0400
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
In-Reply-To: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
References: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
Message-ID: <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>

> Hi,
> 
> I recently submitted my first R package to CRAN, and I encountered a NOTE
> during the checking process. The NOTE looks like this:
> 
> =============================================================
> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
> Check: whether the namespace can be loaded with stated dependencies,
> Result: NOTE
>    Warning: no function found corresponding to methods exports from 'hmsr'
> for: 'show'
> 
>    A namespace must be able to be loaded with just the base namespace
>    loaded: otherwise if the namespace gets loaded by a saved object, the
>    session will be unable to start.
> 
>    Probably some imports need to be declared in the NAMESPACE file.

Sounds like your NAMESPACE is missing importFrom(methods, show) ... ?
I'm not sure why you could not reproduce the problem locally, given that
check uses _R_CHECK_CODE_USAGE_WITH_ONLY_BASE_ATTACHED_=true by default.
But it is hard to say anything without a link to the package sources ...

Mikael

> =============================================================
> 
> I'm seeking help to understand and address this issue. show is defined like
> this:
> 
> #' Show method for class "hms".#'#' @param object - hms s4 object#'#'
> @return It returns the names of the slots and the classes associated
> with the#' slots in the "hms" class. It prints call details.#'#'
> @export#'#' @examples
> #' f <- function(x) x
> #' result <- hms(fitness = f, lower = -5, upper = 5)
> #' show(result)
> setMethod("show", "hms", function(object) {
>    cat("An object of class \"hms\"\n")
>    cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
>    cat("Available slots:\n")
>    print(methods::slotNames(object))})
> 
> And in the NAMESPACE there is a line that looks like this:
> 
> exportMethods(show)
> 
> I was investigating if the show is defined correctly and the GA package has
> a very similar method:
> 
> setMethod("show", "ga",function(object)
>   { cat("An object of class \"ga\"\n")
>     cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
>     cat("Available slots:\n")
>     print(slotNames(object))})
> 
> I could not reproduce this NOTE on my personal machine with Windows.
> On Mac OS I have never experienced this NOTE.
> 
> 
> Best regards
> 
> Wojciech Achtelik


From |r@nzk|r@|y @end|ng |rom |n|@e|te@hu  Sun Oct  8 23:28:31 2023
From: |r@nzk|r@|y @end|ng |rom |n|@e|te@hu (=?iso-8859-1?Q?Dr=2E_Franz_Kir=E1ly?=)
Date: Sun, 8 Oct 2023 21:28:31 +0000
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
Message-ID: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>

Dear all,

can someone explain to me what exactly happened to mlr3proba on CRAN?
https://cran.r-project.org/web/packages/mlr3proba/index.html

Thanks
Franz


	[[alternative HTML version deleted]]


From @vr@h@m@@d|er @end|ng |rom gm@||@com  Mon Oct  9 02:39:47 2023
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Mon, 9 Oct 2023 00:39:47 +0000
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <CAL6gwnKcQcJv_+ajSmawF64z0wYLW1Zvj=r8h+p1TaXmpvMYAw@mail.gmail.com>

https://cran-archive.r-project.org/web/checks/2022/2022-05-16_check_results_mlr3proba.html

On Mon, Oct 9, 2023 at 12:37?AM Dr. Franz Kir?ly <franzkiraly at inf.elte.hu>
wrote:

> Dear all,
>
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
>
> Thanks
> Franz
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Mon Oct  9 02:43:02 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 9 Oct 2023 13:43:02 +1300
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <7ACF837C-971C-4C15-AD5E-6C7DA2EFB98A@R-project.org>

Franz,

it means that the author(s) have abandoned the package: as the note says it was failing checks and the authors have not fixed the problems so it has been removed from CRAN (more than a year ago).

Cheers,
Simon



> On 9/10/2023, at 10:28 AM, Dr. Franz Kir?ly <franzkiraly at inf.elte.hu> wrote:
> 
> Dear all,
> 
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
> 
> Thanks
> Franz
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From m@tth|@@-gond@n @end|ng |rom gmx@de  Mon Oct  9 08:32:20 2023
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Mon, 9 Oct 2023 08:32:20 +0200
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
In-Reply-To: <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>
References: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
 <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>
Message-ID: <1N49h5-1rXQX43IqP-0106qV@mail.gmx.net>

You found the problem, thanks!



Matthias,

this has nothing to do with R, but rather your code. You have the wrong order of headers: the SWI headers mess up visibility macros, so you have to include them *after* Rcpp.h.

Cheers,
Simon


	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Oct  9 09:51:30 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 9 Oct 2023 10:51:30 +0300
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
Message-ID: <20231009105130.3f0d269c@Tarkus>

On Sun, 8 Oct 2023 16:47:41 +0100
Michael Dewey <lists at dewey.myzen.co.uk> wrote:

> Following on from Ivan's advice I have now installed qpdf and
> Ghostview. I have checked that they are both on my path by typing
> their name at the command line and verifying they open.

> I then built the package with the --compress-vignettes=both and then
> checked it with --as-cran I still get a complaint that it needs qpdf
> to check compression.

While running R, does Sys.which('qpdf') return the path to qpdf.exe?
Does Sys.getenv('PATH') match your expectations?

> I notice that in the Writing R Extensions manual in section 1.6.1 it
> states "The full path to the qpdf command can be supplied as
> environment variable R_QPDF ..."
> 
> Is that a typo for "must be supplied"?

Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
must work if it's on the %PATH%, but if all else fails, setting this
environment variable should help.

> If it is where can I find the answers to questions about how R
> accepts Windows paths? Do I need to enclose parts of names containing
> spaces in "" signs?

It always depends on how the final command line is built by a
particular function, but it should work by taking plain file paths
without any escaping and quotation. The directory separators shouldn't
matter either.

(tools::compactPDF uses system2(), so it quotes the path to the
executable by itself.)

> Does it mean the path up to, in this case, bin or must I include
> qpdf.exe after it?

It must be the full path to the executable, including the final
qpdf.exe.

> I assume I do not need to do anything special to get it to find
> Ghostscript?

tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
If it's not there, R_GSCMD must be set to the full path to the
executable. Judging by the NOTE you've received, it's Ghostscript that
performed most of the compaction in your case.

-- 
Best regards,
Ivan


From j@g@nmn2 @end|ng |rom gm@||@com  Mon Oct  9 15:05:41 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Mon, 9 Oct 2023 09:05:41 -0400
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
In-Reply-To: <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>
References: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
 <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>
Message-ID: <bb2a5822-d127-4e6e-bf88-eabe542875cc@gmail.com>



On 2023-10-08 5:43 pm, Mikael Jagan wrote:
>> Hi,
>>
>> I recently submitted my first R package to CRAN, and I encountered a NOTE
>> during the checking process. The NOTE looks like this:
>>
>> =============================================================
>> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
>> Check: whether the namespace can be loaded with stated dependencies,
>> Result: NOTE
>>     Warning: no function found corresponding to methods exports from 'hmsr'
>> for: 'show'
>>
>>     A namespace must be able to be loaded with just the base namespace
>>     loaded: otherwise if the namespace gets loaded by a saved object, the
>>     session will be unable to start.
>>
>>     Probably some imports need to be declared in the NAMESPACE file.
> 
> Sounds like your NAMESPACE is missing importFrom(methods, show) ... ?
> I'm not sure why you could not reproduce the problem locally, given that
> check uses _R_CHECK_CODE_USAGE_WITH_ONLY_BASE_ATTACHED_=true by default.

Reading tools:::.check_packages I see that this environment variable is
not relevant to this particular test.  Still, do import generic functions
for which you define methods, from all packages != "base".

Mikael

> But it is hard to say anything without a link to the package sources ...
> 
> Mikael
> 
>> =============================================================
>>
>> I'm seeking help to understand and address this issue. show is defined like
>> this:
>>
>> #' Show method for class "hms".#'#' @param object - hms s4 object#'#'
>> @return It returns the names of the slots and the classes associated
>> with the#' slots in the "hms" class. It prints call details.#'#'
>> @export#'#' @examples
>> #' f <- function(x) x
>> #' result <- hms(fitness = f, lower = -5, upper = 5)
>> #' show(result)
>> setMethod("show", "hms", function(object) {
>>     cat("An object of class \"hms\"\n")
>>     cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
>>     cat("Available slots:\n")
>>     print(methods::slotNames(object))})
>>
>> And in the NAMESPACE there is a line that looks like this:
>>
>> exportMethods(show)
>>
>> I was investigating if the show is defined correctly and the GA package has
>> a very similar method:
>>
>> setMethod("show", "ga",function(object)
>>    { cat("An object of class \"ga\"\n")
>>      cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
>>      cat("Available slots:\n")
>>      print(slotNames(object))})
>>
>> I could not reproduce this NOTE on my personal machine with Windows.
>> On Mac OS I have never experienced this NOTE.
>>
>>
>> Best regards
>>
>> Wojciech Achtelik


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Mon Oct  9 17:22:17 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Mon, 9 Oct 2023 16:22:17 +0100
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <20231009105130.3f0d269c@Tarkus>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
 <20231009105130.3f0d269c@Tarkus>
Message-ID: <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>

Dear Ivan (and list)

Using Ivan's advice I traced the problem to a difference of opinio 
between Microsoft and R about paht names. I had mistakenly enclosed 
parts of the names in "" which was fine for MS but not R. Sys.which() 
was my saviour here.

Many thanks to Ivan for broadening my knowledge of useful functions like 
Sys.which().

Michael

On 09/10/2023 08:51, Ivan Krylov wrote:
> On Sun, 8 Oct 2023 16:47:41 +0100
> Michael Dewey <lists at dewey.myzen.co.uk> wrote:
> 
>> Following on from Ivan's advice I have now installed qpdf and
>> Ghostview. I have checked that they are both on my path by typing
>> their name at the command line and verifying they open.
> 
>> I then built the package with the --compress-vignettes=both and then
>> checked it with --as-cran I still get a complaint that it needs qpdf
>> to check compression.
> 
> While running R, does Sys.which('qpdf') return the path to qpdf.exe?
> Does Sys.getenv('PATH') match your expectations?
> 
>> I notice that in the Writing R Extensions manual in section 1.6.1 it
>> states "The full path to the qpdf command can be supplied as
>> environment variable R_QPDF ..."
>>
>> Is that a typo for "must be supplied"?
> 
> Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
> must work if it's on the %PATH%, but if all else fails, setting this
> environment variable should help.
> 
>> If it is where can I find the answers to questions about how R
>> accepts Windows paths? Do I need to enclose parts of names containing
>> spaces in "" signs?
> 
> It always depends on how the final command line is built by a
> particular function, but it should work by taking plain file paths
> without any escaping and quotation. The directory separators shouldn't
> matter either.
> 
> (tools::compactPDF uses system2(), so it quotes the path to the
> executable by itself.)
> 
>> Does it mean the path up to, in this case, bin or must I include
>> qpdf.exe after it?
> 
> It must be the full path to the executable, including the final
> qpdf.exe.
> 
>> I assume I do not need to do anything special to get it to find
>> Ghostscript?
> 
> tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
> If it's not there, R_GSCMD must be set to the full path to the
> executable. Judging by the NOTE you've received, it's Ghostscript that
> performed most of the compaction in your case.
> 

-- 
Michael


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Mon Oct  9 17:32:48 2023
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Mon, 09 Oct 2023 08:32:48 -0700
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
 <20231009105130.3f0d269c@Tarkus>
 <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>
Message-ID: <375250EA-92CA-4378-B754-8F871D8DA37F@dcn.davis.ca.us>

R could care less about what is in PATH... there is however a difference between Windows parsing PATH and how CMD lets you quote things interactively.

The whole point of PATH is to let you or R provide simple program names like qpdf without knowing where they are... Windows takes over and looks up where the program actually is based on the contents of PATH. How you get things into that environment variable can vary depending on which software you are using (CMD and R are two possible options), but the actual content is handled by the operating system (which is why PATH on Linux is formatted differently than PATH on Windows).

On October 9, 2023 8:22:17 AM PDT, Michael Dewey <lists at dewey.myzen.co.uk> wrote:
>Dear Ivan (and list)
>
>Using Ivan's advice I traced the problem to a difference of opinio between Microsoft and R about paht names. I had mistakenly enclosed parts of the names in "" which was fine for MS but not R. Sys.which() was my saviour here.
>
>Many thanks to Ivan for broadening my knowledge of useful functions like Sys.which().
>
>Michael
>
>On 09/10/2023 08:51, Ivan Krylov wrote:
>> On Sun, 8 Oct 2023 16:47:41 +0100
>> Michael Dewey <lists at dewey.myzen.co.uk> wrote:
>> 
>>> Following on from Ivan's advice I have now installed qpdf and
>>> Ghostview. I have checked that they are both on my path by typing
>>> their name at the command line and verifying they open.
>> 
>>> I then built the package with the --compress-vignettes=both and then
>>> checked it with --as-cran I still get a complaint that it needs qpdf
>>> to check compression.
>> 
>> While running R, does Sys.which('qpdf') return the path to qpdf.exe?
>> Does Sys.getenv('PATH') match your expectations?
>> 
>>> I notice that in the Writing R Extensions manual in section 1.6.1 it
>>> states "The full path to the qpdf command can be supplied as
>>> environment variable R_QPDF ..."
>>> 
>>> Is that a typo for "must be supplied"?
>> 
>> Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
>> must work if it's on the %PATH%, but if all else fails, setting this
>> environment variable should help.
>> 
>>> If it is where can I find the answers to questions about how R
>>> accepts Windows paths? Do I need to enclose parts of names containing
>>> spaces in "" signs?
>> 
>> It always depends on how the final command line is built by a
>> particular function, but it should work by taking plain file paths
>> without any escaping and quotation. The directory separators shouldn't
>> matter either.
>> 
>> (tools::compactPDF uses system2(), so it quotes the path to the
>> executable by itself.)
>> 
>>> Does it mean the path up to, in this case, bin or must I include
>>> qpdf.exe after it?
>> 
>> It must be the full path to the executable, including the final
>> qpdf.exe.
>> 
>>> I assume I do not need to do anything special to get it to find
>>> Ghostscript?
>> 
>> tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
>> If it's not there, R_GSCMD must be set to the full path to the
>> executable. Judging by the NOTE you've received, it's Ghostscript that
>> performed most of the compaction in your case.
>> 
>

-- 
Sent from my phone. Please excuse my brevity.


From kke@h@v @end|ng |rom u||@edu  Mon Oct  9 20:59:05 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Mon, 9 Oct 2023 18:59:05 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
Message-ID: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>

Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Oct  9 22:08:43 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 9 Oct 2023 16:08:43 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>

What were you using as "outdir"?


On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
> Hi,
> 
> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
> 
>    if (is.null(outdir) || length(outdir) == 0) {
>      outdir <- tempdir()
>    }
> 
>    # Save the plot as a raster file
>    fp <- file.path(outdir, paste("plots", "/",
>                                  typ, "_",
>                                  stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>                                  ".tif", sep = ""))
>      # Create the "plots" directory if it doesn't exist
>    if (!dir.exists(fp)) {
>      dir.create(fp, recursive = TRUE)
>    }
> 
>    terra::writeRaster(rast, overwrite = TRUE,
>                       filename = fp,
>                       gdal = c("COMPRESS=NONE"))
>    message(paste("raster created", fp, sep = ": "), "\n")
> }
> 
> Error ?V
> 
>    Error: [writeRaster] cannot write file
>     12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>     13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     15.             ?|?wterra (local) .local(x, filename, ...)
>     16.               ?|?wterra:::messages(x, "writeRaster")
>     17.                 ?|?wterra:::error(f, x at pnt$getError())
> 
> 
> 
> Best Regards,
> Krishna Keshav
> 
> 	[[alternative HTML version deleted]]
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From berryboe@@enkoo| @end|ng |rom hotm@||@com  Mon Oct  9 22:13:15 2023
From: berryboe@@enkoo| @end|ng |rom hotm@||@com (Berry Boessenkool)
Date: Mon, 9 Oct 2023 20:13:15 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <GV2PR02MB877038BD348BA8712953B3EAD5CEA@GV2PR02MB8770.eurprd02.prod.outlook.com>


Are you intentionally running dir.exists on _file_names?
dir.exists("existing_folder/imaginary.file") shows FALSE, somwhat counterintuitively.
You might want to wrap the filenames in dirname...

Regards,
Berry
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Keshav, Krishna <kkeshav at ufl.edu>
Sent: Monday, October 9, 2023 20:59
To: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file

Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

        [[alternative HTML version deleted]]


	[[alternative HTML version deleted]]


From kke@h@v @end|ng |rom u||@edu  Tue Oct 10 00:56:50 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Mon, 9 Oct 2023 22:56:50 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
Message-ID: <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>

Outdir is either a directory like getwd(), tempdir() etc or empty/null. If it is empty/null, then I set it to tempdir().

if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
}
I am not sure how to debug when running it in Rbuilder. But you can look at results here - https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5

Best Regards,
Krishna Keshav

From: Duncan Murdoch <murdoch.duncan at gmail.com>
Date: Monday, October 9, 2023 at 4:08 PM
To: Keshav, Krishna <kkeshav at ufl.edu>, r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Error: [writeRaster] cannot write file
[External Email]

What were you using as "outdir"?


On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
> Hi,
>
> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
>
>    if (is.null(outdir) || length(outdir) == 0) {
>      outdir <- tempdir()
>    }
>
>    # Save the plot as a raster file
>    fp <- file.path(outdir, paste("plots", "/",
>                                  typ, "_",
>                                  stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>                                  ".tif", sep = ""))
>      # Create the "plots" directory if it doesn't exist
>    if (!dir.exists(fp)) {
>      dir.create(fp, recursive = TRUE)
>    }
>
>    terra::writeRaster(rast, overwrite = TRUE,
>                       filename = fp,
>                       gdal = c("COMPRESS=NONE"))
>    message(paste("raster created", fp, sep = ": "), "\n")
> }
>
> Error ?V
>
>    Error: [writeRaster] cannot write file
>     12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>     13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     15.             ?|?wterra (local) .local(x, filename, ...)
>     16.               ?|?wterra:::messages(x, "writeRaster")
>     17.                 ?|?wterra:::error(f, x at pnt$getError())
>
>
>
> Best Regards,
> Krishna Keshav
>
>       [[alternative HTML version deleted]]
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Ckkeshav%40ufl.edu%7Cddd83781762040d664dc08dbc9038ec7%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638324789348072931%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=mBzV%2BSJoOTTnSpRzu0EvLT8sZ2NJ1OlhSGXqNCvGWB4%3D&reserved=0<https://stat.ethz.ch/mailman/listinfo/r-package-devel>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 10 01:16:17 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 9 Oct 2023 19:16:17 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
 <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <c0c1ff56-b2ab-4810-a897-265ba52ba28b@gmail.com>

On 09/10/2023 6:56 p.m., Keshav, Krishna wrote:
> Outdir is either a directory like getwd(), tempdir() etc or empty/null. 
> If it is empty/null, then I set it to tempdir().

That doesn't answer the question, and the link you provided doesn't 
answer it either, as far as I can see.  In the test and the vignette 
that generated the errors, something specific was passed as outdir.  But 
what? If it was getwd(), that's bound to fail -- you don't have 
permission to write there.  tempdir() should have worked, but Berry 
pointed out some other things that might be problems.

Duncan Murdoch

> 
> /if (is.null(outdir) || length(outdir) == 0) {
>  ??? outdir <- tempdir()/
> 
> /}///
> 
> I am not sure how to debug when running it in Rbuilder. But you can look 
> at results here - 
> https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5 <https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5>
> 
> Best Regards,
> 
> Krishna Keshav
> 
> *From: *Duncan Murdoch <murdoch.duncan at gmail.com>
> *Date: *Monday, October 9, 2023 at 4:08 PM
> *To: *Keshav, Krishna <kkeshav at ufl.edu>, r-package-devel at r-project.org 
> <r-package-devel at r-project.org>
> *Subject: *Re: [R-pkg-devel] Error: [writeRaster] cannot write file
> 
> [External Email]
> 
> What were you using as "outdir"?
> 
> 
> On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
>> Hi,
>>
>> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
>> Snippet ?V
>> .saverast <- function(typ, rast, outdir) {
>>
>>??? if (is.null(outdir) || length(outdir) == 0) {
>>????? outdir <- tempdir()
>>??? }
>>
>>??? # Save the plot as a raster file
>>??? fp <- file.path(outdir, paste("plots", "/",
>>????????????????????????????????? typ, "_",
>>????????????????????????????????? stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>>????????????????????????????????? ".tif", sep = ""))
>>????? # Create the "plots" directory if it doesn't exist
>>??? if (!dir.exists(fp)) {
>>????? dir.create(fp, recursive = TRUE)
>>??? }
>>
>>??? terra::writeRaster(rast, overwrite = TRUE,
>>?????????????????????? filename = fp,
>>?????????????????????? gdal = c("COMPRESS=NONE"))
>>??? message(paste("raster created", fp, sep = ": "), "\n")
>> }
>>
>> Error ?V
>>
>>??? Error: [writeRaster] cannot write file
>>???? 12.???????? ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>>???? 13.?????????? ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>>???? 14.?????????? ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>>???? 15.???????????? ?|?wterra (local) .local(x, filename, ...)
>>???? 16.?????????????? ?|?wterra:::messages(x, "writeRaster")
>>???? 17.???????????????? ?|?wterra:::error(f, x at pnt$getError())
>>
>>
>>
>> Best Regards,
>> Krishna Keshav
>>
>>?????? [[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Ckkeshav%40ufl.edu%7Cddd83781762040d664dc08dbc9038ec7%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638324789348072931%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=mBzV%2BSJoOTTnSpRzu0EvLT8sZ2NJ1OlhSGXqNCvGWB4%3D&reserved=0 <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From |kw@|mmo @end|ng |rom gm@||@com  Tue Oct 10 01:36:44 2023
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Mon, 9 Oct 2023 19:36:44 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>

You wrote

# create the plots directory if it does not exist

but then created a directory named outdir/plots/typ_Sys.time.tif

You need to rewrite the code like:

plotsdir <- file.path(outdir, "plots")
fp <- file.path(plotsdir,  paste(typ, "_",
    stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
# Create the "plots" directory if it doesn't exist
  if (!dir.exists(plotsdir)) {
    dir.create(plotsdir, recursive = TRUE)
  }

On Mon, Oct 9, 2023, 15:49 Keshav, Krishna <kkeshav at ufl.edu> wrote:

> Hi,
>
> I am developing an R package where I need to save Raster file with .tif
> extension to the tempdir(). I am using terra::writeRaster for the same.
> While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
>
>   if (is.null(outdir) || length(outdir) == 0) {
>     outdir <- tempdir()
>   }
>
>   # Save the plot as a raster file
>   fp <- file.path(outdir, paste("plots", "/",
>                                 typ, "_",
>                                 stringr::str_replace_all(Sys.time(),
> "[^a-zA-Z0-9]", ""),
>                                 ".tif", sep = ""))
>     # Create the "plots" directory if it doesn't exist
>   if (!dir.exists(fp)) {
>     dir.create(fp, recursive = TRUE)
>   }
>
>   terra::writeRaster(rast, overwrite = TRUE,
>                      filename = fp,
>                      gdal = c("COMPRESS=NONE"))
>   message(paste("raster created", fp, sep = ": "), "\n")
> }
>
> Error ?V
>
>   Error: [writeRaster] cannot write file
>    12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>    13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename =
> fp, gdal = c("COMPRESS=NONE"))
>    14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename =
> fp, gdal = c("COMPRESS=NONE"))
>    15.             ?|?wterra (local) .local(x, filename, ...)
>    16.               ?|?wterra:::messages(x, "writeRaster")
>    17.                 ?|?wterra:::error(f, x at pnt$getError())
>
>
>
> Best Regards,
> Krishna Keshav
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From kke@h@v @end|ng |rom u||@edu  Tue Oct 10 02:30:36 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Tue, 10 Oct 2023 00:30:36 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>
Message-ID: <CO6PR22MB2433A9762FB9A549590D9ECEB6CDA@CO6PR22MB2433.namprd22.prod.outlook.com>

Hi,

This works. I think this is also an implementation of what Berry and Duncan suggested earlier. Thanks.

Best Regards,
Krishna Keshav

From: Iris Simmons <ikwsimmo at gmail.com>
Date: Monday, October 9, 2023 at 7:37 PM
To: Keshav, Krishna <kkeshav at ufl.edu>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Error: [writeRaster] cannot write file
[External Email]
You wrote

# create the plots directory if it does not exist

but then created a directory named outdir/plots/typ_Sys.time.tif

You need to rewrite the code like:

plotsdir <- file.path(outdir, "plots")
fp <- file.path(plotsdir,  paste(typ, "_",
    stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
# Create the "plots" directory if it doesn't exist
  if (!dir.exists(plotsdir)) {
    dir.create(plotsdir, recursive = TRUE)
  }

On Mon, Oct 9, 2023, 15:49 Keshav, Krishna <kkeshav at ufl.edu<mailto:kkeshav at ufl.edu>> wrote:
Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org<mailto:R-package-devel at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From cdr|ver@@u@ @end|ng |rom gm@||@com  Tue Oct 10 16:36:31 2023
From: cdr|ver@@u@ @end|ng |rom gm@||@com (Charles Driver)
Date: Tue, 10 Oct 2023 16:36:31 +0200
Subject: [R-pkg-devel] pkg check: SyntaxError: break must be inside loop or
 switch
Message-ID: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>

R-under-devel via winbuilder is giving me the following note, for the
ctsem package. I have no idea what it refers to -- I chased down the
few instances of using the break function in my package and reworked
the code to get rid of them, but didn't help. Any clues, or idea why
this note is so uninformative, would be welcome...

* checking data for non-ASCII characters ... NOTE
  SyntaxError: break must be inside loop or switch
      at :2513

Cheers,
Charles


