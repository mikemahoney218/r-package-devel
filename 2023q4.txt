From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 10:29:18 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 08:29:18 +0000
Subject: [R-pkg-devel] Testing.
Message-ID: <20231001212918.326ab18c@rolf-Latitude-E7470>


I'm having a problem .... please excuse the noise.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619



From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 10:31:31 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 08:31:31 +0000
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
Message-ID: <20231001211547.4c46512e@rolf-Latitude-E7470>


When I submitted an update of my Iso package a short time ago, it was
rejected as not passing the incoming checks automatically.  Explicitly,
I got a WARNING:

> * checking sizes of PDF files under 'inst/doc' ... WARNING
> 'gs+qpdf' made some significant size reductions:
>      compacted 'algorithm.pdf' from 394Kb to 99Kb
>   consider running tools::compactPDF(gs_quality = "ebook") on these
> files

I did as instructed and ran

    tools::compactPDF("./algorithm.pdf",gs_quality="ebook")

having started R in the inst/vignettes directory, which is where the
file algorithm.pdf is to be found.

According to "ls -l" the size of algorithm.pdf was about 109 Kb. before
I ran compactPDF() and about 90 Kb. afterward.

I do not understand:

    * the reference to inst/doc (there is no such directory)
    * where the sizes 349 Kb and 99 Kb come from
    * what I have to do to get Iso to pass the required checks

The email that I received from CRAN (under the return address
ligges at statistik.tu-dortmund.de) said:

> If you are not sure how to fix the problems shown, please ask for
> help on the R-package-devel mailing list:

Consequently I am asking! Can anyone set me on the path to
enlightenment?  Thanks.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619



From kry|ov@r00t @end|ng |rom gm@||@com  Sun Oct  1 14:22:34 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 1 Oct 2023 15:22:34 +0300
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
In-Reply-To: <20231001211547.4c46512e@rolf-Latitude-E7470>
References: <20231001211547.4c46512e@rolf-Latitude-E7470>
Message-ID: <20231001152234.6bdd40ec@Tarkus>

On Sun,  1 Oct 2023 08:31:31 +0000
Rolf Turner <rolfturner at posteo.net> wrote:

> I do not understand:

>    * the reference to inst/doc (there is no such directory)

When you run R CMD build in order to produce a new Iso-*.tar.gz, R runs
Sweave and pdflatex on vignettes/algorithm.Rnw in order to produce
inst/doc/algorithm.pdf inside the resulting tarball (but not the
original source tree on your computer).

>    * what I have to do to get Iso to pass the required checks

Does it help to run R CMD build --compact-vignettes=both? This should
let R run tools::compactPDF on inst/doc/algorithm.pdf it generates
before placing it inside the package tarball.

I think that R doesn't know anything about files under inst/vignettes
in the source tree.

-- 
Best regards,
Ivan



From ro||turner @end|ng |rom po@teo@net  Sun Oct  1 23:01:13 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun,  1 Oct 2023 21:01:13 +0000
Subject: [R-pkg-devel] Problem with "compacting" pdf files.
In-Reply-To: <20231001152234.6bdd40ec@Tarkus>
References: <20231001211547.4c46512e@rolf-Latitude-E7470>
 <20231001152234.6bdd40ec@Tarkus>
Message-ID: <20231002100113.2ce1c902@rolf-Latitude-E7470>

On Sun, 1 Oct 2023 15:22:34 +0300
Ivan Krylov <krylov.r00t at gmail.com> wrote:

> On Sun,  1 Oct 2023 08:31:31 +0000
> Rolf Turner <rolfturner at posteo.net> wrote:
> 
> > I do not understand:
> 
> >    * the reference to inst/doc (there is no such directory)
> 
> When you run R CMD build in order to produce a new Iso-*.tar.gz, R
> runs Sweave and pdflatex on vignettes/algorithm.Rnw in order to
> produce inst/doc/algorithm.pdf inside the resulting tarball (but not
> the original source tree on your computer).
> 
> >    * what I have to do to get Iso to pass the required checks
> 
> Does it help to run R CMD build --compact-vignettes=both? This should
> let R run tools::compactPDF on inst/doc/algorithm.pdf it generates
> before placing it inside the package tarball.
> 
> I think that R doesn't know anything about files under inst/vignettes
> in the source tree.

Thanks Ivan.  That may well be the key.  When I unpacked the tarball
created without the --compact-vignettes=both flag, I found that
inst/doc/algorithm.pdf had size 403 Kb, whereas with that flag set
it had size 108 Kb.

I'll re-submit now and see what happens.

I *really* think that the instructions from CRAN could have been
clearer!  Without your guidance I'd have been at a total loss.

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619



From j@goreck| @end|ng |rom w|t@edu@p|  Tue Oct  3 16:45:26 2023
From: j@goreck| @end|ng |rom w|t@edu@p| (Jan Gorecki)
Date: Tue, 3 Oct 2023 16:45:26 +0200
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
Message-ID: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>

Hello,

I noticed some packages define Imports in DESCRIPTION file listing base R
packages like methods, utils, etc.

My question is that if it is necessary to list those* dependencies in
DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

* by "those" I mean packages listed by:

in tools:::.get_standard_package_names()$base

	[[alternative HTML version deleted]]



From henr|k@bengt@@on @end|ng |rom gm@||@com  Tue Oct  3 17:50:14 2023
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Tue, 3 Oct 2023 08:50:14 -0700
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
In-Reply-To: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>
References: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>
Message-ID: <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>

On Tue, Oct 3, 2023 at 7:46?AM Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
>
> Hello,
>
> I noticed some packages define Imports in DESCRIPTION file listing base R
> packages like methods, utils, etc.
>
> My question is that if it is necessary to list those* dependencies in
> DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

You do *not* have to declare base-R packages as dependencies in the
DESCRIPTION file.  'R CMD check' and 'R CMD check --as-cran' will not
complain about them.

I can't speak for others, but, I choose to declare all(*) my base-R
package dependencies in my DESCRIPTION files for a reason.  This makes
it explicit what packages my package rely on, including which of the
base-R packages.  For instance, it's nice to be able to tell when the
'parallel' or 'tcltk' package is used from the DESCRIPTION file (and
the online CRAN package page, if on CRAN).

(*) The exception is the 'base' package, because that is such a
fundamental package in R and is always loaded.  The other base-R
packages are theoretically optional when it comes to running R, e.g.

$ R_ENABLE_JIT=0 Rscript --vanilla --default-packages=base -e
"loadedNamespaces()"
[1] "base"

/Henrik

>
> * by "those" I mean packages listed by:
>
> in tools:::.get_standard_package_names()$base
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From @|j|@ng @end|ng |rom bccrc@c@  Tue Oct  3 19:34:04 2023
From: @|j|@ng @end|ng |rom bccrc@c@ (Aixiang Jiang)
Date: Tue, 3 Oct 2023 17:34:04 +0000
Subject: [R-pkg-devel] DESCRIPTION file Imports of base R packages
In-Reply-To: <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>
References: <CAOO9MKUOviqNjYxC9JgHJOmTqwFUOgLeUWqTMCTbEPw3vQPWXg@mail.gmail.com>,
 <CAFDcVCQUwQzh8cwKrU7JZfJUc57rzRMY_kLwaUedp+8aqo0FAw@mail.gmail.com>
Message-ID: <1696354445275.65575@bccrc.ca>

Thank you - all!

Aixiang
________________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Henrik Bengtsson <henrik.bengtsson at gmail.com>
Sent: Tuesday, October 3, 2023 8:50 AM
To: Jan Gorecki
Cc: List r-package-devel
Subject: Re: [R-pkg-devel] DESCRIPTION file Imports of base R packages

This email came from an EXTERNAL SENDER. If you think this message is suspicious, please do not open any attached files or links, and forward it as an attachment to spammail at bccrc.ca



On Tue, Oct 3, 2023 at 7:46?AM Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
>
> Hello,
>
> I noticed some packages define Imports in DESCRIPTION file listing base R
> packages like methods, utils, etc.
>
> My question is that if it is necessary to list those* dependencies in
> DESCRIPTION file, or is it enough to have them listed in NAMESPACE file?

You do *not* have to declare base-R packages as dependencies in the
DESCRIPTION file.  'R CMD check' and 'R CMD check --as-cran' will not
complain about them.

I can't speak for others, but, I choose to declare all(*) my base-R
package dependencies in my DESCRIPTION files for a reason.  This makes
it explicit what packages my package rely on, including which of the
base-R packages.  For instance, it's nice to be able to tell when the
'parallel' or 'tcltk' package is used from the DESCRIPTION file (and
the online CRAN package page, if on CRAN).

(*) The exception is the 'base' package, because that is such a
fundamental package in R and is always loaded.  The other base-R
packages are theoretically optional when it comes to running R, e.g.

$ R_ENABLE_JIT=0 Rscript --vanilla --default-packages=base -e
"loadedNamespaces()"
[1] "base"

/Henrik

>
> * by "those" I mean packages listed by:
>
> in tools:::.get_standard_package_names()$base
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

From v|nhd|zzo @end|ng |rom gm@||@com  Tue Oct  3 23:52:26 2023
From: v|nhd|zzo @end|ng |rom gm@||@com (Vinh Nguyen)
Date: Tue, 3 Oct 2023 14:52:26 -0700
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
Message-ID: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>

Dear members of R-package-devel,

CRAN has the following policy: Packages which use Internet resources
should fail gracefully with an informative message if the resource is
not available or has changed (and not give a check warning nor error).

I have a CRAN-accepted package with vignettes that use Rmarkdown. One
of the vignettes involves a lot of images, so rather than embed the
raw images in the vignette, I reference the images on Flickr (to keep
the package size small enough to be hosted on CRAN). Every half year
or so, I'll get a message from CRAN maintainers that the package is
not failing gracefully on one of their servers due to their build and
testing processes.  The error message looks as follows:

Could not fetch
https://live.staticflickr.com/65535/52281215570_5f9cc90a12_o.png
     HttpExceptionRequest Request {
      host = "live.staticflickr.com"
      port = 443
      secure = True
      requestHeaders = []
      path = "/65535/52281215570_5f9cc90a12_o.png"
      queryString = ""
      method = "GET"
      proxy = Nothing
      rawBody = False
      redirectCount = 10
      responseTimeout = ResponseTimeoutDefault
      requestVersion = HTTP/1.1
     }
      (ConnectionFailure Network.Socket.getAddrInfo (called with
preferred socket type/protocol: AddrInfo {addrFlags = [AI_ADDRCONFIG],
addrFamily = AF_UNSPEC, addrSocketType = Stream, addrProtocol = 0,
addrAddress = <assumed to be undefined>, addrCanonName = <assumed to be
undefined>}, host name: Just "live.staticflickr.com", service name: Just
"443"): does not exist (Name or service not known))
     Error: processing vignette
'Ex-04-Webscraping-Online-Data-Files.Rmd' failed with diagnostics:
     pandoc document conversion failed with error 61

What's the recommended way for making this fail gracefully?  Again, I
am pointing to the images online.  I am aware of .Rbuildignore, but
using this would make the vignettes not hosted on the CRAN package
page.

Thanks in advance for your help.

-- Vinh



From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct  4 10:34:08 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 4 Oct 2023 11:34:08 +0300
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
In-Reply-To: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
References: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
Message-ID: <20231004113408.2734534a@Tarkus>

On Tue, 3 Oct 2023 14:52:26 -0700
Vinh Nguyen <vinhdizzo at gmail.com> wrote:

> Could not fetch
> https://live.staticflickr.com/65535/52281215570_5f9cc90a12_o.png

This is Pandoc failing to bundle external resources from the final
Markdown file, not your R code.

>      Error: processing vignette
> 'Ex-04-Webscraping-Online-Data-Files.Rmd' failed with diagnostics:
>      pandoc document conversion failed with error 61

My psychic debugging powers tell me that this is the vignette you're
having problems with:
https://github.com/vinhdizzo/IRexamples/blob/main/vignettes/Ex-04-Webscraping-Online-Data-Files.Rmd

If you look at the vignette as it is on CRAN, you can see that the
images aren't actually loaded from live.staticflickr.com, but are
included as base64 PNG blobs in the HTML file. This is much less
efficient than a plain PNG file. I think that your package will become
smaller if you disable this bundling and include the original PNG files
in your package. You may be able to squeeze some more savings by using
pngcrush / optipng to compress the images further.

The parameter responsible for this base64 encoding is called
self_contained, which defaults to TRUE in the rmarkdown::html_document
format, which prettydoc::html_pretty inherits from. Set it to FALSE in
the YAML header of the vignette.

Note that some other scripts and CSS files may be loaded from external
sources if you do that. As a user, I would prefer this not to be the
case, but I don't know enough about rmarkdown to set your vignette up
to bundle everything except the images.

-- 
Best regards,
Ivan



From dewey @end|ng |rom dunn|ngton@c@  Thu Oct  5 03:38:35 2023
From: dewey @end|ng |rom dunn|ngton@c@ (Dewey Dunnington)
Date: Wed, 04 Oct 2023 22:38:35 -0300
Subject: [R-pkg-devel] Status of adbcpostgresql
Message-ID: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>

Hi all,

I submitted the first release of adbcpostgresql (an R repackaging of 
ADBC's Postgres driver) about a month ago and it has been pending human 
inspection (I think) since then. I did reply-all to the email once to 
inquire about status but haven't heard back. Where is the best place to 
direct communication about the status of the package? I am certainly 
happy to fix any problems that arise.

Cheers,

-dewey



From ||u|@@rev|||@ @end|ng |rom gm@||@com  Thu Oct  5 09:39:45 2023
From: ||u|@@rev|||@ @end|ng |rom gm@||@com (=?UTF-8?Q?Llu=C3=ADs_Revilla?=)
Date: Thu, 5 Oct 2023 09:39:45 +0200
Subject: [R-pkg-devel] Status of adbcpostgresql
In-Reply-To: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>
References: <7960f13ed108f6a0fbef7ac05de23526@dunnington.ca>
Message-ID: <CAN+W6_v35eQziWhYqHdMgSqtY3H+Ht-N7v64z+jJ_0sw7PYt8A@mail.gmail.com>

Hi Dewey,

Currently there are several packages on a subfolder for human inspection.
I don't think you can do anything else: sending this email might help
drawing attention from your reviewer to your package.
There might be some issues in the package that you'll need to address, try
to find them in advance or prepare a reply for them.

Probably the reviewer is busy with other non-CRAN related things. Or maybe
the review fell between emails.
After a couple of weeks you could try again sending an email to the
reviewer.

Best,

Llu?s

On Thu, 5 Oct 2023 at 03:39, Dewey Dunnington <dewey at dunnington.ca> wrote:

> Hi all,
>
> I submitted the first release of adbcpostgresql (an R repackaging of
> ADBC's Postgres driver) about a month ago and it has been pending human
> inspection (I think) since then. I did reply-all to the email once to
> inquire about status but haven't heard back. Where is the best place to
> direct communication about the status of the package? I am certainly
> happy to fix any problems that arise.
>
> Cheers,
>
> -dewey
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From v|nhd|zzo @end|ng |rom gm@||@com  Fri Oct  6 14:59:10 2023
From: v|nhd|zzo @end|ng |rom gm@||@com (Vinh Nguyen)
Date: Fri, 6 Oct 2023 05:59:10 -0700
Subject: [R-pkg-devel] Rmarkdown package vignette that reference online
 images: how to fail gracefully?
In-Reply-To: <20231004113408.2734534a@Tarkus>
References: <CA+2Dmwj1LG6+gLTLG1aA7FGourHEQ39r4qPOPBq6SNzSv4v2Vw@mail.gmail.com>
 <20231004113408.2734534a@Tarkus>
Message-ID: <CA+2DmwhmPgnDomuP23vnRTz8tD5wBXpfwbt4eiyw_Hy+_9Nq9Q@mail.gmail.com>

>
>
> The parameter responsible for this base64 encoding is called
> self_contained, which defaults to TRUE in the rmarkdown::html_document
> format, which prettydoc::html_pretty inherits from. Set it to FALSE in
> the YAML header of the vignette.
>
> Note that some other scripts and CSS files may be loaded from external
> sources if you do that. As a user, I would prefer this not to be the
> case, but I don't know enough about rmarkdown to set your vignette up
> to bundle everything except the images
>


Thanks for the detailed investigation and analysis, Ivan. For now, I've
followed your suggestion and added the option `self_contained: false`. The
revised package is now on CRAN, and you are correct that css files are no
longer contained for the version sitting on CRAN, so the vignette is less
pretty looking. I'll investigate if there are any other workarounds.

Your assistance is much appreciated.

>

	[[alternative HTML version deleted]]



From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Oct  6 16:36:45 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 6 Oct 2023 15:36:45 +0100
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
Message-ID: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>

I am trying to update my CRAN package metap. When I ran a final check on 
winbuilder I got the warning

* checking sizes of PDF files under 'inst/doc' ... WARNING
   'gs+qpdf' made some significant size reductions:
      compacted 'compare.pdf' from 498Kb to 243Kb
      compacted 'plotmetap.pdf' from 349Kb to 91Kb
   consider running tools::compactPDF(gs_quality = "ebook") on these files,
   or build the source package with --compact-vignettes=both

But I did use the option --compact-vignettes=both when I built the tarball.

I do have gs installed but not qpdf. I built the package under Windows 
if that is relevant.

Any suggestions?

-- 
Michael



From kry|ov@r00t @end|ng |rom gm@||@com  Fri Oct  6 16:48:28 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 6 Oct 2023 17:48:28 +0300
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
In-Reply-To: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
Message-ID: <20231006174828.651b58c7@arachnoid>

? Fri, 6 Oct 2023 15:36:45 +0100
Michael Dewey <lists at dewey.myzen.co.uk> ?????:

> But I did use the option --compact-vignettes=both when I built the
> tarball.

> I do have gs installed but not qpdf. I built the package under
> Windows if that is relevant.

Is the Ghostscript executable on the %PATH%? It might help to install a
newer version. It may also be informative to extract the vignette *.pdf
files from the source package tarball and run tools::compactPDF(pdfs,
gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
point.

-- 
Best regards,
Ivan



From ||@t@ @end|ng |rom dewey@myzen@co@uk  Fri Oct  6 17:30:26 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Fri, 6 Oct 2023 16:30:26 +0100
Subject: [R-pkg-devel] Problem compressing vignettes for CRAN
In-Reply-To: <20231006174828.651b58c7@arachnoid>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
Message-ID: <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>

Dear Ivan

You must have psychic powers. After some digging I find that the copy 
installed by TexLive is hidden from other software so I need to install 
it again. I suppose while I am at it I should try installing qpdf.

Michael

On 06/10/2023 15:48, Ivan Krylov wrote:
> ? Fri, 6 Oct 2023 15:36:45 +0100
> Michael Dewey <lists at dewey.myzen.co.uk> ?????:
> 
>> But I did use the option --compact-vignettes=both when I built the
>> tarball.
> 
>> I do have gs installed but not qpdf. I built the package under
>> Windows if that is relevant.
> 
> Is the Ghostscript executable on the %PATH%? It might help to install a
> newer version. It may also be informative to extract the vignette *.pdf
> files from the source package tarball and run tools::compactPDF(pdfs,
> gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
> point.
> 

-- 
Michael



From w@chte||k @end|ng |rom gm@||@com  Sat Oct  7 12:25:14 2023
From: w@chte||k @end|ng |rom gm@||@com (Wojciech Achtelik)
Date: Sat, 7 Oct 2023 12:25:14 +0200
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
Message-ID: <CABYZkg=KbFch1WsJN_E-nfrMfoNBNjX2rZyVpLpZgdY507eaAQ@mail.gmail.com>

Hi,

I recently submitted my first R package to CRAN, and I encountered a NOTE
during the checking process. The NOTE looks like this:

=============================================================
Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: whether the namespace can be loaded with stated dependencies,
Result: NOTE
  Warning: no function found corresponding to methods exports from 'hmsr'
for: 'show'

  A namespace must be able to be loaded with just the base namespace
  loaded: otherwise if the namespace gets loaded by a saved object, the
  session will be unable to start.

  Probably some imports need to be declared in the NAMESPACE file.
=============================================================

I'm seeking help to understand and address this issue. show is defined like
this:

#' Show method for class "hms".#'#' @param object - hms s4 object#'#'
@return It returns the names of the slots and the classes associated
with the#' slots in the "hms" class. It prints call details.#'#'
@export#'#' @examples
#' f <- function(x) x
#' result <- hms(fitness = f, lower = -5, upper = 5)
#' show(result)
setMethod("show", "hms", function(object) {
  cat("An object of class \"hms\"\n")
  cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
  cat("Available slots:\n")
  print(methods::slotNames(object))})

And in the NAMESPACE there is a line that looks like this:

exportMethods(show)

I was investigating if the show is defined correctly and the GA package has
a very similar method:

setMethod("show", "ga",function(object)
 { cat("An object of class \"ga\"\n")
   cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
   cat("Available slots:\n")
   print(slotNames(object))})

I could not reproduce this NOTE on my personal machine with Windows.
On Mac OS I have never experienced this NOTE.


Best regards

Wojciech Achtelik

	[[alternative HTML version deleted]]



From ||@t@ @end|ng |rom dewey@myzen@co@uk  Sun Oct  8 17:47:41 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Sun, 8 Oct 2023 16:47:41 +0100
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
Message-ID: <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>

Following on from Ivan's advice I have now installed qpdf and Ghostview. 
I have checked that they are both on my path by typing their name at the 
command line and verifying they open. I then built the package with the 
--compress-vignettes=both and then checked it with --as-cran I still get 
a complaint that it needs qpdf to check compression.

I notice that in the Writing R Extensions manual in section 1.6.1 it states
"The full path to the qpdf command can be supplied as environment 
variable R_QPDF ..."

Is that a typo for "must be supplied"? If it is where can I find the 
answers to questions about how R accepts Windows paths? Do I need to 
enclose parts of names containing spaces in "" signs? Does it mean the 
path up to, in this case, bin or must I include qpdf.exe after it?

I assume I do not need to do anything special to get it to find Ghostscript?

Michael

On 06/10/2023 16:30, Michael Dewey wrote:
> Dear Ivan
> 
> You must have psychic powers. After some digging I find that the copy 
> installed by TexLive is hidden from other software so I need to install 
> it again. I suppose while I am at it I should try installing qpdf.
> 
> Michael
> 
> On 06/10/2023 15:48, Ivan Krylov wrote:
>> ? Fri, 6 Oct 2023 15:36:45 +0100
>> Michael Dewey <lists at dewey.myzen.co.uk> ?????:
>>
>>> But I did use the option --compact-vignettes=both when I built the
>>> tarball.
>>
>>> I do have gs installed but not qpdf. I built the package under
>>> Windows if that is relevant.
>>
>> Is the Ghostscript executable on the %PATH%? It might help to install a
>> newer version. It may also be informative to extract the vignette *.pdf
>> files from the source package tarball and run tools::compactPDF(pdfs,
>> gs_quality='ebook', verbose = TRUE) to see whether it breaks at any
>> point.
>>
> 

-- 
Michael



From m@tth|@@-gond@n @end|ng |rom gmx@de  Sun Oct  8 21:41:14 2023
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Sun, 8 Oct 2023 21:41:14 +0200
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
Message-ID: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>

Dear developers and CRAN people,

I get some linker warnings on the macOS build server,

ld: warning: direct access in function '?' from file '?' to global weak symbol '?' from file '?' means the weak symbol cannot be overridden at runtime. This was likely caused by different translation units being compiled with different visibility settings.

Writing R Extensions (Section 6.16) says that visibility attributes are not supported on macOS nor Windows. If I add $(CXX_VISIBILITY) to PKG_CXXFLAGS, the warnings are still there, and I can see from the compiler log that the flags do not have any effect on macOS. However, if I add -fvisibility=hidden to PKG_CXXFLAGS, the warnings disappear (but I get a reminder from R CMD check that -fvisibility=hidden is not portable). I am wondering if $(CXX_VISIBILITY) could be supported on macOS.

Best wishes,

Matthias

This is the build log of the package: https://www.r-project.org/nosvn/R.check/r-release-macos-arm64/rswipl-00install.html


	[[alternative HTML version deleted]]



From @|mon@urb@nek @end|ng |rom R-project@org  Sun Oct  8 22:29:50 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 9 Oct 2023 09:29:50 +1300
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
In-Reply-To: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
References: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
Message-ID: <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>

Matthias,

this has nothing to do with R, but rather your code. You have the wrong order of headers: the SWI headers mess up visibility macros, so you have to include them *after* Rcpp.h.

Cheers,
Simon


> On 9/10/2023, at 8:41 AM, Matthias Gondan <matthias-gondan at gmx.de> wrote:
> 
> Dear developers and CRAN people,
> 
> I get some linker warnings on the macOS build server,
> 
> ld: warning: direct access in function '?' from file '?' to global weak symbol '?' from file '?' means the weak symbol cannot be overridden at runtime. This was likely caused by different translation units being compiled with different visibility settings.
> 
> Writing R Extensions (Section 6.16) says that visibility attributes are not supported on macOS nor Windows. If I add $(CXX_VISIBILITY) to PKG_CXXFLAGS, the warnings are still there, and I can see from the compiler log that the flags do not have any effect on macOS. However, if I add -fvisibility=hidden to PKG_CXXFLAGS, the warnings disappear (but I get a reminder from R CMD check that -fvisibility=hidden is not portable). I am wondering if $(CXX_VISIBILITY) could be supported on macOS.
> 
> Best wishes,
> 
> Matthias
> 
> This is the build log of the package: https://www.r-project.org/nosvn/R.check/r-release-macos-arm64/rswipl-00install.html
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 



From j@g@nmn2 @end|ng |rom gm@||@com  Sun Oct  8 23:43:57 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Sun, 8 Oct 2023 17:43:57 -0400
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
In-Reply-To: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
References: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
Message-ID: <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>

> Hi,
> 
> I recently submitted my first R package to CRAN, and I encountered a NOTE
> during the checking process. The NOTE looks like this:
> 
> =============================================================
> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
> Check: whether the namespace can be loaded with stated dependencies,
> Result: NOTE
>    Warning: no function found corresponding to methods exports from 'hmsr'
> for: 'show'
> 
>    A namespace must be able to be loaded with just the base namespace
>    loaded: otherwise if the namespace gets loaded by a saved object, the
>    session will be unable to start.
> 
>    Probably some imports need to be declared in the NAMESPACE file.

Sounds like your NAMESPACE is missing importFrom(methods, show) ... ?
I'm not sure why you could not reproduce the problem locally, given that
check uses _R_CHECK_CODE_USAGE_WITH_ONLY_BASE_ATTACHED_=true by default.
But it is hard to say anything without a link to the package sources ...

Mikael

> =============================================================
> 
> I'm seeking help to understand and address this issue. show is defined like
> this:
> 
> #' Show method for class "hms".#'#' @param object - hms s4 object#'#'
> @return It returns the names of the slots and the classes associated
> with the#' slots in the "hms" class. It prints call details.#'#'
> @export#'#' @examples
> #' f <- function(x) x
> #' result <- hms(fitness = f, lower = -5, upper = 5)
> #' show(result)
> setMethod("show", "hms", function(object) {
>    cat("An object of class \"hms\"\n")
>    cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
>    cat("Available slots:\n")
>    print(methods::slotNames(object))})
> 
> And in the NAMESPACE there is a line that looks like this:
> 
> exportMethods(show)
> 
> I was investigating if the show is defined correctly and the GA package has
> a very similar method:
> 
> setMethod("show", "ga",function(object)
>   { cat("An object of class \"ga\"\n")
>     cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
>     cat("Available slots:\n")
>     print(slotNames(object))})
> 
> I could not reproduce this NOTE on my personal machine with Windows.
> On Mac OS I have never experienced this NOTE.
> 
> 
> Best regards
> 
> Wojciech Achtelik



From |r@nzk|r@|y @end|ng |rom |n|@e|te@hu  Sun Oct  8 23:28:31 2023
From: |r@nzk|r@|y @end|ng |rom |n|@e|te@hu (=?iso-8859-1?Q?Dr=2E_Franz_Kir=E1ly?=)
Date: Sun, 8 Oct 2023 21:28:31 +0000
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
Message-ID: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>

Dear all,

can someone explain to me what exactly happened to mlr3proba on CRAN?
https://cran.r-project.org/web/packages/mlr3proba/index.html

Thanks
Franz


	[[alternative HTML version deleted]]



From @vr@h@m@@d|er @end|ng |rom gm@||@com  Mon Oct  9 02:39:47 2023
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Mon, 9 Oct 2023 00:39:47 +0000
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <CAL6gwnKcQcJv_+ajSmawF64z0wYLW1Zvj=r8h+p1TaXmpvMYAw@mail.gmail.com>

https://cran-archive.r-project.org/web/checks/2022/2022-05-16_check_results_mlr3proba.html

On Mon, Oct 9, 2023 at 12:37?AM Dr. Franz Kir?ly <franzkiraly at inf.elte.hu>
wrote:

> Dear all,
>
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
>
> Thanks
> Franz
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From @|mon@urb@nek @end|ng |rom R-project@org  Mon Oct  9 02:43:02 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 9 Oct 2023 13:43:02 +1300
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <7ACF837C-971C-4C15-AD5E-6C7DA2EFB98A@R-project.org>

Franz,

it means that the author(s) have abandoned the package: as the note says it was failing checks and the authors have not fixed the problems so it has been removed from CRAN (more than a year ago).

Cheers,
Simon



> On 9/10/2023, at 10:28 AM, Dr. Franz Kir?ly <franzkiraly at inf.elte.hu> wrote:
> 
> Dear all,
> 
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
> 
> Thanks
> Franz
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 



From m@tth|@@-gond@n @end|ng |rom gmx@de  Mon Oct  9 08:32:20 2023
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Mon, 9 Oct 2023 08:32:20 +0200
Subject: [R-pkg-devel] CXX_VISIBILITY on macOS
In-Reply-To: <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>
References: <1MbirE-1rRfHw1i7q-00dG2U@mail.gmx.net>
 <E4CF3C25-B923-49BC-B8D3-9EF5D7D46902@R-project.org>
Message-ID: <1N49h5-1rXQX43IqP-0106qV@mail.gmx.net>

You found the problem, thanks!



Matthias,

this has nothing to do with R, but rather your code. You have the wrong order of headers: the SWI headers mess up visibility macros, so you have to include them *after* Rcpp.h.

Cheers,
Simon


	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Mon Oct  9 09:51:30 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 9 Oct 2023 10:51:30 +0300
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
Message-ID: <20231009105130.3f0d269c@Tarkus>

On Sun, 8 Oct 2023 16:47:41 +0100
Michael Dewey <lists at dewey.myzen.co.uk> wrote:

> Following on from Ivan's advice I have now installed qpdf and
> Ghostview. I have checked that they are both on my path by typing
> their name at the command line and verifying they open.

> I then built the package with the --compress-vignettes=both and then
> checked it with --as-cran I still get a complaint that it needs qpdf
> to check compression.

While running R, does Sys.which('qpdf') return the path to qpdf.exe?
Does Sys.getenv('PATH') match your expectations?

> I notice that in the Writing R Extensions manual in section 1.6.1 it
> states "The full path to the qpdf command can be supplied as
> environment variable R_QPDF ..."
> 
> Is that a typo for "must be supplied"?

Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
must work if it's on the %PATH%, but if all else fails, setting this
environment variable should help.

> If it is where can I find the answers to questions about how R
> accepts Windows paths? Do I need to enclose parts of names containing
> spaces in "" signs?

It always depends on how the final command line is built by a
particular function, but it should work by taking plain file paths
without any escaping and quotation. The directory separators shouldn't
matter either.

(tools::compactPDF uses system2(), so it quotes the path to the
executable by itself.)

> Does it mean the path up to, in this case, bin or must I include
> qpdf.exe after it?

It must be the full path to the executable, including the final
qpdf.exe.

> I assume I do not need to do anything special to get it to find
> Ghostscript?

tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
If it's not there, R_GSCMD must be set to the full path to the
executable. Judging by the NOTE you've received, it's Ghostscript that
performed most of the compaction in your case.

-- 
Best regards,
Ivan



From j@g@nmn2 @end|ng |rom gm@||@com  Mon Oct  9 15:05:41 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Mon, 9 Oct 2023 09:05:41 -0400
Subject: [R-pkg-devel] Note: no function found corresponding to methods
 exports for show
In-Reply-To: <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>
References: <mailman.9659.5.1696759202.19194.r-package-devel@r-project.org>
 <c2dce705-b8ab-4d90-bf5b-91c335a547b1@gmail.com>
Message-ID: <bb2a5822-d127-4e6e-bf88-eabe542875cc@gmail.com>



On 2023-10-08 5:43 pm, Mikael Jagan wrote:
>> Hi,
>>
>> I recently submitted my first R package to CRAN, and I encountered a NOTE
>> during the checking process. The NOTE looks like this:
>>
>> =============================================================
>> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
>> Check: whether the namespace can be loaded with stated dependencies,
>> Result: NOTE
>>     Warning: no function found corresponding to methods exports from 'hmsr'
>> for: 'show'
>>
>>     A namespace must be able to be loaded with just the base namespace
>>     loaded: otherwise if the namespace gets loaded by a saved object, the
>>     session will be unable to start.
>>
>>     Probably some imports need to be declared in the NAMESPACE file.
> 
> Sounds like your NAMESPACE is missing importFrom(methods, show) ... ?
> I'm not sure why you could not reproduce the problem locally, given that
> check uses _R_CHECK_CODE_USAGE_WITH_ONLY_BASE_ATTACHED_=true by default.

Reading tools:::.check_packages I see that this environment variable is
not relevant to this particular test.  Still, do import generic functions
for which you define methods, from all packages != "base".

Mikael

> But it is hard to say anything without a link to the package sources ...
> 
> Mikael
> 
>> =============================================================
>>
>> I'm seeking help to understand and address this issue. show is defined like
>> this:
>>
>> #' Show method for class "hms".#'#' @param object - hms s4 object#'#'
>> @return It returns the names of the slots and the classes associated
>> with the#' slots in the "hms" class. It prints call details.#'#'
>> @export#'#' @examples
>> #' f <- function(x) x
>> #' result <- hms(fitness = f, lower = -5, upper = 5)
>> #' show(result)
>> setMethod("show", "hms", function(object) {
>>     cat("An object of class \"hms\"\n")
>>     cat("\nCall:\n", deparse(object at call), "\n\n", sep = "")
>>     cat("Available slots:\n")
>>     print(methods::slotNames(object))})
>>
>> And in the NAMESPACE there is a line that looks like this:
>>
>> exportMethods(show)
>>
>> I was investigating if the show is defined correctly and the GA package has
>> a very similar method:
>>
>> setMethod("show", "ga",function(object)
>>    { cat("An object of class \"ga\"\n")
>>      cat("\nCall:\n", deparse(object at call), "\n\n",sep="")
>>      cat("Available slots:\n")
>>      print(slotNames(object))})
>>
>> I could not reproduce this NOTE on my personal machine with Windows.
>> On Mac OS I have never experienced this NOTE.
>>
>>
>> Best regards
>>
>> Wojciech Achtelik



From ||@t@ @end|ng |rom dewey@myzen@co@uk  Mon Oct  9 17:22:17 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Mon, 9 Oct 2023 16:22:17 +0100
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <20231009105130.3f0d269c@Tarkus>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
 <20231009105130.3f0d269c@Tarkus>
Message-ID: <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>

Dear Ivan (and list)

Using Ivan's advice I traced the problem to a difference of opinio 
between Microsoft and R about paht names. I had mistakenly enclosed 
parts of the names in "" which was fine for MS but not R. Sys.which() 
was my saviour here.

Many thanks to Ivan for broadening my knowledge of useful functions like 
Sys.which().

Michael

On 09/10/2023 08:51, Ivan Krylov wrote:
> On Sun, 8 Oct 2023 16:47:41 +0100
> Michael Dewey <lists at dewey.myzen.co.uk> wrote:
> 
>> Following on from Ivan's advice I have now installed qpdf and
>> Ghostview. I have checked that they are both on my path by typing
>> their name at the command line and verifying they open.
> 
>> I then built the package with the --compress-vignettes=both and then
>> checked it with --as-cran I still get a complaint that it needs qpdf
>> to check compression.
> 
> While running R, does Sys.which('qpdf') return the path to qpdf.exe?
> Does Sys.getenv('PATH') match your expectations?
> 
>> I notice that in the Writing R Extensions manual in section 1.6.1 it
>> states "The full path to the qpdf command can be supplied as
>> environment variable R_QPDF ..."
>>
>> Is that a typo for "must be supplied"?
> 
> Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
> must work if it's on the %PATH%, but if all else fails, setting this
> environment variable should help.
> 
>> If it is where can I find the answers to questions about how R
>> accepts Windows paths? Do I need to enclose parts of names containing
>> spaces in "" signs?
> 
> It always depends on how the final command line is built by a
> particular function, but it should work by taking plain file paths
> without any escaping and quotation. The directory separators shouldn't
> matter either.
> 
> (tools::compactPDF uses system2(), so it quotes the path to the
> executable by itself.)
> 
>> Does it mean the path up to, in this case, bin or must I include
>> qpdf.exe after it?
> 
> It must be the full path to the executable, including the final
> qpdf.exe.
> 
>> I assume I do not need to do anything special to get it to find
>> Ghostscript?
> 
> tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
> If it's not there, R_GSCMD must be set to the full path to the
> executable. Judging by the NOTE you've received, it's Ghostscript that
> performed most of the compaction in your case.
> 

-- 
Michael



From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Mon Oct  9 17:32:48 2023
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Mon, 09 Oct 2023 08:32:48 -0700
Subject: [R-pkg-devel] Problem persists,
 was Re:  Problem compressing vignettes for CRAN
In-Reply-To: <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>
References: <4d151206-4070-a86d-2700-5e69efa2a5d8@dewey.myzen.co.uk>
 <20231006174828.651b58c7@arachnoid>
 <b2c5d251-eb6c-5074-bc5a-3e32dfeedd83@dewey.myzen.co.uk>
 <6a788947-6784-25eb-6112-69eab4f9e028@dewey.myzen.co.uk>
 <20231009105130.3f0d269c@Tarkus>
 <544c466b-f353-6369-2ed9-c420592d9954@dewey.myzen.co.uk>
Message-ID: <375250EA-92CA-4378-B754-8F871D8DA37F@dcn.davis.ca.us>

R could care less about what is in PATH... there is however a difference between Windows parsing PATH and how CMD lets you quote things interactively.

The whole point of PATH is to let you or R provide simple program names like qpdf without knowing where they are... Windows takes over and looks up where the program actually is based on the contents of PATH. How you get things into that environment variable can vary depending on which software you are using (CMD and R are two possible options), but the actual content is handled by the operating system (which is why PATH on Linux is formatted differently than PATH on Windows).

On October 9, 2023 8:22:17 AM PDT, Michael Dewey <lists at dewey.myzen.co.uk> wrote:
>Dear Ivan (and list)
>
>Using Ivan's advice I traced the problem to a difference of opinio between Microsoft and R about paht names. I had mistakenly enclosed parts of the names in "" which was fine for MS but not R. Sys.which() was my saviour here.
>
>Many thanks to Ivan for broadening my knowledge of useful functions like Sys.which().
>
>Michael
>
>On 09/10/2023 08:51, Ivan Krylov wrote:
>> On Sun, 8 Oct 2023 16:47:41 +0100
>> Michael Dewey <lists at dewey.myzen.co.uk> wrote:
>> 
>>> Following on from Ivan's advice I have now installed qpdf and
>>> Ghostview. I have checked that they are both on my path by typing
>>> their name at the command line and verifying they open.
>> 
>>> I then built the package with the --compress-vignettes=both and then
>>> checked it with --as-cran I still get a complaint that it needs qpdf
>>> to check compression.
>> 
>> While running R, does Sys.which('qpdf') return the path to qpdf.exe?
>> Does Sys.getenv('PATH') match your expectations?
>> 
>>> I notice that in the Writing R Extensions manual in section 1.6.1 it
>>> states "The full path to the qpdf command can be supplied as
>>> environment variable R_QPDF ..."
>>> 
>>> Is that a typo for "must be supplied"?
>> 
>> Well, R tries to resolve the path to qpdf.exe using Sys.which(), so it
>> must work if it's on the %PATH%, but if all else fails, setting this
>> environment variable should help.
>> 
>>> If it is where can I find the answers to questions about how R
>>> accepts Windows paths? Do I need to enclose parts of names containing
>>> spaces in "" signs?
>> 
>> It always depends on how the final command line is built by a
>> particular function, but it should work by taking plain file paths
>> without any escaping and quotation. The directory separators shouldn't
>> matter either.
>> 
>> (tools::compactPDF uses system2(), so it quotes the path to the
>> executable by itself.)
>> 
>>> Does it mean the path up to, in this case, bin or must I include
>>> qpdf.exe after it?
>> 
>> It must be the full path to the executable, including the final
>> qpdf.exe.
>> 
>>> I assume I do not need to do anything special to get it to find
>>> Ghostscript?
>> 
>> tools::compactPDF() expects gswin64c.exe or gswin32c.exe on the PATH.
>> If it's not there, R_GSCMD must be set to the full path to the
>> executable. Judging by the NOTE you've received, it's Ghostscript that
>> performed most of the compaction in your case.
>> 
>

-- 
Sent from my phone. Please excuse my brevity.



From kke@h@v @end|ng |rom u||@edu  Mon Oct  9 20:59:05 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Mon, 9 Oct 2023 18:59:05 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
Message-ID: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>

Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Oct  9 22:08:43 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 9 Oct 2023 16:08:43 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>

What were you using as "outdir"?


On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
> Hi,
> 
> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
> 
>    if (is.null(outdir) || length(outdir) == 0) {
>      outdir <- tempdir()
>    }
> 
>    # Save the plot as a raster file
>    fp <- file.path(outdir, paste("plots", "/",
>                                  typ, "_",
>                                  stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>                                  ".tif", sep = ""))
>      # Create the "plots" directory if it doesn't exist
>    if (!dir.exists(fp)) {
>      dir.create(fp, recursive = TRUE)
>    }
> 
>    terra::writeRaster(rast, overwrite = TRUE,
>                       filename = fp,
>                       gdal = c("COMPRESS=NONE"))
>    message(paste("raster created", fp, sep = ": "), "\n")
> }
> 
> Error ?V
> 
>    Error: [writeRaster] cannot write file
>     12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>     13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     15.             ?|?wterra (local) .local(x, filename, ...)
>     16.               ?|?wterra:::messages(x, "writeRaster")
>     17.                 ?|?wterra:::error(f, x at pnt$getError())
> 
> 
> 
> Best Regards,
> Krishna Keshav
> 
> 	[[alternative HTML version deleted]]
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From berryboe@@enkoo| @end|ng |rom hotm@||@com  Mon Oct  9 22:13:15 2023
From: berryboe@@enkoo| @end|ng |rom hotm@||@com (Berry Boessenkool)
Date: Mon, 9 Oct 2023 20:13:15 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <GV2PR02MB877038BD348BA8712953B3EAD5CEA@GV2PR02MB8770.eurprd02.prod.outlook.com>


Are you intentionally running dir.exists on _file_names?
dir.exists("existing_folder/imaginary.file") shows FALSE, somwhat counterintuitively.
You might want to wrap the filenames in dirname...

Regards,
Berry
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Keshav, Krishna <kkeshav at ufl.edu>
Sent: Monday, October 9, 2023 20:59
To: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file

Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

        [[alternative HTML version deleted]]


	[[alternative HTML version deleted]]


From kke@h@v @end|ng |rom u||@edu  Tue Oct 10 00:56:50 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Mon, 9 Oct 2023 22:56:50 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
Message-ID: <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>

Outdir is either a directory like getwd(), tempdir() etc or empty/null. If it is empty/null, then I set it to tempdir().

if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
}
I am not sure how to debug when running it in Rbuilder. But you can look at results here - https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5

Best Regards,
Krishna Keshav

From: Duncan Murdoch <murdoch.duncan at gmail.com>
Date: Monday, October 9, 2023 at 4:08 PM
To: Keshav, Krishna <kkeshav at ufl.edu>, r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Error: [writeRaster] cannot write file
[External Email]

What were you using as "outdir"?


On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
> Hi,
>
> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
>
>    if (is.null(outdir) || length(outdir) == 0) {
>      outdir <- tempdir()
>    }
>
>    # Save the plot as a raster file
>    fp <- file.path(outdir, paste("plots", "/",
>                                  typ, "_",
>                                  stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>                                  ".tif", sep = ""))
>      # Create the "plots" directory if it doesn't exist
>    if (!dir.exists(fp)) {
>      dir.create(fp, recursive = TRUE)
>    }
>
>    terra::writeRaster(rast, overwrite = TRUE,
>                       filename = fp,
>                       gdal = c("COMPRESS=NONE"))
>    message(paste("raster created", fp, sep = ": "), "\n")
> }
>
> Error ?V
>
>    Error: [writeRaster] cannot write file
>     12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>     13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>     15.             ?|?wterra (local) .local(x, filename, ...)
>     16.               ?|?wterra:::messages(x, "writeRaster")
>     17.                 ?|?wterra:::error(f, x at pnt$getError())
>
>
>
> Best Regards,
> Krishna Keshav
>
>       [[alternative HTML version deleted]]
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Ckkeshav%40ufl.edu%7Cddd83781762040d664dc08dbc9038ec7%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638324789348072931%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=mBzV%2BSJoOTTnSpRzu0EvLT8sZ2NJ1OlhSGXqNCvGWB4%3D&reserved=0<https://stat.ethz.ch/mailman/listinfo/r-package-devel>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 10 01:16:17 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 9 Oct 2023 19:16:17 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <dbf689a4-b301-4aeb-9ba4-71ca1a36b95e@gmail.com>
 <SJ0PR22MB24481761E7E11DA70C3EF6D9B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <c0c1ff56-b2ab-4810-a897-265ba52ba28b@gmail.com>

On 09/10/2023 6:56 p.m., Keshav, Krishna wrote:
> Outdir is either a directory like getwd(), tempdir() etc or empty/null. 
> If it is empty/null, then I set it to tempdir().

That doesn't answer the question, and the link you provided doesn't 
answer it either, as far as I can see.  In the test and the vignette 
that generated the errors, something specific was passed as outdir.  But 
what? If it was getwd(), that's bound to fail -- you don't have 
permission to write there.  tempdir() should have worked, but Berry 
pointed out some other things that might be problems.

Duncan Murdoch

> 
> /if (is.null(outdir) || length(outdir) == 0) {
>  ??? outdir <- tempdir()/
> 
> /}///
> 
> I am not sure how to debug when running it in Rbuilder. But you can look 
> at results here - 
> https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5 <https://builder.r-hub.io/status/geohabnet_1.0.0.tar.gz-a2eaa40ccf1d026bbebf5077bfb482d5>
> 
> Best Regards,
> 
> Krishna Keshav
> 
> *From: *Duncan Murdoch <murdoch.duncan at gmail.com>
> *Date: *Monday, October 9, 2023 at 4:08 PM
> *To: *Keshav, Krishna <kkeshav at ufl.edu>, r-package-devel at r-project.org 
> <r-package-devel at r-project.org>
> *Subject: *Re: [R-pkg-devel] Error: [writeRaster] cannot write file
> 
> [External Email]
> 
> What were you using as "outdir"?
> 
> 
> On 09/10/2023 2:59 p.m., Keshav, Krishna wrote:
>> Hi,
>>
>> I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
>> Snippet ?V
>> .saverast <- function(typ, rast, outdir) {
>>
>>??? if (is.null(outdir) || length(outdir) == 0) {
>>????? outdir <- tempdir()
>>??? }
>>
>>??? # Save the plot as a raster file
>>??? fp <- file.path(outdir, paste("plots", "/",
>>????????????????????????????????? typ, "_",
>>????????????????????????????????? stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
>>????????????????????????????????? ".tif", sep = ""))
>>????? # Create the "plots" directory if it doesn't exist
>>??? if (!dir.exists(fp)) {
>>????? dir.create(fp, recursive = TRUE)
>>??? }
>>
>>??? terra::writeRaster(rast, overwrite = TRUE,
>>?????????????????????? filename = fp,
>>?????????????????????? gdal = c("COMPRESS=NONE"))
>>??? message(paste("raster created", fp, sep = ": "), "\n")
>> }
>>
>> Error ?V
>>
>>??? Error: [writeRaster] cannot write file
>>???? 12.???????? ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>>???? 13.?????????? ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>>???? 14.?????????? ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
>>???? 15.???????????? ?|?wterra (local) .local(x, filename, ...)
>>???? 16.?????????????? ?|?wterra:::messages(x, "writeRaster")
>>???? 17.???????????????? ?|?wterra:::error(f, x at pnt$getError())
>>
>>
>>
>> Best Regards,
>> Krishna Keshav
>>
>>?????? [[alternative HTML version deleted]]
>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Ckkeshav%40ufl.edu%7Cddd83781762040d664dc08dbc9038ec7%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638324789348072931%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=mBzV%2BSJoOTTnSpRzu0EvLT8sZ2NJ1OlhSGXqNCvGWB4%3D&reserved=0 <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>



From |kw@|mmo @end|ng |rom gm@||@com  Tue Oct 10 01:36:44 2023
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Mon, 9 Oct 2023 19:36:44 -0400
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
Message-ID: <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>

You wrote

# create the plots directory if it does not exist

but then created a directory named outdir/plots/typ_Sys.time.tif

You need to rewrite the code like:

plotsdir <- file.path(outdir, "plots")
fp <- file.path(plotsdir,  paste(typ, "_",
    stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
# Create the "plots" directory if it doesn't exist
  if (!dir.exists(plotsdir)) {
    dir.create(plotsdir, recursive = TRUE)
  }

On Mon, Oct 9, 2023, 15:49 Keshav, Krishna <kkeshav at ufl.edu> wrote:

> Hi,
>
> I am developing an R package where I need to save Raster file with .tif
> extension to the tempdir(). I am using terra::writeRaster for the same.
> While it works through R CMD check in mac, it is failing in R hub builder.
> Snippet ?V
> .saverast <- function(typ, rast, outdir) {
>
>   if (is.null(outdir) || length(outdir) == 0) {
>     outdir <- tempdir()
>   }
>
>   # Save the plot as a raster file
>   fp <- file.path(outdir, paste("plots", "/",
>                                 typ, "_",
>                                 stringr::str_replace_all(Sys.time(),
> "[^a-zA-Z0-9]", ""),
>                                 ".tif", sep = ""))
>     # Create the "plots" directory if it doesn't exist
>   if (!dir.exists(fp)) {
>     dir.create(fp, recursive = TRUE)
>   }
>
>   terra::writeRaster(rast, overwrite = TRUE,
>                      filename = fp,
>                      gdal = c("COMPRESS=NONE"))
>   message(paste("raster created", fp, sep = ": "), "\n")
> }
>
> Error ?V
>
>   Error: [writeRaster] cannot write file
>    12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
>    13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename =
> fp, gdal = c("COMPRESS=NONE"))
>    14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename =
> fp, gdal = c("COMPRESS=NONE"))
>    15.             ?|?wterra (local) .local(x, filename, ...)
>    16.               ?|?wterra:::messages(x, "writeRaster")
>    17.                 ?|?wterra:::error(f, x at pnt$getError())
>
>
>
> Best Regards,
> Krishna Keshav
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From kke@h@v @end|ng |rom u||@edu  Tue Oct 10 02:30:36 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Tue, 10 Oct 2023 00:30:36 +0000
Subject: [R-pkg-devel] Error: [writeRaster] cannot write file
In-Reply-To: <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>
References: <SJ0PR22MB2448CB5ADC64FF3B1C14B977B6CEA@SJ0PR22MB2448.namprd22.prod.outlook.com>
 <CADNULg_xAggbz+JGMh=UeK9EBizAf29AcwCyEMsqaoGJOtE55A@mail.gmail.com>
Message-ID: <CO6PR22MB2433A9762FB9A549590D9ECEB6CDA@CO6PR22MB2433.namprd22.prod.outlook.com>

Hi,

This works. I think this is also an implementation of what Berry and Duncan suggested earlier. Thanks.

Best Regards,
Krishna Keshav

From: Iris Simmons <ikwsimmo at gmail.com>
Date: Monday, October 9, 2023 at 7:37 PM
To: Keshav, Krishna <kkeshav at ufl.edu>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Error: [writeRaster] cannot write file
[External Email]
You wrote

# create the plots directory if it does not exist

but then created a directory named outdir/plots/typ_Sys.time.tif

You need to rewrite the code like:

plotsdir <- file.path(outdir, "plots")
fp <- file.path(plotsdir,  paste(typ, "_",
    stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
# Create the "plots" directory if it doesn't exist
  if (!dir.exists(plotsdir)) {
    dir.create(plotsdir, recursive = TRUE)
  }

On Mon, Oct 9, 2023, 15:49 Keshav, Krishna <kkeshav at ufl.edu<mailto:kkeshav at ufl.edu>> wrote:
Hi,

I am developing an R package where I need to save Raster file with .tif extension to the tempdir(). I am using terra::writeRaster for the same. While it works through R CMD check in mac, it is failing in R hub builder.
Snippet ?V
.saverast <- function(typ, rast, outdir) {

  if (is.null(outdir) || length(outdir) == 0) {
    outdir <- tempdir()
  }

  # Save the plot as a raster file
  fp <- file.path(outdir, paste("plots", "/",
                                typ, "_",
                                stringr::str_replace_all(Sys.time(), "[^a-zA-Z0-9]", ""),
                                ".tif", sep = ""))
    # Create the "plots" directory if it doesn't exist
  if (!dir.exists(fp)) {
    dir.create(fp, recursive = TRUE)
  }

  terra::writeRaster(rast, overwrite = TRUE,
                     filename = fp,
                     gdal = c("COMPRESS=NONE"))
  message(paste("raster created", fp, sep = ": "), "\n")
}

Error ?V

  Error: [writeRaster] cannot write file
   12.         ?|?wgeohabnet:::.saverast(typ, rast, outdir)
   13.           ?u?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   14.           ?|?wterra::writeRaster(rast, overwrite = TRUE, filename = fp, gdal = c("COMPRESS=NONE"))
   15.             ?|?wterra (local) .local(x, filename, ...)
   16.               ?|?wterra:::messages(x, "writeRaster")
   17.                 ?|?wterra:::error(f, x at pnt$getError())



Best Regards,
Krishna Keshav

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org<mailto:R-package-devel at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]



From cdr|ver@@u@ @end|ng |rom gm@||@com  Tue Oct 10 16:36:31 2023
From: cdr|ver@@u@ @end|ng |rom gm@||@com (Charles Driver)
Date: Tue, 10 Oct 2023 16:36:31 +0200
Subject: [R-pkg-devel] pkg check: SyntaxError: break must be inside loop or
 switch
Message-ID: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>

R-under-devel via winbuilder is giving me the following note, for the
ctsem package. I have no idea what it refers to -- I chased down the
few instances of using the break function in my package and reworked
the code to get rid of them, but didn't help. Any clues, or idea why
this note is so uninformative, would be welcome...

* checking data for non-ASCII characters ... NOTE
  SyntaxError: break must be inside loop or switch
      at :2513

Cheers,
Charles



From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct 11 09:40:32 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 11 Oct 2023 10:40:32 +0300
Subject: [R-pkg-devel] 
 pkg check: SyntaxError: break must be inside loop or switch
In-Reply-To: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>
References: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>
Message-ID: <20231011104032.47cd0f47@Tarkus>

? Tue, 10 Oct 2023 16:36:31 +0200
Charles Driver <cdriver.aus at gmail.com> ?????:

>   SyntaxError: break must be inside loop or switch

This looks like an error coming from a JavaScript engine or from a
JavaScript-derived language:

https://github.com/blld/libecc/blob/88877a46ba9b0a47567aa999a4380b9e793783a8/src/main.c#L714
https://github.com/ynezz/openwrt-ucode/blob/5163867269fc04fa01ec5e9f8df3384c933339f2/compiler.c#L2930https://github.com/Bobris/Njsast/blob/930f59a9694432580a7b1367680c56672cfe4cd2/Njsast/Compress/LoopControlFinderTreeWalker.cs#L34

(Most modern implementations say "_unlabeled_ break must be inside loop
or switch", but this may come from an older version.)

This seems to have nothing to do with Stan either; at the very least I
cannot find this exact error message in https://github.com/stan-dev.
When R complains about a wrongly placed `break`, it also looks
differently:

break
# Error: no loop for break/next, jumping to top level

An infrastructure hiccup on Win-Builder? 

-- 
Best regards,
Ivan



From tony_@_w||ke@ @end|ng |rom out|ook@com  Wed Oct 11 09:06:40 2023
From: tony_@_w||ke@ @end|ng |rom out|ook@com (Tony Wilkes)
Date: Wed, 11 Oct 2023 07:06:40 +0000
Subject: [R-pkg-devel] Question regarding CRAN submission with notes
Message-ID: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>

Dear all,

I'm trying to publish an R package to CRAN. Their checks come back with 2 NOTES. The first one is saying that the package is a new submission, and the second one is that there is a subdirectory with a package inside my package. Both notes are correct. I have explained in my submission comments that this is indeed a new submission. I also gave the following explanation for the second note in my submission comments: "There is 1 NOTE given by the R CMD check results. This is due to the fact that I have placed fake libraries with fake packages inside the "inst/tinytest/" folder. This was necessary to test the various import-system related functions in my package. As stated, these are fake packages, and only contain trivial functions of no consequence. These fake libraries with fake packages ONLY exist because it is necessary for proper and extensive unit testing, that is all."

They asked me to fix these notes a few days ago. I replied (politely) repeating my comments a few days ago. I have not heard back from CRAN since. I am assuming that I am missing something, but CRAN won't explain what exactly I am missing.

Here are the NOTES:
Windows: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FWindows%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Xh6fZd6iQjW6AOFtCAwwzhNO%2B5vyCh%2Fy5%2FEi25z7D%2Fg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Windows/00check.log>>
Status: 1 NOTE
Debian: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FDebian%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=0jOFqYf9Ar%2FBp1YVSZjfRHRdChzGPi5lSSuyLT2HAoM%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Debian/00check.log>>
Status: 2 NOTEs

More details are given in the directory:
<https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2F&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=73zTGLwQVRlTMnk20rbgTBOn5dCdu16y%2BmhlLS8GIpg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/>>

Could anyone tell me what exactly I'm doing wrong? Thank you in advance.

Kind regards,

Tony

	[[alternative HTML version deleted]]



From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Oct 11 16:01:13 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 11 Oct 2023 16:01:13 +0200
Subject: [R-pkg-devel] Question regarding CRAN submission with notes
In-Reply-To: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <c5e6811a-cd19-980d-ea52-eee362aee0dd@statistik.tu-dortmund.de>

This is under discussion with the CRAN team now.

Best,
Uwe Ligges


On 11.10.2023 09:06, Tony Wilkes wrote:
> Dear all,
> 
> I'm trying to publish an R package to CRAN. Their checks come back with 2 NOTES. The first one is saying that the package is a new submission, and the second one is that there is a subdirectory with a package inside my package. Both notes are correct. I have explained in my submission comments that this is indeed a new submission. I also gave the following explanation for the second note in my submission comments: "There is 1 NOTE given by the R CMD check results. This is due to the fact that I have placed fake libraries with fake packages inside the "inst/tinytest/" folder. This was necessary to test the various import-system related functions in my package. As stated, these are fake packages, and only contain trivial functions of no consequence. These fake libraries with fake packages ONLY exist because it is necessary for proper and extensive unit testing, that is all."
> 
> They asked me to fix these notes a few days ago. I replied (politely) repeating my comments a few days ago. I have not heard back from CRAN since. I am assuming that I am missing something, but CRAN won't explain what exactly I am missing.
> 
> Here are the NOTES:
> Windows: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FWindows%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Xh6fZd6iQjW6AOFtCAwwzhNO%2B5vyCh%2Fy5%2FEi25z7D%2Fg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Windows/00check.log>>
> Status: 1 NOTE
> Debian: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FDebian%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=0jOFqYf9Ar%2FBp1YVSZjfRHRdChzGPi5lSSuyLT2HAoM%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Debian/00check.log>>
> Status: 2 NOTEs
> 
> More details are given in the directory:
> <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2F&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=73zTGLwQVRlTMnk20rbgTBOn5dCdu16y%2BmhlLS8GIpg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/>>
> 
> Could anyone tell me what exactly I'm doing wrong? Thank you in advance.
> 
> Kind regards,
> 
> Tony
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Oct 11 16:04:38 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 11 Oct 2023 10:04:38 -0400
Subject: [R-pkg-devel] Question regarding CRAN submission with notes
In-Reply-To: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430B755EEFBFE242B1C6EFCBECCA@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <91cad114-b6e7-418b-9de0-82890c81a333@gmail.com>

The note says it contains "an installed version" of the package, 
presumably referring to your test package.

I think you shouldn't do that.  For a trivial package it might be true 
that the installed version is the same on all systems, but it won't 
continue to be as the installation code evolves.

What you could try is to include files that would let you install the 
test package into a library under tempdir().  Your tests would start by 
installing the test package there, then run the tests, then clean up 
afterwards.

It's possible the tests will still complain about that, in which case 
I'd go one step further back, and write a function to create the source 
package, rather than including it.  For example, have a file 
DESCRIPTION.txt which your test renames to DESCRIPTION, etc.

Duncan Murdoch



On 11/10/2023 3:06 a.m., Tony Wilkes wrote:
> Dear all,
> 
> I'm trying to publish an R package to CRAN. Their checks come back with 2 NOTES. The first one is saying that the package is a new submission, and the second one is that there is a subdirectory with a package inside my package. Both notes are correct. I have explained in my submission comments that this is indeed a new submission. I also gave the following explanation for the second note in my submission comments: "There is 1 NOTE given by the R CMD check results. This is due to the fact that I have placed fake libraries with fake packages inside the "inst/tinytest/" folder. This was necessary to test the various import-system related functions in my package. As stated, these are fake packages, and only contain trivial functions of no consequence. These fake libraries with fake packages ONLY exist because it is necessary for proper and extensive unit testing, that is all."
> 
> They asked me to fix these notes a few days ago. I replied (politely) repeating my comments a few days ago. I have not heard back from CRAN since. I am assuming that I am missing something, but CRAN won't explain what exactly I am missing.
> 
> Here are the NOTES:
> Windows: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FWindows%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Xh6fZd6iQjW6AOFtCAwwzhNO%2B5vyCh%2Fy5%2FEi25z7D%2Fg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Windows/00check.log>>
> Status: 1 NOTE
> Debian: <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2FDebian%2F00check.log&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=0jOFqYf9Ar%2FBp1YVSZjfRHRdChzGPi5lSSuyLT2HAoM%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/Debian/00check.log>>
> Status: 2 NOTEs
> 
> More details are given in the directory:
> <https://emea01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwin-builder.r-project.org%2Fincoming_pretest%2Ftinycodet_0.1.0.4_20231009_210227%2F&data=05%7C01%7C%7Ce3fe951ba4c54110abbb08dbc8fb77c2%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C638324754614049791%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=73zTGLwQVRlTMnk20rbgTBOn5dCdu16y%2BmhlLS8GIpg%3D&reserved=0<https://win-builder.r-project.org/incoming_pretest/tinycodet_0.1.0.4_20231009_210227/>>
> 
> Could anyone tell me what exactly I'm doing wrong? Thank you in advance.
> 
> Kind regards,
> 
> Tony
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From r@c@rtwr|ght @end|ng |rom gm@||@com  Thu Oct 12 04:51:55 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 11 Oct 2023 19:51:55 -0700
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
Message-ID: <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>

Update: I submitted a new version of the package, but it did not fix the
issue. The package has now been archived and I do not have access to the
error log output anymore from r-devel-linux-x86_64-fedora-clang.

I did reproduce CRAN's configuration in a VM using the information provided
by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot reproduce the
error and at this point I believe that there is a chance that CRAN's
machine is misconfigured.

The specific error happens after rbedrock has been compiled and linked
successfully. The specific error is that the symbol
_ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
to be happening to cause the error is that Clang++ 17 is adding a reference
to this symbol when compiling and linking rbedrock.so but the dynamic
linker is loading an older version of libc++.so when trying to load
rbedrock.so and the symbol is not found.

If this is the cause, then I think that the CRAN machine needs to configure
the dynamic linker to use the Clang++ 17 libc++.so, or add the proper
command line options to R's config variables.

It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
fine and I've missed something, and I would be happy if someone could help
me figure out what it is.

Also, a new issue cropped up when 0.3.1 was tested on the
r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
an archive. The other Mac versions did fine, so I'm not sure if this is a
random error or something related to my package. The error log is here:
https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html

If anyone can help me resolve this, I'd appreciate it.


On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
wrote:

> Is there any way to submit packages directly to the CRAN's clang17 setup?
> I can enable verbose output for CMake and compare the output, but I'd
> rather not clog up the CRAN incoming queue just to debug a linker error?
>
> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <simon.urbanek at r-project.org>
> wrote:
>
>> It looks like a C++ run-time mismatch between what cmake is using to
>> build the static library and what is used by R. Unfortunately, cmake hides
>> the actual compiler calls so it's hard to tell the difference, but that
>> setup relies on the correct sequence of library paths.
>>
>> The rhub manually forces -stdlib=libc++ to all its CXX flags
>>
>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
>> so it is quite different from the gannet tests-clang-trunk setup (also
>> note the different library paths), but that's not something you can do
>> universally in the package, because it strongly depends on the toolchain
>> setup.
>>
>> Cheers,
>> Simon
>>
>>
>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
>> wrote:
>> >
>> > I was unable to reproduce the error on the rhub's clang17 docker image.
>> >
>> > I notice that the linking command is slightly different between systems.
>> > And this suggests that I need to find some way to get CRAN to pass
>> -stdlib
>> > flag at the linking stage.
>> >
>> > CRAN:
>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
>> -L/usr/local/gcc13/lib64
>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>> init.o
>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>> > -pthread -lleveldb -lz
>> >
>> > RHUB:
>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>> init.o
>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
>> >
>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
>> > wrote:
>> >
>> >> You might be able to reproduce it with the clang17 container here:
>> >>
>> >>
>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
>> >> You can either run it directly or with the rhub2 package:
>> >>
>> >>
>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
>> >>
>> >> Gabor
>> >>
>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
>> >> <racartwright at gmail.com> wrote:
>> >>>
>> >>> My package, RBedrock, is now throwing an error when compiled against
>> >>> Clang17. The error log is here:
>> >>>
>> >>>
>> >>
>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
>> >>>
>> >>> The important part is
>> >>> """
>> >>> Error: package or namespace load failed for ?rbedrock? in
>> dyn.load(file,
>> >>> DLLpath = DLLpath, ...):
>> >>> unable to load shared object
>> >>>
>> >>
>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
>> >>>
>> >>>
>> >>
>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
>> >>> Error: loading failed
>> >>> """
>> >>>
>> >>> From what I can gather through googling, this error can be caused by
>> >> using
>> >>> the C linker when one of the dependent libraries is a C++ library.
>> >>>
>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
>> >>> clang17 setup (less likely).
>> >>>
>> >>> Background about the package: rbedrock is written in C but links
>> against
>> >> a
>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
>> functions. I
>> >>> use a dummy .cpp file in the source directory to trigger R into using
>> the
>> >>> C++ linker. That does still seem to be happening according to the log.
>> >>>
>> >>> Has anyone seen this before and know where I should start looking to
>> fix
>> >> it?
>> >>>
>> >>> Thanks.
>> >>>
>> >>> --
>> >>> Reed A. Cartwright, PhD
>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
>> >>> School of Life Sciences and The Biodesign Institute
>> >>> Arizona State University
>> >>> ==================
>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ 85287-6401
>> USA
>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
>> >>> 85287-6401 USA
>> >>> Office: Biodesign B-220C, 1-480-965-9949
>> >>> Website:
>> >>
>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
>> >>>
>> >>>        [[alternative HTML version deleted]]
>> >>>
>> >>> ______________________________________________
>> >>> R-package-devel at r-project.org mailing list
>> >>>
>> >>
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
>> >>
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> >
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
>> >
>>
>>

	[[alternative HTML version deleted]]



From r@c@rtwr|ght @end|ng |rom gm@||@com  Thu Oct 12 04:54:19 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 11 Oct 2023 19:54:19 -0700
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
Message-ID: <CALOkxuw3cf31BrT0yFyqVMXD815qjEVATbTBVToE3+SqLO=+wQ@mail.gmail.com>

Also the most recent source code tested by CRAN is here:

https://github.com/reedacartwright/rbedrock/tree/v0.3.1

On Wed, Oct 11, 2023 at 7:51?PM Reed A. Cartwright <racartwright at gmail.com>
wrote:

> Update: I submitted a new version of the package, but it did not fix the
> issue. The package has now been archived and I do not have access to the
> error log output anymore from r-devel-linux-x86_64-fedora-clang.
>
> I did reproduce CRAN's configuration in a VM using the information
> provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot
> reproduce the error and at this point I believe that there is a chance that
> CRAN's machine is misconfigured.
>
> The specific error happens after rbedrock has been compiled and linked
> successfully. The specific error is that the symbol
> _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
> loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
> to be happening to cause the error is that Clang++ 17 is adding a reference
> to this symbol when compiling and linking rbedrock.so but the dynamic
> linker is loading an older version of libc++.so when trying to load
> rbedrock.so and the symbol is not found.
>
> If this is the cause, then I think that the CRAN machine needs to
> configure the dynamic linker to use the Clang++ 17 libc++.so, or add the
> proper command line options to R's config variables.
>
> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
> fine and I've missed something, and I would be happy if someone could help
> me figure out what it is.
>
> Also, a new issue cropped up when 0.3.1 was tested on the
> r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
> an archive. The other Mac versions did fine, so I'm not sure if this is a
> random error or something related to my package. The error log is here:
> https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html
>
> If anyone can help me resolve this, I'd appreciate it.
>
>
> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
> wrote:
>
>> Is there any way to submit packages directly to the CRAN's clang17 setup?
>> I can enable verbose output for CMake and compare the output, but I'd
>> rather not clog up the CRAN incoming queue just to debug a linker error?
>>
>> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <
>> simon.urbanek at r-project.org> wrote:
>>
>>> It looks like a C++ run-time mismatch between what cmake is using to
>>> build the static library and what is used by R. Unfortunately, cmake hides
>>> the actual compiler calls so it's hard to tell the difference, but that
>>> setup relies on the correct sequence of library paths.
>>>
>>> The rhub manually forces -stdlib=libc++ to all its CXX flags
>>>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
>>> so it is quite different from the gannet tests-clang-trunk setup (also
>>> note the different library paths), but that's not something you can do
>>> universally in the package, because it strongly depends on the toolchain
>>> setup.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
>>> wrote:
>>> >
>>> > I was unable to reproduce the error on the rhub's clang17 docker image.
>>> >
>>> > I notice that the linking command is slightly different between
>>> systems.
>>> > And this suggests that I need to find some way to get CRAN to pass
>>> -stdlib
>>> > flag at the linking stage.
>>> >
>>> > CRAN:
>>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
>>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
>>> -L/usr/local/gcc13/lib64
>>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz
>>> >
>>> > RHUB:
>>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
>>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
>>> >
>>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
>>> > wrote:
>>> >
>>> >> You might be able to reproduce it with the clang17 container here:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
>>> >> You can either run it directly or with the rhub2 package:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
>>> >>
>>> >> Gabor
>>> >>
>>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
>>> >> <racartwright at gmail.com> wrote:
>>> >>>
>>> >>> My package, RBedrock, is now throwing an error when compiled against
>>> >>> Clang17. The error log is here:
>>> >>>
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
>>> >>>
>>> >>> The important part is
>>> >>> """
>>> >>> Error: package or namespace load failed for ?rbedrock? in
>>> dyn.load(file,
>>> >>> DLLpath = DLLpath, ...):
>>> >>> unable to load shared object
>>> >>>
>>> >>
>>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
>>> >>>
>>> >>>
>>> >>
>>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
>>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
>>> >>> Error: loading failed
>>> >>> """
>>> >>>
>>> >>> From what I can gather through googling, this error can be caused by
>>> >> using
>>> >>> the C linker when one of the dependent libraries is a C++ library.
>>> >>>
>>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
>>> >>> clang17 setup (less likely).
>>> >>>
>>> >>> Background about the package: rbedrock is written in C but links
>>> against
>>> >> a
>>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
>>> functions. I
>>> >>> use a dummy .cpp file in the source directory to trigger R into
>>> using the
>>> >>> C++ linker. That does still seem to be happening according to the
>>> log.
>>> >>>
>>> >>> Has anyone seen this before and know where I should start looking to
>>> fix
>>> >> it?
>>> >>>
>>> >>> Thanks.
>>> >>>
>>> >>> --
>>> >>> Reed A. Cartwright, PhD
>>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
>>> >>> School of Life Sciences and The Biodesign Institute
>>> >>> Arizona State University
>>> >>> ==================
>>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ
>>> 85287-6401 USA
>>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
>>> >>> 85287-6401 USA
>>> >>> Office: Biodesign B-220C, 1-480-965-9949
>>> >>> Website:
>>> >>
>>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
>>> >>>
>>> >>>        [[alternative HTML version deleted]]
>>> >>>
>>> >>> ______________________________________________
>>> >>> R-package-devel at r-project.org mailing list
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
>>> >>
>>> > ______________________________________________
>>> > R-package-devel at r-project.org mailing list
>>> >
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
>>> >
>>>
>>>

	[[alternative HTML version deleted]]



From @|mon@urb@nek @end|ng |rom R-project@org  Thu Oct 12 07:22:04 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Thu, 12 Oct 2023 18:22:04 +1300
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
Message-ID: <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>

Reed,

please contact CRAN - this list can only help with general developer's questions, not specific issues with a particular CRAN setup - only the corresponding member of CRAN running the setup can help. I don't see anything obvious - we can see that it's a mismatch of run-times between the cmake build and the R linking, but from the package alone it's not clear to me why.

Cheers,
Simon


> On Oct 12, 2023, at 3:51 PM, Reed A. Cartwright <racartwright at gmail.com> wrote:
> 
> Update: I submitted a new version of the package, but it did not fix the issue. The package has now been archived and I do not have access to the error log output anymore from r-devel-linux-x86_64-fedora-clang.
> 
> I did reproduce CRAN's configuration in a VM using the information provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot reproduce the error and at this point I believe that there is a chance that CRAN's machine is misconfigured.
> 
> The specific error happens after rbedrock has been compiled and linked successfully. The specific error is that the symbol _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe to be happening to cause the error is that Clang++ 17 is adding a reference to this symbol when compiling and linking rbedrock.so but the dynamic linker is loading an older version of libc++.so when trying to load rbedrock.so and the symbol is not found.
> 
> If this is the cause, then I think that the CRAN machine needs to configure the dynamic linker to use the Clang++ 17 libc++.so, or add the proper command line options to R's config variables.
> 
> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is fine and I've missed something, and I would be happy if someone could help me figure out what it is.
> 
> Also, a new issue cropped up when 0.3.1 was tested on the r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce an archive. The other Mac versions did fine, so I'm not sure if this is a random error or something related to my package. The error log is here: https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html <https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html>
> 
> If anyone can help me resolve this, I'd appreciate it.
> 
> 
> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com <mailto:racartwright at gmail.com>> wrote:
> Is there any way to submit packages directly to the CRAN's clang17 setup? I can enable verbose output for CMake and compare the output, but I'd rather not clog up the CRAN incoming queue just to debug a linker error?
> 
> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <simon.urbanek at r-project.org <mailto:simon.urbanek at r-project.org>> wrote:
> It looks like a C++ run-time mismatch between what cmake is using to build the static library and what is used by R. Unfortunately, cmake hides the actual compiler calls so it's hard to tell the difference, but that setup relies on the correct sequence of library paths.
> 
> The rhub manually forces -stdlib=libc++ to all its CXX flags
> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$ <https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$> 
> so it is quite different from the gannet tests-clang-trunk setup (also note the different library paths), but that's not something you can do universally in the package, because it strongly depends on the toolchain setup.
> 
> Cheers,
> Simon
> 
> 
> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com <mailto:racartwright at gmail.com>> wrote:
> > 
> > I was unable to reproduce the error on the rhub's clang17 docker image.
> > 
> > I notice that the linking command is slightly different between systems.
> > And this suggests that I need to find some way to get CRAN to pass -stdlib
> > flag at the linking stage.
> > 
> > CRAN:
> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib -L/usr/local/gcc13/lib64
> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o init.o
> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
> > -pthread -lleveldb -lz
> > 
> > RHUB:
> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o init.o
> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
> > 
> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com <mailto:csardi.gabor at gmail.com>>
> > wrote:
> > 
> >> You might be able to reproduce it with the clang17 container here:
> >> 
> >> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$ <https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$>
> >> You can either run it directly or with the rhub2 package:
> >> 
> >> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$ <https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$>
> >> 
> >> Gabor
> >> 
> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
> >> <racartwright at gmail.com <mailto:racartwright at gmail.com>> wrote:
> >>> 
> >>> My package, RBedrock, is now throwing an error when compiled against
> >>> Clang17. The error log is here:
> >>> 
> >>> 
> >> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$ <https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$>
> >>> 
> >>> The important part is
> >>> """
> >>> Error: package or namespace load failed for ?rbedrock? in dyn.load(file,
> >>> DLLpath = DLLpath, ...):
> >>> unable to load shared object
> >>> 
> >> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
> >>> 
> >>> 
> >> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
> >>> Error: loading failed
> >>> """
> >>> 
> >>> From what I can gather through googling, this error can be caused by
> >> using
> >>> the C linker when one of the dependent libraries is a C++ library.
> >>> 
> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
> >>> clang17 setup (less likely).
> >>> 
> >>> Background about the package: rbedrock is written in C but links against
> >> a
> >>> C++ library (Mojang's leveldb fork)  via the library's C-API functions. I
> >>> use a dummy .cpp file in the source directory to trigger R into using the
> >>> C++ linker. That does still seem to be happening according to the log.
> >>> 
> >>> Has anyone seen this before and know where I should start looking to fix
> >> it?
> >>> 
> >>> Thanks.
> >>> 
> >>> --
> >>> Reed A. Cartwright, PhD
> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
> >>> School of Life Sciences and The Biodesign Institute
> >>> Arizona State University
> >>> ==================
> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ 85287-6401 USA
> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
> >>> 85287-6401 USA
> >>> Office: Biodesign B-220C, 1-480-965-9949
> >>> Website:
> >> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$ <https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$>
> >>> 
> >>>        [[alternative HTML version deleted]]
> >>> 
> >>> ______________________________________________
> >>> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
> >>> 
> >> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$ <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$>
> >> 
> > ______________________________________________
> > R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
> > https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$ <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$> 
> > 
> 


	[[alternative HTML version deleted]]



From r@c@rtwr|ght @end|ng |rom gm@||@com  Thu Oct 12 07:25:35 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 11 Oct 2023 22:25:35 -0700
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
 <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>
Message-ID: <CALOkxuxSOOiPkZLSNim58-3eYvqirnZge0tJdG=TkZJJiCfsTQ@mail.gmail.com>

Okay, I'll reach out to the CRAN team shortly.

I wanted to run it by the group here first because my interactions with the
CRAN team haven't always been positive and I need to make sure that I'm not
missing something "obvious".

On Wed, Oct 11, 2023, 22:22 Simon Urbanek <simon.urbanek at r-project.org>
wrote:

> Reed,
>
> please contact CRAN - this list can only help with general developer's
> questions, not specific issues with a particular CRAN setup - only the
> corresponding member of CRAN running the setup can help. I don't see
> anything obvious - we can see that it's a mismatch of run-times between the
> cmake build and the R linking, but from the package alone it's not clear to
> me why.
>
> Cheers,
> Simon
>
>
> On Oct 12, 2023, at 3:51 PM, Reed A. Cartwright <racartwright at gmail.com>
> wrote:
>
> Update: I submitted a new version of the package, but it did not fix the
> issue. The package has now been archived and I do not have access to the
> error log output anymore from r-devel-linux-x86_64-fedora-clang.
>
> I did reproduce CRAN's configuration in a VM using the information
> provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot
> reproduce the error and at this point I believe that there is a chance that
> CRAN's machine is misconfigured.
>
> The specific error happens after rbedrock has been compiled and linked
> successfully. The specific error is that the symbol
> _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
> loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
> to be happening to cause the error is that Clang++ 17 is adding a reference
> to this symbol when compiling and linking rbedrock.so but the dynamic
> linker is loading an older version of libc++.so when trying to load
> rbedrock.so and the symbol is not found.
>
> If this is the cause, then I think that the CRAN machine needs to
> configure the dynamic linker to use the Clang++ 17 libc++.so, or add the
> proper command line options to R's config variables.
>
> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
> fine and I've missed something, and I would be happy if someone could help
> me figure out what it is.
>
> Also, a new issue cropped up when 0.3.1 was tested on the
> r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
> an archive. The other Mac versions did fine, so I'm not sure if this is a
> random error or something related to my package. The error log is here:
> https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html
> <https://urldefense.com/v3/__https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html__;!!IKRxdwAv5BmarQ!bn6F_bNAOxSfAFbevyOMVGtmTQT-u-wuccyvwupscx__4Spd0Z8C0FoUWbCPQ8QfDC_9g64_bzdKRZTTqo2U99WvIfoR$>
>
> If anyone can help me resolve this, I'd appreciate it.
>
>
> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
> wrote:
>
>> Is there any way to submit packages directly to the CRAN's clang17 setup?
>> I can enable verbose output for CMake and compare the output, but I'd
>> rather not clog up the CRAN incoming queue just to debug a linker error?
>>
>> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <
>> simon.urbanek at r-project.org> wrote:
>>
>>> It looks like a C++ run-time mismatch between what cmake is using to
>>> build the static library and what is used by R. Unfortunately, cmake hides
>>> the actual compiler calls so it's hard to tell the difference, but that
>>> setup relies on the correct sequence of library paths.
>>>
>>> The rhub manually forces -stdlib=libc++ to all its CXX flags
>>>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
>>> so it is quite different from the gannet tests-clang-trunk setup (also
>>> note the different library paths), but that's not something you can do
>>> universally in the package, because it strongly depends on the toolchain
>>> setup.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
>>> wrote:
>>> >
>>> > I was unable to reproduce the error on the rhub's clang17 docker image.
>>> >
>>> > I notice that the linking command is slightly different between
>>> systems.
>>> > And this suggests that I need to find some way to get CRAN to pass
>>> -stdlib
>>> > flag at the linking stage.
>>> >
>>> > CRAN:
>>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
>>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
>>> -L/usr/local/gcc13/lib64
>>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz
>>> >
>>> > RHUB:
>>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
>>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
>>> init.o
>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
>>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
>>> >
>>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
>>> > wrote:
>>> >
>>> >> You might be able to reproduce it with the clang17 container here:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
>>> >> You can either run it directly or with the rhub2 package:
>>> >>
>>> >>
>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
>>> >>
>>> >> Gabor
>>> >>
>>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
>>> >> <racartwright at gmail.com> wrote:
>>> >>>
>>> >>> My package, RBedrock, is now throwing an error when compiled against
>>> >>> Clang17. The error log is here:
>>> >>>
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
>>> >>>
>>> >>> The important part is
>>> >>> """
>>> >>> Error: package or namespace load failed for ?rbedrock? in
>>> dyn.load(file,
>>> >>> DLLpath = DLLpath, ...):
>>> >>> unable to load shared object
>>> >>>
>>> >>
>>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
>>> >>>
>>> >>>
>>> >>
>>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
>>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
>>> >>> Error: loading failed
>>> >>> """
>>> >>>
>>> >>> From what I can gather through googling, this error can be caused by
>>> >> using
>>> >>> the C linker when one of the dependent libraries is a C++ library.
>>> >>>
>>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
>>> >>> clang17 setup (less likely).
>>> >>>
>>> >>> Background about the package: rbedrock is written in C but links
>>> against
>>> >> a
>>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
>>> functions. I
>>> >>> use a dummy .cpp file in the source directory to trigger R into
>>> using the
>>> >>> C++ linker. That does still seem to be happening according to the
>>> log.
>>> >>>
>>> >>> Has anyone seen this before and know where I should start looking to
>>> fix
>>> >> it?
>>> >>>
>>> >>> Thanks.
>>> >>>
>>> >>> --
>>> >>> Reed A. Cartwright, PhD
>>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
>>> >>> School of Life Sciences and The Biodesign Institute
>>> >>> Arizona State University
>>> >>> ==================
>>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ
>>> 85287-6401 USA
>>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
>>> >>> 85287-6401 USA
>>> >>> Office: Biodesign B-220C, 1-480-965-9949
>>> >>> Website:
>>> >>
>>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
>>> >>>
>>> >>>        [[alternative HTML version deleted]]
>>> >>>
>>> >>> ______________________________________________
>>> >>> R-package-devel at r-project.org mailing list
>>> >>>
>>> >>
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
>>> >>
>>> > ______________________________________________
>>> > R-package-devel at r-project.org mailing list
>>> >
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
>>> >
>>>
>>>
>

	[[alternative HTML version deleted]]



From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu Oct 12 09:35:11 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 12 Oct 2023 09:35:11 +0200
Subject: [R-pkg-devel] Question about Clang 17 Error
In-Reply-To: <CALOkxuxSOOiPkZLSNim58-3eYvqirnZge0tJdG=TkZJJiCfsTQ@mail.gmail.com>
References: <CALOkxuymN-XZV_G0bx6bLh8RL-pRgWCet8b4hC3NnMfu-ofJNg@mail.gmail.com>
 <CABtg=KnzPYYyLmyJ2yOwVY5jvOORxU7V9s1T=94pyUD5rSg2UA@mail.gmail.com>
 <CALOkxuzGgwGk28zRH13YF+5WQr6iXs-5vDFUHbTr7vp8uOW7ig@mail.gmail.com>
 <A872FAA4-7826-4CE3-ACB9-C15DE56B32F9@R-project.org>
 <CALOkxuzmkk5TgXRDEudA-5mdPGX28YLN5EzCKMgfn_BgVFBpZw@mail.gmail.com>
 <CALOkxuyGVoBbfZ_BnmMvU8RYnj35ip3nJpv1PoO2qudk3XvH6g@mail.gmail.com>
 <135538DA-BEE6-40EA-91FB-B575B23A0D3D@R-project.org>
 <CALOkxuxSOOiPkZLSNim58-3eYvqirnZge0tJdG=TkZJJiCfsTQ@mail.gmail.com>
Message-ID: <25895.41391.656822.288527@stat.math.ethz.ch>

>>>>> Reed A Cartwright 
>>>>>     on Wed, 11 Oct 2023 22:25:35 -0700 writes:

    > Okay, I'll reach out to the CRAN team shortly.
    > I wanted to run it by the group here first because my interactions with the
    > CRAN team haven't always been positive and I need to make sure that I'm not
    > missing something "obvious".

well..  one thing not enough obvious:  Simon Urbanek _is_
part of the CRAN team (*).   So at least you had a positive
interaction with "them", now ! ;-)

---
*) https://cran.r-project.org/CRAN_team.htm
  (which is the *first* hit when I web search "CRAN team" {with
  DuckDuckGo, a reasonable non-prying Google-alternative I})


Best,
Martin


    > On Wed, Oct 11, 2023, 22:22 Simon Urbanek <simon.urbanek at r-project.org>
    > wrote:

    >> Reed,
    >> 
    >> please contact CRAN - this list can only help with general developer's
    >> questions, not specific issues with a particular CRAN setup - only the
    >> corresponding member of CRAN running the setup can help. I don't see
    >> anything obvious - we can see that it's a mismatch of run-times between the
    >> cmake build and the R linking, but from the package alone it's not clear to
    >> me why.
    >> 
    >> Cheers,
    >> Simon
    >> 
    >> 
    >> On Oct 12, 2023, at 3:51 PM, Reed A. Cartwright <racartwright at gmail.com>
    >> wrote:
    >> 
    >> Update: I submitted a new version of the package, but it did not fix the
    >> issue. The package has now been archived and I do not have access to the
    >> error log output anymore from r-devel-linux-x86_64-fedora-clang.
    >> 
    >> I did reproduce CRAN's configuration in a VM using the information
    >> provided by CRAN for r-devel-linux-x86_64-fedora-clang. I still cannot
    >> reproduce the error and at this point I believe that there is a chance that
    >> CRAN's machine is misconfigured.
    >> 
    >> The specific error happens after rbedrock has been compiled and linked
    >> successfully. The specific error is that the symbol
    >> _ZNSt3__122__libcpp_verbose_abortEPKcz cannot be found when rbedrock.so is
    >> loaded.This symbol was introduced into libc++ in Clang 15.0. What I believe
    >> to be happening to cause the error is that Clang++ 17 is adding a reference
    >> to this symbol when compiling and linking rbedrock.so but the dynamic
    >> linker is loading an older version of libc++.so when trying to load
    >> rbedrock.so and the symbol is not found.
    >> 
    >> If this is the cause, then I think that the CRAN machine needs to
    >> configure the dynamic linker to use the Clang++ 17 libc++.so, or add the
    >> proper command line options to R's config variables.
    >> 
    >> It's possible that the CRAN's r-devel-linux-x86_64-fedora-clang machine is
    >> fine and I've missed something, and I would be happy if someone could help
    >> me figure out what it is.
    >> 
    >> Also, a new issue cropped up when 0.3.1 was tested on the
    >> r-oldrel-macos-x86_64 machine. /usr/bin/ar seems to have failed to produce
    >> an archive. The other Mac versions did fine, so I'm not sure if this is a
    >> random error or something related to my package. The error log is here:
    >> https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html
    >> <https://urldefense.com/v3/__https://www.r-project.org/nosvn/R.check/r-oldrel-macos-x86_64/rbedrock-00install.html__;!!IKRxdwAv5BmarQ!bn6F_bNAOxSfAFbevyOMVGtmTQT-u-wuccyvwupscx__4Spd0Z8C0FoUWbCPQ8QfDC_9g64_bzdKRZTTqo2U99WvIfoR$>
    >> 
    >> If anyone can help me resolve this, I'd appreciate it.
    >> 
    >> 
    >> On Wed, Sep 27, 2023 at 2:54?PM Reed A. Cartwright <racartwright at gmail.com>
    >> wrote:
    >> 
    >>> Is there any way to submit packages directly to the CRAN's clang17 setup?
    >>> I can enable verbose output for CMake and compare the output, but I'd
    >>> rather not clog up the CRAN incoming queue just to debug a linker error?
    >>> 
    >>> On Wed, Sep 27, 2023 at 2:43?PM Simon Urbanek <
    >>> simon.urbanek at r-project.org> wrote:
    >>> 
    >>>> It looks like a C++ run-time mismatch between what cmake is using to
    >>>> build the static library and what is used by R. Unfortunately, cmake hides
    >>>> the actual compiler calls so it's hard to tell the difference, but that
    >>>> setup relies on the correct sequence of library paths.
    >>>> 
    >>>> The rhub manually forces -stdlib=libc++ to all its CXX flags
    >>>> 
    >>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub-linux-builders/blob/master/fedora-clang-devel/Makevars__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoVnCfrDa$
    >>>> so it is quite different from the gannet tests-clang-trunk setup (also
    >>>> note the different library paths), but that's not something you can do
    >>>> universally in the package, because it strongly depends on the toolchain
    >>>> setup.
    >>>> 
    >>>> Cheers,
    >>>> Simon
    >>>> 
    >>>> 
    >>>> > On 28/09/2023, at 9:37 AM, Reed A. Cartwright <racartwright at gmail.com>
    >>>> wrote:
    >>>> >
    >>>> > I was unable to reproduce the error on the rhub's clang17 docker image.
    >>>> >
    >>>> > I notice that the linking command is slightly different between
    >>>> systems.
    >>>> > And this suggests that I need to find some way to get CRAN to pass
    >>>> -stdlib
    >>>> > flag at the linking stage.
    >>>> >
    >>>> > CRAN:
    >>>> > /usr/local/clang17/bin/clang++ -std=gnu++17 -shared
    >>>> > -L/usr/local/clang/lib64 -L/usr/local/clang17/lib
    >>>> -L/usr/local/gcc13/lib64
    >>>> > -L/usr/local/lib64 -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
    >>>> init.o
    >>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
    >>>> > -pthread -lleveldb -lz
    >>>> >
    >>>> > RHUB:
    >>>> > clang++-17 -stdlib=libc++ -std=gnu++14 -shared -L/opt/R/devel/lib/R/lib
    >>>> > -L/usr/local/lib -o rbedrock.so actors.o bedrock_leveldb.o dummy.o
    >>>> init.o
    >>>> > key_conv.o nbt.o random.o subchunk.o support.o -L./leveldb-mcpe/build
    >>>> > -pthread -lleveldb -lz -L/opt/R/devel/lib/R/lib -lR
    >>>> >
    >>>> > On Wed, Sep 27, 2023 at 11:36?AM G?bor Cs?rdi <csardi.gabor at gmail.com>
    >>>> > wrote:
    >>>> >
    >>>> >> You might be able to reproduce it with the clang17 container here:
    >>>> >>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://r-hub.github.io/containers/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoLqhhk9c$
    >>>> >> You can either run it directly or with the rhub2 package:
    >>>> >>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://github.com/r-hub/rhub2*readme__;Iw!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoxPbUQlE$
    >>>> >>
    >>>> >> Gabor
    >>>> >>
    >>>> >> On Wed, Sep 27, 2023 at 8:29?PM Reed A. Cartwright
    >>>> >> <racartwright at gmail.com> wrote:
    >>>> >>>
    >>>> >>> My package, RBedrock, is now throwing an error when compiled against
    >>>> >>> Clang17. The error log is here:
    >>>> >>>
    >>>> >>>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://www.stats.ox.ac.uk/pub/bdr/clang17/rbedrock.log__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FoNhThuZA$
    >>>> >>>
    >>>> >>> The important part is
    >>>> >>> """
    >>>> >>> Error: package or namespace load failed for ?rbedrock? in
    >>>> dyn.load(file,
    >>>> >>> DLLpath = DLLpath, ...):
    >>>> >>> unable to load shared object
    >>>> >>>
    >>>> >>
    >>>> '/data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so':
    >>>> >>>
    >>>> >>>
    >>>> >>
    >>>> /data/gannet/ripley/R/packages/tests-clang-trunk/rbedrock.Rcheck/00LOCK-rbedrock/00new/rbedrock/libs/rbedrock.so:
    >>>> >>> undefined symbol: _ZNSt3__122__libcpp_verbose_abortEPKcz
    >>>> >>> Error: loading failed
    >>>> >>> """
    >>>> >>>
    >>>> >>> From what I can gather through googling, this error can be caused by
    >>>> >> using
    >>>> >>> the C linker when one of the dependent libraries is a C++ library.
    >>>> >>>
    >>>> >>> I cannot tell if this is an issue with my package (likely) or CRAN's
    >>>> >>> clang17 setup (less likely).
    >>>> >>>
    >>>> >>> Background about the package: rbedrock is written in C but links
    >>>> against
    >>>> >> a
    >>>> >>> C++ library (Mojang's leveldb fork)  via the library's C-API
    >>>> functions. I
    >>>> >>> use a dummy .cpp file in the source directory to trigger R into
    >>>> using the
    >>>> >>> C++ linker. That does still seem to be happening according to the
    >>>> log.
    >>>> >>>
    >>>> >>> Has anyone seen this before and know where I should start looking to
    >>>> fix
    >>>> >> it?
    >>>> >>>
    >>>> >>> Thanks.
    >>>> >>>
    >>>> >>> --
    >>>> >>> Reed A. Cartwright, PhD
    >>>> >>> Associate Professor of Genomics, Evolution, and Bioinformatics
    >>>> >>> School of Life Sciences and The Biodesign Institute
    >>>> >>> Arizona State University
    >>>> >>> ==================
    >>>> >>> Address: The Biodesign Institute, PO Box 876401, Tempe, AZ
    >>>> 85287-6401 USA
    >>>> >>> Packages: The Biodesign Institute, 1001 S. McAllister Ave, Tempe, AZ
    >>>> >>> 85287-6401 USA
    >>>> >>> Office: Biodesign B-220C, 1-480-965-9949
    >>>> >>> Website:
    >>>> >>
    >>>> https://urldefense.com/v3/__http://cartwrig.ht/__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-Fo7waq1VI$
    >>>> >>>
    >>>> >>>        [[alternative HTML version deleted]]
    >>>> >>>
    >>>> >>> ______________________________________________
    >>>> >>> R-package-devel at r-project.org mailing list
    >>>> >>>
    >>>> >>
    >>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!a5vkX68B5unua6_Zsh92b99AXfbJiewU7Mp0nqAKE0JDT8v3g2d08JZ8Yq_0ubp0j4GeTWWLjLVAN-FocAOfF7A$
    >>>> >>
    >>>> > ______________________________________________
    >>>> > R-package-devel at r-project.org mailing list
    >>>> >
    >>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!bAZgiOQaK4hd5BTk_Ldx9IEHgzHKVbC-uMkvYv5GOVkZDvbedcGwS8dQ4MWXRjukFfds7UpiR9NDZfEoUCWeoZEUmVSQ$
    >>>> >
    >>>> 
    >>>> 
    >> 

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel



From tony_@_w||ke@ @end|ng |rom out|ook@com  Thu Oct 12 14:34:12 2023
From: tony_@_w||ke@ @end|ng |rom out|ook@com (Tony Wilkes)
Date: Thu, 12 Oct 2023 12:34:12 +0000
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
Message-ID: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>

Dear all,

In my R package that I'm developing, I use `installed.packages(priority = "base")` to programmatically get all core/base R packages (i.e. base, stats, etc.). And similarly, I use installed.packages(priority = "recommended")?` to programmatically get the recommended R packages (i.e. mgcv, lattice, etc.).

However, CRAN has requested to not use `installed.packages()`, as it is slow. I fully get and agree with that assesment. I used installed.packages()?` anyway because I could not find a better, fool-proof alternative.

Nonetheless, I was asked to change this code for optimalisation. So I would like to ask: how do I programmatically get all base/core R packages safely and efficiently, but without using `installed.packages()`? And the same question for recommended R packages. I have of course Googled it, and looked at R's documentation (though R's documentation is large, so it's easy to miss something); no solution found. So if any of you has a smart idea: I'm all ears.

Thank you in advance.

Kind regards,

Tony.

	[[alternative HTML version deleted]]


From th|erry@onke||nx @end|ng |rom |nbo@be  Thu Oct 12 14:39:07 2023
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Thu, 12 Oct 2023 14:39:07 +0200
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <CAJuCY5z9GquTQMWPHbq9i=chungVzJHzAauL1_J+hf1BWMRprA@mail.gmail.com>

Dear Tony,

Much will depend on what information you need from the output of
installed.packages()?

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op do 12 okt 2023 om 14:34 schreef Tony Wilkes <tony_a_wilkes at outlook.com>:

> Dear all,
>
> In my R package that I'm developing, I use `installed.packages(priority =
> "base")` to programmatically get all core/base R packages (i.e. base,
> stats, etc.). And similarly, I use installed.packages(priority =
> "recommended")?` to programmatically get the recommended R packages (i.e.
> mgcv, lattice, etc.).
>
> However, CRAN has requested to not use `installed.packages()`, as it is
> slow. I fully get and agree with that assesment. I used
> installed.packages()?` anyway because I could not find a better, fool-proof
> alternative.
>
> Nonetheless, I was asked to change this code for optimalisation. So I
> would like to ask: how do I programmatically get all base/core R packages
> safely and efficiently, but without using `installed.packages()`? And the
> same question for recommended R packages. I have of course Googled it, and
> looked at R's documentation (though R's documentation is large, so it's
> easy to miss something); no solution found. So if any of you has a smart
> idea: I'm all ears.
>
> Thank you in advance.
>
> Kind regards,
>
> Tony.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Oct 12 14:46:36 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 12 Oct 2023 08:46:36 -0400
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB1430D1753ED9AB1C34FDDD7DBED3A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>

It would be much faster (but slightly less reliable) to use 
list.files(.libPaths()) to get the names of all installed packages, and 
then filter them to the known list of base and recommended packages, 
which changes very rarely.

Duncan Murdoch

On 12/10/2023 8:34 a.m., Tony Wilkes wrote:
> Dear all,
> 
> In my R package that I'm developing, I use `installed.packages(priority = "base")` to programmatically get all core/base R packages (i.e. base, stats, etc.). And similarly, I use installed.packages(priority = "recommended")?` to programmatically get the recommended R packages (i.e. mgcv, lattice, etc.).
> 
> However, CRAN has requested to not use `installed.packages()`, as it is slow. I fully get and agree with that assesment. I used installed.packages()?` anyway because I could not find a better, fool-proof alternative.
> 
> Nonetheless, I was asked to change this code for optimalisation. So I would like to ask: how do I programmatically get all base/core R packages safely and efficiently, but without using `installed.packages()`? And the same question for recommended R packages. I have of course Googled it, and looked at R's documentation (though R's documentation is large, so it's easy to miss something); no solution found. So if any of you has a smart idea: I'm all ears.
> 
> Thank you in advance.
> 
> Kind regards,
> 
> Tony.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From cdr|ver@@u@ @end|ng |rom gm@||@com  Thu Oct 12 15:32:28 2023
From: cdr|ver@@u@ @end|ng |rom gm@||@com (Charles Driver)
Date: Thu, 12 Oct 2023 15:32:28 +0200
Subject: [R-pkg-devel] 
 pkg check: SyntaxError: break must be inside loop or switch
In-Reply-To: <20231011104032.47cd0f47@Tarkus>
References: <CAAhN7=pjA=3CRfCW8i3P9-QtGqAo0pW0B5QKTA7M-PE9ZcGEwQ@mail.gmail.com>
 <20231011104032.47cd0f47@Tarkus>
Message-ID: <940063f5-7f33-4a92-b709-d0418515f1e3@gmail.com>

So apparently there is a corrupted file in the current Stanheaders, 
which is hopefully fixed soon...

On 11/10/2023 9:40 am, Ivan Krylov wrote:
> ? Tue, 10 Oct 2023 16:36:31 +0200
> Charles Driver<cdriver.aus at gmail.com>  ?????:
>
>>    SyntaxError: break must be inside loop or switch
> This looks like an error coming from a JavaScript engine or from a
> JavaScript-derived language:
>
> https://github.com/blld/libecc/blob/88877a46ba9b0a47567aa999a4380b9e793783a8/src/main.c#L714
> https://github.com/ynezz/openwrt-ucode/blob/5163867269fc04fa01ec5e9f8df3384c933339f2/compiler.c#L2930https://github.com/Bobris/Njsast/blob/930f59a9694432580a7b1367680c56672cfe4cd2/Njsast/Compress/LoopControlFinderTreeWalker.cs#L34
>
> (Most modern implementations say "_unlabeled_ break must be inside loop
> or switch", but this may come from an older version.)
>
> This seems to have nothing to do with Stan either; at the very least I
> cannot find this exact error message inhttps://github.com/stan-dev.
> When R complains about a wrongly placed `break`, it also looks
> differently:
>
> break
> # Error: no loop for break/next, jumping to top level
>
> An infrastructure hiccup on Win-Builder?
>

	[[alternative HTML version deleted]]



From j@g@nmn2 @end|ng |rom gm@||@com  Thu Oct 12 17:32:24 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Thu, 12 Oct 2023 11:32:24 -0400
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
References: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
Message-ID: <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>

Maybe something like this:

     > isRecommendedPkg <- utils:::isBasePkg
     > body(isRecommendedPkg)[[c(3L, 3L)]] <- "recommended"
     > installed <- unique(list.files(.libPaths()))
     > installed[vapply(installed, isRecommendedPkg, NA)]
      [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
      [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
     [11] "nlme"       "nnet"       "rpart"      "spatial"    "survival"

where in your package you would define isRecommendedPkg "manually".

Another (but quite undocumented and so maybe not "recommended" :-))
possibility is this:

     > mk <- file.path(R.home("share"), "make", "vars.mk")
     > pp <- sub("^.*= +", "", grep("^R_PKGS_RECOMMENDED", readLines(mk), value 
= TRUE))
     > sort(strsplit(pp, " ")[[1L]])
      [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
      [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
     [11] "nlme"       "nnet"       "rpart"      "spatial"    "survival"

I grepped around and did not find variables in any base namespace containing
the names of these packages.  It wouldn't be too hard to define such variables
when R is configured/built, but maybe there are "reasons" to not do that ... ?

Mikael

 > It would be much faster (but slightly less reliable) to use
 > list.files(.libPaths()) to get the names of all installed packages, and
 > then filter them to the known list of base and recommended packages,
 > which changes very rarely.
 >
 > Duncan Murdoch
 >
 > On 12/10/2023 8:34 a.m., Tony Wilkes wrote:
 > > Dear all,
 > >
 > > In my R package that I'm developing, I use `installed.packages(priority = 
"base")` to programmatically get all core/base R packages (i.e. base, stats, 
etc.). And similarly, I use installed.packages(priority = "recommended")?` to 
programmatically get the recommended R packages (i.e. mgcv, lattice, etc.).
 > >
 > > However, CRAN has requested to not use `installed.packages()`, as it is 
slow. I fully get and agree with that assesment. I used installed.packages()?` 
anyway because I could not find a better, fool-proof alternative.
 > >
 > > Nonetheless, I was asked to change this code for optimalisation. So I would 
like to ask: how do I programmatically get all base/core R packages safely and 
efficiently, but without using `installed.packages()`? And the same question for 
recommended R packages. I have of course Googled it, and looked at R's 
documentation (though R's documentation is large, so it's easy to miss 
something); no solution found. So if any of you has a smart idea: I'm all ears.
 > >
 > > Thank you in advance.
 > >
 > > Kind regards,
 > >
 > > Tony.



From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct 12 17:50:30 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 12 Oct 2023 18:50:30 +0300
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>
References: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
 <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>
Message-ID: <20231012185030.14a43f26@Tarkus>

On Thu, 12 Oct 2023 11:32:24 -0400
Mikael Jagan <jaganmn2 at gmail.com> wrote:

>      > mk <- file.path(R.home("share"), "make", "vars.mk")
>      > pp <- sub("^.*= +", "", grep("^R_PKGS_RECOMMENDED",
>      > readLines(mk), value = TRUE))
>      > sort(strsplit(pp, " ")[[1L]])  
>       [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
>       [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
>      [11] "nlme"       "nnet"       "rpart"      "spatial" "survival"
> 
> I grepped around and did not find variables in any base namespace
> containing the names of these packages.  It wouldn't be too hard to
> define such variables when R is configured/built, but maybe there are
> "reasons" to not do that ... ?

tools:::.get_standard_package_names does that at package installation
time, but it's still not public API.

A call to installed.packages() may take a long while because it has to
list files in every library (some of which can be large and/or
network-mounted) and parse each Meta/package.rds file, but at least
list.files() is faster than that.

If I had to make a choice at this point, I would hard-code the list of
packages, but a better option may surface once we know what Tony needs
the package lists for.

-- 
Best regards,
Ivan



From tony_@_w||ke@ @end|ng |rom out|ook@com  Fri Oct 13 11:11:20 2023
From: tony_@_w||ke@ @end|ng |rom out|ook@com (Tony Wilkes)
Date: Fri, 13 Oct 2023 09:11:20 +0000
Subject: [R-pkg-devel] published CRAN check results give error for only
 r-oldrel-macos-arm64
Message-ID: <AS4P195MB143061979866A2C583D4BEB2BED2A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>

Dear all,

My R package has yesterday been accepted by CRAN. I'm super happy about this, of course.
But when I look at the package's CRAN check results (see https://cran.r-project.org/web/checks/check_results_tinycodet.html), I see that r-oldrel-macos-arm64 has latex errors.
I find it very odd that the package runs fine on all OS, except this particular one. And I don't see why latex errors would be OS-specific. (Btw: I actually checked my R package personally on Mac OS before giving to CRAN, and there were no errors then.)

As stated, my package is published, so it's not the end of the world. But I don't want certain people to be left out, so I would prefer to fix this particular error also. The latex errors are not very enlightening.

Can anyone please explain why these latex errors are there, and how I could fix them in the future?

Thank you in advance.

Kind regards,

Tony.

	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Fri Oct 13 12:01:50 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 13 Oct 2023 13:01:50 +0300
Subject: [R-pkg-devel] published CRAN check results give error for only
 r-oldrel-macos-arm64
In-Reply-To: <AS4P195MB143061979866A2C583D4BEB2BED2A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB143061979866A2C583D4BEB2BED2A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <20231013130150.04323d1e@Tarkus>

On Fri, 13 Oct 2023 09:11:20 +0000
Tony Wilkes <tony_a_wilkes at outlook.com> wrote:

> My R package has yesterday been accepted by CRAN. I'm super happy
> about this, of course. But when I look at the package's CRAN check
> results (see
> https://cran.r-project.org/web/checks/check_results_tinycodet.html),
> I see that r-oldrel-macos-arm64 has latex errors.

The difference is that the r-oldrel-windows-x86_64 checks are running
R-4.2.3, but r-oldrel-macos-arm64 are running R-4.2.0. I can reproduce
the issue with R-4.2.0, and it's in the s_regex help page. Here's the
relevant difference in the intermediate *.tex files:

 The \LinkA{\Rpercent{}s-\Rpercent{}}{.Rpcent.s.Rdash..Rpcent.} and \LinkA{\Rpercent{}s/\Rpercent{}}{.Rpcent.s/.Rpcent.} operators,
-as well as the string detection operators (\LinkA{\Rpercent{}s\textbraceleft{\textbraceright{}\textbraceright{}\Rpercent{}}{.Rpcent.s.Rlbrace..Rrbrace..Rpcent.}, \LinkA{\Rpercent{}s!\textbraceleft{\textbraceright{}\textbraceright{}\Rpercent{}}{.Rpcent.s!.Rlbrace..Rrbrace..Rpcent.}),
+as well as the string detection operators (\LinkA{\Rpercent{}s\{\}\Rpercent{}}{.Rpcent.s.Rlbrace..Rrbrace..Rpcent.}, \LinkA{\Rpercent{}s!\{\}\Rpercent{}}{.Rpcent.s!.Rlbrace..Rrbrace..Rpcent.}),
 perform pattern matching for some purpose,
 where the pattern is given on the right hand side. \\{}
 When a character vector or string is given on the right hand side,

This seems to correspond to R-devel revision 82224 made on 2022-04-20
that fixed the use of {} inside \code{\link{}}.

If you'd like a clean PDF manual build on R-4.2.0 and older, it may
help to give a different \alias to the %s{}% help page and use that
inside \link.

-- 
Best regards,
Ivan



From bbo|ker @end|ng |rom gm@||@com  Fri Oct 13 21:05:11 2023
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Fri, 13 Oct 2023 15:05:11 -0400
Subject: [R-pkg-devel] What happened to mlr3proba on CRAN?
In-Reply-To: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
References: <GV1PR10MB629246246478337805FE5430FBCFA@GV1PR10MB6292.EURPRD10.PROD.OUTLOOK.COM>
Message-ID: <4ff3d6c8-bc8d-4849-8682-bad27162b91e@gmail.com>

Based on 
https://cran-archive.r-project.org/web/checks/2022/2022-05-16_check_results_mlr3proba.html

   it looks like there were problems with the code (possibly harmless, 
but very unlikely to be exactly as intended) when R started throwing an 
error when vectors of length >1 were used with the && operator; this 
happened with R 4.3.0

https://cran-archive.r-project.org/web/checks/2022/2022-05-16_check_results_mlr3proba.html

\subsection{SIGNIFICANT USER-VISIBLE CHANGES}{
     \itemize{
       \item Calling \code{&&} or \code{||} with LHS or (if evaluated) 
RHS of
       length greater than one is now always an error, with a report of
       the form
\preformatted{    'length = 4' in coercion to 'logical(1)'}

   Since the errors weren't corrected, the package was archived.

   You can find the maintainer's email in the DESCRIPTION file here: 
https://cran.r-project.org/src/contrib/Archive/mlr3proba/mlr3proba_0.4.9.tar.gz 
   if you want to follow up with them ...

   cheers
    Ben Bolker


On 2023-10-08 5:28 p.m., Dr. Franz Kir?ly wrote:
> Dear all,
> 
> can someone explain to me what exactly happened to mlr3proba on CRAN?
> https://cran.r-project.org/web/packages/mlr3proba/index.html
> 
> Thanks
> Franz
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Sat Oct 14 14:25:40 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Sat, 14 Oct 2023 14:25:40 +0200
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <20231012185030.14a43f26@Tarkus>
References: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
 <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>
 <20231012185030.14a43f26@Tarkus>
Message-ID: <25898.35012.379629.459153@stat.math.ethz.ch>

>>>>> Ivan Krylov 
>>>>>     on Thu, 12 Oct 2023 18:50:30 +0300 writes:

    > On Thu, 12 Oct 2023 11:32:24 -0400
    > Mikael Jagan <jaganmn2 at gmail.com> wrote:

    >> > mk <- file.path(R.home("share"), "make", "vars.mk")
    >> > pp <- sub("^.*= +", "", grep("^R_PKGS_RECOMMENDED",
    >> > readLines(mk), value = TRUE))
    >> > sort(strsplit(pp, " ")[[1L]])  
    >> [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
    >> [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
    >> [11] "nlme"       "nnet"       "rpart"      "spatial" "survival"
    >> 
    >> I grepped around and did not find variables in any base namespace
    >> containing the names of these packages.  It wouldn't be too hard to
    >> define such variables when R is configured/built, but maybe there are
    >> "reasons" to not do that ... ?

    > tools:::.get_standard_package_names does that at package installation
    > time, but it's still not public API.

Within R-core, we have somewhat discussed this, and a few
minutes ago I committed a "public API" version of the above,
called
   standard_package_names()

to R-devel (svn rev 85329), and hence probably in next year's
April release of R.


    > A call to installed.packages() may take a long while because it has to
    > list files in every library (some of which can be large and/or
    > network-mounted) and parse each Meta/package.rds file, but at least
    > list.files() is faster than that.

The above is another issue that we've wanted to improve, as some
of you are aware,  notably thinking about caching the result
.. there has been work on this during the R Sprint @ Warwick a
couple of weeks ago,

 ==> https://github.com/r-devel/r-project-sprint-2023/issues/78

involving smart people and promising proposals (my personal view).

  > If I had to make a choice at this point, I would hard-code the list of
  > packages, but a better option may surface once we know what Tony needs
  > the package lists for.

  > -- 
  > Best regards,
  > Ivan


With thanks to the discussants here on R-devel,
and best regards,
Martin

--
Martin Maechler
ETH Zurich  and  R Core team



From henr|k@bengt@@on @end|ng |rom gm@||@com  Sat Oct 14 19:37:14 2023
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Sat, 14 Oct 2023 10:37:14 -0700
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <25898.35012.379629.459153@stat.math.ethz.ch>
References: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
 <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>
 <20231012185030.14a43f26@Tarkus>
 <25898.35012.379629.459153@stat.math.ethz.ch>
Message-ID: <CAFDcVCR79tNah1LFBwUthc_67Dy1hKufAO8pXuC78v7qSE=uGw@mail.gmail.com>

On Sat, Oct 14, 2023 at 5:25?AM Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>
> >>>>> Ivan Krylov
> >>>>>     on Thu, 12 Oct 2023 18:50:30 +0300 writes:
>
>     > On Thu, 12 Oct 2023 11:32:24 -0400
>     > Mikael Jagan <jaganmn2 at gmail.com> wrote:
>
>     >> > mk <- file.path(R.home("share"), "make", "vars.mk")
>     >> > pp <- sub("^.*= +", "", grep("^R_PKGS_RECOMMENDED",
>     >> > readLines(mk), value = TRUE))
>     >> > sort(strsplit(pp, " ")[[1L]])
>     >> [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
>     >> [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
>     >> [11] "nlme"       "nnet"       "rpart"      "spatial" "survival"
>     >>
>     >> I grepped around and did not find variables in any base namespace
>     >> containing the names of these packages.  It wouldn't be too hard to
>     >> define such variables when R is configured/built, but maybe there are
>     >> "reasons" to not do that ... ?
>
>     > tools:::.get_standard_package_names does that at package installation
>     > time, but it's still not public API.
>
> Within R-core, we have somewhat discussed this, and a few
> minutes ago I committed a "public API" version of the above,
> called
>    standard_package_names()
>
> to R-devel (svn rev 85329), and hence probably in next year's
> April release of R.

Excellent. Will it be supported on all OSes?  Because, there's
currently a source code comment saying the current implementation
might not work on MS Windows:

## we cannot assume that file.path(R.home("share"), "make", "vars.mk")
## is installed, as it is not on Windows
standard_package_names <-
.get_standard_package_names <-
local({
    lines <- readLines(file.path(R.home("share"), "make", "vars.mk"))
    lines <- grep("^R_PKGS_[[:upper:]]+ *=", lines, value = TRUE)
    out <- strsplit(sub("^R_PKGS_[[:upper:]]+ *= *", "", lines), " +")
    names(out) <-
        tolower(sub("^R_PKGS_([[:upper:]]+) *=.*", "\\1", lines))
    eval(substitute(function() {out}, list(out=out)), envir = topenv())
    })

/Henrik

>
>
>     > A call to installed.packages() may take a long while because it has to
>     > list files in every library (some of which can be large and/or
>     > network-mounted) and parse each Meta/package.rds file, but at least
>     > list.files() is faster than that.
>
> The above is another issue that we've wanted to improve, as some
> of you are aware,  notably thinking about caching the result
> .. there has been work on this during the R Sprint @ Warwick a
> couple of weeks ago,
>
>  ==> https://github.com/r-devel/r-project-sprint-2023/issues/78
>
> involving smart people and promising proposals (my personal view).
>
>   > If I had to make a choice at this point, I would hard-code the list of
>   > packages, but a better option may surface once we know what Tony needs
>   > the package lists for.
>
>   > --
>   > Best regards,
>   > Ivan
>
>
> With thanks to the discussants here on R-devel,
> and best regards,
> Martin
>
> --
> Martin Maechler
> ETH Zurich  and  R Core team
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Sat Oct 14 20:29:17 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Sat, 14 Oct 2023 20:29:17 +0200
Subject: [R-pkg-devel] Question regarding listing base and recommended
 packages programmatically and efficiently
In-Reply-To: <CAFDcVCR79tNah1LFBwUthc_67Dy1hKufAO8pXuC78v7qSE=uGw@mail.gmail.com>
References: <0ac268d8-161c-4c4d-b38c-8f296cc271a3@gmail.com>
 <22242b80-c8ad-4ccf-8396-b4a22c4dd33d@gmail.com>
 <20231012185030.14a43f26@Tarkus>
 <25898.35012.379629.459153@stat.math.ethz.ch>
 <CAFDcVCR79tNah1LFBwUthc_67Dy1hKufAO8pXuC78v7qSE=uGw@mail.gmail.com>
Message-ID: <25898.56829.617453.730504@stat.math.ethz.ch>

>>>>> Henrik Bengtsson 
>>>>>     on Sat, 14 Oct 2023 10:37:14 -0700 writes:

    > On Sat, Oct 14, 2023 at 5:25?AM Martin Maechler
    > <maechler at stat.math.ethz.ch> wrote:
    >> 
    >> >>>>> Ivan Krylov
    >> >>>>>     on Thu, 12 Oct 2023 18:50:30 +0300 writes:
    >> 
    >> > On Thu, 12 Oct 2023 11:32:24 -0400
    >> > Mikael Jagan <jaganmn2 at gmail.com> wrote:
    >> 
    >> >> > mk <- file.path(R.home("share"), "make", "vars.mk")
    >> >> > pp <- sub("^.*= +", "", grep("^R_PKGS_RECOMMENDED",
    >> >> > readLines(mk), value = TRUE))
    >> >> > sort(strsplit(pp, " ")[[1L]])
    >> >> [1] "KernSmooth" "MASS"       "Matrix"     "boot"       "class"
    >> >> [6] "cluster"    "codetools"  "foreign"    "lattice"    "mgcv"
    >> >> [11] "nlme"       "nnet"       "rpart"      "spatial" "survival"
    >> >>
    >> >> I grepped around and did not find variables in any base namespace
    >> >> containing the names of these packages.  It wouldn't be too hard to
    >> >> define such variables when R is configured/built, but maybe there are
    >> >> "reasons" to not do that ... ?
    >> 
    >> > tools:::.get_standard_package_names does that at package installation
    >> > time, but it's still not public API.
    >> 
    >> Within R-core, we have somewhat discussed this, and a few
    >> minutes ago I committed a "public API" version of the above,
    >> called
    >> standard_package_names()
    >> 
    >> to R-devel (svn rev 85329), and hence probably in next year's
    >> April release of R.

    > Excellent. Will it be supported on all OSes?  Because, there's
    > currently a source code comment saying the current implementation
    > might not work on MS Windows:

    > ## we cannot assume that file.path(R.home("share"), "make", "vars.mk")
    > ## is installed, as it is not on Windows

Well, it does work nowadays on Windows {just checked}.
So the comment should probably be removed.

{{ I'm definitely not the expert, but AFAIK, the Windows
   installation of R has become considerably closer to the other platform
   ones, recently }}


    > standard_package_names <-
    > .get_standard_package_names <-
    > local({
    > lines <- readLines(file.path(R.home("share"), "make", "vars.mk"))
    > lines <- grep("^R_PKGS_[[:upper:]]+ *=", lines, value = TRUE)
    > out <- strsplit(sub("^R_PKGS_[[:upper:]]+ *= *", "", lines), " +")
    > names(out) <-
    > tolower(sub("^R_PKGS_([[:upper:]]+) *=.*", "\\1", lines))
    > eval(substitute(function() {out}, list(out=out)), envir = topenv())
    > })

    > /Henrik

    >> 
    >> 
    >> > A call to installed.packages() may take a long while because it has to
    >> > list files in every library (some of which can be large and/or
    >> > network-mounted) and parse each Meta/package.rds file, but at least
    >> > list.files() is faster than that.
    >> 
    >> The above is another issue that we've wanted to improve, as some
    >> of you are aware,  notably thinking about caching the result
    >> .. there has been work on this during the R Sprint @ Warwick a
    >> couple of weeks ago,
    >> 
    >> ==> https://github.com/r-devel/r-project-sprint-2023/issues/78
    >> 
    >> involving smart people and promising proposals (my personal view).
    >> 
    >> > If I had to make a choice at this point, I would hard-code the list of
    >> > packages, but a better option may surface once we know what Tony needs
    >> > the package lists for.
    >> 
    >> > --
    >> > Best regards,
    >> > Ivan
    >> 
    >> 
    >> With thanks to the discussants here on R-devel,
    >> and best regards,
    >> Martin
    >> 
    >> --
    >> Martin Maechler
    >> ETH Zurich  and  R Core team
    >> 
    >> ______________________________________________
    >> R-package-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From jo@eph@houpt @end|ng |rom ut@@@edu  Sat Oct 14 22:47:52 2023
From: jo@eph@houpt @end|ng |rom ut@@@edu (Joe Houpt)
Date: Sat, 14 Oct 2023 20:47:52 +0000
Subject: [R-pkg-devel] CRAN Submission to update archived packages (mdsdt)
Message-ID: <SN6PR08MB38538E5F2D26095274FFCDDAE0D1A@SN6PR08MB3853.namprd08.prod.outlook.com>

Hello,
I am having some trouble submitting a package to CRAN that had previously been archived.  I went through all of the notes and all that is left is pasted below.  Anything I am missing or that I need to get updated?
Regards,
Joe

* checking CRAN incoming feasibility ... NOTE
Maintainer: 'Joe Houpt <joseph.houpt at utsa.edu>'

New submission

Package was archived on CRAN

Possibly misspelled words in DESCRIPTION:
  Ashby (12:36)
  invariance (14:36)

CRAN repository db overrides:
  X-CRAN-Comment: Archived on 2023-08-18 as email to the maintainer is
    undeliverable.


--
Joseph W. Houpt
Associate Professor
Department of Psychology
Department of Computer Science
University of Texas at San Antonio

	[[alternative HTML version deleted]]



From ||@t@ @end|ng |rom dewey@myzen@co@uk  Sun Oct 15 17:43:53 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Sun, 15 Oct 2023 16:43:53 +0100
Subject: [R-pkg-devel] 
 CRAN Submission to update archived packages (mdsdt)
In-Reply-To: <SN6PR08MB38538E5F2D26095274FFCDDAE0D1A@SN6PR08MB3853.namprd08.prod.outlook.com>
References: <SN6PR08MB38538E5F2D26095274FFCDDAE0D1A@SN6PR08MB3853.namprd08.prod.outlook.com>
Message-ID: <52ecd83f-726f-91ec-2215-4f0645db0a3e@dewey.myzen.co.uk>

Dear Joe

Comments in-line.

On 14/10/2023 21:47, Joe Houpt via R-package-devel wrote:
> Hello,
> I am having some trouble submitting a package to CRAN that had previously been archived.  I went through all of the notes and all that is left is pasted below.  Anything I am missing or that I need to get updated?
> Regards,
> Joe
> 
> * checking CRAN incoming feasibility ... NOTE
> Maintainer: 'Joe Houpt <joseph.houpt at utsa.edu>'

That is normal. No action needed.

> 
> New submission
> 
> Package was archived on CRAN
> 
> Possibly misspelled words in DESCRIPTION:
>    Ashby (12:36)
>    invariance (14:36)

It usually flags proper nouns, not sure why it disikes invariance, but 
those are presumably fase positives which you could mention in the 
covering note.
> 
> CRAN repository db overrides:
>    X-CRAN-Comment: Archived on 2023-08-18 as email to the maintainer is
>      undeliverable.
> 

Not sure about that one. Were you the original maintainer? If not did 
CRAN know you were taking over?

Michael

> 
> --
> Joseph W. Houpt
> Associate Professor
> Department of Psychology
> Department of Computer Science
> University of Texas at San Antonio
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 

-- 
Michael



From ro||turner @end|ng |rom po@teo@net  Mon Oct 16 03:34:57 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Mon, 16 Oct 2023 01:34:57 +0000
Subject: [R-pkg-devel] Problem with "additional repository".
Message-ID: <20231016143457.4e9abf93@rolf-Latitude-E7470>


I have submitted a new package to CRAN, and this package has been
knocked back on the basis of a NOTE:

> * checking package dependencies ... NOTE
> Package suggested but not available for checking: 'ionChannelData'

This suggested package consists of data sets, the size of which is too
large to satisfy CRAN's constraints. I put this package in a repository
on github, from which it can be accessed by users.

My DESCRIPTION file contains the line:

> Additional_repositories: https://rolfturner.r-universe.dev

The given URL seems to work, in that users can indeed load the
ionChannelData package via the command

> install.packages("ionChannelData",repos="https://rolfturner.r-universe.dev")

I was under the impression that this was all that I needed to do.  The
CRAN checking process acknowledges the existence of the repository in
question:

> Suggests or Enhances not in mainstream repositories:
>   ionChannelData
> Availability using Additional_repositories specification:
>   ionChannelData   yes   https://rolfturner.r-universe.dev

So CRAN knows about this repository.  Why can it not make use of it?

What can/should I do to resolve this problem?

I guess I could simply *not* Suggest ionChannelData.  But what then, is
the point of the option of including an Additional_repositories field in
the DESCRIPTION file?

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619



From |kw@|mmo @end|ng |rom gm@||@com  Mon Oct 16 04:02:11 2023
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Sun, 15 Oct 2023 22:02:11 -0400
Subject: [R-pkg-devel] Problem with "additional repository".
In-Reply-To: <20231016143457.4e9abf93@rolf-Latitude-E7470>
References: <20231016143457.4e9abf93@rolf-Latitude-E7470>
Message-ID: <CADNULg8Q9OxLpktwqbeGEcLhwV6UAkFq6WdyG2EQyjjTnfuARA@mail.gmail.com>

The packages in additional repositories are not installed on the CRAN
checking machines. The NOTE is expected, but it's not a warning, so your
package should still be allowed to upload to CRAN. You should not remove
ionChannelData from Suggests because then the reference to that package in
your documentation will become a WARNING and your package will not be
uploaded to CRAN.

On Sun, Oct 15, 2023, 21:35 Rolf Turner <rolfturner at posteo.net> wrote:

>
> I have submitted a new package to CRAN, and this package has been
> knocked back on the basis of a NOTE:
>
> > * checking package dependencies ... NOTE
> > Package suggested but not available for checking: 'ionChannelData'
>
> This suggested package consists of data sets, the size of which is too
> large to satisfy CRAN's constraints. I put this package in a repository
> on github, from which it can be accessed by users.
>
> My DESCRIPTION file contains the line:
>
> > Additional_repositories: https://rolfturner.r-universe.dev
>
> The given URL seems to work, in that users can indeed load the
> ionChannelData package via the command
>
> > install.packages("ionChannelData",repos="
> https://rolfturner.r-universe.dev")
>
> I was under the impression that this was all that I needed to do.  The
> CRAN checking process acknowledges the existence of the repository in
> question:
>
> > Suggests or Enhances not in mainstream repositories:
> >   ionChannelData
> > Availability using Additional_repositories specification:
> >   ionChannelData   yes   https://rolfturner.r-universe.dev
>
> So CRAN knows about this repository.  Why can it not make use of it?
>
> What can/should I do to resolve this problem?
>
> I guess I could simply *not* Suggest ionChannelData.  But what then, is
> the point of the option of including an Additional_repositories field in
> the DESCRIPTION file?
>
> cheers,
>
> Rolf Turner
>
> --
> Honorary Research Fellow
> Department of Statistics
> University of Auckland
> Stats. Dep't. (secretaries) phone:
>          +64-9-373-7599 ext. 89622
> Home phone: +64-9-480-4619
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Oct 16 11:25:17 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 16 Oct 2023 05:25:17 -0400
Subject: [R-pkg-devel] Problem with "additional repository".
In-Reply-To: <20231016143457.4e9abf93@rolf-Latitude-E7470>
References: <20231016143457.4e9abf93@rolf-Latitude-E7470>
Message-ID: <31170abd-2788-4721-bd58-79ed3c65a587@gmail.com>

On 15/10/2023 9:34 p.m., Rolf Turner wrote:
> 
> I have submitted a new package to CRAN, and this package has been
> knocked back on the basis of a NOTE:
> 
>> * checking package dependencies ... NOTE
>> Package suggested but not available for checking: 'ionChannelData'
> 
> This suggested package consists of data sets, the size of which is too
> large to satisfy CRAN's constraints. I put this package in a repository
> on github, from which it can be accessed by users.
> 
> My DESCRIPTION file contains the line:
> 
>> Additional_repositories: https://rolfturner.r-universe.dev
> 

Is that web site set up as a repository?  My impression was that it 
needed to be, so people could do

   install.packages("ionChannelData", repos = 
"https://rolfturner.r-universe.dev")

You can use the "drat" package to set up a tiny repository quickly.

Duncan


> The given URL seems to work, in that users can indeed load the
> ionChannelData package via the command
> 
>> install.packages("ionChannelData",repos="https://rolfturner.r-universe.dev")
> 
> I was under the impression that this was all that I needed to do.  The
> CRAN checking process acknowledges the existence of the repository in
> question:
> 
>> Suggests or Enhances not in mainstream repositories:
>>    ionChannelData
>> Availability using Additional_repositories specification:
>>    ionChannelData   yes   https://rolfturner.r-universe.dev
> 
> So CRAN knows about this repository.  Why can it not make use of it?
> 
> What can/should I do to resolve this problem?
> 
> I guess I could simply *not* Suggest ionChannelData.  But what then, is
> the point of the option of including an Additional_repositories field in
> the DESCRIPTION file?
> 
> cheers,
> 
> Rolf Turner
>



From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Oct 16 11:25:59 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 16 Oct 2023 05:25:59 -0400
Subject: [R-pkg-devel] Problem with "additional repository".
In-Reply-To: <20231016143457.4e9abf93@rolf-Latitude-E7470>
References: <20231016143457.4e9abf93@rolf-Latitude-E7470>
Message-ID: <96cc9a80-bf41-4383-ba5e-cefb8fa4ecaf@gmail.com>

Whoops, I just read the next line.  Sorry!

On 15/10/2023 9:34 p.m., Rolf Turner wrote:
> 
> I have submitted a new package to CRAN, and this package has been
> knocked back on the basis of a NOTE:
> 
>> * checking package dependencies ... NOTE
>> Package suggested but not available for checking: 'ionChannelData'
> 
> This suggested package consists of data sets, the size of which is too
> large to satisfy CRAN's constraints. I put this package in a repository
> on github, from which it can be accessed by users.
> 
> My DESCRIPTION file contains the line:
> 
>> Additional_repositories: https://rolfturner.r-universe.dev
> 
> The given URL seems to work, in that users can indeed load the
> ionChannelData package via the command
> 
>> install.packages("ionChannelData",repos="https://rolfturner.r-universe.dev")
> 
> I was under the impression that this was all that I needed to do.  The
> CRAN checking process acknowledges the existence of the repository in
> question:
> 
>> Suggests or Enhances not in mainstream repositories:
>>    ionChannelData
>> Availability using Additional_repositories specification:
>>    ionChannelData   yes   https://rolfturner.r-universe.dev
> 
> So CRAN knows about this repository.  Why can it not make use of it?
> 
> What can/should I do to resolve this problem?
> 
> I guess I could simply *not* Suggest ionChannelData.  But what then, is
> the point of the option of including an Additional_repositories field in
> the DESCRIPTION file?
> 
> cheers,
> 
> Rolf Turner
>



From j|ox @end|ng |rom mcm@@ter@c@  Mon Oct 16 16:14:49 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Mon, 16 Oct 2023 10:14:49 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
Message-ID: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>

Dear list members,

I believe that this issue has been discussed previously, but I'm not 
sure that I have the solution right.

Georges Monette and I have developed a package that we intend to submit 
soon to CRAN which has a vignette including code that takes a long time 
to run. The sources for the package are available at 
<https://github.com/gmonette/cv>.

We figure that we have to suppress running the code the vignette when 
CRAN checks the package or the check time will be excessive.

The vignette is written as a .Rmd file to be compiled by knitr, 
producing an HTML vignette. The top of the .Rmd file looks like this:

------- snip -------

---
title: "Cross-validation of regression models"
author: "John Fox and Georges Monette"
date: "`r Sys.Date()`"
package: cv
output:
   rmarkdown::html_vignette:
   fig_caption: yes
bibliography: ["cv.bib"]
csl: apa.csl
vignette: >
   %\VignetteIndexEntry{Cross-validation of regression models}
   %\VignetteEngine{knitr::rmarkdown}
   %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
   collapse = TRUE,
   message = TRUE,
   warning = TRUE,
   fig.align = "center",
   fig.height = 6,
   fig.width = 7,
   fig.path = "fig/",
   dev = "png",
   comment = "#>",
   eval = nzchar(Sys.getenv("REBUILD_CV_VIGNETTES"))
)

### other irrelevant setup code not shown ###

```

------- snip -------

So (near the bottom), if the environment variable REBUILD_CV_VIGNETTES 
isn't empty, the code blocks in the vignette are evaluated, otherwise 
not. To build the tarball for the package to be submitted to CRAN, we 
will set REBUILD_CV_VIGNETTES to "true". That works as intended.

If we submit the tarball to CRAN, I believe that the package as 
distributed by CRAN will include the HTML vignette from our tarball, 
showing the evaluated code blocks, but when CRAN checks the package, 
these long-running code blocks will not be executed (because 
REBUILD_CV_VIGNETTES will not exist on the CRAN check machines).

My questions:

Is that correct?

If not, how can we ensure that the complete vignette is distributed by 
CRAN without causing an overly long CRAN check time?

In particular, we don't want CRAN to rebuild and distribute the 
vignette, because the resulting HTML file won't show the evaluated code.

Any assistance would be appreciated.

Thank you,
  John
-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://www.john-fox.ca/



From kev|n@r@coombe@ @end|ng |rom gm@||@com  Mon Oct 16 16:42:51 2023
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R Coombes)
Date: Mon, 16 Oct 2023 10:42:51 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
Message-ID: <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>

Produce a PDF file yourself, then use the "as.is" feature of the R.rsp 
package.

Specifically, include this line in your DESCRIPTION file:
VignetteBuilder: R.rsp

Let's say the pdf file is called "myfile.pdf".? Create a file called 
"myfile.pdf.asis" that contains the vignette instructions. Put it in the 
vignette directory along with the PDF file. Mine looks like:

%\VignetteIndexEntry{PUT VIGNETTE TITLE HERE}
%\VignetteKeywords{PUT KEYWORDS HERE}
%\VignetteDepends{PACKAGE_NAME}
%\VignettePackage{PACKAGE_NAME}
%\VignetteEngine{R.rsp::asis}

I am not certain if this works for an HTML vignette, but I see no reason 
why it shouldn't.

Best,
 ? Kevin

On 10/16/2023 10:14 AM, John Fox wrote:
> Dear list members,
>
> I believe that this issue has been discussed previously, but I'm not 
> sure that I have the solution right.
>
> Georges Monette and I have developed a package that we intend to 
> submit soon to CRAN which has a vignette including code that takes a 
> long time to run. The sources for the package are available at 
> <https://github.com/gmonette/cv>.
>
> We figure that we have to suppress running the code the vignette when 
> CRAN checks the package or the check time will be excessive.
>
> The vignette is written as a .Rmd file to be compiled by knitr, 
> producing an HTML vignette. The top of the .Rmd file looks like this:
>
> ------- snip -------
>
> ---
> title: "Cross-validation of regression models"
> author: "John Fox and Georges Monette"
> date: "`r Sys.Date()`"
> package: cv
> output:
> ? rmarkdown::html_vignette:
> ? fig_caption: yes
> bibliography: ["cv.bib"]
> csl: apa.csl
> vignette: >
> ? %\VignetteIndexEntry{Cross-validation of regression models}
> ? %\VignetteEngine{knitr::rmarkdown}
> ? %\VignetteEncoding{UTF-8}
> ---
>
> ```{r setup, include = FALSE}
> knitr::opts_chunk$set(
> ? collapse = TRUE,
> ? message = TRUE,
> ? warning = TRUE,
> ? fig.align = "center",
> ? fig.height = 6,
> ? fig.width = 7,
> ? fig.path = "fig/",
> ? dev = "png",
> ? comment = "#>",
> ? eval = nzchar(Sys.getenv("REBUILD_CV_VIGNETTES"))
> )
>
> ### other irrelevant setup code not shown ###
>
> ```
>
> ------- snip -------
>
> So (near the bottom), if the environment variable REBUILD_CV_VIGNETTES 
> isn't empty, the code blocks in the vignette are evaluated, otherwise 
> not. To build the tarball for the package to be submitted to CRAN, we 
> will set REBUILD_CV_VIGNETTES to "true". That works as intended.
>
> If we submit the tarball to CRAN, I believe that the package as 
> distributed by CRAN will include the HTML vignette from our tarball, 
> showing the evaluated code blocks, but when CRAN checks the package, 
> these long-running code blocks will not be executed (because 
> REBUILD_CV_VIGNETTES will not exist on the CRAN check machines).
>
> My questions:
>
> Is that correct?
>
> If not, how can we ensure that the complete vignette is distributed by 
> CRAN without causing an overly long CRAN check time?
>
> In particular, we don't want CRAN to rebuild and distribute the 
> vignette, because the resulting HTML file won't show the evaluated code.
>
> Any assistance would be appreciated.
>
> Thank you,
> ?John



From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Oct 16 17:08:28 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 16 Oct 2023 17:08:28 +0200
Subject: [R-pkg-devel] Problem with "additional repository".
In-Reply-To: <96cc9a80-bf41-4383-ba5e-cefb8fa4ecaf@gmail.com>
References: <20231016143457.4e9abf93@rolf-Latitude-E7470>
 <96cc9a80-bf41-4383-ba5e-cefb8fa4ecaf@gmail.com>
Message-ID: <a7971df4-03d1-3217-c3c5-0f9e8907b7b0@statistik.tu-dortmund.de>

Certainly there was more in the output that caused rejection as the 
stuff you describe below seems to be fine.
I do not know which package this refers to, so cannot easily look.

Best,
Uwe

On 16.10.2023 11:25, Duncan Murdoch wrote:
> Whoops, I just read the next line.? Sorry!
> 
> On 15/10/2023 9:34 p.m., Rolf Turner wrote:
>>
>> I have submitted a new package to CRAN, and this package has been
>> knocked back on the basis of a NOTE:
>>
>>> * checking package dependencies ... NOTE
>>> Package suggested but not available for checking: 'ionChannelData'
>>
>> This suggested package consists of data sets, the size of which is too
>> large to satisfy CRAN's constraints. I put this package in a repository
>> on github, from which it can be accessed by users.
>>
>> My DESCRIPTION file contains the line:
>>
>>> Additional_repositories: https://rolfturner.r-universe.dev
>>
>> The given URL seems to work, in that users can indeed load the
>> ionChannelData package via the command
>>
>>> install.packages("ionChannelData",repos="https://rolfturner.r-universe.dev")
>>
>> I was under the impression that this was all that I needed to do.? The
>> CRAN checking process acknowledges the existence of the repository in
>> question:
>>
>>> Suggests or Enhances not in mainstream repositories:
>>> ?? ionChannelData
>>> Availability using Additional_repositories specification:
>>> ?? ionChannelData?? yes?? https://rolfturner.r-universe.dev
> >
>> So CRAN knows about this repository.? Why can it not make use of it?
>>
>> What can/should I do to resolve this problem?
>>
>> I guess I could simply *not* Suggest ionChannelData.? But what then, is
>> the point of the option of including an Additional_repositories field in
>> the DESCRIPTION file?
>>
>> cheers,
>>
>> Rolf Turner
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From john@m@h@rro|d @end|ng |rom gm@||@com  Mon Oct 16 17:29:54 2023
From: john@m@h@rro|d @end|ng |rom gm@||@com (John Harrold)
Date: Mon, 16 Oct 2023 08:29:54 -0700
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
Message-ID: <CANAiAiWLoa-W9dX=JsuJeVW4=gxfD6t2hQdq+JK5UcuWLopDeA@mail.gmail.com>

Hello John,

The way I've done this is I use the the global eval option to control
running the code. When it's set to TRUE it will run the code and save the
results as an RData file. So when I'm creating it locally I have eval=TRUE
in the options:

https://github.com/john-harrold/ubiquity/blob/bb0532915b63f02f701148e5ae097222fef50a2d/vignettes/Simulation.Rmd#L11

Then when I want to use the results I load them from a file:

https://github.com/john-harrold/ubiquity/blob/bb0532915b63f02f701148e5ae097222fef50a2d/vignettes/Simulation.Rmd#L101

Then before I submit to CRAN I set eval=FALSE in the setup at the top of
the vignette.

John

On Mon, Oct 16, 2023 at 7:15?AM John Fox <jfox at mcmaster.ca> wrote:

> Dear list members,
>
> I believe that this issue has been discussed previously, but I'm not
> sure that I have the solution right.
>
> Georges Monette and I have developed a package that we intend to submit
> soon to CRAN which has a vignette including code that takes a long time
> to run. The sources for the package are available at
> <https://github.com/gmonette/cv>.
>
> We figure that we have to suppress running the code the vignette when
> CRAN checks the package or the check time will be excessive.
>
> The vignette is written as a .Rmd file to be compiled by knitr,
> producing an HTML vignette. The top of the .Rmd file looks like this:
>
> ------- snip -------
>
> ---
> title: "Cross-validation of regression models"
> author: "John Fox and Georges Monette"
> date: "`r Sys.Date()`"
> package: cv
> output:
>    rmarkdown::html_vignette:
>    fig_caption: yes
> bibliography: ["cv.bib"]
> csl: apa.csl
> vignette: >
>    %\VignetteIndexEntry{Cross-validation of regression models}
>    %\VignetteEngine{knitr::rmarkdown}
>    %\VignetteEncoding{UTF-8}
> ---
>
> ```{r setup, include = FALSE}
> knitr::opts_chunk$set(
>    collapse = TRUE,
>    message = TRUE,
>    warning = TRUE,
>    fig.align = "center",
>    fig.height = 6,
>    fig.width = 7,
>    fig.path = "fig/",
>    dev = "png",
>    comment = "#>",
>    eval = nzchar(Sys.getenv("REBUILD_CV_VIGNETTES"))
> )
>
> ### other irrelevant setup code not shown ###
>
> ```
>
> ------- snip -------
>
> So (near the bottom), if the environment variable REBUILD_CV_VIGNETTES
> isn't empty, the code blocks in the vignette are evaluated, otherwise
> not. To build the tarball for the package to be submitted to CRAN, we
> will set REBUILD_CV_VIGNETTES to "true". That works as intended.
>
> If we submit the tarball to CRAN, I believe that the package as
> distributed by CRAN will include the HTML vignette from our tarball,
> showing the evaluated code blocks, but when CRAN checks the package,
> these long-running code blocks will not be executed (because
> REBUILD_CV_VIGNETTES will not exist on the CRAN check machines).
>
> My questions:
>
> Is that correct?
>
> If not, how can we ensure that the complete vignette is distributed by
> CRAN without causing an overly long CRAN check time?
>
> In particular, we don't want CRAN to rebuild and distribute the
> vignette, because the resulting HTML file won't show the evaluated code.
>
> Any assistance would be appreciated.
>
> Thank you,
>   John
> --
> John Fox, Professor Emeritus
> McMaster University
> Hamilton, Ontario, Canada
> web: https://www.john-fox.ca/
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From c@rtogr@iiow m@iii@g oii gm@ii@com  Mon Oct 16 23:38:59 2023
From: c@rtogr@iiow m@iii@g oii gm@ii@com (c@rtogr@iiow m@iii@g oii gm@ii@com)
Date: Mon, 16 Oct 2023 21:38:59 +0000 (UTC)
Subject: [R-pkg-devel] CartogRaflow submission
References: <1550121052.16258628.1697492339014.ref@mail.yahoo.com>
Message-ID: <1550121052.16258628.1697492339014@mail.yahoo.com>

Hi,?I've put an update version of the package cartogRaflow 1.0.4 in CRAN today.?
There are 2 errors?
Last released version's CRAN status: OK: 11, ERROR: 2
See: <https://cran-archive.r-project.org/web/checks/2023/2023-10-16_check_results_cartograflow.html>

The version 1.0.3 was archived today.?
I would like to know if these errors are due to the version 1.0.3 was archived.?If yes, is it possible to fix these errors??Thanks in advance?Sylvain?
	[[alternative HTML version deleted]]



From |kw@|mmo @end|ng |rom gm@||@com  Tue Oct 17 09:18:31 2023
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Tue, 17 Oct 2023 03:18:31 -0400
Subject: [R-pkg-devel] CartogRaflow submission
In-Reply-To: <1550121052.16258628.1697492339014@mail.yahoo.com>
References: <1550121052.16258628.1697492339014.ref@mail.yahoo.com>
 <1550121052.16258628.1697492339014@mail.yahoo.com>
Message-ID: <CADNULg-GOxofiVph7L=y6BO4jWRbSpB5Gyv11=iz9w8DJF9bSw@mail.gmail.com>

The packages that you imported are no longer available. As far as I
understand, rgeos, maptools, and a few other spatial related packages have
been archived and have been replaced with better alternatives.

On Tue, Oct 17, 2023, 03:13 cartograflow at gmail.com <cartograflow at gmail.com>
wrote:

> Hi, I've put an update version of the package cartogRaflow 1.0.4 in CRAN
> today.
> There are 2 errors
> Last released version's CRAN status: OK: 11, ERROR: 2
> See: <
> https://cran-archive.r-project.org/web/checks/2023/2023-10-16_check_results_cartograflow.html
> >
>
> The version 1.0.3 was archived today.
> I would like to know if these errors are due to the version 1.0.3 was
> archived. If yes, is it possible to fix these errors? Thanks in
> advance Sylvain
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From |uc@r @end|ng |rom |edor@project@org  Tue Oct 17 09:25:34 2023
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Tue, 17 Oct 2023 09:25:34 +0200
Subject: [R-pkg-devel] CartogRaflow submission
In-Reply-To: <1550121052.16258628.1697492339014@mail.yahoo.com>
References: <1550121052.16258628.1697492339014.ref@mail.yahoo.com>
 <1550121052.16258628.1697492339014@mail.yahoo.com>
Message-ID: <CALEXWq1PkemSYzPWg-u0-DCnx1vh8ASkvNoid7wsyAuqF+DLzA@mail.gmail.com>

El mar., 17 oct. 2023 9:13, cartograflow at gmail.com <cartograflow at gmail.com>
escribi?:

> Hi, I've put an update version of the package cartogRaflow 1.0.4 in CRAN
> today.
> There are 2 errors
> Last released version's CRAN status: OK: 11, ERROR: 2
> See: <
> https://cran-archive.r-project.org/web/checks/2023/2023-10-16_check_results_cartograflow.html
> >
>
> The version 1.0.3 was archived today.
> I would like to know if these errors are due to the version 1.0.3 was
> archived. If yes, is it possible to fix these errors? Thanks in
> advance Sylvain
>

Packages rgeos and maptools have been deprecated and archived on CRAN. You
should use sf or terra instead.

Best,
I?aki

>

	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 17 09:37:09 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 17 Oct 2023 10:37:09 +0300
Subject: [R-pkg-devel] CartogRaflow submission
In-Reply-To: <1550121052.16258628.1697492339014@mail.yahoo.com>
References: <1550121052.16258628.1697492339014.ref@mail.yahoo.com>
 <1550121052.16258628.1697492339014@mail.yahoo.com>
Message-ID: <20231017103709.43dd6dd0@Tarkus>

On Mon, 16 Oct 2023 21:38:59 +0000 (UTC)
"cartograflow at gmail.com" <cartograflow at gmail.com> wrote:

> Hi,?I've put an update version of the package cartogRaflow 1.0.4 in
> CRAN today.

What was the full check result?

> Last released version's CRAN status: OK: 11, ERROR: 2
> See:
> <https://cran-archive.r-project.org/web/checks/2023/2023-10-16_check_results_cartograflow.html>

See the links at <https://r-spatial.github.io/evolution/>, including
<https://stat.ethz.ch/pipermail/r-sig-geo/2023-October/029344.html>.

The archival message recommends the use of 'sf' or 'terra' instead of
'maptools' and 'rgeos'. I hope you'll be able to find the desired
functionality in these packages. People here and on R-SIG-Geo may be
able to give you more detailed instructions.

-- 
Best regards,
Ivan



From edd @end|ng |rom deb|@n@org  Tue Oct 17 10:02:58 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 17 Oct 2023 03:02:58 -0500
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
Message-ID: <25902.16306.681621.578024@rob.eddelbuettel.com>


On 16 October 2023 at 10:42, Kevin R Coombes wrote:
| Produce a PDF file yourself, then use the "as.is" feature of the R.rsp 
| package.

For completeness, that approach also works directly with Sweave. Described in
a blog post by Mark van der Loo in 2019, and used in a number of packages
including a few of mine.

That said, I also used the approach described by John Harrold and cached
results myself.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From c@rtogr@iiow m@iii@g oii gm@ii@com  Tue Oct 17 11:45:25 2023
From: c@rtogr@iiow m@iii@g oii gm@ii@com (c@rtogr@iiow m@iii@g oii gm@ii@com)
Date: Tue, 17 Oct 2023 09:45:25 +0000 (UTC)
Subject: [R-pkg-devel] =?utf-8?q?Re=C2=A0=3ARe=3A__Suppressing_long-runni?=
 =?utf-8?q?ng_vignette_code_in_CRAN_submission?=
In-Reply-To: <25902.16306.681621.578024@rob.eddelbuettel.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
Message-ID: <1201375991.5521541.1697535925060@mail.yahoo.com>

Hi, thanks to reply.?I know that the version 1.0.3 of cartogRaflow use rgeos maptools. Now the version cartogRaflow was archived on 16th October.?I've uploaded cartogRaflow version 1.0.4 with sf package.?
I've submitted yesterday the version 1.0.4 in CRAN and received 2 two error message because cartogRaflow is archived and use rgeos maptools in version 1.0.3?
My question is : how can put the version 1.0.4 in CRAN??
Thanks in advance?Sylvain?

Envoy? depuis Yahoo?Mail pour Android 
 
  Le mar., oct. 17, 2023 ? 10:03, Dirk Eddelbuettel<edd at debian.org> a ?crit:   
On 16 October 2023 at 10:42, Kevin R Coombes wrote:
| Produce a PDF file yourself, then use the "as.is" feature of the R.rsp 
| package.

For completeness, that approach also works directly with Sweave. Described in
a blog post by Mark van der Loo in 2019, and used in a number of packages
including a few of mine.

That said, I also used the approach described by John Harrold and cached
results myself.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel
  

	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 17 11:49:08 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 17 Oct 2023 12:49:08 +0300
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <1201375991.5521541.1697535925060@mail.yahoo.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <1201375991.5521541.1697535925060@mail.yahoo.com>
Message-ID: <20231017124908.3bfa218e@arachnoid>

Dear Sylvain,

? Tue, 17 Oct 2023 09:45:25 +0000 (UTC)
"cartograflow at gmail.com" <cartograflow at gmail.com> ?????:

> I've uploaded cartogRaflow version 1.0.4 with sf package.?
> I've submitted yesterday the version 1.0.4 in CRAN and received 2 two
> error message because cartogRaflow is archived and use rgeos maptools
> in version 1.0.3?

Could you please show us the full R CMD check report e-mailed to you in
response to the CRAN submission?

A NOTE saying that the previous version had been archived is to be
expected. If it's all your package got, it will be manually reviewed
later and published.

-- 
Best regards,
Ivan



From c@rtogr@iiow m@iii@g oii gm@ii@com  Tue Oct 17 12:40:32 2023
From: c@rtogr@iiow m@iii@g oii gm@ii@com (c@rtogr@iiow m@iii@g oii gm@ii@com)
Date: Tue, 17 Oct 2023 10:40:32 +0000 (UTC)
Subject: [R-pkg-devel] =?utf-8?b?UmXCoDpSZTogIFJlIDpSZTogIFN1cHByZXNzaW5n?=
 =?utf-8?q?_long-running_vignette_code_in_CRAN_submission?=
In-Reply-To: <20231017124908.3bfa218e@arachnoid>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <1201375991.5521541.1697535925060@mail.yahoo.com>
 <20231017124908.3bfa218e@arachnoid>
Message-ID: <333806507.14058055.1697539232276@mail.yahoo.com>

You will find the full R CMD check that I received?
Status: 2 NOTEs
Debian: <https://win-builder.r-project.org/incoming_pretest/cartograflow_1.0.4_20231016_225129/Debian/00check.log>


Envoy? depuis Yahoo?Mail pour Android 
 
  Le mar., oct. 17, 2023 ? 11:49, Ivan Krylov<krylov.r00t at gmail.com> a ?crit:   Dear Sylvain,

? Tue, 17 Oct 2023 09:45:25 +0000 (UTC)
"cartograflow at gmail.com" <cartograflow at gmail.com> ?????:

> I've uploaded cartogRaflow version 1.0.4 with sf package.?
> I've submitted yesterday the version 1.0.4 in CRAN and received 2 two
> error message because cartogRaflow is archived and use rgeos maptools
> in version 1.0.3?

Could you please show us the full R CMD check report e-mailed to you in
response to the CRAN submission?

A NOTE saying that the previous version had been archived is to be
expected. If it's all your package got, it will be manually reviewed
later and published.

-- 
Best regards,
Ivan
  

	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 17 12:53:33 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 17 Oct 2023 13:53:33 +0300
Subject: [R-pkg-devel] CartogRaflow submission
In-Reply-To: <1550121052.16258628.1697492339014@mail.yahoo.com>
References: <1550121052.16258628.1697492339014.ref@mail.yahoo.com>
 <1550121052.16258628.1697492339014@mail.yahoo.com>
Message-ID: <20231017135333.2fdfb05b@arachnoid>

This is the NOTE you've been asked to fix:

> * checking installed files from ?inst/doc? ... NOTE
> The following files should probably not be installed:
>   ?Logo_cartograflow.png?
> 
> Consider the use of a .Rinstignore file: see ?Writing R Extensions?,
> or move the vignette sources from ?inst/doc? to ?vignettes?.

I see you're using this logo in your README.md, not the vignette. I'm
not sure how CRAN's README.md renderer works and where it looks up the
images. Perhaps you do need to mention this file in .Rinstignore.

Many other packages seem to have given up and only use
externally-loaded images in their README.md (which is great for letting
third parties track the user every time they view a README).

-- 
Best regards,
Ivan



From j|ox @end|ng |rom mcm@@ter@c@  Tue Oct 17 16:02:54 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Tue, 17 Oct 2023 10:02:54 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <25902.16306.681621.578024@rob.eddelbuettel.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
Message-ID: <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>

Hello Dirk,

Thank you (and Kevin and John) for addressing my questions.

No one directly answered my first question, however, which was whether 
the approach that I suggested would work. I guess that the implication 
is that it won't, but it would be nice to confirm that before I try 
something else, specifically using R.rsp.

Best,
  John

On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
> Caution: External email.
> 
> 
> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
> | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
> | package.
> 
> For completeness, that approach also works directly with Sweave. Described in
> a blog post by Mark van der Loo in 2019, and used in a number of packages
> including a few of mine.
> 
> That said, I also used the approach described by John Harrold and cached
> results myself.
> 
> Dirk
> 
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk  Tue Oct 17 20:36:49 2023
From: georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk (Georgi Boshnakov)
Date: Tue, 17 Oct 2023 18:36:49 +0000
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
Message-ID: <LO0P265MB6325F97720F954C5B53C5982AED6A@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>

Hello John,

It should work for the scenario where you as developer and CRAN's checks should both be happy. But there are other scenarios were it might not work.

For example, if a user wishes to build a local pkgdown site for your package, they would need to know to set that environment variable. I also see that you have pkgdown actions on the github repo but the eval option is commented out there

     # eval = nzchar(Sys.getenv("REBUILD_VIGNETTES"))

Even so, I don't see the vignette on the rendered site. The same thing I observed when I cloned the package, uncommented the 'eval' option, and run pkgdown. Of course you  could modify the pkgdown action to set the environment variable.
I don't know why pkgdown doesn't include the vignette 'cv' (it includes the other one). 

Also when the vignette is created without evaluating the code it would be useful to include a very visible message, explaining how to create the full one.

All in all, some of the solutions recommended by others seem preferable.

Georgi Boshnakov


-----Original Message-----
From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf Of John Fox
Sent: Tuesday, October 17, 2023 3:03 PM
To: Dirk Eddelbuettel <edd at debian.org>
Cc: r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] Suppressing long-running vignette code in CRAN submission

Hello Dirk,

Thank you (and Kevin and John) for addressing my questions.

No one directly answered my first question, however, which was whether the approach that I suggested would work. I guess that the implication is that it won't, but it would be nice to confirm that before I try something else, specifically using R.rsp.

Best,
  John

On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
> Caution: External email.
> 
> 
> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
> | Produce a PDF file yourself, then use the "as.is" feature of the 
> | R.rsp package.
> 
> For completeness, that approach also works directly with Sweave. 
> Described in a blog post by Mark van der Loo in 2019, and used in a 
> number of packages including a few of mine.
> 
> That said, I also used the approach described by John Harrold and 
> cached results myself.
> 
> Dirk
> 
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list 
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-pa
> ckage-devel__;!!PDiH4ENfjr2_Jw!F7whfpm7565Ira_DwkEbOj5wjzyL-WztVmqP5Ak
> 56oOGw4wkUyMiLVCOno76H-Iu2wVBvuVMWoYaUtEdjWOx0vfSzv8t$ 
> [stat[.]ethz[.]ch]

______________________________________________
R-package-devel at r-project.org mailing list https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!F7whfpm7565Ira_DwkEbOj5wjzyL-WztVmqP5Ak56oOGw4wkUyMiLVCOno76H-Iu2wVBvuVMWoYaUtEdjWOx0vfSzv8t$ [stat[.]ethz[.]ch]

Dear list members,

I believe that this issue has been discussed previously, but I'm not sure that I have the solution right.

Georges Monette and I have developed a package that we intend to submit soon to CRAN which has a vignette including code that takes a long time to run. The sources for the package are available at <https://urldefense.com/v3/__https://github.com/gmonette/cv__;!!PDiH4ENfjr2_Jw!BUIYcAjj16HHKVqI_3EssWXnTOQ1Sz95Vv_aF1ebj4qCCayUfxFKDASOpfkJhK4YTWTDJsbDgRVAHngMjRyqzrZC5Wsa$ [github[.]com]>.

We figure that we have to suppress running the code the vignette when CRAN checks the package or the check time will be excessive.

The vignette is written as a .Rmd file to be compiled by knitr, producing an HTML vignette. The top of the .Rmd file looks like this:

------- snip -------

---
title: "Cross-validation of regression models"
author: "John Fox and Georges Monette"
date: "`r Sys.Date()`"
package: cv
output:
   rmarkdown::html_vignette:
   fig_caption: yes
bibliography: ["cv.bib"]
csl: apa.csl
vignette: >
   %\VignetteIndexEntry{Cross-validation of regression models}
   %\VignetteEngine{knitr::rmarkdown}
   %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
   collapse = TRUE,
   message = TRUE,
   warning = TRUE,
   fig.align = "center",
   fig.height = 6,
   fig.width = 7,
   fig.path = "fig/",
   dev = "png",
   comment = "#>",
   eval = nzchar(Sys.getenv("REBUILD_CV_VIGNETTES"))
)

### other irrelevant setup code not shown ###

```

------- snip -------

So (near the bottom), if the environment variable REBUILD_CV_VIGNETTES isn't empty, the code blocks in the vignette are evaluated, otherwise not. To build the tarball for the package to be submitted to CRAN, we will set REBUILD_CV_VIGNETTES to "true". That works as intended.

If we submit the tarball to CRAN, I believe that the package as distributed by CRAN will include the HTML vignette from our tarball, showing the evaluated code blocks, but when CRAN checks the package, these long-running code blocks will not be executed (because REBUILD_CV_VIGNETTES will not exist on the CRAN check machines).

My questions:

Is that correct?

If not, how can we ensure that the complete vignette is distributed by CRAN without causing an overly long CRAN check time?

In particular, we don't want CRAN to rebuild and distribute the vignette, because the resulting HTML file won't show the evaluated code.

Any assistance would be appreciated.

Thank you,
  John
--
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://urldefense.com/v3/__https://www.john-fox.ca/__;!!PDiH4ENfjr2_Jw!BUIYcAjj16HHKVqI_3EssWXnTOQ1Sz95Vv_aF1ebj4qCCayUfxFKDASOpfkJhK4YTWTDJsbDgRVAHngMjRyqzheH0nJ3$ [john-fox[.]ca]

______________________________________________
R-package-devel at r-project.org mailing list https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!BUIYcAjj16HHKVqI_3EssWXnTOQ1Sz95Vv_aF1ebj4qCCayUfxFKDASOpfkJhK4YTWTDJsbDgRVAHngMjRyqzih743zY$ [stat[.]ethz[.]ch]



From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 17 20:45:19 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 17 Oct 2023 21:45:19 +0300
Subject: [R-pkg-devel] Problem with "additional repository".
In-Reply-To: <a7971df4-03d1-3217-c3c5-0f9e8907b7b0@statistik.tu-dortmund.de>
References: <20231016143457.4e9abf93@rolf-Latitude-E7470>
 <96cc9a80-bf41-4383-ba5e-cefb8fa4ecaf@gmail.com>
 <a7971df4-03d1-3217-c3c5-0f9e8907b7b0@statistik.tu-dortmund.de>
Message-ID: <20231017214519.572762e3@Tarkus>

On Mon, 16 Oct 2023 17:08:28 +0200
Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:

> I do not know which package this refers to, so cannot easily look.

This seems to be about the eglhmm package. It seems to pass --as-cran
checks on my machine, but I know it's not the full set of checks
performed for new packages.

-- 
Best regards,
Ivan



From j|ox @end|ng |rom mcm@@ter@c@  Tue Oct 17 20:56:08 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Tue, 17 Oct 2023 14:56:08 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <LO0P265MB6325F97720F954C5B53C5982AED6A@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <LO0P265MB6325F97720F954C5B53C5982AED6A@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <a049e424-1710-4b65-99df-61b89c334639@mcmaster.ca>

Hello Georgi,

On 2023-10-17 2:36 p.m., Georgi Boshnakov wrote:
> Caution: External email.
> 
> 
> Hello John,
> 
> It should work for the scenario where you as developer and CRAN's checks should both be happy. 

Thank you for addressing that question. I was concerned that CRAN would 
rebuild the vignette for the tarball that they distribute, which then 
would have no output.

In the interim, I implemented the approach using the R.rsp package 
suggested by Kevin and Dirk. It seems to work OK. A downside is that we 
have to maintain two versions of the package -- one for development, 
using knitr to build the HTML vignettes and the other using R.rsp with 
the HTML vignettes pre-built.

> But there are other scenarios were it might not work.
> 
> For example, if a user wishes to build a local pkgdown site for your package, they would need to know to set that environment variable. I also see that you have pkgdown actions on the github repo but the eval option is commented out there
> 
>       # eval = nzchar(Sys.getenv("REBUILD_VIGNETTES"))
> 
> Even so, I don't see the vignette on the rendered site. The same thing I observed when I cloned the package, uncommented the 'eval' option, and run pkgdown. Of course you  could modify the pkgdown action to set the environment variable.
> I don't know why pkgdown doesn't include the vignette 'cv' (it includes the other one).

Yes, both vignettes are there. One is under "Get Started" (I believe 
because the vignette is in cv.html, with the same name as the package) 
and the other under "Articles."

> 
> Also when the vignette is created without evaluating the code it would be useful to include a very visible message, explaining how to create the full one.

Thanks for the suggestion. We'll think about this, though the process of 
creating the vignettes is already getting more complicated than I'd like.

> 
> All in all, some of the solutions recommended by others seem preferable.

Using R.rsp has the disadvantage of not including useful vignette 
sources in the tarball and thus installed package, but since it seems to 
be a well-used approach, I think we'll probably go with it.

Thanks again,
  John

> 
> Georgi Boshnakov
> 
> 
> -----Original Message-----
> From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf Of John Fox
> Sent: Tuesday, October 17, 2023 3:03 PM
> To: Dirk Eddelbuettel <edd at debian.org>
> Cc: r-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] Suppressing long-running vignette code in CRAN submission
> 
> Hello Dirk,
> 
> Thank you (and Kevin and John) for addressing my questions.
> 
> No one directly answered my first question, however, which was whether the approach that I suggested would work. I guess that the implication is that it won't, but it would be nice to confirm that before I try something else, specifically using R.rsp.
> 
> Best,
>    John
> 
> On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>> Caution: External email.
>>
>>
>> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>> | Produce a PDF file yourself, then use the "as.is" feature of the
>> | R.rsp package.
>>
>> For completeness, that approach also works directly with Sweave.
>> Described in a blog post by Mark van der Loo in 2019, and used in a
>> number of packages including a few of mine.
>>
>> That said, I also used the approach described by John Harrold and
>> cached results myself.
>>
>> Dirk
>>
>> --
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-pa
>> ckage-devel__;!!PDiH4ENfjr2_Jw!F7whfpm7565Ira_DwkEbOj5wjzyL-WztVmqP5Ak
>> 56oOGw4wkUyMiLVCOno76H-Iu2wVBvuVMWoYaUtEdjWOx0vfSzv8t$
>> [stat[.]ethz[.]ch]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!F7whfpm7565Ira_DwkEbOj5wjzyL-WztVmqP5Ak56oOGw4wkUyMiLVCOno76H-Iu2wVBvuVMWoYaUtEdjWOx0vfSzv8t$ [stat[.]ethz[.]ch]
> 
> Dear list members,
> 
> I believe that this issue has been discussed previously, but I'm not sure that I have the solution right.
> 
> Georges Monette and I have developed a package that we intend to submit soon to CRAN which has a vignette including code that takes a long time to run. The sources for the package are available at <https://urldefense.com/v3/__https://github.com/gmonette/cv__;!!PDiH4ENfjr2_Jw!BUIYcAjj16HHKVqI_3EssWXnTOQ1Sz95Vv_aF1ebj4qCCayUfxFKDASOpfkJhK4YTWTDJsbDgRVAHngMjRyqzrZC5Wsa$ [github[.]com]>.
> 
> We figure that we have to suppress running the code the vignette when CRAN checks the package or the check time will be excessive.
> 
> The vignette is written as a .Rmd file to be compiled by knitr, producing an HTML vignette. The top of the .Rmd file looks like this:
> 
> ------- snip -------
> 
> ---
> title: "Cross-validation of regression models"
> author: "John Fox and Georges Monette"
> date: "`r Sys.Date()`"
> package: cv
> output:
>     rmarkdown::html_vignette:
>     fig_caption: yes
> bibliography: ["cv.bib"]
> csl: apa.csl
> vignette: >
>     %\VignetteIndexEntry{Cross-validation of regression models}
>     %\VignetteEngine{knitr::rmarkdown}
>     %\VignetteEncoding{UTF-8}
> ---
> 
> ```{r setup, include = FALSE}
> knitr::opts_chunk$set(
>     collapse = TRUE,
>     message = TRUE,
>     warning = TRUE,
>     fig.align = "center",
>     fig.height = 6,
>     fig.width = 7,
>     fig.path = "fig/",
>     dev = "png",
>     comment = "#>",
>     eval = nzchar(Sys.getenv("REBUILD_CV_VIGNETTES"))
> )
> 
> ### other irrelevant setup code not shown ###
> 
> ```
> 
> ------- snip -------
> 
> So (near the bottom), if the environment variable REBUILD_CV_VIGNETTES isn't empty, the code blocks in the vignette are evaluated, otherwise not. To build the tarball for the package to be submitted to CRAN, we will set REBUILD_CV_VIGNETTES to "true". That works as intended.
> 
> If we submit the tarball to CRAN, I believe that the package as distributed by CRAN will include the HTML vignette from our tarball, showing the evaluated code blocks, but when CRAN checks the package, these long-running code blocks will not be executed (because REBUILD_CV_VIGNETTES will not exist on the CRAN check machines).
> 
> My questions:
> 
> Is that correct?
> 
> If not, how can we ensure that the complete vignette is distributed by CRAN without causing an overly long CRAN check time?
> 
> In particular, we don't want CRAN to rebuild and distribute the vignette, because the resulting HTML file won't show the evaluated code.
> 
> Any assistance would be appreciated.
> 
> Thank you,
>    John
> --
> John Fox, Professor Emeritus
> McMaster University
> Hamilton, Ontario, Canada
> web: https://urldefense.com/v3/__https://www.john-fox.ca/__;!!PDiH4ENfjr2_Jw!BUIYcAjj16HHKVqI_3EssWXnTOQ1Sz95Vv_aF1ebj4qCCayUfxFKDASOpfkJhK4YTWTDJsbDgRVAHngMjRyqzheH0nJ3$ [john-fox[.]ca]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!BUIYcAjj16HHKVqI_3EssWXnTOQ1Sz95Vv_aF1ebj4qCCayUfxFKDASOpfkJhK4YTWTDJsbDgRVAHngMjRyqzih743zY$ [stat[.]ethz[.]ch]



From edd @end|ng |rom deb|@n@org  Tue Oct 17 21:19:21 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 17 Oct 2023 14:19:21 -0500
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
Message-ID: <25902.56889.862756.303553@rob.eddelbuettel.com>


John,

On 17 October 2023 at 10:02, John Fox wrote:
| Hello Dirk,
| 
| Thank you (and Kevin and John) for addressing my questions.
| 
| No one directly answered my first question, however, which was whether 
| the approach that I suggested would work. I guess that the implication 
| is that it won't, but it would be nice to confirm that before I try 
| something else, specifically using R.rsp.

I am a little remote here, both mentally and physically. What I might do here
in the case of your long-running vignette, and have done in about half a
dozen packages where I wanted 'certainty' and no surprises, is to render the
pdf vignette I want as I want them locally, ship them in the package as an
included file (sometimes from a subdirectory) and have a five-or-so line
Sweave .Rnw file include it. That works without hassles. Here is the Rnw I
use for package anytime

-----------------------------------------------------------------------------
\documentclass{article}
\usepackage{pdfpages}
%\VignetteIndexEntry{Introduction to anytime}
%\VignetteKeywords{anytime, date, datetime, conversion}
%\VignettePackage{anytime}
%\VignetteEncoding{UTF-8}

\begin{document}
\includepdf[pages=-, fitpaper=true]{anytime-intro.pdf}
\end{document}
-----------------------------------------------------------------------------

That is five lines of LaTeX code slurping in the pdf (per the blog post by
Mark). As I understand it R.rsp does something similar at the marginal cost
of an added dependency.

Now, as mentioned, you can also 'conditionally' conpute in a vignette and
choose if and when to use a data cache. I think that we show most of that in
the package described in the RJournal piece by Brooke and myself on drat for
data repositories. (We may be skipping the compute when the data is not
accessible. Loading a precomputed set is similar. I may be doing that in the
much older never quite finished gcbd package and its vignette.

Hope this helps, maybe more once I am back home.

Cheers, Dirk
 
| Best,
|   John
| 
| On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
| > Caution: External email.
| > 
| > 
| > On 16 October 2023 at 10:42, Kevin R Coombes wrote:
| > | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
| > | package.
| > 
| > For completeness, that approach also works directly with Sweave. Described in
| > a blog post by Mark van der Loo in 2019, and used in a number of packages
| > including a few of mine.
| > 
| > That said, I also used the approach described by John Harrold and cached
| > results myself.
| > 
| > Dirk
| > 
| > --
| > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
| > 
| > ______________________________________________
| > R-package-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-package-devel
| 

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From |eo@m@d@ @end|ng |rom @yon|c@eu  Tue Oct 17 21:34:33 2023
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leonard Mada)
Date: Tue, 17 Oct 2023 22:34:33 +0300
Subject: [R-pkg-devel] CMD check: Examples vs DEPENDS pkg
Message-ID: <7ea981c3-faec-490f-841d-4ce8fce8e5cb@syonic.eu>

Dear List members,

Package Rpdf depends on package rgl. Multiple examples will call 
internally the rgl package to visualize the pdb molecule.

When performing the CMD check:
1) Is the rgl package loaded each time anew for any of those examples?

2) If this is the case:
Is it possible to load it only once per CMD check?

Sincerely,

Leonard



From j|ox @end|ng |rom mcm@@ter@c@  Tue Oct 17 21:36:40 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Tue, 17 Oct 2023 15:36:40 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <25902.56889.862756.303553@rob.eddelbuettel.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <25902.56889.862756.303553@rob.eddelbuettel.com>
Message-ID: <93bdcae3-8cab-4384-aadd-48e19e9eaf5b@mcmaster.ca>

Hello Dirk,

Thank you for the additional information.

As you suggest, what you did to distribute pre-built PDF vignettes is 
quite similar to what R.rsp does, except that the latter also supports 
pre-built HTML vignettes, which is what I'd prefer to distribute. Since 
I apparently have that working now, we'll probably go with it unless we 
hit snags when the package is sent to CRAN.

While I appreciate the offer, it's probably not necessary for you to 
spend more time on this now.

Thanks again,
  John

On 2023-10-17 3:19 p.m., Dirk Eddelbuettel wrote:
> Caution: External email.
> 
> 
> John,
> 
> On 17 October 2023 at 10:02, John Fox wrote:
> | Hello Dirk,
> |
> | Thank you (and Kevin and John) for addressing my questions.
> |
> | No one directly answered my first question, however, which was whether
> | the approach that I suggested would work. I guess that the implication
> | is that it won't, but it would be nice to confirm that before I try
> | something else, specifically using R.rsp.
> 
> I am a little remote here, both mentally and physically. What I might do here
> in the case of your long-running vignette, and have done in about half a
> dozen packages where I wanted 'certainty' and no surprises, is to render the
> pdf vignette I want as I want them locally, ship them in the package as an
> included file (sometimes from a subdirectory) and have a five-or-so line
> Sweave .Rnw file include it. That works without hassles. Here is the Rnw I
> use for package anytime
> 
> -----------------------------------------------------------------------------
> \documentclass{article}
> \usepackage{pdfpages}
> %\VignetteIndexEntry{Introduction to anytime}
> %\VignetteKeywords{anytime, date, datetime, conversion}
> %\VignettePackage{anytime}
> %\VignetteEncoding{UTF-8}
> 
> \begin{document}
> \includepdf[pages=-, fitpaper=true]{anytime-intro.pdf}
> \end{document}
> -----------------------------------------------------------------------------
> 
> That is five lines of LaTeX code slurping in the pdf (per the blog post by
> Mark). As I understand it R.rsp does something similar at the marginal cost
> of an added dependency.
> 
> Now, as mentioned, you can also 'conditionally' conpute in a vignette and
> choose if and when to use a data cache. I think that we show most of that in
> the package described in the RJournal piece by Brooke and myself on drat for
> data repositories. (We may be skipping the compute when the data is not
> accessible. Loading a precomputed set is similar. I may be doing that in the
> much older never quite finished gcbd package and its vignette.
> 
> Hope this helps, maybe more once I am back home.
> 
> Cheers, Dirk
> 
> | Best,
> |   John
> |
> | On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
> | > Caution: External email.
> | >
> | >
> | > On 16 October 2023 at 10:42, Kevin R Coombes wrote:
> | > | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
> | > | package.
> | >
> | > For completeness, that approach also works directly with Sweave. Described in
> | > a blog post by Mark van der Loo in 2019, and used in a number of packages
> | > including a few of mine.
> | >
> | > That said, I also used the approach described by John Harrold and cached
> | > results myself.
> | >
> | > Dirk
> | >
> | > --
> | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> | >
> | > ______________________________________________
> | > R-package-devel at r-project.org mailing list
> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> |
> 
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From henr|k@bengt@@on @end|ng |rom gm@||@com  Tue Oct 17 21:50:07 2023
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Tue, 17 Oct 2023 12:50:07 -0700
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <93bdcae3-8cab-4384-aadd-48e19e9eaf5b@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <25902.56889.862756.303553@rob.eddelbuettel.com>
 <93bdcae3-8cab-4384-aadd-48e19e9eaf5b@mcmaster.ca>
Message-ID: <CAFDcVCSEgBvgiUgsk-PYBK5p6k=CbWeLy7=uN9DNS+kNbLXbAg@mail.gmail.com>

On Tue, Oct 17, 2023 at 12:45?PM John Fox <jfox at mcmaster.ca> wrote:
>
> Hello Dirk,
>
> Thank you for the additional information.
>
> As you suggest, what you did to distribute pre-built PDF vignettes is
> quite similar to what R.rsp does, except that the latter also supports
> pre-built HTML vignettes, which is what I'd prefer to distribute. Since

Author of R.rsp here: It supports both static PDFs and static HTMLs, cf.

https://cran.r-project.org/web/packages/R.rsp/vignettes/R_packages-Static_PDF_and_HTML_vignettes.pdf

/Henrik

> I apparently have that working now, we'll probably go with it unless we
> hit snags when the package is sent to CRAN.
>
> While I appreciate the offer, it's probably not necessary for you to
> spend more time on this now.
>
> Thanks again,
>   John
>
> On 2023-10-17 3:19 p.m., Dirk Eddelbuettel wrote:
> > Caution: External email.
> >
> >
> > John,
> >
> > On 17 October 2023 at 10:02, John Fox wrote:
> > | Hello Dirk,
> > |
> > | Thank you (and Kevin and John) for addressing my questions.
> > |
> > | No one directly answered my first question, however, which was whether
> > | the approach that I suggested would work. I guess that the implication
> > | is that it won't, but it would be nice to confirm that before I try
> > | something else, specifically using R.rsp.
> >
> > I am a little remote here, both mentally and physically. What I might do here
> > in the case of your long-running vignette, and have done in about half a
> > dozen packages where I wanted 'certainty' and no surprises, is to render the
> > pdf vignette I want as I want them locally, ship them in the package as an
> > included file (sometimes from a subdirectory) and have a five-or-so line
> > Sweave .Rnw file include it. That works without hassles. Here is the Rnw I
> > use for package anytime
> >
> > -----------------------------------------------------------------------------
> > \documentclass{article}
> > \usepackage{pdfpages}
> > %\VignetteIndexEntry{Introduction to anytime}
> > %\VignetteKeywords{anytime, date, datetime, conversion}
> > %\VignettePackage{anytime}
> > %\VignetteEncoding{UTF-8}
> >
> > \begin{document}
> > \includepdf[pages=-, fitpaper=true]{anytime-intro.pdf}
> > \end{document}
> > -----------------------------------------------------------------------------
> >
> > That is five lines of LaTeX code slurping in the pdf (per the blog post by
> > Mark). As I understand it R.rsp does something similar at the marginal cost
> > of an added dependency.
> >
> > Now, as mentioned, you can also 'conditionally' conpute in a vignette and
> > choose if and when to use a data cache. I think that we show most of that in
> > the package described in the RJournal piece by Brooke and myself on drat for
> > data repositories. (We may be skipping the compute when the data is not
> > accessible. Loading a precomputed set is similar. I may be doing that in the
> > much older never quite finished gcbd package and its vignette.
> >
> > Hope this helps, maybe more once I am back home.
> >
> > Cheers, Dirk
> >
> > | Best,
> > |   John
> > |
> > | On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
> > | > Caution: External email.
> > | >
> > | >
> > | > On 16 October 2023 at 10:42, Kevin R Coombes wrote:
> > | > | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
> > | > | package.
> > | >
> > | > For completeness, that approach also works directly with Sweave. Described in
> > | > a blog post by Mark van der Loo in 2019, and used in a number of packages
> > | > including a few of mine.
> > | >
> > | > That said, I also used the approach described by John Harrold and cached
> > | > results myself.
> > | >
> > | > Dirk
> > | >
> > | > --
> > | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> > | >
> > | > ______________________________________________
> > | > R-package-devel at r-project.org mailing list
> > | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> > |
> >
> > --
> > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From @|mon@urb@nek @end|ng |rom R-project@org  Tue Oct 17 21:51:29 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 18 Oct 2023 08:51:29 +1300
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
Message-ID: <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>

John,

the short answer is it won't work (it defeats the purpose of vignettes).

However, this sounds like a purely hypothetical question - CRAN policies allow long-running vignettes if they declared.

Cheers,
Simon


> On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
> 
> Hello Dirk,
> 
> Thank you (and Kevin and John) for addressing my questions.
> 
> No one directly answered my first question, however, which was whether the approach that I suggested would work. I guess that the implication is that it won't, but it would be nice to confirm that before I try something else, specifically using R.rsp.
> 
> Best,
> John
> 
> On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>> Caution: External email.
>> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>> | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
>> | package.
>> For completeness, that approach also works directly with Sweave. Described in
>> a blog post by Mark van der Loo in 2019, and used in a number of packages
>> including a few of mine.
>> That said, I also used the approach described by John Harrold and cached
>> results myself.
>> Dirk
>> --
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 



From j|ox @end|ng |rom mcm@@ter@c@  Tue Oct 17 22:18:48 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Tue, 17 Oct 2023 16:18:48 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <CAFDcVCSEgBvgiUgsk-PYBK5p6k=CbWeLy7=uN9DNS+kNbLXbAg@mail.gmail.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <25902.56889.862756.303553@rob.eddelbuettel.com>
 <93bdcae3-8cab-4384-aadd-48e19e9eaf5b@mcmaster.ca>
 <CAFDcVCSEgBvgiUgsk-PYBK5p6k=CbWeLy7=uN9DNS+kNbLXbAg@mail.gmail.com>
Message-ID: <a274fa0e-c3d2-4df5-b265-0e4b023381bb@mcmaster.ca>

Dear Henrik,

I'd already read the R.rsp vignette to which you refer, and, as I said, 
confirmed that I can use R.rsp to implement static HTML vignettes for 
our package.

Thank you for the confirmation,
  John

On 2023-10-17 3:50 p.m., Henrik Bengtsson wrote:
> Caution: External email.
> 
> 
> On Tue, Oct 17, 2023 at 12:45?PM John Fox <jfox at mcmaster.ca> wrote:
>>
>> Hello Dirk,
>>
>> Thank you for the additional information.
>>
>> As you suggest, what you did to distribute pre-built PDF vignettes is
>> quite similar to what R.rsp does, except that the latter also supports
>> pre-built HTML vignettes, which is what I'd prefer to distribute. Since
> 
> Author of R.rsp here: It supports both static PDFs and static HTMLs, cf.
> 
> https://cran.r-project.org/web/packages/R.rsp/vignettes/R_packages-Static_PDF_and_HTML_vignettes.pdf
> 
> /Henrik
> 
>> I apparently have that working now, we'll probably go with it unless we
>> hit snags when the package is sent to CRAN.
>>
>> While I appreciate the offer, it's probably not necessary for you to
>> spend more time on this now.
>>
>> Thanks again,
>>    John
>>
>> On 2023-10-17 3:19 p.m., Dirk Eddelbuettel wrote:
>>> Caution: External email.
>>>
>>>
>>> John,
>>>
>>> On 17 October 2023 at 10:02, John Fox wrote:
>>> | Hello Dirk,
>>> |
>>> | Thank you (and Kevin and John) for addressing my questions.
>>> |
>>> | No one directly answered my first question, however, which was whether
>>> | the approach that I suggested would work. I guess that the implication
>>> | is that it won't, but it would be nice to confirm that before I try
>>> | something else, specifically using R.rsp.
>>>
>>> I am a little remote here, both mentally and physically. What I might do here
>>> in the case of your long-running vignette, and have done in about half a
>>> dozen packages where I wanted 'certainty' and no surprises, is to render the
>>> pdf vignette I want as I want them locally, ship them in the package as an
>>> included file (sometimes from a subdirectory) and have a five-or-so line
>>> Sweave .Rnw file include it. That works without hassles. Here is the Rnw I
>>> use for package anytime
>>>
>>> -----------------------------------------------------------------------------
>>> \documentclass{article}
>>> \usepackage{pdfpages}
>>> %\VignetteIndexEntry{Introduction to anytime}
>>> %\VignetteKeywords{anytime, date, datetime, conversion}
>>> %\VignettePackage{anytime}
>>> %\VignetteEncoding{UTF-8}
>>>
>>> \begin{document}
>>> \includepdf[pages=-, fitpaper=true]{anytime-intro.pdf}
>>> \end{document}
>>> -----------------------------------------------------------------------------
>>>
>>> That is five lines of LaTeX code slurping in the pdf (per the blog post by
>>> Mark). As I understand it R.rsp does something similar at the marginal cost
>>> of an added dependency.
>>>
>>> Now, as mentioned, you can also 'conditionally' conpute in a vignette and
>>> choose if and when to use a data cache. I think that we show most of that in
>>> the package described in the RJournal piece by Brooke and myself on drat for
>>> data repositories. (We may be skipping the compute when the data is not
>>> accessible. Loading a precomputed set is similar. I may be doing that in the
>>> much older never quite finished gcbd package and its vignette.
>>>
>>> Hope this helps, maybe more once I am back home.
>>>
>>> Cheers, Dirk
>>>
>>> | Best,
>>> |   John
>>> |
>>> | On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>>> | > Caution: External email.
>>> | >
>>> | >
>>> | > On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>>> | > | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
>>> | > | package.
>>> | >
>>> | > For completeness, that approach also works directly with Sweave. Described in
>>> | > a blog post by Mark van der Loo in 2019, and used in a number of packages
>>> | > including a few of mine.
>>> | >
>>> | > That said, I also used the approach described by John Harrold and cached
>>> | > results myself.
>>> | >
>>> | > Dirk
>>> | >
>>> | > --
>>> | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>> | >
>>> | > ______________________________________________
>>> | > R-package-devel at r-project.org mailing list
>>> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>> |
>>>
>>> --
>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From j|ox @end|ng |rom mcm@@ter@c@  Tue Oct 17 22:21:13 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Tue, 17 Oct 2023 16:21:13 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
Message-ID: <86bf2be1-9fd2-43f0-85f1-db0c82c1a028@mcmaster.ca>

Hello Simon,

On 2023-10-17 3:51 p.m., Simon Urbanek wrote:
> Caution: External email.
> 
> 
> John,
> 
> the short answer is it won't work (it defeats the purpose of vignettes).

Thank you for confirming that.

> 
> However, this sounds like a purely hypothetical question - CRAN policies allow long-running vignettes if they declared.

I assume that we'd declare the long-running vignette in our submission 
note to CRAN. Maybe that's better than pre-building the HTML vignettes 
in the package.

Best,
  John

> 
> Cheers,
> Simon
> 
> 
>> On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
>>
>> Hello Dirk,
>>
>> Thank you (and Kevin and John) for addressing my questions.
>>
>> No one directly answered my first question, however, which was whether the approach that I suggested would work. I guess that the implication is that it won't, but it would be nice to confirm that before I try something else, specifically using R.rsp.
>>
>> Best,
>> John
>>
>> On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>>> Caution: External email.
>>> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>>> | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
>>> | package.
>>> For completeness, that approach also works directly with Sweave. Described in
>>> a blog post by Mark van der Loo in 2019, and used in a number of packages
>>> including a few of mine.
>>> That said, I also used the approach described by John Harrold and cached
>>> results myself.
>>> Dirk
>>> --
>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>



From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 17 22:43:37 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 17 Oct 2023 16:43:37 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <86bf2be1-9fd2-43f0-85f1-db0c82c1a028@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <86bf2be1-9fd2-43f0-85f1-db0c82c1a028@mcmaster.ca>
Message-ID: <a29e1ed3-c151-49cc-85a5-018259579367@gmail.com>

On 17/10/2023 4:21 p.m., John Fox wrote:
> Hello Simon,
> 
> On 2023-10-17 3:51 p.m., Simon Urbanek wrote:
>> Caution: External email.
>>
>>
>> John,
>>
>> the short answer is it won't work (it defeats the purpose of vignettes).
> 
> Thank you for confirming that.
> 
>>
>> However, this sounds like a purely hypothetical question - CRAN policies allow long-running vignettes if they declared.
> 
> I assume that we'd declare the long-running vignette in our submission
> note to CRAN. Maybe that's better than pre-building the HTML vignettes
> in the package.
> 


There's also the "BuildVignettes: false" field in DESCRIPTION, but its 
use is discouraged, and I don't think it allows you to ask CRAN to build 
some vignettes but not all.

Duncan Murdoch

> Best,
>    John
> 
>>
>> Cheers,
>> Simon
>>
>>
>>> On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
>>>
>>> Hello Dirk,
>>>
>>> Thank you (and Kevin and John) for addressing my questions.
>>>
>>> No one directly answered my first question, however, which was whether the approach that I suggested would work. I guess that the implication is that it won't, but it would be nice to confirm that before I try something else, specifically using R.rsp.
>>>
>>> Best,
>>> John
>>>
>>> On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>>>> Caution: External email.
>>>> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>>>> | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
>>>> | package.
>>>> For completeness, that approach also works directly with Sweave. Described in
>>>> a blog post by Mark van der Loo in 2019, and used in a number of packages
>>>> including a few of mine.
>>>> That said, I also used the approach described by John Harrold and cached
>>>> results myself.
>>>> Dirk
>>>> --
>>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From j|ox @end|ng |rom mcm@@ter@c@  Tue Oct 17 23:10:44 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Tue, 17 Oct 2023 17:10:44 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <a29e1ed3-c151-49cc-85a5-018259579367@gmail.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <86bf2be1-9fd2-43f0-85f1-db0c82c1a028@mcmaster.ca>
 <a29e1ed3-c151-49cc-85a5-018259579367@gmail.com>
Message-ID: <b35da515-4d25-4492-8211-8efad96d8b0e@mcmaster.ca>

Hello Duncan,

On 2023-10-17 4:43 p.m., Duncan Murdoch wrote:
> Caution: External email.
> 
> 
> On 17/10/2023 4:21 p.m., John Fox wrote:
>> Hello Simon,
>>
>> On 2023-10-17 3:51 p.m., Simon Urbanek wrote:
>>> Caution: External email.
>>>
>>>
>>> John,
>>>
>>> the short answer is it won't work (it defeats the purpose of vignettes).
>>
>> Thank you for confirming that.
>>
>>>
>>> However, this sounds like a purely hypothetical question - CRAN 
>>> policies allow long-running vignettes if they declared.
>>
>> I assume that we'd declare the long-running vignette in our submission
>> note to CRAN. Maybe that's better than pre-building the HTML vignettes
>> in the package.
>>
> 
> 
> There's also the "BuildVignettes: false" field in DESCRIPTION, but its
> use is discouraged, and I don't think it allows you to ask CRAN to build
> some vignettes but not all.

Thanks, I wasn't aware of that. There are two vignettes, one of which is 
slow to build.

Given Simon's suggestion, we'll likely submit the package with a note 
about the long-running vignette, and if that proves problematic, we can 
use R.asp to pre-build the HTML vignettes.

Best,
  John

> 
> Duncan Murdoch
> 
>> Best,
>> ?? John
>>
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>> On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
>>>>
>>>> Hello Dirk,
>>>>
>>>> Thank you (and Kevin and John) for addressing my questions.
>>>>
>>>> No one directly answered my first question, however, which was 
>>>> whether the approach that I suggested would work. I guess that the 
>>>> implication is that it won't, but it would be nice to confirm that 
>>>> before I try something else, specifically using R.rsp.
>>>>
>>>> Best,
>>>> John
>>>>
>>>> On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>>>>> Caution: External email.
>>>>> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>>>>> | Produce a PDF file yourself, then use the "as.is" feature of the 
>>>>> R.rsp
>>>>> | package.
>>>>> For completeness, that approach also works directly with Sweave. 
>>>>> Described in
>>>>> a blog post by Mark van der Loo in 2019, and used in a number of 
>>>>> packages
>>>>> including a few of mine.
>>>>> That said, I also used the approach described by John Harrold and 
>>>>> cached
>>>>> results myself.
>>>>> Dirk
>>>>> -- 
>>>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>



From edd @end|ng |rom deb|@n@org  Wed Oct 18 00:03:55 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 17 Oct 2023 17:03:55 -0500
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
Message-ID: <25903.1227.152942.179691@rob.eddelbuettel.com>


On 18 October 2023 at 08:51, Simon Urbanek wrote:
| John,
| 
| the short answer is it won't work (it defeats the purpose of vignettes).

Not exactly. Everything is under our (i.e. package author) control, and when
we want to replace 'computed' values with cached values we can.

All this is somewhat of a charade. "Of course" we want vignettes to run
tests. But then we don't want to fall over random missing .sty files or fonts
(macOS machines have been less forgiving than others), not to mention compile
time.

So for simplicity I often pre-make pdf vignettes that get included in other
latex code as source. Works great, never fails, CRAN never complained --
which is somewhat contrary to your statement.

It is effectively the same with tests. We all want maximum test surfaces. But
when tests fail, or when they run too long, or [insert many other reasons
here] so many packages run tests conditionally.  Such is life.

Dirk

 
| However, this sounds like a purely hypothetical question - CRAN policies allow long-running vignettes if they declared.
| 
| Cheers,
| Simon
| 
| 
| > On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
| > 
| > Hello Dirk,
| > 
| > Thank you (and Kevin and John) for addressing my questions.
| > 
| > No one directly answered my first question, however, which was whether the approach that I suggested would work. I guess that the implication is that it won't, but it would be nice to confirm that before I try something else, specifically using R.rsp.
| > 
| > Best,
| > John
| > 
| > On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
| >> Caution: External email.
| >> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
| >> | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
| >> | package.
| >> For completeness, that approach also works directly with Sweave. Described in
| >> a blog post by Mark van der Loo in 2019, and used in a number of packages
| >> including a few of mine.
| >> That said, I also used the approach described by John Harrold and cached
| >> results myself.
| >> Dirk
| >> --
| >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
| >> ______________________________________________
| >> R-package-devel at r-project.org mailing list
| >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
| > 
| > ______________________________________________
| > R-package-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-package-devel
| > 
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From @|mon@urb@nek @end|ng |rom R-project@org  Wed Oct 18 00:20:52 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 18 Oct 2023 11:20:52 +1300
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <25903.1227.152942.179691@rob.eddelbuettel.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <25903.1227.152942.179691@rob.eddelbuettel.com>
Message-ID: <EEE4B215-983F-4D50-96B3-20B3410FBC41@R-project.org>

Dirk,

I think you misread the email - John was was asking specifically about his approach to use REBUILD_CV_VIGNETTES without any caching since that was the original question which no one answered in the thread - and that was what I was answering. The alternative approaches were already discussed to death so I didn't comment on those.

Cheers,
Simon



> On 18/10/2023, at 11:03 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> On 18 October 2023 at 08:51, Simon Urbanek wrote:
> | John,
> | 
> | the short answer is it won't work (it defeats the purpose of vignettes).
> 
> Not exactly. Everything is under our (i.e. package author) control, and when
> we want to replace 'computed' values with cached values we can.
> 
> All this is somewhat of a charade. "Of course" we want vignettes to run
> tests. But then we don't want to fall over random missing .sty files or fonts
> (macOS machines have been less forgiving than others), not to mention compile
> time.
> 
> So for simplicity I often pre-make pdf vignettes that get included in other
> latex code as source. Works great, never fails, CRAN never complained --
> which is somewhat contrary to your statement.
> 
> It is effectively the same with tests. We all want maximum test surfaces. But
> when tests fail, or when they run too long, or [insert many other reasons
> here] so many packages run tests conditionally.  Such is life.
> 
> Dirk
> 
> 
> | However, this sounds like a purely hypothetical question - CRAN policies allow long-running vignettes if they declared.
> | 
> | Cheers,
> | Simon
> | 
> | 
> | > On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
> | > 
> | > Hello Dirk,
> | > 
> | > Thank you (and Kevin and John) for addressing my questions.
> | > 
> | > No one directly answered my first question, however, which was whether the approach that I suggested would work. I guess that the implication is that it won't, but it would be nice to confirm that before I try something else, specifically using R.rsp.
> | > 
> | > Best,
> | > John
> | > 
> | > On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
> | >> Caution: External email.
> | >> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
> | >> | Produce a PDF file yourself, then use the "as.is" feature of the R.rsp
> | >> | package.
> | >> For completeness, that approach also works directly with Sweave. Described in
> | >> a blog post by Mark van der Loo in 2019, and used in a number of packages
> | >> including a few of mine.
> | >> That said, I also used the approach described by John Harrold and cached
> | >> results myself.
> | >> Dirk
> | >> --
> | >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> | >> ______________________________________________
> | >> R-package-devel at r-project.org mailing list
> | >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> | > 
> | > ______________________________________________
> | > R-package-devel at r-project.org mailing list
> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> | > 
> | 
> | ______________________________________________
> | R-package-devel at r-project.org mailing list
> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 



From john@m@h@rro|d @end|ng |rom gm@||@com  Wed Oct 18 00:30:22 2023
From: john@m@h@rro|d @end|ng |rom gm@||@com (John Harrold)
Date: Tue, 17 Oct 2023 15:30:22 -0700
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <25903.1227.152942.179691@rob.eddelbuettel.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <25903.1227.152942.179691@rob.eddelbuettel.com>
Message-ID: <CANAiAiXk7TeX9ndA+Q+kLtWd7dbdJh-LQqU+MpgusWX_efO46Q@mail.gmail.com>

I ask myself the question: Who is the vignette for?  It does server two
purposes. One is testing but primarily it's for the users to learn how to
use a package. I think the testing is secondary, and if it slows down
installation or general usability I'd sacrifice the testing. If it's that
important, then the tests can be added explicitly in tests/.

On Tue, Oct 17, 2023 at 3:04?PM Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 18 October 2023 at 08:51, Simon Urbanek wrote:
> | John,
> |
> | the short answer is it won't work (it defeats the purpose of vignettes).
>
> Not exactly. Everything is under our (i.e. package author) control, and
> when
> we want to replace 'computed' values with cached values we can.
>
> All this is somewhat of a charade. "Of course" we want vignettes to run
> tests. But then we don't want to fall over random missing .sty files or
> fonts
> (macOS machines have been less forgiving than others), not to mention
> compile
> time.
>
> So for simplicity I often pre-make pdf vignettes that get included in other
> latex code as source. Works great, never fails, CRAN never complained --
> which is somewhat contrary to your statement.
>
> It is effectively the same with tests. We all want maximum test surfaces.
> But
> when tests fail, or when they run too long, or [insert many other reasons
> here] so many packages run tests conditionally.  Such is life.
>
> Dirk
>
>
> | However, this sounds like a purely hypothetical question - CRAN policies
> allow long-running vignettes if they declared.
> |
> | Cheers,
> | Simon
> |
> |
> | > On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
> | >
> | > Hello Dirk,
> | >
> | > Thank you (and Kevin and John) for addressing my questions.
> | >
> | > No one directly answered my first question, however, which was whether
> the approach that I suggested would work. I guess that the implication is
> that it won't, but it would be nice to confirm that before I try something
> else, specifically using R.rsp.
> | >
> | > Best,
> | > John
> | >
> | > On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
> | >> Caution: External email.
> | >> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
> | >> | Produce a PDF file yourself, then use the "as.is" feature of the
> R.rsp
> | >> | package.
> | >> For completeness, that approach also works directly with Sweave.
> Described in
> | >> a blog post by Mark van der Loo in 2019, and used in a number of
> packages
> | >> including a few of mine.
> | >> That said, I also used the approach described by John Harrold and
> cached
> | >> results myself.
> | >> Dirk
> | >> --
> | >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> | >> ______________________________________________
> | >> R-package-devel at r-project.org mailing list
> | >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> | >
> | > ______________________________________________
> | > R-package-devel at r-project.org mailing list
> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> | >
> |
> | ______________________________________________
> | R-package-devel at r-project.org mailing list
> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Oct 18 00:38:20 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 17 Oct 2023 18:38:20 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <CANAiAiXk7TeX9ndA+Q+kLtWd7dbdJh-LQqU+MpgusWX_efO46Q@mail.gmail.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <25903.1227.152942.179691@rob.eddelbuettel.com>
 <CANAiAiXk7TeX9ndA+Q+kLtWd7dbdJh-LQqU+MpgusWX_efO46Q@mail.gmail.com>
Message-ID: <cf423297-5723-4482-9f82-18e2ce60432f@gmail.com>

And if the vignette claims to help the users, but contains errors?  Then 
it's not very helpful at all.  That's what the testing is there to detect.

Duncan Murdoch

On 17/10/2023 6:30 p.m., John Harrold wrote:
> I ask myself the question: Who is the vignette for?  It does server two
> purposes. One is testing but primarily it's for the users to learn how to
> use a package. I think the testing is secondary, and if it slows down
> installation or general usability I'd sacrifice the testing. If it's that
> important, then the tests can be added explicitly in tests/.
> 
> On Tue, Oct 17, 2023 at 3:04?PM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>>
>> On 18 October 2023 at 08:51, Simon Urbanek wrote:
>> | John,
>> |
>> | the short answer is it won't work (it defeats the purpose of vignettes).
>>
>> Not exactly. Everything is under our (i.e. package author) control, and
>> when
>> we want to replace 'computed' values with cached values we can.
>>
>> All this is somewhat of a charade. "Of course" we want vignettes to run
>> tests. But then we don't want to fall over random missing .sty files or
>> fonts
>> (macOS machines have been less forgiving than others), not to mention
>> compile
>> time.
>>
>> So for simplicity I often pre-make pdf vignettes that get included in other
>> latex code as source. Works great, never fails, CRAN never complained --
>> which is somewhat contrary to your statement.
>>
>> It is effectively the same with tests. We all want maximum test surfaces.
>> But
>> when tests fail, or when they run too long, or [insert many other reasons
>> here] so many packages run tests conditionally.  Such is life.
>>
>> Dirk
>>
>>
>> | However, this sounds like a purely hypothetical question - CRAN policies
>> allow long-running vignettes if they declared.
>> |
>> | Cheers,
>> | Simon
>> |
>> |
>> | > On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
>> | >
>> | > Hello Dirk,
>> | >
>> | > Thank you (and Kevin and John) for addressing my questions.
>> | >
>> | > No one directly answered my first question, however, which was whether
>> the approach that I suggested would work. I guess that the implication is
>> that it won't, but it would be nice to confirm that before I try something
>> else, specifically using R.rsp.
>> | >
>> | > Best,
>> | > John
>> | >
>> | > On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>> | >> Caution: External email.
>> | >> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>> | >> | Produce a PDF file yourself, then use the "as.is" feature of the
>> R.rsp
>> | >> | package.
>> | >> For completeness, that approach also works directly with Sweave.
>> Described in
>> | >> a blog post by Mark van der Loo in 2019, and used in a number of
>> packages
>> | >> including a few of mine.
>> | >> That said, I also used the approach described by John Harrold and
>> cached
>> | >> results myself.
>> | >> Dirk
>> | >> --
>> | >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> | >> ______________________________________________
>> | >> R-package-devel at r-project.org mailing list
>> | >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> | >
>> | > ______________________________________________
>> | > R-package-devel at r-project.org mailing list
>> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> | >
>> |
>> | ______________________________________________
>> | R-package-devel at r-project.org mailing list
>> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> --
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From j|ox @end|ng |rom mcm@@ter@c@  Wed Oct 18 00:45:38 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Tue, 17 Oct 2023 18:45:38 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <CANAiAiXk7TeX9ndA+Q+kLtWd7dbdJh-LQqU+MpgusWX_efO46Q@mail.gmail.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <25903.1227.152942.179691@rob.eddelbuettel.com>
 <CANAiAiXk7TeX9ndA+Q+kLtWd7dbdJh-LQqU+MpgusWX_efO46Q@mail.gmail.com>
Message-ID: <1ca51da7-6243-45d6-b3cd-811130b52ec2@mcmaster.ca>

Dear John,

Unless I'm mistaken, the *installation* time of the package isn't really 
at issue. If a user installs a package from a tarball provided by CRAN, 
the vignettes aren't normally rebuilt.

Best,
  John

On 2023-10-17 6:30 p.m., John Harrold wrote:
> Caution: External email.
> 
> 
> I ask myself the question: Who is the vignette for?  It does server two
> purposes. One is testing but primarily it's for the users to learn how to
> use a package. I think the testing is secondary, and if it slows down
> installation or general usability I'd sacrifice the testing. If it's that
> important, then the tests can be added explicitly in tests/.
> 
> On Tue, Oct 17, 2023 at 3:04?PM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>>
>> On 18 October 2023 at 08:51, Simon Urbanek wrote:
>> | John,
>> |
>> | the short answer is it won't work (it defeats the purpose of vignettes).
>>
>> Not exactly. Everything is under our (i.e. package author) control, and
>> when
>> we want to replace 'computed' values with cached values we can.
>>
>> All this is somewhat of a charade. "Of course" we want vignettes to run
>> tests. But then we don't want to fall over random missing .sty files or
>> fonts
>> (macOS machines have been less forgiving than others), not to mention
>> compile
>> time.
>>
>> So for simplicity I often pre-make pdf vignettes that get included in other
>> latex code as source. Works great, never fails, CRAN never complained --
>> which is somewhat contrary to your statement.
>>
>> It is effectively the same with tests. We all want maximum test surfaces.
>> But
>> when tests fail, or when they run too long, or [insert many other reasons
>> here] so many packages run tests conditionally.  Such is life.
>>
>> Dirk
>>
>>
>> | However, this sounds like a purely hypothetical question - CRAN policies
>> allow long-running vignettes if they declared.
>> |
>> | Cheers,
>> | Simon
>> |
>> |
>> | > On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
>> | >
>> | > Hello Dirk,
>> | >
>> | > Thank you (and Kevin and John) for addressing my questions.
>> | >
>> | > No one directly answered my first question, however, which was whether
>> the approach that I suggested would work. I guess that the implication is
>> that it won't, but it would be nice to confirm that before I try something
>> else, specifically using R.rsp.
>> | >
>> | > Best,
>> | > John
>> | >
>> | > On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>> | >> Caution: External email.
>> | >> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>> | >> | Produce a PDF file yourself, then use the "as.is" feature of the
>> R.rsp
>> | >> | package.
>> | >> For completeness, that approach also works directly with Sweave.
>> Described in
>> | >> a blog post by Mark van der Loo in 2019, and used in a number of
>> packages
>> | >> including a few of mine.
>> | >> That said, I also used the approach described by John Harrold and
>> cached
>> | >> results myself.
>> | >> Dirk
>> | >> --
>> | >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> | >> ______________________________________________
>> | >> R-package-devel at r-project.org mailing list
>> | >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> | >
>> | > ______________________________________________
>> | > R-package-devel at r-project.org mailing list
>> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> | >
>> |
>> | ______________________________________________
>> | R-package-devel at r-project.org mailing list
>> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> --
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
>          [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Oct 18 00:54:30 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 18 Oct 2023 00:54:30 +0200
Subject: [R-pkg-devel] CMD check: Examples vs DEPENDS pkg
In-Reply-To: <7ea981c3-faec-490f-841d-4ce8fce8e5cb@syonic.eu>
References: <7ea981c3-faec-490f-841d-4ce8fce8e5cb@syonic.eu>
Message-ID: <fb999bf6-dabf-345b-878e-7f918531357b@statistik.tu-dortmund.de>



On 17.10.2023 21:34, Leonard Mada via R-package-devel wrote:
> Dear List members,
> 
> Package Rpdf depends on package rgl. Multiple examples will call 
> internally the rgl package to visualize the pdb molecule.
> 
> When performing the CMD check:
> 1) Is the rgl package loaded each time anew for any of those examples?
> 
> 2) If this is the case:
> Is it possible to load it only once per CMD check?


Typically it is loaded once for the examples, once for each test file 
and once for each vignette that uses it.

Best,
Uwe Ligges

> 
> Sincerely,
> 
> Leonard
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Oct 18 01:26:07 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 18 Oct 2023 01:26:07 +0200
Subject: [R-pkg-devel] Problem with "additional repository".
In-Reply-To: <20231017214519.572762e3@Tarkus>
References: <20231016143457.4e9abf93@rolf-Latitude-E7470>
 <96cc9a80-bf41-4383-ba5e-cefb8fa4ecaf@gmail.com>
 <a7971df4-03d1-3217-c3c5-0f9e8907b7b0@statistik.tu-dortmund.de>
 <20231017214519.572762e3@Tarkus>
Message-ID: <ba1539df-364d-dd57-a8b2-ecd0d0e41eb2@statistik.tu-dortmund.de>

It was 0.0-20 that had another issue now explained privately. 0.0-21 
passes cleanly.

Best,
Uwe

On 17.10.2023 20:45, Ivan Krylov wrote:
> On Mon, 16 Oct 2023 17:08:28 +0200
> Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
> 
>> I do not know which package this refers to, so cannot easily look.
> 
> This seems to be about the eglhmm package. It seems to pass --as-cran
> checks on my machine, but I know it's not the full set of checks
> performed for new packages.
>



From @hu|@|@cheung @end|ng |rom gm@||@com  Wed Oct 18 03:25:51 2023
From: @hu|@|@cheung @end|ng |rom gm@||@com (Shu Fai Cheung)
Date: Wed, 18 Oct 2023 09:25:51 +0800
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <1ca51da7-6243-45d6-b3cd-811130b52ec2@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <25903.1227.152942.179691@rob.eddelbuettel.com>
 <CANAiAiXk7TeX9ndA+Q+kLtWd7dbdJh-LQqU+MpgusWX_efO46Q@mail.gmail.com>
 <1ca51da7-6243-45d6-b3cd-811130b52ec2@mcmaster.ca>
Message-ID: <CAPVJd2Xt=RoyL=iUO05cVGY-66pjKwOHt6dOjKvVpfCB4b83KA@mail.gmail.com>

Please pardon me if I suggest something unrelated below. Many experts
have made suggestions that I would also like to consider because I
also have a similar issue with some packages.

This is an approach I found, for Rmarkdown vignettes:

https://www.kloppenborg.ca/2021/06/long-running-vignettes/

This is similar to some of the suggestions. The vignette is rendered
locally. It uses the trick that, If we render the vignette by calling
knitr::knit() directly, the extension of the source file does not
matter. The output, although with the extension ".Rmd", actually
contains the results of the code, in chunks starting with "```r", not
"```{r}".

When this pre-buiult .Rmd file is built again, it will just convert
the file to an HTML file, with no need to rerun the code.

The method uses an extension for the source Rmd file (".orig" in the
post) to make sure the "real" source files are ignored when building
the vignettes.

Perhaps this is also a feasible solution for long running vignettes?

Regards,
Shu Fai

On Wed, Oct 18, 2023 at 6:51?AM John Fox <jfox at mcmaster.ca> wrote:
>
> Dear John,
>
> Unless I'm mistaken, the *installation* time of the package isn't really
> at issue. If a user installs a package from a tarball provided by CRAN,
> the vignettes aren't normally rebuilt.
>
> Best,
>   John
>
> On 2023-10-17 6:30 p.m., John Harrold wrote:
> > Caution: External email.
> >
> >
> > I ask myself the question: Who is the vignette for?  It does server two
> > purposes. One is testing but primarily it's for the users to learn how to
> > use a package. I think the testing is secondary, and if it slows down
> > installation or general usability I'd sacrifice the testing. If it's that
> > important, then the tests can be added explicitly in tests/.
> >
> > On Tue, Oct 17, 2023 at 3:04?PM Dirk Eddelbuettel <edd at debian.org> wrote:
> >
> >>
> >> On 18 October 2023 at 08:51, Simon Urbanek wrote:
> >> | John,
> >> |
> >> | the short answer is it won't work (it defeats the purpose of vignettes).
> >>
> >> Not exactly. Everything is under our (i.e. package author) control, and
> >> when
> >> we want to replace 'computed' values with cached values we can.
> >>
> >> All this is somewhat of a charade. "Of course" we want vignettes to run
> >> tests. But then we don't want to fall over random missing .sty files or
> >> fonts
> >> (macOS machines have been less forgiving than others), not to mention
> >> compile
> >> time.
> >>
> >> So for simplicity I often pre-make pdf vignettes that get included in other
> >> latex code as source. Works great, never fails, CRAN never complained --
> >> which is somewhat contrary to your statement.
> >>
> >> It is effectively the same with tests. We all want maximum test surfaces.
> >> But
> >> when tests fail, or when they run too long, or [insert many other reasons
> >> here] so many packages run tests conditionally.  Such is life.
> >>
> >> Dirk
> >>
> >>
> >> | However, this sounds like a purely hypothetical question - CRAN policies
> >> allow long-running vignettes if they declared.
> >> |
> >> | Cheers,
> >> | Simon
> >> |
> >> |
> >> | > On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
> >> | >
> >> | > Hello Dirk,
> >> | >
> >> | > Thank you (and Kevin and John) for addressing my questions.
> >> | >
> >> | > No one directly answered my first question, however, which was whether
> >> the approach that I suggested would work. I guess that the implication is
> >> that it won't, but it would be nice to confirm that before I try something
> >> else, specifically using R.rsp.
> >> | >
> >> | > Best,
> >> | > John
> >> | >
> >> | > On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
> >> | >> Caution: External email.
> >> | >> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
> >> | >> | Produce a PDF file yourself, then use the "as.is" feature of the
> >> R.rsp
> >> | >> | package.
> >> | >> For completeness, that approach also works directly with Sweave.
> >> Described in
> >> | >> a blog post by Mark van der Loo in 2019, and used in a number of
> >> packages
> >> | >> including a few of mine.
> >> | >> That said, I also used the approach described by John Harrold and
> >> cached
> >> | >> results myself.
> >> | >> Dirk
> >> | >> --
> >> | >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >> | >> ______________________________________________
> >> | >> R-package-devel at r-project.org mailing list
> >> | >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >> | >
> >> | > ______________________________________________
> >> | > R-package-devel at r-project.org mailing list
> >> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >> | >
> >> |
> >> | ______________________________________________
> >> | R-package-devel at r-project.org mailing list
> >> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>
> >> --
> >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>
> >
> >          [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From j|ox @end|ng |rom mcm@@ter@c@  Wed Oct 18 16:13:01 2023
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Wed, 18 Oct 2023 10:13:01 -0400
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <CAPVJd2Xt=RoyL=iUO05cVGY-66pjKwOHt6dOjKvVpfCB4b83KA@mail.gmail.com>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
 <ddc26b1a-94b0-4de5-9cb8-14a991dcf842@gmail.com>
 <25902.16306.681621.578024@rob.eddelbuettel.com>
 <c6c4842c-679e-457c-8081-bf96f69a0f74@mcmaster.ca>
 <4D65DAA7-BF42-4DBF-80DC-F6B7D09751F3@R-project.org>
 <25903.1227.152942.179691@rob.eddelbuettel.com>
 <CANAiAiXk7TeX9ndA+Q+kLtWd7dbdJh-LQqU+MpgusWX_efO46Q@mail.gmail.com>
 <1ca51da7-6243-45d6-b3cd-811130b52ec2@mcmaster.ca>
 <CAPVJd2Xt=RoyL=iUO05cVGY-66pjKwOHt6dOjKvVpfCB4b83KA@mail.gmail.com>
Message-ID: <3b86619b-88a2-4fe9-9b67-208e5772fb3f@mcmaster.ca>

Dear Shu Fai,

This approach is certainly relevant, and I think it is slightly better 
than using R.rsp. My preference is still to include the original .Rmd 
file along with a note to CRAN about the long-running vignette.

Thank you,
  John


On 2023-10-17 9:25 p.m., Shu Fai Cheung wrote:
> Caution: External email.
> 
> 
> Please pardon me if I suggest something unrelated below. Many experts
> have made suggestions that I would also like to consider because I
> also have a similar issue with some packages.
> 
> This is an approach I found, for Rmarkdown vignettes:
> 
> https://www.kloppenborg.ca/2021/06/long-running-vignettes/
> 
> This is similar to some of the suggestions. The vignette is rendered
> locally. It uses the trick that, If we render the vignette by calling
> knitr::knit() directly, the extension of the source file does not
> matter. The output, although with the extension ".Rmd", actually
> contains the results of the code, in chunks starting with "```r", not
> "```{r}".
> 
> When this pre-buiult .Rmd file is built again, it will just convert
> the file to an HTML file, with no need to rerun the code.
> 
> The method uses an extension for the source Rmd file (".orig" in the
> post) to make sure the "real" source files are ignored when building
> the vignettes.
> 
> Perhaps this is also a feasible solution for long running vignettes?
> 
> Regards,
> Shu Fai
> 
> On Wed, Oct 18, 2023 at 6:51?AM John Fox <jfox at mcmaster.ca> wrote:
>>
>> Dear John,
>>
>> Unless I'm mistaken, the *installation* time of the package isn't really
>> at issue. If a user installs a package from a tarball provided by CRAN,
>> the vignettes aren't normally rebuilt.
>>
>> Best,
>>    John
>>
>> On 2023-10-17 6:30 p.m., John Harrold wrote:
>>> Caution: External email.
>>>
>>>
>>> I ask myself the question: Who is the vignette for?  It does server two
>>> purposes. One is testing but primarily it's for the users to learn how to
>>> use a package. I think the testing is secondary, and if it slows down
>>> installation or general usability I'd sacrifice the testing. If it's that
>>> important, then the tests can be added explicitly in tests/.
>>>
>>> On Tue, Oct 17, 2023 at 3:04?PM Dirk Eddelbuettel <edd at debian.org> wrote:
>>>
>>>>
>>>> On 18 October 2023 at 08:51, Simon Urbanek wrote:
>>>> | John,
>>>> |
>>>> | the short answer is it won't work (it defeats the purpose of vignettes).
>>>>
>>>> Not exactly. Everything is under our (i.e. package author) control, and
>>>> when
>>>> we want to replace 'computed' values with cached values we can.
>>>>
>>>> All this is somewhat of a charade. "Of course" we want vignettes to run
>>>> tests. But then we don't want to fall over random missing .sty files or
>>>> fonts
>>>> (macOS machines have been less forgiving than others), not to mention
>>>> compile
>>>> time.
>>>>
>>>> So for simplicity I often pre-make pdf vignettes that get included in other
>>>> latex code as source. Works great, never fails, CRAN never complained --
>>>> which is somewhat contrary to your statement.
>>>>
>>>> It is effectively the same with tests. We all want maximum test surfaces.
>>>> But
>>>> when tests fail, or when they run too long, or [insert many other reasons
>>>> here] so many packages run tests conditionally.  Such is life.
>>>>
>>>> Dirk
>>>>
>>>>
>>>> | However, this sounds like a purely hypothetical question - CRAN policies
>>>> allow long-running vignettes if they declared.
>>>> |
>>>> | Cheers,
>>>> | Simon
>>>> |
>>>> |
>>>> | > On 18/10/2023, at 3:02 AM, John Fox <jfox at mcmaster.ca> wrote:
>>>> | >
>>>> | > Hello Dirk,
>>>> | >
>>>> | > Thank you (and Kevin and John) for addressing my questions.
>>>> | >
>>>> | > No one directly answered my first question, however, which was whether
>>>> the approach that I suggested would work. I guess that the implication is
>>>> that it won't, but it would be nice to confirm that before I try something
>>>> else, specifically using R.rsp.
>>>> | >
>>>> | > Best,
>>>> | > John
>>>> | >
>>>> | > On 2023-10-17 4:02 a.m., Dirk Eddelbuettel wrote:
>>>> | >> Caution: External email.
>>>> | >> On 16 October 2023 at 10:42, Kevin R Coombes wrote:
>>>> | >> | Produce a PDF file yourself, then use the "as.is" feature of the
>>>> R.rsp
>>>> | >> | package.
>>>> | >> For completeness, that approach also works directly with Sweave.
>>>> Described in
>>>> | >> a blog post by Mark van der Loo in 2019, and used in a number of
>>>> packages
>>>> | >> including a few of mine.
>>>> | >> That said, I also used the approach described by John Harrold and
>>>> cached
>>>> | >> results myself.
>>>> | >> Dirk
>>>> | >> --
>>>> | >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>> | >> ______________________________________________
>>>> | >> R-package-devel at r-project.org mailing list
>>>> | >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>> | >
>>>> | > ______________________________________________
>>>> | > R-package-devel at r-project.org mailing list
>>>> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>> | >
>>>> |
>>>> | ______________________________________________
>>>> | R-package-devel at r-project.org mailing list
>>>> | https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> --
>>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>>>           [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From roy@mende|@@ohn @end|ng |rom no@@@gov  Wed Oct 18 17:16:39 2023
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Wed, 18 Oct 2023 08:16:39 -0700
Subject: [R-pkg-devel] winbuilder
Message-ID: <0BFBC22B-ED80-4957-B7DE-8A2F5AC9D724@noaa.gov>

I am not sure who is the appropriate person to contact,  but thought I would try here since WInbuilder is a big help in package testing.  Winbuilder appears to be down at the moment.

Thanks,

-Roy

**********************
"The contents of this message do not reflect any position of the U.S. Government or NOAA."
**********************
Roy Mendelssohn
Supervisory Operations Research Analyst
NOAA/NMFS
Environmental Research Division
Southwest Fisheries Science Center
***Note new street address***
110 McAllister Way
Santa Cruz, CA 95060
Phone: (831)-420-3666
Fax: (831) 420-3980
e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/

"Old age and treachery will overcome youth and skill."
"From those who have been given much, much will be expected" 
"the arc of the moral universe is long, but it bends toward justice" -MLK Jr.



From ||@t@ @end|ng |rom dewey@myzen@co@uk  Wed Oct 18 17:39:30 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Wed, 18 Oct 2023 16:39:30 +0100
Subject: [R-pkg-devel] winbuilder
In-Reply-To: <0BFBC22B-ED80-4957-B7DE-8A2F5AC9D724@noaa.gov>
References: <0BFBC22B-ED80-4957-B7DE-8A2F5AC9D724@noaa.gov>
Message-ID: <2068ab07-695c-aa4c-ab17-9d3b2c09f9bf@dewey.myzen.co.uk>

Dear Roy

When I just checked using the winbuilder_queue function from the foghorn 
package it seemed to respond and had one package in the queue. Not sure 
that is definitive evicence.

Michael

On 18/10/2023 16:16, Roy Mendelssohn - NOAA Federal via R-package-devel 
wrote:
> I am not sure who is the appropriate person to contact,  but thought I would try here since WInbuilder is a big help in package testing.  Winbuilder appears to be down at the moment.
> 
> Thanks,
> 
> -Roy
> 
> **********************
> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
> 
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected"
> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 

-- 
Michael



From roy@mende|@@ohn @end|ng |rom no@@@gov  Wed Oct 18 20:32:45 2023
From: roy@mende|@@ohn @end|ng |rom no@@@gov (Roy Mendelssohn - NOAA Federal)
Date: Wed, 18 Oct 2023 11:32:45 -0700
Subject: [R-pkg-devel] winbuilder
In-Reply-To: <2068ab07-695c-aa4c-ab17-9d3b2c09f9bf@dewey.myzen.co.uk>
References: <0BFBC22B-ED80-4957-B7DE-8A2F5AC9D724@noaa.gov>
 <2068ab07-695c-aa4c-ab17-9d3b2c09f9bf@dewey.myzen.co.uk>
Message-ID: <05CAB6F4-B01C-47F5-A2D2-7F111D0722AE@noaa.gov>

Not too long after I sent the message it came back up. 

Thanks!  

-Roy

> On Oct 18, 2023, at 8:39 AM, Michael Dewey <lists at dewey.myzen.co.uk> wrote:
> 
> Dear Roy
> 
> When I just checked using the winbuilder_queue function from the foghorn package it seemed to respond and had one package in the queue. Not sure that is definitive evicence.
> 
> Michael
> 
> On 18/10/2023 16:16, Roy Mendelssohn - NOAA Federal via R-package-devel wrote:
>> I am not sure who is the appropriate person to contact,  but thought I would try here since WInbuilder is a big help in package testing.  Winbuilder appears to be down at the moment.
>> Thanks,
>> -Roy
>> **********************
>> "The contents of this message do not reflect any position of the U.S. Government or NOAA."
>> **********************
>> Roy Mendelssohn
>> Supervisory Operations Research Analyst
>> NOAA/NMFS
>> Environmental Research Division
>> Southwest Fisheries Science Center
>> ***Note new street address***
>> 110 McAllister Way
>> Santa Cruz, CA 95060
>> Phone: (831)-420-3666
>> Fax: (831) 420-3980
>> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>> "Old age and treachery will overcome youth and skill."
>> "From those who have been given much, much will be expected"
>> "the arc of the moral universe is long, but it bends toward justice" -MLK Jr.
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> -- 
> Michael



From drj|m|emon @end|ng |rom gm@||@com  Thu Oct 19 01:43:23 2023
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Thu, 19 Oct 2023 10:43:23 +1100
Subject: [R-pkg-devel] winbuilder
In-Reply-To: <0BFBC22B-ED80-4957-B7DE-8A2F5AC9D724@noaa.gov>
References: <0BFBC22B-ED80-4957-B7DE-8A2F5AC9D724@noaa.gov>
Message-ID: <CA+8X3fUeJoBWz87egayW0yyWGs2W+y6CVYzkrdqRSSagpwVSJg@mail.gmail.com>

Please delete drjimlemon at gmail.com from your mailing list. He passed away a
month ago.
Regards,
Juel
Wife

On Thu, 19 Oct 2023, 02:17 Roy Mendelssohn - NOAA Federal via
R-package-devel <r-package-devel at r-project.org wrote:

> I am not sure who is the appropriate person to contact,  but thought I
> would try here since WInbuilder is a big help in package testing.
> Winbuilder appears to be down at the moment.
>
> Thanks,
>
> -Roy
>
> **********************
> "The contents of this message do not reflect any position of the U.S.
> Government or NOAA."
> **********************
> Roy Mendelssohn
> Supervisory Operations Research Analyst
> NOAA/NMFS
> Environmental Research Division
> Southwest Fisheries Science Center
> ***Note new street address***
> 110 McAllister Way
> Santa Cruz, CA 95060
> Phone: (831)-420-3666
> Fax: (831) 420-3980
> e-mail: Roy.Mendelssohn at noaa.gov www: https://www.pfeg.noaa.gov/
>
> "Old age and treachery will overcome youth and skill."
> "From those who have been given much, much will be expected"
> "the arc of the moral universe is long, but it bends toward justice" -MLK
> Jr.
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From drj|m|emon @end|ng |rom gm@||@com  Thu Oct 19 01:45:10 2023
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Thu, 19 Oct 2023 10:45:10 +1100
Subject: [R-pkg-devel] Suppressing long-running vignette code in CRAN
 submission
In-Reply-To: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
References: <55cac1c9-9f59-4ada-bdc5-273e12f83430@mcmaster.ca>
Message-ID: <CA+8X3fWEMTu3cGQrJOu0Q9x_EtTg48mbdq=C9bWNj4Zd7oeL5Q@mail.gmail.com>

Please delete drjimlemon at gmail.com from your mailing list. He passed away a
month ago.
Regards,
Juel
Wife

On Tue, 17 Oct 2023, 01:15 John Fox <jfox at mcmaster.ca wrote:

> Dear list members,
>
> I believe that this issue has been discussed previously, but I'm not
> sure that I have the solution right.
>
> Georges Monette and I have developed a package that we intend to submit
> soon to CRAN which has a vignette including code that takes a long time
> to run. The sources for the package are available at
> <https://github.com/gmonette/cv>.
>
> We figure that we have to suppress running the code the vignette when
> CRAN checks the package or the check time will be excessive.
>
> The vignette is written as a .Rmd file to be compiled by knitr,
> producing an HTML vignette. The top of the .Rmd file looks like this:
>
> ------- snip -------
>
> ---
> title: "Cross-validation of regression models"
> author: "John Fox and Georges Monette"
> date: "`r Sys.Date()`"
> package: cv
> output:
>    rmarkdown::html_vignette:
>    fig_caption: yes
> bibliography: ["cv.bib"]
> csl: apa.csl
> vignette: >
>    %\VignetteIndexEntry{Cross-validation of regression models}
>    %\VignetteEngine{knitr::rmarkdown}
>    %\VignetteEncoding{UTF-8}
> ---
>
> ```{r setup, include = FALSE}
> knitr::opts_chunk$set(
>    collapse = TRUE,
>    message = TRUE,
>    warning = TRUE,
>    fig.align = "center",
>    fig.height = 6,
>    fig.width = 7,
>    fig.path = "fig/",
>    dev = "png",
>    comment = "#>",
>    eval = nzchar(Sys.getenv("REBUILD_CV_VIGNETTES"))
> )
>
> ### other irrelevant setup code not shown ###
>
> ```
>
> ------- snip -------
>
> So (near the bottom), if the environment variable REBUILD_CV_VIGNETTES
> isn't empty, the code blocks in the vignette are evaluated, otherwise
> not. To build the tarball for the package to be submitted to CRAN, we
> will set REBUILD_CV_VIGNETTES to "true". That works as intended.
>
> If we submit the tarball to CRAN, I believe that the package as
> distributed by CRAN will include the HTML vignette from our tarball,
> showing the evaluated code blocks, but when CRAN checks the package,
> these long-running code blocks will not be executed (because
> REBUILD_CV_VIGNETTES will not exist on the CRAN check machines).
>
> My questions:
>
> Is that correct?
>
> If not, how can we ensure that the complete vignette is distributed by
> CRAN without causing an overly long CRAN check time?
>
> In particular, we don't want CRAN to rebuild and distribute the
> vignette, because the resulting HTML file won't show the evaluated code.
>
> Any assistance would be appreciated.
>
> Thank you,
>   John
> --
> John Fox, Professor Emeritus
> McMaster University
> Hamilton, Ontario, Canada
> web: https://www.john-fox.ca/
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From drj|m|emon @end|ng |rom gm@||@com  Thu Oct 19 01:46:41 2023
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Thu, 19 Oct 2023 10:46:41 +1100
Subject: [R-pkg-devel] CMD check: Examples vs DEPENDS pkg
In-Reply-To: <7ea981c3-faec-490f-841d-4ce8fce8e5cb@syonic.eu>
References: <7ea981c3-faec-490f-841d-4ce8fce8e5cb@syonic.eu>
Message-ID: <CA+8X3fX9nxyyTc9g_AAqvDvPG=D_PPuX28PvCC2Ngk2ZzWLOMg@mail.gmail.com>

Please delete drjimlemon at gmail.com from your mailing list. He passed away a
month ago.
Regards,
Juel
Wife

On Wed, 18 Oct 2023, 06:35 Leonard Mada via R-package-devel <
r-package-devel at r-project.org wrote:

> Dear List members,
>
> Package Rpdf depends on package rgl. Multiple examples will call
> internally the rgl package to visualize the pdb molecule.
>
> When performing the CMD check:
> 1) Is the rgl package loaded each time anew for any of those examples?
>
> 2) If this is the case:
> Is it possible to load it only once per CMD check?
>
> Sincerely,
>
> Leonard
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From drj|m|emon @end|ng |rom gm@||@com  Thu Oct 19 01:50:45 2023
From: drj|m|emon @end|ng |rom gm@||@com (Jim Lemon)
Date: Thu, 19 Oct 2023 10:50:45 +1100
Subject: [R-pkg-devel] CartogRaflow submission
In-Reply-To: <1550121052.16258628.1697492339014@mail.yahoo.com>
References: <1550121052.16258628.1697492339014.ref@mail.yahoo.com>
 <1550121052.16258628.1697492339014@mail.yahoo.com>
Message-ID: <CA+8X3fXQ9033rVPWrmGDEkD9UwqW-zqh32mGS+5JfA91cBT91A@mail.gmail.com>

Please delete drjimlemon at gmail.com from your mailing list. He passed away a
month ago.
Regards,
Juel
Wife

On Tue, 17 Oct 2023, 18:13 cartograflow at gmail.com <cartograflow at gmail.com
wrote:

> Hi, I've put an update version of the package cartogRaflow 1.0.4 in CRAN
> today.
> There are 2 errors
> Last released version's CRAN status: OK: 11, ERROR: 2
> See: <
> https://cran-archive.r-project.org/web/checks/2023/2023-10-16_check_results_cartograflow.html
> >
>
> The version 1.0.3 was archived today.
> I would like to know if these errors are due to the version 1.0.3 was
> archived. If yes, is it possible to fix these errors? Thanks in
> advance Sylvain
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From ro||turner @end|ng |rom po@teo@net  Fri Oct 20 02:17:01 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Fri, 20 Oct 2023 00:17:01 +0000
Subject: [R-pkg-devel] Switch between \dontrun{  } and \donttest{  }.
Message-ID: <20231020131701.7f354741@rolf-Latitude-E7470>


In a package that I maintain, there are examples, in the *.Rd files,
that take an excruciatingly long time to run.  This makes package
checking extremely tedious.  There is no question of errors being
thrown from these examples, they are simply time consuming.  (The check
is being run to look for possible errors elsewhere.)

I therefore would like to wrap these examples in \dontrun{ }.

However when the package is submitted to CRAN, it is expedient to wrap
the examples in \donttest{ } rather than \dontrun{ }.

I would therefore like to find a means of effecting the following
logical structure:

    if(package is being checked by CRAN) {
        Use \donttest{ }
    } else {
        Use \dontrun{ }
    }

Is there a reasonably straightforward means of detecting whether
the package is being checked by CRAN, and thereby setting up such a
logical structure? Perhaps based on environment variables?

Can anyone give me any guidance?  Thanks.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619



From joun|@he|@ke @end|ng |rom jyu@||  Thu Oct 19 07:57:54 2023
From: joun|@he|@ke @end|ng |rom jyu@|| (Helske, Jouni)
Date: Thu, 19 Oct 2023 05:57:54 +0000
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
Message-ID: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>

Hi,

I am having difficulties in getting the latest version of the bssm (https://github.com/helske/bssm) package to CRAN, as the pretest issues a NOTE that the package uses too many cores in some of the examples ("Examples with CPU time > 2.5 times elapsed time"). I've seen plenty of discussion about this issue in relation to the data.table package, but bssm does not use it. Also, while bssm uses OpenMP in some functions, these are not called in the example in question (?exchange), and by default the number of threads in the parallelisable functions is set to 1.

But I just realised that bssm uses Armadillo via RcppArmadillo, which uses OpenMP by default for some elementwise operations. So, I wonder if that could be the culprit? However, I would think that in such case there would be many other packages with RcppArmadillo encountering the same CRAN issues. Has anyone experienced this with their packages which use RcppArmadillo but not data.table, or can say whether my guess is correct? I haven't been able to reproduce the issue myself on r-hub or my own linux, so I can't really test whether setting #define ARMA_DONT_USE_OPENMP helps.

Best,
Jouni

	[[alternative HTML version deleted]]



From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Oct 20 11:34:26 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 20 Oct 2023 05:34:26 -0400
Subject: [R-pkg-devel] Switch between \dontrun{ } and \donttest{ }.
In-Reply-To: <20231020131701.7f354741@rolf-Latitude-E7470>
References: <20231020131701.7f354741@rolf-Latitude-E7470>
Message-ID: <571b3880-c950-4433-a17a-37295c0031e5@gmail.com>

On 19/10/2023 8:17 p.m., Rolf Turner wrote:
> 
> In a package that I maintain, there are examples, in the *.Rd files,
> that take an excruciatingly long time to run.  This makes package
> checking extremely tedious.  There is no question of errors being
> thrown from these examples, they are simply time consuming.  (The check
> is being run to look for possible errors elsewhere.)
> 
> I therefore would like to wrap these examples in \dontrun{ }.
> 
> However when the package is submitted to CRAN, it is expedient to wrap
> the examples in \donttest{ } rather than \dontrun{ }.
> 
> I would therefore like to find a means of effecting the following
> logical structure:
> 
>      if(package is being checked by CRAN) {
>          Use \donttest{ }
>      } else {
>          Use \dontrun{ }
>      }
> 
> Is there a reasonably straightforward means of detecting whether
> the package is being checked by CRAN, and thereby setting up such a
> logical structure? Perhaps based on environment variables?
> 
> Can anyone give me any guidance?  Thanks.

I think the method used by the testthat package is best:  assume it is 
being run by CRAN, unless an environment variable named NOT_CRAN is set 
to "true" (or some string like that).  Then set the environment variable 
at home, where you know you are not on CRAN.

Duncan



From edd @end|ng |rom deb|@n@org  Fri Oct 20 12:41:20 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 20 Oct 2023 05:41:20 -0500
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
Message-ID: <25906.22864.328940.547868@rob.eddelbuettel.com>


On 19 October 2023 at 05:57, Helske, Jouni wrote:
| I am having difficulties in getting the latest version of the bssm (https://github.com/helske/bssm) package to CRAN, as the pretest issues a NOTE that the package uses too many cores in some of the examples ("Examples with CPU time > 2.5 times elapsed time"). I've seen plenty of discussion about this issue in relation to the data.table package, but bssm does not use it. Also, while bssm uses OpenMP in some functions, these are not called in the example in question (?exchange), and by default the number of threads in the parallelisable functions is set to 1.
| 
| But I just realised that bssm uses Armadillo via RcppArmadillo, which uses OpenMP by default for some elementwise operations. So, I wonder if that could be the culprit? However, I would think that in such case there would be many other packages with RcppArmadillo encountering the same CRAN issues. Has anyone experienced this with their packages which use RcppArmadillo but not data.table, or can say whether my guess is correct? I haven't been able to reproduce the issue myself on r-hub or my own linux, so I can't really test whether setting #define ARMA_DONT_USE_OPENMP helps.

You have some options to control OpenMP.

There is an environment variable (OMP_THREAD_LIMIT), and there is an CRAN
add-on package (RhpcBLASctl) which, if memory serves, also sets this. Looking
at the Armadillo documentation we see another variable (ARMA_OPENMP_THREADS).

I really think CRAN made a mistake here pushing this down on all package
maintainers.  It is too much work, some will get frustrated, some will get it
wrong and I fear in aggregate we end up with less performant software (as
some will 'cave in' and hard-wire single threaded computes). 

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From kry|ov@r00t @end|ng |rom gm@||@com  Fri Oct 20 15:54:37 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 20 Oct 2023 16:54:37 +0300
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
Message-ID: <20231020165437.31a89982@arachnoid>

? Thu, 19 Oct 2023 05:57:54 +0000
"Helske, Jouni" <jouni.helske at jyu.fi> ?????:

> But I just realised that bssm uses Armadillo via RcppArmadillo, which
> uses OpenMP by default for some elementwise operations. So, I wonder
> if that could be the culprit?

I wasn't able to reproduce the NOTE either, despite manually setting
the environment variable
_R_CHECK_EXAMPLE_TIMING_CPU_TO_ELAPSED_THRESHOLD=2 before running R CMD
check, but I think I can see the code using OpenMP. Here's what I did:

0. Temporarily lower the system protections against capturing
performance traces of potentially sensitive parts:

echo -1 | sudo tee /proc/sys/kernel/perf_event_paranoid

(Set it back to 3 after you're done.)

1. Run the following command with the development version of the
package installed:

env OPENBLAS_NUM_THREADS=1 \
 perf record --call-graph drawf,4096 \
 R -e 'library(bssm); system.time(replicate(100, example(exchange)))'

OPENBLAS_NUM_THREADS=1 will prevent OpenBLAS from spawning worker
threads if you have it installed. (A different BLAS may need different
environment variables.)

2. Run `perf report` and browse collected call stack information.

The call stacks are hard to navigate, but I think they are not pointing
towards Armadillo. At least, setting ARMA_OPENMP_THREADS=1 doesn't
help, but setting OMP_THREAD_LIMIT=1 does.

-- 
Best regards,
Ivan



From ro||turner @end|ng |rom po@teo@net  Sat Oct 21 00:43:39 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Fri, 20 Oct 2023 22:43:39 +0000
Subject: [R-pkg-devel] Switch between \dontrun{ } and \donttest{ }.
In-Reply-To: <571b3880-c950-4433-a17a-37295c0031e5@gmail.com>
References: <20231020131701.7f354741@rolf-Latitude-E7470>
 <571b3880-c950-4433-a17a-37295c0031e5@gmail.com>
Message-ID: <20231021114339.13f87329@rolf-Latitude-E7470>


On Fri, 20 Oct 2023 05:34:26 -0400
Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> On 19/10/2023 8:17 p.m., Rolf Turner wrote:
> > 
> > In a package that I maintain, there are examples, in the *.Rd files,
> > that take an excruciatingly long time to run.  This makes package
> > checking extremely tedious.  There is no question of errors being
> > thrown from these examples, they are simply time consuming.  (The
> > check is being run to look for possible errors elsewhere.)
> > 
> > I therefore would like to wrap these examples in \dontrun{ }.
> > 
> > However when the package is submitted to CRAN, it is expedient to
> > wrap the examples in \donttest{ } rather than \dontrun{ }.
> > 
> > I would therefore like to find a means of effecting the following
> > logical structure:
> > 
> >      if(package is being checked by CRAN) {
> >          Use \donttest{ }
> >      } else {
> >          Use \dontrun{ }
> >      }
> > 
> > Is there a reasonably straightforward means of detecting whether
> > the package is being checked by CRAN, and thereby setting up such a
> > logical structure? Perhaps based on environment variables?
> > 
> > Can anyone give me any guidance?  Thanks.
> 
> I think the method used by the testthat package is best:  assume it
> is being run by CRAN, unless an environment variable named NOT_CRAN
> is set to "true" (or some string like that).  Then set the
> environment variable at home, where you know you are not on CRAN.
> 
> Duncan
> 

Ah-ha!  Good thinking!  Thanks, Duncan.

cheers,

Rolf


-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619



From pro|jcn@@h @end|ng |rom gm@||@com  Sun Oct 22 16:43:08 2023
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sun, 22 Oct 2023 10:43:08 -0400
Subject: [R-pkg-devel] Issue of itemize in man file
Message-ID: <5be6435c-56ab-4742-a31c-e7a86ae23aed@gmail.com>

I'm doing a major update of the optimx package and things were going relatively
smoothly until this weekend when files that have passed win-builder gave NOTEs
on r-devel for several manual (.Rd) files.
The NOTE is of the form

> * checking Rd files ... NOTE
> checkRd: (-1) fnchk.Rd:40-41: Lost braces in \itemize; \value handles \item{}{} directly
> checkRd: (-1) fnchk.Rd:43: Lost braces in \itemize; \value handles \item{}{} directly
> checkRd: (-1) fnchk.Rd:45: Lost braces in \itemize; \value handles \item{}{} directly


The source of this looks like

   \item{msg}{A text string giving information about the result of the function check: Messages and
     the corresponding values of \code{excode} are:
       \itemize{
         \item{fnchk OK;}{ \code{excode} = 0;
                        \code{infeasible} = FALSE}
         \item{Function returns INADMISSIBLE;}
                     { \code{excode} = -1; \code{infeasible} = TRUE}
      ...
     }

I've not seen this before, nor does a search give any hits.

Does anyone have any ideas? Or is this a glitch in r-devel as things are tried out.?

I don't get the NOTE on win-builder R-release nor on local R CMD check. Note that the
\itemize is to give a second-level list i.e., for expanding output of one of the
\value objects returned, namely the return codes.

Best,

John Nash



From kry|ov@r00t @end|ng |rom gm@||@com  Sun Oct 22 16:52:58 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 22 Oct 2023 17:52:58 +0300
Subject: [R-pkg-devel] Issue of itemize in man file
In-Reply-To: <5be6435c-56ab-4742-a31c-e7a86ae23aed@gmail.com>
References: <5be6435c-56ab-4742-a31c-e7a86ae23aed@gmail.com>
Message-ID: <20231022175258.6bebcaff@Tarkus>

On Sun, 22 Oct 2023 10:43:08 -0400
J C Nash <profjcnash at gmail.com> wrote:

>        \itemize{
>          \item{fnchk OK;}{ \code{excode} = 0;
>                         \code{infeasible} = FALSE}

The \item command inside \itemize{} lists doesn't take arguments.
Did you mean \describe{} instead of \itemize{}?

-- 
Best regards,
Ivan



From v|ncentv@nhee@ @end|ng |rom gm@||@com  Sun Oct 22 17:18:05 2023
From: v|ncentv@nhee@ @end|ng |rom gm@||@com (Vincent van Hees)
Date: Sun, 22 Oct 2023 17:18:05 +0200
Subject: [R-pkg-devel] Issue of itemize in man file
In-Reply-To: <20231022175258.6bebcaff@Tarkus>
References: <5be6435c-56ab-4742-a31c-e7a86ae23aed@gmail.com>
 <20231022175258.6bebcaff@Tarkus>
Message-ID: <CALnEB16LYVoSY4DrEhYGSx--jWct0c4HJ9KsEgS+A+n9u8pz9g@mail.gmail.com>

I ran into the same issue last week with .Rd files that were
previously accepted on CRAN and concluded that the package checks are
becoming more critical about this aspect of Rd syntax, which is good.

To reproduce the note outside R-devel and by that identify which files
in your package are affected you could run for every Rd file in your
man folder:

tools::checkRd(Rd = file, listOK = FALSE)

Vincent

On Sun, 22 Oct 2023 at 16:53, Ivan Krylov <krylov.r00t at gmail.com> wrote:
>
> On Sun, 22 Oct 2023 10:43:08 -0400
> J C Nash <profjcnash at gmail.com> wrote:
>
> >        \itemize{
> >          \item{fnchk OK;}{ \code{excode} = 0;
> >                         \code{infeasible} = FALSE}
>
> The \item command inside \itemize{} lists doesn't take arguments.
> Did you mean \describe{} instead of \itemize{}?
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From pro|jcn@@h @end|ng |rom gm@||@com  Sun Oct 22 17:37:02 2023
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sun, 22 Oct 2023 11:37:02 -0400
Subject: [R-pkg-devel] Issue of itemize in man file
In-Reply-To: <20231022175258.6bebcaff@Tarkus>
References: <5be6435c-56ab-4742-a31c-e7a86ae23aed@gmail.com>
 <20231022175258.6bebcaff@Tarkus>
Message-ID: <e2737db8-5a78-4079-984c-4fd42ae6a02b@gmail.com>

Thanks. That seems to be the issue. Also vincent's suggestion of checkRd.

JN

On 2023-10-22 10:52, Ivan Krylov wrote:
> On Sun, 22 Oct 2023 10:43:08 -0400
> J C Nash <profjcnash at gmail.com> wrote:
> 
>>         \itemize{
>>           \item{fnchk OK;}{ \code{excode} = 0;
>>                          \code{infeasible} = FALSE}
> 
> The \item command inside \itemize{} lists doesn't take arguments.
> Did you mean \describe{} instead of \itemize{}?
>



From kke@h@v @end|ng |rom u||@edu  Sun Oct 22 18:52:50 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Sun, 22 Oct 2023 16:52:50 +0000
Subject: [R-pkg-devel] Failing to write config file in linux
Message-ID: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>

Hi,

My package is failing on linux based systems because of an attempt to write in a location of package. One of the core features that we would like user to have is to modify the values in the config file, for which package has a function for user to provide modified config. In future, they should be able to provide individual parameters for the config for which also we will be writing to config in package directory /inst/ so that it can later be fetched. I understand that policy doesn?t allow writing to home directory. Is there a workaround for this? Or what could be other potential solutions to explore.

Snippet ?
https://github.com/GarrettLab/CroplandConnectivity/blob/923a4a0ca4a0ce8376068ee80986df228ea21d80/geohabnet/R/params.R#L57

Error ?
     ?? Failure ('test-parameters.R:38:3'): Test 6: Test to set new parameters.yaml ??
     Expected `set_parameters(new_param_file)` to run without any conditions.
     ? Actually got a <simpleWarning> with text:
     cannot create file '/home/hornik/tmp/R.check/r-release-gcc/Work/build/Packages/geohabnet/parameters.yaml', reason 'Read-only file system'


Best Regards,
Krishna Keshav


	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Sun Oct 22 19:15:32 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 22 Oct 2023 20:15:32 +0300
Subject: [R-pkg-devel] Failing to write config file in linux
In-Reply-To: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>
References: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>
Message-ID: <20231022201532.447d9089@Tarkus>

On Sun, 22 Oct 2023 16:52:50 +0000
"Keshav, Krishna" <kkeshav at ufl.edu> wrote:

> My package is failing on linux based systems because of an attempt to
> write in a location of package. One of the core features that we
> would like user to have is to modify the values in the config file

Can you place the edited configuration file under
tools::R_user_dir('geohabnet', 'config') instead of the package
directory?

-- 
Best regards,
Ivan



From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Sun Oct 22 19:16:08 2023
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Sun, 22 Oct 2023 10:16:08 -0700
Subject: [R-pkg-devel] Failing to write config file in linux
In-Reply-To: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>
References: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>
Message-ID: <8B913BCB-37FE-4840-A1A8-FECF81EE5A90@dcn.davis.ca.us>

Installed packages may not be modified because they are permitted to be installed with read-only access. You have no option to proceed in this direction.

Configuration files are normally stored in the user's working directory. Dotfiles are a common convention in *nix operating systems, but in Windows the conventions are a bit different. The most general solution is to allow the user to specify an R option in .Rprofile [1], but you can setup defaults depending on the user's OS to back that up in case they don't actually take the steps to do that.

[1] https://stat.ethz.ch/R-manual/R-devel/library/base/html/options.html

On October 22, 2023 9:52:50 AM PDT, "Keshav, Krishna" <kkeshav at ufl.edu> wrote:
>Hi,
>
>My package is failing on linux based systems because of an attempt to write in a location of package. One of the core features that we would like user to have is to modify the values in the config file, for which package has a function for user to provide modified config. In future, they should be able to provide individual parameters for the config for which also we will be writing to config in package directory /inst/ so that it can later be fetched. I understand that policy doesn?t allow writing to home directory. Is there a workaround for this? Or what could be other potential solutions to explore.
>
>Snippet ?
>https://github.com/GarrettLab/CroplandConnectivity/blob/923a4a0ca4a0ce8376068ee80986df228ea21d80/geohabnet/R/params.R#L57
>
>Error ?
>     ?? Failure ('test-parameters.R:38:3'): Test 6: Test to set new parameters.yaml ??
>     Expected `set_parameters(new_param_file)` to run without any conditions.
>     ? Actually got a <simpleWarning> with text:
>     cannot create file '/home/hornik/tmp/R.check/r-release-gcc/Work/build/Packages/geohabnet/parameters.yaml', reason 'Read-only file system'
>
>
>Best Regards,
>Krishna Keshav
>
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.



From @|mon@urb@nek @end|ng |rom R-project@org  Mon Oct 23 21:07:31 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Tue, 24 Oct 2023 08:07:31 +1300
Subject: [R-pkg-devel] Failing to write config file in linux
In-Reply-To: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>
References: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>
Message-ID: <DC4ED4AC-B5A6-4926-A8CA-7328FE20B774@R-project.org>

From CRAN policy (which you agreed to when you submitted your package) - note in particular the "nor anywhere else on the file system" part and also note that it tells you what to do in your case:


Packages should not write in the user?s home filespace (including clipboards), nor anywhere else on the file system apart from the R session?s temporary directory (or during installation in the location pointed to by TMPDIR: and such usage should be cleaned up). Installing into the system?s R installation (e.g., scripts to its bin directory) is not allowed.
Limited exceptions may be allowed in interactive sessions if the package obtains confirmation from the user.

For R version 4.0 or later (hence a version dependency is required or only conditional use is possible), packages may store user-specific data, configuration and cache files in their respective user directories obtained from tools::R_user_dir(), provided that by default sizes are kept as small as possible and the contents are actively managed (including removing outdated material).




> On Oct 23, 2023, at 5:52 AM, Keshav, Krishna <kkeshav at ufl.edu> wrote:
> 
> Hi,
> 
> My package is failing on linux based systems because of an attempt to write in a location of package. One of the core features that we would like user to have is to modify the values in the config file, for which package has a function for user to provide modified config. In future, they should be able to provide individual parameters for the config for which also we will be writing to config in package directory /inst/ so that it can later be fetched. I understand that policy doesn?t allow writing to home directory. Is there a workaround for this? Or what could be other potential solutions to explore.
> 
> Snippet ?
> https://github.com/GarrettLab/CroplandConnectivity/blob/923a4a0ca4a0ce8376068ee80986df228ea21d80/geohabnet/R/params.R#L57
> 
> Error ?
>     ?? Failure ('test-parameters.R:38:3'): Test 6: Test to set new parameters.yaml ??
>     Expected `set_parameters(new_param_file)` to run without any conditions.
>     ? Actually got a <simpleWarning> with text:
>     cannot create file '/home/hornik/tmp/R.check/r-release-gcc/Work/build/Packages/geohabnet/parameters.yaml', reason 'Read-only file system'
> 
> 
> Best Regards,
> Krishna Keshav
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From joun|@he|@ke @end|ng |rom jyu@||  Tue Oct 24 12:37:48 2023
From: joun|@he|@ke @end|ng |rom jyu@|| (Helske, Jouni)
Date: Tue, 24 Oct 2023 10:37:48 +0000
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <20231020165437.31a89982@arachnoid>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
Message-ID: <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>

Thanks for the help, I now tried resubmitting with Sys.setenv("OMP_THREAD_LIMIT" = 2) at the top of the exchange example, but I still get the same note:

Examples with CPU time > 2.5 times elapsed time
          user system elapsed ratio
exchange 1.196   0.04   0.159 7.774

Not sure what to try next.

Best,
Jouni
________________________________
From: Ivan Krylov <krylov.r00t at gmail.com>
Sent: Friday, October 20, 2023 16:54
To: Helske, Jouni <jouni.helske at jyu.fi>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Too many cores used in examples (not caused by data.table)

? Thu, 19 Oct 2023 05:57:54 +0000
"Helske, Jouni" <jouni.helske at jyu.fi> ?????:

> But I just realised that bssm uses Armadillo via RcppArmadillo, which
> uses OpenMP by default for some elementwise operations. So, I wonder
> if that could be the culprit?

I wasn't able to reproduce the NOTE either, despite manually setting
the environment variable
_R_CHECK_EXAMPLE_TIMING_CPU_TO_ELAPSED_THRESHOLD=2 before running R CMD
check, but I think I can see the code using OpenMP. Here's what I did:

0. Temporarily lower the system protections against capturing
performance traces of potentially sensitive parts:

echo -1 | sudo tee /proc/sys/kernel/perf_event_paranoid

(Set it back to 3 after you're done.)

1. Run the following command with the development version of the
package installed:

env OPENBLAS_NUM_THREADS=1 \
 perf record --call-graph drawf,4096 \
 R -e 'library(bssm); system.time(replicate(100, example(exchange)))'

OPENBLAS_NUM_THREADS=1 will prevent OpenBLAS from spawning worker
threads if you have it installed. (A different BLAS may need different
environment variables.)

2. Run `perf report` and browse collected call stack information.

The call stacks are hard to navigate, but I think they are not pointing
towards Armadillo. At least, setting ARMA_OPENMP_THREADS=1 doesn't
help, but setting OMP_THREAD_LIMIT=1 does.

--
Best regards,
Ivan

	[[alternative HTML version deleted]]



From greg @end|ng |rom ||rm@n@y@h@com  Tue Oct 24 13:03:10 2023
From: greg @end|ng |rom ||rm@n@y@h@com (Greg Hunt)
Date: Tue, 24 Oct 2023 22:03:10 +1100
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
Message-ID: <CAAS8PALAFNJNEB+i79XGziJ7VBtBOAJpAKhqdiv+bSm0-FwmqQ@mail.gmail.com>

In my case recently, after an hour or so?s messing about I disabled some
tests and example executions to get rid of the offending times. I doubt
that i am the only one to do that.

On Tue, 24 Oct 2023 at 9:38 pm, Helske, Jouni <jouni.helske at jyu.fi> wrote:

> Thanks for the help, I now tried resubmitting with
> Sys.setenv("OMP_THREAD_LIMIT" = 2) at the top of the exchange example, but
> I still get the same note:
>
> Examples with CPU time > 2.5 times elapsed time
>           user system elapsed ratio
> exchange 1.196   0.04   0.159 7.774
>
> Not sure what to try next.
>
> Best,
> Jouni
> ________________________________
> From: Ivan Krylov <krylov.r00t at gmail.com>
> Sent: Friday, October 20, 2023 16:54
> To: Helske, Jouni <jouni.helske at jyu.fi>
> Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
> Subject: Re: [R-pkg-devel] Too many cores used in examples (not caused by
> data.table)
>
> ? Thu, 19 Oct 2023 05:57:54 +0000
> "Helske, Jouni" <jouni.helske at jyu.fi> ?????:
>
> > But I just realised that bssm uses Armadillo via RcppArmadillo, which
> > uses OpenMP by default for some elementwise operations. So, I wonder
> > if that could be the culprit?
>
> I wasn't able to reproduce the NOTE either, despite manually setting
> the environment variable
> _R_CHECK_EXAMPLE_TIMING_CPU_TO_ELAPSED_THRESHOLD=2 before running R CMD
> check, but I think I can see the code using OpenMP. Here's what I did:
>
> 0. Temporarily lower the system protections against capturing
> performance traces of potentially sensitive parts:
>
> echo -1 | sudo tee /proc/sys/kernel/perf_event_paranoid
>
> (Set it back to 3 after you're done.)
>
> 1. Run the following command with the development version of the
> package installed:
>
> env OPENBLAS_NUM_THREADS=1 \
>  perf record --call-graph drawf,4096 \
>  R -e 'library(bssm); system.time(replicate(100, example(exchange)))'
>
> OPENBLAS_NUM_THREADS=1 will prevent OpenBLAS from spawning worker
> threads if you have it installed. (A different BLAS may need different
> environment variables.)
>
> 2. Run `perf report` and browse collected call stack information.
>
> The call stacks are hard to navigate, but I think they are not pointing
> towards Armadillo. At least, setting ARMA_OPENMP_THREADS=1 doesn't
> help, but setting OMP_THREAD_LIMIT=1 does.
>
> --
> Best regards,
> Ivan
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 24 14:55:16 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 24 Oct 2023 15:55:16 +0300
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
Message-ID: <20231024155516.3b45000f@arachnoid>

? Tue, 24 Oct 2023 10:37:48 +0000
"Helske, Jouni" <jouni.helske at jyu.fi> ?????:

> Examples with CPU time > 2.5 times elapsed time
>           user system elapsed ratio
> exchange 1.196   0.04   0.159 7.774

I've downloaded the archived copy of the package from the CRAN FTP
server, installed it and tried:

library(bssm)
Sys.setenv("OMP_THREAD_LIMIT" = 2)
data("exchange")
model <- svm(
 exchange, rho = uniform(0.97,-0.999,0.999),
 sd_ar = halfnormal(0.175, 2), mu = normal(-0.87, 0, 2)
)
system.time(particle_smoother(model, particles = 500))
#    user  system elapsed
#   0.515   0.000   0.073

I set a breakpoint on clone() [*] and got quite a few calls creating
OpenMP threads with the following call stack:

#0  clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:52
<...>
#4  0x00007ffff7314e0a in GOMP_parallel () from
/usr/lib/x86_64-linux-gnu/libgomp.so.1
 <-- RcppArmadillo code below
#5 0x00007ffff38f5f00 in
arma::eglue_core<arma::eglue_div>::apply<arma::Mat<double>,
arma::eOp<arma::eOp<arma::Col<double>, arma::eop_exp>,
arma::eop_scalar_times>, arma::eOp<arma::eOp<arma::Col<double>,
arma::eop_scalar_div_post>, arma::eop_square> > (outP=..., x=...) at
.../library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:69
#6 0x00007ffff3a31246 in
arma::Mat<double>::operator=<arma::eOp<arma::eOp<arma::Col<double>,
arma::eop_exp>, arma::eop_scalar_times>,
arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
arma::eop_square>, arma::eglue_div> (X=..., this=0x7fffffff36f0) at
.../library/RcppArmadillo/include/armadillo_bits/Proxy.hpp:226
#7
arma::Col<double>::operator=<arma::eGlue<arma::eOp<arma::eOp<arma::Col<double>,
arma::eop_exp>, arma::eop_scalar_times>,
arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
arma::eop_square>, arma::eglue_div> > ( X=..., this=0x7fffffff36f0) at
.../library/RcppArmadillo/include/armadillo_bits/Col_meat.hpp:535
 <-- bssm code below
#8  ssm_ung::laplace_iter (this=0x7fffffff15e0, signal=...) at
model_ssm_ung.cpp:310
#9  0x00007ffff3a36e9e in ssm_ung::approximate (this=0x7fffffff15e0) at
.../library/RcppArmadillo/include/armadillo_bits/arrayops_meat.hpp:27
#10 0x00007ffff3a3b3d3 in ssm_ung::psi_filter
(this=this at entry=0x7fffffff15e0, nsim=nsim at entry=500, alpha=...,
weights=..., indices=...) at model_ssm_ung.cpp:517
#11 0x00007ffff3948cd7 in psi_smoother (model_=..., nsim=nsim at entry=500,
seed=seed at entry=1092825895, model_type=model_type at entry=3) at
R_psi.cpp:131

What does arma::eglue_core do?

(gdb) list
/* reformatted a bit */
library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:64
 int n_threads = (std::min)(
  int(arma_config::mp_threads),
  int((std::max)(int(1), int(omp_get_max_threads())))
 );
(gdb) p arma_config::mp_threads
$3 = 8
(gdb) p (int)omp_get_max_threads()
$4 = 16
(gdb) p (char*)getenv("OMP_THREAD_LIMIT")
$7 = 0x555556576b91 "2"
(gdb) p /x (int)omp_get_thread_limit()
$9 = 0x7fffffff

Sorry for misinforming you about the OMP_THREAD_LIMIT environment
variable: the OpenMP specification requires the program to ignore
modifications to the environment variables after the program has
started [**], so it only works if R is started with OMP_THREAD_LIMIT
set. Additionally, the OpenMP thread limit is not supposed to be
adjusted at runtime at all [***].

Unfortunately for our situation, Armadillo is very insistent in setting
its own number of threads from arma_config::mp_threads (which is
constexpr 8 unless you set preprocessor directives while compiling it)
and omp_get_max_threads (which is the upper bound on the number of
threads that cannot be adjusted at runtime).

What I'm about to suggest is a terrible hack, but since Armadillo seems
to lack the option to set the number of threads at runtime, there might
be no other option.

Before you #include an Armadillo header, every time:

1. #include <omp.h> so that the OpenMP functions are declared and the
#include guard is set

2. Define a static inline function get_number_of_threads returning the
desired number of threads as an int (e.g. referencing an extern int
number_of_threads stored elsewhere)

3. #define omp_get_max_threads get_number_of_threads

Now if you provide an API for the R code to get and set this number, it
should be possible to control the number of threads used by OpenMP code
in Armadillo. Basically, a data.table::setDTthreads() for the copy of
Armadillo inlined inside your package.

If you then compile your package with a large #define
ARMA_OPENMP_THREADS, it will both be able to use more than 8 threads
*and* limit itself when needed.

An alternative course of action is compiling your package with #define
ARMA_OPENMP_THREADS 2 and giving up on more OpenMP threads inside calls
to Armadillo.

-- 
Best regards,
Ivan

[*]
https://github.com/tidymodels/textrecipes/pull/251#issuecomment-1775549814

[**]
https://www.openmp.org/spec-html/5.2/openmpch21.html#x432-59000021

[***]
https://www.openmp.org/wp-content/uploads/OpenMPRefCard-5-2-web.pdf#page=15



From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Oct 24 15:04:10 2023
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 24 Oct 2023 08:04:10 -0500
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <CAAS8PALAFNJNEB+i79XGziJ7VBtBOAJpAKhqdiv+bSm0-FwmqQ@mail.gmail.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <CAAS8PALAFNJNEB+i79XGziJ7VBtBOAJpAKhqdiv+bSm0-FwmqQ@mail.gmail.com>
Message-ID: <ab24248a-a6df-4cd7-8574-03a8fe03188a@effectivedefense.org>

	  Chapter 15 in Wickham and Bryan, R Packages, discuss "Advanced 
Testing Techniques". Their current section "15.4.1 Skip a test" includes 
the following:


test_that("some long-running thing works", {
   skip_on_cran()
   # test code that can potentially take "a while" to run
})


	  Have you tried writing directly to Jennifer Bryan 
<jenny at rstudio.com>? She and Hadley might be able to get help from the 
CRAN maintainers in getting help with this particular problem AND 
getting more documentation on this in their book ;-)


	  hope this helps.
	  spencer graves
	

On 10/24/23 6:03 AM, Greg Hunt wrote:
> In my case recently, after an hour or so?s messing about I disabled some
> tests and example executions to get rid of the offending times. I doubt
> that i am the only one to do that.
> 
> On Tue, 24 Oct 2023 at 9:38 pm, Helske, Jouni <jouni.helske at jyu.fi> wrote:
> 
>> Thanks for the help, I now tried resubmitting with
>> Sys.setenv("OMP_THREAD_LIMIT" = 2) at the top of the exchange example, but
>> I still get the same note:
>>
>> Examples with CPU time > 2.5 times elapsed time
>>            user system elapsed ratio
>> exchange 1.196   0.04   0.159 7.774
>>
>> Not sure what to try next.
>>
>> Best,
>> Jouni
>> ________________________________
>> From: Ivan Krylov <krylov.r00t at gmail.com>
>> Sent: Friday, October 20, 2023 16:54
>> To: Helske, Jouni <jouni.helske at jyu.fi>
>> Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
>> Subject: Re: [R-pkg-devel] Too many cores used in examples (not caused by
>> data.table)
>>
>> ? Thu, 19 Oct 2023 05:57:54 +0000
>> "Helske, Jouni" <jouni.helske at jyu.fi> ?????:
>>
>>> But I just realised that bssm uses Armadillo via RcppArmadillo, which
>>> uses OpenMP by default for some elementwise operations. So, I wonder
>>> if that could be the culprit?
>>
>> I wasn't able to reproduce the NOTE either, despite manually setting
>> the environment variable
>> _R_CHECK_EXAMPLE_TIMING_CPU_TO_ELAPSED_THRESHOLD=2 before running R CMD
>> check, but I think I can see the code using OpenMP. Here's what I did:
>>
>> 0. Temporarily lower the system protections against capturing
>> performance traces of potentially sensitive parts:
>>
>> echo -1 | sudo tee /proc/sys/kernel/perf_event_paranoid
>>
>> (Set it back to 3 after you're done.)
>>
>> 1. Run the following command with the development version of the
>> package installed:
>>
>> env OPENBLAS_NUM_THREADS=1 \
>>   perf record --call-graph drawf,4096 \
>>   R -e 'library(bssm); system.time(replicate(100, example(exchange)))'
>>
>> OPENBLAS_NUM_THREADS=1 will prevent OpenBLAS from spawning worker
>> threads if you have it installed. (A different BLAS may need different
>> environment variables.)
>>
>> 2. Run `perf report` and browse collected call stack information.
>>
>> The call stacks are hard to navigate, but I think they are not pointing
>> towards Armadillo. At least, setting ARMA_OPENMP_THREADS=1 doesn't
>> help, but setting OMP_THREAD_LIMIT=1 does.
>>
>> --
>> Best regards,
>> Ivan
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From edd @end|ng |rom deb|@n@org  Tue Oct 24 15:15:40 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 24 Oct 2023 08:15:40 -0500
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <20231024155516.3b45000f@arachnoid>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
Message-ID: <25911.50044.191576.935725@rob.eddelbuettel.com>


On 24 October 2023 at 15:55, Ivan Krylov wrote:
| ? Tue, 24 Oct 2023 10:37:48 +0000
| "Helske, Jouni" <jouni.helske at jyu.fi> ?????:
| 
| > Examples with CPU time > 2.5 times elapsed time
| >           user system elapsed ratio
| > exchange 1.196   0.04   0.159 7.774
| 
| I've downloaded the archived copy of the package from the CRAN FTP
| server, installed it and tried:
| 
| library(bssm)
| Sys.setenv("OMP_THREAD_LIMIT" = 2)
| data("exchange")
| model <- svm(
|  exchange, rho = uniform(0.97,-0.999,0.999),
|  sd_ar = halfnormal(0.175, 2), mu = normal(-0.87, 0, 2)
| )
| system.time(particle_smoother(model, particles = 500))
| #    user  system elapsed
| #   0.515   0.000   0.073
| 
| I set a breakpoint on clone() [*] and got quite a few calls creating
| OpenMP threads with the following call stack:
| 
| #0  clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:52
| <...>
| #4  0x00007ffff7314e0a in GOMP_parallel () from
| /usr/lib/x86_64-linux-gnu/libgomp.so.1
|  <-- RcppArmadillo code below
| #5 0x00007ffff38f5f00 in
| arma::eglue_core<arma::eglue_div>::apply<arma::Mat<double>,
| arma::eOp<arma::eOp<arma::Col<double>, arma::eop_exp>,
| arma::eop_scalar_times>, arma::eOp<arma::eOp<arma::Col<double>,
| arma::eop_scalar_div_post>, arma::eop_square> > (outP=..., x=...) at
| .../library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:69
| #6 0x00007ffff3a31246 in
| arma::Mat<double>::operator=<arma::eOp<arma::eOp<arma::Col<double>,
| arma::eop_exp>, arma::eop_scalar_times>,
| arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
| arma::eop_square>, arma::eglue_div> (X=..., this=0x7fffffff36f0) at
| .../library/RcppArmadillo/include/armadillo_bits/Proxy.hpp:226
| #7
| arma::Col<double>::operator=<arma::eGlue<arma::eOp<arma::eOp<arma::Col<double>,
| arma::eop_exp>, arma::eop_scalar_times>,
| arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
| arma::eop_square>, arma::eglue_div> > ( X=..., this=0x7fffffff36f0) at
| .../library/RcppArmadillo/include/armadillo_bits/Col_meat.hpp:535
|  <-- bssm code below
| #8  ssm_ung::laplace_iter (this=0x7fffffff15e0, signal=...) at
| model_ssm_ung.cpp:310
| #9  0x00007ffff3a36e9e in ssm_ung::approximate (this=0x7fffffff15e0) at
| .../library/RcppArmadillo/include/armadillo_bits/arrayops_meat.hpp:27
| #10 0x00007ffff3a3b3d3 in ssm_ung::psi_filter
| (this=this at entry=0x7fffffff15e0, nsim=nsim at entry=500, alpha=...,
| weights=..., indices=...) at model_ssm_ung.cpp:517
| #11 0x00007ffff3948cd7 in psi_smoother (model_=..., nsim=nsim at entry=500,
| seed=seed at entry=1092825895, model_type=model_type at entry=3) at
| R_psi.cpp:131
| 
| What does arma::eglue_core do?
| 
| (gdb) list
| /* reformatted a bit */
| library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:64
|  int n_threads = (std::min)(
|   int(arma_config::mp_threads),
|   int((std::max)(int(1), int(omp_get_max_threads())))
|  );
| (gdb) p arma_config::mp_threads
| $3 = 8
| (gdb) p (int)omp_get_max_threads()
| $4 = 16
| (gdb) p (char*)getenv("OMP_THREAD_LIMIT")
| $7 = 0x555556576b91 "2"
| (gdb) p /x (int)omp_get_thread_limit()
| $9 = 0x7fffffff
| 
| Sorry for misinforming you about the OMP_THREAD_LIMIT environment
| variable: the OpenMP specification requires the program to ignore
| modifications to the environment variables after the program has
| started [**], so it only works if R is started with OMP_THREAD_LIMIT
| set. Additionally, the OpenMP thread limit is not supposed to be
| adjusted at runtime at all [***].
| 
| Unfortunately for our situation, Armadillo is very insistent in setting
| its own number of threads from arma_config::mp_threads (which is
| constexpr 8 unless you set preprocessor directives while compiling it)
| and omp_get_max_threads (which is the upper bound on the number of
| threads that cannot be adjusted at runtime).
| 
| What I'm about to suggest is a terrible hack, but since Armadillo seems
| to lack the option to set the number of threads at runtime, there might
| be no other option.
| 
| Before you #include an Armadillo header, every time:
| 
| 1. #include <omp.h> so that the OpenMP functions are declared and the
| #include guard is set
| 
| 2. Define a static inline function get_number_of_threads returning the
| desired number of threads as an int (e.g. referencing an extern int
| number_of_threads stored elsewhere)
| 
| 3. #define omp_get_max_threads get_number_of_threads
| 
| Now if you provide an API for the R code to get and set this number, it
| should be possible to control the number of threads used by OpenMP code
| in Armadillo. Basically, a data.table::setDTthreads() for the copy of
| Armadillo inlined inside your package.
| 
| If you then compile your package with a large #define
| ARMA_OPENMP_THREADS, it will both be able to use more than 8 threads
| *and* limit itself when needed.
| 
| An alternative course of action is compiling your package with #define
| ARMA_OPENMP_THREADS 2 and giving up on more OpenMP threads inside calls
| to Armadillo.

We should work on adding such a run-time setter of the number of cores to
RcppArmadillo so that examples can dial down to 2 cores.  I have been doing
just that in package tiledb (via a setting internal to the TileDB Core
library) for 'ages' now and RcppArmadillo could and should offer the same.

Dirk

| -- 
| Best regards,
| Ivan
| 
| [*]
| https://github.com/tidymodels/textrecipes/pull/251#issuecomment-1775549814
| 
| [**]
| https://www.openmp.org/spec-html/5.2/openmpch21.html#x432-59000021
| 
| [***]
| https://www.openmp.org/wp-content/uploads/OpenMPRefCard-5-2-web.pdf#page=15
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From rhe|p @end|ng |rom eoo@@dd@@n|  Tue Oct 24 17:01:24 2023
From: rhe|p @end|ng |rom eoo@@dd@@n| (Jan van der Laan)
Date: Tue, 24 Oct 2023 17:01:24 +0200
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <CAAS8PALAFNJNEB+i79XGziJ7VBtBOAJpAKhqdiv+bSm0-FwmqQ@mail.gmail.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <CAAS8PALAFNJNEB+i79XGziJ7VBtBOAJpAKhqdiv+bSm0-FwmqQ@mail.gmail.com>
Message-ID: <9dcffb17-778c-4f28-98f6-3309dfb627fb@eoos.dds.nl>

You are not the only one; I did the same with some of my examples.

Would it be an option to ask for a default R-option, 'max.ncores', that 
specifies the maximum number of cores a process is allowed to use? CRAN 
could then require that that examples, tests and vignettes respect this 
option. That way there would be one uniform option to specify the 
maximum number of cores processes could use. That would also make it 
easier for system administrators to set default values for this (use the 
entire system; or use one code by default on a shared system).

Of course, we package maintainers could do this without involvement of 
R-code or CRAN. We only need to agree on a name and a default value for 
when the option is missing (0 = use all cores; 1 or 2; or ncores-1 ...).

Jan


On 24-10-2023 13:03, Greg Hunt wrote:
> In my case recently, after an hour or so?s messing about I disabled some
> tests and example executions to get rid of the offending times. I doubt
> that i am the only one to do that.
> 
> On Tue, 24 Oct 2023 at 9:38 pm, Helske, Jouni <jouni.helske at jyu.fi> wrote:
> 
>> Thanks for the help, I now tried resubmitting with
>> Sys.setenv("OMP_THREAD_LIMIT" = 2) at the top of the exchange example, but
>> I still get the same note:
>>
>> Examples with CPU time > 2.5 times elapsed time
>>            user system elapsed ratio
>> exchange 1.196   0.04   0.159 7.774
>>
>> Not sure what to try next.
>>
>> Best,
>> Jouni
>> ________________________________
>> From: Ivan Krylov <krylov.r00t at gmail.com>
>> Sent: Friday, October 20, 2023 16:54
>> To: Helske, Jouni <jouni.helske at jyu.fi>
>> Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
>> Subject: Re: [R-pkg-devel] Too many cores used in examples (not caused by
>> data.table)
>>
>> ? Thu, 19 Oct 2023 05:57:54 +0000
>> "Helske, Jouni" <jouni.helske at jyu.fi> ?????:
>>
>>> But I just realised that bssm uses Armadillo via RcppArmadillo, which
>>> uses OpenMP by default for some elementwise operations. So, I wonder
>>> if that could be the culprit?
>>
>> I wasn't able to reproduce the NOTE either, despite manually setting
>> the environment variable
>> _R_CHECK_EXAMPLE_TIMING_CPU_TO_ELAPSED_THRESHOLD=2 before running R CMD
>> check, but I think I can see the code using OpenMP. Here's what I did:
>>
>> 0. Temporarily lower the system protections against capturing
>> performance traces of potentially sensitive parts:
>>
>> echo -1 | sudo tee /proc/sys/kernel/perf_event_paranoid
>>
>> (Set it back to 3 after you're done.)
>>
>> 1. Run the following command with the development version of the
>> package installed:
>>
>> env OPENBLAS_NUM_THREADS=1 \
>>   perf record --call-graph drawf,4096 \
>>   R -e 'library(bssm); system.time(replicate(100, example(exchange)))'
>>
>> OPENBLAS_NUM_THREADS=1 will prevent OpenBLAS from spawning worker
>> threads if you have it installed. (A different BLAS may need different
>> environment variables.)
>>
>> 2. Run `perf report` and browse collected call stack information.
>>
>> The call stacks are hard to navigate, but I think they are not pointing
>> towards Armadillo. At least, setting ARMA_OPENMP_THREADS=1 doesn't
>> help, but setting OMP_THREAD_LIMIT=1 does.
>>
>> --
>> Best regards,
>> Ivan
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From edd @end|ng |rom deb|@n@org  Wed Oct 25 12:27:46 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 25 Oct 2023 05:27:46 -0500
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <25911.50044.191576.935725@rob.eddelbuettel.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
 <25911.50044.191576.935725@rob.eddelbuettel.com>
Message-ID: <25912.60834.927280.904009@rob.eddelbuettel.com>


On 24 October 2023 at 08:15, Dirk Eddelbuettel wrote:
| 
| On 24 October 2023 at 15:55, Ivan Krylov wrote:
| | ? Tue, 24 Oct 2023 10:37:48 +0000
| | "Helske, Jouni" <jouni.helske at jyu.fi> ?????:
| | 
| | > Examples with CPU time > 2.5 times elapsed time
| | >           user system elapsed ratio
| | > exchange 1.196   0.04   0.159 7.774
| | 
| | I've downloaded the archived copy of the package from the CRAN FTP
| | server, installed it and tried:
| | 
| | library(bssm)
| | Sys.setenv("OMP_THREAD_LIMIT" = 2)
| | data("exchange")
| | model <- svm(
| |  exchange, rho = uniform(0.97,-0.999,0.999),
| |  sd_ar = halfnormal(0.175, 2), mu = normal(-0.87, 0, 2)
| | )
| | system.time(particle_smoother(model, particles = 500))
| | #    user  system elapsed
| | #   0.515   0.000   0.073
| | 
| | I set a breakpoint on clone() [*] and got quite a few calls creating
| | OpenMP threads with the following call stack:
| | 
| | #0  clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:52
| | <...>
| | #4  0x00007ffff7314e0a in GOMP_parallel () from
| | /usr/lib/x86_64-linux-gnu/libgomp.so.1
| |  <-- RcppArmadillo code below
| | #5 0x00007ffff38f5f00 in
| | arma::eglue_core<arma::eglue_div>::apply<arma::Mat<double>,
| | arma::eOp<arma::eOp<arma::Col<double>, arma::eop_exp>,
| | arma::eop_scalar_times>, arma::eOp<arma::eOp<arma::Col<double>,
| | arma::eop_scalar_div_post>, arma::eop_square> > (outP=..., x=...) at
| | .../library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:69
| | #6 0x00007ffff3a31246 in
| | arma::Mat<double>::operator=<arma::eOp<arma::eOp<arma::Col<double>,
| | arma::eop_exp>, arma::eop_scalar_times>,
| | arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
| | arma::eop_square>, arma::eglue_div> (X=..., this=0x7fffffff36f0) at
| | .../library/RcppArmadillo/include/armadillo_bits/Proxy.hpp:226
| | #7
| | arma::Col<double>::operator=<arma::eGlue<arma::eOp<arma::eOp<arma::Col<double>,
| | arma::eop_exp>, arma::eop_scalar_times>,
| | arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
| | arma::eop_square>, arma::eglue_div> > ( X=..., this=0x7fffffff36f0) at
| | .../library/RcppArmadillo/include/armadillo_bits/Col_meat.hpp:535
| |  <-- bssm code below
| | #8  ssm_ung::laplace_iter (this=0x7fffffff15e0, signal=...) at
| | model_ssm_ung.cpp:310
| | #9  0x00007ffff3a36e9e in ssm_ung::approximate (this=0x7fffffff15e0) at
| | .../library/RcppArmadillo/include/armadillo_bits/arrayops_meat.hpp:27
| | #10 0x00007ffff3a3b3d3 in ssm_ung::psi_filter
| | (this=this at entry=0x7fffffff15e0, nsim=nsim at entry=500, alpha=...,
| | weights=..., indices=...) at model_ssm_ung.cpp:517
| | #11 0x00007ffff3948cd7 in psi_smoother (model_=..., nsim=nsim at entry=500,
| | seed=seed at entry=1092825895, model_type=model_type at entry=3) at
| | R_psi.cpp:131
| | 
| | What does arma::eglue_core do?
| | 
| | (gdb) list
| | /* reformatted a bit */
| | library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:64
| |  int n_threads = (std::min)(
| |   int(arma_config::mp_threads),
| |   int((std::max)(int(1), int(omp_get_max_threads())))
| |  );
| | (gdb) p arma_config::mp_threads
| | $3 = 8
| | (gdb) p (int)omp_get_max_threads()
| | $4 = 16
| | (gdb) p (char*)getenv("OMP_THREAD_LIMIT")
| | $7 = 0x555556576b91 "2"
| | (gdb) p /x (int)omp_get_thread_limit()
| | $9 = 0x7fffffff
| | 
| | Sorry for misinforming you about the OMP_THREAD_LIMIT environment
| | variable: the OpenMP specification requires the program to ignore
| | modifications to the environment variables after the program has
| | started [**], so it only works if R is started with OMP_THREAD_LIMIT
| | set. Additionally, the OpenMP thread limit is not supposed to be
| | adjusted at runtime at all [***].
| | 
| | Unfortunately for our situation, Armadillo is very insistent in setting
| | its own number of threads from arma_config::mp_threads (which is
| | constexpr 8 unless you set preprocessor directives while compiling it)
| | and omp_get_max_threads (which is the upper bound on the number of
| | threads that cannot be adjusted at runtime).
| | 
| | What I'm about to suggest is a terrible hack, but since Armadillo seems
| | to lack the option to set the number of threads at runtime, there might
| | be no other option.
| | 
| | Before you #include an Armadillo header, every time:
| | 
| | 1. #include <omp.h> so that the OpenMP functions are declared and the
| | #include guard is set
| | 
| | 2. Define a static inline function get_number_of_threads returning the
| | desired number of threads as an int (e.g. referencing an extern int
| | number_of_threads stored elsewhere)
| | 
| | 3. #define omp_get_max_threads get_number_of_threads
| | 
| | Now if you provide an API for the R code to get and set this number, it
| | should be possible to control the number of threads used by OpenMP code
| | in Armadillo. Basically, a data.table::setDTthreads() for the copy of
| | Armadillo inlined inside your package.
| | 
| | If you then compile your package with a large #define
| | ARMA_OPENMP_THREADS, it will both be able to use more than 8 threads
| | *and* limit itself when needed.
| | 
| | An alternative course of action is compiling your package with #define
| | ARMA_OPENMP_THREADS 2 and giving up on more OpenMP threads inside calls
| | to Armadillo.
| 
| We should work on adding such a run-time setter of the number of cores to
| RcppArmadillo so that examples can dial down to 2 cores.  I have been doing
| just that in package tiledb (via a setting internal to the TileDB Core
| library) for 'ages' now and RcppArmadillo could and should offer the same.

A run-time setter won't work, Armadillo uses a constexpr. But we may have
looked in error at the _wrong_ OpenMP environment variable.  Can you please
try with OMP_NUM_THREADS=2 (instead of OMP_THREAD_LIMIT) ?  

Dirk
 
| Dirk
| 
| | -- 
| | Best regards,
| | Ivan
| | 
| | [*]
| | https://github.com/tidymodels/textrecipes/pull/251#issuecomment-1775549814
| | 
| | [**]
| | https://www.openmp.org/spec-html/5.2/openmpch21.html#x432-59000021
| | 
| | [***]
| | https://www.openmp.org/wp-content/uploads/OpenMPRefCard-5-2-web.pdf#page=15
| | 
| | ______________________________________________
| | R-package-devel at r-project.org mailing list
| | https://stat.ethz.ch/mailman/listinfo/r-package-devel
| 
| -- 
| dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From joun|@he|@ke @end|ng |rom jyu@||  Wed Oct 25 14:04:38 2023
From: joun|@he|@ke @end|ng |rom jyu@|| (Helske, Jouni)
Date: Wed, 25 Oct 2023 12:04:38 +0000
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <25912.60834.927280.904009@rob.eddelbuettel.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
 <25911.50044.191576.935725@rob.eddelbuettel.com>
 <25912.60834.927280.904009@rob.eddelbuettel.com>
Message-ID: <PAXPR05MB86503FBDDAD830F994370F15F8DEA@PAXPR05MB8650.eurprd05.prod.outlook.com>

Thanks,

I tried with  OMP_NUM_THREADS=2 but unfortunately got the same NOTE as before.

Best,
Jouni
________________________________
From: Dirk Eddelbuettel <edd at debian.org>
Sent: Wednesday, October 25, 2023 13:27
To: Dirk Eddelbuettel <edd at debian.org>; Helske, Jouni <jouni.helske at jyu.fi>
Cc: Ivan Krylov <krylov.r00t at gmail.com>; r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Too many cores used in examples (not caused by data.table)


On 24 October 2023 at 08:15, Dirk Eddelbuettel wrote:
|
| On 24 October 2023 at 15:55, Ivan Krylov wrote:
| | ? Tue, 24 Oct 2023 10:37:48 +0000
| | "Helske, Jouni" <jouni.helske at jyu.fi> ?????:
| |
| | > Examples with CPU time > 2.5 times elapsed time
| | >           user system elapsed ratio
| | > exchange 1.196   0.04   0.159 7.774
| |
| | I've downloaded the archived copy of the package from the CRAN FTP
| | server, installed it and tried:
| |
| | library(bssm)
| | Sys.setenv("OMP_THREAD_LIMIT" = 2)
| | data("exchange")
| | model <- svm(
| |  exchange, rho = uniform(0.97,-0.999,0.999),
| |  sd_ar = halfnormal(0.175, 2), mu = normal(-0.87, 0, 2)
| | )
| | system.time(particle_smoother(model, particles = 500))
| | #    user  system elapsed
| | #   0.515   0.000   0.073
| |
| | I set a breakpoint on clone() [*] and got quite a few calls creating
| | OpenMP threads with the following call stack:
| |
| | #0  clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:52
| | <...>
| | #4  0x00007ffff7314e0a in GOMP_parallel () from
| | /usr/lib/x86_64-linux-gnu/libgomp.so.1
| |  <-- RcppArmadillo code below
| | #5 0x00007ffff38f5f00 in
| | arma::eglue_core<arma::eglue_div>::apply<arma::Mat<double>,
| | arma::eOp<arma::eOp<arma::Col<double>, arma::eop_exp>,
| | arma::eop_scalar_times>, arma::eOp<arma::eOp<arma::Col<double>,
| | arma::eop_scalar_div_post>, arma::eop_square> > (outP=..., x=...) at
| | .../library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:69
| | #6 0x00007ffff3a31246 in
| | arma::Mat<double>::operator=<arma::eOp<arma::eOp<arma::Col<double>,
| | arma::eop_exp>, arma::eop_scalar_times>,
| | arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
| | arma::eop_square>, arma::eglue_div> (X=..., this=0x7fffffff36f0) at
| | .../library/RcppArmadillo/include/armadillo_bits/Proxy.hpp:226
| | #7
| | arma::Col<double>::operator=<arma::eGlue<arma::eOp<arma::eOp<arma::Col<double>,
| | arma::eop_exp>, arma::eop_scalar_times>,
| | arma::eOp<arma::eOp<arma::Col<double>, arma::eop_scalar_div_post>,
| | arma::eop_square>, arma::eglue_div> > ( X=..., this=0x7fffffff36f0) at
| | .../library/RcppArmadillo/include/armadillo_bits/Col_meat.hpp:535
| |  <-- bssm code below
| | #8  ssm_ung::laplace_iter (this=0x7fffffff15e0, signal=...) at
| | model_ssm_ung.cpp:310
| | #9  0x00007ffff3a36e9e in ssm_ung::approximate (this=0x7fffffff15e0) at
| | .../library/RcppArmadillo/include/armadillo_bits/arrayops_meat.hpp:27
| | #10 0x00007ffff3a3b3d3 in ssm_ung::psi_filter
| | (this=this at entry=0x7fffffff15e0, nsim=nsim at entry=500, alpha=...,
| | weights=..., indices=...) at model_ssm_ung.cpp:517
| | #11 0x00007ffff3948cd7 in psi_smoother (model_=..., nsim=nsim at entry=500,
| | seed=seed at entry=1092825895, model_type=model_type at entry=3) at
| | R_psi.cpp:131
| |
| | What does arma::eglue_core do?
| |
| | (gdb) list
| | /* reformatted a bit */
| | library/RcppArmadillo/include/armadillo_bits/mp_misc.hpp:64
| |  int n_threads = (std::min)(
| |   int(arma_config::mp_threads),
| |   int((std::max)(int(1), int(omp_get_max_threads())))
| |  );
| | (gdb) p arma_config::mp_threads
| | $3 = 8
| | (gdb) p (int)omp_get_max_threads()
| | $4 = 16
| | (gdb) p (char*)getenv("OMP_THREAD_LIMIT")
| | $7 = 0x555556576b91 "2"
| | (gdb) p /x (int)omp_get_thread_limit()
| | $9 = 0x7fffffff
| |
| | Sorry for misinforming you about the OMP_THREAD_LIMIT environment
| | variable: the OpenMP specification requires the program to ignore
| | modifications to the environment variables after the program has
| | started [**], so it only works if R is started with OMP_THREAD_LIMIT
| | set. Additionally, the OpenMP thread limit is not supposed to be
| | adjusted at runtime at all [***].
| |
| | Unfortunately for our situation, Armadillo is very insistent in setting
| | its own number of threads from arma_config::mp_threads (which is
| | constexpr 8 unless you set preprocessor directives while compiling it)
| | and omp_get_max_threads (which is the upper bound on the number of
| | threads that cannot be adjusted at runtime).
| |
| | What I'm about to suggest is a terrible hack, but since Armadillo seems
| | to lack the option to set the number of threads at runtime, there might
| | be no other option.
| |
| | Before you #include an Armadillo header, every time:
| |
| | 1. #include <omp.h> so that the OpenMP functions are declared and the
| | #include guard is set
| |
| | 2. Define a static inline function get_number_of_threads returning the
| | desired number of threads as an int (e.g. referencing an extern int
| | number_of_threads stored elsewhere)
| |
| | 3. #define omp_get_max_threads get_number_of_threads
| |
| | Now if you provide an API for the R code to get and set this number, it
| | should be possible to control the number of threads used by OpenMP code
| | in Armadillo. Basically, a data.table::setDTthreads() for the copy of
| | Armadillo inlined inside your package.
| |
| | If you then compile your package with a large #define
| | ARMA_OPENMP_THREADS, it will both be able to use more than 8 threads
| | *and* limit itself when needed.
| |
| | An alternative course of action is compiling your package with #define
| | ARMA_OPENMP_THREADS 2 and giving up on more OpenMP threads inside calls
| | to Armadillo.
|
| We should work on adding such a run-time setter of the number of cores to
| RcppArmadillo so that examples can dial down to 2 cores.  I have been doing
| just that in package tiledb (via a setting internal to the TileDB Core
| library) for 'ages' now and RcppArmadillo could and should offer the same.

A run-time setter won't work, Armadillo uses a constexpr. But we may have
looked in error at the _wrong_ OpenMP environment variable.  Can you please
try with OMP_NUM_THREADS=2 (instead of OMP_THREAD_LIMIT) ?

Dirk

| Dirk
|
| | --
| | Best regards,
| | Ivan
| |
| | [*]
| | https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Ftidymodels%2Ftextrecipes%2Fpull%2F251%23issuecomment-1775549814&data=05%7C01%7Cjovetale%40jyu.mail.onmicrosoft.com%7C10f4432f57304393f6aa08dbd5450b40%7Ce9662d58caa44bc1b138c8b1acab5a11%7C1%7C0%7C638338264751478030%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=PmuX0x1eRky1TFSwmq7O2cJwCoS87v72xh0ydzHOsA4%3D&reserved=0<https://github.com/tidymodels/textrecipes/pull/251#issuecomment-1775549814>
| |
| | [**]
| | https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.openmp.org%2Fspec-html%2F5.2%2Fopenmpch21.html%23x432-59000021&data=05%7C01%7Cjovetale%40jyu.mail.onmicrosoft.com%7C10f4432f57304393f6aa08dbd5450b40%7Ce9662d58caa44bc1b138c8b1acab5a11%7C1%7C0%7C638338264751478030%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=cTZKytn22QvL%2FOoP7EOm4bqXG%2FUgke%2BhTNT2Mhd6l0k%3D&reserved=0<https://www.openmp.org/spec-html/5.2/openmpch21.html#x432-59000021>
| |
| | [***]
| | https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.openmp.org%2Fwp-content%2Fuploads%2FOpenMPRefCard-5-2-web.pdf%23page%3D15&data=05%7C01%7Cjovetale%40jyu.mail.onmicrosoft.com%7C10f4432f57304393f6aa08dbd5450b40%7Ce9662d58caa44bc1b138c8b1acab5a11%7C1%7C0%7C638338264751478030%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=vYfueL7%2FvEWcPTQZ2Tjivys2kxEXhyDRCkF0u0IHaPg%3D&reserved=0<https://www.openmp.org/wp-content/uploads/OpenMPRefCard-5-2-web.pdf#page=15>
| |
| | ______________________________________________
| | R-package-devel at r-project.org mailing list
| | https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Cjovetale%40jyu.mail.onmicrosoft.com%7C10f4432f57304393f6aa08dbd5450b40%7Ce9662d58caa44bc1b138c8b1acab5a11%7C1%7C0%7C638338264751478030%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fWW%2BqMTeoQpg3%2BeNw%2Fuptmdy9PXsgHMfVijyTv0pdng%3D&reserved=0<https://stat.ethz.ch/mailman/listinfo/r-package-devel>
|
| --
| dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
|
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Cjovetale%40jyu.mail.onmicrosoft.com%7C10f4432f57304393f6aa08dbd5450b40%7Ce9662d58caa44bc1b138c8b1acab5a11%7C1%7C0%7C638338264751478030%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=fWW%2BqMTeoQpg3%2BeNw%2Fuptmdy9PXsgHMfVijyTv0pdng%3D&reserved=0<https://stat.ethz.ch/mailman/listinfo/r-package-devel>

--
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct 25 14:55:29 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 25 Oct 2023 15:55:29 +0300
Subject: [R-pkg-devel] RFC: an interface to manage use of parallelism in
 packages
Message-ID: <20231025155529.0f83fc93@arachnoid>

Summary: at the end of this message is a link to an R package
implementing an interface for managing the use of execution units in R
packages. As a package maintainer, would you agree to use something
like this? Does it look sufficiently reasonable to become a part of R?
Read on for why I made these particular interface choices.

My understanding of the problem stated by Simon Urbanek and Uwe Ligges
[1,2] is that we need a way to set and distribute the CPU core
allowance between multiple packages that could be using very different
methods to achieve parallel execution on the local machine, including
threads and child processes. We could have multiple well-meaning
packages, each of them calling each other using a different parallelism
technology: imagine parallel::makeCluster(getOption('mc.cores'))
combined with parallel::mclapply(mc.cores = getOption('mc.cores')) and
with an OpenMP program that also spawns getOption('mc.cores') threads.
A parallel BLAS or custom multi-threading using std::thread could add
more fuel to the fire.

Workarounds applied by the package maintainers nowadays are both
cumbersome (sometimes one has to talk to some package that lives
downstream in the call stack and isn't even an explicit dependency,
because it's the one responsible for the threads) and not really enough
(most maintainers forget to restore the state after they are done, so a
single example() may slow down the operations that follow).

The problem is complicated by the fact that not every parallel
operation can explicitly accept the CPU core limit as a parameter. For
example, data.table's implicit parallelism is very convenient, and so
are parallel BLASes (which don't have a standard interface to change
the number of threads), so we shouldn't be prohibiting implicit
parallelism.

It's also not always obvious how to split the cores between the
potentially parallel sections. While it's typically best to start with
the outer loop (e.g. better have 16 R processes solving relatively
small linear algebra problems back to back than have one R process
spinning 15 of its 16 OpenBLAS threads in sched_yield()), it may be
more efficient to give all 16 threads back to BLAS (and save on
transferring the problems and solutions between processes) once the
problems become large enough to give enough work to all of the cores.

So as a user, I would like an interface that would both let me give all
of the cores to the program if that's what I need (something like
setCPUallowance(parallelly::availableCores())) _and_ let me be more
detailed when necessary (something like setCPUallowance(overall = 7,
packages = c(foobar = 1), BLAS = 2) to limit BLAS threads to 2,
disallow parallelism in the foobar package because it wastes too much
time, and limit R as a whole to 7 cores because I want to surf the 'net
on the remaining one while the Monte-Carlo simulation is going on). As
a package developer, I'd rather not think about any of that and just
use a function call like getCPUallowance() for the default number of
cores in every situation.

Can we implement such an interface? The main obstacle here is not being
able to know when each parallel region beings and ends. Does the
package call fork()? std::thread{}? Start a local mirai cluster? We
have to trust (and verify during R CMD check) the package to create the
given number of units of execution and tells us when they are done.

The closest interface that I see being implementable is a system of
tokens with reference semantics: getCPUallowance() returns a special
object containing the number of tokens the caller is allowed to use and
sets an environment variable with the remaining number of cores. Any R
child processes pick up the number of cores from the environment
variable. Any downstream calls to getCPUallowance(), aware of the
tokens already handed out, return a reduced number of remaining CPU
cores. Once the package is done executing a parallel section, it
returns the CPU allowance back to R by calling something like
close(token), which updates the internal allowance value (and the
environment variable). (A finalizer can also be set on the tokens to
ensure that CPU cores won't be lost.)

Here's a package implementing this idea:
<https://codeberg.org/aitap/R-CPUallowance>. Currently missing are
terrible hacks to determine the BLAS type at runtime and resolve the
necessary symbols to set the number of BLAS threads, depending on
whether it's OpenBLAS, flexiblas, MKL, or something else. Does it feel
over-engineered? I hope that, even if not a good solution, this would
let us move towards a unified solution that could just work? on
everything ranging from laptops to CRAN testing machines to HPCs.

-- 
Best regards,
Ivan

[1] https://stat.ethz.ch/pipermail/r-package-devel/2023q3/009484.html

[2] https://stat.ethz.ch/pipermail/r-package-devel/2023q3/009513.html



From p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org  Wed Oct 25 21:02:00 2023
From: p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org (Plamen Mirazchiyski)
Date: Wed, 25 Oct 2023 21:02:00 +0200
Subject: [R-pkg-devel] "crossprod" is not a BUILTIN function
Message-ID: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>

Dear All,

Today I was preparing a new version for the RALSA package. I have built 
a Windows package using "devtools::check_win_devel()". I took the built 
Windows package and tested it on a Windows 10 machine to see if 
everything works as intended before submitting the source to CRAN. The 
machine has R 4.3.1, the latest official release. After I load the test 
RALSA package, R displays a message saying "Package RALSA built under R 
version 4.4.0", I guess this is what the win-builder uses when the 
source is sent via "devtools::check_win_devel()".

When testing one of the functions of the newly built RALSA package 
(lsa.corsstabs"), it crashes with the following message:

     Error in crossprod(x = sweep(x = as.matrix(replicated.averages),
     MARGIN = 2, : "crossprod" is not a BUILTIN function

I checked if it is a builtin by:

     grep(pattern = "cross", x = builtins(), value = TRUE)

This returned:

     [1] "tcrossprod" "crossprod"

I am not sure I understand, the "crossprod" function is in the base 
package and is builtin in 4.3.1, is it dropped in 4.4.0? If yes, how to 
overcome this?

Please advise.

Best,
Plamen


-- 
======================
Plamen Mirazchiyski, PhD
International Educational Research and Evaluation Institute
24 Tehnolo?ki park
SI-1000 Ljubljana
Slovenia
tel.: +386 51 303 817
email: plamen.mirazchiyski at ineri.org



From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Oct 25 21:19:43 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 25 Oct 2023 15:19:43 -0400
Subject: [R-pkg-devel] "crossprod" is not a BUILTIN function
In-Reply-To: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
References: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
Message-ID: <11c7a422-de08-4ac2-8f39-79ba8e402196@gmail.com>

The sources show that crossprod has become a primitive function. I don't 
think this should affect any R code that calls crossprod(); are you 
trying to call .Internal(crossprod( ... )) directly?

This was in the news a few weeks ago:

"The matrix multiplication functions ?crossprod()? and ?tcrossprod()? 
are now also primitive and S3 generic, as ?%*%? had become in R 4.3.0."

Duncan Murdoch

On 25/10/2023 3:02 p.m., Plamen Mirazchiyski wrote:
> Dear All,
> 
> Today I was preparing a new version for the RALSA package. I have built
> a Windows package using "devtools::check_win_devel()". I took the built
> Windows package and tested it on a Windows 10 machine to see if
> everything works as intended before submitting the source to CRAN. The
> machine has R 4.3.1, the latest official release. After I load the test
> RALSA package, R displays a message saying "Package RALSA built under R
> version 4.4.0", I guess this is what the win-builder uses when the
> source is sent via "devtools::check_win_devel()".
> 
> When testing one of the functions of the newly built RALSA package
> (lsa.corsstabs"), it crashes with the following message:
> 
>       Error in crossprod(x = sweep(x = as.matrix(replicated.averages),
>       MARGIN = 2, : "crossprod" is not a BUILTIN function
> 
> I checked if it is a builtin by:
> 
>       grep(pattern = "cross", x = builtins(), value = TRUE)
> 
> This returned:
> 
>       [1] "tcrossprod" "crossprod"
> 
> I am not sure I understand, the "crossprod" function is in the base
> package and is builtin in 4.3.1, is it dropped in 4.4.0? If yes, how to
> overcome this?
> 
> Please advise.
> 
> Best,
> Plamen
> 
>



From kry|ov@r00t @end|ng |rom gm@||@com  Wed Oct 25 21:26:06 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 25 Oct 2023 22:26:06 +0300
Subject: [R-pkg-devel] "crossprod" is not a BUILTIN function
In-Reply-To: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
References: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
Message-ID: <20231025222606.75c1441b@Tarkus>

? Wed, 25 Oct 2023 21:02:00 +0200
Plamen Mirazchiyski <plamen.mirazchiyski at ineri.org> ?????:

> Today I was preparing a new version for the RALSA package. I have
> built a Windows package using "devtools::check_win_devel()".

> The machine has R 4.3.1, the latest official release. After I load the
> test RALSA package, R displays a message saying "Package RALSA built
> under R version 4.4.0"

Can you use R CMD build to make a .tar.gz source package and then
install that on the Windows 10 machine running R 4.3.1? There is
convenience and a lot of added value in both Win-Builder and devtools,
but it shouldn't be necessary to rely on 96 CRAN packages and an online
service just to build a package.

crossprod(x,y) has indeed been recently changed from
.Internal(crossprod(x, y)) to .Primitive("crossprod"). This makes it
possible for a binary package prepared using R-devel (with a call to
.Primitive('crossprod')) to misbehave on a released version of R (which
does have .Internal(crossprod(...)) but not .Primitive('crossprod')).

Installing from source will avoid this problem. So will building the
binary package using R-4.3.1 to run it on a different machine with
R-4.3.1.



-- 
Best regards,
Ivan



From r@c@rtwr|ght @end|ng |rom gm@||@com  Wed Oct 25 22:54:53 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 25 Oct 2023 13:54:53 -0700
Subject: [R-pkg-devel] RFC: an interface to manage use of parallelism in
 packages
In-Reply-To: <20231025155529.0f83fc93@arachnoid>
References: <20231025155529.0f83fc93@arachnoid>
Message-ID: <CALOkxuyHdA+=ywL5LFhsXbDrtaMz7m2bC8bs8XFmLRjdvT0ssw@mail.gmail.com>

Hi Ivan,

Interesting package, and I'll provide more feedback later. For a
comparison, I'd recommend looking at how GNU make does parallel processing.
It uses the concept of job server and job slots. What I like about it is
that it is implemented at the OS level because make needs to support
interacting with non-make processes. On Windows it uses a named semaphore,
and on Unix-like system it uses named pipes or simple pipes to pass tokens
around.

https://www.gnu.org/software/make/manual/make.html#Job-Slots

Cheers,
Reed


On Wed, Oct 25, 2023 at 5:55?AM Ivan Krylov <krylov.r00t at gmail.com> wrote:

> Summary: at the end of this message is a link to an R package
> implementing an interface for managing the use of execution units in R
> packages. As a package maintainer, would you agree to use something
> like this? Does it look sufficiently reasonable to become a part of R?
> Read on for why I made these particular interface choices.
>
> My understanding of the problem stated by Simon Urbanek and Uwe Ligges
> [1,2] is that we need a way to set and distribute the CPU core
> allowance between multiple packages that could be using very different
> methods to achieve parallel execution on the local machine, including
> threads and child processes. We could have multiple well-meaning
> packages, each of them calling each other using a different parallelism
> technology: imagine parallel::makeCluster(getOption('mc.cores'))
> combined with parallel::mclapply(mc.cores = getOption('mc.cores')) and
> with an OpenMP program that also spawns getOption('mc.cores') threads.
> A parallel BLAS or custom multi-threading using std::thread could add
> more fuel to the fire.
>
> Workarounds applied by the package maintainers nowadays are both
> cumbersome (sometimes one has to talk to some package that lives
> downstream in the call stack and isn't even an explicit dependency,
> because it's the one responsible for the threads) and not really enough
> (most maintainers forget to restore the state after they are done, so a
> single example() may slow down the operations that follow).
>
> The problem is complicated by the fact that not every parallel
> operation can explicitly accept the CPU core limit as a parameter. For
> example, data.table's implicit parallelism is very convenient, and so
> are parallel BLASes (which don't have a standard interface to change
> the number of threads), so we shouldn't be prohibiting implicit
> parallelism.
>
> It's also not always obvious how to split the cores between the
> potentially parallel sections. While it's typically best to start with
> the outer loop (e.g. better have 16 R processes solving relatively
> small linear algebra problems back to back than have one R process
> spinning 15 of its 16 OpenBLAS threads in sched_yield()), it may be
> more efficient to give all 16 threads back to BLAS (and save on
> transferring the problems and solutions between processes) once the
> problems become large enough to give enough work to all of the cores.
>
> So as a user, I would like an interface that would both let me give all
> of the cores to the program if that's what I need (something like
> setCPUallowance(parallelly::availableCores())) _and_ let me be more
> detailed when necessary (something like setCPUallowance(overall = 7,
> packages = c(foobar = 1), BLAS = 2) to limit BLAS threads to 2,
> disallow parallelism in the foobar package because it wastes too much
> time, and limit R as a whole to 7 cores because I want to surf the 'net
> on the remaining one while the Monte-Carlo simulation is going on). As
> a package developer, I'd rather not think about any of that and just
> use a function call like getCPUallowance() for the default number of
> cores in every situation.
>
> Can we implement such an interface? The main obstacle here is not being
> able to know when each parallel region beings and ends. Does the
> package call fork()? std::thread{}? Start a local mirai cluster? We
> have to trust (and verify during R CMD check) the package to create the
> given number of units of execution and tells us when they are done.
>
> The closest interface that I see being implementable is a system of
> tokens with reference semantics: getCPUallowance() returns a special
> object containing the number of tokens the caller is allowed to use and
> sets an environment variable with the remaining number of cores. Any R
> child processes pick up the number of cores from the environment
> variable. Any downstream calls to getCPUallowance(), aware of the
> tokens already handed out, return a reduced number of remaining CPU
> cores. Once the package is done executing a parallel section, it
> returns the CPU allowance back to R by calling something like
> close(token), which updates the internal allowance value (and the
> environment variable). (A finalizer can also be set on the tokens to
> ensure that CPU cores won't be lost.)
>
> Here's a package implementing this idea:
> <
> https://urldefense.com/v3/__https://codeberg.org/aitap/R-CPUallowance__;!!IKRxdwAv5BmarQ!YKbTjFJ7y9HrRl3jgCC0ouo8C5sMSCIkKuIWlUjSZz_B2rehUKl6JefgeeuKrP-46slSQW0dO1VOOWVObOy5GQ$
> >. Currently missing are
> terrible hacks to determine the BLAS type at runtime and resolve the
> necessary symbols to set the number of BLAS threads, depending on
> whether it's OpenBLAS, flexiblas, MKL, or something else. Does it feel
> over-engineered? I hope that, even if not a good solution, this would
> let us move towards a unified solution that could just work? on
> everything ranging from laptops to CRAN testing machines to HPCs.
>
> --
> Best regards,
> Ivan
>
> [1]
> https://urldefense.com/v3/__https://stat.ethz.ch/pipermail/r-package-devel/2023q3/009484.html__;!!IKRxdwAv5BmarQ!YKbTjFJ7y9HrRl3jgCC0ouo8C5sMSCIkKuIWlUjSZz_B2rehUKl6JefgeeuKrP-46slSQW0dO1VOOWUAUyE0DQ$
>
> [2]
> https://urldefense.com/v3/__https://stat.ethz.ch/pipermail/r-package-devel/2023q3/009513.html__;!!IKRxdwAv5BmarQ!YKbTjFJ7y9HrRl3jgCC0ouo8C5sMSCIkKuIWlUjSZz_B2rehUKl6JefgeeuKrP-46slSQW0dO1VOOWWuNYr1EQ$
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!YKbTjFJ7y9HrRl3jgCC0ouo8C5sMSCIkKuIWlUjSZz_B2rehUKl6JefgeeuKrP-46slSQW0dO1VOOWXoVH6F-Q$
>

	[[alternative HTML version deleted]]



From p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org  Thu Oct 26 15:43:54 2023
From: p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org (Plamen Mirazchiyski)
Date: Thu, 26 Oct 2023 15:43:54 +0200
Subject: [R-pkg-devel] "crossprod" is not a BUILTIN function
In-Reply-To: <20231025222606.75c1441b@Tarkus>
References: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
 <20231025222606.75c1441b@Tarkus>
Message-ID: <5e18d662-4f16-4f78-afa9-533fe779cd75@ineri.org>

Thank you very much for your responses Duncan and Ivan.

I do not call .Internal(crossprod( ... )) directly. I use crossprod() 
just once in the entire package, the actual line of code is

unname(obj = crossprod(x = sweep(x = as.matrix(replicated.averages), 
MARGIN = 2, mean.replicate.averages, FUN = "-"))*des.scale.fac)

I followed Ivan's advice, built a binary package from source in R 4.3.1 
on Windows 10, then tested it on another Windows 10 machine with R 
4.3.1. The problem did not occur et all.

If I understand Ivan's email, my package should work on R 4.3.1, but 
what about newer versions? I checked some packages that were released 
today, e.g. abn, these were built by CRAN "using R Under development 
(unstable) (2023-10-24 r85407 ucrt)". Does this mean mine will fail on 
the current released version (4.3.1) if built by CRAN. As far as I see 
from the R Developer Page (https://developer.r-project.org), there is a 
new version (4.3.2) scheduled for October 31, 2023. Should I better wait 
until then?

Best,
Plamen

On 10/25/23 21:26, Ivan Krylov wrote:
> ? Wed, 25 Oct 2023 21:02:00 +0200
> Plamen Mirazchiyski <plamen.mirazchiyski at ineri.org> ?????:
> 
>> Today I was preparing a new version for the RALSA package. I have
>> built a Windows package using "devtools::check_win_devel()".
> 
>> The machine has R 4.3.1, the latest official release. After I load the
>> test RALSA package, R displays a message saying "Package RALSA built
>> under R version 4.4.0"
> 
> Can you use R CMD build to make a .tar.gz source package and then
> install that on the Windows 10 machine running R 4.3.1? There is
> convenience and a lot of added value in both Win-Builder and devtools,
> but it shouldn't be necessary to rely on 96 CRAN packages and an online
> service just to build a package.
> 
> crossprod(x,y) has indeed been recently changed from
> .Internal(crossprod(x, y)) to .Primitive("crossprod"). This makes it
> possible for a binary package prepared using R-devel (with a call to
> .Primitive('crossprod')) to misbehave on a released version of R (which
> does have .Internal(crossprod(...)) but not .Primitive('crossprod')).
> 
> Installing from source will avoid this problem. So will building the
> binary package using R-4.3.1 to run it on a different machine with
> R-4.3.1.
> 
> 
> 

-- 
======================
Plamen Mirazchiyski, PhD
International Educational Research and Evaluation Institute
24 Tehnolo?ki park
SI-1000 Ljubljana
Slovenia
tel.: +386 51 303 817
email: plamen.mirazchiyski at ineri.org



From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Oct 26 16:10:20 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 26 Oct 2023 10:10:20 -0400
Subject: [R-pkg-devel] "crossprod" is not a BUILTIN function
In-Reply-To: <5e18d662-4f16-4f78-afa9-533fe779cd75@ineri.org>
References: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
 <20231025222606.75c1441b@Tarkus>
 <5e18d662-4f16-4f78-afa9-533fe779cd75@ineri.org>
Message-ID: <456f84d8-e665-4269-9ab4-496b5cc06528@gmail.com>

There are two kinds of builds:  source builds (producing the .tar.gz 
file) and binary builds (producing the .zip file on Windows).  Binary 
builds are specific to R minor versions:  if you build on R version 
x.y.z, you can't expect the package to work if either x or y changes.

Source builds should work on other R versions, though sometimes moving 
to earlier versions will cause problems (because the format of files in 
the .tar.gz file may have changed), or your package relies on features 
that weren't present earlier.  Generally .tar.gz files will work on 
later versions (though changes in R might break it).

So if you did a binary build on R 4.4.x and tested it on R 4.3.1, it's 
not at all surprising that it failed.  If you did a source build on R 
4.4.x and it failed on R 4.3.1, that's more surprising.

Duncan Murdoch

On 26/10/2023 9:43 a.m., Plamen Mirazchiyski wrote:
> Thank you very much for your responses Duncan and Ivan.
> 
> I do not call .Internal(crossprod( ... )) directly. I use crossprod()
> just once in the entire package, the actual line of code is
> 
> unname(obj = crossprod(x = sweep(x = as.matrix(replicated.averages),
> MARGIN = 2, mean.replicate.averages, FUN = "-"))*des.scale.fac)
> 
> I followed Ivan's advice, built a binary package from source in R 4.3.1
> on Windows 10, then tested it on another Windows 10 machine with R
> 4.3.1. The problem did not occur et all.
> 
> If I understand Ivan's email, my package should work on R 4.3.1, but
> what about newer versions? I checked some packages that were released
> today, e.g. abn, these were built by CRAN "using R Under development
> (unstable) (2023-10-24 r85407 ucrt)". Does this mean mine will fail on
> the current released version (4.3.1) if built by CRAN. As far as I see
> from the R Developer Page (https://developer.r-project.org), there is a
> new version (4.3.2) scheduled for October 31, 2023. Should I better wait
> until then?
> 
> Best,
> Plamen
> 
> On 10/25/23 21:26, Ivan Krylov wrote:
>> ? Wed, 25 Oct 2023 21:02:00 +0200
>> Plamen Mirazchiyski <plamen.mirazchiyski at ineri.org> ?????:
>>
>>> Today I was preparing a new version for the RALSA package. I have
>>> built a Windows package using "devtools::check_win_devel()".
>>
>>> The machine has R 4.3.1, the latest official release. After I load the
>>> test RALSA package, R displays a message saying "Package RALSA built
>>> under R version 4.4.0"
>>
>> Can you use R CMD build to make a .tar.gz source package and then
>> install that on the Windows 10 machine running R 4.3.1? There is
>> convenience and a lot of added value in both Win-Builder and devtools,
>> but it shouldn't be necessary to rely on 96 CRAN packages and an online
>> service just to build a package.
>>
>> crossprod(x,y) has indeed been recently changed from
>> .Internal(crossprod(x, y)) to .Primitive("crossprod"). This makes it
>> possible for a binary package prepared using R-devel (with a call to
>> .Primitive('crossprod')) to misbehave on a released version of R (which
>> does have .Internal(crossprod(...)) but not .Primitive('crossprod')).
>>
>> Installing from source will avoid this problem. So will building the
>> binary package using R-4.3.1 to run it on a different machine with
>> R-4.3.1.
>>
>>
>>
>



From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct 26 16:20:29 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 26 Oct 2023 17:20:29 +0300
Subject: [R-pkg-devel] "crossprod" is not a BUILTIN function
In-Reply-To: <5e18d662-4f16-4f78-afa9-533fe779cd75@ineri.org>
References: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
 <20231025222606.75c1441b@Tarkus>
 <5e18d662-4f16-4f78-afa9-533fe779cd75@ineri.org>
Message-ID: <20231026172029.70d39e6a@arachnoid>

? Thu, 26 Oct 2023 15:43:54 +0200
Plamen Mirazchiyski <plamen.mirazchiyski at ineri.org> ?????:

> If I understand Ivan's email, my package should work on R 4.3.1, but 
> what about newer versions?

The source package (the .tar.gz file obtained using R CMD build) will
keep working fine on both R 4.3 and R 4.4.

The binary package (the .zip file obtained using R CMD INSTALL --build
and produced on Win-Builder) is only guaranteed to work with the R
version that was used to build the binary package.

This is the reason why https://CRAN.R-project.org/package=RALSA offers
a single download of the source package...

>> Package source: 	RALSA_1.3.5.tar.gz

...but multiple, separate downloads of binary versions of the package,
for R-4.4, R-4.3, and R-4.2:

>> Windows binaries: 	r-devel: RALSA_1.3.5.zip, r-release:
>> RALSA_1.3.5.zip, r-oldrel: RALSA_1.3.5.zip

-- 
Best regards,
Ivan



From p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org  Thu Oct 26 17:12:43 2023
From: p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org (Plamen Mirazchiyski)
Date: Thu, 26 Oct 2023 17:12:43 +0200
Subject: [R-pkg-devel] "crossprod" is not a BUILTIN function
In-Reply-To: <20231026172029.70d39e6a@arachnoid>
References: <f4cabddb-c2a7-4bfb-a012-18e09b06296a@ineri.org>
 <20231025222606.75c1441b@Tarkus>
 <5e18d662-4f16-4f78-afa9-533fe779cd75@ineri.org>
 <20231026172029.70d39e6a@arachnoid>
Message-ID: <008ede18-04ec-4a68-91cd-82b46ccfad56@ineri.org>

I apologize for misreading Ivan's first email. I now installed from the 
tar.gz source file, everything worked as expected.

Thank you both for the thorough explanations.

Best,
Plamen

On 10/26/23 16:20, Ivan Krylov wrote:
> ? Thu, 26 Oct 2023 15:43:54 +0200
> Plamen Mirazchiyski <plamen.mirazchiyski at ineri.org> ?????:
> 
>> If I understand Ivan's email, my package should work on R 4.3.1, but
>> what about newer versions?
> 
> The source package (the .tar.gz file obtained using R CMD build) will
> keep working fine on both R 4.3 and R 4.4.
> 
> The binary package (the .zip file obtained using R CMD INSTALL --build
> and produced on Win-Builder) is only guaranteed to work with the R
> version that was used to build the binary package.
> 
> This is the reason why https://CRAN.R-project.org/package=RALSA offers
> a single download of the source package...
> 
>>> Package source: 	RALSA_1.3.5.tar.gz
> 
> ...but multiple, separate downloads of binary versions of the package,
> for R-4.4, R-4.3, and R-4.2:
> 
>>> Windows binaries: 	r-devel: RALSA_1.3.5.zip, r-release:
>>> RALSA_1.3.5.zip, r-oldrel: RALSA_1.3.5.zip
> 

-- 
======================
Plamen Mirazchiyski, PhD
International Educational Research and Evaluation Institute
24 Tehnolo?ki park
SI-1000 Ljubljana
Slovenia
tel.: +386 51 303 817
email: plamen.mirazchiyski at ineri.org



From co|denjoh@n@on @end|ng |rom gm@||@com  Thu Oct 26 17:14:15 2023
From: co|denjoh@n@on @end|ng |rom gm@||@com (Cole Johanson)
Date: Thu, 26 Oct 2023 11:14:15 -0400
Subject: [R-pkg-devel] API client package failing due to API authentication
Message-ID: <CABm0ymkJvxQPL7eqOjbhvJJHrPYzQc8dJcMmvQJUsRD0GOqLqg@mail.gmail.com>

Hello,

My package https://github.com/cole-johanson/smartsheetr requires an
environment variable, the API access token, to run most of the functions.
The steps for setting this are documented in the README, but my package is
being auto-rejected by CRAN for failing the examples.

I have wrapped the examples with the roxygen2 tag *\dontrun*, but it is
still attempting to run the examples.

Should I report this as a false positive, or is there a step I am missing?

Thank you!

	[[alternative HTML version deleted]]



From kry|ov@r00t @end|ng |rom gm@||@com  Thu Oct 26 18:30:29 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 26 Oct 2023 19:30:29 +0300
Subject: [R-pkg-devel] 
 API client package failing due to API authentication
In-Reply-To: <CABm0ymkJvxQPL7eqOjbhvJJHrPYzQc8dJcMmvQJUsRD0GOqLqg@mail.gmail.com>
References: <CABm0ymkJvxQPL7eqOjbhvJJHrPYzQc8dJcMmvQJUsRD0GOqLqg@mail.gmail.com>
Message-ID: <20231026193029.7c685302@arachnoid>

? Thu, 26 Oct 2023 11:14:15 -0400
Cole Johanson <coldenjohanson at gmail.com> ?????:

> I have wrapped the examples with the roxygen2 tag *\dontrun*, but it
> is still attempting to run the examples.

Judging by the latest commit at
<https://github.com/cole-johanson/smartsheetr/commit/5e4f8fb23b1f9d91c5941d9f116f7f076d785d8f>,
you forgot to run roxygen2::roxygenise() to regenerate the man/*.Rd
files (which is what R cares about). Your use of the Rd tag \dontrun{}
is otherwise fine and should prevent the code from being run.

I am not sure whether it's acceptable to \dontrun{} every possible test
and example, but if the code useless without a valid API key, so be it.
Maybe you could write your examples in
if(nzchar(getenv('SMARTSHEET_API_TOKEN'))) withAutoprint({ ... })
instead to make it possible to run

SMARTSHEET_API_TOKEN=YOURTOKEN R CMD check shartsheetr*.tar.gz

...and have all the tests run, the way your CI is currently set up.

-- 
Best regards,
Ivan



From edd @end|ng |rom deb|@n@org  Thu Oct 26 18:37:37 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 26 Oct 2023 11:37:37 -0500
Subject: [R-pkg-devel] 
 API client package failing due to API authentication
In-Reply-To: <CABm0ymkJvxQPL7eqOjbhvJJHrPYzQc8dJcMmvQJUsRD0GOqLqg@mail.gmail.com>
References: <CABm0ymkJvxQPL7eqOjbhvJJHrPYzQc8dJcMmvQJUsRD0GOqLqg@mail.gmail.com>
Message-ID: <25914.38353.610417.230351@rob.eddelbuettel.com>


On 26 October 2023 at 11:14, Cole Johanson wrote:
| My package https://github.com/cole-johanson/smartsheetr requires an
| environment variable, the API access token, to run most of the functions.
| The steps for setting this are documented in the README, but my package is
| being auto-rejected by CRAN for failing the examples.
| 
| I have wrapped the examples with the roxygen2 tag *\dontrun*, but it is
| still attempting to run the examples.
| 
| Should I report this as a false positive, or is there a step I am missing?

You should not attempt to run the examples when they could fail e.g. when no
API key is present as it the case for CRAN.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From co|denjoh@n@on @end|ng |rom gm@||@com  Thu Oct 26 19:32:32 2023
From: co|denjoh@n@on @end|ng |rom gm@||@com (Cole Johanson)
Date: Thu, 26 Oct 2023 13:32:32 -0400
Subject: [R-pkg-devel] 
 API client package failing due to API authentication
In-Reply-To: <20231026193029.7c685302@arachnoid>
References: <CABm0ymkJvxQPL7eqOjbhvJJHrPYzQc8dJcMmvQJUsRD0GOqLqg@mail.gmail.com>
 <20231026193029.7c685302@arachnoid>
Message-ID: <CABm0ymkbL-sGSoan7V_HkcewA=YA_AZJ6_SoKe0ShvnFZZON3g@mail.gmail.com>

Thank you. I did forget to re-document. I appreciate the help!

On Thu, Oct 26, 2023 at 12:30?PM Ivan Krylov <krylov.r00t at gmail.com> wrote:

> ? Thu, 26 Oct 2023 11:14:15 -0400
> Cole Johanson <coldenjohanson at gmail.com> ?????:
>
> > I have wrapped the examples with the roxygen2 tag *\dontrun*, but it
> > is still attempting to run the examples.
>
> Judging by the latest commit at
> <
> https://github.com/cole-johanson/smartsheetr/commit/5e4f8fb23b1f9d91c5941d9f116f7f076d785d8f
> >,
> you forgot to run roxygen2::roxygenise() to regenerate the man/*.Rd
> files (which is what R cares about). Your use of the Rd tag \dontrun{}
> is otherwise fine and should prevent the code from being run.
>
> I am not sure whether it's acceptable to \dontrun{} every possible test
> and example, but if the code useless without a valid API key, so be it.
> Maybe you could write your examples in
> if(nzchar(getenv('SMARTSHEET_API_TOKEN'))) withAutoprint({ ... })
> instead to make it possible to run
>
> SMARTSHEET_API_TOKEN=YOURTOKEN R CMD check shartsheetr*.tar.gz
>
> ...and have all the tests run, the way your CI is currently set up.
>
> --
> Best regards,
> Ivan
>

	[[alternative HTML version deleted]]



From edd @end|ng |rom deb|@n@org  Fri Oct 27 14:42:33 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 27 Oct 2023 07:42:33 -0500
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <PAXPR05MB86503FBDDAD830F994370F15F8DEA@PAXPR05MB8650.eurprd05.prod.outlook.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
 <25911.50044.191576.935725@rob.eddelbuettel.com>
 <25912.60834.927280.904009@rob.eddelbuettel.com>
 <PAXPR05MB86503FBDDAD830F994370F15F8DEA@PAXPR05MB8650.eurprd05.prod.outlook.com>
Message-ID: <25915.45113.620644.457220@rob.eddelbuettel.com>


Jouni,

My CRANberriesFeed reports a new bssm package at CRAN, congratulations for
sorting this out. [1,2] The OMP_NUM_THREADS setting is indeed all it takes,
and it _does_ seem to be read even from a running session: i.e. you can set
this inside an R session and the OpenMP code considers it in the same
process. Good!

As some of us mentioned, your usage pattern of setting
'Sys.setenv("OMP_NUM_THREADS" = 2)' everywhere _leaves_ that value so you
permanently ham-string the behaviour of a session which runs an example or
test of your package: the same session will never get back to 'all cores' by
itself so adding a resetter to the initial value (maybe via on.exit()) may be
a good idea for the next package revision if you have any energy left for
this question :)

Again, congrats for sorting it out, and sorry for the trouble. I long argued
CRAN should set the behaviour-defining environment variable, that
OMP_NUM_THREADS, for the tests and examples it wants to run under reduced
load.  Alas, that's not where we ended up.

Cheers,  Dirk

[1] http://dirk.eddelbuettel.com/cranberries/2023/10/27#bssm_2.0.2

[2] Your NEWS file calls this 'fix weird CRAN issues with parallelisation on
Debian.'. There is nothing 'weird' here (it behaves as designed, computers do
that to us), and it is not just on Debian but on any system where the build
has a) access to OpenMP so uses it and b) measures real time to elapsed time
with a cap of 2 as CRAN does.

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From joun|@he|@ke @end|ng |rom jyu@||  Fri Oct 27 15:02:35 2023
From: joun|@he|@ke @end|ng |rom jyu@|| (Helske, Jouni)
Date: Fri, 27 Oct 2023 13:02:35 +0000
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <25915.45113.620644.457220@rob.eddelbuettel.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
 <25911.50044.191576.935725@rob.eddelbuettel.com>
 <25912.60834.927280.904009@rob.eddelbuettel.com>
 <PAXPR05MB86503FBDDAD830F994370F15F8DEA@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <25915.45113.620644.457220@rob.eddelbuettel.com>
Message-ID: <PAXPR05MB8650D20B7B03525921A0C625F8DCA@PAXPR05MB8650.eurprd05.prod.outlook.com>

Hi Dirk,

Actually, the OMP_NUM_THREADS worked for vignettes and testthat tests, but didn't help with the examples. However, I just wrapped the problematic example with \donttest as for some reason this issue only happened with a single seemingly simple example (hence the "weird" in the earlier NEWS due to frustration, I changed this to the CRAN version).

Thanks for reminding me about the resetting the number of cores, will fix that to the next version.

Best,
Jouni


________________________________
From: Dirk Eddelbuettel <edd at debian.org>
Sent: Friday, October 27, 2023 15:42
To: Helske, Jouni <jouni.helske at jyu.fi>
Cc: Dirk Eddelbuettel <edd at debian.org>; Ivan Krylov <krylov.r00t at gmail.com>; r-package-devel at r-project.org <r-package-devel at r-project.org>; Conrad Sanderson <conradsand at gmail.com>
Subject: Re: [R-pkg-devel] Too many cores used in examples (not caused by data.table)


Jouni,

My CRANberriesFeed reports a new bssm package at CRAN, congratulations for
sorting this out. [1,2] The OMP_NUM_THREADS setting is indeed all it takes,
and it _does_ seem to be read even from a running session: i.e. you can set
this inside an R session and the OpenMP code considers it in the same
process. Good!

As some of us mentioned, your usage pattern of setting
'Sys.setenv("OMP_NUM_THREADS" = 2)' everywhere _leaves_ that value so you
permanently ham-string the behaviour of a session which runs an example or
test of your package: the same session will never get back to 'all cores' by
itself so adding a resetter to the initial value (maybe via on.exit()) may be
a good idea for the next package revision if you have any energy left for
this question :)

Again, congrats for sorting it out, and sorry for the trouble. I long argued
CRAN should set the behaviour-defining environment variable, that
OMP_NUM_THREADS, for the tests and examples it wants to run under reduced
load.  Alas, that's not where we ended up.

Cheers,  Dirk

[1] https://eur03.safelinks.protection.outlook.com/?url=http%3A%2F%2Fdirk.eddelbuettel.com%2Fcranberries%2F2023%2F10%2F27%23bssm_2.0.2&data=05%7C01%7Cjovetale%40jyu.mail.onmicrosoft.com%7Caf8b71968c244eb46b6f08dbd6ea3439%7Ce9662d58caa44bc1b138c8b1acab5a11%7C1%7C0%7C638340073635955909%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=mokRvujnBW6XNQPi3fSw6MNJt3Qi2BgNGRwF3dlzNyo%3D&reserved=0<http://dirk.eddelbuettel.com/cranberries/2023/10/27#bssm_2.0.2>

[2] Your NEWS file calls this 'fix weird CRAN issues with parallelisation on
Debian.'. There is nothing 'weird' here (it behaves as designed, computers do
that to us), and it is not just on Debian but on any system where the build
has a) access to OpenMP so uses it and b) measures real time to elapsed time
with a cap of 2 as CRAN does.

--
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

	[[alternative HTML version deleted]]



From edd @end|ng |rom deb|@n@org  Fri Oct 27 15:28:37 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 27 Oct 2023 08:28:37 -0500
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <PAXPR05MB8650D20B7B03525921A0C625F8DCA@PAXPR05MB8650.eurprd05.prod.outlook.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
 <25911.50044.191576.935725@rob.eddelbuettel.com>
 <25912.60834.927280.904009@rob.eddelbuettel.com>
 <PAXPR05MB86503FBDDAD830F994370F15F8DEA@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <25915.45113.620644.457220@rob.eddelbuettel.com>
 <PAXPR05MB8650D20B7B03525921A0C625F8DCA@PAXPR05MB8650.eurprd05.prod.outlook.com>
Message-ID: <25915.47877.682477.358138@rob.eddelbuettel.com>


Hi Jouni,

On 27 October 2023 at 13:02, Helske, Jouni wrote:
| Actually, the OMP_NUM_THREADS worked for vignettes and testthat tests, but
| didn't help with the examples. However, I just wrapped the problematic example

Now I am confused.

What is your understanding of why it helps in one place and not the other?

| with \donttest as for some reason this issue only happened with a single
| seemingly simple example (hence the "weird" in the earlier NEWS due to
| frustration, I changed this to the CRAN version).
| 
| Thanks for reminding me about the resetting the number of cores, will fix that
| to the next version.

I have an idea for a RcppArmadillo-based helper function. We can save the
initial values of the environment variable in .onLoad and cache it. A simple
helper function pair can then dial the environment variable down and reset it
to the cached value.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From joun|@he|@ke @end|ng |rom jyu@||  Mon Oct 30 09:18:55 2023
From: joun|@he|@ke @end|ng |rom jyu@|| (Helske, Jouni)
Date: Mon, 30 Oct 2023 08:18:55 +0000
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <25915.47877.682477.358138@rob.eddelbuettel.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
 <25911.50044.191576.935725@rob.eddelbuettel.com>
 <25912.60834.927280.904009@rob.eddelbuettel.com>
 <PAXPR05MB86503FBDDAD830F994370F15F8DEA@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <25915.45113.620644.457220@rob.eddelbuettel.com>
 <PAXPR05MB8650D20B7B03525921A0C625F8DCA@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <25915.47877.682477.358138@rob.eddelbuettel.com>
Message-ID: <PAXPR05MB8650D4DCD7E8CE6B81BF656FF8A1A@PAXPR05MB8650.eurprd05.prod.outlook.com>

Hi Dirk,

Looking more closely earlier failures, vignettes have always worked fine but the note on tests said that the CPU time was only 2.7 times over elapsed time, so maybe I was just lucky this time and got under 2.5. ;) Or testthat does something special...

Jouni
________________________________
From: Dirk Eddelbuettel <edd at debian.org>
Sent: Friday, October 27, 2023 16:28
To: Helske, Jouni <jouni.helske at jyu.fi>
Cc: Dirk Eddelbuettel <edd at debian.org>; Ivan Krylov <krylov.r00t at gmail.com>; r-package-devel at r-project.org <r-package-devel at r-project.org>; Conrad Sanderson <conradsand at gmail.com>
Subject: Re: [R-pkg-devel] Too many cores used in examples (not caused by data.table)


Hi Jouni,

On 27 October 2023 at 13:02, Helske, Jouni wrote:
| Actually, the OMP_NUM_THREADS worked for vignettes and testthat tests, but
| didn't help with the examples. However, I just wrapped the problematic example

Now I am confused.

What is your understanding of why it helps in one place and not the other?

| with \donttest as for some reason this issue only happened with a single
| seemingly simple example (hence the "weird" in the earlier NEWS due to
| frustration, I changed this to the CRAN version).
|
| Thanks for reminding me about the resetting the number of cores, will fix that
| to the next version.

I have an idea for a RcppArmadillo-based helper function. We can save the
initial values of the environment variable in .onLoad and cache it. A simple
helper function pair can then dial the environment variable down and reset it
to the cached value.

Dirk

--
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

	[[alternative HTML version deleted]]



From edd @end|ng |rom deb|@n@org  Mon Oct 30 14:51:41 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 30 Oct 2023 08:51:41 -0500
Subject: [R-pkg-devel] Too many cores used in examples (not caused by
 data.table)
In-Reply-To: <PAXPR05MB8650D4DCD7E8CE6B81BF656FF8A1A@PAXPR05MB8650.eurprd05.prod.outlook.com>
References: <PAXPR05MB8650BE166314CEAA80059BBEF8D4A@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <20231020165437.31a89982@arachnoid>
 <DB9PR05MB8654939D929CAAB4108487D3F8D8A@DB9PR05MB8654.eurprd05.prod.outlook.com>
 <20231024155516.3b45000f@arachnoid>
 <25911.50044.191576.935725@rob.eddelbuettel.com>
 <25912.60834.927280.904009@rob.eddelbuettel.com>
 <PAXPR05MB86503FBDDAD830F994370F15F8DEA@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <25915.45113.620644.457220@rob.eddelbuettel.com>
 <PAXPR05MB8650D20B7B03525921A0C625F8DCA@PAXPR05MB8650.eurprd05.prod.outlook.com>
 <25915.47877.682477.358138@rob.eddelbuettel.com>
 <PAXPR05MB8650D4DCD7E8CE6B81BF656FF8A1A@PAXPR05MB8650.eurprd05.prod.outlook.com>
Message-ID: <25919.46317.114330.265229@rob.eddelbuettel.com>


I have some better news.  While we established that 'in theory' setting the
environment variable OMP_NUM_THREADS would help (and I maintain that it is a
great PITA that CRAN does not do so as a general fix for this issue) it does
*not help* once R is started.  OpenMP only considers the variable once at
startup and does not re-read it.  So we cannot set from R once R has started.

But OpenMP offers a setter (and a getter) for the thread count value.

And using it addresses the issue.  I created a demo package [1] which, when
running on a system with both OpenMP and 'enough cores' (any modern machine
will do) exhibits the warning from R CMD check --as-cran with timing enabled
(i.e. env vars set).  When an additional environment variable 'SHOWME' is set
to 'yes', it successfully throttles via the exposed OpenMP setter.  In our
example, Armadillo uses it to calibrate its thread use, a lower setting is
followed, and the warning is gone.

I will add more convenient wrappers to RcppArmadillo itself. These are
currently in a branch [2] and their use is illustrated in the help page and
example of fastLm demo function [3].  I plan to make a new RcppArmadillo
release with this change in the coming days, the setter and re-setter will
work for any OpenMP threading changes. So if you use RcppArmadillo, this
should help. (And of course there always was RhpcBLASctl doing this too.)

Dirk

[1] https://github.com/eddelbuettel/rcpparmadilloopenmpex
[2] https://github.com/RcppCore/RcppArmadillo/tree/feature/thread_throttle\
[3] https://github.com/RcppCore/RcppArmadillo/blob/a8db424bd6aaeda2ceb897142d3c366d9c6591c7/man/fastLm.Rd#L72-L98
[4] https://cran.r-project.org/package=RhpcBLASctl

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r  Mon Oct 30 15:58:31 2023
From: rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r (Romain Pierlot)
Date: Mon, 30 Oct 2023 15:58:31 +0100 (CET)
Subject: [R-pkg-devel] Issue with R Package on CRAN - OpenMP and clang17
Message-ID: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>

Hi there, 

I'm sorry to disturb, I hope I send a mail at the right place. 





I have been encountering a challenge with an R package that I've been working on, which was recently removed from CRAN due to some issues in Fortran. 

It appears that I have addressed the Fortran issues, but upon resubmission to CRAN, the package was not accepted, and the following error was returned : 


''With clang17 it still fails to install: 

error: loc("/data/gannet/ripley/R/packages/incoming/frailtypack.Rcheck/00_pkg_src/frailtypack/src/Integrale_mult_scl.f90":1811:17): 'omp.reduction' op must be used within an operation supporting reduction clause interface 
error: verification of lowering to FIR failed 

LLVM trunk gives the same error. 
'' 




I have attached the portion of the code where this issue is reported. From my understanding, it appears to be related to parallelization, but I have been unable to resolve it on my own. 

I would greatly appreciate any assistance or advice that you might be able to offer. If you require any additional information, please do not hesitate to let me know. 




Moreover, I don't know if it is normal or not, but when I check my package with R CMD chech --as-cran, I don't have any error or note message. But when I submit the package to the CRAN, they return errors and notes. 








Thank you very much for your time and consideration. 




Best regards, 




Romain Pierlot 


-- 
[ https://www.u-bordeaux.fr/ ] [ http://www.aquitaine-poitou-charentes.inserm.fr/ ] 

[ mailto: | Romain Pierlot ] 
Ing?nieur de recherches Bio-Informatique 
?quipe BIOSTAT 


[ https://www.u-bordeaux.fr/ | https://www.u-bordeaux.fr ] 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Fortran error frailtypack.png
Type: image/png
Size: 157561 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20231030/e6abc3d3/attachment-0002.png>

From kry|ov@r00t @end|ng |rom gm@||@com  Mon Oct 30 16:52:29 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 30 Oct 2023 18:52:29 +0300
Subject: [R-pkg-devel] Issue with R Package on CRAN - OpenMP and clang17
In-Reply-To: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
References: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
Message-ID: <20231030185229.385fe389@arachnoid>

? Mon, 30 Oct 2023 15:58:31 +0100 (CET)
Romain Pierlot <romain.pierlot at u-bordeaux.fr> ?????:

> I'm sorry to disturb, I hope I send a mail at the right place. 

This is exactly the right place to ask. Welcome to R-package-devel!

> It appears that I have addressed the Fortran issues, but upon
> resubmission to CRAN, the package was not accepted, and the following
> error was returned : 
> 
> 
> ''With clang17 it still fails to install: 
> 
> error:
> loc("/data/gannet/ripley/R/packages/incoming/frailtypack.Rcheck/00_pkg_src/frailtypack/src/Integrale_mult_scl.f90":1811:17):
> 'omp.reduction' op must be used within an operation supporting
> reduction clause interface error: verification of lowering to FIR
> failed 
> 
> LLVM trunk gives the same error. 
> '' 

I'm not 100% sure, but I currently think that this is a compiler bug.

You have a variable, ss, declared inside a function.

If nb_procs==1, you start an OpenMP parallel region with a reduction on
that variable. The OpenMP parallel region starts and ends inside that
if clause. Outside the parallel region, in another branch, you add to
it as usual.

Flang-new complains about your use of the 'ss' variable outside the
parallel region, alleging that it's not valid for an OpenMP reduction.
There is no OpenMP reduction in sight where the error is reported. I
think that Flang-new is wrong to signal an error here.

Unfortunately, proving that this is a compiler bug might be hard. I'll
try to reproduce your problem, starting by downloading and compiling
flang from https://github.com/llvm/llvm-project.git commit
092b6c5ee3707ea10b9f10d0a674e8d12395369b (as stated at
<https://www.stats.ox.ac.uk/pub/bdr/clang17/frailtypack.log>). I hope
it will be possible to simplify Integrale_mult_scl.f90 until it looks
manageable for their bug tracker.

> Moreover, I don't know if it is normal or not, but when I check my
> package with R CMD chech --as-cran, I don't have any error or note
> message. But when I submit the package to the CRAN, they return
> errors and notes. 

These errors only happen with the "flang-new" Fortran compiler that's
part of the LLVM compiler infrastructure. You're probably using
gfortran or some other, more well-polished Fortran compiler.

-- 
Best regards,
Ivan



From m@rku@joch|m @end|ng |rom phonet|k@un|-muenchen@de  Mon Oct 30 17:12:50 2023
From: m@rku@joch|m @end|ng |rom phonet|k@un|-muenchen@de (Markus Jochim)
Date: Mon, 30 Oct 2023 17:12:50 +0100
Subject: [R-pkg-devel] Recent dev version of R CMD check fails when a
 package function named X also has a parameter named X
Message-ID: <fb6e9cba-df63-4d02-96b2-83e7b0f66955@phonetik.uni-muenchen.de>

Hi R people,

I am the maintainer of the emuR package and I am having a problem with 
recent versions of R CMD check.

CRAN?s r-devel test suites [1] have started to emit a NOTE about the 
HTML version of the manual:

> Version: 2.4.1
> Check: HTML version of manual
> Result: NOTE
> ??? Found the following HTML validation problems:
> ??? query.html:50:9 (query.Rd:22): Warning: <code> anchor "query" 
> already defined
> Flavors: r-devel-linux-x86_64-debian-clang, 
> r-devel-linux-x86_64-debian-gcc, r-devel-linux-x86_64-fedora-clang, 
> r-devel-linux-x86_64-fedora-gcc, r-devel-windows-x86_64
>
This is caused by one of my package?s functions that is named query and 
also has a parameter named query.

I think I have tracked this down to SVN revision r85407 of R. With 
earlier versions:

R CMD Rdconv -t html query.Rd

would output (line 50, as referenced by the NOTE):

<tr><td><code id="query_:_query">query</code></td>

But newer versions output:

<tr><td><code id="query">query</code></td>

Notice the difference in id. The id "query" appears both here and 
further up in the file, specifically in the h2 heading. This triggers 
the HTML validation problem. I suppose this is a bug in the experimental 
table of contents feature? As such, should I rather post this to R-devel?

Unfortunately, this also prevents me from uploading a new version of my 
package, since it does not get past CRAN?s automatic pretest. Can I 
resubmit my new version and simply state in the comments that I cannot 
fix the NOTE from r-devel at this point? Or should I rather wait until 
this is changed upstream? (the described NOTE is the only complaint from 
the pretest). Changing the function or parameter name is not an option, 
they have been used in this package ever since it was released a couple 
of years ago.

This NOTE can also be reproduced with a minimal R package that has 
nothing but a hello function with a parameter named hello.

Thanks for reading this. I appreciate any help.

Markus


Institute for Phonetics and Speech Processing

Ludwig-Maximilians-Universit?t M?nchen

https://www.phonetik.uni-muenchen.de


[1] https://cran.rstudio.com//web/checks/check_results_emuR.html



From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Mon Oct 30 19:42:14 2023
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Mon, 30 Oct 2023 14:42:14 -0400
Subject: [R-pkg-devel] Recent dev version of R CMD check fails when a
 package function named X also has a parameter named X
In-Reply-To: <fb6e9cba-df63-4d02-96b2-83e7b0f66955@phonetik.uni-muenchen.de>
References: <fb6e9cba-df63-4d02-96b2-83e7b0f66955@phonetik.uni-muenchen.de>
Message-ID: <CADfFDC4goQOcgUih=K85r_npeAzyTyP9mENDLKBYo6eGofcPyQ@mail.gmail.com>

On Mon, 30 Oct 2023 at 12:48, Markus Jochim
<markusjochim at phonetik.uni-muenchen.de> wrote:
>
> Hi R people,
>
> I am the maintainer of the emuR package and I am having a problem with
> recent versions of R CMD check.
>
> CRAN?s r-devel test suites [1] have started to emit a NOTE about the
> HTML version of the manual:
>
> > Version: 2.4.1
> > Check: HTML version of manual
> > Result: NOTE
> >     Found the following HTML validation problems:
> >     query.html:50:9 (query.Rd:22): Warning: <code> anchor "query"
> > already defined
> > Flavors: r-devel-linux-x86_64-debian-clang,
> > r-devel-linux-x86_64-debian-gcc, r-devel-linux-x86_64-fedora-clang,
> > r-devel-linux-x86_64-fedora-gcc, r-devel-windows-x86_64
> >
> This is caused by one of my package?s functions that is named query and
> also has a parameter named query.
>
> I think I have tracked this down to SVN revision r85407 of R. With
> earlier versions:
>
> R CMD Rdconv -t html query.Rd
>
> would output (line 50, as referenced by the NOTE):
>
> <tr><td><code id="query_:_query">query</code></td>
>
> But newer versions output:
>
> <tr><td><code id="query">query</code></td>

Yes, sorry, my bad.

r85440 (just committed) should have a temporary fix by omitting the id
from the <h2> title. Please let me know if problems still persist.

Best,
-Deepayan

> Notice the difference in id. The id "query" appears both here and
> further up in the file, specifically in the h2 heading. This triggers
> the HTML validation problem. I suppose this is a bug in the experimental
> table of contents feature? As such, should I rather post this to R-devel?
>
> Unfortunately, this also prevents me from uploading a new version of my
> package, since it does not get past CRAN?s automatic pretest. Can I
> resubmit my new version and simply state in the comments that I cannot
> fix the NOTE from r-devel at this point? Or should I rather wait until
> this is changed upstream? (the described NOTE is the only complaint from
> the pretest). Changing the function or parameter name is not an option,
> they have been used in this package ever since it was released a couple
> of years ago.
>
> This NOTE can also be reproduced with a minimal R package that has
> nothing but a hello function with a parameter named hello.
>
> Thanks for reading this. I appreciate any help.
>
> Markus
>
>
> Institute for Phonetics and Speech Processing
>
> Ludwig-Maximilians-Universit?t M?nchen
>
> https://www.phonetik.uni-muenchen.de
>
>
> [1] https://cran.rstudio.com//web/checks/check_results_emuR.html
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From m@rku@joch|m @end|ng |rom phonet|k@un|-muenchen@de  Mon Oct 30 22:36:25 2023
From: m@rku@joch|m @end|ng |rom phonet|k@un|-muenchen@de (Markus Jochim)
Date: Mon, 30 Oct 2023 22:36:25 +0100
Subject: [R-pkg-devel] Recent dev version of R CMD check fails when a
 package function named X also has a parameter named X
In-Reply-To: <CADfFDC4goQOcgUih=K85r_npeAzyTyP9mENDLKBYo6eGofcPyQ@mail.gmail.com>
References: <fb6e9cba-df63-4d02-96b2-83e7b0f66955@phonetik.uni-muenchen.de>
 <CADfFDC4goQOcgUih=K85r_npeAzyTyP9mENDLKBYo6eGofcPyQ@mail.gmail.com>
Message-ID: <0360d814-7be7-43bb-807f-90e456c42e08@phonetik.uni-muenchen.de>

Thank you, Deepayan. Commit r85440 appears to solve the problem in emuR.

Markus



From pb@||ey @end|ng |rom @|r@org  Mon Oct 30 23:26:43 2023
From: pb@||ey @end|ng |rom @|r@org (Bailey, Paul)
Date: Mon, 30 Oct 2023 22:26:43 +0000
Subject: [R-pkg-devel] Matrix and Mac OS
Message-ID: <BLAPR05MB7235EEB2A9E6BC5DB6117972BEA1A@BLAPR05MB7235.namprd05.prod.outlook.com>

Hi,

I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"

When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?

Best,
Paul

	[[alternative HTML version deleted]]



From @|mon@urb@nek @end|ng |rom R-project@org  Mon Oct 30 23:44:26 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Tue, 31 Oct 2023 11:44:26 +1300
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <BLAPR05MB7235EEB2A9E6BC5DB6117972BEA1A@BLAPR05MB7235.namprd05.prod.outlook.com>
References: <BLAPR05MB7235EEB2A9E6BC5DB6117972BEA1A@BLAPR05MB7235.namprd05.prod.outlook.com>
Message-ID: <3FD3705E-593E-4A8E-A126-EB7B558E5DAF@R-project.org>

Paul,

can you give us a bit more detail? Which package, which build and where you got the errors? Older builds may not have the latest Matrix.

Cheers,
Simon


> On 31/10/2023, at 11:26 AM, Bailey, Paul via R-package-devel <r-package-devel at r-project.org> wrote:
> 
> Hi,
> 
> I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"
> 
> When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?
> 
> Best,
> Paul
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 



From @|j|@ng @end|ng |rom bccrc@c@  Tue Oct 31 08:31:12 2023
From: @|j|@ng @end|ng |rom bccrc@c@ (Aixiang Jiang)
Date: Tue, 31 Oct 2023 07:31:12 +0000
Subject: [R-pkg-devel] DLL requires the use of native symbols
Message-ID: <1698737473271.88494@bccrc.ca>

Hello everyone,

I recently submitted my NMRphasing R package. While most of the check results are fine, I encountered two issues on macOS. The major error is:

'DLL requires the use of native symbols'

I'm wondering how I can resolve this issue. Any help or suggestions would be greatly appreciated.

Thank you in advance!?


Best,
Aixiang



From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 31 09:36:54 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 31 Oct 2023 11:36:54 +0300
Subject: [R-pkg-devel] DLL requires the use of native symbols
In-Reply-To: <1698737473271.88494@bccrc.ca>
References: <1698737473271.88494@bccrc.ca>
Message-ID: <20231031113654.43e19a31@Tarkus>

Dear Simon,

Could you please look into this? The machines running r-release-macos-*
checks seem to have MassSpecWavelet < 1.66 installed instead of the
current version, 1.68. I think that MassSpecWavelet >= 1.66 would be
version-appropriate for R-4.3 (Bioconductor >= 3.17).

On Tue, 31 Oct 2023 07:31:12 +0000
Aixiang Jiang <aijiang at bccrc.ca> wrote:

> 'DLL requires the use of native symbols'

Interesting. It's not you, it's the MassSpecWavelet package, but the
error has already been fixed there. Look at the traceback produced for
the error:

>> Error in localMaximumSlidingWindow(x, winSize) :
>>  DLL requires the use of native symbols
>> Calls: MPC_DANM ... getLocalMaximumCWT -> localMaximum ->
>>        localMaximumSlidingWindow

The error happens in a function called 'localMaximumSlidingWindow',
called from 'localMaximum', called from 'getLocalMaximumCWT'.
'getLocalMaximumCWT' belongs to the MassSpecWavelet package.

The problem is that the maintainer sets R_forceSymbols(info, TRUE)
but then uses .Call() with a string containing the name of the function
instead of a special object that directly refers to that function. The
fix for that has been committed half a year ago
<https://code.bioconductor.org/browse/MassSpecWavelet/commit/496de2969b2f43f8be00f1966611497fa3053937>
and became part of the 1.66.0 release and the following versions of the
package. The fixed package versions went into Bioconductor 3.17 (for
R-4.3) but not 3.16 (for R-4.2).

-- 
Best regards,
Ivan



From kke@h@v @end|ng |rom u||@edu  Tue Oct 31 10:03:41 2023
From: kke@h@v @end|ng |rom u||@edu (Keshav, Krishna)
Date: Tue, 31 Oct 2023 09:03:41 +0000
Subject: [R-pkg-devel] Failing to write config file in linux
In-Reply-To: <DC4ED4AC-B5A6-4926-A8CA-7328FE20B774@R-project.org>
References: <CO6PR22MB243368A25EC7FECF64DFDE6FB6D9A@CO6PR22MB2433.namprd22.prod.outlook.com>
 <DC4ED4AC-B5A6-4926-A8CA-7328FE20B774@R-project.org>
Message-ID: <SJ0PR22MB24484D702515C9EB9A5CD84DB6A0A@SJ0PR22MB2448.namprd22.prod.outlook.com>

Hello,

Thanks for suggesting tools::R_user_dir(). I was able to implement and resubmit. This issue prompted me to read the policies thoroughly here - https://r-pkgs.org/release.html .

Best Regards,
Krishna Keshav

From: Simon Urbanek <simon.urbanek at R-project.org>
Date: Monday, October 23, 2023 at 3:07?PM
To: Keshav, Krishna <kkeshav at ufl.edu>
Cc: List r-package-devel <r-package-devel at r-project.org>, Kurt.Hornik at wu.ac.at <Kurt.Hornik at wu.ac.at>
Subject: Re: [R-pkg-devel] Failing to write config file in linux
[External Email]

From CRAN policy (which you agreed to when you submitted your package) - note in particular the "nor anywhere else on the file system" part and also note that it tells you what to do in your case:


Packages should not write in the user?s home filespace (including clipboards), nor anywhere else on the file system apart from the R session?s temporary directory (or during installation in the location pointed to by TMPDIR: and such usage should be cleaned up). Installing into the system?s R installation (e.g., scripts to its bin directory) is not allowed.
Limited exceptions may be allowed in interactive sessions if the package obtains confirmation from the user.

For R version 4.0 or later (hence a version dependency is required or only conditional use is possible), packages may store user-specific data, configuration and cache files in their respective user directories obtained from tools::R_user_dir(), provided that by default sizes are kept as small as possible and the contents are actively managed (including removing outdated material).




> On Oct 23, 2023, at 5:52 AM, Keshav, Krishna <kkeshav at ufl.edu> wrote:
>
> Hi,
>
> My package is failing on linux based systems because of an attempt to write in a location of package. One of the core features that we would like user to have is to modify the values in the config file, for which package has a function for user to provide modified config. In future, they should be able to provide individual parameters for the config for which also we will be writing to config in package directory /inst/ so that it can later be fetched. I understand that policy doesn?t allow writing to home directory. Is there a workaround for this? Or what could be other potential solutions to explore.
>
> Snippet ?
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FGarrettLab%2FCroplandConnectivity%2Fblob%2F923a4a0ca4a0ce8376068ee80986df228ea21d80%2Fgeohabnet%2FR%2Fparams.R%23L57&data=05%7C01%7Ckkeshav%40ufl.edu%7C8e20f2cfc4064895404c08dbd3fb5131%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638336848586995860%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=zrjs7IXdoOJU%2BTyAZLUotDP3PGzTexKvDBBXCy10tRo%3D&reserved=0<https://github.com/GarrettLab/CroplandConnectivity/blob/923a4a0ca4a0ce8376068ee80986df228ea21d80/geohabnet/R/params.R#L57>
>
> Error ?
>     ?? Failure ('test-parameters.R:38:3'): Test 6: Test to set new parameters.yaml ??
>     Expected `set_parameters(new_param_file)` to run without any conditions.
>     ? Actually got a <simpleWarning> with text:
>     cannot create file '/home/hornik/tmp/R.check/r-release-gcc/Work/build/Packages/geohabnet/parameters.yaml', reason 'Read-only file system'
>
>
> Best Regards,
> Krishna Keshav
>
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Ckkeshav%40ufl.edu%7C8e20f2cfc4064895404c08dbd3fb5131%7C0d4da0f84a314d76ace60a62331e1b84%7C0%7C0%7C638336848586995860%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=LA140Pw6t4xGXGJV60Zedj7CNpkDjsYlTS%2FHSc162fo%3D&reserved=0<https://stat.ethz.ch/mailman/listinfo/r-package-devel>

	[[alternative HTML version deleted]]


From j@g@nmn2 @end|ng |rom gm@||@com  Tue Oct 31 16:05:55 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Tue, 31 Oct 2023 11:05:55 -0400
Subject: [R-pkg-devel] R-package-devel Digest, Vol 102, Issue 27
In-Reply-To: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
Message-ID: <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>

I am guessing that they mean EdSurvey:

     https://cran.r-project.org/web/checks/check_results_EdSurvey.html

Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
even though it can be, because it was not released until R 4.3-z.

AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
even those changes should have been backwards compatible, modulo handling
of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).

So I don't see a clear reason for requiring 1.6-1.1.  Requiring 1.6-0
might make sense, if somehow EdSurvey depends on how class sparseQR
preserves dimnames.  But IIRC our rev. dep. checks at that time did not
reveal problems with EdSurvey.

Mikael

On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
> Paul,
> 
> can you give us a bit more detail? Which package, which build and where you got the errors? Older builds may not have the latest Matrix.
> 
> Cheers,
> Simon
> 
> 
>> On 31/10/2023, at 11:26 AM, Bailey, Paul via R-package-devel<r-package-devel at r-project.org>  wrote:
>>
>> Hi,
>>
>> I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"
>>
>> When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?
>>
>> Best,
>> Paul
>>
>> 	[[alternative HTML version deleted]]



From j@g@nmn2 @end|ng |rom gm@||@com  Tue Oct 31 16:10:17 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Tue, 31 Oct 2023 11:10:17 -0400
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
Message-ID: <b831e0f6-6136-463c-a603-fbd877ad2350@gmail.com>

Re-sending to the list with correct subject line ...

I should undigest myself ...

Mikael

On 2023-10-31 11:05 am, Mikael Jagan wrote:
> I am guessing that they mean EdSurvey:
> 
>       https://cran.r-project.org/web/checks/check_results_EdSurvey.html
> 
> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
> even though it can be, because it was not released until R 4.3-z.
> 
> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
> even those changes should have been backwards compatible, modulo handling
> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
> 
> So I don't see a clear reason for requiring 1.6-1.1.  Requiring 1.6-0
> might make sense, if somehow EdSurvey depends on how class sparseQR
> preserves dimnames.  But IIRC our rev. dep. checks at that time did not
> reveal problems with EdSurvey.
> 
> Mikael
> 
> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>> Paul,
>>
>> can you give us a bit more detail? Which package, which build and where you got the errors? Older builds may not have the latest Matrix.
>>
>> Cheers,
>> Simon
>>
>>
>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via R-package-devel<r-package-devel at r-project.org>  wrote:
>>>
>>> Hi,
>>>
>>> I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"
>>>
>>> When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?
>>>
>>> Best,
>>> Paul
>>>
>>> 	[[alternative HTML version deleted]]



From @|j|@ng @end|ng |rom bccrc@c@  Tue Oct 31 16:42:30 2023
From: @|j|@ng @end|ng |rom bccrc@c@ (Aixiang Jiang)
Date: Tue, 31 Oct 2023 15:42:30 +0000
Subject: [R-pkg-devel] DLL requires the use of native symbols
In-Reply-To: <20231031113654.43e19a31@Tarkus>
References: <1698737473271.88494@bccrc.ca>,<20231031113654.43e19a31@Tarkus>
Message-ID: <1698766949986.55299@bccrc.ca>

Thank you so much - Ivan!

I think that I need to update R to the latest version then.

Have a great day!

Best,
Aixiang

________________________________________
From: Ivan Krylov <krylov.r00t at gmail.com>
Sent: Tuesday, October 31, 2023 1:36 AM
To: Aixiang Jiang
Cc: List r-package-devel; Simon Urbanek
Subject: Re: [R-pkg-devel] DLL requires the use of native symbols

This email came from an EXTERNAL SENDER. If you think this message is suspicious, please do not open any attached files or links, and forward it as an attachment to spammail at bccrc.ca



Dear Simon,

Could you please look into this? The machines running r-release-macos-*
checks seem to have MassSpecWavelet < 1.66 installed instead of the
current version, 1.68. I think that MassSpecWavelet >= 1.66 would be
version-appropriate for R-4.3 (Bioconductor >= 3.17).

On Tue, 31 Oct 2023 07:31:12 +0000
Aixiang Jiang <aijiang at bccrc.ca> wrote:

> 'DLL requires the use of native symbols'

Interesting. It's not you, it's the MassSpecWavelet package, but the
error has already been fixed there. Look at the traceback produced for
the error:

>> Error in localMaximumSlidingWindow(x, winSize) :
>>  DLL requires the use of native symbols
>> Calls: MPC_DANM ... getLocalMaximumCWT -> localMaximum ->
>>        localMaximumSlidingWindow

The error happens in a function called 'localMaximumSlidingWindow',
called from 'localMaximum', called from 'getLocalMaximumCWT'.
'getLocalMaximumCWT' belongs to the MassSpecWavelet package.

The problem is that the maintainer sets R_forceSymbols(info, TRUE)
but then uses .Call() with a string containing the name of the function
instead of a special object that directly refers to that function. The
fix for that has been committed half a year ago
<https://code.bioconductor.org/browse/MassSpecWavelet/commit/496de2969b2f43f8be00f1966611497fa3053937>
and became part of the 1.66.0 release and the following versions of the
package. The fixed package versions went into Bioconductor 3.17 (for
R-4.3) but not 3.16 (for R-4.2).

--
Best regards,
Ivan



From kry|ov@r00t @end|ng |rom gm@||@com  Tue Oct 31 17:58:05 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 31 Oct 2023 19:58:05 +0300
Subject: [R-pkg-devel] Issue with R Package on CRAN - OpenMP and clang17
In-Reply-To: <20231030185229.385fe389@arachnoid>
References: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
 <20231030185229.385fe389@arachnoid>
Message-ID: <20231031195805.015bd26a@arachnoid>

? Mon, 30 Oct 2023 18:52:29 +0300
Ivan Krylov <krylov.r00t at gmail.com> ?????:

> I'll try to reproduce your problem, starting by downloading and
> compiling flang from https://github.com/llvm/llvm-project.git commit
> 092b6c5ee3707ea10b9f10d0a674e8d12395369b (as stated at
> <https://www.stats.ox.ac.uk/pub/bdr/clang17/frailtypack.log>)

Wow. Building LLVM is an adventure, and I don't mean it in a good way.
I had to patch flang/include/flang/Semantics/symbol.h because it
declares `friend class std::array` while my copy of the C++ standard
library has a `struct std::array`, which makes the friend declaration
an error. Naively thinking that I would be helping debug the problem, I
tried compiling a debugging build of LLVM, only to watch in horror as
it consumed all disk space I could offer it. I eventually ran out of
things to delete after the build directory reached 100 gigabytes in
size, while the build still had 1000 out of 6000 targets to compile and
link. Even the release build failed at 410 remaining targets because of
a missing -fPIC somewhere in the compiler command line. Thankfully, it
still produced a working `flang-new` executable.

A release build of LLVM + flang-new takes a relatively reasonable 
8.2 GBytes of storage. The computers that helped launch the first
people into space had 2 kWords of memory, but nowadays you need more
than 256 MBytes of RAM to launch a bird into a pig and 10 GBytes of
storage in order to compile a compiler. This is what progress looks
like.

I was able to reduce the example to the following program:

program main
    implicit none

    real :: sum = 0
    integer :: i, n = 10

    sum = sum + 1. ! <-- error here if followed by OpenMP reduction

    !$OMP PARALLEL DO default(none) PRIVATE (i) SHARED(n) &
    !$OMP REDUCTION(+:sum) SCHEDULE(Dynamic,1)
    do i=1,n
        sum = sum + real(i)
    end do
    !$OMP END PARALLEL DO

    print *, sum
end

% flang-new -c -o /dev/null src.f90 -fopenmp
error: loc("src.f90":7:5): 'omp.reduction' op must be used within an
operation supporting reduction clause interface
error: verification of lowering to FIR failed

gfortran raises no errors or warnings for the test program. Bug
reported at <https://github.com/llvm/llvm-project/issues/70828>.

Would that be enough proof of a compiler bug, or do we need a
confirmation from the developers?

-- 
Best regards,
Ivan



From edd @end|ng |rom deb|@n@org  Tue Oct 31 18:16:10 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 31 Oct 2023 12:16:10 -0500
Subject: [R-pkg-devel] Fortune candidate Re: Issue with R Package on CRAN -
 OpenMP and clang17
In-Reply-To: <20231031195805.015bd26a@arachnoid>
References: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
 <20231030185229.385fe389@arachnoid>
 <20231031195805.015bd26a@arachnoid>
Message-ID: <25921.13914.177311.462376@rob.eddelbuettel.com>


On 31 October 2023 at 19:58, Ivan Krylov wrote:
| [...] The computers that helped launch the first
| people into space had 2 kWords of memory, but nowadays you need more
| than 256 MBytes of RAM to launch a bird into a pig and 10 GBytes of
| storage in order to compile a compiler. This is what progress looks
| like.

Fortune!!

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org



From @|mon@urb@nek @end|ng |rom R-project@org  Tue Oct 31 20:33:24 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 1 Nov 2023 08:33:24 +1300
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
Message-ID: <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>

Mikael,

current Matrix fails checks on R-oldrel so that's why only the last working version is installed:
https://cran.r-project.org/web/checks/check_results_Matrix.html

Cheers,
Simon



> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
> 
> I am guessing that they mean EdSurvey:
> 
>    https://cran.r-project.org/web/checks/check_results_EdSurvey.html
> 
> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
> even though it can be, because it was not released until R 4.3-z.
> 
> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
> even those changes should have been backwards compatible, modulo handling
> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
> 
> So I don't see a clear reason for requiring 1.6-1.1.  Requiring 1.6-0
> might make sense, if somehow EdSurvey depends on how class sparseQR
> preserves dimnames.  But IIRC our rev. dep. checks at that time did not
> reveal problems with EdSurvey.
> 
> Mikael
> 
> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>> Paul,
>> can you give us a bit more detail? Which package, which build and where you got the errors? Older builds may not have the latest Matrix.
>> Cheers,
>> Simon
>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via R-package-devel<r-package-devel at r-project.org>  wrote:
>>> 
>>> Hi,
>>> 
>>> I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"
>>> 
>>> When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?
>>> 
>>> Best,
>>> Paul
>>> 
>>> 	[[alternative HTML version deleted]]
> 



From j@g@nmn2 @end|ng |rom gm@||@com  Tue Oct 31 21:19:40 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Tue, 31 Oct 2023 16:19:40 -0400
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
 <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
Message-ID: <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>

Thanks.  We did see those ERRORs, stemming from use (since Matrix 1.6-0)
of amsmath commands in Rd files.  These have been supported since R 4.2.2,
but r-oldrel-macos-* (unlike r-oldrel-windows-*) continues to run R 4.2.0.
My expectation was that those machines would begin running R >= 4.2.2 well
before the R 4.4.0 release, but apparently that was wrong.

I am hesitant to complicate our Rd files with conditions on R versions
only to support PDF output for R < 4.2.2, but maybe we can consider it
for the Matrix 1.6-2 release if it is really a barrier for others ...

Mikael

On 2023-10-31 3:33 pm, Simon Urbanek wrote:
> Mikael,
> 
> current Matrix fails checks on R-oldrel so that's why only the last working version is installed:
> https://cran.r-project.org/web/checks/check_results_Matrix.html
> 
> Cheers,
> Simon
> 
> 
> 
>> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>
>> I am guessing that they mean EdSurvey:
>>
>>     https://cran.r-project.org/web/checks/check_results_EdSurvey.html
>>
>> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
>> even though it can be, because it was not released until R 4.3-z.
>>
>> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
>> even those changes should have been backwards compatible, modulo handling
>> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
>>
>> So I don't see a clear reason for requiring 1.6-1.1.  Requiring 1.6-0
>> might make sense, if somehow EdSurvey depends on how class sparseQR
>> preserves dimnames.  But IIRC our rev. dep. checks at that time did not
>> reveal problems with EdSurvey.
>>
>> Mikael
>>
>> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>>> Paul,
>>> can you give us a bit more detail? Which package, which build and where you got the errors? Older builds may not have the latest Matrix.
>>> Cheers,
>>> Simon
>>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via R-package-devel<r-package-devel at r-project.org>  wrote:
>>>>
>>>> Hi,
>>>>
>>>> I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"
>>>>
>>>> When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?
>>>>
>>>> Best,
>>>> Paul
>>>>
>>>> 	[[alternative HTML version deleted]]
>>
>




From @|mon@urb@nek @end|ng |rom R-project@org  Wed Nov  1 01:17:31 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 1 Nov 2023 13:17:31 +1300
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
 <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
 <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>
Message-ID: <17E1FF10-6C44-468F-9E55-C67F792F12C6@R-project.org>

Mikael,

in that case I think your requirements are wrong - Matrix says R >= 3.5.0 which is apparently incorrect - from what you say it should be 4.2.2?. I can certainly update to 4.2.3 if necessary.

Cheers,
Simon



> On 1/11/2023, at 9:19 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
> 
> Thanks.  We did see those ERRORs, stemming from use (since Matrix 1.6-0)
> of amsmath commands in Rd files.  These have been supported since R 4.2.2,
> but r-oldrel-macos-* (unlike r-oldrel-windows-*) continues to run R 4.2.0.
> My expectation was that those machines would begin running R >= 4.2.2 well
> before the R 4.4.0 release, but apparently that was wrong.
> 
> I am hesitant to complicate our Rd files with conditions on R versions
> only to support PDF output for R < 4.2.2, but maybe we can consider it
> for the Matrix 1.6-2 release if it is really a barrier for others ...
> 
> Mikael
> 
> On 2023-10-31 3:33 pm, Simon Urbanek wrote:
>> Mikael,
>> current Matrix fails checks on R-oldrel so that's why only the last working version is installed:
>> https://cran.r-project.org/web/checks/check_results_Matrix.html
>> Cheers,
>> Simon
>>> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>> 
>>> I am guessing that they mean EdSurvey:
>>> 
>>>    https://cran.r-project.org/web/checks/check_results_EdSurvey.html
>>> 
>>> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
>>> even though it can be, because it was not released until R 4.3-z.
>>> 
>>> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
>>> even those changes should have been backwards compatible, modulo handling
>>> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
>>> 
>>> So I don't see a clear reason for requiring 1.6-1.1.  Requiring 1.6-0
>>> might make sense, if somehow EdSurvey depends on how class sparseQR
>>> preserves dimnames.  But IIRC our rev. dep. checks at that time did not
>>> reveal problems with EdSurvey.
>>> 
>>> Mikael
>>> 
>>> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>>>> Paul,
>>>> can you give us a bit more detail? Which package, which build and where you got the errors? Older builds may not have the latest Matrix.
>>>> Cheers,
>>>> Simon
>>>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via R-package-devel<r-package-devel at r-project.org>  wrote:
>>>>> 
>>>>> Hi,
>>>>> 
>>>>> I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"
>>>>> 
>>>>> When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?
>>>>> 
>>>>> Best,
>>>>> Paul
>>>>> 
>>>>> 	[[alternative HTML version deleted]]
>>> 
> 



From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Wed Nov  1 01:43:30 2023
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 31 Oct 2023 17:43:30 -0700
Subject: [R-pkg-devel] 
 Fortune candidate Re: Issue with R Package on CRAN -
 OpenMP and clang17
In-Reply-To: <25921.13914.177311.462376@rob.eddelbuettel.com>
References: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
 <20231030185229.385fe389@arachnoid> <20231031195805.015bd26a@arachnoid>
 <25921.13914.177311.462376@rob.eddelbuettel.com>
Message-ID: <9FDCCB92-F9A2-4FB7-A773-F7A662A62880@dcn.davis.ca.us>

ROFL! Seconded!

The quote itself has a bit of greybeard smell to it, but the "ran out of stuff to delete at 100GB with 1000 out of 6000 targets compiled" had me in stitches.

On October 31, 2023 10:16:10 AM PDT, Dirk Eddelbuettel <edd at debian.org> wrote:
>
>On 31 October 2023 at 19:58, Ivan Krylov wrote:
>| [...] The computers that helped launch the first
>| people into space had 2 kWords of memory, but nowadays you need more
>| than 256 MBytes of RAM to launch a bird into a pig and 10 GBytes of
>| storage in order to compile a compiler. This is what progress looks
>| like.
>
>Fortune!!
>
>Dirk
>

-- 
Sent from my phone. Please excuse my brevity.



From greg @end|ng |rom ||rm@n@y@h@com  Wed Nov  1 01:57:58 2023
From: greg @end|ng |rom ||rm@n@y@h@com (Greg Hunt)
Date: Tue, 31 Oct 2023 19:57:58 -0500
Subject: [R-pkg-devel] 
 Fortune candidate Re: Issue with R Package on CRAN -
 OpenMP and clang17
In-Reply-To: <25921.13914.177311.462376@rob.eddelbuettel.com>
References: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
 <20231030185229.385fe389@arachnoid> <20231031195805.015bd26a@arachnoid>
 <25921.13914.177311.462376@rob.eddelbuettel.com>
Message-ID: <CAAS8PALk2zaCFcg6uSoq+t7GQ3tN8q=R04nG-vrJ+PouiJ_gAQ@mail.gmail.com>

If i remember rightly one of the early Algol compilers for the IBM
mainframe couldnt be compiled on an IBM mainframe because it was too memory
hungry (it had to be cross compiled). The numbers change, but the problems
don?t, except that i haven?t run a compile lately that ran out of memory
like that.


On Tue, 31 Oct 2023 at 12:24 pm, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 31 October 2023 at 19:58, Ivan Krylov wrote:
> | [...] The computers that helped launch the first
> | people into space had 2 kWords of memory, but nowadays you need more
> | than 256 MBytes of RAM to launch a bird into a pig and 10 GBytes of
> | storage in order to compile a compiler. This is what progress looks
> | like.
>
> Fortune!!
>
> Dirk
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]



From j@g@nmn2 @end|ng |rom gm@||@com  Wed Nov  1 03:51:54 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Tue, 31 Oct 2023 22:51:54 -0400
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <17E1FF10-6C44-468F-9E55-C67F792F12C6@R-project.org>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
 <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
 <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>
 <17E1FF10-6C44-468F-9E55-C67F792F12C6@R-project.org>
Message-ID: <577444ff-2481-4a39-9e05-ea8939b3f5a5@gmail.com>

Thanks.  It seems that we were mistaken in our feeling (IIRC) that it would
be "OK" to implicitly require '--no-manual' on versions of R from 3.5.0 to
4.2.1, not changing our Depends.

We will fix this in Matrix 1.6-2, probably by conditionalizing or otherwise
replacing the amsmath commands and probably _not_ by changing to depend on
R >= 4.2.2.  Martin may have more to say in "the morning".

In the mean time (i.e., while we are stuck with Matrix 1.6-1.1), it may help
to update to R 4.2.3 on r-oldrel-macos-* and/or to have EdSurvey revert its
strict version requirement, unless there are clear examples justifying one.

Mikael


On 2023-10-31 8:17 pm, Simon Urbanek wrote:
> Mikael,
> 
> in that case I think your requirements are wrong - Matrix says R >= 3.5.0 which is apparently incorrect - from what you say it should be 4.2.2?. I can certainly update to 4.2.3 if necessary.
> 
> Cheers,
> Simon
> 
> 
> 
>> On 1/11/2023, at 9:19 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>
>> Thanks.  We did see those ERRORs, stemming from use (since Matrix 1.6-0)
>> of amsmath commands in Rd files.  These have been supported since R 4.2.2,
>> but r-oldrel-macos-* (unlike r-oldrel-windows-*) continues to run R 4.2.0.
>> My expectation was that those machines would begin running R >= 4.2.2 well
>> before the R 4.4.0 release, but apparently that was wrong.
>>
>> I am hesitant to complicate our Rd files with conditions on R versions
>> only to support PDF output for R < 4.2.2, but maybe we can consider it
>> for the Matrix 1.6-2 release if it is really a barrier for others ...
>>
>> Mikael
>>
>> On 2023-10-31 3:33 pm, Simon Urbanek wrote:
>>> Mikael,
>>> current Matrix fails checks on R-oldrel so that's why only the last working version is installed:
>>> https://cran.r-project.org/web/checks/check_results_Matrix.html
>>> Cheers,
>>> Simon
>>>> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>>>
>>>> I am guessing that they mean EdSurvey:
>>>>
>>>>     https://cran.r-project.org/web/checks/check_results_EdSurvey.html
>>>>
>>>> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
>>>> even though it can be, because it was not released until R 4.3-z.
>>>>
>>>> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
>>>> even those changes should have been backwards compatible, modulo handling
>>>> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
>>>>
>>>> So I don't see a clear reason for requiring 1.6-1.1.  Requiring 1.6-0
>>>> might make sense, if somehow EdSurvey depends on how class sparseQR
>>>> preserves dimnames.  But IIRC our rev. dep. checks at that time did not
>>>> reveal problems with EdSurvey.
>>>>
>>>> Mikael
>>>>
>>>> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>>>>> Paul,
>>>>> can you give us a bit more detail? Which package, which build and where you got the errors? Older builds may not have the latest Matrix.
>>>>> Cheers,
>>>>> Simon
>>>>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via R-package-devel<r-package-devel at r-project.org>  wrote:
>>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> I'm the maintainer for a few packages, one of which is currently failing CRAN checks on Mac OS because Matrix is not available in my required version (the latest). I had to fix a few things due to changes in the latest Matrix package because of how qr works and I thought, given the apparent API change, I should then require the latest version. My error is, "Package required and available but unsuitable version: 'Matrix'"
>>>>>>
>>>>>> When I look at the NEWS in Matrix there is no mention of Mac OS issues, what the latest stable version of Matrix is, nor when a fix is expected. What version do MacOS version test Matrix with by default? Where is this documented? I assumes it always tested with the latest version on CRAN, so I'm a bit surprised. Or will this be resolved soon and I shouldn't bother CRAN maintainers with a new version of my package?
>>>>>>
>>>>>> Best,
>>>>>> Paul
>>>>>>
>>>>>> 	[[alternative HTML version deleted]]
>>>>
>>
>



From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Nov  1 06:26:23 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 1 Nov 2023 06:26:23 +0100
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <577444ff-2481-4a39-9e05-ea8939b3f5a5@gmail.com>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
 <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
 <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>
 <17E1FF10-6C44-468F-9E55-C67F792F12C6@R-project.org>
 <577444ff-2481-4a39-9e05-ea8939b3f5a5@gmail.com>
Message-ID: <05d496e1-18af-e406-08fe-9c62c6c6540f@statistik.tu-dortmund.de>



On 01.11.2023 03:51, Mikael Jagan wrote:
> Thanks.? It seems that we were mistaken in our feeling (IIRC) that it would
> be "OK" to implicitly require '--no-manual' on versions of R from 3.5.0 to
> 4.2.1, not changing our Depends.
> 
> We will fix this in Matrix 1.6-2, probably by conditionalizing or otherwise
> replacing the amsmath commands and probably _not_ by changing to depend on
> R >= 4.2.2.? Martin may have more to say in "the morning".

Note that dependin on R >= 4.2.2 does not work. We need dependencies of 
the form R >= x.y.0. This is also part of the checks.

Reason is that we have only one binary repository for one R-x.y.? 
series. On WIndows, where we check with R-4.2.3, a binary would be 
created and hence R-4.2.[0-1] would not see any valid Matrix binaries.

So please either make this work on R >= 4.2.0 or require R >= 4.3.0. If 
the latter, ideally with an interim version that works for R >= 4.2.0, 
so that we valid binaries with correct dependency declarations again.

Best,
Uwe

> In the mean time (i.e., while we are stuck with Matrix 1.6-1.1), it may 
> help
> to update to R 4.2.3 on r-oldrel-macos-* and/or to have EdSurvey revert its
> strict version requirement, unless there are clear examples justifying one.
> 
> Mikael
> 
> 
> On 2023-10-31 8:17 pm, Simon Urbanek wrote:
>> Mikael,
>>
>> in that case I think your requirements are wrong - Matrix says R >= 
>> 3.5.0 which is apparently incorrect - from what you say it should be 
>> 4.2.2?. I can certainly update to 4.2.3 if necessary.
>>
>> Cheers,
>> Simon
>>
>>
>>
>>> On 1/11/2023, at 9:19 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>>
>>> Thanks.? We did see those ERRORs, stemming from use (since Matrix 1.6-0)
>>> of amsmath commands in Rd files.? These have been supported since R 
>>> 4.2.2,
>>> but r-oldrel-macos-* (unlike r-oldrel-windows-*) continues to run R 
>>> 4.2.0.
>>> My expectation was that those machines would begin running R >= 4.2.2 
>>> well
>>> before the R 4.4.0 release, but apparently that was wrong.
>>>
>>> I am hesitant to complicate our Rd files with conditions on R versions
>>> only to support PDF output for R < 4.2.2, but maybe we can consider it
>>> for the Matrix 1.6-2 release if it is really a barrier for others ...
>>>
>>> Mikael
>>>
>>> On 2023-10-31 3:33 pm, Simon Urbanek wrote:
>>>> Mikael,
>>>> current Matrix fails checks on R-oldrel so that's why only the last 
>>>> working version is installed:
>>>> https://cran.r-project.org/web/checks/check_results_Matrix.html
>>>> Cheers,
>>>> Simon
>>>>> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>>>>
>>>>> I am guessing that they mean EdSurvey:
>>>>>
>>>>> ??? https://cran.r-project.org/web/checks/check_results_EdSurvey.html
>>>>>
>>>>> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
>>>>> even though it can be, because it was not released until R 4.3-z.
>>>>>
>>>>> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
>>>>> even those changes should have been backwards compatible, modulo 
>>>>> handling
>>>>> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
>>>>>
>>>>> So I don't see a clear reason for requiring 1.6-1.1.? Requiring 1.6-0
>>>>> might make sense, if somehow EdSurvey depends on how class sparseQR
>>>>> preserves dimnames.? But IIRC our rev. dep. checks at that time did 
>>>>> not
>>>>> reveal problems with EdSurvey.
>>>>>
>>>>> Mikael
>>>>>
>>>>> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>>>>>> Paul,
>>>>>> can you give us a bit more detail? Which package, which build and 
>>>>>> where you got the errors? Older builds may not have the latest 
>>>>>> Matrix.
>>>>>> Cheers,
>>>>>> Simon
>>>>>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via 
>>>>>>> R-package-devel<r-package-devel at r-project.org>? wrote:
>>>>>>>
>>>>>>> Hi,
>>>>>>>
>>>>>>> I'm the maintainer for a few packages, one of which is currently 
>>>>>>> failing CRAN checks on Mac OS because Matrix is not available in 
>>>>>>> my required version (the latest). I had to fix a few things due 
>>>>>>> to changes in the latest Matrix package because of how qr works 
>>>>>>> and I thought, given the apparent API change, I should then 
>>>>>>> require the latest version. My error is, "Package required and 
>>>>>>> available but unsuitable version: 'Matrix'"
>>>>>>>
>>>>>>> When I look at the NEWS in Matrix there is no mention of Mac OS 
>>>>>>> issues, what the latest stable version of Matrix is, nor when a 
>>>>>>> fix is expected. What version do MacOS version test Matrix with 
>>>>>>> by default? Where is this documented? I assumes it always tested 
>>>>>>> with the latest version on CRAN, so I'm a bit surprised. Or will 
>>>>>>> this be resolved soon and I shouldn't bother CRAN maintainers 
>>>>>>> with a new version of my package?
>>>>>>>
>>>>>>> Best,
>>>>>>> Paul
>>>>>>>
>>>>>>> ????[[alternative HTML version deleted]]
>>>>>
>>>
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Wed Nov  1 10:06:59 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 1 Nov 2023 10:06:59 +0100
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <05d496e1-18af-e406-08fe-9c62c6c6540f@statistik.tu-dortmund.de>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
 <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
 <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>
 <17E1FF10-6C44-468F-9E55-C67F792F12C6@R-project.org>
 <577444ff-2481-4a39-9e05-ea8939b3f5a5@gmail.com>
 <05d496e1-18af-e406-08fe-9c62c6c6540f@statistik.tu-dortmund.de>
Message-ID: <25922.5427.225938.135970@stat.math.ethz.ch>

>>>>> Uwe Ligges 
>>>>>     on Wed, 1 Nov 2023 06:26:23 +0100 writes:

    > On 01.11.2023 03:51, Mikael Jagan wrote:
    >> Thanks.? It seems that we were mistaken in our feeling (IIRC) that it would
    >> be "OK" to implicitly require '--no-manual' on versions of R from 3.5.0 to
    >> 4.2.1, not changing our Depends.
    >> 
    >> We will fix this in Matrix 1.6-2, probably by conditionalizing or otherwise
    >> replacing the amsmath commands and probably _not_ by changing to depend on
    >> R >= 4.2.2.? Martin may have more to say in "the morning".

I agree (*not* to raise Matrix pkg's R version dependency).

    > Note that dependin on R >= 4.2.2 does not work. We need dependencies of 
    > the form R >= x.y.0. This is also part of the checks.

Yes, indeed.
And as we learned, R >= 4.2.0 would not help for r-oldrel-macos

I (am unhappy but) agree to take the responsibility for our
decision to go ahead and use much nicer LaTeX formula for
matrices etc, in our help pages {thinking that indeed people who'd
install Matrix on an old R version would always be able to read
Matrix manual pages via web search (as it seems to me 95% of
people do nowadays) ... or then have someone in their
organization to figure out how to use a newer amsmath (latex) package if
 they really really want the Matrix pdf manual offline}.

Martin

    > Reason is that we have only one binary repository for one R-x.y.? 
    > series. On WIndows, where we check with R-4.2.3, a binary would be 
    > created and hence R-4.2.[0-1] would not see any valid Matrix binaries.

    > So please either make this work on R >= 4.2.0 or require R >= 4.3.0. If 
    > the latter, ideally with an interim version that works for R >= 4.2.0, 
    > so that we valid binaries with correct dependency declarations again.

    > Best,
    > Uwe

    >> In the mean time (i.e., while we are stuck with Matrix 1.6-1.1), it may 
    >> help
    >> to update to R 4.2.3 on r-oldrel-macos-* and/or to have EdSurvey revert its
    >> strict version requirement, unless there are clear examples justifying one.
    >> 
    >> Mikael
    >> 
    >> 
    >> On 2023-10-31 8:17 pm, Simon Urbanek wrote:
    >>> Mikael,
    >>> 
    >>> in that case I think your requirements are wrong - Matrix says R >= 
    >>> 3.5.0 which is apparently incorrect - from what you say it should be 
    >>> 4.2.2?. I can certainly update to 4.2.3 if necessary.
    >>> 
    >>> Cheers,
    >>> Simon
    >>> 
    >>> 
    >>> 
    >>>> On 1/11/2023, at 9:19 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
    >>>> 
    >>>> Thanks.? We did see those ERRORs, stemming from use (since Matrix 1.6-0)
    >>>> of amsmath commands in Rd files.? These have been supported since R 
    >>>> 4.2.2,
    >>>> but r-oldrel-macos-* (unlike r-oldrel-windows-*) continues to run R 
    >>>> 4.2.0.
    >>>> My expectation was that those machines would begin running R >= 4.2.2 
    >>>> well
    >>>> before the R 4.4.0 release, but apparently that was wrong.
    >>>> 
    >>>> I am hesitant to complicate our Rd files with conditions on R versions
    >>>> only to support PDF output for R < 4.2.2, but maybe we can consider it
    >>>> for the Matrix 1.6-2 release if it is really a barrier for others ...
    >>>> 
    >>>> Mikael
    >>>> 
    >>>> On 2023-10-31 3:33 pm, Simon Urbanek wrote:
    >>>>> Mikael,
    >>>>> current Matrix fails checks on R-oldrel so that's why only the last 
    >>>>> working version is installed:
    >>>>> https://cran.r-project.org/web/checks/check_results_Matrix.html
    >>>>> Cheers,
    >>>>> Simon
>>>>> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
    >>>>>> 
>>>>> I am guessing that they mean EdSurvey:
    >>>>>> 
>>>>> ??? https://cran.r-project.org/web/checks/check_results_EdSurvey.html
    >>>>>> 
>>>>> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
>>>>> even though it can be, because it was not released until R 4.3-z.
    >>>>>> 
>>>>> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
>>>>> even those changes should have been backwards compatible, modulo 
>>>>> handling
>>>>> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
    >>>>>> 
>>>>> So I don't see a clear reason for requiring 1.6-1.1.? Requiring 1.6-0
>>>>> might make sense, if somehow EdSurvey depends on how class sparseQR
>>>>> preserves dimnames.? But IIRC our rev. dep. checks at that time did 
>>>>> not
>>>>> reveal problems with EdSurvey.
    >>>>>> 
>>>>> Mikael
    >>>>>> 
>>>>> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
    >>>>>>> Paul,
    >>>>>>> can you give us a bit more detail? Which package, which build and 
    >>>>>>> where you got the errors? Older builds may not have the latest 
    >>>>>>> Matrix.
    >>>>>>> Cheers,
    >>>>>>> Simon
    >>>>>>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via 
    >>>>>>>> R-package-devel<r-package-devel at r-project.org>? wrote:
    >>>>>>>> 
    >>>>>>>> Hi,
    >>>>>>>> 
    >>>>>>>> I'm the maintainer for a few packages, one of which is currently 
    >>>>>>>> failing CRAN checks on Mac OS because Matrix is not available in 
    >>>>>>>> my required version (the latest). I had to fix a few things due 
    >>>>>>>> to changes in the latest Matrix package because of how qr works 
    >>>>>>>> and I thought, given the apparent API change, I should then 
    >>>>>>>> require the latest version. My error is, "Package required and 
    >>>>>>>> available but unsuitable version: 'Matrix'"
    >>>>>>>> 
    >>>>>>>> When I look at the NEWS in Matrix there is no mention of Mac OS 
    >>>>>>>> issues, what the latest stable version of Matrix is, nor when a 
    >>>>>>>> fix is expected. What version do MacOS version test Matrix with 
    >>>>>>>> by default? Where is this documented? I assumes it always tested 
    >>>>>>>> with the latest version on CRAN, so I'm a bit surprised. Or will 
    >>>>>>>> this be resolved soon and I shouldn't bother CRAN maintainers 
    >>>>>>>> with a new version of my package?
    >>>>>>>> 
    >>>>>>>> Best,
    >>>>>>>> Paul
    >>>>>>>> 
    >>>>>>>> ????[[alternative HTML version deleted]]
    >>>>>> 
    >>>> 
    >>> 
    >> 
    >> ______________________________________________
    >> R-package-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-package-devel

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel



From g@rre@@|berto @end|ng |rom gm@||@com  Wed Nov  1 12:15:02 2023
From: g@rre@@|berto @end|ng |rom gm@||@com (Alberto Garre)
Date: Wed, 1 Nov 2023 12:15:02 +0100
Subject: [R-pkg-devel] Package bioOED has been removed from CRAN just for
 personal reasons
Message-ID: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>

Dear community,

I feel dismay for having to write this email, but the issue must be brought
up. On the 20th of October, I received an email from CRAN warning me of an
issue with one of the packages I maintain (bioOED). The package depended on
MEIGOR, a package that was no longer available in Bioconductor. I was given
until 2023-11-03 to fix the issue.

I contacted the MEIGOR maintainers and they told me they were migrating to
CRAN. Yesterday, they contacted me again, telling me they needed more time
for the migration. Hence, I responded to the email I received from CRAN,
asking for an extension of the previous deadline (2023-11-03).

To my surprise, it is not just that the extension was not granted, but the
package has been removed from CRAN today (2023-11-01). Two days before the
deadline (2023-11-03): https://cran.r-project.org/package=bioOED

Then, I checked my inbox and I saw an email from one of the CRAN
maintainers, showing that the package was removed because he had felt
offended by my email. I copy-paste the email below.

I understand that maintaining CRAN must be a huge work. I also work in
academia, so I am totally aware of all the extra work that is required from
us. But it is unreasonable that a package can be removed just because a
maintainer throws a tantrum

Again, I am really sorry I had to write this email, but CRAN cannot work if
we allow this type of situation.

Kind regards,
Alberto Garre

## Mail from ............ on 2023-11-01 8:28

......................
...................... (citation of private e-mails without getting
......................  explicit permission is not allowed)
......................

>
> El vie, 20 oct 2023 a las 9:24, Alberto Garre (<garre.alberto at gmail.com>)
> escribi?:
>
>> Thank you very much,  .........
>>
>> I have just contacted the developers of MEIGOR because I think they were
>> planning a migration to CRAN. I will update the package asap.
>>
>> Best,
>> Alberto
>>
>>
>> El vie, 20 oct 2023 a las 9:22, .............................  escribi?:


...................... (citation of private e-mails without getting
......................  explicit permission is not allowed)


	[[alternative HTML version deleted]]



From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Nov  1 13:35:22 2023
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 1 Nov 2023 13:35:22 +0100
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
Message-ID: <4a046c02-7851-4b21-8a35-ebbfad393e4d@gmail.com>


On 11/1/23 12:15, Alberto Garre wrote:
> Dear community,
>
> I feel dismay for having to write this email, but the issue must be brought
> up. On the 20th of October, I received an email from CRAN warning me of an
> issue with one of the packages I maintain (bioOED). The package depended on
> MEIGOR, a package that was no longer available in Bioconductor. I was given
> until 2023-11-03 to fix the issue.
>
> I contacted the MEIGOR maintainers and they told me they were migrating to
> CRAN. Yesterday, they contacted me again, telling me they needed more time
> for the migration. Hence, I responded to the email I received from CRAN,
> asking for an extension of the previous deadline (2023-11-03).
>
> To my surprise, it is not just that the extension was not granted, but the
> package has been removed from CRAN today (2023-11-01). Two days before the
> deadline (2023-11-03): https://cran.r-project.org/package=bioOED
>
> Then, I checked my inbox and I saw an email from one of the CRAN
> maintainers, showing that the package was removed because he had felt
> offended by my email. I copy-paste the email below.

I don't think this is true. The reason is that your package depends on 
an unavailable package, so cannot be installed. See 
https://cran.r-project.org/web/packages/bioOED/index.html where the 
reason is publicly stated.

If I were you I'd simply wait once MEIGOR is on CRAN and then publish 
the archived package again.

Best,
Tomas

>
> I understand that maintaining CRAN must be a huge work. I also work in
> academia, so I am totally aware of all the extra work that is required from
> us. But it is unreasonable that a package can be removed just because a
> maintainer throws a tantrum
>
> Again, I am really sorry I had to write this email, but CRAN cannot work if
> we allow this type of situation.
>
> Kind regards,
> Alberto Garre
>
[..................... private communication removed .......................]
[..................... private communication removed .......................]

>>>>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Nov  1 14:04:33 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 1 Nov 2023 09:04:33 -0400
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <4a046c02-7851-4b21-8a35-ebbfad393e4d@gmail.com>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <4a046c02-7851-4b21-8a35-ebbfad393e4d@gmail.com>
Message-ID: <23df54fc-0e63-470e-a649-7bcee8eabcbd@gmail.com>

On 01/11/2023 8:35 a.m., Tomas Kalibera wrote:
> 
> On 11/1/23 12:15, Alberto Garre wrote:
>> Dear community,
>>
>> I feel dismay for having to write this email, but the issue must be brought
>> up. On the 20th of October, I received an email from CRAN warning me of an
>> issue with one of the packages I maintain (bioOED). The package depended on
>> MEIGOR, a package that was no longer available in Bioconductor. I was given
>> until 2023-11-03 to fix the issue.
>>
>> I contacted the MEIGOR maintainers and they told me they were migrating to
>> CRAN. Yesterday, they contacted me again, telling me they needed more time
>> for the migration. Hence, I responded to the email I received from CRAN,
>> asking for an extension of the previous deadline (2023-11-03).
>>
>> To my surprise, it is not just that the extension was not granted, but the
>> package has been removed from CRAN today (2023-11-01). Two days before the
>> deadline (2023-11-03): https://cran.r-project.org/package=bioOED
>>
>> Then, I checked my inbox and I saw an email from one of the CRAN
>> maintainers, showing that the package was removed because he had felt
>> offended by my email. I copy-paste the email below.
> 
> I don't think this is true. The reason is that your package depends on
> an unavailable package, so cannot be installed. See
> https://cran.r-project.org/web/packages/bioOED/index.html where the
> reason is publicly stated.
> 
> If I were you I'd simply wait once MEIGOR is on CRAN and then publish
> the archived package again.

I agree with that interpretation.  A possibly faster alternative would 
be to remove the dependence on MEIGOR, and resubmit once that is done 
and the package is working again.

Duncan Murdoch



From henr|k@bengt@@on @end|ng |rom gm@||@com  Wed Nov  1 17:30:19 2023
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Wed, 1 Nov 2023 09:30:19 -0700
Subject: [R-pkg-devel] CRAN archival: Does CRAN un-archive some packages
 automatically?
Message-ID: <CAFDcVCQwVMSZXKXROyP8EUQJr57Cjppfam+Q6Ca=quzopn-VWg@mail.gmail.com>

I'm asking here to spare the CRAN Team a direct message, but also
because the answer is of interest to others:

Consider a package PkgA that was archived on CRAN, because it fails
checks and errors that were not corrected in time.  At the moment when
package PkgA is archived, it will trigger automatic archiving of other
CRAN packages that has a hard dependency on it. Say, packages PkgB and
PkgC were archived automatically, because of their dependency on PkgA.

Question: If PkgA is at a later point revived on CRAN, will CRAN
unarchive PkgB and PkgC automatically? Or, should the maintainers of
PkgB and PkgC resubmit? If they have to resubmit, should they submit
identical versions and tarballs as before, or do they have to bump the
version?

/Henrik



From @p@@nder@on @end|ng |rom gm@||@com  Wed Nov  1 17:48:15 2023
From: @p@@nder@on @end|ng |rom gm@||@com (Steven P Sanderson II)
Date: Wed, 1 Nov 2023 12:48:15 -0400
Subject: [R-pkg-devel] CRAN archival: Does CRAN un-archive some packages
 automatically?
In-Reply-To: <CAFDcVCQwVMSZXKXROyP8EUQJr57Cjppfam+Q6Ca=quzopn-VWg@mail.gmail.com>
References: <CAFDcVCQwVMSZXKXROyP8EUQJr57Cjppfam+Q6Ca=quzopn-VWg@mail.gmail.com>
Message-ID: <CALXsb3KCJ1_4EgGaQt1cQvA98yyu59MgVAJjPfg6HMaWNYuktA@mail.gmail.com>

I believe the version must be bumped and pushed. This was the case for me
as my package was not un-archived.

On Wed, Nov 1, 2023 at 12:31?PM Henrik Bengtsson <henrik.bengtsson at gmail.com>
wrote:

> I'm asking here to spare the CRAN Team a direct message, but also
> because the answer is of interest to others:
>
> Consider a package PkgA that was archived on CRAN, because it fails
> checks and errors that were not corrected in time.  At the moment when
> package PkgA is archived, it will trigger automatic archiving of other
> CRAN packages that has a hard dependency on it. Say, packages PkgB and
> PkgC were archived automatically, because of their dependency on PkgA.
>
> Question: If PkgA is at a later point revived on CRAN, will CRAN
> unarchive PkgB and PkgC automatically? Or, should the maintainers of
> PkgB and PkgC resubmit? If they have to resubmit, should they submit
> identical versions and tarballs as before, or do they have to bump the
> version?
>
> /Henrik
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


-- 
Steven P Sanderson II, MPH
Book on Lulu <http://goo.gl/lmrlFI>
Personal Site <http://www.spsanderson.com>

	[[alternative HTML version deleted]]



From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Nov  1 17:51:56 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 1 Nov 2023 12:51:56 -0400
Subject: [R-pkg-devel] CRAN archival: Does CRAN un-archive some packages
 automatically?
In-Reply-To: <CAFDcVCQwVMSZXKXROyP8EUQJr57Cjppfam+Q6Ca=quzopn-VWg@mail.gmail.com>
References: <CAFDcVCQwVMSZXKXROyP8EUQJr57Cjppfam+Q6Ca=quzopn-VWg@mail.gmail.com>
Message-ID: <62c94746-fee6-4192-8d5e-31c8f193806a@gmail.com>

On 01/11/2023 12:30 p.m., Henrik Bengtsson wrote:
> I'm asking here to spare the CRAN Team a direct message, but also
> because the answer is of interest to others:
> 
> Consider a package PkgA that was archived on CRAN, because it fails
> checks and errors that were not corrected in time.  At the moment when
> package PkgA is archived, it will trigger automatic archiving of other
> CRAN packages that has a hard dependency on it. Say, packages PkgB and
> PkgC were archived automatically, because of their dependency on PkgA.
> 
> Question: If PkgA is at a later point revived on CRAN, will CRAN
> unarchive PkgB and PkgC automatically? Or, should the maintainers of
> PkgB and PkgC resubmit? If they have to resubmit, should they submit
> identical versions and tarballs as before, or do they have to bump the
> version?

I don't know the answer to your first question, but I'd guess "no".  The 
maintainers of PkgB and PkgC should have already resubmitted, demoting 
PkgA to a "Suggests:" dependency or dropping it completely.

If they chose not to do that, then at the hypothetical time when PkgA is 
revived, each of PkgB and PkgC would need full testing to see if they 
were passing the current versions of the CRAN checks with the new 
version of PkgA.  That's something for their maintainers to do, not CRAN.

Regarding your last question:  if it turns out the original version 
still passes with the new PkgA, then I think it's still better to bump 
the version number.  It would need an exception to the usual "new 
submissions need new version numbers" rule.  Exceptions waste CRAN's time.

Duncan Murdoch



From m@rku@joch|m @end|ng |rom phonet|k@un|-muenchen@de  Wed Nov  1 19:54:28 2023
From: m@rku@joch|m @end|ng |rom phonet|k@un|-muenchen@de (Markus Jochim)
Date: Wed, 1 Nov 2023 19:54:28 +0100
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <23df54fc-0e63-470e-a649-7bcee8eabcbd@gmail.com>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <4a046c02-7851-4b21-8a35-ebbfad393e4d@gmail.com>
 <23df54fc-0e63-470e-a649-7bcee8eabcbd@gmail.com>
Message-ID: <b7a9e926-04fe-4bbd-8f83-f1a353b5d35f@phonetik.uni-muenchen.de>

Dear Alberto,

I have had a small number of CRAN-related email exchanges ..........
made it clear that his idea of politeness and my idea of 
politeness are incompatible. The email you are quoting reminds me very 
much of these exchanges.

But I try to be pragmatic about it. It?s not the end of the world if my 
packages are not on CRAN for a couple of weeks. In the end, they were 
archived because tests were failing and they were always (re-)accepted 
into CRAN once the automatic tests passed again. No personal matters 
involved.

.................  As a package 
maintainer, I am also contributing my share, especially towards my own 
discipline, and so are you. That is why there is contact in the first 
place. I wouldn't care too much whether or not that allows either of us 
to consider the other a peer.

I don?t know why your package appears to have been archived two days 
early. But otherwise I agree with Tomas and Duncan. There is a clear 
path forward for your package. Based on my own experience, there is no 
reason to believe that it will be rejected by CRAN on personal grounds, 
once the automatic tests pass.

Best

Markus



From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Nov  1 22:39:39 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 1 Nov 2023 17:39:39 -0400
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <b7a9e926-04fe-4bbd-8f83-f1a353b5d35f@phonetik.uni-muenchen.de>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <4a046c02-7851-4b21-8a35-ebbfad393e4d@gmail.com>
 <23df54fc-0e63-470e-a649-7bcee8eabcbd@gmail.com>
 <b7a9e926-04fe-4bbd-8f83-f1a353b5d35f@phonetik.uni-muenchen.de>
Message-ID: <82f58a3d-0457-4478-a7ca-6916249fa57a@gmail.com>

On 01/11/2023 2:54 p.m., Markus Jochim wrote:
> Dear Alberto,
> 
> I have had a small number of CRAN-related email exchanges ............
> made it clear that his idea of politeness and my idea of
> politeness are incompatible. The email you are quoting reminds me very
> much of these exchanges.
> 

My idea of politeness, and I think also .......'s, is that you 
don't discuss private discussions in public without agreement from all 
parties.

Duncan Murdoch



From tony_@_w||ke@ @end|ng |rom out|ook@com  Thu Nov  2 08:58:12 2023
From: tony_@_w||ke@ @end|ng |rom out|ook@com (Tony Wilkes)
Date: Thu, 2 Nov 2023 07:58:12 +0000
Subject: [R-pkg-devel] Unclear NOTE for  r-devel-linux-x86_64-debian-clang
Message-ID: <AS4P195MB14301A73A9C45909B0C27802BEA6A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>

Hi everyone,

I updated my package, but found a NOTE for r-devel-linux-x86_64-debian-clang.
See https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-debian-clang/tinycodet-00check.html.

The NOTE is:
checking HTML version of manual ... [3s/5s] NOTE
Found the following HTML validation problems:
pkgs.html:66:9 (pkgs.Rd:24): Warning: <code> anchor "pkgs" already defined

As is often the case, these NOTES do not inform me at all. What does this NOTE entail exactly, and why is the issue only present for Debian?

Kind regards,

Tony.

	[[alternative HTML version deleted]]



From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Nov  2 09:24:49 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 2 Nov 2023 04:24:49 -0400
Subject: [R-pkg-devel] 
 Unclear NOTE for r-devel-linux-x86_64-debian-clang
In-Reply-To: <AS4P195MB14301A73A9C45909B0C27802BEA6A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB14301A73A9C45909B0C27802BEA6A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <4fcf6823-4511-416b-9e63-2c26d7098d6e@gmail.com>

On 02/11/2023 3:58 a.m., Tony Wilkes wrote:
> Hi everyone,
> 
> I updated my package, but found a NOTE for r-devel-linux-x86_64-debian-clang.
> See https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-debian-clang/tinycodet-00check.html.
> 
> The NOTE is:
> checking HTML version of manual ... [3s/5s] NOTE
> Found the following HTML validation problems:
> pkgs.html:66:9 (pkgs.Rd:24): Warning: <code> anchor "pkgs" already defined
> 
> As is often the case, these NOTES do not inform me at all. What does this NOTE entail exactly, and why is the issue only present for Debian?

That sounds like a bug in the check code which has been fixed.  Do you 
have a function named pkgs() with an argument also named pkgs?

Duncan Murdoch



From kry|ov@r00t @end|ng |rom gm@||@com  Thu Nov  2 09:28:08 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 2 Nov 2023 11:28:08 +0300
Subject: [R-pkg-devel] 
 Unclear NOTE for  r-devel-linux-x86_64-debian-clang
In-Reply-To: <AS4P195MB14301A73A9C45909B0C27802BEA6A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
References: <AS4P195MB14301A73A9C45909B0C27802BEA6A@AS4P195MB1430.EURP195.PROD.OUTLOOK.COM>
Message-ID: <20231102112808.0e6b0925@Tarkus>

On Thu, 2 Nov 2023 07:58:12 +0000
Tony Wilkes <tony_a_wilkes at outlook.com> wrote:

> pkgs.html:66:9 (pkgs.Rd:24): Warning: <code> anchor "pkgs" already
> defined

Looks like the same problem as here:
https://stat.ethz.ch/pipermail/r-package-devel/2023q4/009790.html

Should have been fixed in SVN r85440. Unfortunately, the check machine
is still running r85433. This NOTE should go away by itself after a
while.

-- 
Best regards,
Ivan



From rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r  Thu Nov  2 10:38:56 2023
From: rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r (Romain Pierlot)
Date: Thu, 2 Nov 2023 10:38:56 +0100 (CET)
Subject: [R-pkg-devel] Issue with R Package on CRAN - OpenMP and clang17
In-Reply-To: <20231031195805.015bd26a@arachnoid>
References: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
 <20231030185229.385fe389@arachnoid> <20231031195805.015bd26a@arachnoid>
Message-ID: <1913849935.163048.1698917936966.JavaMail.zimbra@u-bordeaux.fr>

I really appreciate your assistance, and the time you dedicated to building LLVM ! 

I noticed that you've posted the issue on GitHub, thanks for this too, I'll stay updated and regularly check the answers. 

Does a compiler bug imply that the issue doesn't come from from the code?

Once again, thank you for your help!

Romain 








----- Mail original -----
De: "Ivan Krylov" <krylov.r00t at gmail.com>
?: "Romain Pierlot" <romain.pierlot at u-bordeaux.fr>
Cc: "r-package-devel" <r-package-devel at r-project.org>
Envoy?: Mardi 31 Octobre 2023 17:58:05
Objet: Re: [R-pkg-devel] Issue with R Package on CRAN - OpenMP and clang17

? Mon, 30 Oct 2023 18:52:29 +0300
Ivan Krylov <krylov.r00t at gmail.com> ?????:

> I'll try to reproduce your problem, starting by downloading and
> compiling flang from https://github.com/llvm/llvm-project.git commit
> 092b6c5ee3707ea10b9f10d0a674e8d12395369b (as stated at
> <https://www.stats.ox.ac.uk/pub/bdr/clang17/frailtypack.log>)

Wow. Building LLVM is an adventure, and I don't mean it in a good way.
I had to patch flang/include/flang/Semantics/symbol.h because it
declares `friend class std::array` while my copy of the C++ standard
library has a `struct std::array`, which makes the friend declaration
an error. Naively thinking that I would be helping debug the problem, I
tried compiling a debugging build of LLVM, only to watch in horror as
it consumed all disk space I could offer it. I eventually ran out of
things to delete after the build directory reached 100 gigabytes in
size, while the build still had 1000 out of 6000 targets to compile and
link. Even the release build failed at 410 remaining targets because of
a missing -fPIC somewhere in the compiler command line. Thankfully, it
still produced a working `flang-new` executable.

A release build of LLVM + flang-new takes a relatively reasonable 
8.2 GBytes of storage. The computers that helped launch the first
people into space had 2 kWords of memory, but nowadays you need more
than 256 MBytes of RAM to launch a bird into a pig and 10 GBytes of
storage in order to compile a compiler. This is what progress looks
like.

I was able to reduce the example to the following program:

program main
    implicit none

    real :: sum = 0
    integer :: i, n = 10

    sum = sum + 1. ! <-- error here if followed by OpenMP reduction

    !$OMP PARALLEL DO default(none) PRIVATE (i) SHARED(n) &
    !$OMP REDUCTION(+:sum) SCHEDULE(Dynamic,1)
    do i=1,n
        sum = sum + real(i)
    end do
    !$OMP END PARALLEL DO

    print *, sum
end

% flang-new -c -o /dev/null src.f90 -fopenmp
error: loc("src.f90":7:5): 'omp.reduction' op must be used within an
operation supporting reduction clause interface
error: verification of lowering to FIR failed

gfortran raises no errors or warnings for the test program. Bug
reported at <https://github.com/llvm/llvm-project/issues/70828>.

Would that be enough proof of a compiler bug, or do we need a
confirmation from the developers?

-- 
Best regards,
Ivan
-- 
[ https://www.u-bordeaux.fr/ ] [ http://www.aquitaine-poitou-charentes.inserm.fr/ ] 

[ mailto: | Romain Pierlot ] 
Ing?nieur de recherches Bio-Informatique 
?quipe BIOSTAT 


[ https://www.u-bordeaux.fr/ | https://www.u-bordeaux.fr ]



From kry|ov@r00t @end|ng |rom gm@||@com  Thu Nov  2 10:52:54 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 2 Nov 2023 12:52:54 +0300
Subject: [R-pkg-devel] Issue with R Package on CRAN - OpenMP and clang17
In-Reply-To: <1913849935.163048.1698917936966.JavaMail.zimbra@u-bordeaux.fr>
References: <246366687.35114098.1698677911336.JavaMail.zimbra@u-bordeaux.fr>
 <20231030185229.385fe389@arachnoid>
 <20231031195805.015bd26a@arachnoid>
 <1913849935.163048.1698917936966.JavaMail.zimbra@u-bordeaux.fr>
Message-ID: <20231102125254.337a3f7c@arachnoid>

? Thu, 2 Nov 2023 10:38:56 +0100 (CET)
Romain Pierlot <romain.pierlot at u-bordeaux.fr> ?????:

> Does a compiler bug imply that the issue doesn't come from from the
> code?

Yes. I'm sure (corrections welcome!) that it's not an error to use a
Fortran variable before an OpenMP parallel block that also uses it for
a reduction operation.

One more OpenMP-related problem that may still bite you is having to
limit the number of threads. Since there's currently no centralised way
of regulating all kinds of parallelism used in a given R session [1],
you will have to use no more than two threads by default [2], although
you are always welcome to start more if the user explicitly passes such
an option to one of your functions.

(I'm trying to help with this [3], but it may take a long while to
implement properly and even longer to ensure that this is the right
solution from both technical and social viewpoints.)

-- 
Best regards,
Ivan

[1] https://stat.ethz.ch/pipermail/r-package-devel/2023q3/009513.html

[2] https://cran.r-project.org/web/packages/policies.html

[3] https://stat.ethz.ch/pipermail/r-package-devel/2023q4/009769.html



From kry|ov@r00t @end|ng |rom gm@||@com  Thu Nov  2 11:44:52 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 2 Nov 2023 13:44:52 +0300
Subject: [R-pkg-devel] RFC: an interface to manage use of parallelism in
 packages
In-Reply-To: <CALOkxuyHdA+=ywL5LFhsXbDrtaMz7m2bC8bs8XFmLRjdvT0ssw@mail.gmail.com>
References: <20231025155529.0f83fc93@arachnoid>
 <CALOkxuyHdA+=ywL5LFhsXbDrtaMz7m2bC8bs8XFmLRjdvT0ssw@mail.gmail.com>
Message-ID: <20231102134452.10a3bcd2@arachnoid>

? Wed, 25 Oct 2023 13:54:53 -0700
"Reed A. Cartwright" <racartwright at gmail.com> ?????:

> For a comparison, I'd recommend looking at how GNU make does parallel
> processing. It uses the concept of job server and job slots. What I
> like about it is that it is implemented at the OS level because make
> needs to support interacting with non-make processes. On Windows it
> uses a named semaphore, and on Unix-like system it uses named pipes
> or simple pipes to pass tokens around.

Thank you for pointing me towards the job server in GNU make! This is
exactly the kind of suggestion I was looking for. I also appreciate you
signing up for an account on Codeberg to give me a more detailed
writeup.

I agree that named semaphores seem to be a better fit for the job than
my first design. There are some corner cases to handle (what if the
parent process starts up and the semaphore already exists? what if the
user wants to reduce the allowance but the semaphore count is lower than
expected? what are the stongest restrictions on a POSIX semaphore name?
I've seen implementations placing them under /dev/shm%s and /tmp/%s.sem
so far), but it should be possible for me to implement the core concept
in a few days.

Additional care might be needed regarding the number of BLAS threads. R
might have to become its own FlexiBLAS and pass an additional
environment variable to children to ensure the limit being taken into
account.

-- 
Best regards,
Ivan



From j@g@nmn2 @end|ng |rom gm@||@com  Wed Nov  1 20:38:16 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Wed, 1 Nov 2023 15:38:16 -0400
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <7a1396e0-e01f-48aa-8ecc-8eafe6dd1692@gmail.com>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
 <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
 <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>
 <17E1FF10-6C44-468F-9E55-C67F792F12C6@R-project.org>
 <577444ff-2481-4a39-9e05-ea8939b3f5a5@gmail.com>
 <05d496e1-18af-e406-08fe-9c62c6c6540f@statistik.tu-dortmund.de>
 <25922.5427.225938.135970@stat.math.ethz.ch>
 <7a1396e0-e01f-48aa-8ecc-8eafe6dd1692@gmail.com>
Message-ID: <49278e76-4e57-4386-a6c0-274a1a6fb83d-7302@gmail.com>




On 2023-11-01 12:59 pm, Mikael Jagan wrote:
> A hack that seems to work is (whitespace added for readability):
> 
>       \newcommand{\Seqn}{
>         \ifelse{latex}{
>           \Sexpr[results=rd]{if (getRversion() < "4.2.2") "\\\\\\\\eqn{#1}" else
> "\\\\\\\\eqn{#2}"}
>         }{
>           \ifelse{html}{
>             \Sexpr[results=rd]{if (getRversion() < "4.2.0") "\\\\\\\\eqn{#1}"
> else "\\\\\\\\eqn{#2}"}
>           }{
>             \Sexpr[results=rd]{"\\\\\\\\eqn{#2}"}
>           }
>         }
>       }

Er, the above is wrong, because '<' should be '>=' and because '#2' (which
is conceptually verbatim text) should use \verb{} for PDF and HTML output,
not \eqn{}.  For Matrix 1.6-2 I have created man/macros/local.Rd and added:

\newcommand{\Seqn}{\ifelse{latex}{\Sexpr[results=rd]{if (getRversion() >= 
"4.2.2") "\\\\\\\\eqn{#1}" else 
"\\\\\\\\verb{#2}"}}{\ifelse{html}{\Sexpr[results=rd]{if (getRversion() >= 
"4.2.0") "\\\\\\\\eqn{#1}" else 
"\\\\\\\\verb{#2}"}}{\Sexpr[results=rd]{"\\\\\\\\eqn{#2}"}}}}

\newcommand{\Sdeqn}{\ifelse{latex}{\Sexpr[results=rd]{if (getRversion() >= 
"4.2.2") "\\\\\\\\deqn{#1}" else 
"\\\\\\\\preformatted{#2}"}}{\ifelse{html}{\Sexpr[results=rd]{if (getRversion() 
 >= "4.2.0") "\\\\\\\\deqn{#1}" else 
"\\\\\\\\preformatted{#2}"}}{\Sexpr[results=rd]{"\\\\\\\\deqn{#2}"}}}}

Now Matrix 1.6-2 passes its Rd checks under my checkout of R-3-5-branch.
Some examples and tests fail for unrelated reasons.  I'll fix those, too ...

Mikael

> 
> as amsmath support for PDF output and KaTeX support for HTML output
> were introduced in R 4.2.2 and 4.2.0, respectively.
> 
> Sadly I really do seem to need 8 escapes:
> 
>       \Seqn{\\\\\\\\text{min}(m,n) \\\\\\\\times n}{min(m,n)-by-n}
> 
> Maybe one of the Rd experts here can suggest an improvement ...
> 
> Mikael
> 
> On 2023-11-01 5:06 am, Martin Maechler wrote:
>>>>>>> Uwe Ligges
>>>>>>>       on Wed, 1 Nov 2023 06:26:23 +0100 writes:
>>
>>       > On 01.11.2023 03:51, Mikael Jagan wrote:
>>       >> Thanks.? It seems that we were mistaken in our feeling (IIRC) that it would
>>       >> be "OK" to implicitly require '--no-manual' on versions of R from 3.5.0 to
>>       >> 4.2.1, not changing our Depends.
>>       >>
>>       >> We will fix this in Matrix 1.6-2, probably by conditionalizing or otherwise
>>       >> replacing the amsmath commands and probably _not_ by changing to depend on
>>       >> R >= 4.2.2.? Martin may have more to say in "the morning".
>>
>> I agree (*not* to raise Matrix pkg's R version dependency).
>>
>>       > Note that dependin on R >= 4.2.2 does not work. We need dependencies of
>>       > the form R >= x.y.0. This is also part of the checks.
>>
>> Yes, indeed.
>> And as we learned, R >= 4.2.0 would not help for r-oldrel-macos
>>
>> I (am unhappy but) agree to take the responsibility for our
>> decision to go ahead and use much nicer LaTeX formula for
>> matrices etc, in our help pages {thinking that indeed people who'd
>> install Matrix on an old R version would always be able to read
>> Matrix manual pages via web search (as it seems to me 95% of
>> people do nowadays) ... or then have someone in their
>> organization to figure out how to use a newer amsmath (latex) package if
>>    they really really want the Matrix pdf manual offline}.
>>
>> Martin
>>
>>       > Reason is that we have only one binary repository for one R-x.y.?
>>       > series. On WIndows, where we check with R-4.2.3, a binary would be
>>       > created and hence R-4.2.[0-1] would not see any valid Matrix binaries.
>>
>>       > So please either make this work on R >= 4.2.0 or require R >= 4.3.0. If
>>       > the latter, ideally with an interim version that works for R >= 4.2.0,
>>       > so that we valid binaries with correct dependency declarations again.
>>
>>       > Best,
>>       > Uwe
>>
>>       >> In the mean time (i.e., while we are stuck with Matrix 1.6-1.1), it may
>>       >> help
>>       >> to update to R 4.2.3 on r-oldrel-macos-* and/or to have EdSurvey revert its
>>       >> strict version requirement, unless there are clear examples justifying one.
>>       >>
>>       >> Mikael
>>       >>
>>       >>
>>       >> On 2023-10-31 8:17 pm, Simon Urbanek wrote:
>>       >>> Mikael,
>>       >>>
>>       >>> in that case I think your requirements are wrong - Matrix says R >=
>>       >>> 3.5.0 which is apparently incorrect - from what you say it should be
>>       >>> 4.2.2?. I can certainly update to 4.2.3 if necessary.
>>       >>>
>>       >>> Cheers,
>>       >>> Simon
>>       >>>
>>       >>>
>>       >>>
>>       >>>> On 1/11/2023, at 9:19 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>       >>>>
>>       >>>> Thanks.? We did see those ERRORs, stemming from use (since Matrix 1.6-0)
>>       >>>> of amsmath commands in Rd files.? These have been supported since R
>>       >>>> 4.2.2,
>>       >>>> but r-oldrel-macos-* (unlike r-oldrel-windows-*) continues to run R
>>       >>>> 4.2.0.
>>       >>>> My expectation was that those machines would begin running R >= 4.2.2
>>       >>>> well
>>       >>>> before the R 4.4.0 release, but apparently that was wrong.
>>       >>>>
>>       >>>> I am hesitant to complicate our Rd files with conditions on R versions
>>       >>>> only to support PDF output for R < 4.2.2, but maybe we can consider it
>>       >>>> for the Matrix 1.6-2 release if it is really a barrier for others ...
>>       >>>>
>>       >>>> Mikael
>>       >>>>
>>       >>>> On 2023-10-31 3:33 pm, Simon Urbanek wrote:
>>       >>>>> Mikael,
>>       >>>>> current Matrix fails checks on R-oldrel so that's why only the last
>>       >>>>> working version is installed:
>>       >>>>> https://cran.r-project.org/web/checks/check_results_Matrix.html
>>       >>>>> Cheers,
>>       >>>>> Simon
>>>>>>> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>>       >>>>>>
>>>>>>> I am guessing that they mean EdSurvey:
>>       >>>>>>
>>>>>>>   ??? https://cran.r-project.org/web/checks/check_results_EdSurvey.html
>>       >>>>>>
>>>>>>> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
>>>>>>> even though it can be, because it was not released until R 4.3-z.
>>       >>>>>>
>>>>>>> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
>>>>>>> even those changes should have been backwards compatible, modulo
>>>>>>> handling
>>>>>>> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
>>       >>>>>>
>>>>>>> So I don't see a clear reason for requiring 1.6-1.1.? Requiring 1.6-0
>>>>>>> might make sense, if somehow EdSurvey depends on how class sparseQR
>>>>>>> preserves dimnames.? But IIRC our rev. dep. checks at that time did
>>>>>>> not
>>>>>>> reveal problems with EdSurvey.
>>       >>>>>>
>>>>>>> Mikael
>>       >>>>>>
>>>>>>> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>>       >>>>>>> Paul,
>>       >>>>>>> can you give us a bit more detail? Which package, which build and
>>       >>>>>>> where you got the errors? Older builds may not have the latest
>>       >>>>>>> Matrix.
>>       >>>>>>> Cheers,
>>       >>>>>>> Simon
>>       >>>>>>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via
>>       >>>>>>>> R-package-devel<r-package-devel at r-project.org>? wrote:
>>       >>>>>>>>
>>       >>>>>>>> Hi,
>>       >>>>>>>>
>>       >>>>>>>> I'm the maintainer for a few packages, one of which is currently
>>       >>>>>>>> failing CRAN checks on Mac OS because Matrix is not available in
>>       >>>>>>>> my required version (the latest). I had to fix a few things due
>>       >>>>>>>> to changes in the latest Matrix package because of how qr works
>>       >>>>>>>> and I thought, given the apparent API change, I should then
>>       >>>>>>>> require the latest version. My error is, "Package required and
>>       >>>>>>>> available but unsuitable version: 'Matrix'"
>>       >>>>>>>>
>>       >>>>>>>> When I look at the NEWS in Matrix there is no mention of Mac OS
>>       >>>>>>>> issues, what the latest stable version of Matrix is, nor when a
>>       >>>>>>>> fix is expected. What version do MacOS version test Matrix with
>>       >>>>>>>> by default? Where is this documented? I assumes it always tested
>>       >>>>>>>> with the latest version on CRAN, so I'm a bit surprised. Or will
>>       >>>>>>>> this be resolved soon and I shouldn't bother CRAN maintainers
>>       >>>>>>>> with a new version of my package?
>>       >>>>>>>>
>>       >>>>>>>> Best,
>>       >>>>>>>> Paul
>>       >>>>>>>>
>>       >>>>>>>> ????[[alternative HTML version deleted]]
>>       >>>>>>
>>       >>>>
>>       >>>
>>       >>
>>       >> ______________________________________________
>>       >> R-package-devel at r-project.org mailing list
>>       >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>       > ______________________________________________
>>       > R-package-devel at r-project.org mailing list
>>       > https://stat.ethz.ch/mailman/listinfo/r-package-devel



From j@g@nmn2 @end|ng |rom gm@||@com  Wed Nov  1 17:59:14 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Wed, 1 Nov 2023 12:59:14 -0400
Subject: [R-pkg-devel] Matrix and Mac OS
In-Reply-To: <25922.5427.225938.135970@stat.math.ethz.ch>
References: <mailman.9798.11.1698750002.49509.r-package-devel@r-project.org>
 <6f90cb89-8362-49ad-85f4-befd187c60e9@gmail.com>
 <71D3531C-EA60-4688-83E5-CB2DD64227B1@R-project.org>
 <f9454540-b0f8-41a2-b3f4-ef6da1052708@gmail.com>
 <17E1FF10-6C44-468F-9E55-C67F792F12C6@R-project.org>
 <577444ff-2481-4a39-9e05-ea8939b3f5a5@gmail.com>
 <05d496e1-18af-e406-08fe-9c62c6c6540f@statistik.tu-dortmund.de>
 <25922.5427.225938.135970@stat.math.ethz.ch>
Message-ID: <7a1396e0-e01f-48aa-8ecc-8eafe6dd1692-527@gmail.com>


A hack that seems to work is (whitespace added for readability):

     \newcommand{\Seqn}{
       \ifelse{latex}{
         \Sexpr[results=rd]{if (getRversion() < "4.2.2") "\\\\\\\\eqn{#1}" else 
"\\\\\\\\eqn{#2}"}
       }{
         \ifelse{html}{
           \Sexpr[results=rd]{if (getRversion() < "4.2.0") "\\\\\\\\eqn{#1}" 
else "\\\\\\\\eqn{#2}"}
         }{
           \Sexpr[results=rd]{"\\\\\\\\eqn{#2}"}
         }
       }
     }

as amsmath support for PDF output and KaTeX support for HTML output
were introduced in R 4.2.2 and 4.2.0, respectively.

Sadly I really do seem to need 8 escapes:

     \Seqn{\\\\\\\\text{min}(m,n) \\\\\\\\times n}{min(m,n)-by-n}

Maybe one of the Rd experts here can suggest an improvement ...

Mikael

On 2023-11-01 5:06 am, Martin Maechler wrote:
>>>>>> Uwe Ligges
>>>>>>      on Wed, 1 Nov 2023 06:26:23 +0100 writes:
> 
>      > On 01.11.2023 03:51, Mikael Jagan wrote:
>      >> Thanks.? It seems that we were mistaken in our feeling (IIRC) that it would
>      >> be "OK" to implicitly require '--no-manual' on versions of R from 3.5.0 to
>      >> 4.2.1, not changing our Depends.
>      >>
>      >> We will fix this in Matrix 1.6-2, probably by conditionalizing or otherwise
>      >> replacing the amsmath commands and probably _not_ by changing to depend on
>      >> R >= 4.2.2.? Martin may have more to say in "the morning".
> 
> I agree (*not* to raise Matrix pkg's R version dependency).
> 
>      > Note that dependin on R >= 4.2.2 does not work. We need dependencies of
>      > the form R >= x.y.0. This is also part of the checks.
> 
> Yes, indeed.
> And as we learned, R >= 4.2.0 would not help for r-oldrel-macos
> 
> I (am unhappy but) agree to take the responsibility for our
> decision to go ahead and use much nicer LaTeX formula for
> matrices etc, in our help pages {thinking that indeed people who'd
> install Matrix on an old R version would always be able to read
> Matrix manual pages via web search (as it seems to me 95% of
> people do nowadays) ... or then have someone in their
> organization to figure out how to use a newer amsmath (latex) package if
>   they really really want the Matrix pdf manual offline}.
> 
> Martin
> 
>      > Reason is that we have only one binary repository for one R-x.y.?
>      > series. On WIndows, where we check with R-4.2.3, a binary would be
>      > created and hence R-4.2.[0-1] would not see any valid Matrix binaries.
> 
>      > So please either make this work on R >= 4.2.0 or require R >= 4.3.0. If
>      > the latter, ideally with an interim version that works for R >= 4.2.0,
>      > so that we valid binaries with correct dependency declarations again.
> 
>      > Best,
>      > Uwe
> 
>      >> In the mean time (i.e., while we are stuck with Matrix 1.6-1.1), it may
>      >> help
>      >> to update to R 4.2.3 on r-oldrel-macos-* and/or to have EdSurvey revert its
>      >> strict version requirement, unless there are clear examples justifying one.
>      >>
>      >> Mikael
>      >>
>      >>
>      >> On 2023-10-31 8:17 pm, Simon Urbanek wrote:
>      >>> Mikael,
>      >>>
>      >>> in that case I think your requirements are wrong - Matrix says R >=
>      >>> 3.5.0 which is apparently incorrect - from what you say it should be
>      >>> 4.2.2?. I can certainly update to 4.2.3 if necessary.
>      >>>
>      >>> Cheers,
>      >>> Simon
>      >>>
>      >>>
>      >>>
>      >>>> On 1/11/2023, at 9:19 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>      >>>>
>      >>>> Thanks.? We did see those ERRORs, stemming from use (since Matrix 1.6-0)
>      >>>> of amsmath commands in Rd files.? These have been supported since R
>      >>>> 4.2.2,
>      >>>> but r-oldrel-macos-* (unlike r-oldrel-windows-*) continues to run R
>      >>>> 4.2.0.
>      >>>> My expectation was that those machines would begin running R >= 4.2.2
>      >>>> well
>      >>>> before the R 4.4.0 release, but apparently that was wrong.
>      >>>>
>      >>>> I am hesitant to complicate our Rd files with conditions on R versions
>      >>>> only to support PDF output for R < 4.2.2, but maybe we can consider it
>      >>>> for the Matrix 1.6-2 release if it is really a barrier for others ...
>      >>>>
>      >>>> Mikael
>      >>>>
>      >>>> On 2023-10-31 3:33 pm, Simon Urbanek wrote:
>      >>>>> Mikael,
>      >>>>> current Matrix fails checks on R-oldrel so that's why only the last
>      >>>>> working version is installed:
>      >>>>> https://cran.r-project.org/web/checks/check_results_Matrix.html
>      >>>>> Cheers,
>      >>>>> Simon
>>>>>> On 1/11/2023, at 4:05 AM, Mikael Jagan <jaganmn2 at gmail.com> wrote:
>      >>>>>>
>>>>>> I am guessing that they mean EdSurvey:
>      >>>>>>
>>>>>>  ??? https://cran.r-project.org/web/checks/check_results_EdSurvey.html
>      >>>>>>
>>>>>> Probably Matrix 1.6-1.1 is not installed on r-oldrel-macos-arm64,
>>>>>> even though it can be, because it was not released until R 4.3-z.
>      >>>>>>
>>>>>> AFAIK, methods for 'qr' have not been touched since Matrix 1.6-0, and
>>>>>> even those changes should have been backwards compatible, modulo
>>>>>> handling
>>>>>> of dimnames (class sparseQR gained a Dimnames slot in 1.6-0).
>      >>>>>>
>>>>>> So I don't see a clear reason for requiring 1.6-1.1.? Requiring 1.6-0
>>>>>> might make sense, if somehow EdSurvey depends on how class sparseQR
>>>>>> preserves dimnames.? But IIRC our rev. dep. checks at that time did
>>>>>> not
>>>>>> reveal problems with EdSurvey.
>      >>>>>>
>>>>>> Mikael
>      >>>>>>
>>>>>> On 2023-10-31 7:00 am, r-package-devel-request at r-project.org wrote:
>      >>>>>>> Paul,
>      >>>>>>> can you give us a bit more detail? Which package, which build and
>      >>>>>>> where you got the errors? Older builds may not have the latest
>      >>>>>>> Matrix.
>      >>>>>>> Cheers,
>      >>>>>>> Simon
>      >>>>>>>> On 31/10/2023, at 11:26 AM, Bailey, Paul via
>      >>>>>>>> R-package-devel<r-package-devel at r-project.org>? wrote:
>      >>>>>>>>
>      >>>>>>>> Hi,
>      >>>>>>>>
>      >>>>>>>> I'm the maintainer for a few packages, one of which is currently
>      >>>>>>>> failing CRAN checks on Mac OS because Matrix is not available in
>      >>>>>>>> my required version (the latest). I had to fix a few things due
>      >>>>>>>> to changes in the latest Matrix package because of how qr works
>      >>>>>>>> and I thought, given the apparent API change, I should then
>      >>>>>>>> require the latest version. My error is, "Package required and
>      >>>>>>>> available but unsuitable version: 'Matrix'"
>      >>>>>>>>
>      >>>>>>>> When I look at the NEWS in Matrix there is no mention of Mac OS
>      >>>>>>>> issues, what the latest stable version of Matrix is, nor when a
>      >>>>>>>> fix is expected. What version do MacOS version test Matrix with
>      >>>>>>>> by default? Where is this documented? I assumes it always tested
>      >>>>>>>> with the latest version on CRAN, so I'm a bit surprised. Or will
>      >>>>>>>> this be resolved soon and I shouldn't bother CRAN maintainers
>      >>>>>>>> with a new version of my package?
>      >>>>>>>>
>      >>>>>>>> Best,
>      >>>>>>>> Paul
>      >>>>>>>>
>      >>>>>>>> ????[[alternative HTML version deleted]]
>      >>>>>>
>      >>>>
>      >>>
>      >>
>      >> ______________________________________________
>      >> R-package-devel at r-project.org mailing list
>      >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
>      > ______________________________________________
>      > R-package-devel at r-project.org mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel



From d@v|dhughjone@ @end|ng |rom gm@||@com  Wed Nov  1 17:10:34 2023
From: d@v|dhughjone@ @end|ng |rom gm@||@com (David Hugh-Jones)
Date: Wed, 1 Nov 2023 16:10:34 +0000
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
Message-ID: <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>

Aside from the package question, surely the other issue here is that ........
 email is extraordinarily rude. Any paid employee would be sacked
for that. I appreciate R and CRAN are volunteer-run organisations, but I
don?t think that should be an excuse for this level of, frankly, toxicity.
Why is he allowed to get away with it?

David

On Wed, 1 Nov 2023 at 11:15, Alberto Garre <garre.alberto at gmail.com> wrote:

> Dear community,
>
> I feel dismay for having to write this email, but the issue must be brought
> up. On the 20th of October, I received an email from CRAN warning me of an
> issue with one of the packages I maintain (bioOED). The package depended on
> MEIGOR, a package that was no longer available in Bioconductor. I was given
> until 2023-11-03 to fix the issue.
>
> I contacted the MEIGOR maintainers and they told me they were migrating to
> CRAN. Yesterday, they contacted me again, telling me they needed more time
> for the migration. Hence, I responded to the email I received from CRAN,
> asking for an extension of the previous deadline (2023-11-03).
>
> To my surprise, it is not just that the extension was not granted, but the
> package has been removed from CRAN today (2023-11-01). Two days before the
> deadline (2023-11-03): https://cran.r-project.org/package=bioOED
>
> Then, I checked my inbox and I saw an email from one of the CRAN
> maintainers, showing that the package was removed because he had felt
> offended by my email. I copy-paste the email below.
>
> I understand that maintaining CRAN must be a huge work. I also work in
> academia, so I am totally aware of all the extra work that is required from
> us. But it is unreasonable that a package can be removed just because a
> maintainer throws a tantrum
>
> Again, I am really sorry I had to write this email, but CRAN cannot work if
> we allow this type of situation.
>
> Kind regards,
> Alberto Garre


## Mail from ............ on 2023-11-01 8:28

......................
...................... (citation of private e-mails without getting
......................  explicit permission is not allowed)
......................

>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
-- 
Writing: wyclif.substack.com
Book: www.wyclifsdust.com

	[[alternative HTML version deleted]]



From ro||turner @end|ng |rom po@teo@net  Thu Nov  2 20:52:41 2023
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Thu,  2 Nov 2023 19:52:41 +0000
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>
Message-ID: <20231103085241.15202ddb@rolf-Latitude-E7470>


On Wed, 1 Nov 2023 16:10:34 +0000
David Hugh-Jones <davidhughjones at gmail.com> wrote:

> Aside from the package question, surely the other issue here is that
> ...... email is extraordinarily rude. Any paid employee would
> be sacked for that. I appreciate R and CRAN are volunteer-run
> organisations, but I don?t think that should be an excuse for this
> level of, frankly, toxicity. Why is he allowed to get away with it?
> 
> David

I've just had a look at the initial posting in this thread

https://stat.ethz.ch/pipermail/r-package-devel/2023q4/009810.html  

and can see nothing rude or offensive in the email ....
that was copied and pasted into that posting.

I find *your* email far more offensive than anything that .....
has ever written.  Get a life.

cheers,

Rolf Turner

P.S.  See fortunes::fortune(88).

R. T.

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619



From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Thu Nov  2 21:29:29 2023
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Thu, 2 Nov 2023 15:29:29 -0500
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <20231103085241.15202ddb@rolf-Latitude-E7470>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>
 <20231103085241.15202ddb@rolf-Latitude-E7470>
Message-ID: <ee58d3dc-6f20-4154-a17a-ed0c58b758f1@effectivedefense.org>



On 11/2/23 2:52 PM, Rolf Turner wrote:
> 
> On Wed, 1 Nov 2023 16:10:34 +0000
> David Hugh-Jones <davidhughjones at gmail.com> wrote:
> 
>> Aside from the package question, surely the other issue here is that
>> email is extraordinarily rude. Any paid employee would
>> be sacked for that. I appreciate R and CRAN are volunteer-run
>> organisations, but I don?t think that should be an excuse for this
>> level of, frankly, toxicity. Why is he allowed to get away with it?
>>
>> David
> 
> I've just had a look at the initial posting in this thread
> 
> https://stat.ethz.ch/pipermail/r-package-devel/2023q4/009810.html
> 
> and can see nothing rude or offensive in the email ........
> that was copied and pasted into that posting.
> 
> I find *your* email far more offensive than anything that ......
> has ever written.  Get a life.
> 
> cheers,
> 
> Rolf Turner
> 
> P.S.  See fortunes::fortune(88).
> 
> R. T.


Hi, David:

	  ....................


	  I've been in the military, and I've learned to ignore the tone and 
look for the value in comments I receive. I've learned a lot from 
........., and others. When the tone seemed less supportive or 
even insulting, I'm very glad the person took the time to comment and 
didn't decide not to reply for fear of offending me. I'm more productive 
and a better human for all the help I've gotten from this and other 
R-related lists.


fortunes::fortune('Spencer Graves')


	  sg
>



From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Nov  3 12:15:24 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 3 Nov 2023 12:15:24 +0100
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <ee58d3dc-6f20-4154-a17a-ed0c58b758f1@effectivedefense.org>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>
 <20231103085241.15202ddb@rolf-Latitude-E7470>
 <ee58d3dc-6f20-4154-a17a-ed0c58b758f1@effectivedefense.org>
Message-ID: <25924.54860.947619.82098@stat.math.ethz.ch>

Dear R-package-devel readers *and* notably writers,

In Europe there are (diverse) laws about privacy etc, and those,
(and/or some politeness) do not allow
free citing of private e-mail communications in public
nor ad hominem remarks in such public communication.

For this reason, I (as mailing list co-maintainer, and notably
responsible for the lawfulness of the public mailing list archives on
our web server) now spent about 2 hours  to carefully obey such
privacy requirements (carefully editing + recreating all the html archives).
{In another similar case, my employer, ETH Zurich, did urge me
"from above" to spend my time with such a tedious and ungratifying job ...}
This is *NOT* something I'd be happy to redo.

So *please* do not misuse such a public mailing list and do keep
your private opinions private in such a case in the future!

>>>>> Spencer Graves  on Thu, 2 Nov 2023 15:29:29 -0500 writes:

    > On 11/2/23 2:52 PM, Rolf Turner wrote:
    >> 
    >> On Wed, 1 Nov 2023 16:10:34 +0000 David Hugh-Jones wrote:
    >> 
    >>> Aside from the package question, surely the other issue
    >>> here is that ........?s email is extraordinarily
    >>> rude. Any paid employee would be sacked for that. I
    >>> appreciate R and CRAN are volunteer-run organisations,
    >>> but I don?t think that should be an excuse for this
    >>> level of, frankly, toxicity. Why is he allowed to get
    >>> away with it?
    >>> 
    >>> David

    >> 
    >> I've just had a look at the initial posting in this
    >> thread
    >>
    >> and can see nothing rude or offensive in the email
    >> that was copied and pasted into that  posting.
    >> 
    >> I find *your* email far more offensive than anything that
    >> .... has ever written.  Get a life.
    >> 
    >> cheers,
    >> 
    >> Rolf Turner
    >> 
    >> P.S.  See fortunes::fortune(88).
    >> 
    >> R. T.


    > Hi, David:


[............]


    > 	  I've been in the military, and I've learned to ignore
    > the tone and look for the value in comments I
    > receive. I've learned a lot from ............, and
    > others. When the tone seemed less supportive or even
    > insulting, I'm very glad the person took the time to
    > comment and didn't decide not to reply for fear of
    > offending me. I'm more productive and a better human for
    > all the help I've gotten from this and other R-related
    > lists.


    > fortunes::fortune('Spencer Graves')

which can you get 4 different answers; using `showMatches` argument
(which I think I had added), e.g. now gives

> fortune("Spencer Graves", showMatches = TRUE)
Matching row numbers: 90, 124, 177, 271 

Rolf Turner: In the middle of a Saturday morning (in my Time Zone!) I send out a plea for help, and in
just over 20 minutes my problem is solved!
I don't think you get service like that anywhere else. This R-help list is BLOODY AMAZING!
Spencer Graves: 'The sun never sets on the (former) British Empire.' Today, it never sets on R-Help.
   -- Rolf Turner and Spencer Graves
      R-help (May 2005)

and then

> fortune(90)

Our great-great grandchildren as yet unborn may read some of the stupid questions and/or answers that I
and perhaps others give from time to time. I'd rather get flamed for saying something stupid in public on
this list than to continue to provide substandard service to the people with whom I work because I
perpetrated the same mistake in an environment in which no one questioned so effectively my errors.
   -- Spencer Graves (in a discussion on whether answers on R-help should be more polite)
      R-help (December 2004)

    > 	  sg

Martin


--
Martin Maechler
ETH Zurich  and  R Core team


From d@v|dhughjone@ @end|ng |rom gm@||@com  Fri Nov  3 12:30:05 2023
From: d@v|dhughjone@ @end|ng |rom gm@||@com (David Hugh-Jones)
Date: Fri, 3 Nov 2023 11:30:05 +0000
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <25924.54860.947619.82098@stat.math.ethz.ch>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>
 <20231103085241.15202ddb@rolf-Latitude-E7470>
 <ee58d3dc-6f20-4154-a17a-ed0c58b758f1@effectivedefense.org>
 <25924.54860.947619.82098@stat.math.ethz.ch>
Message-ID: <CAARY7khSyJwFLMD2dkyRULpSkPF1UGfRFT22QwHhcteB8wNsDw@mail.gmail.com>

Guys,

Martin, I am very sorry you spent all that time. I am sceptical that this
is a correct interpretation of the law, given what I see on Twitter daily,
and I would not take a university as an authority on this. But that is
neither here nor there ? if I made you waste your time, that's my bad and
I'm sorry.

More generally, I have absolutely no wish to spend time beating up on any
individual ? and people have kindly sent comments off-list that gave me
context about the specific case. But persistent rudeness is harmful, and
there ought to be a way to address it. Many projects use codes of conduct
for this purpose.

David


On Fri, 3 Nov 2023 at 11:15, Martin Maechler <maechler at stat.math.ethz.ch>
wrote:

> Dear R-package-devel readers *and* notably writers,
>
> In Europe there are (diverse) laws about privacy etc, and those,
> (and/or some politeness) do not allow
> free citing of private e-mail communications in public
> nor ad hominem remarks in such public communication.
>
> For this reason, I (as mailing list co-maintainer, and notably
> responsible for the lawfulness of the public mailing list archives on
> our web server) now spent about 2 hours  to carefully obey such
> privacy requirements (carefully editing + recreating all the html
> archives).
> {In another similar case, my employer, ETH Zurich, did urge me
> "from above" to spend my time with such a tedious and ungratifying job ...}
> This is *NOT* something I'd be happy to redo.
>
> So *please* do not misuse such a public mailing list and do keep
> your private opinions private in such a case in the future!
>
> >>>>> Spencer Graves  on Thu, 2 Nov 2023 15:29:29 -0500 writes:
>
>     > On 11/2/23 2:52 PM, Rolf Turner wrote:
>     >>
>     >> On Wed, 1 Nov 2023 16:10:34 +0000 David Hugh-Jones wrote:
>     >>
>     >>> Aside from the package question, surely the other issue
>     >>> here is that ........?s email is extraordinarily
>     >>> rude. Any paid employee would be sacked for that. I
>     >>> appreciate R and CRAN are volunteer-run organisations,
>     >>> but I don?t think that should be an excuse for this
>     >>> level of, frankly, toxicity. Why is he allowed to get
>     >>> away with it?
>     >>>
>     >>> David
>
>     >>
>     >> I've just had a look at the initial posting in this
>     >> thread
>     >>
>     >> and can see nothing rude or offensive in the email
>     >> that was copied and pasted into that  posting.
>     >>
>     >> I find *your* email far more offensive than anything that
>     >> .... has ever written.  Get a life.
>     >>
>     >> cheers,
>     >>
>     >> Rolf Turner
>     >>
>     >> P.S.  See fortunes::fortune(88).
>     >>
>     >> R. T.
>
>
>     > Hi, David:
>
>
> [............]
>
>
>     >     I've been in the military, and I've learned to ignore
>     > the tone and look for the value in comments I
>     > receive. I've learned a lot from ............, and
>     > others. When the tone seemed less supportive or even
>     > insulting, I'm very glad the person took the time to
>     > comment and didn't decide not to reply for fear of
>     > offending me. I'm more productive and a better human for
>     > all the help I've gotten from this and other R-related
>     > lists.
>
>
>     > fortunes::fortune('Spencer Graves')
>
> which can you get 4 different answers; using `showMatches` argument
> (which I think I had added), e.g. now gives
>
> > fortune("Spencer Graves", showMatches = TRUE)
> Matching row numbers: 90, 124, 177, 271
>
> Rolf Turner: In the middle of a Saturday morning (in my Time Zone!) I send
> out a plea for help, and in
> just over 20 minutes my problem is solved!
> I don't think you get service like that anywhere else. This R-help list is
> BLOODY AMAZING!
> Spencer Graves: 'The sun never sets on the (former) British Empire.'
> Today, it never sets on R-Help.
>    -- Rolf Turner and Spencer Graves
>       R-help (May 2005)
>
> and then
>
> > fortune(90)
>
> Our great-great grandchildren as yet unborn may read some of the stupid
> questions and/or answers that I
> and perhaps others give from time to time. I'd rather get flamed for
> saying something stupid in public on
> this list than to continue to provide substandard service to the people
> with whom I work because I
> perpetrated the same mistake in an environment in which no one questioned
> so effectively my errors.
>    -- Spencer Graves (in a discussion on whether answers on R-help should
> be more polite)
>       R-help (December 2004)
>
>     >     sg
>
> Martin
>
>
> --
> Martin Maechler
> ETH Zurich  and  R Core team
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Fri Nov  3 13:27:13 2023
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Fri, 3 Nov 2023 08:27:13 -0400 (EDT)
Subject: [R-pkg-devel] 
 Package bioOED has been removed from CRAN just for personal reasons
In-Reply-To: <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>
References: <CAMo5YQYHZkedU6On_576c2J8MXK4DjfmBoHC2dYRjcVGWJHkVQ@mail.gmail.com>
 <CAARY7khF1BbpJ4Ds1ZqtW1Wv4Wb9Nnu9PPL1_MmN5=E3Wqqhfw-6452@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2311030755120.8898@iridium>



On Wed, 1 Nov 2023, David Hugh-Jones wrote:

> Aside from the package question, surely the other issue here is that Prof
> Ripley?s email is extraordinarily rude. Any paid employee would be sacked
> for that. I appreciate R and CRAN are volunteer-run organisations, but I
> don?t think that should be an excuse for this level of, frankly, toxicity.
> Why is he allowed to get away with it?

So one thing to keep in mind that doing volunteer public facing work tends 
to expose people to all kinds of unreasonable requests.

Those who endure often become more direct, and that's fine. Or, and 
people in commercial companies can be very direct too.

One thing that helps is to be extra-polite to a person who is doing a lot 
of volunteer work, and who is likely way oversubscribed.

Focusing on practical matters, if you take a step back things look 
pretty good:

Your package has dependency on a package that you have not written and
that is maintained outside CRAN. It was bound to break sooner or later.

However, the last time you updated bioOED was in 2019 and there was no 
need to do anything for more than 3 years. That's amazing ! And probably 
made possible by being a little bit too direct on occasion.

best

Vladimir Dergachev

>
> David
>

From W@y@e@W@Jo@es m@iii@g oii sheii@com  Fri Nov  3 13:59:36 2023
From: W@y@e@W@Jo@es m@iii@g oii sheii@com (W@y@e@W@Jo@es m@iii@g oii sheii@com)
Date: Fri, 3 Nov 2023 12:59:36 +0000
Subject: [R-pkg-devel] [r-package-devel] Win.Metafile and package check -
 "Found the platform-specific device:"
In-Reply-To: <DU2P120MB0482FF7F34970A8EFE4DA904A5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
References: <DU2P120MB0482FF7F34970A8EFE4DA904A5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
Message-ID: <DU2P120MB048294C0CC7A9D113E33398BA5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>

Dear R-Package-Devel,

As part of GWSDAT package (https://github.com/waynegitshell/GWSDAT) we support the option to output plots to a WMF (https://r-graphics.org/recipe-output-vector-wmf) format if, and only if,  the user is on Windows. However, when I run the package checks on here it complains about using a platform specific function with the following message:

  Found the platform-specific device:
    'win.metafile'
  dev.new() is the preferred way to open a new device, in the unlikely
  event one is needed.

In my opinion this is a false positive - and a similar issue has previously been reported here: https://stackoverflow.com/questions/70585796/unable-to-understand-1-note-in-devtoolscheck-caused-by-a-platform-specific-d

Any ideas on how I modify the code and package submission to automatically pass the checks?

Thanks,

Wayne



----------------------------------------------------------------------------------------
Wayne Jones
Principal Data Scientist
Decarbonisation Data Science

Tel: +44 (0) 207 934 4330
Projects and Technology, Shell Research Limited, Shell Centre, York Road, London, SE1 7NA
Email: Wayne.W.Jones at shell.com<mailto:Wayne.W.Jones at shell.com>
Intranet: Shell.ai<https://eu001-sp.shell.com/sites/AAFAA6690/Shell.ai/homepage.aspx>
Internet: www.shell.ai<http://www.shell.ai/>


	[[alternative HTML version deleted]]


From pro|jcn@@h @end|ng |rom gm@||@com  Fri Nov  3 15:54:22 2023
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Fri, 3 Nov 2023 10:54:22 -0400
Subject: [R-pkg-devel] Rmarkdown fails if (quote) r (space) is used
Message-ID: <4406e5d0-6ad6-4b05-8b9a-34cec1d9b8c0@gmail.com>

I've spent a couple of hours with an Rmarkdown document where I
was describing some spherical coordinates made up of a radius r and
some angles. I wanted to fix the radius at 1.

In my Rmarkdown text I wrote

    Thus we have `r = 1` ...

This caused failure to render with "unexpected =". I was using Rstudio
at first and didn't see the error msg.

If I use "radius R" and `R = 1`, things are fine, or `r=1` with no space,
but the particular "(quote) r (space)" seems to trigger code block processing.

Perhaps this note can save others some wasted time.

I had thought (obviously incorrectly) that one needed ```{r something}
to start the code chunk.

JN


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Fri Nov  3 16:38:19 2023
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Fri, 03 Nov 2023 08:38:19 -0700
Subject: [R-pkg-devel] Rmarkdown fails if (quote) r (space) is used
In-Reply-To: <4406e5d0-6ad6-4b05-8b9a-34cec1d9b8c0@gmail.com>
References: <4406e5d0-6ad6-4b05-8b9a-34cec1d9b8c0@gmail.com>
Message-ID: <32394AF6-9B4A-47AC-A903-F2EB9978E9BA@dcn.davis.ca.us>

A code chunk does always begin with a triple backtick at the beginning of a line. The term for what you encountered is "inline code" used to embed computed results into the markdown text as though you had typed them directly.

Check out https://www.r-bloggers.com/2017/12/how-to-show-r-inline-code-blocks-in-r-markdown for relevant discussion.

On November 3, 2023 7:54:22 AM PDT, J C Nash <profjcnash at gmail.com> wrote:
>I've spent a couple of hours with an Rmarkdown document where I
>was describing some spherical coordinates made up of a radius r and
>some angles. I wanted to fix the radius at 1.
>
>In my Rmarkdown text I wrote
>
>   Thus we have `r = 1` ...
>
>This caused failure to render with "unexpected =". I was using Rstudio
>at first and didn't see the error msg.
>
>If I use "radius R" and `R = 1`, things are fine, or `r=1` with no space,
>but the particular "(quote) r (space)" seems to trigger code block processing.
>
>Perhaps this note can save others some wasted time.
>
>I had thought (obviously incorrectly) that one needed ```{r something}
>to start the code chunk.
>
>JN
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From @ergue|@@oko| @end|ng |rom gm@||@com  Fri Nov  3 16:48:56 2023
From: @ergue|@@oko| @end|ng |rom gm@||@com (Serguei Sokol)
Date: Fri, 3 Nov 2023 16:48:56 +0100
Subject: [R-pkg-devel] Rmarkdown fails if (quote) r (space) is used
In-Reply-To: <4406e5d0-6ad6-4b05-8b9a-34cec1d9b8c0@gmail.com>
References: <4406e5d0-6ad6-4b05-8b9a-34cec1d9b8c0@gmail.com>
Message-ID: <76e9d6ed-4ace-4827-a03c-fe8718fe05ee@gmail.com>

Le 03/11/2023 ? 15:54, J C Nash a ?crit?:
> I've spent a couple of hours with an Rmarkdown document where I
> was describing some spherical coordinates made up of a radius r and
> some angles. I wanted to fix the radius at 1.
> 
> In my Rmarkdown text I wrote
> 
>  ?? Thus we have `r = 1` ...
To avoid a confusion between inline code and fixed font typesetting, 
could it be

    Thus we have ` r = 1` ...

(with a space after an opening quote)?

Best,
Serguei.

> 
> This caused failure to render with "unexpected =". I was using Rstudio
> at first and didn't see the error msg.
> 
> If I use "radius R" and `R = 1`, things are fine, or `r=1` with no space,
> but the particular "(quote) r (space)" seems to trigger code block 
> processing.
> 
> Perhaps this note can save others some wasted time.
> 
> I had thought (obviously incorrectly) that one needed ```{r something}
> to start the code chunk.
> 
> JN
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From pro|jcn@@h @end|ng |rom gm@||@com  Fri Nov  3 17:18:24 2023
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Fri, 3 Nov 2023 12:18:24 -0400
Subject: [R-pkg-devel] Rmarkdown fails if (quote) r (space) is used
In-Reply-To: <76e9d6ed-4ace-4827-a03c-fe8718fe05ee@gmail.com>
References: <4406e5d0-6ad6-4b05-8b9a-34cec1d9b8c0@gmail.com>
 <76e9d6ed-4ace-4827-a03c-fe8718fe05ee@gmail.com>
Message-ID: <0f4e0b17-36cd-4160-a113-6deba8dbab53@gmail.com>

Yes. An initial space does the trick. Thanks. J

On 2023-11-03 11:48, Serguei Sokol wrote:
> Le 03/11/2023 ? 15:54, J C Nash a ?crit?:
>> I've spent a couple of hours with an Rmarkdown document where I
>> was describing some spherical coordinates made up of a radius r and
>> some angles. I wanted to fix the radius at 1.
>>
>> In my Rmarkdown text I wrote
>>
>> ??? Thus we have `r = 1` ...
> To avoid a confusion between inline code and fixed font typesetting, could it be
> 
>  ?? Thus we have ` r = 1` ...
> 
> (with a space after an opening quote)?
> 
> Best,
> Serguei.
> 
>>
>> This caused failure to render with "unexpected =". I was using Rstudio
>> at first and didn't see the error msg.
>>
>> If I use "radius R" and `R = 1`, things are fine, or `r=1` with no space,
>> but the particular "(quote) r (space)" seems to trigger code block processing.
>>
>> Perhaps this note can save others some wasted time.
>>
>> I had thought (obviously incorrectly) that one needed ```{r something}
>> to start the code chunk.
>>
>> JN
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Fri Nov  3 21:02:51 2023
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Fri, 3 Nov 2023 16:02:51 -0400 (EDT)
Subject: [R-pkg-devel] 
 [r-package-devel] Win.Metafile and package check -
 "Found the platform-specific device:"
In-Reply-To: <DU2P120MB048294C0CC7A9D113E33398BA5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
References: <DU2P120MB0482FF7F34970A8EFE4DA904A5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <DU2P120MB048294C0CC7A9D113E33398BA5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
Message-ID: <alpine.DEB.2.22.394.2311031558290.8898@iridium>



On Fri, 3 Nov 2023, Wayne.W.Jones at shell.com wrote:

> Dear R-Package-Devel,
>
> As part of GWSDAT package (https://github.com/waynegitshell/GWSDAT) we support the option to output plots to a WMF (https://r-graphics.org/recipe-output-vector-wmf) format if, and only if,  the user is on Windows. However, when I run the package checks on here it complains about using a platform specific function with the following message:
>
>  Found the platform-specific device:
>    'win.metafile'
>  dev.new() is the preferred way to open a new device, in the unlikely
>  event one is needed.
>
> In my opinion this is a false positive - and a similar issue has previously been reported here: https://stackoverflow.com/questions/70585796/unable-to-understand-1-note-in-devtoolscheck-caused-by-a-platform-specific-d
>
> Any ideas on how I modify the code and package submission to automatically pass the checks?

Two suggestions:

   * let users specify the graphics device they want

   * reading manpage for dev.new() it accepts a bunch of options - there is 
probably a way to request the metafile device you want. But I could not 
find that in documentation.

best

Vladimir Dergachev

>
> Thanks,
>
> Wayne
>
>
>
> ----------------------------------------------------------------------------------------
> Wayne Jones
> Principal Data Scientist
> Decarbonisation Data Science
>
> Tel: +44 (0) 207 934 4330
> Projects and Technology, Shell Research Limited, Shell Centre, York Road, London, SE1 7NA
> Email: Wayne.W.Jones at shell.com<mailto:Wayne.W.Jones at shell.com>
> Intranet: Shell.ai<https://eu001-sp.shell.com/sites/AAFAA6690/Shell.ai/homepage.aspx>
> Internet: www.shell.ai<http://www.shell.ai/>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From @hu|@|@cheung @end|ng |rom gm@||@com  Sat Nov  4 05:42:31 2023
From: @hu|@|@cheung @end|ng |rom gm@||@com (Shu Fai Cheung)
Date: Sat, 4 Nov 2023 12:42:31 +0800
Subject: [R-pkg-devel] PkgA imports PkgB, and PkgB suggests PkgA?
Message-ID: <CAPVJd2Xxi-MsaAKMDyQ69T2LfX5Ky4HVkcfQ9nZcn-edsofhtg@mail.gmail.com>

Hi All,

I vaguely recall that, on CRAN, if PkgA imports PkgB, then PkgB cannot
import PkgA. (Please correct me if I am wrong.)

How about this?

PkgA imports PkgB (because PkgA has some helper functions for using PkgB)
PkgB suggests PkgA (because some vignettes or examples in PkgB use
those helpers from PkgA)

Is this allowed on CRAN?

Regards,
Shu Fai


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Sat Nov  4 06:29:28 2023
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Sat, 4 Nov 2023 01:29:28 -0400 (EDT)
Subject: [R-pkg-devel] RFC: an interface to manage use of parallelism in
 packages
In-Reply-To: <20231025155529.0f83fc93@arachnoid>
References: <20231025155529.0f83fc93@arachnoid>
Message-ID: <alpine.DEB.2.22.394.2311040111420.8898@iridium>



On Wed, 25 Oct 2023, Ivan Krylov wrote:

> Summary: at the end of this message is a link to an R package
> implementing an interface for managing the use of execution units in R
> packages. As a package maintainer, would you agree to use something
> like this? Does it look sufficiently reasonable to become a part of R?
> Read on for why I made these particular interface choices.
>
> My understanding of the problem stated by Simon Urbanek and Uwe Ligges
> [1,2] is that we need a way to set and distribute the CPU core
> allowance between multiple packages that could be using very different
> methods to achieve parallel execution on the local machine, including
> threads and child processes. We could have multiple well-meaning
> packages, each of them calling each other using a different parallelism
> technology: imagine parallel::makeCluster(getOption('mc.cores'))
> combined with parallel::mclapply(mc.cores = getOption('mc.cores')) and
> with an OpenMP program that also spawns getOption('mc.cores') threads.
> A parallel BLAS or custom multi-threading using std::thread could add
> more fuel to the fire.
>

Hi Ivan,

   Generally, I like the idea. A few comments:

   * from a package developer point of view, I would prefer to have a clear 
idea of how many threads I could use. So having a core R function like 
"getMaxThreads()" or similar would be useful. What that function returns 
could be governed by a package.

   In fact, it might be a good idea to allow to have several packages 
implementing "thread governors" for different situations.

   * it would make sense to think through whether we want (or not) to allow 
package developers to call omp_set_num_threads() or whether this is done 
by R.

   This is hairier than you might think. Allowing it forces every package 
to call omp_set_num_threads() before OMP block, because there is no way to 
know which packaged was called before.

   Not allowing to call omp_set_num_threads() might make it difficult to 
use all the threads, and force R to initialize OpenMP on startup.

  * Speaking of initialization of OpenMP, I have seen situations where 
spawning some regular pthread threads and then initializing OpenMP forces 
all pthread threads to a single CPU.

   I think this is because OpenMP sets thread affinity for all the process 
threads, but only distributes its own.

  * This also raises the question of how affinity is managed. If you have 
called makeForkCluster() to create 10 R instances and then each uses 2 
OpenMP threads, you do not want those occupying only 2 cpu execution 
threads instead of 20.

  * From the user perspective, it might be useful to be able to limit 
number of threads per package by using patterns or regular expressions.
Often, the reason for limiting number of threads is to reduce memory 
usage.

  * Speaking of memory usage, glibc has parameters like MALLOC_ARENA_MAX 
that have great impact on memory usage of multithreaded programs. I 
usually set it to 1, but then I take extra care to make as few memory 
allocation calls as possible within individual threads.

best

Vladimir Dergachev


From |uc@r @end|ng |rom |edor@project@org  Sat Nov  4 09:41:07 2023
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Sat, 4 Nov 2023 09:41:07 +0100
Subject: [R-pkg-devel] PkgA imports PkgB, and PkgB suggests PkgA?
In-Reply-To: <CAPVJd2Xxi-MsaAKMDyQ69T2LfX5Ky4HVkcfQ9nZcn-edsofhtg@mail.gmail.com>
References: <CAPVJd2Xxi-MsaAKMDyQ69T2LfX5Ky4HVkcfQ9nZcn-edsofhtg@mail.gmail.com>
Message-ID: <CALEXWq379JNjKjvinwtf+c8Go+zZhkpxsx3+9KyfDkPQzK7d+g@mail.gmail.com>

El s?b., 4 nov. 2023 5:43, Shu Fai Cheung <shufai.cheung at gmail.com>
escribi?:

> Hi All,
>
> I vaguely recall that, on CRAN, if PkgA imports PkgB, then PkgB cannot
> import PkgA. (Please correct me if I am wrong.)
>
> How about this?
>
> PkgA imports PkgB (because PkgA has some helper functions for using PkgB)
> PkgB suggests PkgA (because some vignettes or examples in PkgB use
> those helpers from PkgA)
>

Or some tests are based on PkgA, or...

Is this allowed on CRAN?
>

Yes, it is. For example: testthat imports a bunch of packages to do is
thing, and those packages suggest testthat because their test suite is
based on it.

Cycles of hard dependencies (Depends, Imports) are not allowed for obvious
reasons. But packages should install and work without soft dependencies, so
there's no problem there.

I?aki

	[[alternative HTML version deleted]]


From W@y@e@W@Jo@es m@iii@g oii sheii@com  Sat Nov  4 10:03:27 2023
From: W@y@e@W@Jo@es m@iii@g oii sheii@com (W@y@e@W@Jo@es m@iii@g oii sheii@com)
Date: Sat, 4 Nov 2023 09:03:27 +0000
Subject: [R-pkg-devel] 
 [r-package-devel] Win.Metafile and package check -
 "Found the platform-specific device:"
In-Reply-To: <alpine.DEB.2.22.394.2311031558290.8898@iridium>
References: <DU2P120MB0482FF7F34970A8EFE4DA904A5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <DU2P120MB048294C0CC7A9D113E33398BA5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <alpine.DEB.2.22.394.2311031558290.8898@iridium>
Message-ID: <DU2P120MB048203643959218C8BF17EB4A5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>

Hi Vladimir,

Thanks for the suggestions. I've considered both but I can't see a way of doing what I'm trying to achieve without explicitly adding a call to win.metafile in my code.

To explain a little more...

GWSDAT is a Shiny App so we don't use the traditional R graphics device - so your suggestion #1 is not an option . Instead, the user is offered a range of different plot options in a shiny list box as illustrated here in this windows based example:
https://user-images.githubusercontent.com/61183826/280452267-c4287f8d-73cc-42a3-881a-4643bdb31689.png

The list of options presented to the users in the list box is modified according to the platform - see code here:  https://github.com/WayneGitShell/GWSDAT/blob/master/R/server.R#L117-L118

So anyone using a non-windows platform will never be offered the choice of "wmf"  to begin with. For example, see the online LINUX  version, https://stats-glasgow.shinyapps.io/GWSDATV3-2/.  You will see that this option doesn't exist in the list of choices - see https://user-images.githubusercontent.com/61183826/280453275-6da9b235-0387-47fd-b3a8-b0a949f0ec3e.png

Any suggestions on how I can modify this approach to make it automatically pass the CRAN checks?

Thanks,

Wayne

-----Original Message-----
From: Vladimir Dergachev <volodya at mindspring.com>
Sent: 03 November 2023 20:03
To: Jones, Wayne R GSUK-PTX/D/S <Wayne.W.Jones at shell.com>
Cc: r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] [r-package-devel] Win.Metafile and package check - "Found the platform-specific device:"

Think Secure. This email is from an external source.

On Fri, 3 Nov 2023, Wayne.W.Jones at shell.com wrote:

> Dear R-Package-Devel,
>
> As part of GWSDAT package (https://github.com/waynegitshell/GWSDAT) we support the option to output plots to a WMF (https://r-graphics.org/recipe-output-vector-wmf) format if, and only if,  the user is on Windows. However, when I run the package checks on here it complains about using a platform specific function with the following message:
>
>  Found the platform-specific device:
>    'win.metafile'
>  dev.new() is the preferred way to open a new device, in the unlikely
> event one is needed.
>
> In my opinion this is a false positive - and a similar issue has
> previously been reported here:
> https://stac/
> koverflow.com%2Fquestions%2F70585796%2Funable-to-understand-1-note-in-
> devtoolscheck-caused-by-a-platform-specific-d&data=05%7C01%7CWayne.W.J
> ones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e96a8a3da442a
> 930b235cac24cd5c%7C0%7C0%7C638346385789331058%7CUnknown%7CTWFpbGZsb3d8
> eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3
> 000%7C%7C%7C&sdata=FLTuWH3yJq0sK%2FePWzv5ga%2FcXQGvHNmQOauw3x5RTXc%3D&
> reserved=0
>
> Any ideas on how I modify the code and package submission to automatically pass the checks?

Two suggestions:

   * let users specify the graphics device they want

   * reading manpage for dev.new() it accepts a bunch of options - there is probably a way to request the metafile device you want. But I could not find that in documentation.

best

Vladimir Dergachev

>
> Thanks,
>
> Wayne
>
>
>
> ----------------------------------------------------------------------
> ------------------
> Wayne Jones
> Principal Data Scientist
> Decarbonisation Data Science
>
> Tel: +44 (0) 207 934 4330
> Projects and Technology, Shell Research Limited, Shell Centre, York
> Road, London, SE1 7NA
> Email: Wayne.W.Jones at shell.com<mailto:Wayne.W.Jones at shell.com>
> Intranet:
> Shell.ai<https://eur02.safelinks.protection.outlook.com/?url=https%3A%25
> 2F%2Feu001-sp.shell.com%2Fsites%2FAAFAA6690%2FShell.ai%2Fhomepage.aspx
> &data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdc
> a7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789331058
> %7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6I
> k1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=z9EBpBRKRttm2r5hJkEol54xSA
> 6hp76CTjZVvahYoso%3D&reserved=0>
> Internet:
> http://www.s/
> hell.ai%2F&data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af
> 7e8408dbdca7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C63834638
> 5789331058%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=zaHgal1ZfA5%2B0l
> FhpJoq2FEEJb1d5kQrogu9%2FLQt3Po%3D&reserved=0<https://eur02.safelinks/.
> protection.outlook.com/?url=http%3A%2F%2Fwww.shell.ai%2F&data=05%7C01%
> 7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e9
> 6a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789331058%7CUnknown%7CT
> WFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI
> 6Mn0%3D%7C3000%7C%7C%7C&sdata=zaHgal1ZfA5%2B0lFhpJoq2FEEJb1d5kQrogu9%2
> FLQt3Po%3D&reserved=0>
>
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat/
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789487307%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=QNipEDt1FYAnFH0ohACT780ijWX6vPufS9F37Mp8Cxw%3D&reserved=0
>


From W@y@e@W@Jo@es m@iii@g oii sheii@com  Sat Nov  4 10:35:52 2023
From: W@y@e@W@Jo@es m@iii@g oii sheii@com (W@y@e@W@Jo@es m@iii@g oii sheii@com)
Date: Sat, 4 Nov 2023 09:35:52 +0000
Subject: [R-pkg-devel] 
 [r-package-devel] Win.Metafile and package check -
 "Found the platform-specific device:"
In-Reply-To: <DU2P120MB048203643959218C8BF17EB4A5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
References: <DU2P120MB0482FF7F34970A8EFE4DA904A5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <DU2P120MB048294C0CC7A9D113E33398BA5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <alpine.DEB.2.22.394.2311031558290.8898@iridium>
 <DU2P120MB048203643959218C8BF17EB4A5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
Message-ID: <DU2P120MB048235646EFEBEBD87871A1AA5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>

Update:

I noticed in the ggplot2 codebase they also have a call to win.metafile - see https://github.com/tidyverse/ggplot2/blob/main/R/save.R#L280-L281

When I use grDevices::win.metafile instead of win.metafile it passes the local checks fine.

Wayne

-----Original Message-----
From: Jones, Wayne R GSUK-PTX/D/S
Sent: 04 November 2023 09:03
To: Vladimir Dergachev <volodya at mindspring.com>
Cc: r-package-devel at r-project.org
Subject: RE: [R-pkg-devel] [r-package-devel] Win.Metafile and package check - "Found the platform-specific device:"

Hi Vladimir,

Thanks for the suggestions. I've considered both but I can't see a way of doing what I'm trying to achieve without explicitly adding a call to win.metafile in my code.

To explain a little more...

GWSDAT is a Shiny App so we don't use the traditional R graphics device - so your suggestion #1 is not an option . Instead, the user is offered a range of different plot options in a shiny list box as illustrated here in this windows based example:
https://user-images.githubusercontent.com/61183826/280452267-c4287f8d-73cc-42a3-881a-4643bdb31689.png

The list of options presented to the users in the list box is modified according to the platform - see code here:  https://github.com/WayneGitShell/GWSDAT/blob/master/R/server.R#L117-L118

So anyone using a non-windows platform will never be offered the choice of "wmf"  to begin with. For example, see the online LINUX  version, https://stats-glasgow.shinyapps.io/GWSDATV3-2/.  You will see that this option doesn't exist in the list of choices - see https://user-images.githubusercontent.com/61183826/280453275-6da9b235-0387-47fd-b3a8-b0a949f0ec3e.png

Any suggestions on how I can modify this approach to make it automatically pass the CRAN checks?

Thanks,

Wayne

-----Original Message-----
From: Vladimir Dergachev <volodya at mindspring.com>
Sent: 03 November 2023 20:03
To: Jones, Wayne R GSUK-PTX/D/S <Wayne.W.Jones at shell.com>
Cc: r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] [r-package-devel] Win.Metafile and package check - "Found the platform-specific device:"

Think Secure. This email is from an external source.

On Fri, 3 Nov 2023, Wayne.W.Jones at shell.com wrote:

> Dear R-Package-Devel,
>
> As part of GWSDAT package (https://github.com/waynegitshell/GWSDAT) we support the option to output plots to a WMF (https://r-graphics.org/recipe-output-vector-wmf) format if, and only if,  the user is on Windows. However, when I run the package checks on here it complains about using a platform specific function with the following message:
>
>  Found the platform-specific device:
>    'win.metafile'
>  dev.new() is the preferred way to open a new device, in the unlikely
> event one is needed.
>
> In my opinion this is a false positive - and a similar issue has
> previously been reported here:
> https://stac/
> koverflow.com%2Fquestions%2F70585796%2Funable-to-understand-1-note-in-
> devtoolscheck-caused-by-a-platform-specific-d&data=05%7C01%7CWayne.W.J
> ones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e96a8a3da442a
> 930b235cac24cd5c%7C0%7C0%7C638346385789331058%7CUnknown%7CTWFpbGZsb3d8
> eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3
> 000%7C%7C%7C&sdata=FLTuWH3yJq0sK%2FePWzv5ga%2FcXQGvHNmQOauw3x5RTXc%3D&
> reserved=0
>
> Any ideas on how I modify the code and package submission to automatically pass the checks?

Two suggestions:

   * let users specify the graphics device they want

   * reading manpage for dev.new() it accepts a bunch of options - there is probably a way to request the metafile device you want. But I could not find that in documentation.

best

Vladimir Dergachev

>
> Thanks,
>
> Wayne
>
>
>
> ----------------------------------------------------------------------
> ------------------
> Wayne Jones
> Principal Data Scientist
> Decarbonisation Data Science
>
> Tel: +44 (0) 207 934 4330
> Projects and Technology, Shell Research Limited, Shell Centre, York
> Road, London, SE1 7NA
> Email: Wayne.W.Jones at shell.com<mailto:Wayne.W.Jones at shell.com>
> Intranet:
> Shell.ai<https://eur02.safelinks.protection.outlook.com/?url=https%3A%25
> 2F%2Feu001-sp.shell.com%2Fsites%2FAAFAA6690%2FShell.ai%2Fhomepage.aspx
> &data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdc
> a7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789331058
> %7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6I
> k1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=z9EBpBRKRttm2r5hJkEol54xSA
> 6hp76CTjZVvahYoso%3D&reserved=0>
> Internet:
> http://www.s/
> hell.ai%2F&data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af
> 7e8408dbdca7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C63834638
> 5789331058%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=zaHgal1ZfA5%2B0l
> FhpJoq2FEEJb1d5kQrogu9%2FLQt3Po%3D&reserved=0<https://eur02.safelinks/.
> protection.outlook.com/?url=http%3A%2F%2Fwww.shell.ai%2F&data=05%7C01%
> 7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e9
> 6a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789331058%7CUnknown%7CT
> WFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI
> 6Mn0%3D%7C3000%7C%7C%7C&sdata=zaHgal1ZfA5%2B0lFhpJoq2FEEJb1d5kQrogu9%2
> FLQt3Po%3D&reserved=0>
>
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat/
> .ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7CWayne.W
> .Jones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e96a8a3da44
> 2a930b235cac24cd5c%7C0%7C0%7C638346385789487307%7CUnknown%7CTWFpbGZsb3
> d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7
> C3000%7C%7C%7C&sdata=QNipEDt1FYAnFH0ohACT780ijWX6vPufS9F37Mp8Cxw%3D&re
> served=0
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Nov  4 12:03:11 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 4 Nov 2023 07:03:11 -0400
Subject: [R-pkg-devel] 
 [r-package-devel] Win.Metafile and package check -
 "Found the platform-specific device:"
In-Reply-To: <DU2P120MB048235646EFEBEBD87871A1AA5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
References: <DU2P120MB0482FF7F34970A8EFE4DA904A5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <DU2P120MB048294C0CC7A9D113E33398BA5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <alpine.DEB.2.22.394.2311031558290.8898@iridium>
 <DU2P120MB048203643959218C8BF17EB4A5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <DU2P120MB048235646EFEBEBD87871A1AA5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
Message-ID: <6153cdfb-0a3e-4613-a763-ebd9d9f53c66@gmail.com>

On 04/11/2023 5:35 a.m., Wayne.W.Jones at shell.com wrote:
> Update:
> 
> I noticed in the ggplot2 codebase they also have a call to win.metafile - see https://github.com/tidyverse/ggplot2/blob/main/R/save.R#L280-L281
> 
> When I use grDevices::win.metafile instead of win.metafile it passes the local checks fine.

That sounds like two bugs in the check code:

1.  It complains about win.metafile even though you made its use 
conditional on being on Windows.

2.  It doesn't complain about grDevices::win.metafile.

I don't think you said, but this looks like a NOTE rather than a WARNING 
or ERROR.  I'd use the grDevices::win.metafile for now, but wouldn't be 
surprised if the NOTE turns up again later when #2 gets fixed.

Duncan Murdoch


From @hu|@|@cheung @end|ng |rom gm@||@com  Sat Nov  4 13:45:30 2023
From: @hu|@|@cheung @end|ng |rom gm@||@com (Shu Fai Cheung)
Date: Sat, 4 Nov 2023 20:45:30 +0800
Subject: [R-pkg-devel] PkgA imports PkgB, and PkgB suggests PkgA?
In-Reply-To: <CALEXWq379JNjKjvinwtf+c8Go+zZhkpxsx3+9KyfDkPQzK7d+g@mail.gmail.com>
References: <CAPVJd2Xxi-MsaAKMDyQ69T2LfX5Ky4HVkcfQ9nZcn-edsofhtg@mail.gmail.com>
 <CALEXWq379JNjKjvinwtf+c8Go+zZhkpxsx3+9KyfDkPQzK7d+g@mail.gmail.com>
Message-ID: <CAPVJd2VkZDoJAaa+m36-736rMhLRgjt7YLgjcm6J9b71wVD80A@mail.gmail.com>

Many many thanks for the clarification, which is very clear! The case
of testthat is a very good example, as many packages suggest it.

Regards,
Shu Fai


On Sat, Nov 4, 2023 at 4:41?PM I?aki Ucar <iucar at fedoraproject.org> wrote:
>
>
>
> El s?b., 4 nov. 2023 5:43, Shu Fai Cheung <shufai.cheung at gmail.com> escribi?:
>>
>> Hi All,
>>
>> I vaguely recall that, on CRAN, if PkgA imports PkgB, then PkgB cannot
>> import PkgA. (Please correct me if I am wrong.)
>>
>> How about this?
>>
>> PkgA imports PkgB (because PkgA has some helper functions for using PkgB)
>> PkgB suggests PkgA (because some vignettes or examples in PkgB use
>> those helpers from PkgA)
>
>
> Or some tests are based on PkgA, or...
>
>> Is this allowed on CRAN?
>
>
> Yes, it is. For example: testthat imports a bunch of packages to do is thing, and those packages suggest testthat because their test suite is based on it.
>
> Cycles of hard dependencies (Depends, Imports) are not allowed for obvious reasons. But packages should install and work without soft dependencies, so there's no problem there.
>
> I?aki


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Sun Nov  5 23:02:19 2023
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Sun, 5 Nov 2023 17:02:19 -0500 (EST)
Subject: [R-pkg-devel] 
 [r-package-devel] Win.Metafile and package check -
 "Found the platform-specific device:"
In-Reply-To: <DU2P120MB048203643959218C8BF17EB4A5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
References: <DU2P120MB0482FF7F34970A8EFE4DA904A5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <DU2P120MB048294C0CC7A9D113E33398BA5A5A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
 <alpine.DEB.2.22.394.2311031558290.8898@iridium>
 <DU2P120MB048203643959218C8BF17EB4A5A4A@DU2P120MB0482.EURP120.PROD.OUTLOOK.COM>
Message-ID: <alpine.DEB.2.22.394.2311051653470.8898@iridium>



On Sat, 4 Nov 2023, Wayne.W.Jones at shell.com wrote:

> Hi Vladimir,
>
> Thanks for the suggestions. I've considered both but I can't see a way of doing what I'm trying to achieve without explicitly adding a call to win.metafile in my code.
>
> To explain a little more...
>
> GWSDAT is a Shiny App so we don't use the traditional R graphics device - so your suggestion #1 is not an option . Instead, the user is offered a range of different plot options in a shiny list box as illustrated here in this windows based example:
> https://user-images.githubusercontent.com/61183826/280452267-c4287f8d-73cc-42a3-881a-4643bdb31689.png
>
> The list of options presented to the users in the list box is modified according to the platform - see code here:  https://github.com/WayneGitShell/GWSDAT/blob/master/R/server.R#L117-L118
>
> So anyone using a non-windows platform will never be offered the choice of "wmf"  to begin with. For example, see the online LINUX  version, https://stats-glasgow.shinyapps.io/GWSDATV3-2/.  You will see that this option doesn't exist in the list of choices - see https://user-images.githubusercontent.com/61183826/280453275-6da9b235-0387-47fd-b3a8-b0a949f0ec3e.png
>
> Any suggestions on how I can modify this approach to make it automatically pass the CRAN checks?

I see. Ideally, the CRAN checks should adjust to your use case - but it is 
not obvious how.

As you discovered in a later e-mail, the check just looks for the presence 
of win.metafile() so calling it in some other way satisfies the code.

best

Vladimir Dergachev

>
> Thanks,
>
> Wayne
>
> -----Original Message-----
> From: Vladimir Dergachev <volodya at mindspring.com>
> Sent: 03 November 2023 20:03
> To: Jones, Wayne R GSUK-PTX/D/S <Wayne.W.Jones at shell.com>
> Cc: r-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] [r-package-devel] Win.Metafile and package check - "Found the platform-specific device:"
>
> Think Secure. This email is from an external source.
>
> On Fri, 3 Nov 2023, Wayne.W.Jones at shell.com wrote:
>
>> Dear R-Package-Devel,
>>
>> As part of GWSDAT package (https://github.com/waynegitshell/GWSDAT) we support the option to output plots to a WMF (https://r-graphics.org/recipe-output-vector-wmf) format if, and only if,  the user is on Windows. However, when I run the package checks on here it complains about using a platform specific function with the following message:
>>
>>  Found the platform-specific device:
>>    'win.metafile'
>>  dev.new() is the preferred way to open a new device, in the unlikely
>> event one is needed.
>>
>> In my opinion this is a false positive - and a similar issue has
>> previously been reported here:
>> https://stac/
>> koverflow.com%2Fquestions%2F70585796%2Funable-to-understand-1-note-in-
>> devtoolscheck-caused-by-a-platform-specific-d&data=05%7C01%7CWayne.W.J
>> ones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e96a8a3da442a
>> 930b235cac24cd5c%7C0%7C0%7C638346385789331058%7CUnknown%7CTWFpbGZsb3d8
>> eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3
>> 000%7C%7C%7C&sdata=FLTuWH3yJq0sK%2FePWzv5ga%2FcXQGvHNmQOauw3x5RTXc%3D&
>> reserved=0
>>
>> Any ideas on how I modify the code and package submission to automatically pass the checks?
>
> Two suggestions:
>
>   * let users specify the graphics device they want
>
>   * reading manpage for dev.new() it accepts a bunch of options - there is probably a way to request the metafile device you want. But I could not find that in documentation.
>
> best
>
> Vladimir Dergachev
>
>>
>> Thanks,
>>
>> Wayne
>>
>>
>>
>> ----------------------------------------------------------------------
>> ------------------
>> Wayne Jones
>> Principal Data Scientist
>> Decarbonisation Data Science
>>
>> Tel: +44 (0) 207 934 4330
>> Projects and Technology, Shell Research Limited, Shell Centre, York
>> Road, London, SE1 7NA
>> Email: Wayne.W.Jones at shell.com<mailto:Wayne.W.Jones at shell.com>
>> Intranet:
>> Shell.ai<https://eur02.safelinks.protection.outlook.com/?url=https%3A%25
>> 2F%2Feu001-sp.shell.com%2Fsites%2FAAFAA6690%2FShell.ai%2Fhomepage.aspx
>> &data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdc
>> a7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789331058
>> %7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6I
>> k1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=z9EBpBRKRttm2r5hJkEol54xSA
>> 6hp76CTjZVvahYoso%3D&reserved=0>
>> Internet:
>> http://www.s/
>> hell.ai%2F&data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af
>> 7e8408dbdca7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C63834638
>> 5789331058%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzI
>> iLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=zaHgal1ZfA5%2B0l
>> FhpJoq2FEEJb1d5kQrogu9%2FLQt3Po%3D&reserved=0<https://eur02.safelinks/.
>> protection.outlook.com/?url=http%3A%2F%2Fwww.shell.ai%2F&data=05%7C01%
>> 7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e9
>> 6a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789331058%7CUnknown%7CT
>> WFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI
>> 6Mn0%3D%7C3000%7C%7C%7C&sdata=zaHgal1ZfA5%2B0lFhpJoq2FEEJb1d5kQrogu9%2
>> FLQt3Po%3D&reserved=0>
>>
>>
>>       [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat/
>> .ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7CWayne.W.Jones%40shell.com%7C991ba83bef5648af7e8408dbdca7deea%7Cdb1e96a8a3da442a930b235cac24cd5c%7C0%7C0%7C638346385789487307%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=QNipEDt1FYAnFH0ohACT780ijWX6vPufS9F37Mp8Cxw%3D&reserved=0
>>
>


From th|erry@onke||nx @end|ng |rom |nbo@be  Tue Nov  7 20:55:26 2023
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Tue, 7 Nov 2023 20:55:26 +0100
Subject: [R-pkg-devel] circular suggested packages
Message-ID: <CAJuCY5xeFGFG7QJwz_GnnhDwnMpxbRY+LfGkY6N6TYfXya=ydg@mail.gmail.com>

Dear all,

The qrcode package converts text into a qrcode image. The opencv package is
able to convert images with a qrcode into the text. opencv has a unit test
that uses qrcode to generate a test image. Hence it lists qrcode as a
suggested package.

Would it be OK to implement the same unit test in qrcode? And thus
requiring qrcode to list opencv as a suggested package. I know this is not
allowed when depending or importing packages.

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>

	[[alternative HTML version deleted]]


From rmh @end|ng |rom temp|e@edu  Tue Nov  7 21:01:01 2023
From: rmh @end|ng |rom temp|e@edu (Richard M. Heiberger)
Date: Tue, 7 Nov 2023 20:01:01 +0000
Subject: [R-pkg-devel] [External]  circular suggested packages
In-Reply-To: <CAJuCY5xeFGFG7QJwz_GnnhDwnMpxbRY+LfGkY6N6TYfXya=ydg@mail.gmail.com>
References: <CAJuCY5xeFGFG7QJwz_GnnhDwnMpxbRY+LfGkY6N6TYfXya=ydg@mail.gmail.com>
Message-ID: <F6B21DA7-7776-4233-843D-B185E3770738@temple.edu>

Why are these functins in two different packages?
On the surface it looks like qrcode is a transformation function and opencv is its inverse.

> On Nov 7, 2023, at 14:55, Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>
> Dear all,
>
> The qrcode package converts text into a qrcode image. The opencv package is
> able to convert images with a qrcode into the text. opencv has a unit test
> that uses qrcode to generate a test image. Hence it lists qrcode as a
> suggested package.
>
> Would it be OK to implement the same unit test in qrcode? And thus
> requiring qrcode to list opencv as a suggested package. I know this is not
> allowed when depending or importing packages.
>
> Best regards,
>
> ir. Thierry Onkelinx
> Statisticus / Statistician
>
> Vlaamse Overheid / Government of Flanders
> INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
> FOREST
> Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
> thierry.onkelinx at inbo.be
> Havenlaan 88 bus 73, 1000 Brussel
> http://www.inbo.be/
>
> ///////////////////////////////////////////////////////////////////////////////////////////
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to say
> what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
> ///////////////////////////////////////////////////////////////////////////////////////////
>
> <https://www.inbo.be/>
>
> [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From th|erry@onke||nx @end|ng |rom |nbo@be  Tue Nov  7 21:13:32 2023
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Tue, 7 Nov 2023 21:13:32 +0100
Subject: [R-pkg-devel] [External]  circular suggested packages
In-Reply-To: <F6B21DA7-7776-4233-843D-B185E3770738@temple.edu>
References: <CAJuCY5xeFGFG7QJwz_GnnhDwnMpxbRY+LfGkY6N6TYfXya=ydg@mail.gmail.com>
 <F6B21DA7-7776-4233-843D-B185E3770738@temple.edu>
Message-ID: <CAJuCY5xaf6QHDLLRvSc3KOfrb+nhmBssHbwgA-XuKUXieNr3hA@mail.gmail.com>

The goal of opencv is to provide bindings to 'OpenCV' Computer Vision
Library. Hence a much wider scope than just reading qrcodes. qrcode just
focusses creating different qrcodes. The fact that they can use each other
to test themselves is a happy coincidence.

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op di 7 nov 2023 om 21:01 schreef Richard M. Heiberger <rmh at temple.edu>:

> Why are these functins in two different packages?
> On the surface it looks like qrcode is a transformation function and
> opencv is its inverse.
>
> > On Nov 7, 2023, at 14:55, Thierry Onkelinx <thierry.onkelinx at inbo.be>
> wrote:
> >
> > Dear all,
> >
> > The qrcode package converts text into a qrcode image. The opencv package
> is
> > able to convert images with a qrcode into the text. opencv has a unit
> test
> > that uses qrcode to generate a test image. Hence it lists qrcode as a
> > suggested package.
> >
> > Would it be OK to implement the same unit test in qrcode? And thus
> > requiring qrcode to list opencv as a suggested package. I know this is
> not
> > allowed when depending or importing packages.
> >
> > Best regards,
> >
> > ir. Thierry Onkelinx
> > Statisticus / Statistician
> >
> > Vlaamse Overheid / Government of Flanders
> > INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE
> AND
> > FOREST
> > Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
> > thierry.onkelinx at inbo.be
> > Havenlaan 88 bus 73, 1000 Brussel
> > http://www.inbo.be/
> >
> >
> ///////////////////////////////////////////////////////////////////////////////////////////
> > To call in the statistician after the experiment is done may be no more
> > than asking him to perform a post-mortem examination: he may be able to
> say
> > what the experiment died of. ~ Sir Ronald Aylmer Fisher
> > The plural of anecdote is not data. ~ Roger Brinner
> > The combination of some data and an aching desire for an answer does not
> > ensure that a reasonable answer can be extracted from a given body of
> data.
> > ~ John Tukey
> >
> ///////////////////////////////////////////////////////////////////////////////////////////
> >
> > <https://www.inbo.be/>
> >
> > [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Nov  7 21:52:39 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 7 Nov 2023 15:52:39 -0500
Subject: [R-pkg-devel] circular suggested packages
In-Reply-To: <CAJuCY5xeFGFG7QJwz_GnnhDwnMpxbRY+LfGkY6N6TYfXya=ydg@mail.gmail.com>
References: <CAJuCY5xeFGFG7QJwz_GnnhDwnMpxbRY+LfGkY6N6TYfXya=ydg@mail.gmail.com>
Message-ID: <9d0fadc3-0745-4efa-8fd5-cf0f32ad7c8e@gmail.com>

On 07/11/2023 2:55 p.m., Thierry Onkelinx wrote:
> Dear all,
> 
> The qrcode package converts text into a qrcode image. The opencv package is
> able to convert images with a qrcode into the text. opencv has a unit test
> that uses qrcode to generate a test image. Hence it lists qrcode as a
> suggested package.
> 
> Would it be OK to implement the same unit test in qrcode? And thus
> requiring qrcode to list opencv as a suggested package. I know this is not
> allowed when depending or importing packages.

Yes, that is allowed.  There was a thread about a related issue just a 
few days ago:  "PkgA imports PkgB, and PkgB suggests PkgA?".

Duncan Murdoch

> 
> Best regards,
> 
> ir. Thierry Onkelinx
> Statisticus / Statistician
> 
> Vlaamse Overheid / Government of Flanders
> INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
> FOREST
> Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
> thierry.onkelinx at inbo.be
> Havenlaan 88 bus 73, 1000 Brussel
> www.inbo.be
> 
> ///////////////////////////////////////////////////////////////////////////////////////////
> To call in the statistician after the experiment is done may be no more
> than asking him to perform a post-mortem examination: he may be able to say
> what the experiment died of. ~ Sir Ronald Aylmer Fisher
> The plural of anecdote is not data. ~ Roger Brinner
> The combination of some data and an aching desire for an answer does not
> ensure that a reasonable answer can be extracted from a given body of data.
> ~ John Tukey
> ///////////////////////////////////////////////////////////////////////////////////////////
> 
> <https://www.inbo.be>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Nov  7 22:53:41 2023
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 07 Nov 2023 13:53:41 -0800
Subject: [R-pkg-devel] [External]  circular suggested packages
In-Reply-To: <F6B21DA7-7776-4233-843D-B185E3770738@temple.edu>
References: <CAJuCY5xeFGFG7QJwz_GnnhDwnMpxbRY+LfGkY6N6TYfXya=ydg@mail.gmail.com>
 <F6B21DA7-7776-4233-843D-B185E3770738@temple.edu>
Message-ID: <B4935D2B-3FCD-41D3-956A-4A1D1FD09C9C@dcn.davis.ca.us>

Richard ... they are by different maintainers. They also are built with completely different underlying technologies... creating a bitmap is easy, deciphering one is difficult and may not be necessary in the same workflow and there may be different compiled code available optimized for different use cases (clean vs with optical interference) so it makes perfect sense to me.

On November 7, 2023 12:01:01 PM PST, "Richard M. Heiberger" <rmh at temple.edu> wrote:
>Why are these functins in two different packages?
>On the surface it looks like qrcode is a transformation function and opencv is its inverse.
>
>> On Nov 7, 2023, at 14:55, Thierry Onkelinx <thierry.onkelinx at inbo.be> wrote:
>>
>> Dear all,
>>
>> The qrcode package converts text into a qrcode image. The opencv package is
>> able to convert images with a qrcode into the text. opencv has a unit test
>> that uses qrcode to generate a test image. Hence it lists qrcode as a
>> suggested package.
>>
>> Would it be OK to implement the same unit test in qrcode? And thus
>> requiring qrcode to list opencv as a suggested package. I know this is not
>> allowed when depending or importing packages.
>>
>> Best regards,
>>
>> ir. Thierry Onkelinx
>> Statisticus / Statistician
>>
>> Vlaamse Overheid / Government of Flanders
>> INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
>> FOREST
>> Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
>> thierry.onkelinx at inbo.be
>> Havenlaan 88 bus 73, 1000 Brussel
>> http://www.inbo.be/
>>
>> ///////////////////////////////////////////////////////////////////////////////////////////
>> To call in the statistician after the experiment is done may be no more
>> than asking him to perform a post-mortem examination: he may be able to say
>> what the experiment died of. ~ Sir Ronald Aylmer Fisher
>> The plural of anecdote is not data. ~ Roger Brinner
>> The combination of some data and an aching desire for an answer does not
>> ensure that a reasonable answer can be extracted from a given body of data.
>> ~ John Tukey
>> ///////////////////////////////////////////////////////////////////////////////////////////
>>
>> <https://www.inbo.be/>
>>
>> [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From k@ro||n@@m@rek10 @end|ng |rom gm@||@com  Wed Nov  8 17:54:30 2023
From: k@ro||n@@m@rek10 @end|ng |rom gm@||@com (Karolina Marek)
Date: Wed, 8 Nov 2023 17:54:30 +0100
Subject: [R-pkg-devel] The problem with resubmitting the package to the Cran
Message-ID: <CAPzG1RQzhp38RNOaauNXEtUmzvKQ8taeGuQNpSWPEURb5FOHQg@mail.gmail.com>

Hello,

I have the following case. I would like to resubmit a package to the Cran -
per ARMA, which was archived on 2022-05-25, as it required the archived
package 'matlab'. The new version of the 'matlab' was resubmitted to the
Cran on 2022-06-01. So we would like that our package will also return to
the Cran. I didn't change anything significant in the code inside. However,
when I try to submit the package, I receive the following NOTES:

 checking CRAN incoming feasibility ... NOTE

* checking for non-standard things in the check directory ... NOTE
Found the following files/directories:
  ?PARMA21del1_ident'

I don't know really what this note mean and can I put the package
anyway to Cran?



Best regards,

Karolina

	[[alternative HTML version deleted]]


From ||@m@reve|| @end|ng |rom umb@edu  Thu Nov  9 03:50:46 2023
From: ||@m@reve|| @end|ng |rom umb@edu (Liam J. Revell)
Date: Wed, 8 Nov 2023 21:50:46 -0500
Subject: [R-pkg-devel] Warning from orphaned package on check page
Message-ID: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>

Dear colleagues.

I'm trying to update a package on CRAN containing a dependency 
(specifically, on the popular graphing package 'plotrix') that has been 
orphaned because the maintainer is deceased.

'plotrix' is imported by well over 100 other CRAN packages, so I hope it 
is not removed from CRAN. On the other hand, I don't want to certify 
that 'I have fixed all problems shown on the package check page' if this 
is not, in fact, the case.

Can anyone comment on how one might proceed in this situation?

Thank you. -- Liam

-- 
Liam J. Revell
Professor of Biology, University of Massachusetts Boston
Web: http://faculty.umb.edu/liam.revell/
Book: Phylogenetic Comparative Methods in R (Princeton University Press, 
2022)


From d@n|e|@c|@borne @end|ng |rom pnn|@gov  Thu Nov  9 08:01:30 2023
From: d@n|e|@c|@borne @end|ng |rom pnn|@gov (Claborne, Daniel)
Date: Thu, 9 Nov 2023 07:01:30 +0000
Subject: [R-pkg-devel] Additional_packages in drat repositories
Message-ID: <CO6PR09MB8597283A2E1D45DBC0F0F59289AFA@CO6PR09MB8597.namprd09.prod.outlook.com>

I have a data package ?pmartRdata? hosted in a drat repository here:  https://github.com/pmartR/drat following the instructions here:  https://cran.r-project.org/web/packages/drat/vignettes/DratStepByStep.html

The package installs fine via install.packages(?pmartRdata?, repos = ?https://pmartR.github.io/drat?).  I have included it under Suggests and added ?https://pmartR.github.io/drat? to the Additional_repositories field in the DESCRIPTION of a package I am submitting to CRAN.  I?m getting failures on Debian/R-devel and Windows/R-devel when running examples that use this package:

`Error in library(pmartRdata) : there is no package called ?pmartRdata?`

Checks on rhub via `rhub::check_for_cran` for ubuntu,fedora, and windows do not have this problem.  What do I need to do to get it to install on CRAN submission machines?

Best,
-Daniel Claborne

	[[alternative HTML version deleted]]


From m@rk@p@dgh@m @end|ng |rom em@||@com  Thu Nov  9 10:10:44 2023
From: m@rk@p@dgh@m @end|ng |rom em@||@com (Mark Padgham)
Date: Thu, 9 Nov 2023 10:10:44 +0100
Subject: [R-pkg-devel] 
 The problem with resubmitting the package to the Cran
In-Reply-To: <CAPzG1RQzhp38RNOaauNXEtUmzvKQ8taeGuQNpSWPEURb5FOHQg@mail.gmail.com>
References: <CAPzG1RQzhp38RNOaauNXEtUmzvKQ8taeGuQNpSWPEURb5FOHQg@mail.gmail.com>
Message-ID: <6d56f543-c3e7-455d-80e1-941b991c50ff@email.com>

You'll need to fix that note before resubmitting. If you can share a
link to a public repository, people in this list will likely be able to
help.

regards, Mark

On 11/8/23 17:54, Karolina Marek wrote:
> Hello,
>
> I have the following case. I would like to resubmit a package to the Cran -
> per ARMA, which was archived on 2022-05-25, as it required the archived
> package 'matlab'. The new version of the 'matlab' was resubmitted to the
> Cran on 2022-06-01. So we would like that our package will also return to
> the Cran. I didn't change anything significant in the code inside. However,
> when I try to submit the package, I receive the following NOTES:
>
>   checking CRAN incoming feasibility ... NOTE
>
> * checking for non-standard things in the check directory ... NOTE
> Found the following files/directories:
>    ?PARMA21del1_ident'
>
> I don't know really what this note mean and can I put the package
> anyway to Cran?
>
>
>
> Best regards,
>
> Karolina
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @|ex@ndre@court|o| @end|ng |rom gm@||@com  Thu Nov  9 10:10:48 2023
From: @|ex@ndre@court|o| @end|ng |rom gm@||@com (Alexandre Courtiol)
Date: Thu, 9 Nov 2023 10:10:48 +0100
Subject: [R-pkg-devel] Warning from orphaned package on check page
In-Reply-To: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
References: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
Message-ID: <CAERMt4cC3HP+K4AN1=Sn9uUbBZDBb9MKAYS_JZbu1wMF1+kt8g@mail.gmail.com>

Dear Liam,
I don't understand your question: if your package has plotrix listed as a
dependency, it won't affect plotrix.
Only the opposite would be true. Could you please clarify and indicate
which package you are referring to?
Thanks,
Alex



On Thu, 9 Nov 2023 at 09:57, Liam J. Revell <liam.revell at umb.edu> wrote:

> Dear colleagues.
>
> I'm trying to update a package on CRAN containing a dependency
> (specifically, on the popular graphing package 'plotrix') that has been
> orphaned because the maintainer is deceased.
>
> 'plotrix' is imported by well over 100 other CRAN packages, so I hope it
> is not removed from CRAN. On the other hand, I don't want to certify
> that 'I have fixed all problems shown on the package check page' if this
> is not, in fact, the case.
>
> Can anyone comment on how one might proceed in this situation?
>
> Thank you. -- Liam
>
> --
> Liam J. Revell
> Professor of Biology, University of Massachusetts Boston
> Web: http://faculty.umb.edu/liam.revell/
> Book: Phylogenetic Comparative Methods in R (Princeton University Press,
> 2022)
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


-- 
Alexandre Courtiol, www.datazoogang.de

	[[alternative HTML version deleted]]


From @|ex@ndre@court|o| @end|ng |rom gm@||@com  Thu Nov  9 10:14:40 2023
From: @|ex@ndre@court|o| @end|ng |rom gm@||@com (Alexandre Courtiol)
Date: Thu, 9 Nov 2023 10:14:40 +0100
Subject: [R-pkg-devel] 
 The problem with resubmitting the package to the Cran
In-Reply-To: <CAPzG1RQzhp38RNOaauNXEtUmzvKQ8taeGuQNpSWPEURb5FOHQg@mail.gmail.com>
References: <CAPzG1RQzhp38RNOaauNXEtUmzvKQ8taeGuQNpSWPEURb5FOHQg@mail.gmail.com>
Message-ID: <CAERMt4eRgAB_jgFQJs1DPRo-+HUw7F3VH+Qhm3zAmjqXpK3uwA@mail.gmail.com>

Dear Karolina,
It means that you have an unexpected file or folder called
"PARMA21del1_ident" inside your package.
So either remove it or list it in a file called .Rbuildignore which you
place at the root of the package folder.
Best,
Alex

On Thu, 9 Nov 2023 at 09:57, Karolina Marek <karolina.marek10 at gmail.com>
wrote:

> Hello,
>
> I have the following case. I would like to resubmit a package to the Cran -
> per ARMA, which was archived on 2022-05-25, as it required the archived
> package 'matlab'. The new version of the 'matlab' was resubmitted to the
> Cran on 2022-06-01. So we would like that our package will also return to
> the Cran. I didn't change anything significant in the code inside. However,
> when I try to submit the package, I receive the following NOTES:
>
>  checking CRAN incoming feasibility ... NOTE
>
> * checking for non-standard things in the check directory ... NOTE
> Found the following files/directories:
>   ?PARMA21del1_ident'
>
> I don't know really what this note mean and can I put the package
> anyway to Cran?
>
>
>
> Best regards,
>
> Karolina
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


-- 
Alexandre Courtiol, www.datazoogang.de

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu Nov  9 10:16:19 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 9 Nov 2023 10:16:19 +0100
Subject: [R-pkg-devel] 
 The problem with resubmitting the package to the Cran
In-Reply-To: <CAPzG1RQzhp38RNOaauNXEtUmzvKQ8taeGuQNpSWPEURb5FOHQg@mail.gmail.com>
References: <CAPzG1RQzhp38RNOaauNXEtUmzvKQ8taeGuQNpSWPEURb5FOHQg@mail.gmail.com>
Message-ID: <210564e0-2b26-a29f-4aba-6c6ff7a8270c@statistik.tu-dortmund.de>



On 08.11.2023 17:54, Karolina Marek wrote:
> Hello,
> 
> I have the following case. I would like to resubmit a package to the Cran -
> per ARMA, which was archived on 2022-05-25, as it required the archived
> package 'matlab'. The new version of the 'matlab' was resubmitted to the
> Cran on 2022-06-01. So we would like that our package will also return to
> the Cran. I didn't change anything significant in the code inside. However,
> when I try to submit the package, I receive the following NOTES:
> 
>   checking CRAN incoming feasibility ... NOTE
> 
> * checking for non-standard things in the check directory ... NOTE
> Found the following files/directories:
>    ?PARMA21del1_ident'

Apparently you create this file during the checks. So examples or 
vignette code executed by users may write it into the user filespace. 
You must not write their by default nor in examples etc.
Let the user choose the filename and otherwise, e.g., in examples, use 
tempdir() as a location for writing files.

Best,
Uwe Ligges



> 
> I don't know really what this note mean and can I put the package
> anyway to Cran?
> 
> 
> 
> Best regards,
> 
> Karolina
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @ergue|@@oko| @end|ng |rom gm@||@com  Thu Nov  9 10:30:08 2023
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Thu, 9 Nov 2023 10:30:08 +0100
Subject: [R-pkg-devel] Additional_packages in drat repositories
In-Reply-To: <CO6PR09MB8597283A2E1D45DBC0F0F59289AFA@CO6PR09MB8597.namprd09.prod.outlook.com>
References: <CO6PR09MB8597283A2E1D45DBC0F0F59289AFA@CO6PR09MB8597.namprd09.prod.outlook.com>
Message-ID: <765bbc5b-80cb-436c-811e-0bff1f17d3bc@gmail.com>

Le 09/11/2023 ? 08:01, Claborne, Daniel via R-package-devel a ?crit?:
> I have a data package ?pmartRdata? hosted in a drat repository here:  https://github.com/pmartR/drat following the instructions here:  https://cran.r-project.org/web/packages/drat/vignettes/DratStepByStep.html
>
> The package installs fine via install.packages(?pmartRdata?, repos = ?https://pmartR.github.io/drat?).  I have included it under Suggests and added ?https://pmartR.github.io/drat? to the Additional_repositories field in the DESCRIPTION of a package I am submitting to CRAN.  I?m getting failures on Debian/R-devel and Windows/R-devel when running examples that use this package:
>
> `Error in library(pmartRdata) : there is no package called ?pmartRdata?`
>
> Checks on rhub via `rhub::check_for_cran` for ubuntu,fedora, and windows do not have this problem.  What do I need to do to get it to install on CRAN submission machines?

Generally, you cannot assume that suggested package is available on CRAN 
(or any other) machine. Instead, you have to put the code involving 
suggested package inside an 'if()' clause, like:

if (requireNamespace("pkg", quietly=TRUE) {

 ?? pkg::do_something()

}


Best,
Serguei.


>
> Best,
> -Daniel Claborne
>
> 	[[alternative HTML version deleted]]
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ||@m@reve|| @end|ng |rom umb@edu  Thu Nov  9 12:30:05 2023
From: ||@m@reve|| @end|ng |rom umb@edu (Liam J. Revell)
Date: Thu, 9 Nov 2023 06:30:05 -0500
Subject: [R-pkg-devel] Warning from orphaned package on check page
In-Reply-To: <CAERMt4cC3HP+K4AN1=Sn9uUbBZDBb9MKAYS_JZbu1wMF1+kt8g@mail.gmail.com>
References: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
 <CAERMt4cC3HP+K4AN1=Sn9uUbBZDBb9MKAYS_JZbu1wMF1+kt8g@mail.gmail.com>
Message-ID: <bf8a9a30-0e46-4991-8244-d6b54da2e349@umb.edu>

My apologies for the lack of clarity.

plotrix has been orphaned so my package results page now says

 ??? checking package dependencies ... WARNING
 ??? Requires orphaned package: ?plotrix?

CRAN incoming requires maintainers to certify: 'I have fixed all 
problems shown on the package check page.' Since I can't unorphan 
plotrix, I can't certify this statement & thus can't get a new version 
of my package on CRAN. Advice on how to proceed is welcomed.

Liam J. Revell
Professor of Biology, University of Massachusetts Boston
Web: http://faculty.umb.edu/liam.revell/
Book: Phylogenetic Comparative Methods in R (Princeton University Press, 
2022)

On 11/9/2023 4:10 AM, Alexandre Courtiol wrote:
>
> 	
> You don't often get email from alexandre.courtiol at gmail.com. Learn why 
> this is important <https://aka.ms/LearnAboutSenderIdentification>
> 	
>
> CAUTION: EXTERNAL SENDER
> Dear Liam,
> I don't understand your question: if your package has plotrix listed 
> as a dependency, it won't affect plotrix.
> Only the opposite would be true. Could you please clarify and indicate 
> which package you are referring to?
> Thanks,
> Alex
>
>
>
> On Thu, 9 Nov 2023 at 09:57, Liam J. Revell <liam.revell at umb.edu> wrote:
>
>     Dear colleagues.
>
>     I'm trying to update a package on CRAN containing a dependency
>     (specifically, on the popular graphing package 'plotrix') that has
>     been
>     orphaned because the maintainer is deceased.
>
>     'plotrix' is imported by well over 100 other CRAN packages, so I
>     hope it
>     is not removed from CRAN. On the other hand, I don't want to certify
>     that 'I have fixed all problems shown on the package check page'
>     if this
>     is not, in fact, the case.
>
>     Can anyone comment on how one might proceed in this situation?
>
>     Thank you. -- Liam
>
>     -- 
>     Liam J. Revell
>     Professor of Biology, University of Massachusetts Boston
>     Web: http://faculty.umb.edu/liam.revell/
>     <http://faculty.umb.edu/liam.revell/>
>     Book: Phylogenetic Comparative Methods in R (Princeton University
>     Press,
>     2022)
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>
>
>
> -- 
> Alexandre Courtiol, http://www.datazoogang.de/ 
> <http://www.datazoogang.de/>
	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Nov  9 12:38:10 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 9 Nov 2023 14:38:10 +0300
Subject: [R-pkg-devel] Warning from orphaned package on check page
In-Reply-To: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
References: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
Message-ID: <20231109143810.2157d070@arachnoid>

? Wed, 8 Nov 2023 21:50:46 -0500
"Liam J. Revell" <liam.revell at umb.edu> ?????:

> 'plotrix' is imported by well over 100 other CRAN packages, so I hope
> it is not removed from CRAN.

The CRAN team has already updated it once [1], fixing a number of Rd
problems to ensure that it stays on CRAN for now and thus avoiding the
immediate damage to the ecosystem, but eventually, someone interested
in keeping this package working will have to step up and become the new
maintainer.

> On the other hand, I don't want to certify that 'I have fixed all
> problems shown on the package check page' if this is not, in fact,
> the case.

My interpretation is that while your packages still depend on plotrix,
this counts as a major problem. Can you make it at least an optional
dependency?

-- 
Best regards,
Ivan

[1]
https://cran.r-project.org/web/packages/plotrix/NEWS for version 3.8-3


From georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk  Thu Nov  9 12:42:52 2023
From: georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk (Georgi Boshnakov)
Date: Thu, 9 Nov 2023 11:42:52 +0000
Subject: [R-pkg-devel] Warning from orphaned package on check page
In-Reply-To: <bf8a9a30-0e46-4991-8244-d6b54da2e349@umb.edu>
References: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
 <CAERMt4cC3HP+K4AN1=Sn9uUbBZDBb9MKAYS_JZbu1wMF1+kt8g@mail.gmail.com>
 <bf8a9a30-0e46-4991-8244-d6b54da2e349@umb.edu>
Message-ID: <LO0P265MB632566A323BE674151DA6C18AEAFA@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>

Orphaned packages can't be listed in DEPENDS and IMPORTS fields in file DESCRIPTION. They can be in SUGGESTS but calls of functions from them should be guarded, eg with a message to install the offending package. In examples and tests the usage should be conditional on the package being installed.

Another option is to take over maintenance of that package. In your case, with so many dependencies someone may be working on bringing it back.

Georgi Boshnakov

Sent from Outlook for Android<https://aka.ms/AAb9ysg>
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Liam J. Revell <liam.revell at umb.edu>
Sent: Thursday, November 9, 2023 11:30:05 AM
To: Alexandre Courtiol <alexandre.courtiol at gmail.com>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Warning from orphaned package on check page

My apologies for the lack of clarity.

plotrix has been orphaned so my package results page now says

     checking package dependencies ... WARNING
     Requires orphaned package: ?plotrix?

CRAN incoming requires maintainers to certify: 'I have fixed all
problems shown on the package check page.' Since I can't unorphan
plotrix, I can't certify this statement & thus can't get a new version
of my package on CRAN. Advice on how to proceed is welcomed.

Liam J. Revell
Professor of Biology, University of Massachusetts Boston
Web: https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$ [faculty[.]umb[.]edu]
Book: Phylogenetic Comparative Methods in R (Princeton University Press,
2022)

On 11/9/2023 4:10 AM, Alexandre Courtiol wrote:
>
>
> You don't often get email from alexandre.courtiol at gmail.com. Learn why
> this is important <https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXKg7CKCI$ [aka[.]ms]>
>
>
> CAUTION: EXTERNAL SENDER
> Dear Liam,
> I don't understand your question: if your package has plotrix listed
> as a dependency, it won't affect plotrix.
> Only the opposite would be true. Could you please clarify and indicate
> which package you are referring to?
> Thanks,
> Alex
>
>
>
> On Thu, 9 Nov 2023 at 09:57, Liam J. Revell <liam.revell at umb.edu> wrote:
>
>     Dear colleagues.
>
>     I'm trying to update a package on CRAN containing a dependency
>     (specifically, on the popular graphing package 'plotrix') that has
>     been
>     orphaned because the maintainer is deceased.
>
>     'plotrix' is imported by well over 100 other CRAN packages, so I
>     hope it
>     is not removed from CRAN. On the other hand, I don't want to certify
>     that 'I have fixed all problems shown on the package check page'
>     if this
>     is not, in fact, the case.
>
>     Can anyone comment on how one might proceed in this situation?
>
>     Thank you. -- Liam
>
>     --
>     Liam J. Revell
>     Professor of Biology, University of Massachusetts Boston
>     Web: https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$ [faculty[.]umb[.]edu]
>     <https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$ [faculty[.]umb[.]edu]>
>     Book: Phylogenetic Comparative Methods in R (Princeton University
>     Press,
>     2022)
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>     https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$ [stat[.]ethz[.]ch]
>     <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$ [stat[.]ethz[.]ch]>
>
>
>
> --
> Alexandre Courtiol, https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$ [datazoogang[.]de]
> <https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$ [datazoogang[.]de]>
        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$ [stat[.]ethz[.]ch]

	[[alternative HTML version deleted]]


From ||@m@reve|| @end|ng |rom umb@edu  Thu Nov  9 15:47:08 2023
From: ||@m@reve|| @end|ng |rom umb@edu (Liam J. Revell)
Date: Thu, 9 Nov 2023 09:47:08 -0500
Subject: [R-pkg-devel] Warning from orphaned package on check page
In-Reply-To: <LO0P265MB632566A323BE674151DA6C18AEAFA@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
References: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
 <CAERMt4cC3HP+K4AN1=Sn9uUbBZDBb9MKAYS_JZbu1wMF1+kt8g@mail.gmail.com>
 <bf8a9a30-0e46-4991-8244-d6b54da2e349@umb.edu>
 <LO0P265MB632566A323BE674151DA6C18AEAFA@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <7b98914b-e186-4793-9b07-f6cc6ce1b456@umb.edu>

Thank you Georgi & Ivan for your comments.

Because of the way 'plotrix' is written, it turns out to be very easy to 
copy the imported functions into a new source file in my package (let's 
say, plotrix_fn.R) and remove the dependency.

What I've actually done is move 'plotrix' to Suggests, and then have R 
check to see if plotrix is installed to determine which version of each 
function to use. E.g.:

 ??? arctext<-if(.check.pkg("plotrix")) plotrix::arctext else Arctext

in which 'arctext' is the function name exported by plotrix and Arctext 
is the copy in my package.

I believe this is permitted under GPL-3. Can someone with more 
experience in this recommend how the original authors of plotrix should 
be properly credited?

Thanks again for this constructive feedback.

All the best, Liam

Liam J. Revell
Professor of Biology, University of Massachusetts Boston
Web: http://faculty.umb.edu/liam.revell/
Book: Phylogenetic Comparative Methods in R (Princeton University Press, 
2022)


On 11/9/2023 6:42 AM, Georgi Boshnakov wrote:
>
> 	
> You don't often get email from georgi.boshnakov at manchester.ac.uk. 
> Learn why this is important 
> <https://aka.ms/LearnAboutSenderIdentification>
> 	
>
> CAUTION: EXTERNAL SENDER
> Orphaned packages can't be listed in DEPENDS and IMPORTS fields in 
> file DESCRIPTION. They can be in SUGGESTS but calls of functions from 
> them should be guarded, eg with a message to install the offending 
> package. In examples and tests the usage should be conditional on the 
> package beinginstalled.
>
> Another option is to take over maintenance of that package. In your 
> case, with so many dependencies someone may be working on bringing it 
> back.
>
> Georgi Boshnakov
>
> Sent from Outlook for Android 
> <https://aka.ms/AAb9ysg>
> ------------------------------------------------------------------------
> *From:* R-package-devel <r-package-devel-bounces at r-project.org> on 
> behalf of Liam J. Revell <liam.revell at umb.edu>
> *Sent:* Thursday, November 9, 2023 11:30:05 AM
> *To:* Alexandre Courtiol <alexandre.courtiol at gmail.com>
> *Cc:* r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject:* Re: [R-pkg-devel] Warning from orphaned package on check page
> My apologies for the lack of clarity.
>
> plotrix has been orphaned so my package results page now says
>
> ???? checking package dependencies ... WARNING
> ???? Requires orphaned package: ?plotrix?
>
> CRAN incoming requires maintainers to certify: 'I have fixed all
> problems shown on the package check page.' Since I can't unorphan
> plotrix, I can't certify this statement & thus can't get a new version
> of my package on CRAN. Advice on how to proceed is welcomed.
>
> Liam J. Revell
> Professor of Biology, University of Massachusetts Boston
> Web: 
> https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$ 
> <https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$> 
> [faculty[.]umb[.]edu]
> Book: Phylogenetic Comparative Methods in R (Princeton University Press,
> 2022)
>
> On 11/9/2023 4:10 AM, Alexandre Courtiol wrote:
> >
> >
> > You don't often get email from alexandre.courtiol at gmail.com. Learn why
> > this is important 
> <https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXKg7CKCI$ 
> [aka[.]ms]>
> >
> >
> > CAUTION: EXTERNAL SENDER
> > Dear Liam,
> > I don't understand your question: if your package has plotrix listed
> > as a dependency, it won't affect plotrix.
> > Only the opposite would be true. Could you please clarify and indicate
> > which package you are referring to?
> > Thanks,
> > Alex
> >
> >
> >
> > On Thu, 9 Nov 2023 at 09:57, Liam J. Revell <liam.revell at umb.edu> wrote:
> >
> >???? Dear colleagues.
> >
> >???? I'm trying to update a package on CRAN containing a dependency
> >???? (specifically, on the popular graphing package 'plotrix') that has
> >???? been
> >???? orphaned because the maintainer is deceased.
> >
> >???? 'plotrix' is imported by well over 100 other CRAN packages, so I
> >???? hope it
> >???? is not removed from CRAN. On the other hand, I don't want to certify
> >???? that 'I have fixed all problems shown on the package check page'
> >???? if this
> >???? is not, in fact, the case.
> >
> >???? Can anyone comment on how one might proceed in this situation?
> >
> >???? Thank you. -- Liam
> >
> >???? --
> >???? Liam J. Revell
> >???? Professor of Biology, University of Massachusetts Boston
> >???? Web: 
> https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$ 
> <https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$> 
> [faculty[.]umb[.]edu]
> > 
> <https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$ 
> [faculty[.]umb[.]edu]>
> >???? Book: Phylogenetic Comparative Methods in R (Princeton University
> >???? Press,
> >???? 2022)
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > 
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$ 
> <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$> 
> [stat[.]ethz[.]ch]
> > 
> <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$ 
> [stat[.]ethz[.]ch]>
> >
> >
> >
> > --
> > Alexandre Courtiol, 
> https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$ 
> <https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$> 
> [datazoogang[.]de]
> > 
> <https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$ 
> [datazoogang[.]de]>
> ??????? [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$ 
> <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$> 
> [stat[.]ethz[.]ch]
	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Nov  9 16:48:38 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 9 Nov 2023 10:48:38 -0500
Subject: [R-pkg-devel] Warning from orphaned package on check page
In-Reply-To: <7b98914b-e186-4793-9b07-f6cc6ce1b456@umb.edu>
References: <3a5a605e-48dd-4c4d-a918-d62202b9f886@umb.edu>
 <CAERMt4cC3HP+K4AN1=Sn9uUbBZDBb9MKAYS_JZbu1wMF1+kt8g@mail.gmail.com>
 <bf8a9a30-0e46-4991-8244-d6b54da2e349@umb.edu>
 <LO0P265MB632566A323BE674151DA6C18AEAFA@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
 <7b98914b-e186-4793-9b07-f6cc6ce1b456@umb.edu>
Message-ID: <61d056d1-33d4-4702-a756-93cd83789bc0@gmail.com>

I have volunteered to take over maintenance of plotrix.  I should be 
submitting a version without the "orphaned" designation soon.

(If anyone else would rather be maintainer, please get in touch with me 
offline.)

Duncan Murdoch

On 09/11/2023 9:47 a.m., Liam J. Revell wrote:
> Thank you Georgi & Ivan for your comments.
> 
> Because of the way 'plotrix' is written, it turns out to be very easy to
> copy the imported functions into a new source file in my package (let's
> say, plotrix_fn.R) and remove the dependency.
> 
> What I've actually done is move 'plotrix' to Suggests, and then have R
> check to see if plotrix is installed to determine which version of each
> function to use. E.g.:
> 
>   ??? arctext<-if(.check.pkg("plotrix")) plotrix::arctext else Arctext
> 
> in which 'arctext' is the function name exported by plotrix and Arctext
> is the copy in my package.
> 
> I believe this is permitted under GPL-3. Can someone with more
> experience in this recommend how the original authors of plotrix should
> be properly credited?
> 
> Thanks again for this constructive feedback.
> 
> All the best, Liam
> 
> Liam J. Revell
> Professor of Biology, University of Massachusetts Boston
> Web: http://faculty.umb.edu/liam.revell/
> Book: Phylogenetic Comparative Methods in R (Princeton University Press,
> 2022)
> 
> 
> On 11/9/2023 6:42 AM, Georgi Boshnakov wrote:
>>
>> 	
>> You don't often get email from georgi.boshnakov at manchester.ac.uk.
>> Learn why this is important
>> <https://aka.ms/LearnAboutSenderIdentification>
>> 	
>>
>> CAUTION: EXTERNAL SENDER
>> Orphaned packages can't be listed in DEPENDS and IMPORTS fields in
>> file DESCRIPTION. They can be in SUGGESTS but calls of functions from
>> them should be guarded, eg with a message to install the offending
>> package. In examples and tests the usage should be conditional on the
>> package beinginstalled.
>>
>> Another option is to take over maintenance of that package. In your
>> case, with so many dependencies someone may be working on bringing it
>> back.
>>
>> Georgi Boshnakov
>>
>> Sent from Outlook for Android
>> <https://aka.ms/AAb9ysg>
>> ------------------------------------------------------------------------
>> *From:* R-package-devel <r-package-devel-bounces at r-project.org> on
>> behalf of Liam J. Revell <liam.revell at umb.edu>
>> *Sent:* Thursday, November 9, 2023 11:30:05 AM
>> *To:* Alexandre Courtiol <alexandre.courtiol at gmail.com>
>> *Cc:* r-package-devel at r-project.org <r-package-devel at r-project.org>
>> *Subject:* Re: [R-pkg-devel] Warning from orphaned package on check page
>> My apologies for the lack of clarity.
>>
>> plotrix has been orphaned so my package results page now says
>>
>>  ???? checking package dependencies ... WARNING
>>  ???? Requires orphaned package: ?plotrix?
>>
>> CRAN incoming requires maintainers to certify: 'I have fixed all
>> problems shown on the package check page.' Since I can't unorphan
>> plotrix, I can't certify this statement & thus can't get a new version
>> of my package on CRAN. Advice on how to proceed is welcomed.
>>
>> Liam J. Revell
>> Professor of Biology, University of Massachusetts Boston
>> Web:
>> https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$
>> <https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$>
>> [faculty[.]umb[.]edu]
>> Book: Phylogenetic Comparative Methods in R (Princeton University Press,
>> 2022)
>>
>> On 11/9/2023 4:10 AM, Alexandre Courtiol wrote:
>>>
>>>
>>> You don't often get email from alexandre.courtiol at gmail.com. Learn why
>>> this is important
>> <https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXKg7CKCI$
>> [aka[.]ms]>
>>>
>>>
>>> CAUTION: EXTERNAL SENDER
>>> Dear Liam,
>>> I don't understand your question: if your package has plotrix listed
>>> as a dependency, it won't affect plotrix.
>>> Only the opposite would be true. Could you please clarify and indicate
>>> which package you are referring to?
>>> Thanks,
>>> Alex
>>>
>>>
>>>
>>> On Thu, 9 Nov 2023 at 09:57, Liam J. Revell <liam.revell at umb.edu> wrote:
>>>
>>>  ???? Dear colleagues.
>>>
>>>  ???? I'm trying to update a package on CRAN containing a dependency
>>>  ???? (specifically, on the popular graphing package 'plotrix') that has
>>>  ???? been
>>>  ???? orphaned because the maintainer is deceased.
>>>
>>>  ???? 'plotrix' is imported by well over 100 other CRAN packages, so I
>>>  ???? hope it
>>>  ???? is not removed from CRAN. On the other hand, I don't want to certify
>>>  ???? that 'I have fixed all problems shown on the package check page'
>>>  ???? if this
>>>  ???? is not, in fact, the case.
>>>
>>>  ???? Can anyone comment on how one might proceed in this situation?
>>>
>>>  ???? Thank you. -- Liam
>>>
>>>  ???? --
>>>  ???? Liam J. Revell
>>>  ???? Professor of Biology, University of Massachusetts Boston
>>>  ???? Web:
>> https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$
>> <https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$>
>> [faculty[.]umb[.]edu]
>>>
>> <https://urldefense.com/v3/__http://faculty.umb.edu/liam.revell/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXaHjdobg$
>> [faculty[.]umb[.]edu]>
>>>  ???? Book: Phylogenetic Comparative Methods in R (Princeton University
>>>  ???? Press,
>>>  ???? 2022)
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>>
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$
>> <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$>
>> [stat[.]ethz[.]ch]
>>>
>> <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$
>> [stat[.]ethz[.]ch]>
>>>
>>>
>>>
>>> --
>>> Alexandre Courtiol,
>> https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$
>> <https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$>
>> [datazoogang[.]de]
>>>
>> <https://urldefense.com/v3/__http://www.datazoogang.de/__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXtwIJCmI$
>> [datazoogang[.]de]>
>>  ??????? [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$
>> <https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!EUF27KhzseEpywIN0EnjFB_d4JQ9VgFwYWOCrNH1U9F6Bqh9SOqbi57oq38wPjZFM-40ALcQXaITFEjCuIgQOW0aznrXeH56VIc$>
>> [stat[.]ethz[.]ch]
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From j@g@nmn2 @end|ng |rom gm@||@com  Fri Nov 10 23:04:00 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Fri, 10 Nov 2023 17:04:00 -0500
Subject: [R-pkg-devel] Note to repository maintainers about ABI change in
 Matrix 1.6-2
Message-ID: <95f67c1e-ff07-4982-a185-a30f0f905868@gmail.com>

For repositories != CRAN:

Matrix 1.6-2 was released on Nov 8.  Due to an ABI change, repositories
maintaining R package binaries should ensure that binaries for the first
order reverse LinkingTo of Matrix are rebuilt under Matrix 1.6-2:


 > db <- available.packages(repos = "https://cran.r-project.org/")
 > tools::package_dependencies("Matrix", db = db, which = "LinkingTo", reverse = 
TRUE)[[1L]]
  [1] "ahMLE"               "bayesWatch"          "cplm"
  [4] "GeneralizedWendland" "geostatsp"           "hibayes"
  [7] "irlba"               "lme4"                "mcmcsae"
[10] "OpenMx"              "PRIMME"              "robustlmm"
[13] "spGARCH"             "TMB"


Typically, ABI changes occur only rarely, when Matrix updates the internal
SuiteSparse libraries and _those_ libraries change _their_ ABI.  This case
is an exception: we discovered that certain function prototypes in our
headers were inconsistent with corresponding prototypes in the SuiteSparse
headers, and the "consistent" prototypes were not binary compatible.

It is for this reason (and others) that Matrix has begun versioning its ABI,
as I announced in an earlier thread on R-SIG-Mac:

     https://stat.ethz.ch/pipermail/r-sig-mac/2023-October/014890.html

That (in addition to future, more proactive announcements on mailing lists)
should allow repository maintainers to adapt sooner going forward.

Mikael


From k@ro||n@@m@rek10 @end|ng |rom gm@||@com  Sat Nov 11 09:54:31 2023
From: k@ro||n@@m@rek10 @end|ng |rom gm@||@com (Karolina Marek)
Date: Sat, 11 Nov 2023 09:54:31 +0100
Subject: [R-pkg-devel] The problem with resubmitting the package to the Cran
Message-ID: <CAPzG1RT3cGatX5PwN80d0FbDrgCeEBZCHcxVTGhKOYnZDPdzdg@mail.gmail.com>

Hello,

I am writing again about submitting the package to the CRA - per ARMA,
which was archived on 2022-05-25, as it required the archived package
'matlab'. The new version of the 'matlab' was resubmitted to the Cran on
2022-06-01. When I try to submit the package, I receive the following
NOTES:

 Checking CRAN incoming feasibility ... NOTE

* checking for non-standard things in the check directory ... NOTE
Found the following files/directories:
  ?PARMA21del1_ident'

This time I put also the link to the repository on github:
https://github.com/Klona9/r-perARMA.git
gh repo clone Klona9/r-perARMA


I will be very glad for any help.

Best regards,

Karolina

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Nov 11 11:03:29 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 11 Nov 2023 05:03:29 -0500
Subject: [R-pkg-devel] 
 The problem with resubmitting the package to the Cran
In-Reply-To: <CAPzG1RT3cGatX5PwN80d0FbDrgCeEBZCHcxVTGhKOYnZDPdzdg@mail.gmail.com>
References: <CAPzG1RT3cGatX5PwN80d0FbDrgCeEBZCHcxVTGhKOYnZDPdzdg@mail.gmail.com>
Message-ID: <8eff77a9-e286-41ab-a1a8-0abaa1f5455b@gmail.com>

On 11/11/2023 3:54 a.m., Karolina Marek wrote:
> Hello,
> 
> I am writing again about submitting the package to the CRA - per ARMA,
> which was archived on 2022-05-25, as it required the archived package
> 'matlab'. The new version of the 'matlab' was resubmitted to the Cran on
> 2022-06-01. When I try to submit the package, I receive the following
> NOTES:
> 
>   Checking CRAN incoming feasibility ... NOTE
> 
> * checking for non-standard things in the check directory ... NOTE
> Found the following files/directories:
>    ?PARMA21del1_ident'
> 
> This time I put also the link to the repository on github:
> https://github.com/Klona9/r-perARMA.git
> gh repo clone Klona9/r-perARMA
> 
> 
> I will be very glad for any help.

Your examples for `parma_ident` appear to create a directory named 
"PARMA21del1_ident" below the current directory.  You can't create files 
there, you need to create them in tempdir().

Duncan Murdoch


From j@g@nmn2 @end|ng |rom gm@||@com  Sat Nov 11 17:40:27 2023
From: j@g@nmn2 @end|ng |rom gm@||@com (Mikael Jagan)
Date: Sat, 11 Nov 2023 11:40:27 -0500
Subject: [R-pkg-devel] 
 Note to repository maintainers about ABI change in Matrix 1.6-2
In-Reply-To: <95f67c1e-ff07-4982-a185-a30f0f905868@gmail.com>
References: <95f67c1e-ff07-4982-a185-a30f0f905868@gmail.com>
Message-ID: <d15295dd-3ba6-498f-ae8e-4d631d4c011b@gmail.com>



On 2023-11-10 5:04 pm, Mikael Jagan wrote:
> For repositories != CRAN:
> 
> Matrix 1.6-2 was released on Nov 8.  Due to an ABI change, repositories
> maintaining R package binaries should ensure that binaries for the first
> order reverse LinkingTo of Matrix are rebuilt under Matrix 1.6-2:
> 
> 
>   > db <- available.packages(repos = "https://cran.r-project.org/")
>   > tools::package_dependencies("Matrix", db = db, which = "LinkingTo", reverse =
> TRUE)[[1L]]
>    [1] "ahMLE"               "bayesWatch"          "cplm"
>    [4] "GeneralizedWendland" "geostatsp"           "hibayes"
>    [7] "irlba"               "lme4"                "mcmcsae"
> [10] "OpenMx"              "PRIMME"              "robustlmm"
> [13] "spGARCH"             "TMB"
> 

The following additional packages were found to have stale SClassExtension
objects cached in their namespaces:

     MatrixModels, SeuratObject, softImpute

and so their binaries should be rebuilt also.

Mikael

> 
> Typically, ABI changes occur only rarely, when Matrix updates the internal
> SuiteSparse libraries and _those_ libraries change _their_ ABI.  This case
> is an exception: we discovered that certain function prototypes in our
> headers were inconsistent with corresponding prototypes in the SuiteSparse
> headers, and the "consistent" prototypes were not binary compatible.
> 
> It is for this reason (and others) that Matrix has begun versioning its ABI,
> as I announced in an earlier thread on R-SIG-Mac:
> 
>       https://stat.ethz.ch/pipermail/r-sig-mac/2023-October/014890.html
> 
> That (in addition to future, more proactive announcements on mailing lists)
> should allow repository maintainers to adapt sooner going forward.
> 
> Mikael


From p|et|e@cjp@1908 @end|ng |rom gm@||@com  Fri Nov 10 19:35:49 2023
From: p|et|e@cjp@1908 @end|ng |rom gm@||@com (Christiaan Pieterse)
Date: Fri, 10 Nov 2023 20:35:49 +0200
Subject: [R-pkg-devel] Package submission fail
Message-ID: <CABuTGP7cqEZQqPWaLKfn=78LqzF63kdWV+joCq+jZw1MdhMTEw@mail.gmail.com>

Good day development team, I trust this email finds you well.

I am trying to upload a package onto CRAN. Note that this is a second
version of an existing package on CRAN, called iopspackage. I have built
the package using the R CMD build function and checked the function using R
CMD check --as cran--. The check yields 3 notes. 2 of them are regarding
run time and big file sizes, which is expected and I can't fix since it is
external functions used in my package that take that much time and a big
example file required. The 3rd note I do not know how to solve. I submitted
this file but it did not pass the automatic checks. Please see the part
from the CRAN-submission email below, as well as my attached .tar.gz file.
Any assistance to get this package open-source uploaded to CRAN would be
appreciated, thank you!

Kind regards
Christiaan

*CRAN-submission email:*
Dear maintainer,

package iopspackage_2.1.0.tar.gz does not pass the incoming checks
automatically, please see the following pre-tests:
Windows: <
https://win-builder.r-project.org/incoming_pretest/iopspackage_2.1.0_20231109_155428/Windows/00check.log
>
Status: 3 NOTEs
Debian: <
https://win-builder.r-project.org/incoming_pretest/iopspackage_2.1.0_20231109_155428/Debian/00check.log
>
Status: 4 NOTEs


Please fix all problems and resubmit a fixed version via the webform.
If you are not sure how to fix the problems shown, please ask for help on
the R-package-devel mailing list:
<https://stat.ethz.ch/mailman/listinfo/r-package-devel>
If you are fairly certain the rejection is a false positive, please
reply-all to this message and explain.

More details are given in the directory:
<
https://win-builder.r-project.org/incoming_pretest/iopspackage_2.1.0_20231109_155428/
>
The files will be removed after roughly 7 days.

No strong reverse dependencies to be checked.

Best regards,
CRAN teams' auto-check service
Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: CRAN incoming feasibility, Result: NOTE
  Maintainer: 'C.J Pieterse <pietie.cjp.1908 at gmail.com>'

  New submission

  Size of tarball: 10537094 bytes

Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: Rd files, Result: NOTE
  checkRd: (-1) IOPS.Rd:17: Escaped LaTeX specials: \_ \_
  checkRd: (-1) IOPS.Rd:36: Escaped LaTeX specials: \_
  checkRd: (-1) IOPS.Rd:42: Escaped LaTeX specials: \_
  checkRd: (-1) IOPS.Rd:44: Escaped LaTeX specials: \_
  checkRd: (-1) IOPS.Rd:46: Escaped LaTeX specials: \_
  checkRd: (-1) IOPS.Rd:48: Escaped LaTeX specials: \_ \_
  checkRd: (-1) IOPS.Rd:50: Escaped LaTeX specials: \_

Flavor: r-devel-windows-x86_64
Check: examples, Result: NOTE
  Examples with CPU (user + system) or elapsed time > 10s
         user system elapsed
  IOPS 127.61   5.58   133.2

Flavor: r-devel-linux-x86_64-debian-gcc
Check: examples, Result: NOTE
  Examples with CPU (user + system) or elapsed time > 5s
         user system elapsed
  IOPS 170.57  2.971 173.549

Flavor: r-devel-linux-x86_64-debian-gcc
Check: for non-standard things in the check directory, Result: NOTE
  Found the following files/directories:
    'Combined_Results.csv' 'Combined_Results.xlsx'

-------------- next part --------------
A non-text attachment was scrubbed...
Name: iopspackage_2.1.0.tar.gz
Type: application/x-gzip
Size: 10537094 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20231110/045267e3/attachment.bin>

From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Nov 13 11:27:55 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 13 Nov 2023 05:27:55 -0500
Subject: [R-pkg-devel] Package submission fail
In-Reply-To: <CABuTGP7cqEZQqPWaLKfn=78LqzF63kdWV+joCq+jZw1MdhMTEw@mail.gmail.com>
References: <CABuTGP7cqEZQqPWaLKfn=78LqzF63kdWV+joCq+jZw1MdhMTEw@mail.gmail.com>
Message-ID: <352e93df-fc64-469d-ad43-63e484b15cd5@gmail.com>

On 10/11/2023 1:35 p.m., Christiaan Pieterse wrote:
> Good day development team, I trust this email finds you well.
> 
> I am trying to upload a package onto CRAN. Note that this is a second
> version of an existing package on CRAN, called iopspackage. I have built
> the package using the R CMD build function and checked the function using R
> CMD check --as cran--. The check yields 3 notes. 2 of them are regarding
> run time and big file sizes, which is expected and I can't fix since it is
> external functions used in my package that take that much time and a big
> example file required. 

You will have to fix the run time.  Try running the example on a smaller 
dataset, or don't run it at all (by putting it in \donttest{}). The file 
size may be acceptable to CRAN; you will need to make an argument to 
them in your upload.

The note about the "\_" entries comes from "country\_codes\_V202201" 
(and similar).  That's not legal Rd syntax.  You could use 
"\code{country_codes_V202201}" or some other verbatim wrapper.

I see a 4th note, about files Combined_Results.csv and 
Combined_Results.xlsx.  If those files are produced by an example or 
test, they should be in tempdir().

Duncan Murdoch

The 3rd note I do not know how to solve. I submitted
> this file but it did not pass the automatic checks. Please see the part
> from the CRAN-submission email below, as well as my attached .tar.gz file.
> Any assistance to get this package open-source uploaded to CRAN would be
> appreciated, thank you!
> 
> Kind regards
> Christiaan
> 
> *CRAN-submission email:*
> Dear maintainer,
> 
> package iopspackage_2.1.0.tar.gz does not pass the incoming checks
> automatically, please see the following pre-tests:
> Windows: <
> https://win-builder.r-project.org/incoming_pretest/iopspackage_2.1.0_20231109_155428/Windows/00check.log
>>
> Status: 3 NOTEs
> Debian: <
> https://win-builder.r-project.org/incoming_pretest/iopspackage_2.1.0_20231109_155428/Debian/00check.log
>>
> Status: 4 NOTEs
> 
> 
> Please fix all problems and resubmit a fixed version via the webform.
> If you are not sure how to fix the problems shown, please ask for help on
> the R-package-devel mailing list:
> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> If you are fairly certain the rejection is a false positive, please
> reply-all to this message and explain.
> 
> More details are given in the directory:
> <
> https://win-builder.r-project.org/incoming_pretest/iopspackage_2.1.0_20231109_155428/
>>
> The files will be removed after roughly 7 days.
> 
> No strong reverse dependencies to be checked.
> 
> Best regards,
> CRAN teams' auto-check service
> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
> Check: CRAN incoming feasibility, Result: NOTE
>    Maintainer: 'C.J Pieterse <pietie.cjp.1908 at gmail.com>'
> 
>    New submission
> 
>    Size of tarball: 10537094 bytes
> 
> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
> Check: Rd files, Result: NOTE
>    checkRd: (-1) IOPS.Rd:17: Escaped LaTeX specials: \_ \_
>    checkRd: (-1) IOPS.Rd:36: Escaped LaTeX specials: \_
>    checkRd: (-1) IOPS.Rd:42: Escaped LaTeX specials: \_
>    checkRd: (-1) IOPS.Rd:44: Escaped LaTeX specials: \_
>    checkRd: (-1) IOPS.Rd:46: Escaped LaTeX specials: \_
>    checkRd: (-1) IOPS.Rd:48: Escaped LaTeX specials: \_ \_
>    checkRd: (-1) IOPS.Rd:50: Escaped LaTeX specials: \_
> 
> Flavor: r-devel-windows-x86_64
> Check: examples, Result: NOTE
>    Examples with CPU (user + system) or elapsed time > 10s
>           user system elapsed
>    IOPS 127.61   5.58   133.2
> 
> Flavor: r-devel-linux-x86_64-debian-gcc
> Check: examples, Result: NOTE
>    Examples with CPU (user + system) or elapsed time > 5s
>           user system elapsed
>    IOPS 170.57  2.971 173.549
> 
> Flavor: r-devel-linux-x86_64-debian-gcc
> Check: for non-standard things in the check directory, Result: NOTE
>    Found the following files/directories:
>      'Combined_Results.csv' 'Combined_Results.xlsx'
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Nov 13 14:46:58 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 13 Nov 2023 16:46:58 +0300
Subject: [R-pkg-devel] Package submission fail
In-Reply-To: <CABuTGP7cqEZQqPWaLKfn=78LqzF63kdWV+joCq+jZw1MdhMTEw@mail.gmail.com>
References: <CABuTGP7cqEZQqPWaLKfn=78LqzF63kdWV+joCq+jZw1MdhMTEw@mail.gmail.com>
Message-ID: <20231113164658.50dd9648@arachnoid>

Hello Christiaan and welcome to R-package-devel!

? Fri, 10 Nov 2023 20:35:49 +0200
Christiaan Pieterse <pietie.cjp.1908 at gmail.com> ?????:

> Check: CRAN incoming feasibility, Result: NOTE
>   Maintainer: 'C.J Pieterse <pietie.cjp.1908 at gmail.com>'
> 
>   New submission

This one is to be expected for a first submission.

>   Size of tarball: 10537094 bytes

I highly recommend to find a way to replace the 50-megabyte
inst/extdata/ExampleTradeData.csv with a smaller file. CRAN policy [*]
says "As a general rule, neither data nor documentation should exceed
5MB", and your package tarball mostly consists of example data.

> Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
> Check: Rd files, Result: NOTE
>   checkRd: (-1) IOPS.Rd:17: Escaped LaTeX specials: \_ \_
>   checkRd: (-1) IOPS.Rd:36: Escaped LaTeX specials: \_
>   checkRd: (-1) IOPS.Rd:42: Escaped LaTeX specials: \_
>   checkRd: (-1) IOPS.Rd:44: Escaped LaTeX specials: \_
>   checkRd: (-1) IOPS.Rd:46: Escaped LaTeX specials: \_
>   checkRd: (-1) IOPS.Rd:48: Escaped LaTeX specials: \_ \_
>   checkRd: (-1) IOPS.Rd:50: Escaped LaTeX specials: \_

Not sure why roxygen2 is generating these for you. Maybe you need to
update roxygen2 to a newer version that doesn't generate
country\_codes\_V202201 from country_codes_V202201 and run roxygenise()
again. Duncan's idea to encode these as \code{} (or maybe \verb{} if
it's not intended to be R code) is also good.

> Check: examples, Result: NOTE
>   Examples with CPU (user + system) or elapsed time > 5s
>          user system elapsed
>   IOPS 170.57  2.971 173.549

CRAN policy says: "Checking the package should take as little CPU time
as possible". Once you make a smaller example file, it will probably be
also faster to process.

The examples in the help pages are not only for R CMD check to run and
for CRAN to complain about; they are also present in the package for
the user to run example(IOPS) and see it in action. As a user, I would
probably get bored and interrupt your example if it takes more than 2
minutes to run.
 
> Check: for non-standard things in the check directory, Result: NOTE
>   Found the following files/directories:
>     'Combined_Results.csv' 'Combined_Results.xlsx'

"Packages should not write <...> anywhere <...> on the file system apart
from the R session?s temporary directory"

As a user, I would prefer example(IOPS) to modify as little of my
environment as possible. If I had valuable data saved as
"Combined_Results.csv" in the current directory, example(IOPS) would
have overwritten this file. As already pointed out by Duncan Murdoch,
the example will have to create its files under tempdir() and remove
them after it's done.

These are not the only problems you need to fix. Currently, your code
begins by loading a number of packages:

> #requireNamespace("roxygen2")
> requireNamespace("Rcpp")
> requireNamespace("dplyr")
> requireNamespace("tidyr")
> #requireNamespace("readxl")
> requireNamespace("economiccomplexity")
> requireNamespace("usethis")
> requireNamespace("Matrix")
> requireNamespace("tibble")
> requireNamespace("openxlsx")
> requireNamespace("utils")
> #requireNamespace("stats")
> 
> library("Rcpp")
> library("tidyr")
> library("dplyr")
> library("readxl")
> library("economiccomplexity")
> library("usethis")
> library("roxygen2")
> library("openxlsx")
This doesn't play well with the package dependency mechanism. You
should specify which functions you export, import individual functions
or whole packages in the NAMESPACE file [**]. Since you're using
roxygen2, you can use the @importFrom tag to declare your dependencies,
and it will generate the NAMESPACE file for you. Packages shouldn't be
calling library(), and for any optional dependencies, the return value
of requireNamespace() should be checked.

> if( ComplexMethod == "reflections"&& ComplexMethod == "eigenvalues" &&
> ComplexMethod == "fitness") stop('Invalid complexity method')
You probably meant to say !(condition || condition || condition)
instead of condition && condition && condition here. You can also use
the built-in R function stopifnot() as a shorthand for validating
various conditions. switch() with a default stop() and/or match.args()
is also an option.

> CorrectCountryNr <- readline("Please enter correct country
> (corresponding integer): ")
You will probably want to condition this on interactive() and transform
this into an error when the R session is running in batch mode,
unattended. There is not enough error checking after readline() (what
if the user makes a typo?). The menu() function can do most of this for
you.

Good luck, and I hope your next version of the package gets accepted!

-- 
Best regards,
Ivan

[*] https://cran.r-project.org/web/packages/policies.html

[**]
https://cran.r-project.org/doc/manuals/R-exts.html#Specifying-imports-and-exports


From edd @end|ng |rom deb|@n@org  Mon Nov 13 14:50:22 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 13 Nov 2023 07:50:22 -0600
Subject: [R-pkg-devel] Package submission fail
In-Reply-To: <20231113164658.50dd9648@arachnoid>
References: <CABuTGP7cqEZQqPWaLKfn=78LqzF63kdWV+joCq+jZw1MdhMTEw@mail.gmail.com>
 <20231113164658.50dd9648@arachnoid>
Message-ID: <25938.10654.714235.267977@rob.eddelbuettel.com>


On 13 November 2023 at 16:46, Ivan Krylov wrote:
| Hello Christiaan and welcome to R-package-devel!

Seconded but PLEASE do not send large attachments to the list and all its
subscriber. Point us to your code repository, you will like get a kind
response from a volunteer or two peeking at it.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r  Mon Nov 13 16:39:45 2023
From: rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r (Romain Pierlot)
Date: Mon, 13 Nov 2023 16:39:45 +0100 (CET)
Subject: [R-pkg-devel] Package submission issue - OMP reduction (flang-new)
Message-ID: <961109932.9036169.1699889985884.JavaMail.zimbra@u-bordeaux.fr>

Hi everyone, 

I sent a first message a few weeks ago. I'm still in trouble for sending a package (Frailtypack) on the CRAN. It was removed because of reinforcement in CRAN requirements. 
We corrected the few issues, but more appeared, and one that I'm still enable to correct. 

Here is the error message, and the adequate code part is joint in the mail : 

error: loc("/data/gannet/ripley/R/packages/incoming/frailtypack.Rcheck/00_pkg_src/frailtypack/src/Integrale_mult_scl.f90":1811:17): 'omp.reduction' op must be used within an operation supporting reduction clause interface 
error: verification of lowering to FIR failed 

I've already received precious help, that indicated me that the error probably comes from the flang-new compiler used by the CRAN (He replicated the error, I send you the code he made in attachment too : test_fortran.f90). 
I tried the code portion with other compilers (gfortran), and the error didn't appear. 

Nevertheless, It may be a compiler error, the CRAN keeps denying the package. 

Does anyone have a solution, to avoid this error please ? 

Thanks a lot for your answers ! 

Romain Pierlot 




-- 
[ https://www.u-bordeaux.fr/ ] [ http://www.aquitaine-poitou-charentes.inserm.fr/ ] 

[ mailto: | Romain Pierlot ] 
Ing?nieur de recherches Bio-Informatique 
?quipe BIOSTAT 


[ https://www.u-bordeaux.fr/ | https://www.u-bordeaux.fr ] 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Fortran error frailtypack.png
Type: image/png
Size: 157561 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20231113/b417b77b/attachment.png>

From tom@@@k@||ber@ @end|ng |rom gm@||@com  Mon Nov 13 18:12:31 2023
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Mon, 13 Nov 2023 18:12:31 +0100
Subject: [R-pkg-devel] 
 Package submission issue - OMP reduction (flang-new)
In-Reply-To: <961109932.9036169.1699889985884.JavaMail.zimbra@u-bordeaux.fr>
References: <961109932.9036169.1699889985884.JavaMail.zimbra@u-bordeaux.fr>
Message-ID: <262609e8-e4b1-49d0-a45d-62c95e804ec2@gmail.com>


On 11/13/23 16:39, Romain Pierlot wrote:
> Hi everyone,
>
> I sent a first message a few weeks ago. I'm still in trouble for sending a package (Frailtypack) on the CRAN. It was removed because of reinforcement in CRAN requirements.
> We corrected the few issues, but more appeared, and one that I'm still enable to correct.
>
> Here is the error message, and the adequate code part is joint in the mail :
>
> error: loc("/data/gannet/ripley/R/packages/incoming/frailtypack.Rcheck/00_pkg_src/frailtypack/src/Integrale_mult_scl.f90":1811:17): 'omp.reduction' op must be used within an operation supporting reduction clause interface
> error: verification of lowering to FIR failed
>
> I've already received precious help, that indicated me that the error probably comes from the flang-new compiler used by the CRAN (He replicated the error, I send you the code he made in attachment too : test_fortran.f90).
> I tried the code portion with other compilers (gfortran), and the error didn't appear.
>
> Nevertheless, It may be a compiler error, the CRAN keeps denying the package.
>
> Does anyone have a solution, to avoid this error please ?

If you are sufficiently confident this is a compiler bug, it would be 
great if you could submit a bug report for LLVM/flang-new, so that it 
could be fixed. You would also likely get feedback this way confirming 
whether it really is a compiler bug or a problem in your code. And if it 
is a confirmed bug, you might even get an advice for a work-around for 
older compilers.

Tomas

>
> Thanks a lot for your answers !
>
> Romain Pierlot
>
>
>
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r  Mon Nov 13 19:07:23 2023
From: rom@|n@p|er|ot @end|ng |rom u-borde@ux@|r (Romain Pierlot)
Date: Mon, 13 Nov 2023 19:07:23 +0100 (CET)
Subject: [R-pkg-devel] 
 Package submission issue - OMP reduction (flang-new)
In-Reply-To: <262609e8-e4b1-49d0-a45d-62c95e804ec2@gmail.com>
References: <961109932.9036169.1699889985884.JavaMail.zimbra@u-bordeaux.fr>
 <262609e8-e4b1-49d0-a45d-62c95e804ec2@gmail.com>
Message-ID: <353135177.9161719.1699898843382.JavaMail.zimbra@u-bordeaux.fr>

An issue has already been sent on the GitHub page of llvm for 2 weeks : https://github.com/llvm/llvm-project/issues/70828

But even if it is a compiler bug, as many people are waiting for my package, it would be nice to find a way to avoid the bug in order to sent it on the CRAN.

Any advice ? 

Thanks, 

Romain Pierlot

----- Mail original -----
De: "Tomas Kalibera" <tomas.kalibera at gmail.com>
?: "Romain Pierlot" <romain.pierlot at u-bordeaux.fr>, "r-package-devel" <r-package-devel at r-project.org>
Envoy?: Lundi 13 Novembre 2023 18:12:31
Objet: Re: [R-pkg-devel] Package submission issue - OMP reduction (flang-new)

On 11/13/23 16:39, Romain Pierlot wrote:
> Hi everyone,
>
> I sent a first message a few weeks ago. I'm still in trouble for sending a package (Frailtypack) on the CRAN. It was removed because of reinforcement in CRAN requirements.
> We corrected the few issues, but more appeared, and one that I'm still enable to correct.
>
> Here is the error message, and the adequate code part is joint in the mail :
>
> error: loc("/data/gannet/ripley/R/packages/incoming/frailtypack.Rcheck/00_pkg_src/frailtypack/src/Integrale_mult_scl.f90":1811:17): 'omp.reduction' op must be used within an operation supporting reduction clause interface
> error: verification of lowering to FIR failed
>
> I've already received precious help, that indicated me that the error probably comes from the flang-new compiler used by the CRAN (He replicated the error, I send you the code he made in attachment too : test_fortran.f90).
> I tried the code portion with other compilers (gfortran), and the error didn't appear.
>
> Nevertheless, It may be a compiler error, the CRAN keeps denying the package.
>
> Does anyone have a solution, to avoid this error please ?

If you are sufficiently confident this is a compiler bug, it would be 
great if you could submit a bug report for LLVM/flang-new, so that it 
could be fixed. You would also likely get feedback this way confirming 
whether it really is a compiler bug or a problem in your code. And if it 
is a confirmed bug, you might even get an advice for a work-around for 
older compilers.

Tomas

>
> Thanks a lot for your answers !
>
> Romain Pierlot
>
>
>
>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
-- 
[ https://www.u-bordeaux.fr/ ] [ http://www.aquitaine-poitou-charentes.inserm.fr/ ] 

[ mailto: | Romain Pierlot ] 
Ing?nieur de recherches Bio-Informatique 
?quipe BIOSTAT 


[ https://www.u-bordeaux.fr/ | https://www.u-bordeaux.fr ]


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Nov 13 19:18:32 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 13 Nov 2023 21:18:32 +0300
Subject: [R-pkg-devel] 
 Package submission issue - OMP reduction (flang-new)
In-Reply-To: <961109932.9036169.1699889985884.JavaMail.zimbra@u-bordeaux.fr>
References: <961109932.9036169.1699889985884.JavaMail.zimbra@u-bordeaux.fr>
Message-ID: <20231113211832.0159d227@Tarkus>

On Mon, 13 Nov 2023 16:39:45 +0100 (CET)
Romain Pierlot <romain.pierlot at u-bordeaux.fr> wrote:

> Here is the error message, and the adequate code part is joint in the
> mail : 
> 
> error:
> loc("/data/gannet/ripley/R/packages/incoming/frailtypack.Rcheck/00_pkg_src/frailtypack/src/Integrale_mult_scl.f90":1811:17):
> 'omp.reduction' op must be used within an operation supporting
> reduction clause interface error: verification of lowering to FIR
> failed 

Have you tried explaining this in the package submission comment? What
was the response? Does the reviewer need more evidence? Linking to the
LLVM issue on GitHub and/or the previous R-package-devel thread may
help.

(LLVM giveth and LLVM taketh away. While I'm sure that their
diagnostics helped improve many packages, I have encountered a few
places in the R code where clang suggested to replace boolean
expressions && and || with bitwise operations & and |. The code still
works, but now relies on boolean constants having certain exact bits
set. Replace a 1 with a 2 and things will break.)

It might be the case that CRAN cannot afford to make an exception for
this compiler bug. I can imagine a number of workarounds:

1. In your ./configure script, check for the Fortran compiler being
flang-new version 17. If the check succeeds, disable OpenMP altogether.

2. Rewrite your Fortran code so that a variable is never touched before
it is used in an OpenMP reduction. You may have to declare a new
variable for every OpenMP reduction loop inside a function.

If you don't succeed in convincing CRAN regarding the compiler bug,
which one of the two workarounds would you prefer?

-- 
Best regards,
Ivan


