From kev|n@r@coombe@ @end|ng |rom gm@||@com  Tue Jul  2 00:04:40 2024
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Mon, 1 Jul 2024 18:04:40 -0400
Subject: [R-pkg-devel] Is R-Forge dead?
Message-ID: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>

Hi,

I have been maintaining packages in R-Forge for many tears. Last week I 
sent an email to r-forge at r-project.org to report problems with the build 
process. It appears that any changes I have pushed to R-Forge over 
approximately the last two months have resulted in the package remaining 
in the "Building" state, even though the logs suggest that the package 
built successfully on both LINUX and Windows. (Also, four of the six 
affected packages only included changes to the man pages to clean up 
NOTEs from the R cmd checks on old versions at CRAN, where the new 
versions now happily reside.) I have received no response nor 
acknowledgement to my email to R-Forge.

Assuming that R-Forge has finally succumbed to the ravages of entropy, 
does anyone have advice on creating a git project that contains multiple 
R packages? (I really don't want to have to create 20+ new git projects, 
one per package).

Best,
 ?? Kevin


From br|@n @end|ng |rom br@verock@com  Tue Jul  2 00:16:44 2024
From: br|@n @end|ng |rom br@verock@com (Brian G. Peterson)
Date: Mon, 01 Jul 2024 17:16:44 -0500
Subject: [R-pkg-devel] Is R-Forge dead?
In-Reply-To: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
References: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
Message-ID: <78417260a1adcd0b30ed8702a6545d7b878d17bc.camel@braverock.com>

Kevin,

I can't speak to whether R-Forge is dead, we migrated our projects to
github a long time ago.

The most straightforward answer for R packages in git repositories is
to use separate git projects.  we were even able to import the entire
SVN history and r-forge issue history to github for each of our r-forge
projects when we migrated. The only major complexity that I recall was
creating a table mapping svn contributors to github users (where
available).

If you want to do it all in one git repository, I strongly suggest that
you *still* import all the svn history, but that you do it in one
directory per project, since this is required by `R CMD build`.  We
sometimes use this 'one package per directory' approach in some of our
private repositories at work.  In this case, if you use an IDE like
RStudio, you'll still create separate *RStudio* projects in each
directory, so that you can build, install, test, etc each package from
the IDE, but you can use a single repository for all of it.

Your future self will thank you for having full version control history
of all the "Olde" (tm) versions.

Best of luck.  - Brian

see reference below about importing an svn repo to git:


Ref:
https://docs.github.com/en/migrations/importing-source-code/using-the-command-line-to-import-source-code/importing-a-subversion-repository

-- 
Brian G. Peterson
ph: +1.773.459.4973
im: bgpbraverock

On Mon, 2024-07-01 at 18:04 -0400, Kevin R. Coombes wrote:
> Hi,
> 
> I have been maintaining packages in R-Forge for many tears. Last week
> I 
> sent an email to r-forge at r-project.org?to report problems with the
> build 
> process. It appears that any changes I have pushed to R-Forge over 
> approximately the last two months have resulted in the package
> remaining 
> in the "Building" state, even though the logs suggest that the
> package 
> built successfully on both LINUX and Windows. (Also, four of the six 
> affected packages only included changes to the man pages to clean up 
> NOTEs from the R cmd checks on old versions at CRAN, where the new 
> versions now happily reside.) I have received no response nor 
> acknowledgement to my email to R-Forge.
> 
> Assuming that R-Forge has finally succumbed to the ravages of
> entropy, 
> does anyone have advice on creating a git project that contains
> multiple 
> R packages? (I really don't want to have to create 20+ new git
> projects, 
> one per package).
> 
> Best,
> ??? Kevin
> 
> ______________________________________________
> R-package-devel at r-project.org?mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Tue Jul  2 00:17:45 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 1 Jul 2024 18:17:45 -0400
Subject: [R-pkg-devel] Is R-Forge dead?
In-Reply-To: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
References: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
Message-ID: <d8aa8eb2-42e7-452a-b570-b205a910b798@gmail.com>

   I don't know about R-forge, but it's perfectly workable to put 
multiple packages within a single repo, with each package in its own 
subdirectory.  You'll run into some headaches occasionally with (e.g.) 
CI machinery that assumes that the head of a git repo is also the 
primary package directory (e.g. 
https://github.com/r-hub/rhub/issues/584) ...

On 2024-07-01 6:04 p.m., Kevin R. Coombes wrote:
> Hi,
> 
> I have been maintaining packages in R-Forge for many tears. Last week I 
> sent an email to r-forge at r-project.org to report problems with the build 
> process. It appears that any changes I have pushed to R-Forge over 
> approximately the last two months have resulted in the package remaining 
> in the "Building" state, even though the logs suggest that the package 
> built successfully on both LINUX and Windows. (Also, four of the six 
> affected packages only included changes to the man pages to clean up 
> NOTEs from the R cmd checks on old versions at CRAN, where the new 
> versions now happily reside.) I have received no response nor 
> acknowledgement to my email to R-Forge.
> 
> Assuming that R-Forge has finally succumbed to the ravages of entropy, 
> does anyone have advice on creating a git project that contains multiple 
> R packages? (I really don't want to have to create 20+ new git projects, 
> one per package).
> 
> Best,
>  ?? Kevin
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Jul  2 00:43:23 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 1 Jul 2024 18:43:23 -0400
Subject: [R-pkg-devel] Is R-Forge dead?
In-Reply-To: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
References: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
Message-ID: <ef288e3f-fa4c-4b91-8357-e72531183cb4@gmail.com>

While you can put multiple packages in one Git repository, I'd suggest 
that you don't do that.  Most packages are in their own repository, and 
that means that users who want to contribute to your packages are 
familiar with that setup.  If they have to fork 20 packages at once to 
make a contribution to one of them, they are less likely to want to do it.

Duncan Murdoch

On 2024-07-01 6:04 p.m., Kevin R. Coombes wrote:
> Hi,
> 
> I have been maintaining packages in R-Forge for many tears. Last week I
> sent an email to r-forge at r-project.org to report problems with the build
> process. It appears that any changes I have pushed to R-Forge over
> approximately the last two months have resulted in the package remaining
> in the "Building" state, even though the logs suggest that the package
> built successfully on both LINUX and Windows. (Also, four of the six
> affected packages only included changes to the man pages to clean up
> NOTEs from the R cmd checks on old versions at CRAN, where the new
> versions now happily reside.) I have received no response nor
> acknowledgement to my email to R-Forge.
> 
> Assuming that R-Forge has finally succumbed to the ravages of entropy,
> does anyone have advice on creating a git project that contains multiple
> R packages? (I really don't want to have to create 20+ new git projects,
> one per package).
> 
> Best,
>   ?? Kevin
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From Ach|m@Ze||e|@ @end|ng |rom R-project@org  Tue Jul  2 01:05:07 2024
From: Ach|m@Ze||e|@ @end|ng |rom R-project@org (Achim Zeileis)
Date: Tue, 2 Jul 2024 01:05:07 +0200 (CEST)
Subject: [R-pkg-devel] Is R-Forge dead?
Message-ID: <df3965ea-336f-6460-e0cf-7b41d9cfeb14@R-project.org>

Kevin,

R-Forge is still alive but there are problems with the build queue as you 
noticed. The problems occurred after R-Forge upgraded to R 4.4.0 - just as 
there was a switch in the maintenance team at WU Wien.

The problem is with the Windows build/check tools which work fine when run 
manually but either fail (if there is compiled code in the package) or stall 
when run in batch mode.

Jorge, the new member in the admin team at WU, has been going through all the 
scripts with Uwe (Ligges) but they haven't spotted the problem so far. I think 
that the next step will be to migrate the Windows build/check processes to the 
Win-Builder machine.

I hope that they will succeed in doing so in the next weeks. Apologies for the 
inconvenience.

Best wishes,
Achim


On Tue, 2 Jul 2024, Kevin R. Coombes wrote:

> Hi,
> 
> I have been maintaining packages in R-Forge for many tears. Last week I sent 
> an email to r-forge at r-project.org to report problems with the build process. 
> It appears that any changes I have pushed to R-Forge over approximately the 
> last two months have resulted in the package remaining in the "Building" 
> state, even though the logs suggest that the package built successfully on 
> both LINUX and Windows. (Also, four of the six affected packages only 
> included changes to the man pages to clean up NOTEs from the R cmd checks on 
> old versions at CRAN, where the new versions now happily reside.) I have 
> received no response nor acknowledgement to my email to R-Forge.
> 
> Assuming that R-Forge has finally succumbed to the ravages of entropy, does 
> anyone have advice on creating a git project that contains multiple R 
> packages? (I really don't want to have to create 20+ new git projects, one 
> per package).
> 
> Best,
> ?? Kevin
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Jul  2 01:08:10 2024
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Mon, 01 Jul 2024 16:08:10 -0700
Subject: [R-pkg-devel] Is R-Forge dead?
In-Reply-To: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
References: <88ae6edf-13ca-42d8-80fa-fc729124682e@gmail.com>
Message-ID: <D9D0E2E3-CD88-400E-87B5-A99CED291FF1@dcn.davis.ca.us>

I cannot/will not to help you do this, but there are people out there who disagree with me who put considerable effort into doing this... the search term you would need in order to find them is "monorepo". But please reconsider...  the whole point of putting code into separate packages is to isolate their internals to make them less interdependent... putting all of them into a monorepo can lead you to forget that users experience them as distinct units.

On July 1, 2024 3:04:40 PM PDT, "Kevin R. Coombes" <kevin.r.coombes at gmail.com> wrote:
>Hi,
>
>I have been maintaining packages in R-Forge for many tears. Last week I sent an email to r-forge at r-project.org to report problems with the build process. It appears that any changes I have pushed to R-Forge over approximately the last two months have resulted in the package remaining in the "Building" state, even though the logs suggest that the package built successfully on both LINUX and Windows. (Also, four of the six affected packages only included changes to the man pages to clean up NOTEs from the R cmd checks on old versions at CRAN, where the new versions now happily reside.) I have received no response nor acknowledgement to my email to R-Forge.
>
>Assuming that R-Forge has finally succumbed to the ravages of entropy, does anyone have advice on creating a git project that contains multiple R packages? (I really don't want to have to create 20+ new git projects, one per package).
>
>Best,
>?? Kevin
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Tue Jul  2 10:59:24 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Tue, 2 Jul 2024 10:59:24 +0200
Subject: [R-pkg-devel] Is R-Forge dead?
In-Reply-To: <df3965ea-336f-6460-e0cf-7b41d9cfeb14@R-project.org>
References: <df3965ea-336f-6460-e0cf-7b41d9cfeb14@R-project.org>
Message-ID: <26243.49516.105400.498057@stat.math.ethz.ch>

>>>>> Achim Zeileis 
>>>>>     on Tue, 2 Jul 2024 01:05:07 +0200 (CEST) writes:

    > Kevin, R-Forge is still alive but there are problems with
    > the build queue as you noticed. The problems occurred
    > after R-Forge upgraded to R 4.4.0 - just as there was a
    > switch in the maintenance team at WU Wien.

    > The problem is with the Windows build/check tools which
    > work fine when run manually but either fail (if there is
    > compiled code in the package) or stall when run in batch
    > mode.

    > Jorge, the new member in the admin team at WU, has been
    > going through all the scripts with Uwe (Ligges) but they
    > haven't spotted the problem so far. I think that the next
    > step will be to migrate the Windows build/check processes
    > to the Win-Builder machine.

    > I hope that they will succeed in doing so in the next
    > weeks. Apologies for the inconvenience.

    > Best wishes, Achim

Thanks a lot, Achim,
for the update and explanation!

I maintain quite a few packages on R-forge,
enjoying the simplicity of svn (subversion) on the way.

For automatic building and checking,  some of you may be aware
that the R-OpenSci organization has hosted and sponsored the
"R-Universe" project https://ropensci.org/r-universe/,
implemented and made quite successful I think primarily by
Jeroen Ooms.   A main goal (I think) has been to *be* as
universal as possible, and provide a "portal" for "all" publicly
hosted R packages and not only foster to private company-owned
platforms such as github, but rather work with more general
"organizations" such as CRAN and BioC (each via their 'Meta
CRAN'), then also R-forge and many many more, see
    https://r-universe.dev/organizations/

Consequently, the R-forge packages are also all mirrored and
presented there, *and* also built and checked,
   --> https://r-forge.r-universe.dev/
... sometimes (somewhat confusingly to us, in one case) checking
against non-released versions of CRAN packages (instead of the stable
CRAN version)  which of course may be useful ((and I think is
similar to how R-forge works;  if there are released and
unreleased version of packages around, it's not easily
determinable *which* version should be used for tests of other
packages)).

Anyway, I was glad in one case that R-universe provided a built
version of the development version of one of my packages other
users could easily install.

Martin

PS:  I have not been a fan of r-universe, notably originally, as
it diverts attention away from R-project and CRAN, but then did
notice how useful it can be to the R users community, and how
well it has been maintained, hence these kudos!


    > On Tue, 2 Jul 2024, Kevin R. Coombes wrote:

    >> Hi,
    >> 
    >> I have been maintaining packages in R-Forge for many
    >> tears. Last week I sent an email to r-forge at r-project.org
    >> to report problems with the build process.  It appears
    >> that any changes I have pushed to R-Forge over
    >> approximately the last two months have resulted in the
    >> package remaining in the "Building" state, even though
    >> the logs suggest that the package built successfully on
    >> both LINUX and Windows. (Also, four of the six affected
    >> packages only included changes to the man pages to clean
    >> up NOTEs from the R cmd checks on old versions at CRAN,
    >> where the new versions now happily reside.) I have
    >> received no response nor acknowledgement to my email to
    >> R-Forge.
    >> 
    >> Assuming that R-Forge has finally succumbed to the
    >> ravages of entropy, does anyone have advice on creating a
    >> git project that contains multiple R packages? (I really
    >> don't want to have to create 20+ new git projects, one
    >> per package).
    >> 
    >> Best, ?? Kevin
    >> 
    >> ______________________________________________
    >> R-package-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
    >> 
    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From Ach|m@Ze||e|@ @end|ng |rom R-project@org  Tue Jul  2 11:50:26 2024
From: Ach|m@Ze||e|@ @end|ng |rom R-project@org (Achim Zeileis)
Date: Tue, 2 Jul 2024 11:50:26 +0200 (CEST)
Subject: [R-pkg-devel] Is R-Forge dead?
In-Reply-To: <26243.49516.105400.498057@stat.math.ethz.ch>
References: <df3965ea-336f-6460-e0cf-7b41d9cfeb14@R-project.org>
 <26243.49516.105400.498057@stat.math.ethz.ch>
Message-ID: <3aa469bc-0305-a347-b05e-d6cbcd7fd032@R-project.org>

On Tue, 2 Jul 2024, Martin Maechler wrote:

>>>>>> Achim Zeileis
>>>>>>     on Tue, 2 Jul 2024 01:05:07 +0200 (CEST) writes:
>
>    > Kevin, R-Forge is still alive but there are problems with
>    > the build queue as you noticed. The problems occurred
>    > after R-Forge upgraded to R 4.4.0 - just as there was a
>    > switch in the maintenance team at WU Wien.
>
>    > The problem is with the Windows build/check tools which
>    > work fine when run manually but either fail (if there is
>    > compiled code in the package) or stall when run in batch
>    > mode.
>
>    > Jorge, the new member in the admin team at WU, has been
>    > going through all the scripts with Uwe (Ligges) but they
>    > haven't spotted the problem so far. I think that the next
>    > step will be to migrate the Windows build/check processes
>    > to the Win-Builder machine.
>
>    > I hope that they will succeed in doing so in the next
>    > weeks. Apologies for the inconvenience.
>
>    > Best wishes, Achim
>
> Thanks a lot, Achim,
> for the update and explanation!
>
> I maintain quite a few packages on R-forge,
> enjoying the simplicity of svn (subversion) on the way.
>
> For automatic building and checking,  some of you may be aware
> that the R-OpenSci organization has hosted and sponsored the
> "R-Universe" project https://ropensci.org/r-universe/,
> implemented and made quite successful I think primarily by
> Jeroen Ooms.   A main goal (I think) has been to *be* as
> universal as possible, and provide a "portal" for "all" publicly
> hosted R packages and not only foster to private company-owned
> platforms such as github, but rather work with more general
> "organizations" such as CRAN and BioC (each via their 'Meta
> CRAN'), then also R-forge and many many more, see
>    https://r-universe.dev/organizations/
>
> Consequently, the R-forge packages are also all mirrored and
> presented there, *and* also built and checked,
>   --> https://r-forge.r-universe.dev/
> ... sometimes (somewhat confusingly to us, in one case) checking
> against non-released versions of CRAN packages (instead of the stable
> CRAN version)  which of course may be useful ((and I think is
> similar to how R-forge works;  if there are released and
> unreleased version of packages around, it's not easily
> determinable *which* version should be used for tests of other
> packages)).
>
> Anyway, I was glad in one case that R-universe provided a built
> version of the development version of one of my packages other
> users could easily install.
>
> Martin
>
> PS:  I have not been a fan of r-universe, notably originally, as
> it diverts attention away from R-project and CRAN, but then did
> notice how useful it can be to the R users community, and how
> well it has been maintained, hence these kudos!

+1 Thanks for pointing to R-universe, Martin, indeed an excellent service!

An additional detail about the packages at:

https://R-Forge.R-universe.dev/

This are the development versions of the R-Forge packages that are already 
released on CRAN.

If anyone has R-Forge packages that are not (yet) released on CRAN and you 
want to deploy them via R-universe, then you can do so by setting up your 
own universe. I'm using that for many of my R-Forge packages, see

https://zeileis.R-universe.dev/

and

https://github.com/zeileis/zeileis.r-universe.dev

for the underlying configuration.

Best wishes,
Achim


>
>    > On Tue, 2 Jul 2024, Kevin R. Coombes wrote:
>
>    >> Hi,
>    >>
>    >> I have been maintaining packages in R-Forge for many
>    >> tears. Last week I sent an email to r-forge at r-project.org
>    >> to report problems with the build process.  It appears
>    >> that any changes I have pushed to R-Forge over
>    >> approximately the last two months have resulted in the
>    >> package remaining in the "Building" state, even though
>    >> the logs suggest that the package built successfully on
>    >> both LINUX and Windows. (Also, four of the six affected
>    >> packages only included changes to the man pages to clean
>    >> up NOTEs from the R cmd checks on old versions at CRAN,
>    >> where the new versions now happily reside.) I have
>    >> received no response nor acknowledgement to my email to
>    >> R-Forge.
>    >>
>    >> Assuming that R-Forge has finally succumbed to the
>    >> ravages of entropy, does anyone have advice on creating a
>    >> git project that contains multiple R packages? (I really
>    >> don't want to have to create 20+ new git projects, one
>    >> per package).
>    >>
>    >> Best, ?? Kevin
>    >>
>    >> ______________________________________________
>    >> R-package-devel at r-project.org mailing list
>    >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>    >>
>    > ______________________________________________
>    > R-package-devel at r-project.org mailing list
>    > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>

From ||@t@ @end|ng |rom dewey@myzen@co@uk  Mon Jul  8 16:04:44 2024
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Mon, 8 Jul 2024 15:04:44 +0100
Subject: [R-pkg-devel] NOTE about lack of prebuilt manual
Message-ID: <d8c9018d-6225-ebd3-9fc5-254c64b20f5c@dewey.myzen.co.uk>

Short version

I have recently tried to update two of my CRAN packages and I am getting 
the NOTE from R CMD check --as-cran

Package has help file(s) containing install/render-stage \Sexpr{} 
expressions but no prebuilt PDF manual.

(It comes on one line in the check.log)

What am I doing wrong?

===================

More details

Both packages have lived successfuly on CRAN for some time but my recent 
attempts to update lead to the NOTE shown above. I notice that the 
version currently on CRAN do have in the tarball a directory called 
build which amongst other thing does contain the package manual. However 
when I build the updated versions the tarball still contains a build 
directory but without the manual.

I am using 4.4.1 under Windows 10. I open a command line and do 
everything from there with R CMD, I do not use any helper package. The 
help files do not explicitly contain any instance of \Sexpr{} but they 
do contain macros. Both of them use mathjaxr and Rdpack and one also has 
some macros written by me. They have been like that for some while. The 
Rd files are hand-written, I do not use any package to generate 
documentation.

I notice that R CMD build has an option to turn off the manual but I do 
not set that and there does not seem to be a turn on option. I have 
looked at the NEWS for R4.4.0 and 4.4.1 but withou enlightenment. The 
versions on CRAN were probably generated with R 4.3.3 judgin by the date 
when I made them.

I know it is only a NOTE but I would like to know why it is happening.

I hope that is enough detail to be helpful but I can expand on any 
unclear areas.

-- 
Michael


From |kw@|mmo @end|ng |rom gm@||@com  Mon Jul  8 16:08:34 2024
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Mon, 8 Jul 2024 10:08:34 -0400
Subject: [R-pkg-devel] NOTE about lack of prebuilt manual
In-Reply-To: <d8c9018d-6225-ebd3-9fc5-254c64b20f5c@dewey.myzen.co.uk>
References: <d8c9018d-6225-ebd3-9fc5-254c64b20f5c@dewey.myzen.co.uk>
Message-ID: <CADNULg-t_C0F_MVSNJR0=R3qRZgPVenMo2s5-GACtmUA05cyng@mail.gmail.com>

This is something I'd run into recently as well.

The R devs changed the default from building the manual to not building the
manual. Now if you want (or need) to build the manual, you should add

BuildManual: TRUE

to your DESCRIPTION.

On Mon, Jul 8, 2024, 10:05 Michael Dewey <lists at dewey.myzen.co.uk> wrote:

> Short version
>
> I have recently tried to update two of my CRAN packages and I am getting
> the NOTE from R CMD check --as-cran
>
> Package has help file(s) containing install/render-stage \Sexpr{}
> expressions but no prebuilt PDF manual.
>
> (It comes on one line in the check.log)
>
> What am I doing wrong?
>
> ===================
>
> More details
>
> Both packages have lived successfuly on CRAN for some time but my recent
> attempts to update lead to the NOTE shown above. I notice that the
> version currently on CRAN do have in the tarball a directory called
> build which amongst other thing does contain the package manual. However
> when I build the updated versions the tarball still contains a build
> directory but without the manual.
>
> I am using 4.4.1 under Windows 10. I open a command line and do
> everything from there with R CMD, I do not use any helper package. The
> help files do not explicitly contain any instance of \Sexpr{} but they
> do contain macros. Both of them use mathjaxr and Rdpack and one also has
> some macros written by me. They have been like that for some while. The
> Rd files are hand-written, I do not use any package to generate
> documentation.
>
> I notice that R CMD build has an option to turn off the manual but I do
> not set that and there does not seem to be a turn on option. I have
> looked at the NEWS for R4.4.0 and 4.4.1 but withou enlightenment. The
> versions on CRAN were probably generated with R 4.3.3 judgin by the date
> when I made them.
>
> I know it is only a NOTE but I would like to know why it is happening.
>
> I hope that is enough detail to be helpful but I can expand on any
> unclear areas.
>
> --
> Michael
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From m@rk@p@dgh@m @end|ng |rom em@||@com  Mon Jul  8 16:24:50 2024
From: m@rk@p@dgh@m @end|ng |rom em@||@com (Mark Padgham)
Date: Mon, 8 Jul 2024 16:24:50 +0200
Subject: [R-pkg-devel] cpp11 and "non-API calls to R"
Message-ID: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>

Dear R-pkg-dev folk,

The cpp11 package, which was developed yet is no longer maintained by
Jim Hester, now triggers warnings on some CRAN pre-submit checks for
"non-API calls to R" via "SETLENGTH", "SET_TRUELENGTH", and others. The
relevant issue is https://github.com/r-lib/cpp11/issues/355, with a pull
request to resolve at https://github.com/r-lib/cpp11/pull/358. Problem
is the package is now largely inactive, with the PR hanging there for a
month or so unattended. I presume this warning means I can not resubmit
any package depending on cpp11 until this is resolved. But then there
are currently 75 packages potentially affected by this which would then
also be unable to be resubmitted. (Follow the links from the main GitHub
issue for a glimpse of the scale of this problem.)

Any suggestions? In particular, it would be helpful, in this arguably
unusual and quite prominent case, to hear any views from CRAN folk as to
whether everybody dependent on cpp11 will have to wait for resolution
before they'll be able to resubmit? Alternatively, any indication from
anybody in a position to opine on cpp11 status and future maintenance
plans would be great!

Thanks,

Mark


From bbo|ker @end|ng |rom gm@||@com  Mon Jul  8 16:37:15 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 8 Jul 2024 10:37:15 -0400
Subject: [R-pkg-devel] cpp11 and "non-API calls to R"
In-Reply-To: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
References: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
Message-ID: <ce18fa43-5d13-4b1c-8e00-e69275276bae@gmail.com>

   Have you contacted the maintainer directly (i.e. by e-mail)?  (Yes, 
they should be paying attention to Github, but trying another channel 
never hurts.)

   My personal experience is that I was succeeded in submitting a 
package update to CRAN even though there were NOTEs of this sort (in 
that case SET_TYPEOF) arising from an upstream package 
<https://github.com/RcppCore/Rcpp/issues/1312>; I explained the issue in 
my cover letter.

   It may take a while to sort out all of the fallout from the 
tightening of the API rules; I think the CRAN maintainers are aware of this.

   cheers
    Ben Bolker


On 2024-07-08 10:24 a.m., Mark Padgham wrote:
> Dear R-pkg-dev folk,
> 
> The cpp11 package, which was developed yet is no longer maintained by
> Jim Hester, now triggers warnings on some CRAN pre-submit checks for
> "non-API calls to R" via "SETLENGTH", "SET_TRUELENGTH", and others. The
> relevant issue is https://github.com/r-lib/cpp11/issues/355, with a pull
> request to resolve at https://github.com/r-lib/cpp11/pull/358. Problem
> is the package is now largely inactive, with the PR hanging there for a
> month or so unattended. I presume this warning means I can not resubmit
> any package depending on cpp11 until this is resolved. But then there
> are currently 75 packages potentially affected by this which would then
> also be unable to be resubmitted. (Follow the links from the main GitHub
> issue for a glimpse of the scale of this problem.)
> 
> Any suggestions? In particular, it would be helpful, in this arguably
> unusual and quite prominent case, to hear any views from CRAN folk as to
> whether everybody dependent on cpp11 will have to wait for resolution
> before they'll be able to resubmit? Alternatively, any indication from
> anybody in a position to opine on cpp11 status and future maintenance
> plans would be great!
> 
> Thanks,
> 
> Mark
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From jo@|@h@p@rry @end|ng |rom gm@||@com  Mon Jul  8 16:39:11 2024
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Mon, 8 Jul 2024 10:39:11 -0400
Subject: [R-pkg-devel] cpp11 and "non-API calls to R"
In-Reply-To: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
References: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
Message-ID: <CAL3ufUJt8=eGcb8cSibK2baBTQYgJ2sJm6m2gNs=Lb+Jr3=OcQ@mail.gmail.com>

Hi Mark,

As someone else affected by this issue, it is actually quite tough to
resolve. This is because quite literally every other day, the list of what
is and is not non-API is changing. It is particularly challenging since
this is in R-devel and not any stable R release.

If there were a stable list of non-API and a stable release of R that this
is associated with it is my guess that the PR would?ve been merged by now.

On Mon, Jul 8, 2024 at 10:25 Mark Padgham <mark.padgham at email.com> wrote:

> Dear R-pkg-dev folk,
>
> The cpp11 package, which was developed yet is no longer maintained by
> Jim Hester, now triggers warnings on some CRAN pre-submit checks for
> "non-API calls to R" via "SETLENGTH", "SET_TRUELENGTH", and others. The
> relevant issue is https://github.com/r-lib/cpp11/issues/355, with a pull
> request to resolve at https://github.com/r-lib/cpp11/pull/358. Problem
> is the package is now largely inactive, with the PR hanging there for a
> month or so unattended. I presume this warning means I can not resubmit
> any package depending on cpp11 until this is resolved. But then there
> are currently 75 packages potentially affected by this which would then
> also be unable to be resubmitted. (Follow the links from the main GitHub
> issue for a glimpse of the scale of this problem.)
>
> Any suggestions? In particular, it would be helpful, in this arguably
> unusual and quite prominent case, to hear any views from CRAN folk as to
> whether everybody dependent on cpp11 will have to wait for resolution
> before they'll be able to resubmit? Alternatively, any indication from
> anybody in a position to opine on cpp11 status and future maintenance
> plans would be great!
>
> Thanks,
>
> Mark
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Jul  8 16:40:24 2024
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 8 Jul 2024 16:40:24 +0200
Subject: [R-pkg-devel] NOTE about lack of prebuilt manual
In-Reply-To: <CADNULg-t_C0F_MVSNJR0=R3qRZgPVenMo2s5-GACtmUA05cyng@mail.gmail.com>
References: <d8c9018d-6225-ebd3-9fc5-254c64b20f5c@dewey.myzen.co.uk>
 <CADNULg-t_C0F_MVSNJR0=R3qRZgPVenMo2s5-GACtmUA05cyng@mail.gmail.com>
Message-ID: <d1edd1b3-4c28-492d-bf30-877f5d024b8d@statistik.tu-dortmund.de>



On 08.07.2024 16:08, Iris Simmons wrote:
> This is something I'd run into recently as well.
> 
> The R devs changed the default from building the manual to not building the
> manual. Now if you want (or need) to build the manual, you should add


Well, not really, we still build manuals unless file(s) containing 
install/render-stage \Sexpr{}  are present (as in this case).

Best,
Uwe Ligges



> BuildManual: TRUE
> 
> to your DESCRIPTION.
> 
> On Mon, Jul 8, 2024, 10:05 Michael Dewey <lists at dewey.myzen.co.uk> wrote:
> 
>> Short version
>>
>> I have recently tried to update two of my CRAN packages and I am getting
>> the NOTE from R CMD check --as-cran
>>
>> Package has help file(s) containing install/render-stage \Sexpr{}
>> expressions but no prebuilt PDF manual.
>>
>> (It comes on one line in the check.log)
>>
>> What am I doing wrong?
>>
>> ===================
>>
>> More details
>>
>> Both packages have lived successfuly on CRAN for some time but my recent
>> attempts to update lead to the NOTE shown above. I notice that the
>> version currently on CRAN do have in the tarball a directory called
>> build which amongst other thing does contain the package manual. However
>> when I build the updated versions the tarball still contains a build
>> directory but without the manual.
>>
>> I am using 4.4.1 under Windows 10. I open a command line and do
>> everything from there with R CMD, I do not use any helper package. The
>> help files do not explicitly contain any instance of \Sexpr{} but they
>> do contain macros. Both of them use mathjaxr and Rdpack and one also has
>> some macros written by me. They have been like that for some while. The
>> Rd files are hand-written, I do not use any package to generate
>> documentation.
>>
>> I notice that R CMD build has an option to turn off the manual but I do
>> not set that and there does not seem to be a turn on option. I have
>> looked at the NEWS for R4.4.0 and 4.4.1 but withou enlightenment. The
>> versions on CRAN were probably generated with R 4.3.3 judgin by the date
>> when I made them.
>>
>> I know it is only a NOTE but I would like to know why it is happening.
>>
>> I hope that is enough detail to be helpful but I can expand on any
>> unclear areas.
>>
>> --
>> Michael
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

From d@n|e|@c|@borne @end|ng |rom pnn|@gov  Tue Jul  9 00:46:32 2024
From: d@n|e|@c|@borne @end|ng |rom pnn|@gov (Claborne, Daniel)
Date: Mon, 8 Jul 2024 22:46:32 +0000
Subject: [R-pkg-devel] Segfaults on R-devel
Message-ID: <CO6PR09MB8597FE4D0E145AA6B5C61DF789DA2@CO6PR09MB8597.namprd09.prod.outlook.com>

Seemingly starting with the most recent builds of R-devel, I?ve been getting segfaults related to a piece of cpp code that indexes a zero-size NumericVector.  Essentially the same as this dummy example:

```
library(Rcpp)

sourceCpp(
  code = '
  #include<Rcpp.h>
  using namespace Rcpp;

  // [[Rcpp::export]]
  NumericVector zeroindex() {
    NumericVector zerosize(0);

    Rcout << zerosize[0] << std::endl;

    return zerosize;
  }
  '
)

zeroindex()
```

On R-release and on previous builds, this returns something like:

```
6.92674e-310
numeric(0)
```

But on current R-devel containers:

```

 *** caught segfault ***

address 0x1, cause 'memory not mapped'



Traceback:

 1: .Call(<pointer: 0x7fa9369c7930>)

 2: zeroindex()



Possible actions:

1: abort (with core dump, if enabled)

2: normal R exit

3: exit R without saving workspace

4: exit R saving workspace
```

It was easy enough to write a catch for the zero-size vector, however I?m wondering why the discrepancy between R-devel and previous versions?

Best,
-DMC

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Tue Jul  9 00:59:51 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 8 Jul 2024 18:59:51 -0400
Subject: [R-pkg-devel] Segfaults on R-devel
In-Reply-To: <CO6PR09MB8597FE4D0E145AA6B5C61DF789DA2@CO6PR09MB8597.namprd09.prod.outlook.com>
References: <CO6PR09MB8597FE4D0E145AA6B5C61DF789DA2@CO6PR09MB8597.namprd09.prod.outlook.com>
Message-ID: <06aae608-16a0-4b26-af09-dfa7fe9fa9d4@gmail.com>

   I'm pretty sure this is from this R-devel commit:

https://github.com/r-devel/r-svn/commit/92c1d5de23c93576f55062e26d446feface07250

  This turns on stricter boundary checking, specifically see 
https://github.com/lme4/lme4/issues/794#issuecomment-2154948145

   Arguably, accessing an element of a zero-length vector is at least 
undefined behaviour, so you shouldn't be doing it ...



On 2024-07-08 6:46 p.m., Claborne, Daniel via R-package-devel wrote:
> Seemingly starting with the most recent builds of R-devel, I?ve been getting segfaults related to a piece of cpp code that indexes a zero-size NumericVector.  Essentially the same as this dummy example:
> 
> ```
> library(Rcpp)
> 
> sourceCpp(
>    code = '
>    #include<Rcpp.h>
>    using namespace Rcpp;
> 
>    // [[Rcpp::export]]
>    NumericVector zeroindex() {
>      NumericVector zerosize(0);
> 
>      Rcout << zerosize[0] << std::endl;
> 
>      return zerosize;
>    }
>    '
> )
> 
> zeroindex()
> ```
> 
> On R-release and on previous builds, this returns something like:
> 
> ```
> 6.92674e-310
> numeric(0)
> ```
> 
> But on current R-devel containers:
> 
> ```
> 
>   *** caught segfault ***
> 
> address 0x1, cause 'memory not mapped'
> 
> 
> 
> Traceback:
> 
>   1: .Call(<pointer: 0x7fa9369c7930>)
> 
>   2: zeroindex()
> 
> 
> 
> Possible actions:
> 
> 1: abort (with core dump, if enabled)
> 
> 2: normal R exit
> 
> 3: exit R without saving workspace
> 
> 4: exit R saving workspace
> ```
> 
> It was easy enough to write a catch for the zero-size vector, however I?m wondering why the discrepancy between R-devel and previous versions?
> 
> Best,
> -DMC
> 
> 	[[alternative HTML version deleted]]
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From mhn@yem@cu@@t@t @end|ng |rom gm@||@com  Mon Jul  8 12:09:35 2024
From: mhn@yem@cu@@t@t @end|ng |rom gm@||@com (Mahadi Hassan)
Date: Mon, 8 Jul 2024 16:09:35 +0600
Subject: [R-pkg-devel] Notes while a new R package submission
Message-ID: <CAGdCjn4u-oHjk09F4737+uAUi+i52pq4k2LkVNWt5MVoTE2kmw@mail.gmail.com>

Hello everyone
I need your attention. I have developed a new R package and submitted it to
CRAN. In return main i got two notes they are:

* using log directory 'd:/RCompile/CRANincoming/R-devel/drglm.Rcheck'
* using R Under development (unstable) (2024-07-05 r86875 ucrt)
* using platform: x86_64-w64-mingw32
* R was compiled by
    gcc.exe (GCC) 13.2.0
    GNU Fortran (GCC) 13.2.0
* running under: Windows Server 2022 x64 (build 20348)
* using session charset: UTF-8
* checking for file 'drglm/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'drglm' version '1.0.1'
* package encoding: UTF-8
* checking CRAN incoming feasibility ... NOTE
Maintainer: 'MHNayem <mhnayem.cu.stat at outlook.com>'

New submission
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for hidden files and directories ... OK
* checking for portable file names ... OK
* checking whether package 'drglm' can be installed ... OK
* checking installed package size ... OK
* checking package directory ... OK
* checking for future file timestamps ... OK
* checking 'build' directory ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking for left-over files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking code files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* checking whether the package can be loaded ... OK
* checking whether the package can be loaded with stated dependencies ... OK
* checking whether the package can be unloaded cleanly ... OK
* checking whether the namespace can be loaded with stated dependencies ... OK
* checking whether the namespace can be unloaded cleanly ... OK
* checking loading without being on the library search path ... OK
* checking use of S3 registration ... OK
* checking dependencies in R code ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking R code for possible problems ... OK
* checking Rd files ... OK
* checking Rd metadata ... OK
* checking Rd line widths ... OK
* checking Rd cross-references ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking Rd contents ... OK
* checking for unstated dependencies in examples ... OK
* checking installed files from 'inst/doc' ... OK
* checking files in 'vignettes' ... OK
* checking examples ... [257s] NOTE
Examples with CPU (user + system) or elapsed time > 10s
                user system elapsed
drglm          93.50  14.34  107.82
drglm.multinom 78.65  13.28   91.89
big.drglm      26.61   1.75   28.36
make.data      25.07   1.78   26.84
* checking for unstated dependencies in 'tests' ... OK
* checking tests ... OK
  Running 'testthat.R'
* checking for unstated dependencies in vignettes ... OK
* checking package vignettes ... OK
* checking re-building of vignette outputs ... [241s] OK
* checking PDF version of manual ... [13s] OK
* checking HTML version of manual ... OK
* DONE
Status: 2 NOTEs



And my submission got cancelled automatically.  Can you tell me how to
solve such notes and how can i resubmit it to CRAN?

	[[alternative HTML version deleted]]


From m@te|@te|em@n @end|ng |rom un||@ch  Mon Jul  8 17:12:24 2024
From: m@te|@te|em@n @end|ng |rom un||@ch (Matei Teleman)
Date: Mon, 8 Jul 2024 15:12:24 +0000
Subject: [R-pkg-devel] Help for understanding CRAN rejection
References: <9DE1C4C5-3A88-4F75-87CD-7A5CE0F7EAA7@unil.ch>
Message-ID: <D21E7C8B-9BA7-4F31-8F43-9E9F654E5118@unil.ch>

Hello everyone,

I hope this email finds you well.

I?m sorry to bother you, it?s the very first time I?m submitting a package to CRAN.

Recently my submission got rejected with the following feedback:
Non-FOSS package license (file LICENSE)

   Suggests or Enhances not in mainstream repositories:
     velocyto.R

   Found the following (possibly) invalid URLs:
     URL: https://cran.r-project.org/web/packages/Seurat/index.html
       From: inst/doc/a_SuperCell.html
       Status: 200
       Message: OK
       CRAN URL not in canonical form

   The canonical URL of the CRAN page for a package is
     https://CRAN.R-project.org/package=pkgname<https://cran.r-project.org/package=pkgname>


   Size of tarball: 9076436 bytes


Flavor: r-devel-linux-x86_64-debian-gcc, r-devel-windows-x86_64
Check: package dependencies, Result: NOTE
   Package suggested but not available for checking: ?velocyto.R'


The license we?re using is the standard CC BY-NC-ND 4.0 and is listed among the accepted licenses for CRAN.

I fixed the URL issue but how can I make CRAN accept the package ?

Thank you advance for your time and your help !

Have a nice day.

Best Regards,

Matei Teleman

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Tue Jul  9 01:51:02 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 8 Jul 2024 19:51:02 -0400
Subject: [R-pkg-devel] Notes while a new R package submission
In-Reply-To: <CAGdCjn4u-oHjk09F4737+uAUi+i52pq4k2LkVNWt5MVoTE2kmw@mail.gmail.com>
References: <CAGdCjn4u-oHjk09F4737+uAUi+i52pq4k2LkVNWt5MVoTE2kmw@mail.gmail.com>
Message-ID: <979f65d6-9dea-4500-a447-483c0c49cd66@gmail.com>

   The first NOTE is irrelevant.  The second NOTE says that you must 
reduce the running time of your examples (so that the longest of them 
takes <10 seconds on the *slowest* CRAN testing platform). This thread 
might be useful: 
https://stat.ethz.ch/pipermail/r-package-devel/2021q4/007521.html

   cheers
    Ben Bolker


On 2024-07-08 6:09 a.m., Mahadi Hassan wrote:
> Hello everyone
> I need your attention. I have developed a new R package and submitted it to
> CRAN. In return main i got two notes they are:
> 
> * using log directory 'd:/RCompile/CRANincoming/R-devel/drglm.Rcheck'
> * using R Under development (unstable) (2024-07-05 r86875 ucrt)
> * using platform: x86_64-w64-mingw32
> * R was compiled by
>      gcc.exe (GCC) 13.2.0
>      GNU Fortran (GCC) 13.2.0
> * running under: Windows Server 2022 x64 (build 20348)
> * using session charset: UTF-8
> * checking for file 'drglm/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'drglm' version '1.0.1'
> * package encoding: UTF-8
> * checking CRAN incoming feasibility ... NOTE
> Maintainer: 'MHNayem <mhnayem.cu.stat at outlook.com>'
> 
> New submission
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking whether package 'drglm' can be installed ... OK
> * checking installed package size ... OK
> * checking package directory ... OK
> * checking for future file timestamps ... OK
> * checking 'build' directory ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking for left-over files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking code files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ... OK
> * checking whether the package can be loaded with stated dependencies ... OK
> * checking whether the package can be unloaded cleanly ... OK
> * checking whether the namespace can be loaded with stated dependencies ... OK
> * checking whether the namespace can be unloaded cleanly ... OK
> * checking loading without being on the library search path ... OK
> * checking use of S3 registration ... OK
> * checking dependencies in R code ... OK
> * checking S3 generic/method consistency ... OK
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... OK
> * checking Rd files ... OK
> * checking Rd metadata ... OK
> * checking Rd line widths ... OK
> * checking Rd cross-references ... OK
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> * checking Rd \usage sections ... OK
> * checking Rd contents ... OK
> * checking for unstated dependencies in examples ... OK
> * checking installed files from 'inst/doc' ... OK
> * checking files in 'vignettes' ... OK
> * checking examples ... [257s] NOTE
> Examples with CPU (user + system) or elapsed time > 10s
>                  user system elapsed
> drglm          93.50  14.34  107.82
> drglm.multinom 78.65  13.28   91.89
> big.drglm      26.61   1.75   28.36
> make.data      25.07   1.78   26.84
> * checking for unstated dependencies in 'tests' ... OK
> * checking tests ... OK
>    Running 'testthat.R'
> * checking for unstated dependencies in vignettes ... OK
> * checking package vignettes ... OK
> * checking re-building of vignette outputs ... [241s] OK
> * checking PDF version of manual ... [13s] OK
> * checking HTML version of manual ... OK
> * DONE
> Status: 2 NOTEs
> 
> 
> 
> And my submission got cancelled automatically.  Can you tell me how to
> solve such notes and how can i resubmit it to CRAN?
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From |kry|ov @end|ng |rom d|@root@org  Tue Jul  9 09:11:33 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Tue, 9 Jul 2024 10:11:33 +0300
Subject: [R-pkg-devel] Help for understanding CRAN rejection
In-Reply-To: <D21E7C8B-9BA7-4F31-8F43-9E9F654E5118@unil.ch>
References: <9DE1C4C5-3A88-4F75-87CD-7A5CE0F7EAA7@unil.ch>
 <D21E7C8B-9BA7-4F31-8F43-9E9F654E5118@unil.ch>
Message-ID: <20240709101133.395178d6@Tarkus>

? Mon, 8 Jul 2024 15:12:24 +0000
Matei Teleman <matei.teleman at unil.ch> ?????:

> Non-FOSS package license (file LICENSE)

> The license we?re using is the standard CC BY-NC-ND 4.0 and is listed
> among the accepted licenses for CRAN

Instead of putting the license text in a file inside the package (that
would have to match byte by byte in order to be recognised
automatically, or may be subtly different from the original with
potentially drastic legal consequences), use the name of the license
listed at [1]:

License: CC BY-NC-ND 4.0

If you want to keep the full text of the license in your source code
repository, put it in a file that you exclude from the source package
using .Rbuildignore.

I'm assuming you've already seen the CC FAQ [2] that recommends against
using CC licenses for software and chose it because it offers
restrictions for commercial use and distribution of derivatives. Too
bad none of the other licenses at [1] offer the same kind of
restrictions.

>    Suggests or Enhances not in mainstream repositories:
>      velocyto.R

Just making sure: have you provided the instructions for obtaining
velocyto.R in the 'Description' field of the DESCRIPTION file?

-- 
Best regards,
Ivan

[1]
https://svn.r-project.org/R/trunk/share/licenses/license.db

[2]
https://creativecommons.org/faq/#can-i-apply-a-creative-commons-license-to-software


From wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n|  Tue Jul  9 10:54:22 2024
From: wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n| (Viechtbauer, Wolfgang (NP))
Date: Tue, 9 Jul 2024 08:54:22 +0000
Subject: [R-pkg-devel] NOTE about lack of prebuilt manual
In-Reply-To: <d1edd1b3-4c28-492d-bf30-877f5d024b8d@statistik.tu-dortmund.de>
References: <d8c9018d-6225-ebd3-9fc5-254c64b20f5c@dewey.myzen.co.uk>
 <CADNULg-t_C0F_MVSNJR0=R3qRZgPVenMo2s5-GACtmUA05cyng@mail.gmail.com>
 <d1edd1b3-4c28-492d-bf30-877f5d024b8d@statistik.tu-dortmund.de>
Message-ID: <AS8PR08MB9193350221722AE50DCA005B8BDB2@AS8PR08MB9193.eurprd08.prod.outlook.com>

Hi Michael,

I assume you are getting this note because you are using mathjaxr. I am also getting this and others have reported the same:

https://github.com/wviechtb/mathjaxr/issues/15

(my response on the forum was a bit premature, since this note eventually did show up for me as well).

This appears to be related to this change (https://cran.r-project.org/doc/manuals/r-devel/NEWS.html):

- tools::checkRd() (used by R CMD check) detects more problems with ?\Sexpr?-based dynamic content, including bad nesting of ?\Sexpr?s and invalid arguments.

which was made in R version 4.4.0. I have submitted an updated metafor version in the meantime despite this note and it was accepted without any problems. Also, while I am getting this note locally, this note does not show up on the CRAN check results:

https://cran.r-project.org/web/checks/check_results_metafor.html

The manual is also available on the CRAN website:

https://cran.r-project.org/package=metafor

and also in the build directory of the tarball (https://cran.r-project.org/src/contrib/metafor_4.6-0.tar.gz).

So, unless CRAN states otherwise, I would suggest to submit the updated versions, burn some incense, pray twenty vectorized hail Rs, and hope for the best.

Best,
Wolfgang

> -----Original Message-----
> From: R-package-devel <r-package-devel-bounces at r-project.org> On Behalf Of Uwe
> Ligges
> Sent: Monday, July 8, 2024 16:40
> To: Iris Simmons <ikwsimmo at gmail.com>; Michael Dewey <lists at dewey.myzen.co.uk>
> Cc: List r-package-devel <r-package-devel at r-project.org>
> Subject: Re: [R-pkg-devel] NOTE about lack of prebuilt manual
>
> On 08.07.2024 16:08, Iris Simmons wrote:
> > This is something I'd run into recently as well.
> >
> > The R devs changed the default from building the manual to not building the
> > manual. Now if you want (or need) to build the manual, you should add
>
> Well, not really, we still build manuals unless file(s) containing
> install/render-stage \Sexpr{}  are present (as in this case).
>
> Best,
> Uwe Ligges
>
> > BuildManual: TRUE
> >
> > to your DESCRIPTION.
> >
> > On Mon, Jul 8, 2024, 10:05 Michael Dewey <lists at dewey.myzen.co.uk> wrote:
> >
> >> Short version
> >>
> >> I have recently tried to update two of my CRAN packages and I am getting
> >> the NOTE from R CMD check --as-cran
> >>
> >> Package has help file(s) containing install/render-stage \Sexpr{}
> >> expressions but no prebuilt PDF manual.
> >>
> >> (It comes on one line in the check.log)
> >>
> >> What am I doing wrong?
> >>
> >> ===================
> >>
> >> More details
> >>
> >> Both packages have lived successfuly on CRAN for some time but my recent
> >> attempts to update lead to the NOTE shown above. I notice that the
> >> version currently on CRAN do have in the tarball a directory called
> >> build which amongst other thing does contain the package manual. However
> >> when I build the updated versions the tarball still contains a build
> >> directory but without the manual.
> >>
> >> I am using 4.4.1 under Windows 10. I open a command line and do
> >> everything from there with R CMD, I do not use any helper package. The
> >> help files do not explicitly contain any instance of \Sexpr{} but they
> >> do contain macros. Both of them use mathjaxr and Rdpack and one also has
> >> some macros written by me. They have been like that for some while. The
> >> Rd files are hand-written, I do not use any package to generate
> >> documentation.
> >>
> >> I notice that R CMD build has an option to turn off the manual but I do
> >> not set that and there does not seem to be a turn on option. I have
> >> looked at the NEWS for R4.4.0 and 4.4.1 but withou enlightenment. The
> >> versions on CRAN were probably generated with R 4.3.3 judgin by the date
> >> when I made them.
> >>
> >> I know it is only a NOTE but I would like to know why it is happening.
> >>
> >> I hope that is enough detail to be helpful but I can expand on any
> >> unclear areas.
> >>
> >> --
> >> Michael

From h@w|ckh@m @end|ng |rom gm@||@com  Tue Jul  9 11:01:21 2024
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Tue, 9 Jul 2024 11:01:21 +0200
Subject: [R-pkg-devel] cpp11 and "non-API calls to R"
In-Reply-To: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
References: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
Message-ID: <CABdHhvGvaWyMuCu3YeXRzA5nSQysi-zpJ3_+kwZCcsJuqCCZiA@mail.gmail.com>

Hi Mark,

The cpp11 package is now maintained by Davis Vaughan and we will release a
new version once the C API status is a little cleaner. This warnings
generated from cpp11 will not interfere with your ability to submit your
package; just let CRAN know that the warnings are coming from cpp11.

Hadley

On Mon, Jul 8, 2024 at 4:25?PM Mark Padgham <mark.padgham at email.com> wrote:

> Dear R-pkg-dev folk,
>
> The cpp11 package, which was developed yet is no longer maintained by
> Jim Hester, now triggers warnings on some CRAN pre-submit checks for
> "non-API calls to R" via "SETLENGTH", "SET_TRUELENGTH", and others. The
> relevant issue is https://github.com/r-lib/cpp11/issues/355, with a pull
> request to resolve at https://github.com/r-lib/cpp11/pull/358. Problem
> is the package is now largely inactive, with the PR hanging there for a
> month or so unattended. I presume this warning means I can not resubmit
> any package depending on cpp11 until this is resolved. But then there
> are currently 75 packages potentially affected by this which would then
> also be unable to be resubmitted. (Follow the links from the main GitHub
> issue for a glimpse of the scale of this problem.)
>
> Any suggestions? In particular, it would be helpful, in this arguably
> unusual and quite prominent case, to hear any views from CRAN folk as to
> whether everybody dependent on cpp11 will have to wait for resolution
> before they'll be able to resubmit? Alternatively, any indication from
> anybody in a position to opine on cpp11 status and future maintenance
> plans would be great!
>
> Thanks,
>
> Mark
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


-- 
http://hadley.nz

	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Tue Jul  9 11:06:11 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Tue, 9 Jul 2024 12:06:11 +0300
Subject: [R-pkg-devel] NOTE about lack of prebuilt manual
In-Reply-To: <AS8PR08MB9193350221722AE50DCA005B8BDB2@AS8PR08MB9193.eurprd08.prod.outlook.com>
References: <d8c9018d-6225-ebd3-9fc5-254c64b20f5c@dewey.myzen.co.uk>
 <CADNULg-t_C0F_MVSNJR0=R3qRZgPVenMo2s5-GACtmUA05cyng@mail.gmail.com>
 <d1edd1b3-4c28-492d-bf30-877f5d024b8d@statistik.tu-dortmund.de>
 <AS8PR08MB9193350221722AE50DCA005B8BDB2@AS8PR08MB9193.eurprd08.prod.outlook.com>
Message-ID: <20240709120611.6e01c078@Tarkus>

? Tue, 9 Jul 2024 08:54:22 +0000
"Viechtbauer, Wolfgang (NP)"
<wolfgang.viechtbauer at maastrichtuniversity.nl> ?????:

> This appears to be related to this change
> (https://cran.r-project.org/doc/manuals/r-devel/NEWS.html):
> 
> - tools::checkRd() (used by R CMD check) detects more problems with
> ?\Sexpr?-based dynamic content, including bad nesting of ?\Sexpr?s
> and invalid arguments.

The exact change was:

r85348 | hornik | 2023-10-18 08:13:46 +0000 (Wed, 18 Oct 2023) | 1 line
Build PDF refman only when explicitly asked for.

--- src/library/tools/R/build.R (revision 85347)
+++ src/library/tools/R/build.R (revision 85348)
@@ -633,7 +633,7 @@
         }

        needRefman <- manual &&
-            parse_description_field(desc, "BuildManual", TRUE) &&
+            parse_description_field(desc, "BuildManual", FALSE) &&
             any(btinfo[, "later"])
        if (needRefman) {
            messageLog(Log, "building the PDF package manual")

So now R CMD build only builds the manual when both BuildManual is set
to yes _and_ there are \Sexpr{}s with [stage=install or render].
(Previously BuildManual: yes was assumed by default.)

Was the motivation for this change to make R CMD build faster for
everyone, with the expectation that the relatively rare package
maintainers with non-[stage=build] \Sexpr{}s will set BuildManual: yes
to adapt?

-- 
Best regards,
Ivan


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Tue Jul  9 12:05:23 2024
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Tue, 9 Jul 2024 11:05:23 +0100
Subject: [R-pkg-devel] NOTE about lack of prebuilt manual
In-Reply-To: <20240709120611.6e01c078@Tarkus>
References: <d8c9018d-6225-ebd3-9fc5-254c64b20f5c@dewey.myzen.co.uk>
 <CADNULg-t_C0F_MVSNJR0=R3qRZgPVenMo2s5-GACtmUA05cyng@mail.gmail.com>
 <d1edd1b3-4c28-492d-bf30-877f5d024b8d@statistik.tu-dortmund.de>
 <AS8PR08MB9193350221722AE50DCA005B8BDB2@AS8PR08MB9193.eurprd08.prod.outlook.com>
 <20240709120611.6e01c078@Tarkus>
Message-ID: <e20648d9-99bc-85a7-f796-cb4f02251fbf@dewey.myzen.co.uk>

Thank you to, in alphabetical order of given names, Iris, Ivan, Uwe and 
Wolfgang for your responses. I implemented Iris' suggestion and have 
successfully uploaded one of the packages to CRAN.

Michael

On 09/07/2024 10:06, Ivan Krylov wrote:
> ? Tue, 9 Jul 2024 08:54:22 +0000
> "Viechtbauer, Wolfgang (NP)"
> <wolfgang.viechtbauer at maastrichtuniversity.nl> ?????:
> 
>> This appears to be related to this change
>> (https://cran.r-project.org/doc/manuals/r-devel/NEWS.html):
>>
>> - tools::checkRd() (used by R CMD check) detects more problems with
>> ?\Sexpr?-based dynamic content, including bad nesting of ?\Sexpr?s
>> and invalid arguments.
> 
> The exact change was:
> 
> r85348 | hornik | 2023-10-18 08:13:46 +0000 (Wed, 18 Oct 2023) | 1 line
> Build PDF refman only when explicitly asked for.
> 
> --- src/library/tools/R/build.R (revision 85347)
> +++ src/library/tools/R/build.R (revision 85348)
> @@ -633,7 +633,7 @@
>           }
> 
>          needRefman <- manual &&
> -            parse_description_field(desc, "BuildManual", TRUE) &&
> +            parse_description_field(desc, "BuildManual", FALSE) &&
>               any(btinfo[, "later"])
>          if (needRefman) {
>              messageLog(Log, "building the PDF package manual")
> 
> So now R CMD build only builds the manual when both BuildManual is set
> to yes _and_ there are \Sexpr{}s with [stage=install or render].
> (Previously BuildManual: yes was assumed by default.)
> 
> Was the motivation for this change to make R CMD build faster for
> everyone, with the expectation that the relatively rare package
> maintainers with non-[stage=build] \Sexpr{}s will set BuildManual: yes
> to adapt?
> 

-- 
Michael


From |kry|ov @end|ng |rom d|@root@org  Tue Jul  9 12:45:05 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Tue, 9 Jul 2024 13:45:05 +0300
Subject: [R-pkg-devel] Help for understanding CRAN rejection
In-Reply-To: <27503A31-8521-4872-8AF7-C1C9AD548AF2@unil.ch>
References: <9DE1C4C5-3A88-4F75-87CD-7A5CE0F7EAA7@unil.ch>
 <D21E7C8B-9BA7-4F31-8F43-9E9F654E5118@unil.ch>
 <20240709101133.395178d6@Tarkus>
 <27503A31-8521-4872-8AF7-C1C9AD548AF2@unil.ch>
Message-ID: <20240709134505.2cd7a4f4@arachnoid>

(I am adding the mailing list back in Cc: because package licensing is
a complicated topic.)

? Tue, 9 Jul 2024 09:25:14 +0000
Matei Teleman <matei.teleman at unil.ch> ?????:

> I?ve added ? ? SuperCell uses
> [velocyto.R](https://github.com/velocyto-team/velocyto.R) for RNA
> velocity. ? in the Description field. Is that enough or I need also
> to directly give the command line to install the package from GitHub ?

It looks like a link should be fine. Here are a few examples of CRAN
packages that have a non-CRAN/Bioconductor package in Suggests: without
setting up Additional_repositories:

https://CRAN.R-project.org/package=babelmixr2
https://CRAN.R-project.org/package=bandsfdp
https://cran.r-project.org/package=GCD

I'm sorry that I didn't note any of the following in my initial reply,
but what worries me about CC BY-NC-ND specifically is that out of 117
CRAN packages with a Creative Commons license and 18 of those that use
the non-FOSS "NonCommercial" clause, none use the "NoDerivatives"
clause. Your users would probably appreciate being able to install
binary builds of your package from CRAN. Does `R CMD INSTALL --build`
count as creating a derivative work, or is it "merely changing the
format"? Then again, CC BY-NC-ND _is_ mentioned in the list of CRAN
licenses, so it could work.

I found a rejected copy of your package in the archive subdirectory on
the CRAN FTP server and a GitHub repository [*] that seems to be
slightly outdated compared to the archived package. (It's best to link
to up-to-date package sources when seeking help with code.) I'm getting
an additional NOTE:

>> Imports includes 21 non-default packages.
>> Importing from so many packages makes the package vulnerable to any
>> of them becoming unavailable.  Move as many as possible to Suggests
>> and use conditionally.

Is there a way to make some of the currently required dependencies into
conditional dependencies? R CMD check --as-cran sets the limit to 20,
so moving just one package from Imports to Suggests will silence this
particular NOTE.

I see that most of your package size comes from the data subdirectory.
CRAN policy says: "Packages should be of the minimum necessary size.
<...> Neither data nor documentation should exceed 5MB. <...> Where a
large amount of data is required (even after compression),
consideration should be given to a separate data-only package which can
be updated only rarely (since older versions of packages are archived
in perpetuity)."
Is there a way to reduce the size of the data? It's ideal if there's
only enough data to demonstrate how an algorithm works in the
\examples{} section of your documentation and to exercise as much of
your code as feasible in your tests.

Finally, were there any recommendations in the rejection e-mail from
CRAN? Sometimes NOTEs are unavoidable, but we should strive to minimise
them anyway.

-- 
Best regards,
Ivan

[*] https://github.com/GfellerLab/SuperCell


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Jul 10 14:54:30 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 10 Jul 2024 08:54:30 -0400
Subject: [R-pkg-devel] =?utf-8?b?VXNlIG9mIOKAmFJfSW5wdXRIYW5kbGVyc+KAmQ==?=
Message-ID: <1fad3e4c-9b05-47af-8687-bf34719b5c38@gmail.com>

An update to the rgl package was rejected with this note:

> * checking compiled code ... NOTE
> File ?rgl/libs/rgl.so?:
>   Found non-API call to R: ?R_InputHandlers?
> 
> Compiled code should not call non-API entry points in R.
> 
> See ?Writing portable packages? in the ?Writing R Extensions? manual,
> and section ?Moving into C API compliance? for issues with the use of
> non-API entry points.

See 
<https://win-builder.r-project.org/incoming_pretest/rgl_1.3.10_20240707_165632/Debian/00check.log> 
for more info.

`R_InputHandlers` isn't actually a function, it's a linked list of 
structures holding input handlers.  rgl links into it to handle mouse 
and keyboard interaction when it is displaying a window in X11.

`R_InputHandlers` is declared in R in src/include/R_ext/eventloop.h, 
where comments state

> /*
>    For use by alternative front-ends and packages which need to share
>    the R event loop (on Unix-alikes).
> 
>    Not part of the API and subject to change without notice.
> 
>    NB: HAVE_SYS_SELECT_H should be checked and defined before this is
>    included.
>  */

WRE has a discussion of the issue in 8.1.4, "meshing event loops".  It 
refers to comments in src/unix/sys-std.c, but I'm not sure which comments.

rgl references it from this code:

https://github.com/dmurdoch/rgl/blob/fbedc326e291c3ec28a9ccac7d030f04b05edfa3/src/x11lib.cpp#L53-L72

Can anyone tell me whether I can fix this?

Duncan Murdoch


From mu@che|||j2 @end|ng |rom gm@||@com  Thu Jul 11 07:08:06 2024
From: mu@che|||j2 @end|ng |rom gm@||@com (John Muschelli)
Date: Thu, 11 Jul 2024 01:08:06 -0400
Subject: [R-pkg-devel] Options "reset" when options(opts)
Message-ID: <CAFsq6G_hyMMdTUJdrgmwRm8HuH_WdsQ7y_nrYLTKUmDsRsMqig@mail.gmail.com>

When setting options in a function, I have always used the following:
  opts <- options()
  on.exit(options(opts), add = TRUE)
and assumed it "reset" options to what they were prior to running the
function.  But for some options that are set to NULL, it does not seem to
reset them.  Specifically, I have found digits.secs to be set after this
simple example below.  Is this expected behavior/documented?  Overall, this
specific example (the one I encountered in the wild) is not that harmful,
but I wanted to ask before I set a fix for this in our work

noset = function() {
  opts = options()
  print(opts$digits.secs)
  on.exit(options(opts))
  options(digits.secs = 3)
}
getOption("digits.secs")
#> NULL
noset()
#> NULL
getOption("digits.secs")
#> [1] 3


John Muschelli, PhD
Associate Research Professor
Department of Biostatistics
Johns Hopkins Bloomberg School of Public Health

	[[alternative HTML version deleted]]


From iuke-tier@ey m@iii@g oii uiow@@edu  Thu Jul 11 08:43:06 2024
From: iuke-tier@ey m@iii@g oii uiow@@edu (iuke-tier@ey m@iii@g oii uiow@@edu)
Date: Thu, 11 Jul 2024 01:43:06 -0500 (CDT)
Subject: [R-pkg-devel] 
 =?iso8859-7?q?=5BExternal=5D__Use_of_=A1R=5FInputH?=
 =?iso8859-7?q?andlers=A2?=
In-Reply-To: <1fad3e4c-9b05-47af-8687-bf34719b5c38@gmail.com>
References: <1fad3e4c-9b05-47af-8687-bf34719b5c38@gmail.com>
Message-ID: <feaa28db-bcc6-b8f4-4687-12934442dd31@uiowa.edu>

On Wed, 10 Jul 2024, Duncan Murdoch wrote:

> An update to the rgl package was rejected with this note:
>
>> * checking compiled code ... NOTE
>> File ?rgl/libs/rgl.so?:
>>   Found non-API call to R: ?R_InputHandlers?
>> 
>> Compiled code should not call non-API entry points in R.
>> 
>> See ?Writing portable packages? in the ?Writing R Extensions? manual,
>> and section ?Moving into C API compliance? for issues with the use of
>> non-API entry points.
>
> See 
> <https://win-builder.r-project.org/incoming_pretest/rgl_1.3.10_20240707_165632/Debian/00check.log> 
> for more info.
>
> `R_InputHandlers` isn't actually a function, it's a linked list of structures 
> holding input handlers.  rgl links into it to handle mouse and keyboard 
> interaction when it is displaying a window in X11.

Ideally the code generating the NOTE should be revised since a few of
the things checked for at that point are global variables, not entry
points.

Given the design of this interface this variable should be added to
the embedding API and dropped from the check list. I have not dropped
it from the check list in R-devel so you should no longer get this
NOTE.

Best,

luke

>
> `R_InputHandlers` is declared in R in src/include/R_ext/eventloop.h, where 
> comments state
>
>> /*
>>    For use by alternative front-ends and packages which need to share
>>    the R event loop (on Unix-alikes).
>>
>>    Not part of the API and subject to change without notice.
>>
>>    NB: HAVE_SYS_SELECT_H should be checked and defined before this is
>>    included.
>>  */
>
> WRE has a discussion of the issue in 8.1.4, "meshing event loops".  It refers 
> to comments in src/unix/sys-std.c, but I'm not sure which comments.
>
> rgl references it from this code:
>
> https://github.com/dmurdoch/rgl/blob/fbedc326e291c3ec28a9ccac7d030f04b05edfa3/src/x11lib.cpp#L53-L72
>
> Can anyone tell me whether I can fix this?
>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu/

From je||er|@ @end|ng |rom gm@||@com  Thu Jul 11 08:49:23 2024
From: je||er|@ @end|ng |rom gm@||@com (Greg Jefferis)
Date: Thu, 11 Jul 2024 07:49:23 +0100
Subject: [R-pkg-devel] Options "reset" when options(opts)
In-Reply-To: <CAFsq6G_hyMMdTUJdrgmwRm8HuH_WdsQ7y_nrYLTKUmDsRsMqig@mail.gmail.com>
References: <CAFsq6G_hyMMdTUJdrgmwRm8HuH_WdsQ7y_nrYLTKUmDsRsMqig@mail.gmail.com>
Message-ID: <46F58CE1-56A2-4540-AEBE-E297B2BF80DA@gmail.com>

Dear John,

You need to collect the return value when setting options. This will include an explicit NULL value for an option that was previously NULL. 

Best,

Greg Jefferis.

options(digits.secs = NULL)

noset2 = function() {
  opts <- options(digits.secs = 3)
  on.exit(options(opts))
  print(opts)
}

> getOption("digits.secs")
NULL
 
> noset2()
$digits.secs
NULL

> getOption("digits.secs")
NULL

Gregory Jefferis
Division of Neurobiology
MRC Laboratory of Molecular Biology
Francis Crick Avenue
Cambridge Biomedical Campus
Cambridge, CB2 OQH, UK

http://www2.mrc-lmb.cam.ac.uk/group-leaders/h-to-m/g-jefferis
http://jefferislab.org
https://www.zoo.cam.ac.uk/research/groups/connectomics


> On 11 Jul 2024, at 06:08, John Muschelli <muschellij2 at gmail.com> wrote:
> 
> When setting options in a function, I have always used the following:
>  opts <- options()
>  on.exit(options(opts), add = TRUE)
> and assumed it "reset" options to what they were prior to running the
> function.  But for some options that are set to NULL, it does not seem to
> reset them.  Specifically, I have found digits.secs to be set after this
> simple example below.  Is this expected behavior/documented?  Overall, this
> specific example (the one I encountered in the wild) is not that harmful,
> but I wanted to ask before I set a fix for this in our work
> 
> noset = function() {
>  opts = options()
>  print(opts$digits.secs)
>  on.exit(options(opts))
>  options(digits.secs = 3)
> }
> getOption("digits.secs")
> #> NULL
> noset()
> #> NULL
> getOption("digits.secs")
> #> [1] 3
> 
> 
> John Muschelli, PhD
> Associate Research Professor
> Department of Biostatistics
> Johns Hopkins Bloomberg School of Public Health
> 
> [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@v|dhughjone@ @end|ng |rom gm@||@com  Thu Jul 11 12:08:48 2024
From: d@v|dhughjone@ @end|ng |rom gm@||@com (David Hugh-Jones)
Date: Thu, 11 Jul 2024 11:08:48 +0100
Subject: [R-pkg-devel] Options "reset" when options(opts)
In-Reply-To: <46F58CE1-56A2-4540-AEBE-E297B2BF80DA@gmail.com>
References: <CAFsq6G_hyMMdTUJdrgmwRm8HuH_WdsQ7y_nrYLTKUmDsRsMqig@mail.gmail.com>
 <46F58CE1-56A2-4540-AEBE-E297B2BF80DA@gmail.com>
Message-ID: <CAARY7kgG8H+nmDDCHfvqPUZyt=MANWQ4VXtcjAGojZZi=UkdSQ@mail.gmail.com>

This surprised me, even though it shouldn?t have done. (My false internal
model of the world was that oo <- options(); ? options(oo) would overwrite
the entire options list with the old values.) I wonder if it would be worth
pointing out explicitly in ?options.

Writing: wyclif.substack.com
Book: www.wyclifsdust.com


On Thu, 11 Jul 2024 at 08:03, Greg Jefferis <jefferis at gmail.com> wrote:

> Dear John,
>
> You need to collect the return value when setting options. This will
> include an explicit NULL value for an option that was previously NULL.
>
> Best,
>
> Greg Jefferis.
>
> options(digits.secs = NULL)
>
> noset2 = function() {
>   opts <- options(digits.secs = 3)
>   on.exit(options(opts))
>   print(opts)
> }
>
> > getOption("digits.secs")
> NULL
>
> > noset2()
> $digits.secs
> NULL
>
> > getOption("digits.secs")
> NULL
>
> Gregory Jefferis
> Division of Neurobiology
> MRC Laboratory of Molecular Biology
> Francis Crick Avenue
> Cambridge Biomedical Campus
> Cambridge, CB2 OQH, UK
>
> http://www2.mrc-lmb.cam.ac.uk/group-leaders/h-to-m/g-jefferis
> http://jefferislab.org
> https://www.zoo.cam.ac.uk/research/groups/connectomics
>
>
> > On 11 Jul 2024, at 06:08, John Muschelli <muschellij2 at gmail.com> wrote:
> >
> > When setting options in a function, I have always used the following:
> >  opts <- options()
> >  on.exit(options(opts), add = TRUE)
> > and assumed it "reset" options to what they were prior to running the
> > function.  But for some options that are set to NULL, it does not seem to
> > reset them.  Specifically, I have found digits.secs to be set after this
> > simple example below.  Is this expected behavior/documented?  Overall,
> this
> > specific example (the one I encountered in the wild) is not that harmful,
> > but I wanted to ask before I set a fix for this in our work
> >
> > noset = function() {
> >  opts = options()
> >  print(opts$digits.secs)
> >  on.exit(options(opts))
> >  options(digits.secs = 3)
> > }
> > getOption("digits.secs")
> > #> NULL
> > noset()
> > #> NULL
> > getOption("digits.secs")
> > #> [1] 3
> >
> >
> > John Muschelli, PhD
> > Associate Research Professor
> > Department of Biostatistics
> > Johns Hopkins Bloomberg School of Public Health
> >
> > [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ch@|n@@wt|ney @end|ng |rom gm@||@com  Thu Jul 11 16:22:49 2024
From: ch@|n@@wt|ney @end|ng |rom gm@||@com (Chung-hong Chan)
Date: Thu, 11 Jul 2024 16:22:49 +0200
Subject: [R-pkg-devel] cpp11 and "non-API calls to R"
In-Reply-To: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
References: <b73ddb20-bc88-48aa-97a1-266e9db4d4da@email.com>
Message-ID: <CAHfK2Mu+U0Yn_e5Cd8hQZ08iS-XBK-zcd2xPzRPVpASVQ2WSHQ@mail.gmail.com>

Not from CRAN, also not in a position to opine on cpp11 status, but I
wrote about it recently. My solution for readODS back then was to
vendor cpp11 and remove the SET_LENGTH call manually, like . But back
then CRAN might not know about this. I think it should be easier now.

https://www.chainsawriot.com/postmannheim/2024/05/26/readods230.html

On Mon, Jul 8, 2024 at 4:25?PM Mark Padgham <mark.padgham at email.com> wrote:
>
> Dear R-pkg-dev folk,
>
> The cpp11 package, which was developed yet is no longer maintained by
> Jim Hester, now triggers warnings on some CRAN pre-submit checks for
> "non-API calls to R" via "SETLENGTH", "SET_TRUELENGTH", and others. The
> relevant issue is https://github.com/r-lib/cpp11/issues/355, with a pull
> request to resolve at https://github.com/r-lib/cpp11/pull/358. Problem
> is the package is now largely inactive, with the PR hanging there for a
> month or so unattended. I presume this warning means I can not resubmit
> any package depending on cpp11 until this is resolved. But then there
> are currently 75 packages potentially affected by this which would then
> also be unable to be resubmitted. (Follow the links from the main GitHub
> issue for a glimpse of the scale of this problem.)
>
> Any suggestions? In particular, it would be helpful, in this arguably
> unusual and quite prominent case, to hear any views from CRAN folk as to
> whether everybody dependent on cpp11 will have to wait for resolution
> before they'll be able to resubmit? Alternatively, any indication from
> anybody in a position to opine on cpp11 status and future maintenance
> plans would be great!
>
> Thanks,
>
> Mark
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m@te|@te|em@n @end|ng |rom un||@ch  Thu Jul 11 16:50:47 2024
From: m@te|@te|em@n @end|ng |rom un||@ch (Matei Teleman)
Date: Thu, 11 Jul 2024 14:50:47 +0000
Subject: [R-pkg-devel] Help for understanding CRAN rejection
In-Reply-To: <20240709134505.2cd7a4f4@arachnoid>
References: <9DE1C4C5-3A88-4F75-87CD-7A5CE0F7EAA7@unil.ch>
 <D21E7C8B-9BA7-4F31-8F43-9E9F654E5118@unil.ch>
 <20240709101133.395178d6@Tarkus>
 <27503A31-8521-4872-8AF7-C1C9AD548AF2@unil.ch>
 <20240709134505.2cd7a4f4@arachnoid>
Message-ID: <F5BD2414-3FCC-4229-B5EA-DB8CFC412AAC@unil.ch>

Dear Ivan,

Thank you so much for your help.

I followed your advices and I reduced the size of the example data, move one package from Import to Suggest.

The type of the license is unfortunately not depending on me so I?ll try one last time with the CC license and the new improvements.

Thank your again for your time.

Have a nice day!

Best regards,

Matei


> Le 9 juil. 2024 ? 12:45, Ivan Krylov <ikrylov at disroot.org> a ?crit :
> 
> (I am adding the mailing list back in Cc: because package licensing is
> a complicated topic.)
> 
> ? Tue, 9 Jul 2024 09:25:14 +0000
> Matei Teleman <matei.teleman at unil.ch> ?????:
> 
>> I?ve added ? ? SuperCell uses
>> [velocyto.R](https://github.com/velocyto-team/velocyto.R) for RNA
>> velocity. ? in the Description field. Is that enough or I need also
>> to directly give the command line to install the package from GitHub ?
> 
> It looks like a link should be fine. Here are a few examples of CRAN
> packages that have a non-CRAN/Bioconductor package in Suggests: without
> setting up Additional_repositories:
> 
> https://CRAN.R-project.org/package=babelmixr2
> https://CRAN.R-project.org/package=bandsfdp
> https://cran.r-project.org/package=GCD
> 
> I'm sorry that I didn't note any of the following in my initial reply,
> but what worries me about CC BY-NC-ND specifically is that out of 117
> CRAN packages with a Creative Commons license and 18 of those that use
> the non-FOSS "NonCommercial" clause, none use the "NoDerivatives"
> clause. Your users would probably appreciate being able to install
> binary builds of your package from CRAN. Does `R CMD INSTALL --build`
> count as creating a derivative work, or is it "merely changing the
> format"? Then again, CC BY-NC-ND _is_ mentioned in the list of CRAN
> licenses, so it could work.
> 
> I found a rejected copy of your package in the archive subdirectory on
> the CRAN FTP server and a GitHub repository [*] that seems to be
> slightly outdated compared to the archived package. (It's best to link
> to up-to-date package sources when seeking help with code.) I'm getting
> an additional NOTE:
> 
>>> Imports includes 21 non-default packages.
>>> Importing from so many packages makes the package vulnerable to any
>>> of them becoming unavailable.  Move as many as possible to Suggests
>>> and use conditionally.
> 
> Is there a way to make some of the currently required dependencies into
> conditional dependencies? R CMD check --as-cran sets the limit to 20,
> so moving just one package from Imports to Suggests will silence this
> particular NOTE.
> 
> I see that most of your package size comes from the data subdirectory.
> CRAN policy says: "Packages should be of the minimum necessary size.
> <...> Neither data nor documentation should exceed 5MB. <...> Where a
> large amount of data is required (even after compression),
> consideration should be given to a separate data-only package which can
> be updated only rarely (since older versions of packages are archived
> in perpetuity)."
> Is there a way to reduce the size of the data? It's ideal if there's
> only enough data to demonstrate how an algorithm works in the
> \examples{} section of your documentation and to exercise as much of
> your code as feasible in your tests.
> 
> Finally, were there any recommendations in the rejection e-mail from
> CRAN? Sometimes NOTEs are unavoidable, but we should strive to minimise
> them anyway.
> 
> -- 
> Best regards,
> Ivan
> 
> [*] https://github.com/GfellerLab/SuperCell


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Thu Jul 11 20:22:07 2024
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Thu, 11 Jul 2024 14:22:07 -0400 (EDT)
Subject: [R-pkg-devel] Options "reset" when options(opts)
In-Reply-To: <CAARY7kgG8H+nmDDCHfvqPUZyt=MANWQ4VXtcjAGojZZi=UkdSQ@mail.gmail.com>
References: <CAFsq6G_hyMMdTUJdrgmwRm8HuH_WdsQ7y_nrYLTKUmDsRsMqig@mail.gmail.com>
 <46F58CE1-56A2-4540-AEBE-E297B2BF80DA@gmail.com>
 <CAARY7kgG8H+nmDDCHfvqPUZyt=MANWQ4VXtcjAGojZZi=UkdSQ@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2407111415420.11778@iridium>



On Thu, 11 Jul 2024, David Hugh-Jones wrote:

> This surprised me, even though it shouldn?t have done. (My false internal
> model of the world was that oo <- options(); ? options(oo) would overwrite
> the entire options list with the old values.) I wonder if it would be worth
> pointing out explicitly in ?options.

Arguably, it would be nice to have a parameter like "reset", so 
that one can call

options(oo, reset=TRUE)

and any options not explicitly passed by oo are set to NULL.

This way there are two modes of operation - bulk setting of subset of 
options with reset=FALSE, and restoring full options set with reset=TRUE.

best

Vladimir Dergachev

>
> Writing: wyclif.substack.com
> Book: www.wyclifsdust.com
>
>
> On Thu, 11 Jul 2024 at 08:03, Greg Jefferis <jefferis at gmail.com> wrote:
>
>> Dear John,
>>
>> You need to collect the return value when setting options. This will
>> include an explicit NULL value for an option that was previously NULL.
>>
>> Best,
>>
>> Greg Jefferis.
>>
>> options(digits.secs = NULL)
>>
>> noset2 = function() {
>>   opts <- options(digits.secs = 3)
>>   on.exit(options(opts))
>>   print(opts)
>> }
>>
>>> getOption("digits.secs")
>> NULL
>>
>>> noset2()
>> $digits.secs
>> NULL
>>
>>> getOption("digits.secs")
>> NULL
>>
>> Gregory Jefferis
>> Division of Neurobiology
>> MRC Laboratory of Molecular Biology
>> Francis Crick Avenue
>> Cambridge Biomedical Campus
>> Cambridge, CB2 OQH, UK
>>
>> http://www2.mrc-lmb.cam.ac.uk/group-leaders/h-to-m/g-jefferis
>> http://jefferislab.org
>> https://www.zoo.cam.ac.uk/research/groups/connectomics
>>
>>
>>> On 11 Jul 2024, at 06:08, John Muschelli <muschellij2 at gmail.com> wrote:
>>>
>>> When setting options in a function, I have always used the following:
>>>  opts <- options()
>>>  on.exit(options(opts), add = TRUE)
>>> and assumed it "reset" options to what they were prior to running the
>>> function.  But for some options that are set to NULL, it does not seem to
>>> reset them.  Specifically, I have found digits.secs to be set after this
>>> simple example below.  Is this expected behavior/documented?  Overall,
>> this
>>> specific example (the one I encountered in the wild) is not that harmful,
>>> but I wanted to ask before I set a fix for this in our work
>>>
>>> noset = function() {
>>>  opts = options()
>>>  print(opts$digits.secs)
>>>  on.exit(options(opts))
>>>  options(digits.secs = 3)
>>> }
>>> getOption("digits.secs")
>>> #> NULL
>>> noset()
>>> #> NULL
>>> getOption("digits.secs")
>>> #> [1] 3
>>>
>>>
>>> John Muschelli, PhD
>>> Associate Research Professor
>>> Department of Biostatistics
>>> Johns Hopkins Bloomberg School of Public Health
>>>
>>> [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

From @@j5xsj9 m@iii@g oii @iiiy@@ddy@io  Thu Jul 11 22:58:53 2024
From: @@j5xsj9 m@iii@g oii @iiiy@@ddy@io (@@j5xsj9 m@iii@g oii @iiiy@@ddy@io)
Date: Thu, 11 Jul 2024 20:58:53 +0000
Subject: [R-pkg-devel] Properly referencing copied code
Message-ID: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>

I'm trying to submit a package to CRAN that uses external C libs but properly crediting copyright holders and authors is the main issue holding up the submission and I've repeatedly failed to satisfy the requirements. I am having a lot of trouble understanding what/who I need to be listing in my DESCRIPTION file and how they should be listed.

1. How does linking to external libs differ from providing the source of a library and linking against that? Do I need to provide references to lapack and blas if they aren't shipped with the package? What about math (lm)?

2. What roles to supply to authors of external software? After my last submission, I got the note:
> Has copyright holders of included software in a [ctb] role only

From the CRAN Repository Policy file:
>Where code is copied (or derived) from the work of others (including from R itself), care must be taken that any copyright/license statements are preserved and authorship is not misrepresented.
>Preferably, an ?Authors at R? field would be used with ?ctb? roles for the authors of such code. Alternatively, the ?Author? field should list these authors as contributors.
>
>Where copyrights are held by an entity other than the package authors, this should preferably be indicated via ?cph? roles in the ?Authors at R? field, or using a ?Copyright? field (if necessary referring to an inst/COPYRIGHTS file).

My interpretation of the CRAN policy is that the role 'cph' should be used only for "entities other than the package authors" and therefore authors should only get 'ctb'. Do I need to differentiate between authors with explicit copyrights `c('ctb', 'cph')` vs those who are authors but are not listed as copyright holders `c('ctb')` in the third party source? Or just give everyone both?

3. One of my dependencies has a lot of copyright holders throughout the source. Most of these are for individual functions and cmake files that are not directly used by my package. What is the best way to handle this? Add as much of the unused parts of the third party package to the .Rbuildignore file as possible to filter out the unused parts? (Many copyrights are from parts of the package that are independent on the parts I used so for example ignore an unused vendor package seems reasonable but what about hand picking the main source files that are actually compiled to avoid copyrights?) Or list all of the authors/copyrights in the my DESCRIPTION file?

4. Is there a better place to put all these authors? The author list has already gotten large and I still have many more to add. I've seen use of an `AUTHOR-list.md` in packages but I don't see this mentioned in official documentation. In the previous quotation from CRAN's policy document, it mentions the possible use of a `inst/COPYRIGHTS` file that is referenced in the DESCRIPTION. Is there an equivalent for authors? Is it preferred to just put everything in DESCRIPTION instead?

- DRC
	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Fri Jul 12 10:07:41 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Fri, 12 Jul 2024 11:07:41 +0300
Subject: [R-pkg-devel] Properly referencing copied code
In-Reply-To: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>
References: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>
Message-ID: <20240712110741.5ba1a154@Tarkus>

? Thu, 11 Jul 2024 20:58:53 +0000
DRC via R-package-devel <r-package-devel at r-project.org> ?????:

> 1. How does linking to external libs differ from providing the source
> of a library and linking against that?

I think that the author information in the DESCRIPTION is about what
your package provides by itself, not everything that may end up in the
address space once the package is loaded. Since CRAN prefers
self-contained packages, we end up including them in our packages
(unless the third-party library is already very common and present in
RTools & macOS recipes & common GNU/Linux distros), which requires us
to specify their authors.

> Do I need to provide references to lapack and blas if they aren't
> shipped with the package? What about math (lm)?

No.

> 2. What roles to supply to authors of external software?

> Do I need to differentiate between authors with explicit copyrights
> `c('ctb', 'cph')` vs those who are authors but are not listed as
> copyright holders `c('ctb')` in the third party source? Or just give
> everyone both?

I would expect most authors and contributors to be copyright holders
too, but it must be possible to contribute without providing patches
and becoming one. E.g. a project might recognise a tester and bug
reporter as a full author, but there is no code that they own any
copyright on.

> 3. One of my dependencies has a lot of copyright holders throughout
> the source. Most of these are for individual functions and cmake
> files that are not directly used by my package. What is the best way
> to handle this? Add as much of the unused parts of the third party
> package to the .Rbuildignore file as possible to filter out the
> unused parts?

If it's feasible to implement, omitting unused files from the tarball
is a good idea.

> 4. Is there a better place to put all these authors? The author list
> has already gotten large and I still have many more to add.

CRAN recognises inst/AUTHORS. Here's a recently released package with
no obvious problems that makes use of it:
https://CRAN.R-project.org/package=xlcharts

We should probably document it somewhere.

-- 
Best regards,
Ivan


From d@|@ger @end|ng |rom |redhutch@org  Fri Jul 12 17:02:55 2024
From: d@|@ger @end|ng |rom |redhutch@org (Slager, Dave)
Date: Fri, 12 Jul 2024 15:02:55 +0000
Subject: [R-pkg-devel] relative vignette paths across CRAN check flavors
Message-ID: <SA3PR11MB7626D6A3515F654EDC2AEEDEB3A62@SA3PR11MB7626.namprd11.prod.outlook.com>

Hi,

Do the r-oldrel-macos-* CRAN check servers use a different setting that affects how vignette paths work? These two flavors seem less robust to relative vignette paths than other flavors, and I haven't been able to figure out why by looking at the descriptions of the flavors or the R CMD check output. For example, see:

https://cran.r-project.org/web/checks/check_results_PieGlyph.html
https://cran.r-project.org/web/checks/check_results_APCalign.html
https://cran.r-project.org/web/checks/check_results_agua.html
https://cran.r-project.org/web/checks/check_results_cleanepi.html
https://cran.r-project.org/web/checks/check_results_hardhat.html
https://cran.r-project.org/web/checks/check_results_IncidencePrevalence.html
https://cran.r-project.org/web/checks/check_results_metajam.html
https://cran.r-project.org/web/checks/check_results_ulrb.html

Thanks,
Dave


From @@j5xsj9 m@iii@g oii @iiiy@@ddy@io  Fri Jul 12 22:17:22 2024
From: @@j5xsj9 m@iii@g oii @iiiy@@ddy@io (@@j5xsj9 m@iii@g oii @iiiy@@ddy@io)
Date: Fri, 12 Jul 2024 20:17:22 +0000
Subject: [R-pkg-devel] Properly referencing copied code
In-Reply-To: <20240712110741.5ba1a154@Tarkus>
References: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>
 <20240712110741.5ba1a154@Tarkus>
Message-ID: <de459413e13d404a61c1722ad3d19bd7@nilly.addy.io>

Thanks that helps. Are there any thoughts on the feedback I was given? I'm still a bit confused on the note:

> Has copyright holders of included software in a [ctb] role only

I think I'm being asked to add the cph role to essentially every author in addition to ctp but that doesn't seem to be what the CRAN policy wants and I still don't know how to decide who gets both. Right now there are several people who have explicit copyright over certain code so I would think just add cph to all those authors? Or just give everyone cph who isn't a minor contributor?

?- DRC

On Friday, July 12th, 2024 at 3:07 AM, Ivan Krylov 'ikrylov at disroot.org' <anj5xsj9+ikrylov=disroot.org at nilly.addy.io> wrote:

> 
> ? Thu, 11 Jul 2024 20:58:53 +0000
> DRC via R-package-devel r-package-devel at r-project.org ?????:
> 
> > 1. How does linking to external libs differ from providing the source
> > of a library and linking against that?
> 
> 
> I think that the author information in the DESCRIPTION is about what
> your package provides by itself, not everything that may end up in the
> address space once the package is loaded. Since CRAN prefers
> self-contained packages, we end up including them in our packages
> (unless the third-party library is already very common and present in
> RTools & macOS recipes & common GNU/Linux distros), which requires us
> to specify their authors.
> 
> > Do I need to provide references to lapack and blas if they aren't
> > shipped with the package? What about math (lm)?
> 
> 
> No.
> 
> > 2. What roles to supply to authors of external software?
> 
> > Do I need to differentiate between authors with explicit copyrights
> > `c('ctb', 'cph')` vs those who are authors but are not listed as
> > copyright holders `c('ctb')` in the third party source? Or just give
> > everyone both?
> 
> 
> I would expect most authors and contributors to be copyright holders
> too, but it must be possible to contribute without providing patches
> and becoming one. E.g. a project might recognise a tester and bug
> reporter as a full author, but there is no code that they own any
> copyright on.
> 
> > 3. One of my dependencies has a lot of copyright holders throughout
> > the source. Most of these are for individual functions and cmake
> > files that are not directly used by my package. What is the best way
> > to handle this? Add as much of the unused parts of the third party
> > package to the .Rbuildignore file as possible to filter out the
> > unused parts?
> 
> 
> If it's feasible to implement, omitting unused files from the tarball
> is a good idea.
> 
> > 4. Is there a better place to put all these authors? The author list
> > has already gotten large and I still have many more to add.
> 
> 
> CRAN recognises inst/AUTHORS. Here's a recently released package with
> no obvious problems that makes use of it:
> https://CRAN.R-project.org/package=xlcharts
> 
> We should probably document it somewhere.
> 
> --
> Best regards,
> Ivan


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Jul 13 12:24:36 2024
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sat, 13 Jul 2024 12:24:36 +0200
Subject: [R-pkg-devel] Properly referencing copied code
In-Reply-To: <20240712110741.5ba1a154@Tarkus>
References: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>
 <20240712110741.5ba1a154@Tarkus>
Message-ID: <65BF00D9-1C0F-403F-A221-5A58796E843B@R-project.org>



> On 12 Jul 2024, at 10:07, Ivan Krylov via R-package-devel <r-package-devel at r-project.org> wrote:
> 
> ? Thu, 11 Jul 2024 20:58:53 +0000
> DRC via R-package-devel <r-package-devel at r-project.org> ?????:
> 
>> 1. How does linking to external libs differ from providing the source
>> of a library and linking against that?
> 
> I think that the author information in the DESCRIPTION is about what your package provides by itself, not everything that may end up in the address space once the package is loaded. Since CRAN prefers self-contained packages, we end up including them in our packages (unless the third-party library is already very common and present in RTools & macOS recipes & common GNU/Linux distros), which requires us to specify their authors.
> 


To clarify: as far as CRAN is concerned you only need to include sources that are otherwise not commonly available - or if you need to modify them for the purpose of the package, so it should be quite rare. In fact the CRAN policy states that a package should always look for an available library first. If we just are talking about libraries then a very rough rule of thumb is that if your dependent library is in Debian then you don't need to ship it as sources.

That said, if you are using something that is not in the current Rtools/recipes then you have to tell CRAN so we can be add it to macOS and Windows toolchains (assuming both are supported by the library you need) - but that doesn't mean you should ship them yourself (in fact that tends to cause a lot more problems).

Cheers,
Simon


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Sat Jul 13 16:04:46 2024
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Sat, 13 Jul 2024 16:04:46 +0200
Subject: [R-pkg-devel] Properly referencing copied code
In-Reply-To: <65BF00D9-1C0F-403F-A221-5A58796E843B@R-project.org>
References: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>
 <20240712110741.5ba1a154@Tarkus>
 <65BF00D9-1C0F-403F-A221-5A58796E843B@R-project.org>
Message-ID: <41e0e9ee-3613-448c-992a-cf11db3b17d3@gmail.com>


On 7/13/24 12:24, Simon Urbanek wrote:
>
>> On 12 Jul 2024, at 10:07, Ivan Krylov via R-package-devel <r-package-devel at r-project.org> wrote:
>>
>> ? Thu, 11 Jul 2024 20:58:53 +0000
>> DRC via R-package-devel <r-package-devel at r-project.org> ?????:
>>
>>> 1. How does linking to external libs differ from providing the source
>>> of a library and linking against that?
>> I think that the author information in the DESCRIPTION is about what your package provides by itself, not everything that may end up in the address space once the package is loaded. Since CRAN prefers self-contained packages, we end up including them in our packages (unless the third-party library is already very common and present in RTools & macOS recipes & common GNU/Linux distros), which requires us to specify their authors.
>>
>
> To clarify: as far as CRAN is concerned you only need to include sources that are otherwise not commonly available - or if you need to modify them for the purpose of the package, so it should be quite rare. In fact the CRAN policy states that a package should always look for an available library first. If we just are talking about libraries then a very rough rule of thumb is that if your dependent library is in Debian then you don't need to ship it as sources.
>
> That said, if you are using something that is not in the current Rtools/recipes then you have to tell CRAN so we can be add it to macOS and Windows toolchains (assuming both are supported by the library you need) - but that doesn't mean you should ship them yourself (in fact that tends to cause a lot more problems).

And you can indeed help with adding such library to Rtools/recipes. In 
case of Rtools, ideally first add it upstream to MXE.

Best
Tomas

>
> Cheers,
> Simon
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From |kry|ov @end|ng |rom d|@root@org  Mon Jul 15 11:11:48 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Mon, 15 Jul 2024 12:11:48 +0300
Subject: [R-pkg-devel] Properly referencing copied code
In-Reply-To: <de459413e13d404a61c1722ad3d19bd7@nilly.addy.io>
References: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>
 <20240712110741.5ba1a154@Tarkus>
 <de459413e13d404a61c1722ad3d19bd7@nilly.addy.io>
Message-ID: <20240715121148.2c43a6dc@arachnoid>

? Fri, 12 Jul 2024 20:17:22 +0000
DRC via R-package-devel <r-package-devel at r-project.org> ?????:

> > Has copyright holders of included software in a [ctb] role only  
> 
> I think I'm being asked to add the cph role to essentially every
> author in addition to [ctb]

That's how I'm reading it too.

> but that doesn't seem to be what the CRAN policy wants

I agree that there does seem to be a conflict, with the policy only
asking to use 'cph' for non-'aut' or 'ctb' copyright holders.

> and I still don't know how to decide who gets both.

Technically, the conflict can be resolved by noting that the CRAN
policy doesn't _prohibit_ using 'cph' for 'aut' or 'ctb' co-authors.
Since both your reviewer and help(person) ask for 'cph' for all
copyright holders, it sounds like all co-authors who wrote any code
should get an additional 'cph'.

It would help if CRAN Policy also said that 'cph' should be used for
all copyright holders.

> Right now there are several people who have explicit copyright over
> certain code so I would think just add cph to all those authors? Or
> just give everyone cph who isn't a minor contributor?

It shouldn't be too wrong to say that if someone wrote a nontrivial line
of code you're including in your package, they are a copyright holder.

This is an important cornerstone of "bazaar-style" development of free
software: if many entities own copyright to parts of a computer
program, no single entity has the right to re-license the whole under a
non-free license. Contrast this with "cathedral-style" development
where every contribution is either accompanied by a copyright transfer
document or rewritten from scratch (e.g. SQLite): this lets the single
owner re-license the code under whatever terms they prefer.

Having said that, if you would like to follow the recommendations of
Simon and Tomas and package some of the third-party code for MXE and
macOS recipes, don't hesitate to ask.

-- 
Best regards,
Ivan


From @@j5xsj9 m@iii@g oii @iiiy@@ddy@io  Mon Jul 15 22:57:28 2024
From: @@j5xsj9 m@iii@g oii @iiiy@@ddy@io (@@j5xsj9 m@iii@g oii @iiiy@@ddy@io)
Date: Mon, 15 Jul 2024 20:57:28 +0000
Subject: [R-pkg-devel] Properly referencing copied code
In-Reply-To: <20240715121148.2c43a6dc@arachnoid>
References: <674a7e3cebc4e094859594fcbfcdc289@nilly.addy.io>
 <20240712110741.5ba1a154@Tarkus>
 <de459413e13d404a61c1722ad3d19bd7@nilly.addy.io>
 <20240715121148.2c43a6dc@arachnoid>
Message-ID: <1e817973f6a86c498960f14ebe2be384@nilly.addy.io>

Thank you everyone, I think this gives me everything I need to know and I have no problem spreading the copyright around.

I'm not sure adding my dependencies to MXE is going to make sense here but open to being convinced otherwise. The package I am working on is wrapping functions from my own simple external C library. I wrote the C lib outside of the R package specifically so it would be possible to integrate the algorithm into multiple high level interfaces (i.e. python, matlab, in addition to R) otherwise the C would have been directly written into the R package. I don't see my lib as something anybody else is likely going to need to link against.

This C lib does depend on igraph though, which is more likely to be useful. However, I don't think it's actually going to be straight forward to add to MXE given how much effort I have had to put into getting it to compile with R and I honestly would rather not be the one who needs to figure out how to do it right. I hope that is understandable given it's pretty clear I am out of my skill set as a biologist and that I am in the last few months of my PhD program and have already exceeded the time I can afford on this side project.

There's a few problems that I think will make igraph difficult to package with MXE based on the challenges I have had with compiling on CRAN's build servers, assuming the environments are similar. 1. It was not possible for me to get igraph to compile correctly using cmake on CRAN builders due to other missing dependencies (including flex which I was previously told I have to pre-generate the resulting C files rather than depend on flex being available which prevents me from using cmake that calls flex itself). This means having to write new build logic instead of depending on the upstream cmake recipe, which is fragile and could break with an update. 2. There are some configuration options which are beneficial to choose based on the current project. Of particularly interest is that the igraph C lib has had to add a `USING_R` macro to modify the behavior in the lib based on whether it is used inside of `R` or not. Since MXE is not specific to R this requires a different build depending on where it's being used. 3. igraph is currently in the process of releasing 1.0.0 and the maintainers have noted there will be breaking changes. Given that it is not yet as mature as other commonly used dependencies, it is safer to use the pinned version shipped with my C lib than depending on a system wide installation.

Even if there is a range of versions I can check for, I would think there would still be a need to ship an appropriate version of igraph with the R package (and therefore still have all the logic needed to build it) in cases where the system's available igraph version is not appropriate, igraph is not compiled in a thread safe manner, or igraph is not compiled for R (which it definitely wouldn't be anywhere not using MXE, i.e. on a Linux computer where `install.packages` will compile the package locally). As such I don't think it makes much sense to try to add it to MXE, especially before determining if there is demand for the lib in CRAN packages.

?- DRC

On Monday, July 15th, 2024 at 4:11 AM, Ivan Krylov 'ikrylov at disroot.org' wrote:

> ? Fri, 12 Jul 2024 20:17:22 +0000
> DRC via R-package-devel r-package-devel at r-project.org ?????:
>
> > > Has copyright holders of included software in a [ctb] role only
> >
> > I think I'm being asked to add the cph role to essentially every
> > author in addition to [ctb]
>
>
> That's how I'm reading it too.
>
> > but that doesn't seem to be what the CRAN policy wants
>
>
> I agree that there does seem to be a conflict, with the policy only
> asking to use 'cph' for non-'aut' or 'ctb' copyright holders.
>
> > and I still don't know how to decide who gets both.
>
>
> Technically, the conflict can be resolved by noting that the CRAN
> policy doesn't prohibit using 'cph' for 'aut' or 'ctb' co-authors.
> Since both your reviewer and help(person) ask for 'cph' for all
> copyright holders, it sounds like all co-authors who wrote any code
> should get an additional 'cph'.
>
> It would help if CRAN Policy also said that 'cph' should be used for
> all copyright holders.
>
> > Right now there are several people who have explicit copyright over
> > certain code so I would think just add cph to all those authors? Or
> > just give everyone cph who isn't a minor contributor?
>
>
> It shouldn't be too wrong to say that if someone wrote a nontrivial line
> of code you're including in your package, they are a copyright holder.
>
> This is an important cornerstone of "bazaar-style" development of free
> software: if many entities own copyright to parts of a computer
> program, no single entity has the right to re-license the whole under a
> non-free license. Contrast this with "cathedral-style" development
> where every contribution is either accompanied by a copyright transfer
> document or rewritten from scratch (e.g. SQLite): this lets the single
> owner re-license the code under whatever terms they prefer.
>
> Having said that, if you would like to follow the recommendations of
> Simon and Tomas and package some of the third-party code for MXE and
> macOS recipes, don't hesitate to ask.
>
> --
> Best regards,
> Ivan


From @|ber@onm|r@nd@ @end|ng |rom hotm@||@com  Wed Jul 17 02:18:17 2024
From: @|ber@onm|r@nd@ @end|ng |rom hotm@||@com (Alberson Miranda)
Date: Tue, 16 Jul 2024 21:18:17 -0300
Subject: [R-pkg-devel] Disable parallelism on installation time
Message-ID: <PH8PR11MB67531D61570D11D4E9319266B9A32@PH8PR11MB6753.namprd11.prod.outlook.com>

Dear listeners,

I'm having a hard time trying to figure out the following NOTE:

|* checking whether package 'fio' can be installed... [202s/46s] NOTE 
Installation took CPU time 4.4 times elapsed time |

Uwe asked if there's code running in parallel by default and, yes, there 
was: my code uses rayon (general parallelism) and faer (linear algebra, 
with rayon feature on) Rust crates. So I did a little refactor and added 
a method to allow the user to specify max threads. Then I started every 
example, tests, vignette and readme by limiting threads to 1 to avoid 
parallelism.

Nonetheless, I still get the NOTE. Finally, out of despair, I've deleted 
vignettes, tests, code on readme and enclosed all examples 
with|\dontrun{}|but that didn't work either.

So my question is, besides examples, tests, vignettes and readme,*what 
parts of code runs during installation of a R package? Is parallelism 
the only trigger for that NOTE or could it be something else?*

Source code is here <https://github.com/albersonmiranda/fio> and there's 
also a SO post with my failed attempts 
<https://stackoverflow.com/questions/78751811/disable-parallelism-on-installation-time> 
in detail.

-- 
Best,
Alberson Miranda

	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Wed Jul 17 10:21:27 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Wed, 17 Jul 2024 11:21:27 +0300
Subject: [R-pkg-devel] Disable parallelism on installation time
In-Reply-To: <PH8PR11MB67531D61570D11D4E9319266B9A32@PH8PR11MB6753.namprd11.prod.outlook.com>
References: <PH8PR11MB67531D61570D11D4E9319266B9A32@PH8PR11MB6753.namprd11.prod.outlook.com>
Message-ID: <20240717112127.56f3b80a@Tarkus>

? Tue, 16 Jul 2024 21:18:17 -0300
Alberson Miranda <albersonmiranda at hotmail.com> ?????:

> besides examples, tests, vignettes and readme, what parts of code
> runs during installation of a R package

Neither. This is about `cargo build` compiling in parallel, not your
package code computing in parallel. Giving the -j 2 flag to cargo
should solve the problem:
https://github.com/R-ArcGIS/arcgisgeocode/blob/8fbd93c3607363a9fef2d445711de647e5127566/src/Makevars#L5

-- 
Best regards,
Ivan


From ch@|n@@wt|ney @end|ng |rom gm@||@com  Wed Jul 17 22:29:25 2024
From: ch@|n@@wt|ney @end|ng |rom gm@||@com (Chung-hong Chan)
Date: Wed, 17 Jul 2024 22:29:25 +0200
Subject: [R-pkg-devel] Disable parallelism on installation time
In-Reply-To: <20240717112127.56f3b80a@Tarkus>
References: <PH8PR11MB67531D61570D11D4E9319266B9A32@PH8PR11MB6753.namprd11.prod.outlook.com>
 <20240717112127.56f3b80a@Tarkus>
Message-ID: <CAHfK2MtoioDud_T_MK6-kjcybkvJ+1V7EaEf=61_1OxQnTt1VQ@mail.gmail.com>

To add to this, I would like to point out that extendr actually has a
guide on how to make an R package with Rust code CRAN compliance.

https://github.com/extendr/rextendr/blob/main/vignettes/articles/cran-compliance.Rmd


On Wed, Jul 17, 2024 at 10:21?AM Ivan Krylov via R-package-devel
<r-package-devel at r-project.org> wrote:
>
> ? Tue, 16 Jul 2024 21:18:17 -0300
> Alberson Miranda <albersonmiranda at hotmail.com> ?????:
>
> > besides examples, tests, vignettes and readme, what parts of code
> > runs during installation of a R package
>
> Neither. This is about `cargo build` compiling in parallel, not your
> package code computing in parallel. Giving the -j 2 flag to cargo
> should solve the problem:
> https://github.com/R-ArcGIS/arcgisgeocode/blob/8fbd93c3607363a9fef2d445711de647e5127566/src/Makevars#L5
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From 10b|||hu@ng01 @end|ng |rom gm@||@com  Wed Jul 17 20:52:53 2024
From: 10b|||hu@ng01 @end|ng |rom gm@||@com (Bill Huang)
Date: Wed, 17 Jul 2024 11:52:53 -0700
Subject: [R-pkg-devel] Fwd: CRAN Submission rkriging 1.0.1
In-Reply-To: <c50978bc-c345-400b-849b-6a8b4cbcfacf@statistik.tu-dortmund.de>
References: <20240713214716.28972A0308@xmpalantir.wu.ac.at>
 <449f1efb-f477-444e-9a49-6f739557da8c@statistik.tu-dortmund.de>
 <CAE-rvCrb_WDvx9exGoUNVTN+A0s51jLq5Gfc-XLRV9M=GKjYYQ@mail.gmail.com>
 <c50978bc-c345-400b-849b-6a8b4cbcfacf@statistik.tu-dortmund.de>
Message-ID: <CAE-rvCoz=NwcFUsB7bXtSxg3ECDk661=XHw-dPES8HZEr5_vJw@mail.gmail.com>

Hi, Team.

I am working on a package that uses RcppEigen. The package can be installed
successfully locally and passed CRAN auto-check. However, it cannot pass
the gcc-UBSAN test with the following error message: a problem with the LLT
function in Eigen. I am not sure how to fix this. Any suggestion or help is
highly appreciated!

rkriging.Rcheck/rkriging-Ex.Rout:/data/gannet/ripley/R/test-dev/RcppEigen/include/Eigen/src/Cholesky/LLT.h:66:49:
runtime error: load of value 20880, which is not a valid value for type
'ComputationInfo'
     #0 0x7f967645dfc6 in Eigen::LLT<Eigen::Matrix<double, -1, -1, 0,
-1, -1>, 1>::operator=(Eigen::LLT<Eigen::Matrix<double, -1, -1, 0, -1,
-1>, 1>&&)
/data/gannet/ripley/R/test-dev/RcppEigen/include/Eigen/src/Cholesky/LLT.h:66
     #1 0x7f967645dfc6 in Kriging::Kriging(Eigen::Matrix<double, -1, -1,
0, -1, -1> const&, Eigen::Matrix<double, -1, 1, 0, -1, 1> const&,
Kernel&, bool const&)
/data/gannet/ripley/R/packages/incoming/rkriging.Rcheck/00_pkg_src/rkriging/src/kriging.cpp:26
     #2 0x7f96769cac53 in
UniversalKriging::UniversalKriging(Eigen::Matrix<double, -1, -1, 0, -1,
-1> const&, Eigen::Matrix<double, -1, 1, 0, -1, 1> const&, Kernel&, bool
const&, unsigned long const&,
Rcpp::Function_Impl<Rcpp::PreserveStorage>)
/data/gannet/ripley/R/packages/incoming/rkriging.Rcheck/00_pkg_src/rkriging/src/kriging.cpp:385
     #3 0x7f9676929f68 in Rcpp::Constructor_6<UniversalKriging,
Eigen::Matrix<double, -1, -1, 0, -1, -1>, Eigen::Matrix<double, -1, 1,
0, -1, 1>, Kernel&, bool, unsigned long,
Rcpp::Function_Impl<Rcpp::PreserveStorage> >::get_new(SEXPREC**, int)
/data/gannet/ripley/R/test-dev/Rcpp/include/Rcpp/module/Module_generated_Constructor.h:115
     #4 0x7f96767c091f in
Rcpp::class_<UniversalKriging>::newInstance(SEXPREC**, int)
/data/gannet/ripley/R/test-dev/Rcpp/include/Rcpp/module/class.h:131
     #5 0x7f967c9d56a8 in class__newInstance(SEXPREC*)
/tmp/Rtmp7QBClZ/R.INSTALL19fb7f3cfc39c8/Rcpp/src/module.cpp:143

Thank you!
Best,
Chaofan

---------- Forwarded message ---------
From: Uwe Ligges <ligges at statistik.tu-dortmund.de>
Date: Tue, Jul 16, 2024 at 2:19?AM
Subject: Re: CRAN Submission rkriging 1.0.1
To: Bill Huang <10billhuang01 at gmail.com>


Please ask on the mailing list <r-package-devel at r-project.org>

Best,
Uwe Ligges


On 16.07.2024 08:32, Bill Huang wrote:
> Hi, Uwe.
>
> Thanks for the message! I am not sure how to resolve this issue. Is
> there anyone you know that might be able to help me on this?
>
> Thank you!
> Best,
> Chaofan
>
> On Mon, Jul 15, 2024 at 11:44?AM Uwe Ligges
> <ligges at statistik.tu-dortmund.de
> <mailto:ligges at statistik.tu-dortmund.de>> wrote:
>
>     Thanks, we still see with gcc-UBSAN
>
>
>
 rkriging.Rcheck/rkriging-Ex.Rout:/data/gannet/ripley/R/test-dev/RcppEigen/include/Eigen/src/Cholesky/LLT.h:66:49:
>     runtime error: load of value 20880, which is not a valid value for
type
>     'ComputationInfo'
>           #0 0x7f967645dfc6 in Eigen::LLT<Eigen::Matrix<double, -1, -1, 0,
>     -1, -1>, 1>::operator=(Eigen::LLT<Eigen::Matrix<double, -1, -1, 0, -1,
>     -1>, 1>&&)
>
 /data/gannet/ripley/R/test-dev/RcppEigen/include/Eigen/src/Cholesky/LLT.h:66
>           #1 0x7f967645dfc6 in Kriging::Kriging(Eigen::Matrix<double,
>     -1, -1,
>     0, -1, -1> const&, Eigen::Matrix<double, -1, 1, 0, -1, 1> const&,
>     Kernel&, bool const&)
>
 /data/gannet/ripley/R/packages/incoming/rkriging.Rcheck/00_pkg_src/rkriging/src/kriging.cpp:26
>           #2 0x7f96769cac53 in
>     UniversalKriging::UniversalKriging(Eigen::Matrix<double, -1, -1, 0,
-1,
>     -1> const&, Eigen::Matrix<double, -1, 1, 0, -1, 1> const&, Kernel&,
>     bool
>     const&, unsigned long const&,
>     Rcpp::Function_Impl<Rcpp::PreserveStorage>)
>
 /data/gannet/ripley/R/packages/incoming/rkriging.Rcheck/00_pkg_src/rkriging/src/kriging.cpp:385
>           #3 0x7f9676929f68 in Rcpp::Constructor_6<UniversalKriging,
>     Eigen::Matrix<double, -1, -1, 0, -1, -1>, Eigen::Matrix<double, -1, 1,
>     0, -1, 1>, Kernel&, bool, unsigned long,
>     Rcpp::Function_Impl<Rcpp::PreserveStorage> >::get_new(SEXPREC**, int)
>
 /data/gannet/ripley/R/test-dev/Rcpp/include/Rcpp/module/Module_generated_Constructor.h:115
>           #4 0x7f96767c091f in
>     Rcpp::class_<UniversalKriging>::newInstance(SEXPREC**, int)
>     /data/gannet/ripley/R/test-dev/Rcpp/include/Rcpp/module/class.h:131
>           #5 0x7f967c9d56a8 in class__newInstance(SEXPREC*)
>     /tmp/Rtmp7QBClZ/R.INSTALL19fb7f3cfc39c8/Rcpp/src/module.cpp:143
>
>
>     Please fix and resubmit.
>
>     Best,
>     Uwe Ligges
>
>
>
>     On 13.07.2024 23:47, CRAN Package Submission Form wrote:
>      >
>      > [This was generated from CRAN.R-project.org/submit.html
>     <http://CRAN.R-project.org/submit.html>]
>      >
>      > The following package was uploaded to CRAN:
>      > ===========================================
>      >
>      > Package Information:
>      > Package: rkriging
>      > Version: 1.0.1
>      > Title: Kriging Modeling
>      > Author(s): Chaofan Huang [aut, cre], V. Roshan Joseph [aut]
>      > Maintainer: Chaofan Huang <10billhuang01 at gmail.com
>     <mailto:10billhuang01 at gmail.com>>
>      > Depends: R (>= 3.0.2)
>      > Description: An 'Eigen'-based computationally efficient 'C++'
>      >    implementation for fitting various kriging models to data.
>      >    This research is supported by U.S. National Science
>      >    Foundation grant DMS-2310637.
>      > License: GPL (>= 2)
>      > Imports: Rcpp, nloptr (>= 1.2.0), methods, stats
>      > LinkingTo: Rcpp, RcppEigen (>= 0.3.3.5.0), BH (>= 1.75.0.0),
>     nloptr (>=
>      >    1.2.0)
>      >
>      >
>      > The maintainer confirms that he or she
>      > has read and agrees to the CRAN policies.
>      >
>      > Submitter's comment: This is the resubmission of the package
>     `rkriging` to
>      >    fix the issue from the CRAN checks. Please see
>      > https://cran.rstudio.com/web/checks/check_results_rkriging.html
>     <https://cran.rstudio.com/web/checks/check_results_rkriging.html>
>      >    for the previous check.
>      >
>      > =================================================
>      >
>      > Original content of DESCRIPTION file:
>      >
>      > Package: rkriging
>      > Type: Package
>      > Title: Kriging Modeling
>      > Version: 1.0.1
>      > Authors at R: c(
>      >      person(given = "Chaofan",
>      >             family = "Huang",
>      >             role = c("aut", "cre"),
>      >             email = "10billhuang01 at gmail.com
>     <mailto:10billhuang01 at gmail.com>"),
>      >      person(given = "V. Roshan",
>      >             family = "Joseph",
>      >             role = c("aut"),
>      >             email = "roshan at gatech.edu <mailto:roshan at gatech.edu>")
>      >      )
>      > Description: An 'Eigen'-based computationally efficient 'C++'
>     implementation for fitting various kriging models to data. This
>     research is supported by U.S. National Science Foundation grant
>     DMS-2310637.
>      > License: GPL (>= 2)
>      > Depends: R (>= 3.0.2)
>      > Imports: Rcpp, nloptr (>= 1.2.0), methods, stats
>      > LinkingTo: Rcpp, RcppEigen (>= 0.3.3.5.0), BH (>= 1.75.0.0),
>     nloptr (>=
>      >          1.2.0)
>      > Encoding: UTF-8
>      > RoxygenNote: 7.1.2
>      > NeedsCompilation: yes
>      > Packaged: 2024-07-13 21:36:19 UTC; billhuang
>      > Author: Chaofan Huang [aut, cre],
>      >    V. Roshan Joseph [aut]
>      > Maintainer: Chaofan Huang <10billhuang01 at gmail.com
>     <mailto:10billhuang01 at gmail.com>>
>      >
>

	[[alternative HTML version deleted]]


From md @end|ng |rom @und@ku@dk  Thu Jul 18 11:16:55 2024
From: md @end|ng |rom @und@ku@dk (Matt Denwood)
Date: Thu, 18 Jul 2024 09:16:55 +0000
Subject: [R-pkg-devel] Disable parallelism on installation time
In-Reply-To: <CAHfK2MtoioDud_T_MK6-kjcybkvJ+1V7EaEf=61_1OxQnTt1VQ@mail.gmail.com>
References: <PH8PR11MB67531D61570D11D4E9319266B9A32@PH8PR11MB6753.namprd11.prod.outlook.com>
 <20240717112127.56f3b80a@Tarkus>
 <CAHfK2MtoioDud_T_MK6-kjcybkvJ+1V7EaEf=61_1OxQnTt1VQ@mail.gmail.com>
Message-ID: <4456FF09-52E8-4401-B886-914ABCB53605@sund.ku.dk>

On the subject of extendr ... the recently published JOSS paper (which also mentions CRAN compliance under the "Creating Rust-powered R packages section") provides a good entry point for those interested in using extendr for their R/Rust packages:  https://joss.theoj.org/papers/10.21105/joss.06394

Best,

Matt


?On 17/07/2024, 22.30, "R-package-devel on behalf of Chung-hong Chan" <r-package-devel-bounces at r-project.org <mailto:r-package-devel-bounces at r-project.org> on behalf of chainsawtiney at gmail.com <mailto:chainsawtiney at gmail.com>> wrote:


[Du f?r ikke ofte mails fra chainsawtiney at gmail.com <mailto:chainsawtiney at gmail.com>. F? mere at vide om, hvorfor dette er vigtigt, p? https://aka.ms/LearnAboutSenderIdentification <https://aka.ms/LearnAboutSenderIdentification> ]


To add to this, I would like to point out that extendr actually has a
guide on how to make an R package with Rust code CRAN compliance.


https://github.com/extendr/rextendr/blob/main/vignettes/articles/cran-compliance.Rmd <https://github.com/extendr/rextendr/blob/main/vignettes/articles/cran-compliance.Rmd>




On Wed, Jul 17, 2024 at 10:21 AM Ivan Krylov via R-package-devel
<r-package-devel at r-project.org <mailto:r-package-devel at r-project.org>> wrote:
>
> ? Tue, 16 Jul 2024 21:18:17 -0300
> Alberson Miranda <albersonmiranda at hotmail.com <mailto:albersonmiranda at hotmail.com>> ?????:
>
> > besides examples, tests, vignettes and readme, what parts of code
> > runs during installation of a R package
>
> Neither. This is about `cargo build` compiling in parallel, not your
> package code computing in parallel. Giving the -j 2 flag to cargo
> should solve the problem:
> https://github.com/R-ArcGIS/arcgisgeocode/blob/8fbd93c3607363a9fef2d445711de647e5127566/src/Makevars#L5 <https://github.com/R-ArcGIS/arcgisgeocode/blob/8fbd93c3607363a9fef2d445711de647e5127566/src/Makevars#L5>
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel <https://stat.ethz.ch/mailman/listinfo/r-package-devel>


______________________________________________
R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel <https://stat.ethz.ch/mailman/listinfo/r-package-devel>




From |kry|ov @end|ng |rom d|@root@org  Thu Jul 18 13:29:03 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Thu, 18 Jul 2024 14:29:03 +0300
Subject: [R-pkg-devel] Fwd: CRAN Submission rkriging 1.0.1
In-Reply-To: <CAE-rvCoz=NwcFUsB7bXtSxg3ECDk661=XHw-dPES8HZEr5_vJw@mail.gmail.com>
References: <20240713214716.28972A0308@xmpalantir.wu.ac.at>
 <449f1efb-f477-444e-9a49-6f739557da8c@statistik.tu-dortmund.de>
 <CAE-rvCrb_WDvx9exGoUNVTN+A0s51jLq5Gfc-XLRV9M=GKjYYQ@mail.gmail.com>
 <c50978bc-c345-400b-849b-6a8b4cbcfacf@statistik.tu-dortmund.de>
 <CAE-rvCoz=NwcFUsB7bXtSxg3ECDk661=XHw-dPES8HZEr5_vJw@mail.gmail.com>
Message-ID: <20240718142903.26bea6e6@arachnoid>

Hi Chaofan and welcome to R-package-devel!

? Wed, 17 Jul 2024 11:52:53 -0700
Bill Huang <10billhuang01 at gmail.com> ?????:

> The package can be installed successfully locally and passed CRAN
> auto-check. However, it cannot pass the gcc-UBSAN test with the
> following error message: a problem with the LLT function in Eigen. I
> am not sure how to fix this.

The problem is detected by special, normally disabled instrumentation
called UBSanitizer [1]. If you don't want to compile R with sanitizers
enabled yourself, ready-made Docker/Podman containers
rocker-org/r-devel-san and rocker-org/r-devel-san-clang [2] (and
others, there are sanitizer containers published by the R-hub
project as well) should help you reproduce the problem.

In this case, I suspect that you stumbled upon a problem in Eigen
itself: the Eigen::LLT constructor does not initialise an enumeration
field, ComputationInfo m_info, which results in the field being
populated by something out of range of the enumeration, which invokes
undefined behaviour.

You can reproduce the problem without building an R package at all:

#include <iostream>
#include <Eigen>

struct foo : Eigen::LLT<Eigen::MatrixXd> {
	foo() : Eigen::LLT<Eigen::MatrixXd>(42) {
		// m_info is protected, hence use of inheritance
		std::cout << m_info << std::endl;
	}
};

int main() {
	foo L;
}

g++ -fsanitize=undefined -g -Og -I $LIBRARY/RcppEigen/include/Eigen \
 -o ex ex.cpp
./ex
# ex.cpp:7:16: runtime error: load of value 32608, which is not a valid
# value for type 'ComputationInfo'
# 32608

A workaround for the problem is to move the initialization of the
Eigen::LLT<Eigen::MatrixXd> Kriging::L_ field from the constructor body
into the member initializer list:

--- rkriging.orig/src/kriging.cpp       2024-07-04 06:45:57.000000000 +0300
+++ rkriging/src/kriging.cpp    2024-07-18 14:10:54.000000000 +0300
@@ -20,10 +20,9 @@
     return kriging->get_nllh(log_lengthscale, nugget);
 }

-Kriging::Kriging(const Eigen::MatrixXd& X, const Eigen::VectorXd& y, Kernel& Ker, const bool& interpolation): n_(X.rows()), p_(X.cols()), X_(X), y_(y), Ker_(Ker), interpolation_(interpolation) {
+Kriging::Kriging(const Eigen::MatrixXd& X, const Eigen::VectorXd& y, Kernel& Ker, const bool& interpolation): n_(X.rows()), p_(X.cols()), X_(X), y_(y), Ker_(Ker), interpolation_(interpolation), L_(n_) {
     a_.resize(n_);
     b_.resize(n_);
-    L_ = Eigen::LLT<Eigen::MatrixXd>(n_);
     y_tss_ = y_.squaredNorm() - std::pow(y_.sum(),2)/n_;
     nugget_ = interpolation_ ? 1e-6 : 1e-3;
     nllh_ = std::numeric_limits<double>::infinity();

This seems to avoid poking the bear of undefined behaviour with
potential copying of invalid enum value in L_ until something
initialises it properly.

I'm not sure whether this is worth reporting to Eigen as something to
fix. I hope that people here with more experience in C++ and Eigen will
be able to answer that question.

-- 
Best regards,
Ivan

[1]
https://cran.r-project.org/doc/manuals/R-exts.html#Using-Undefined-Behaviour-Sanitizer

[2]
https://rocker-project.org/images/base/r-devel.html


From tr@n3 @end|ng |rom kenyon@edu  Thu Jul 18 22:29:57 2024
From: tr@n3 @end|ng |rom kenyon@edu (Khue Tran)
Date: Fri, 19 Jul 2024 06:29:57 +1000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
Message-ID: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>

Hi,

I am trying to create an Rcpp package that involves arbitrary precise
calculations. The function to calculate e^x below with 100 digits precision
works well with integers, but for decimals, since the input is a double,
the result differs a lot from the arbitrary precise result I got on
Wolfram.

I understand the results are different since 0.1 cannot be represented
precisely in binary with limited bits. It is possible to enter 1 then 10
and get the multiprecision division of these two integers to attain a more
precise 0.1 in C++, but this method won't work on a large scale. Thus, I am
looking for a general solution to get more precise inputs?

The dummy example is as follows:

library(Rcpp)

sourceCpp(code = '
#include <boost/multiprecision/cpp_dec_float.hpp>
#include <boost/math/special_functions/expm1.hpp>

// [[Rcpp::depends(BH)]]
// [[Rcpp::export]]
std::string calculateExp100(double x) {
  boost::multiprecision::cpp_dec_float_100 bx = x;
  boost::multiprecision::cpp_dec_float_100 expx = exp(bx);
  return expx.str(50);
}
')

[1] represents the R output and [W] for Wolfram results

calculateExp100(1) # Agrees with Wolfram answer all the way to the last
digit
[1] "2.7182818284590452353602874713526624977572470937"
[W] 2.7182818284590452353602874713526624977572470936999595749669676277...

calculateExp100(0.1) # Differs pretty significantly from Wolfram's answer
[1] "1.1051709180756476309466388234587796577416634163742"
[W] 1.1051709180756476248117078264902466682245471947375187187928632894...

I am currently trying to get precise inputs by taking strings instead of
numbers then writing a function to decompose the string into a rational
with the denominator in the form of 10^(-n) where n is the number of
decimal places. I am not sure if this is the only way or if there is a
better method out there that I do not know of, so if you can think of a
general way to get precise inputs from users, it will be greatly
appreciated!

Thank you!
Best,
Khue Tran

-- 
*Khue B. Tran (she/her/hers)*
tran3 at kenyon.edu | +1 (220) - 203 - 9306 | LinkedIn
<https://www.linkedin.com/in/tranbaokhue/>
Mathematics and Music Double Major, Kenyon College '25

	[[alternative HTML version deleted]]


From toth@dene@ @end|ng |rom kogentum@hu  Fri Jul 19 00:05:00 2024
From: toth@dene@ @end|ng |rom kogentum@hu (=?UTF-8?B?RMOpbmVzIFTDs3Ro?=)
Date: Fri, 19 Jul 2024 00:05:00 +0200
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
Message-ID: <b0f2034b-58f6-aaa0-d777-85f2a67a0c0c@kogentum.hu>

Hi Khue,

Have you already checked the Rmpfr package?: 
https://cran.r-project.org/package=Rmpfr

Best,
Denes


On 7/18/24 22:29, Khue Tran wrote:
> Hi,
> 
> I am trying to create an Rcpp package that involves arbitrary precise
> calculations. The function to calculate e^x below with 100 digits precision
> works well with integers, but for decimals, since the input is a double,
> the result differs a lot from the arbitrary precise result I got on
> Wolfram.
> 
> I understand the results are different since 0.1 cannot be represented
> precisely in binary with limited bits. It is possible to enter 1 then 10
> and get the multiprecision division of these two integers to attain a more
> precise 0.1 in C++, but this method won't work on a large scale. Thus, I am
> looking for a general solution to get more precise inputs?
> 
> The dummy example is as follows:
> 
> library(Rcpp)
> 
> sourceCpp(code = '
> #include <boost/multiprecision/cpp_dec_float.hpp>
> #include <boost/math/special_functions/expm1.hpp>
> 
> // [[Rcpp::depends(BH)]]
> // [[Rcpp::export]]
> std::string calculateExp100(double x) {
>    boost::multiprecision::cpp_dec_float_100 bx = x;
>    boost::multiprecision::cpp_dec_float_100 expx = exp(bx);
>    return expx.str(50);
> }
> ')
> 
> [1] represents the R output and [W] for Wolfram results
> 
> calculateExp100(1) # Agrees with Wolfram answer all the way to the last
> digit
> [1] "2.7182818284590452353602874713526624977572470937"
> [W] 2.7182818284590452353602874713526624977572470936999595749669676277...
> 
> calculateExp100(0.1) # Differs pretty significantly from Wolfram's answer
> [1] "1.1051709180756476309466388234587796577416634163742"
> [W] 1.1051709180756476248117078264902466682245471947375187187928632894...
> 
> I am currently trying to get precise inputs by taking strings instead of
> numbers then writing a function to decompose the string into a rational
> with the denominator in the form of 10^(-n) where n is the number of
> decimal places. I am not sure if this is the only way or if there is a
> better method out there that I do not know of, so if you can think of a
> general way to get precise inputs from users, it will be greatly
> appreciated!
> 
> Thank you!
> Best,
> Khue Tran
>


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Fri Jul 19 00:11:53 2024
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Thu, 18 Jul 2024 18:11:53 -0400 (EDT)
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2407181806590.11778@iridium>


I see there are existing extended precision packages: Ryacas and Rmpfr, 
you might want to take a look at them and their representation of numbers 
with higher precision than a double.

best

Vladimir Dergachev

On Fri, 19 Jul 2024, Khue Tran wrote:

> Hi,
>
> I am trying to create an Rcpp package that involves arbitrary precise
> calculations. The function to calculate e^x below with 100 digits precision
> works well with integers, but for decimals, since the input is a double,
> the result differs a lot from the arbitrary precise result I got on
> Wolfram.
>
> I understand the results are different since 0.1 cannot be represented
> precisely in binary with limited bits. It is possible to enter 1 then 10
> and get the multiprecision division of these two integers to attain a more
> precise 0.1 in C++, but this method won't work on a large scale. Thus, I am
> looking for a general solution to get more precise inputs?


From edd @end|ng |rom deb|@n@org  Fri Jul 19 00:29:43 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 18 Jul 2024 17:29:43 -0500
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
Message-ID: <26265.38743.665001.870966@rob.eddelbuettel.com>


Hi Khue,

On 19 July 2024 at 06:29, Khue Tran wrote:
| I am currently trying to get precise inputs by taking strings instead of
| numbers then writing a function to decompose the string into a rational
| with the denominator in the form of 10^(-n) where n is the number of
| decimal places. I am not sure if this is the only way or if there is a
| better method out there that I do not know of, so if you can think of a
| general way to get precise inputs from users, it will be greatly
| appreciated!

That is one possible way. The constraint really is that the .Call() interface
we use for all [1] extensions to R only knowns SEXP types which map to a
small set of known types: double, int, string, bool, ...  The type used by
the Boost library you are using is not among them, so you have to add code to
map back and forth. Rcpp makes that easier; it is still far from automatic.

R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe that is
good enough?  Also note that Rcpp has a dedicated (low volume and friendly)
mailing list where questions such as this one may be better suited.

Cheers, Dirk

[1] A slight generalisation. There are others but they are less common / not
recommended.

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ro||turner @end|ng |rom po@teo@net  Fri Jul 19 00:45:55 2024
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Thu, 18 Jul 2024 22:45:55 +0000
Subject: [R-pkg-devel] Is winbuilder "offline"?
Message-ID: <20240719104555.56372728@elderly-dell>


I submitted a package to winbuilder, yesterday.  Twice.  No response of
any sort.  Is the system down, for some reason?  Anyone know?  Ta.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From tr@n3 @end|ng |rom kenyon@edu  Fri Jul 19 01:32:14 2024
From: tr@n3 @end|ng |rom kenyon@edu (Khue Tran)
Date: Fri, 19 Jul 2024 09:32:14 +1000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <26265.38743.665001.870966@rob.eddelbuettel.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
Message-ID: <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>

Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
looked into Rmpfr and while the package can interface GNU MPFR with R
smoothly, as of right now, it doesn't have all the functions I need (ie.
eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
precision is still limited by R's default double precision.

Thank you for the note, Dirk. I will keep in mind to send any future
questions regarding Rcpp to the Rcpp-devel mailing list. I understand that
the type used in the Boost library for precision is not one of the types
supported by SEXP, so it will be more complicated to map between the cpp
codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
(and embarking on interfacing Eigen with Rmpfr is not a small task), does
taking input as strings seem like the best option for me to get precise
inputs?

Sincerely,
Khue

On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org> wrote:

>
> Hi Khue,
>
> On 19 July 2024 at 06:29, Khue Tran wrote:
> | I am currently trying to get precise inputs by taking strings instead of
> | numbers then writing a function to decompose the string into a rational
> | with the denominator in the form of 10^(-n) where n is the number of
> | decimal places. I am not sure if this is the only way or if there is a
> | better method out there that I do not know of, so if you can think of a
> | general way to get precise inputs from users, it will be greatly
> | appreciated!
>
> That is one possible way. The constraint really is that the .Call()
> interface
> we use for all [1] extensions to R only knowns SEXP types which map to a
> small set of known types: double, int, string, bool, ...  The type used by
> the Boost library you are using is not among them, so you have to add code
> to
> map back and forth. Rcpp makes that easier; it is still far from automatic.
>
> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe that
> is
> good enough?  Also note that Rcpp has a dedicated (low volume and friendly)
> mailing list where questions such as this one may be better suited.
>
> Cheers, Dirk
>
> [1] A slight generalisation. There are others but they are less common /
> not
> recommended.
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Fri Jul 19 01:50:28 2024
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Fri, 19 Jul 2024 11:50:28 +1200
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
Message-ID: <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>

Khue,


> On 19/07/2024, at 11:32 AM, Khue Tran <tran3 at kenyon.edu> wrote:
> 
> Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
> looked into Rmpfr and while the package can interface GNU MPFR with R
> smoothly, as of right now, it doesn't have all the functions I need (ie.
> eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
> precision is still limited by R's default double precision.
> 


Don't use doubles, use decimal fractions:

> Rmpfr::mpfr(gmp::as.bigq(1,10), 512)
1 'mpfr' number of precision  512   bits 
[1] 0.100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002

As for eigen() - I'm not aware of an arbitrary precision solver, so I think the inputs are your least problem - most tools out there use LAPACK which doesn't support arbitrary precision so your input precision is likely irrelevant in this case.

Cheers,
Simon



> Thank you for the note, Dirk. I will keep in mind to send any future
> questions regarding Rcpp to the Rcpp-devel mailing list. I understand that
> the type used in the Boost library for precision is not one of the types
> supported by SEXP, so it will be more complicated to map between the cpp
> codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
> (and embarking on interfacing Eigen with Rmpfr is not a small task), does
> taking input as strings seem like the best option for me to get precise
> inputs?
> 
> Sincerely,
> Khue
> 
> On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>> 
>> Hi Khue,
>> 
>> On 19 July 2024 at 06:29, Khue Tran wrote:
>> | I am currently trying to get precise inputs by taking strings instead of
>> | numbers then writing a function to decompose the string into a rational
>> | with the denominator in the form of 10^(-n) where n is the number of
>> | decimal places. I am not sure if this is the only way or if there is a
>> | better method out there that I do not know of, so if you can think of a
>> | general way to get precise inputs from users, it will be greatly
>> | appreciated!
>> 
>> That is one possible way. The constraint really is that the .Call()
>> interface
>> we use for all [1] extensions to R only knowns SEXP types which map to a
>> small set of known types: double, int, string, bool, ...  The type used by
>> the Boost library you are using is not among them, so you have to add code
>> to
>> map back and forth. Rcpp makes that easier; it is still far from automatic.
>> 
>> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe that
>> is
>> good enough?  Also note that Rcpp has a dedicated (low volume and friendly)
>> mailing list where questions such as this one may be better suited.
>> 
>> Cheers, Dirk
>> 
>> [1] A slight generalisation. There are others but they are less common /
>> not
>> recommended.
>> 
>> --
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From pro|jcn@@h @end|ng |rom gm@||@com  Fri Jul 19 02:04:01 2024
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Thu, 18 Jul 2024 20:04:01 -0400
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
 <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>
Message-ID: <7e158342-db90-4a7d-933d-a938e1b81883@gmail.com>

On the other hand, Rmpfr did allow me to write an mpfr rootfinder for Martin M. in 2011
(he modified and streamlined it for use) since one can run R codes on mpfr objects
as long as one is careful which operators are applied. So one probably could do
something with a very pedestrian eigenvalue method. One or other of the codes
from my Compact Numerical Methods for Computers might be applicable, but the 1st
edition Step-And-Description codes are likely to be more useful than the Pascal
of the Second Edition. The one-sided Jacobi approach for eigen or svd has a pretty
tiny code. No claims for great efficiency, but in times when loading from floppies
was the order of the day, the short code often got the lowest start to finish elapsed
time.

Best, JN


On 2024-07-18 19:50, Simon Urbanek wrote:
> Khue,
> 
> 
>> On 19/07/2024, at 11:32 AM, Khue Tran <tran3 at kenyon.edu> wrote:
>>
>> Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
>> looked into Rmpfr and while the package can interface GNU MPFR with R
>> smoothly, as of right now, it doesn't have all the functions I need (ie.
>> eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
>> precision is still limited by R's default double precision.
>>
> 
> 
> Don't use doubles, use decimal fractions:
> 
>> Rmpfr::mpfr(gmp::as.bigq(1,10), 512)
> 1 'mpfr' number of precision  512   bits
> [1] 0.100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002
> 
> As for eigen() - I'm not aware of an arbitrary precision solver, so I think the inputs are your least problem - most tools out there use LAPACK which doesn't support arbitrary precision so your input precision is likely irrelevant in this case.
> 
> Cheers,
> Simon
> 
> 
> 
>> Thank you for the note, Dirk. I will keep in mind to send any future
>> questions regarding Rcpp to the Rcpp-devel mailing list. I understand that
>> the type used in the Boost library for precision is not one of the types
>> supported by SEXP, so it will be more complicated to map between the cpp
>> codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
>> (and embarking on interfacing Eigen with Rmpfr is not a small task), does
>> taking input as strings seem like the best option for me to get precise
>> inputs?
>>
>> Sincerely,
>> Khue
>>
>> On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org> wrote:
>>
>>>
>>> Hi Khue,
>>>
>>> On 19 July 2024 at 06:29, Khue Tran wrote:
>>> | I am currently trying to get precise inputs by taking strings instead of
>>> | numbers then writing a function to decompose the string into a rational
>>> | with the denominator in the form of 10^(-n) where n is the number of
>>> | decimal places. I am not sure if this is the only way or if there is a
>>> | better method out there that I do not know of, so if you can think of a
>>> | general way to get precise inputs from users, it will be greatly
>>> | appreciated!
>>>
>>> That is one possible way. The constraint really is that the .Call()
>>> interface
>>> we use for all [1] extensions to R only knowns SEXP types which map to a
>>> small set of known types: double, int, string, bool, ...  The type used by
>>> the Boost library you are using is not among them, so you have to add code
>>> to
>>> map back and forth. Rcpp makes that easier; it is still far from automatic.
>>>
>>> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe that
>>> is
>>> good enough?  Also note that Rcpp has a dedicated (low volume and friendly)
>>> mailing list where questions such as this one may be better suited.
>>>
>>> Cheers, Dirk
>>>
>>> [1] A slight generalisation. There are others but they are less common /
>>> not
>>> recommended.
>>>
>>> --
>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tr@n3 @end|ng |rom kenyon@edu  Fri Jul 19 02:11:46 2024
From: tr@n3 @end|ng |rom kenyon@edu (Khue Tran)
Date: Fri, 19 Jul 2024 10:11:46 +1000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
 <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>
Message-ID: <CAO5FMCwG80c8ZRywt_=8XusfpsZOuc=fh=A4ek1KOV-X65i4dA@mail.gmail.com>

Thank you Simon! This is very helpful! Regarding eigen, I found in the
Boost library the following example for arbitrary precision matrix solver:
https://github.com/boostorg/multiprecision/blob/develop/example/eigen_example.cpp.
I am not sure if the precision is fully preserved throughout the process,
but this example motivated me to try coding with the Boost library.

Best,
Khue Tran

On Fri, Jul 19, 2024 at 9:50?AM Simon Urbanek <simon.urbanek at r-project.org>
wrote:

> Khue,
>
>
> > On 19/07/2024, at 11:32 AM, Khue Tran <tran3 at kenyon.edu> wrote:
> >
> > Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
> > looked into Rmpfr and while the package can interface GNU MPFR with R
> > smoothly, as of right now, it doesn't have all the functions I need (ie.
> > eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
> > precision is still limited by R's default double precision.
> >
>
>
> Don't use doubles, use decimal fractions:
>
> > Rmpfr::mpfr(gmp::as.bigq(1,10), 512)
> 1 'mpfr' number of precision  512   bits
> [1]
> 0.100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002
>
> As for eigen() - I'm not aware of an arbitrary precision solver, so I
> think the inputs are your least problem - most tools out there use LAPACK
> which doesn't support arbitrary precision so your input precision is likely
> irrelevant in this case.
>
> Cheers,
> Simon
>
>
>
> > Thank you for the note, Dirk. I will keep in mind to send any future
> > questions regarding Rcpp to the Rcpp-devel mailing list. I understand
> that
> > the type used in the Boost library for precision is not one of the types
> > supported by SEXP, so it will be more complicated to map between the cpp
> > codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
> > (and embarking on interfacing Eigen with Rmpfr is not a small task), does
> > taking input as strings seem like the best option for me to get precise
> > inputs?
> >
> > Sincerely,
> > Khue
> >
> > On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org>
> wrote:
> >
> >>
> >> Hi Khue,
> >>
> >> On 19 July 2024 at 06:29, Khue Tran wrote:
> >> | I am currently trying to get precise inputs by taking strings instead
> of
> >> | numbers then writing a function to decompose the string into a
> rational
> >> | with the denominator in the form of 10^(-n) where n is the number of
> >> | decimal places. I am not sure if this is the only way or if there is a
> >> | better method out there that I do not know of, so if you can think of
> a
> >> | general way to get precise inputs from users, it will be greatly
> >> | appreciated!
> >>
> >> That is one possible way. The constraint really is that the .Call()
> >> interface
> >> we use for all [1] extensions to R only knowns SEXP types which map to a
> >> small set of known types: double, int, string, bool, ...  The type used
> by
> >> the Boost library you are using is not among them, so you have to add
> code
> >> to
> >> map back and forth. Rcpp makes that easier; it is still far from
> automatic.
> >>
> >> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe
> that
> >> is
> >> good enough?  Also note that Rcpp has a dedicated (low volume and
> friendly)
> >> mailing list where questions such as this one may be better suited.
> >>
> >> Cheers, Dirk
> >>
> >> [1] A slight generalisation. There are others but they are less common /
> >> not
> >> recommended.
> >>
> >> --
> >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
>

	[[alternative HTML version deleted]]


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Fri Jul 19 04:14:36 2024
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Thu, 18 Jul 2024 22:14:36 -0400 (EDT)
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCwG80c8ZRywt_=8XusfpsZOuc=fh=A4ek1KOV-X65i4dA@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
 <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>
 <CAO5FMCwG80c8ZRywt_=8XusfpsZOuc=fh=A4ek1KOV-X65i4dA@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2407182214170.11778@iridium>


Do you need to run eigen() on an arbitrary matrix or symmetric one ?

best

Vladimir Dergachev

On Fri, 19 Jul 2024, Khue Tran wrote:

> Thank you Simon! This is very helpful! Regarding eigen, I found in the
> Boost library the following example for arbitrary precision matrix solver:
> https://github.com/boostorg/multiprecision/blob/develop/example/eigen_example.cpp.
> I am not sure if the precision is fully preserved throughout the process,
> but this example motivated me to try coding with the Boost library.
>
> Best,
> Khue Tran
>
> On Fri, Jul 19, 2024 at 9:50?AM Simon Urbanek <simon.urbanek at r-project.org>
> wrote:
>
>> Khue,
>>
>>
>>> On 19/07/2024, at 11:32 AM, Khue Tran <tran3 at kenyon.edu> wrote:
>>>
>>> Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
>>> looked into Rmpfr and while the package can interface GNU MPFR with R
>>> smoothly, as of right now, it doesn't have all the functions I need (ie.
>>> eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
>>> precision is still limited by R's default double precision.
>>>
>>
>>
>> Don't use doubles, use decimal fractions:
>>
>>> Rmpfr::mpfr(gmp::as.bigq(1,10), 512)
>> 1 'mpfr' number of precision  512   bits
>> [1]
>> 0.100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002
>>
>> As for eigen() - I'm not aware of an arbitrary precision solver, so I
>> think the inputs are your least problem - most tools out there use LAPACK
>> which doesn't support arbitrary precision so your input precision is likely
>> irrelevant in this case.
>>
>> Cheers,
>> Simon
>>
>>
>>
>>> Thank you for the note, Dirk. I will keep in mind to send any future
>>> questions regarding Rcpp to the Rcpp-devel mailing list. I understand
>> that
>>> the type used in the Boost library for precision is not one of the types
>>> supported by SEXP, so it will be more complicated to map between the cpp
>>> codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
>>> (and embarking on interfacing Eigen with Rmpfr is not a small task), does
>>> taking input as strings seem like the best option for me to get precise
>>> inputs?
>>>
>>> Sincerely,
>>> Khue
>>>
>>> On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org>
>> wrote:
>>>
>>>>
>>>> Hi Khue,
>>>>
>>>> On 19 July 2024 at 06:29, Khue Tran wrote:
>>>> | I am currently trying to get precise inputs by taking strings instead
>> of
>>>> | numbers then writing a function to decompose the string into a
>> rational
>>>> | with the denominator in the form of 10^(-n) where n is the number of
>>>> | decimal places. I am not sure if this is the only way or if there is a
>>>> | better method out there that I do not know of, so if you can think of
>> a
>>>> | general way to get precise inputs from users, it will be greatly
>>>> | appreciated!
>>>>
>>>> That is one possible way. The constraint really is that the .Call()
>>>> interface
>>>> we use for all [1] extensions to R only knowns SEXP types which map to a
>>>> small set of known types: double, int, string, bool, ...  The type used
>> by
>>>> the Boost library you are using is not among them, so you have to add
>> code
>>>> to
>>>> map back and forth. Rcpp makes that easier; it is still far from
>> automatic.
>>>>
>>>> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe
>> that
>>>> is
>>>> good enough?  Also note that Rcpp has a dedicated (low volume and
>> friendly)
>>>> mailing list where questions such as this one may be better suited.
>>>>
>>>> Cheers, Dirk
>>>>
>>>> [1] A slight generalisation. There are others but they are less common /
>>>> not
>>>> recommended.
>>>>
>>>> --
>>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>>
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

From tr@n3 @end|ng |rom kenyon@edu  Fri Jul 19 04:37:34 2024
From: tr@n3 @end|ng |rom kenyon@edu (Khue Tran)
Date: Fri, 19 Jul 2024 12:37:34 +1000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <alpine.DEB.2.22.394.2407182214170.11778@iridium>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
 <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>
 <CAO5FMCwG80c8ZRywt_=8XusfpsZOuc=fh=A4ek1KOV-X65i4dA@mail.gmail.com>
 <alpine.DEB.2.22.394.2407182214170.11778@iridium>
Message-ID: <CAO5FMCytebCchErYfTwoRGqda+5GkkfGQpWbLDakFTeHHY8zeA@mail.gmail.com>

I will need to run eigen() on a symmetric matrix, but I want to get
arbitrary precise eigenvalues since we will need those eigenvalues for our
further calculations. Does that make sense?

Best,
Khue Tran

On Fri, Jul 19, 2024 at 12:14?PM Vladimir Dergachev <volodya at mindspring.com>
wrote:

>
> Do you need to run eigen() on an arbitrary matrix or symmetric one ?
>
> best
>
> Vladimir Dergachev
>
> On Fri, 19 Jul 2024, Khue Tran wrote:
>
> > Thank you Simon! This is very helpful! Regarding eigen, I found in the
> > Boost library the following example for arbitrary precision matrix
> solver:
> >
> https://github.com/boostorg/multiprecision/blob/develop/example/eigen_example.cpp
> .
> > I am not sure if the precision is fully preserved throughout the process,
> > but this example motivated me to try coding with the Boost library.
> >
> > Best,
> > Khue Tran
> >
> > On Fri, Jul 19, 2024 at 9:50?AM Simon Urbanek <
> simon.urbanek at r-project.org>
> > wrote:
> >
> >> Khue,
> >>
> >>
> >>> On 19/07/2024, at 11:32 AM, Khue Tran <tran3 at kenyon.edu> wrote:
> >>>
> >>> Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
> >>> looked into Rmpfr and while the package can interface GNU MPFR with R
> >>> smoothly, as of right now, it doesn't have all the functions I need
> (ie.
> >>> eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(),
> the
> >>> precision is still limited by R's default double precision.
> >>>
> >>
> >>
> >> Don't use doubles, use decimal fractions:
> >>
> >>> Rmpfr::mpfr(gmp::as.bigq(1,10), 512)
> >> 1 'mpfr' number of precision  512   bits
> >> [1]
> >>
> 0.100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002
> >>
> >> As for eigen() - I'm not aware of an arbitrary precision solver, so I
> >> think the inputs are your least problem - most tools out there use
> LAPACK
> >> which doesn't support arbitrary precision so your input precision is
> likely
> >> irrelevant in this case.
> >>
> >> Cheers,
> >> Simon
> >>
> >>
> >>
> >>> Thank you for the note, Dirk. I will keep in mind to send any future
> >>> questions regarding Rcpp to the Rcpp-devel mailing list. I understand
> >> that
> >>> the type used in the Boost library for precision is not one of the
> types
> >>> supported by SEXP, so it will be more complicated to map between the
> cpp
> >>> codes and R. Given Rmpfr doesn't provide all necessary mpfr
> calculations
> >>> (and embarking on interfacing Eigen with Rmpfr is not a small task),
> does
> >>> taking input as strings seem like the best option for me to get precise
> >>> inputs?
> >>>
> >>> Sincerely,
> >>> Khue
> >>>
> >>> On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org>
> >> wrote:
> >>>
> >>>>
> >>>> Hi Khue,
> >>>>
> >>>> On 19 July 2024 at 06:29, Khue Tran wrote:
> >>>> | I am currently trying to get precise inputs by taking strings
> instead
> >> of
> >>>> | numbers then writing a function to decompose the string into a
> >> rational
> >>>> | with the denominator in the form of 10^(-n) where n is the number of
> >>>> | decimal places. I am not sure if this is the only way or if there
> is a
> >>>> | better method out there that I do not know of, so if you can think
> of
> >> a
> >>>> | general way to get precise inputs from users, it will be greatly
> >>>> | appreciated!
> >>>>
> >>>> That is one possible way. The constraint really is that the .Call()
> >>>> interface
> >>>> we use for all [1] extensions to R only knowns SEXP types which map
> to a
> >>>> small set of known types: double, int, string, bool, ...  The type
> used
> >> by
> >>>> the Boost library you are using is not among them, so you have to add
> >> code
> >>>> to
> >>>> map back and forth. Rcpp makes that easier; it is still far from
> >> automatic.
> >>>>
> >>>> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe
> >> that
> >>>> is
> >>>> good enough?  Also note that Rcpp has a dedicated (low volume and
> >> friendly)
> >>>> mailing list where questions such as this one may be better suited.
> >>>>
> >>>> Cheers, Dirk
> >>>>
> >>>> [1] A slight generalisation. There are others but they are less
> common /
> >>>> not
> >>>> recommended.
> >>>>
> >>>> --
> >>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >>>>
> >>>
> >>>       [[alternative HTML version deleted]]
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>
> >>
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >

	[[alternative HTML version deleted]]


From vo|ody@ @end|ng |rom m|nd@pr|ng@com  Fri Jul 19 07:17:44 2024
From: vo|ody@ @end|ng |rom m|nd@pr|ng@com (Vladimir Dergachev)
Date: Fri, 19 Jul 2024 01:17:44 -0400 (EDT)
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCytebCchErYfTwoRGqda+5GkkfGQpWbLDakFTeHHY8zeA@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
 <531C6F01-064D-4647-9951-FB493959FE82@R-project.org>
 <CAO5FMCwG80c8ZRywt_=8XusfpsZOuc=fh=A4ek1KOV-X65i4dA@mail.gmail.com>
 <alpine.DEB.2.22.394.2407182214170.11778@iridium>
 <CAO5FMCytebCchErYfTwoRGqda+5GkkfGQpWbLDakFTeHHY8zeA@mail.gmail.com>
Message-ID: <alpine.DEB.2.22.394.2407190111100.11778@iridium>



On Fri, 19 Jul 2024, Khue Tran wrote:

> I will need to run eigen() on a symmetric matrix, but I want to get arbitrary precise eigenvalues since we will need those eigenvalues for our further calculations. Does that make sense?

For a symmetric matrix there is a nice algorithm that is simple to 
implement and that converges fairly fast.

What you do is find the largest in absolute value off-diagonal entry.

The you construct 2x2 rotation matrix that zeros it: A --> R A R^-1, where 
R is a rotation matrix. The rotation matrix has mostly 1's on the main 
diagonal except for rows and columns of the large off-diagonal entry.

Repeat the procedure until the off-diagonal entries are as small as you 
want.

Because you are picking the largest value every time the algorithm is 
fairly stable.

The only disadvantage is that this algorithm plays havoc with sparse 
matrices by creating too many new non-zero entries, so for those you need 
to use a different method.

best

Vladimir Dergachev

> Best,
> Khue Tran
> 
> On Fri, Jul 19, 2024 at 12:14?PM Vladimir Dergachev <volodya at mindspring.com> wrote:
>
>       Do you need to run eigen() on an arbitrary matrix or symmetric one ?
>
>       best
>
>       Vladimir Dergachev
>
>       On Fri, 19 Jul 2024, Khue Tran wrote:
>
>       > Thank you Simon! This is very helpful! Regarding eigen, I found in the
>       > Boost library the following example for arbitrary precision matrix solver:
>       > https://github.com/boostorg/multiprecision/blob/develop/example/eigen_example.cpp.
>       > I am not sure if the precision is fully preserved throughout the process,
>       > but this example motivated me to try coding with the Boost library.
>       >
>       > Best,
>       > Khue Tran
>       >
>       > On Fri, Jul 19, 2024 at 9:50?AM Simon Urbanek <simon.urbanek at r-project.org>
>       > wrote:
>       >
>       >> Khue,
>       >>
>       >>
>       >>> On 19/07/2024, at 11:32 AM, Khue Tran <tran3 at kenyon.edu> wrote:
>       >>>
>       >>> Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
>       >>> looked into Rmpfr and while the package can interface GNU MPFR with R
>       >>> smoothly, as of right now, it doesn't have all the functions I need (ie.
>       >>> eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
>       >>> precision is still limited by R's default double precision.
>       >>>
>       >>
>       >>
>       >> Don't use doubles, use decimal fractions:
>       >>
>       >>> Rmpfr::mpfr(gmp::as.bigq(1,10), 512)
>       >> 1 'mpfr' number of precision? 512? ?bits
>       >> [1]
>       >> 0.100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002
>       >>
>       >> As for eigen() - I'm not aware of an arbitrary precision solver, so I
>       >> think the inputs are your least problem - most tools out there use LAPACK
>       >> which doesn't support arbitrary precision so your input precision is likely
>       >> irrelevant in this case.
>       >>
>       >> Cheers,
>       >> Simon
>       >>
>       >>
>       >>
>       >>> Thank you for the note, Dirk. I will keep in mind to send any future
>       >>> questions regarding Rcpp to the Rcpp-devel mailing list. I understand
>       >> that
>       >>> the type used in the Boost library for precision is not one of the types
>       >>> supported by SEXP, so it will be more complicated to map between the cpp
>       >>> codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
>       >>> (and embarking on interfacing Eigen with Rmpfr is not a small task), does
>       >>> taking input as strings seem like the best option for me to get precise
>       >>> inputs?
>       >>>
>       >>> Sincerely,
>       >>> Khue
>       >>>
>       >>> On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org>
>       >> wrote:
>       >>>
>       >>>>
>       >>>> Hi Khue,
>       >>>>
>       >>>> On 19 July 2024 at 06:29, Khue Tran wrote:
>       >>>> | I am currently trying to get precise inputs by taking strings instead
>       >> of
>       >>>> | numbers then writing a function to decompose the string into a
>       >> rational
>       >>>> | with the denominator in the form of 10^(-n) where n is the number of
>       >>>> | decimal places. I am not sure if this is the only way or if there is a
>       >>>> | better method out there that I do not know of, so if you can think of
>       >> a
>       >>>> | general way to get precise inputs from users, it will be greatly
>       >>>> | appreciated!
>       >>>>
>       >>>> That is one possible way. The constraint really is that the .Call()
>       >>>> interface
>       >>>> we use for all [1] extensions to R only knowns SEXP types which map to a
>       >>>> small set of known types: double, int, string, bool, ...? The type used
>       >> by
>       >>>> the Boost library you are using is not among them, so you have to add
>       >> code
>       >>>> to
>       >>>> map back and forth. Rcpp makes that easier; it is still far from
>       >> automatic.
>       >>>>
>       >>>> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe
>       >> that
>       >>>> is
>       >>>> good enough?? Also note that Rcpp has a dedicated (low volume and
>       >> friendly)
>       >>>> mailing list where questions such as this one may be better suited.
>       >>>>
>       >>>> Cheers, Dirk
>       >>>>
>       >>>> [1] A slight generalisation. There are others but they are less common /
>       >>>> not
>       >>>> recommended.
>       >>>>
>       >>>> --
>       >>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>       >>>>
>       >>>
>       >>>? ? ? ?[[alternative HTML version deleted]]
>       >>>
>       >>> ______________________________________________
>       >>> R-package-devel at r-project.org mailing list
>       >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>       >>>
>       >>
>       >>
>       >
>       >? ? ? ?[[alternative HTML version deleted]]
>       >
>       > ______________________________________________
>       > R-package-devel at r-project.org mailing list
>       > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>       >
> 
> 
>

From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Fri Jul 19 10:18:27 2024
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Fri, 19 Jul 2024 10:18:27 +0200
Subject: [R-pkg-devel] Is winbuilder "offline"?
In-Reply-To: <20240719104555.56372728@elderly-dell>
References: <20240719104555.56372728@elderly-dell>
Message-ID: <27902d41-bf5e-46c6-9c89-61c0837ececc@statistik.tu-dortmund.de>

Not that I know, which queue do you mean?

Best,
Uwe

On 19.07.2024 00:45, Rolf Turner wrote:
> 
> I submitted a package to winbuilder, yesterday.  Twice.  No response of
> any sort.  Is the system down, for some reason?  Anyone know?  Ta.
> 
> cheers,
> 
> Rolf Turner
> 

From m@rc_@chw@rtz @end|ng |rom me@com  Fri Jul 19 16:49:31 2024
From: m@rc_@chw@rtz @end|ng |rom me@com (Marc Schwartz)
Date: Fri, 19 Jul 2024 10:49:31 -0400
Subject: [R-pkg-devel] RTools 4.x Perl Incompatibility with WriteXLS CRAN
 Package
Message-ID: <16CE0E19-EA42-40EA-90CF-D733375FC203@me.com>

Hi All,

I recently became aware of what appears to be some kind of incompatibility between the Perl distribution that is included in the RTools 4.4 distribution and my WriteXLS package on CRAN, running R 4.4.1. As far as I can tell, since the vast majority of the users of my package, which requires Perl, are running standard Perl installations, that is native OS, Strawberry Perl or Active State Perl, this appears to be something of a unique issue. 

It is not clear to me what the root cause of the problem is, and whether it is the RTools Perl binary itself and/or any of the other related components that are included in RTools, if this is specific to RTools, or may be an upstream issue from MSYS2. Thus, before I think about going down the rabbit hole, I am wondering if anyone has any intuitive guidance on this issue.

I was also a bit confused by this, as my aging memory recalled that the old Vanilla Perl had been removed from RTools many years ago circa R 2.x.y, so presume that there was motivation to reintroduce Perl in recent versions of RTools.

I have been able to largely replicate the problem on my MacBook Pro, running a Windows 11 VM under Parallels on macOS 14.5, and confirmed a workaround using a current Strawberry Perl installation for Windows on the same system. 

The initial report was from a user running Windows 10 on a native Intel based PC, with R 4.4.1 and RTools 4.4 installed, and they reported the following error:

> WriteXLS::WriteXLS(iris, "test.xlsx", verbose=T)
Creating Temporary Directory for CSV Files:  C:\Users\Kleinbub\AppData\Local\Temp\RtmpuO4911/WriteXLS 

Creating CSV File: 1.csv
Creating SheetNames.txt

perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LC_ALL = (unset),
	LANG = "en"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
. No such file or directory\Kleinbub\AppData\Local\Temp\RtmpuO4911/WriteXLS/1.csv
Creating Excel File: C:\Users\Kleinbub\Documents\test.xlsx

Reading: C:\Users\Kleinbub\AppData\Local\Temp\RtmpuO4911/WriteXLS/1.csv
The Perl script 'WriteXLSX.pl' failed to run successfully.
Cleaning Up Temporary Files and Directory


The basic workflow steps are that my R code wrapper function writes a CSV file containing the 'iris' dataframe into a temporary directory, my Perl script then reads in and parses that CSV file. and creates the Excel file using the relevant Perl packages included. The 'verbose = TRUE' setting outputs some additional diagnostic messages.

Note above that there are some warnings regarding locale settings from Perl, which I could not replicate on my Windows VM, albeit I can replicate the key error and failure of the Perl script as indicated.

If I run the same test code on my Windows 11 VM system, I get the following, including the initial testing function, which points to Perl in RTools:

> testPerl()
A system perl installation found in C:\rtools44\usr\bin\perl.exe

The perl modules included with WriteXLS are located in C:/Users/marcschwartz/AppData/Local/R/win-library/4.4/WriteXLS/Perl

All required Perl modules were found.

> WriteXLS(iris, "test.xlsx")
ERROR: cannot open C:\Users\MARCSC~1\AppData\Local\Temp\RtmpmKwGGX/WriteXLS/1.csv
. No such file or directory
The Perl script 'WriteXLSX.pl' failed to run successfully.


Note that I do not get the locale warnings, and this does not appear to be a permissions issue, but the Perl script still fails after indicating the inability to find the CSV file in the temporary directory.

With a Strawberry Perl installation in place, and explicitly pointing WriteXLS() to that Perl binary, I get a successful creation of the Excel file:

> WriteXLS(iris, "test.xlsx", perl = "C:\\Strawberry\\perl\\bin\\perl")
> 
> WriteXLS(iris, "test.xlsx", perl = "C:/Strawberry/perl/bin/perl")
>


Thus, I am confused as to the source of the incompatibility, and may be missing some nuances regarding the Perl binary and related components in RTools.

Any thoughts/pointers would be appreciated. 

Thank you,

Marc Schwartz


From |kry|ov @end|ng |rom d|@root@org  Fri Jul 19 17:18:24 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Fri, 19 Jul 2024 18:18:24 +0300
Subject: [R-pkg-devel] 
 RTools 4.x Perl Incompatibility with WriteXLS CRAN Package
In-Reply-To: <16CE0E19-EA42-40EA-90CF-D733375FC203@me.com>
References: <16CE0E19-EA42-40EA-90CF-D733375FC203@me.com>
Message-ID: <20240719181824.2d9bfb08@arachnoid>

Dear Marc Schwartz,

? Fri, 19 Jul 2024 10:49:31 -0400
Marc Schwartz <marc_schwartz at me.com> ?????:

> . No such file or
> directory\Kleinbub\AppData\Local\Temp\RtmpuO4911/WriteXLS/1.csv

This looks like an extra carriage return has messed up the output.
By debugging WriteXLS and running the command line manually with perl
-d, I can confirm this:

main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:135):
135:    my @FileNames = "";
  DB<3>
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:136):
136:    open (DFHANDLE, $Encode, "$CSVPath/FileNames.txt") || die
        "ERROR: cannot open $CSVPath/FileNames.txt. $!\n";
  DB<3>
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:137):
137:    @FileNames = <DFHANDLE>;
  DB<3>
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:138):
138:    close DFHANDLE;
  DB<3> x \@FileNames
0  ARRAY(0xa005e3c08)
   0  "C:\\rtools44\\tmp\\Rtmpg9BxFb/WriteXLS/1.csv\cM\cJ"
  DB<4> n
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:141):
141:    chomp(@FileNames);
  DB<4> n
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:302):
302:    foreach my $FileName (@FileNames) {
  DB<4> x \@FileNames
0  ARRAY(0xa005e3c08)
   0  "C:\\rtools44\\tmp\\Rtmpg9BxFb/WriteXLS/1.csv\cM"

Since the R code always uses a text-mode connection with WriteLines,
it always results in CR-LF line endings on Windows. The difference must
be in the default PerlIO layers applied by Strawberry Perl by default.
MSYS is based on Cygwin, which does its best to pretend to be an
Unix-like environment, so it's reasonable for an MSYS build of Perl to
default to LF line endings. But that means special-casing the MSYS
build of Perl:

  DB<5> x $Encode
0  '<:encoding(utf8)'
  DB<6> x $^O
0  'msys'

...and adding $Encode .= ":crlf" if $^O eq 'msys'; somewhere.

-- 
Best regards,
Ivan


From m@rc_@chw@rtz @end|ng |rom me@com  Fri Jul 19 18:06:02 2024
From: m@rc_@chw@rtz @end|ng |rom me@com (Marc Schwartz)
Date: Fri, 19 Jul 2024 12:06:02 -0400
Subject: [R-pkg-devel] 
 RTools 4.x Perl Incompatibility with WriteXLS CRAN Package
In-Reply-To: <20240719181824.2d9bfb08@arachnoid>
References: <16CE0E19-EA42-40EA-90CF-D733375FC203@me.com>
 <20240719181824.2d9bfb08@arachnoid>
Message-ID: <4468F3A0-9EDE-4D6F-B104-03176D0EE614@me.com>

Hi Ivan,

Thanks kindly for your expedient reply and pointer to the LF/CRLF issue. Not sure that I would have found that issue so quickly, so was hoping for some intuition here, as you have provided.

Thanks!

Regards,

Marc


?-----Original Message-----
From: Ivan Krylov <ikrylov at disroot.org <mailto:ikrylov at disroot.org>>
Date: Friday, July 19, 2024 at 11:18 AM
To: Marc Schwartz <marc_schwartz at me.com <mailto:marc_schwartz at me.com>>
Cc: <r-package-devel at r-project.org <mailto:r-package-devel at r-project.org>>
Subject: Re: [R-pkg-devel] RTools 4.x Perl Incompatibility with WriteXLS CRAN Package


Dear Marc Schwartz,


? Fri, 19 Jul 2024 10:49:31 -0400
Marc Schwartz <marc_schwartz at me.com <mailto:marc_schwartz at me.com>> ?????:


> . No such file or
> directory\Kleinbub\AppData\Local\Temp\RtmpuO4911/WriteXLS/1.csv


This looks like an extra carriage return has messed up the output.
By debugging WriteXLS and running the command line manually with perl
-d, I can confirm this:


main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:135):
135: my @FileNames = "";
DB<3>
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:136):
136: open (DFHANDLE, $Encode, "$CSVPath/FileNames.txt") || die
"ERROR: cannot open $CSVPath/FileNames.txt. $!\n";
DB<3>
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:137):
137: @FileNames = <DFHANDLE>;
DB<3>
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:138):
138: close DFHANDLE;
DB<3> x \@FileNames
0 ARRAY(0xa005e3c08)
0 "C:\\rtools44\\tmp\\Rtmpg9BxFb/WriteXLS/1.csv\cM\cJ"
DB<4> n
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:141):
141: chomp(@FileNames);
DB<4> n
main::(C:/Users/redacted/AppData/Local/R/win-library/4.5/WriteXLS/Perl/WriteXLS.pl:302):
302: foreach my $FileName (@FileNames) {
DB<4> x \@FileNames
0 ARRAY(0xa005e3c08)
0 "C:\\rtools44\\tmp\\Rtmpg9BxFb/WriteXLS/1.csv\cM"


Since the R code always uses a text-mode connection with WriteLines,
it always results in CR-LF line endings on Windows. The difference must
be in the default PerlIO layers applied by Strawberry Perl by default.
MSYS is based on Cygwin, which does its best to pretend to be an
Unix-like environment, so it's reasonable for an MSYS build of Perl to
default to LF line endings. But that means special-casing the MSYS
build of Perl:


DB<5> x $Encode
0 '<:encoding(utf8)'
DB<6> x $^O
0 'msys'


...and adding $Encode .= ":crlf" if $^O eq 'msys'; somewhere.


-- 
Best regards,
Ivan


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Jul 19 18:37:38 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 19 Jul 2024 18:37:38 +0200
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
Message-ID: <26266.38482.694054.230749@stat.math.ethz.ch>

>>>>> Khue Tran 
>>>>>     on Fri, 19 Jul 2024 09:32:14 +1000 writes:

    > Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
    > looked into Rmpfr and while the package can interface GNU MPFR with R
    > smoothly, as of right now, it doesn't have all the functions I need (ie.
    > eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
    > precision is still limited by R's default double precision.

Well, it depends *how* you input 0.1:
the double precision representation of 0.1 is *NOT* the same as
mathematically 1/10 and it cannot be.

What you really want is either

mpfr(0.1, 100) # 100 as an example ... to get a more precise
	       # version of the '0.1' (double prec).

## *or*, e.g.,

1 / mpfr(10, 100) # which is a more accurate approximation to
                  # the mathematical fraction 1/10

## if you really want that, I'd also recommend truly exact fractions

require(gmp)
as.bigq(1, 10) # or equivalently

1 / as.bigz(10) # which automatically makes an exact fraction

    > Thank you for the note, Dirk. I will keep in mind to send any future
    > questions regarding Rcpp to the Rcpp-devel mailing list. I understand that
    > the type used in the Boost library for precision is not one of the types
    > supported by SEXP, so it will be more complicated to map between the cpp
    > codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
    > (and embarking on interfacing Eigen with Rmpfr is not a small task), does
    > taking input as strings seem like the best option for me to get precise
    > inputs?

almost surely (that's also what you can do in Rmpfr)..

Martin


    > Sincerely,
    > Khue

    > On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org> wrote:

    >> 
    >> Hi Khue,
    >> 
    >> On 19 July 2024 at 06:29, Khue Tran wrote:
    >> | I am currently trying to get precise inputs by taking strings instead of
    >> | numbers then writing a function to decompose the string into a rational
    >> | with the denominator in the form of 10^(-n) where n is the number of
    >> | decimal places. I am not sure if this is the only way or if there is a
    >> | better method out there that I do not know of, so if you can think of a
    >> | general way to get precise inputs from users, it will be greatly
    >> | appreciated!
    >> 
    >> That is one possible way. The constraint really is that the .Call()
    >> interface
    >> we use for all [1] extensions to R only knowns SEXP types which map to a
    >> small set of known types: double, int, string, bool, ...  The type used by
    >> the Boost library you are using is not among them, so you have to add code
    >> to
    >> map back and forth. Rcpp makes that easier; it is still far from automatic.
    >> 
    >> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe that
    >> is
    >> good enough?  Also note that Rcpp has a dedicated (low volume and friendly)
    >> mailing list where questions such as this one may be better suited.
    >> 
    >> Cheers, Dirk
    >> 
    >> [1] A slight generalisation. There are others but they are less common /
    >> not
    >> recommended.
    >> 
    >> --
    >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
    >> 

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Jul 19 18:52:43 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 19 Jul 2024 12:52:43 -0400
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <26266.38482.694054.230749@stat.math.ethz.ch>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <26265.38743.665001.870966@rob.eddelbuettel.com>
 <CAO5FMCyDgtQ0N9yN80VtLaW_7cWcgYiA3GiHm4F-hEdWd_duyQ@mail.gmail.com>
 <26266.38482.694054.230749@stat.math.ethz.ch>
Message-ID: <d9f83e1b-d74e-4943-842f-d0ff090a90dc@gmail.com>

On 2024-07-19 12:37 p.m., Martin Maechler wrote:
>>>>>> Khue Tran
>>>>>>      on Fri, 19 Jul 2024 09:32:14 +1000 writes:
> 
>      > Thank you for the suggestion, Denes, Vladimir, and Dirk. I have indeed
>      > looked into Rmpfr and while the package can interface GNU MPFR with R
>      > smoothly, as of right now, it doesn't have all the functions I need (ie.
>      > eigen for mpfr class) and when one input decimals, say 0.1 to mpfr(), the
>      > precision is still limited by R's default double precision.
> 
> Well, it depends *how* you input 0.1:
> the double precision representation of 0.1 is *NOT* the same as
> mathematically 1/10 and it cannot be.
> 
> What you really want is either
> 
> mpfr(0.1, 100) # 100 as an example ... to get a more precise
> 	       # version of the '0.1' (double prec).
> 
> ## *or*, e.g.,
> 
> 1 / mpfr(10, 100) # which is a more accurate approximation to
>                    # the mathematical fraction 1/10

It seems like mpfr("0.1", 100) works pretty well.  I'd assume it does 
the parsing, rather than parse 0.1 to the closest double, and convert that.

Duncan Murdoch


> 
> ## if you really want that, I'd also recommend truly exact fractions
> 
> require(gmp)
> as.bigq(1, 10) # or equivalently
> 
> 1 / as.bigz(10) # which automatically makes an exact fraction
> 
>      > Thank you for the note, Dirk. I will keep in mind to send any future
>      > questions regarding Rcpp to the Rcpp-devel mailing list. I understand that
>      > the type used in the Boost library for precision is not one of the types
>      > supported by SEXP, so it will be more complicated to map between the cpp
>      > codes and R. Given Rmpfr doesn't provide all necessary mpfr calculations
>      > (and embarking on interfacing Eigen with Rmpfr is not a small task), does
>      > taking input as strings seem like the best option for me to get precise
>      > inputs?
> 
> almost surely (that's also what you can do in Rmpfr)..
> 
> Martin
> 
> 
>      > Sincerely,
>      > Khue
> 
>      > On Fri, Jul 19, 2024 at 8:29?AM Dirk Eddelbuettel <edd at debian.org> wrote:
> 
>      >>
>      >> Hi Khue,
>      >>
>      >> On 19 July 2024 at 06:29, Khue Tran wrote:
>      >> | I am currently trying to get precise inputs by taking strings instead of
>      >> | numbers then writing a function to decompose the string into a rational
>      >> | with the denominator in the form of 10^(-n) where n is the number of
>      >> | decimal places. I am not sure if this is the only way or if there is a
>      >> | better method out there that I do not know of, so if you can think of a
>      >> | general way to get precise inputs from users, it will be greatly
>      >> | appreciated!
>      >>
>      >> That is one possible way. The constraint really is that the .Call()
>      >> interface
>      >> we use for all [1] extensions to R only knowns SEXP types which map to a
>      >> small set of known types: double, int, string, bool, ...  The type used by
>      >> the Boost library you are using is not among them, so you have to add code
>      >> to
>      >> map back and forth. Rcpp makes that easier; it is still far from automatic.
>      >>
>      >> R has packages such as Rmpfr interfacing GNU MPFR based on GMP. Maybe that
>      >> is
>      >> good enough?  Also note that Rcpp has a dedicated (low volume and friendly)
>      >> mailing list where questions such as this one may be better suited.
>      >>
>      >> Cheers, Dirk
>      >>
>      >> [1] A slight generalisation. There are others but they are less common /
>      >> not
>      >> recommended.
>      >>
>      >> --
>      >> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>      >>
> 
>      > [[alternative HTML version deleted]]
> 
>      > ______________________________________________
>      > R-package-devel at r-project.org mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Jul 19 20:40:20 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 19 Jul 2024 14:40:20 -0400
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
Message-ID: <ea0d9f72-3a21-41a7-ac0e-1263b41691bb@gmail.com>

Just for your info:

 > exp(mpfr("0.1", 152))
1 'mpfr' number of precision  152   bits
[1] 1.1051709180756476248117078264902466682245471948

So it looks like your approach of parsing the numbers yourself makes sense.

You can find the R parser here: 
https://github.com/wch/r-source/blob/b64422334a8269535718efd9a1f969c94b103056/src/main/gram.y#L2577-L2705

I don't know how much of that you want to replicate, but I suppose 
handling the weird cases (e.g. 0x1p1) the way R does will make it easier 
for your users.

Duncan Murdoch

On 2024-07-18 4:29 p.m., Khue Tran wrote:
> Hi,
> 
> I am trying to create an Rcpp package that involves arbitrary precise
> calculations. The function to calculate e^x below with 100 digits precision
> works well with integers, but for decimals, since the input is a double,
> the result differs a lot from the arbitrary precise result I got on
> Wolfram.
> 
> I understand the results are different since 0.1 cannot be represented
> precisely in binary with limited bits. It is possible to enter 1 then 10
> and get the multiprecision division of these two integers to attain a more
> precise 0.1 in C++, but this method won't work on a large scale. Thus, I am
> looking for a general solution to get more precise inputs?
> 
> The dummy example is as follows:
> 
> library(Rcpp)
> 
> sourceCpp(code = '
> #include <boost/multiprecision/cpp_dec_float.hpp>
> #include <boost/math/special_functions/expm1.hpp>
> 
> // [[Rcpp::depends(BH)]]
> // [[Rcpp::export]]
> std::string calculateExp100(double x) {
>    boost::multiprecision::cpp_dec_float_100 bx = x;
>    boost::multiprecision::cpp_dec_float_100 expx = exp(bx);
>    return expx.str(50);
> }
> ')
> 
> [1] represents the R output and [W] for Wolfram results
> 
> calculateExp100(1) # Agrees with Wolfram answer all the way to the last
> digit
> [1] "2.7182818284590452353602874713526624977572470937"
> [W] 2.7182818284590452353602874713526624977572470936999595749669676277...
> 
> calculateExp100(0.1) # Differs pretty significantly from Wolfram's answer
> [1] "1.1051709180756476309466388234587796577416634163742"
> [W] 1.1051709180756476248117078264902466682245471947375187187928632894...
> 
> I am currently trying to get precise inputs by taking strings instead of
> numbers then writing a function to decompose the string into a rational
> with the denominator in the form of 10^(-n) where n is the number of
> decimal places. I am not sure if this is the only way or if there is a
> better method out there that I do not know of, so if you can think of a
> general way to get precise inputs from users, it will be greatly
> appreciated!
> 
> Thank you!
> Best,
> Khue Tran
>


From ro||turner @end|ng |rom po@teo@net  Sat Jul 20 01:52:55 2024
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Fri, 19 Jul 2024 23:52:55 +0000
Subject: [R-pkg-devel] Is winbuilder "offline"?
In-Reply-To: <27902d41-bf5e-46c6-9c89-61c0837ececc@statistik.tu-dortmund.de>
References: <20240719104555.56372728@elderly-dell>
 <27902d41-bf5e-46c6-9c89-61c0837ececc@statistik.tu-dortmund.de>
Message-ID: <20240720115255.3ba90495@elderly-dell>


On Fri, 19 Jul 2024 10:18:27 +0200
Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:

> Not that I know, which queue do you mean?

Apologies for my ignorance but I don't understand the question.  I did
not choose a "queue".  I simply (as I have always done in the past)
pointed my browser at https://win-builder.r-project.org/ .

I then clicked on "upload page" which took me
to https://win-builder.r-project.org/upload.aspx .  I then clicked on
"Browse" under "R-release", chose the file to upload
(kanova_0.1-4.tar.gz) and clicked on "Upload File".   There were no
indications of any problems.  I waited for an email from winbuilder,
but this never came.

What am I missing?

cheers,

Rolf

P.S. Is "R-release" the queue in question?

R.

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Sat Jul 20 06:20:00 2024
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Sat, 20 Jul 2024 06:20:00 +0200
Subject: [R-pkg-devel] Is winbuilder "offline"?
In-Reply-To: <20240720115255.3ba90495@elderly-dell>
References: <20240719104555.56372728@elderly-dell>
 <27902d41-bf5e-46c6-9c89-61c0837ececc@statistik.tu-dortmund.de>
 <20240720115255.3ba90495@elderly-dell>
Message-ID: <28bde5dc-a111-4eed-b22a-895523480083@statistik.tu-dortmund.de>



On 20.07.2024 01:52, Rolf Turner wrote:
> 
> On Fri, 19 Jul 2024 10:18:27 +0200
> Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
> 
>> Not that I know, which queue do you mean?
> 
> Apologies for my ignorance but I don't understand the question.  I did
> not choose a "queue".  I simply (as I have always done in the past)
> pointed my browser at https://win-builder.r-project.org/ .
> 
> I then clicked on "upload page" which took me
> to https://win-builder.r-project.org/upload.aspx .  I then clicked on
> "Browse" under "R-release", chose the file to upload
> (kanova_0.1-4.tar.gz) and clicked on "Upload File".   There were no
> indications of any problems.  I waited for an email from winbuilder,
> but this never came.

Strange. Your package has been processed. Have you tried again?
Are you sure the maintainer address is specified correctly and that the 
auto generated message did not make it onto your spam box?

If it still does not work, please send me the tarball and I'll take a look.

Best,
Uwe


> 
> What am I missing?
> 
> cheers,
> 
> Rolf
> 
> P.S. Is "R-release" the queue in question?
> 
> R.
> 

From |eo@m@d@ @end|ng |rom @yon|c@eu  Sun Jul 21 00:06:24 2024
From: |eo@m@d@ @end|ng |rom @yon|c@eu (Leo Mada)
Date: Sat, 20 Jul 2024 22:06:24 +0000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
Message-ID: <DBAP192MB0956582F13062AB28D8A432984AE2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>

Dear Khue,

As mentioned before, you can use Rmpfr to read in strings or compute higher precision values, like

x = mpfr(1, 192) /10;
# 0.1 with 192 bits precision
# or x = mpfr("0.1", 192);

mpfr(1, 192) /10 - mpfr("0.1", 192)
# 1 'mpfr' number of precision  192   bits
# [1] 0

However, I do not know how easy it is to convert from the mpfr format to the other format. Maybe the BH-team can add an mpfr constructor to the library.

On a somewhat related topic, I did implement a very basic solver in native R (and based on Rmpfr). You can have a look on GitHub; it is not a package, but the script should be self-contained:
https://github.com/discoleo/R/blob/master/Math/Polynomials.Helper.Matrix.mpfr.R

It is very basic - more like a proof of concept. It does not include any advanced tricks and there is quit some drop of precision in some examples, see:
https://github.com/discoleo/R/blob/master/Math/Polynomials.Helper.mpfr.Tests.R

I was primarily interested in solving systems of polynomial equations (including complex roots); but did not have time to finish the remaining work. Extending the algorithm to solve for eigenvalues may be feasible (although I was less interested in eigenvalues). A native implementation in C++ would be faster; but I try to avoid any more complicated programming if it is not absolutely essential!

Sincerely,

Leonard


	[[alternative HTML version deleted]]


From ro||turner @end|ng |rom po@teo@net  Sun Jul 21 03:05:32 2024
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sun, 21 Jul 2024 01:05:32 +0000
Subject: [R-pkg-devel] Is winbuilder "offline"?
In-Reply-To: <28bde5dc-a111-4eed-b22a-895523480083@statistik.tu-dortmund.de>
References: <20240719104555.56372728@elderly-dell>
 <27902d41-bf5e-46c6-9c89-61c0837ececc@statistik.tu-dortmund.de>
 <20240720115255.3ba90495@elderly-dell>
 <28bde5dc-a111-4eed-b22a-895523480083@statistik.tu-dortmund.de>
Message-ID: <20240721130532.723e978f@elderly-dell>

On Sat, 20 Jul 2024 06:20:00 +0200
Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:

> 
> Strange. Your package has been processed. Have you tried again?
> Are you sure the maintainer address is specified correctly and that
> the auto generated message did not make it onto your spam box?
> 
> If it still does not work, please send me the tarball and I'll take a
> look.

Thanks Uwe.  The messages (I tried three times!) were indeed in my
spam box.  This mystifies me; i.e. I have no idea how the messages got
there.  I have many "filters" defined for my email client that move
messages satisfying various patterns into my spam box.  But I cannot see
how the autogenerated messages would match any of the specified
patterns.

Be that as it may, I have made a few adjustments (in accordance with
the NOTEs that I saw) and have resubmitted the package to winbuilder.
At least I now know to check my spam box!

Thanks again.

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From tr@n3 @end|ng |rom kenyon@edu  Mon Jul 22 01:39:15 2024
From: tr@n3 @end|ng |rom kenyon@edu (Khue Tran)
Date: Mon, 22 Jul 2024 09:39:15 +1000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <DBAP192MB0956582F13062AB28D8A432984AE2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
References: <DBAP192MB0956582F13062AB28D8A432984AE2@DBAP192MB0956.EURP192.PROD.OUTLOOK.COM>
Message-ID: <CAO5FMCw5ne=08Lfm1ZLuPyk=pX7MRh24-LBC=C15DeUTvQ8A8g@mail.gmail.com>

Dear Leonard,

Thank you so much for the detailed response! Indeed, it would be nice to
have it included in the BH header. Thank you for sharing your codes with
me, I will definitely take a look at them to see if I can apply them to my
case. I was steering away from mpfr type for a while since they were
creating issues for linkage between C++ and R, but if I can get them to
work in R to avoid complications, I might try that!

Thank you again!

Best,
Khue Tran

On Sun, Jul 21, 2024 at 8:06?AM Leo Mada <leo.mada at syonic.eu> wrote:

> Dear Khue,
>
> As mentioned before, you can use Rmpfr to read in strings or compute
> higher precision values, like
>
> x = mpfr(1, 192) /10;
> # 0.1 with 192 bits precision
> # or x = mpfr("0.1", 192);
>
> mpfr(1, 192) /10 - mpfr("0.1", 192)
> # 1 'mpfr' number of precision  192   bits
> # [1] 0
>
> However, I do not know how easy it is to convert from the mpfr format to
> the other format. Maybe the BH-team can add an mpfr constructor to the
> library.
>
> On a somewhat related topic, I did implement a very basic solver in native
> R (and based on Rmpfr). You can have a look on GitHub; it is not a package,
> but the script should be self-contained:
>
> https://github.com/discoleo/R/blob/master/Math/Polynomials.Helper.Matrix.mpfr.R
>
> It is very basic - more like a proof of concept. It does not include any
> advanced tricks and there is quit some drop of precision in some examples,
> see:
>
> https://github.com/discoleo/R/blob/master/Math/Polynomials.Helper.mpfr.Tests.R
>
> I was primarily interested in solving systems of polynomial equations
> (including complex roots); but did not have time to finish the remaining
> work. Extending the algorithm to solve for eigenvalues may be feasible
> (although I was less interested in eigenvalues). A native implementation in
> C++ would be faster; but I try to avoid any more complicated programming if
> it is not absolutely essential!
>
> Sincerely,
>
> Leonard
>
>

	[[alternative HTML version deleted]]


From tr@n3 @end|ng |rom kenyon@edu  Mon Jul 22 01:56:03 2024
From: tr@n3 @end|ng |rom kenyon@edu (Khue Tran)
Date: Mon, 22 Jul 2024 09:56:03 +1000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <ea0d9f72-3a21-41a7-ac0e-1263b41691bb@gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <ea0d9f72-3a21-41a7-ac0e-1263b41691bb@gmail.com>
Message-ID: <CAO5FMCw9QfzU0m7x_sE8E_8YzdJURrXvjxg5SnONM=Gsy65+=A@mail.gmail.com>

Thank you Prof. Maechler! Indeed 0.1 is not the same as 1/10 and there are
many ways to get more precise versions of it. I will look into how to take
inputs as strings. Thank you!

Best,
Khue Tran

On Sat, Jul 20, 2024 at 4:40?AM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> Just for your info:
>
>  > exp(mpfr("0.1", 152))
> 1 'mpfr' number of precision  152   bits
> [1] 1.1051709180756476248117078264902466682245471948
>
> So it looks like your approach of parsing the numbers yourself makes sense.
>
> You can find the R parser here:
>
> https://github.com/wch/r-source/blob/b64422334a8269535718efd9a1f969c94b103056/src/main/gram.y#L2577-L2705
>
> I don't know how much of that you want to replicate, but I suppose
> handling the weird cases (e.g. 0x1p1) the way R does will make it easier
> for your users.
>
> Duncan Murdoch
>
> On 2024-07-18 4:29 p.m., Khue Tran wrote:
> > Hi,
> >
> > I am trying to create an Rcpp package that involves arbitrary precise
> > calculations. The function to calculate e^x below with 100 digits
> precision
> > works well with integers, but for decimals, since the input is a double,
> > the result differs a lot from the arbitrary precise result I got on
> > Wolfram.
> >
> > I understand the results are different since 0.1 cannot be represented
> > precisely in binary with limited bits. It is possible to enter 1 then 10
> > and get the multiprecision division of these two integers to attain a
> more
> > precise 0.1 in C++, but this method won't work on a large scale. Thus, I
> am
> > looking for a general solution to get more precise inputs?
> >
> > The dummy example is as follows:
> >
> > library(Rcpp)
> >
> > sourceCpp(code = '
> > #include <boost/multiprecision/cpp_dec_float.hpp>
> > #include <boost/math/special_functions/expm1.hpp>
> >
> > // [[Rcpp::depends(BH)]]
> > // [[Rcpp::export]]
> > std::string calculateExp100(double x) {
> >    boost::multiprecision::cpp_dec_float_100 bx = x;
> >    boost::multiprecision::cpp_dec_float_100 expx = exp(bx);
> >    return expx.str(50);
> > }
> > ')
> >
> > [1] represents the R output and [W] for Wolfram results
> >
> > calculateExp100(1) # Agrees with Wolfram answer all the way to the last
> > digit
> > [1] "2.7182818284590452353602874713526624977572470937"
> > [W] 2.7182818284590452353602874713526624977572470936999595749669676277...
> >
> > calculateExp100(0.1) # Differs pretty significantly from Wolfram's answer
> > [1] "1.1051709180756476309466388234587796577416634163742"
> > [W] 1.1051709180756476248117078264902466682245471947375187187928632894...
> >
> > I am currently trying to get precise inputs by taking strings instead of
> > numbers then writing a function to decompose the string into a rational
> > with the denominator in the form of 10^(-n) where n is the number of
> > decimal places. I am not sure if this is the only way or if there is a
> > better method out there that I do not know of, so if you can think of a
> > general way to get precise inputs from users, it will be greatly
> > appreciated!
> >
> > Thank you!
> > Best,
> > Khue Tran
> >
>
>

	[[alternative HTML version deleted]]


From tr@n3 @end|ng |rom kenyon@edu  Mon Jul 22 01:57:09 2024
From: tr@n3 @end|ng |rom kenyon@edu (Khue Tran)
Date: Mon, 22 Jul 2024 09:57:09 +1000
Subject: [R-pkg-devel] How to get arbitrary precise inputs from R for an
 Rcpp package?
In-Reply-To: <ea0d9f72-3a21-41a7-ac0e-1263b41691bb@gmail.com>
References: <CAO5FMCwOm=0UmSAhJeqbTtg9PasHjNrmtGMQO2DAupEL1ewinQ@mail.gmail.com>
 <ea0d9f72-3a21-41a7-ac0e-1263b41691bb@gmail.com>
Message-ID: <CAO5FMCyzNbatWVVqi8sOJ4yupffdv=Qc_VreenR3X9oSsFYGHA@mail.gmail.com>

Thank you Duncan for providing detailed information on parsing in R. I will
check it out and utilize the string inputs for my functions.

Best regards,
Khue Tran

On Sat, Jul 20, 2024 at 4:40?AM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> Just for your info:
>
>  > exp(mpfr("0.1", 152))
> 1 'mpfr' number of precision  152   bits
> [1] 1.1051709180756476248117078264902466682245471948
>
> So it looks like your approach of parsing the numbers yourself makes sense.
>
> You can find the R parser here:
>
> https://github.com/wch/r-source/blob/b64422334a8269535718efd9a1f969c94b103056/src/main/gram.y#L2577-L2705
>
> I don't know how much of that you want to replicate, but I suppose
> handling the weird cases (e.g. 0x1p1) the way R does will make it easier
> for your users.
>
> Duncan Murdoch
>
> On 2024-07-18 4:29 p.m., Khue Tran wrote:
> > Hi,
> >
> > I am trying to create an Rcpp package that involves arbitrary precise
> > calculations. The function to calculate e^x below with 100 digits
> precision
> > works well with integers, but for decimals, since the input is a double,
> > the result differs a lot from the arbitrary precise result I got on
> > Wolfram.
> >
> > I understand the results are different since 0.1 cannot be represented
> > precisely in binary with limited bits. It is possible to enter 1 then 10
> > and get the multiprecision division of these two integers to attain a
> more
> > precise 0.1 in C++, but this method won't work on a large scale. Thus, I
> am
> > looking for a general solution to get more precise inputs?
> >
> > The dummy example is as follows:
> >
> > library(Rcpp)
> >
> > sourceCpp(code = '
> > #include <boost/multiprecision/cpp_dec_float.hpp>
> > #include <boost/math/special_functions/expm1.hpp>
> >
> > // [[Rcpp::depends(BH)]]
> > // [[Rcpp::export]]
> > std::string calculateExp100(double x) {
> >    boost::multiprecision::cpp_dec_float_100 bx = x;
> >    boost::multiprecision::cpp_dec_float_100 expx = exp(bx);
> >    return expx.str(50);
> > }
> > ')
> >
> > [1] represents the R output and [W] for Wolfram results
> >
> > calculateExp100(1) # Agrees with Wolfram answer all the way to the last
> > digit
> > [1] "2.7182818284590452353602874713526624977572470937"
> > [W] 2.7182818284590452353602874713526624977572470936999595749669676277...
> >
> > calculateExp100(0.1) # Differs pretty significantly from Wolfram's answer
> > [1] "1.1051709180756476309466388234587796577416634163742"
> > [W] 1.1051709180756476248117078264902466682245471947375187187928632894...
> >
> > I am currently trying to get precise inputs by taking strings instead of
> > numbers then writing a function to decompose the string into a rational
> > with the denominator in the form of 10^(-n) where n is the number of
> > decimal places. I am not sure if this is the only way or if there is a
> > better method out there that I do not know of, so if you can think of a
> > general way to get precise inputs from users, it will be greatly
> > appreciated!
> >
> > Thank you!
> > Best,
> > Khue Tran
> >
>
>

	[[alternative HTML version deleted]]


From jo@|@h@p@rry @end|ng |rom gm@||@com  Tue Jul 23 18:19:59 2024
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Tue, 23 Jul 2024 12:19:59 -0400
Subject: [R-pkg-devel] MSRV on Fedora
Message-ID: <CAL3ufU+th=_fS4Wkh7FDSfK_V1d_8KaRjZj4HC_1RoUw55WU6Q@mail.gmail.com>

Hi all!

I have 2 errors related to minimum supported rust version (MSRV) on fedora
https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-fedora-clang/rsgeo-00install.html
that I do not know how to resolve.

The package {rsgeo} has a dependency on the rust crate geo which itself has
a dependency on geographiclib-rs which has an MSRV of 1.70 whereas the CRAN
fedora machines are 1.69.

As such, I cannot manage the MSRV of the package's dependencies.

As an alternative, can I indicate in my DESCRIPTION that the package is not
supported on Fedora so that CRAN machines do not attempt to build it? I
would be a-okay saying if you're using fedora you have to build from
source.

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Jul 23 20:39:49 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 23 Jul 2024 14:39:49 -0400
Subject: [R-pkg-devel] MSRV on Fedora
In-Reply-To: <CAL3ufU+th=_fS4Wkh7FDSfK_V1d_8KaRjZj4HC_1RoUw55WU6Q@mail.gmail.com>
References: <CAL3ufU+th=_fS4Wkh7FDSfK_V1d_8KaRjZj4HC_1RoUw55WU6Q@mail.gmail.com>
Message-ID: <168b8263-1744-4462-bb97-ff1e93f5b5c8@gmail.com>

I think saying that Fedora is not supported is the wrong solution, 
unless you know that Rust version 1.70 will never be supported on 
Fedora.  Isn't the appropriate solution to document the MSRV in the 
SystemRequirements field of your DESCRIPTION file?

When you submit, point out that you have done this in your submission 
comments.  I don't think a Fedora failure will cause a submission to be 
automatically rejected, but the CRAN reviewers may want to know if you 
have dealt with the error, and you should explain that this is what 
you've done.

Duncan Murdoch



On 2024-07-23 12:19 p.m., Josiah Parry wrote:
> Hi all!
> 
> I have 2 errors related to minimum supported rust version (MSRV) on fedora
> https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-fedora-clang/rsgeo-00install.html
> that I do not know how to resolve.
> 
> The package {rsgeo} has a dependency on the rust crate geo which itself has
> a dependency on geographiclib-rs which has an MSRV of 1.70 whereas the CRAN
> fedora machines are 1.69.
> 
> As such, I cannot manage the MSRV of the package's dependencies.
> 
> As an alternative, can I indicate in my DESCRIPTION that the package is not
> supported on Fedora so that CRAN machines do not attempt to build it? I
> would be a-okay saying if you're using fedora you have to build from
> source.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Wed Jul 24 01:26:24 2024
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Wed, 24 Jul 2024 08:26:24 +0900
Subject: [R-pkg-devel] MSRV on Fedora
In-Reply-To: <CAL3ufU+th=_fS4Wkh7FDSfK_V1d_8KaRjZj4HC_1RoUw55WU6Q@mail.gmail.com>
References: <CAL3ufU+th=_fS4Wkh7FDSfK_V1d_8KaRjZj4HC_1RoUw55WU6Q@mail.gmail.com>
Message-ID: <CALyqOb8Yen-hwBYofJZ_RZWG_tdUhg8v13+9rmdc28ZTOwcKQA@mail.gmail.com>

> As such, I cannot manage the MSRV of the package's dependencies.

It seems the reason for geographiclib-rs's MSRV is just that it uses
std::sync::OnceLock. Maybe a possible workaround is to fork the repo and
replace it with the once_cell crate? You should be able to override the
dependency by [patch.crates-io] section.

Best,
Yutani

2024?7?24?(?) 1:20 Josiah Parry <josiah.parry at gmail.com>:

> Hi all!
>
> I have 2 errors related to minimum supported rust version (MSRV) on fedora
>
> https://www.r-project.org/nosvn/R.check/r-devel-linux-x86_64-fedora-clang/rsgeo-00install.html
> that I do not know how to resolve.
>
> The package {rsgeo} has a dependency on the rust crate geo which itself has
> a dependency on geographiclib-rs which has an MSRV of 1.70 whereas the CRAN
> fedora machines are 1.69.
>
> As such, I cannot manage the MSRV of the package's dependencies.
>
> As an alternative, can I indicate in my DESCRIPTION that the package is not
> supported on Fedora so that CRAN machines do not attempt to build it? I
> would be a-okay saying if you're using fedora you have to build from
> source.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From jo@|@h@p@rry @end|ng |rom gm@||@com  Sun Jul 28 19:48:21 2024
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Sun, 28 Jul 2024 13:48:21 -0400
Subject: [R-pkg-devel] R CMD BATCH plot output
Message-ID: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>

Hey folks! I am working with R CMD BATCH and providing a providing a
logfile output e.g.

R CMD BATCH main.R 2024-07-28.log

This creates the desired log file with the contents of stdout and stderr.

However, if plots are generated in the process, the plots are stored in
Rplots.pdf.

Is there a way via command line arguments to change the name of the pdf
output.

There might be multiple runs of this script and it would be ideal to store
the plot output independently.

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Jul 28 21:44:41 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 28 Jul 2024 15:44:41 -0400
Subject: [R-pkg-devel] R CMD BATCH plot output
In-Reply-To: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
References: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
Message-ID: <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>

On 2024-07-28 1:48 p.m., Josiah Parry wrote:
> Hey folks! I am working with R CMD BATCH and providing a providing a
> logfile output e.g.
> 
> R CMD BATCH main.R 2024-07-28.log
> 
> This creates the desired log file with the contents of stdout and stderr.
> 
> However, if plots are generated in the process, the plots are stored in
> Rplots.pdf.
> 
> Is there a way via command line arguments to change the name of the pdf
> output.
> 
> There might be multiple runs of this script and it would be ideal to store
> the plot output independently.

That's the default filename if you open a PDF device.  Open it 
explicitly and you can specify any file you like.

That is,

   plot(rnorm(100))

will call dev.new() which in a non-interactive session calls pdf().  If 
you specify

   dev.new(file = "something.pdf")
   plot(rnorm(100))

the "file" argument will be ignored in an interactive session, but will 
be used in a non-interactive one.

Duncan Murdoch


From jo@|@h@p@rry @end|ng |rom gm@||@com  Sun Jul 28 22:05:10 2024
From: jo@|@h@p@rry @end|ng |rom gm@||@com (Josiah Parry)
Date: Sun, 28 Jul 2024 16:05:10 -0400
Subject: [R-pkg-devel] R CMD BATCH plot output
In-Reply-To: <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
References: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
 <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
Message-ID: <CAL3ufU+LANOhv_V7S4OWUbFunjkB6OH4VUYmDWf143cPov6L9Q@mail.gmail.com>

Thanks, Duncan!

Is there a way to override this using the command line arguments?

I'd like to be able to have a generalizable way to address this without
having to modify R source code.

My understanding is that when there is a plot output, R CMD BATCH uses the
PDF device which is a fair default.

However, there is not any use of `dev.new()` or `pdf()` called anywhere in
the code.

On Sun, Jul 28, 2024 at 3:44?PM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 2024-07-28 1:48 p.m., Josiah Parry wrote:
> > Hey folks! I am working with R CMD BATCH and providing a providing a
> > logfile output e.g.
> >
> > R CMD BATCH main.R 2024-07-28.log
> >
> > This creates the desired log file with the contents of stdout and stderr.
> >
> > However, if plots are generated in the process, the plots are stored in
> > Rplots.pdf.
> >
> > Is there a way via command line arguments to change the name of the pdf
> > output.
> >
> > There might be multiple runs of this script and it would be ideal to
> store
> > the plot output independently.
>
> That's the default filename if you open a PDF device.  Open it
> explicitly and you can specify any file you like.
>
> That is,
>
>    plot(rnorm(100))
>
> will call dev.new() which in a non-interactive session calls pdf().  If
> you specify
>
>    dev.new(file = "something.pdf")
>    plot(rnorm(100))
>
> the "file" argument will be ignored in an interactive session, but will
> be used in a non-interactive one.
>
> Duncan Murdoch
>
>
>

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Sun Jul 28 22:14:58 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sun, 28 Jul 2024 16:14:58 -0400
Subject: [R-pkg-devel] R CMD BATCH plot output
In-Reply-To: <CAL3ufU+LANOhv_V7S4OWUbFunjkB6OH4VUYmDWf143cPov6L9Q@mail.gmail.com>
References: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
 <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
 <CAL3ufU+LANOhv_V7S4OWUbFunjkB6OH4VUYmDWf143cPov6L9Q@mail.gmail.com>
Message-ID: <CABghstRRusWAjFjMhrZtVCeD24v7ppgKZ=0NFo7-9mruh5PohA@mail.gmail.com>

Dirk Eddelbuettel would tell you to use his 'little r' script instead,
though not sure if it has this particular flexibility. You could wrap R CMD
BATCH in your own script that moved Rplots.pdf where you wanted it ...

On Sun, Jul 28, 2024, 4:05 PM Josiah Parry <josiah.parry at gmail.com> wrote:

> Thanks, Duncan!
>
> Is there a way to override this using the command line arguments?
>
> I'd like to be able to have a generalizable way to address this without
> having to modify R source code.
>
> My understanding is that when there is a plot output, R CMD BATCH uses the
> PDF device which is a fair default.
>
> However, there is not any use of `dev.new()` or `pdf()` called anywhere in
> the code.
>
> On Sun, Jul 28, 2024 at 3:44?PM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
>
> > On 2024-07-28 1:48 p.m., Josiah Parry wrote:
> > > Hey folks! I am working with R CMD BATCH and providing a providing a
> > > logfile output e.g.
> > >
> > > R CMD BATCH main.R 2024-07-28.log
> > >
> > > This creates the desired log file with the contents of stdout and
> stderr.
> > >
> > > However, if plots are generated in the process, the plots are stored in
> > > Rplots.pdf.
> > >
> > > Is there a way via command line arguments to change the name of the pdf
> > > output.
> > >
> > > There might be multiple runs of this script and it would be ideal to
> > store
> > > the plot output independently.
> >
> > That's the default filename if you open a PDF device.  Open it
> > explicitly and you can specify any file you like.
> >
> > That is,
> >
> >    plot(rnorm(100))
> >
> > will call dev.new() which in a non-interactive session calls pdf().  If
> > you specify
> >
> >    dev.new(file = "something.pdf")
> >    plot(rnorm(100))
> >
> > the "file" argument will be ignored in an interactive session, but will
> > be used in a non-interactive one.
> >
> > Duncan Murdoch
> >
> >
> >
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Jul 28 22:15:21 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 28 Jul 2024 16:15:21 -0400
Subject: [R-pkg-devel] R CMD BATCH plot output
In-Reply-To: <CAL3ufU+LANOhv_V7S4OWUbFunjkB6OH4VUYmDWf143cPov6L9Q@mail.gmail.com>
References: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
 <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
 <CAL3ufU+LANOhv_V7S4OWUbFunjkB6OH4VUYmDWf143cPov6L9Q@mail.gmail.com>
Message-ID: <0ee31808-cbb1-4277-9bcd-d4a82018a4d7@gmail.com>

On 2024-07-28 4:05 p.m., Josiah Parry wrote:
> Thanks, Duncan!
> 
> Is there a way to override this using the command line arguments?

I assume you could do that using commandArgs() in the dev.new() call, 
but I don't use BATCH.
> 
> I'd like to be able to have a generalizable way to address this without 
> having to modify R source code.

Take a look at the source to dev.new().  It tries various things, maybe 
one of those will suit you.
> 
> My understanding is that when there is a plot output, R CMD BATCH uses 
> the PDF device which is a fair default.
> 
> However, there is not any use of `dev.new()` or `pdf()` called anywhere 
> in the code.

Not explicitly, but if you try to call a plot function with no device 
active, the graphics system will call dev.new().

Duncan Murdoch

> 
> On Sun, Jul 28, 2024 at 3:44?PM Duncan Murdoch <murdoch.duncan at gmail.com 
> <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     On 2024-07-28 1:48 p.m., Josiah Parry wrote:
>      > Hey folks! I am working with R CMD BATCH and providing a providing a
>      > logfile output e.g.
>      >
>      > R CMD BATCH main.R 2024-07-28.log
>      >
>      > This creates the desired log file with the contents of stdout and
>     stderr.
>      >
>      > However, if plots are generated in the process, the plots are
>     stored in
>      > Rplots.pdf.
>      >
>      > Is there a way via command line arguments to change the name of
>     the pdf
>      > output.
>      >
>      > There might be multiple runs of this script and it would be ideal
>     to store
>      > the plot output independently.
> 
>     That's the default filename if you open a PDF device.? Open it
>     explicitly and you can specify any file you like.
> 
>     That is,
> 
>      ? ?plot(rnorm(100))
> 
>     will call dev.new() which in a non-interactive session calls pdf().? If
>     you specify
> 
>      ? ?dev.new(file = "something.pdf")
>      ? ?plot(rnorm(100))
> 
>     the "file" argument will be ignored in an interactive session, but will
>     be used in a non-interactive one.
> 
>     Duncan Murdoch
> 
>


From edd @end|ng |rom deb|@n@org  Sun Jul 28 22:27:33 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sun, 28 Jul 2024 15:27:33 -0500
Subject: [R-pkg-devel] R CMD BATCH plot output
In-Reply-To: <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
References: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
 <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
Message-ID: <26278.43445.370820.622202@rob.eddelbuettel.com>


On 28 July 2024 at 15:44, Duncan Murdoch wrote:
| On 2024-07-28 1:48 p.m., Josiah Parry wrote:
| > However, if plots are generated in the process, the plots are stored in
| > Rplots.pdf.
| > 
| > Is there a way via command line arguments to change the name of the pdf
| > output.
| > 
| > There might be multiple runs of this script and it would be ideal to store
| > the plot output independently.
| 
| That's the default filename if you open a PDF device.  Open it

It's the default (and fallback) device and filename you fail to specify
something else. Ie 'Rscript -e "plot(1:10)"' will create it too.

My preferred alternative is to wrap call to plot() with actual device create
(something like 'if (!interactive()) pdf(my_filename, 8. 6)' with a
corresponding 'if (!interactive()) dev.off()' to ensure the file finalised
and close.

If we cannot (or do not want to) modify the given main.R, I would suggest
something along the lines of

  Rscript -e 'pdf(myfilenamevar); source("main.R"); dev.off()' | tee 2024-07-28.log

and Bob's your uncle now in terms of how you spec the filename.

In short, I would let go of `R CMD BATCH` if it does not do what you want.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From |kry|ov @end|ng |rom d|@root@org  Mon Jul 29 12:02:27 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Mon, 29 Jul 2024 13:02:27 +0300
Subject: [R-pkg-devel] R CMD BATCH plot output
In-Reply-To: <26278.43445.370820.622202@rob.eddelbuettel.com>
References: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
 <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
 <26278.43445.370820.622202@rob.eddelbuettel.com>
Message-ID: <20240729130227.0548223b@arachnoid>

On Sun, 28 Jul 2024 15:27:33 -0500
Dirk Eddelbuettel <edd at debian.org> wrote:

> If we cannot (or do not want to) modify the given main.R, I would
> suggest something along the lines of
> 
>   Rscript -e 'pdf(myfilenamevar); source("main.R"); dev.off()' | tee
> 2024-07-28.log

Perhaps even options(device = \(file = myfilenamevar, ...) pdf(file =
file, ...)) so that every plot would get the same treatment, though
that requires re-implementing the dev.new() logic to guess an available
file name. You can even misuse R_PROFILE_USER to inject the code into
the R CMD BATCH session:

# myplots.R:
local({
	cmdline <- commandArgs(FALSE)
	srcfile <- cmdline[[which(cmdline == '-f')[[1]] + 1]]
	plotfile <- sub('(\\.R)?$', '', srcfile)
	options(device = \(file, ...) {
		i <- 1
		if (missing(file)) repeat {
			file <- sprintf('%s_%03d.pdf', plotfile, i)
			if (!file.exists(file)) break
			i <- i+1
		}
		pdf(file = file, ...)
	})
})

# example.R:
plot(1:100 / 10, sin(1:100 / 10))
dev.off()
plot(1:100 / 10, cos(1:100 / 10))

R_PROFILE_USER=myplots.R R CMD BATCH example.R
# produces example.Rout, example_001.pdf, example_002.pdf

-- 
Best regards,
Ivan


From edd @end|ng |rom deb|@n@org  Tue Jul 30 00:18:25 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 29 Jul 2024 17:18:25 -0500
Subject: [R-pkg-devel] R CMD BATCH plot output
In-Reply-To: <20240729130227.0548223b@arachnoid>
References: <CAL3ufUKUvOPQGcqXj9vFJHpDF_zP1uLtr=7Jjr6DESoKu=vqgA@mail.gmail.com>
 <e7a6d116-86d5-4ba4-b620-7f27f607ce44@gmail.com>
 <26278.43445.370820.622202@rob.eddelbuettel.com>
 <20240729130227.0548223b@arachnoid>
Message-ID: <26280.5425.179338.59618@rob.eddelbuettel.com>


On 29 July 2024 at 13:02, Ivan Krylov wrote:
| On Sun, 28 Jul 2024 15:27:33 -0500
| Dirk Eddelbuettel <edd at debian.org> wrote:
| 
| > If we cannot (or do not want to) modify the given main.R, I would
| > suggest something along the lines of
| > 
| >   Rscript -e 'pdf(myfilenamevar); source("main.R"); dev.off()' | tee
| > 2024-07-28.log
| 
| Perhaps even options(device = \(file = myfilenamevar, ...) pdf(file =
| file, ...)) so that every plot would get the same treatment, though
| that requires re-implementing the dev.new() logic to guess an available
| file name. You can even misuse R_PROFILE_USER to inject the code into
| the R CMD BATCH session:
| 
| # myplots.R:
| local({
| 	cmdline <- commandArgs(FALSE)
| 	srcfile <- cmdline[[which(cmdline == '-f')[[1]] + 1]]
| 	plotfile <- sub('(\\.R)?$', '', srcfile)
| 	options(device = \(file, ...) {
| 		i <- 1
| 		if (missing(file)) repeat {
| 			file <- sprintf('%s_%03d.pdf', plotfile, i)
| 			if (!file.exists(file)) break
| 			i <- i+1
| 		}
| 		pdf(file = file, ...)
| 	})
| })
| 
| # example.R:
| plot(1:100 / 10, sin(1:100 / 10))
| dev.off()
| plot(1:100 / 10, cos(1:100 / 10))
| 
| R_PROFILE_USER=myplots.R R CMD BATCH example.R
| # produces example.Rout, example_001.pdf, example_002.pdf

Impressive. A very creative way to inject a modification into the (to my
taste overly restrictive) setup provided by R CMD BATCH.

Personally I would much rather script something cleaner with r or Rscript but
we all have our preferences.

Dirk


-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From bbo|ker @end|ng |rom gm@||@com  Thu Aug  1 16:53:56 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 1 Aug 2024 10:53:56 -0400
Subject: [R-pkg-devel] LaTeX errors under MacOS on CRAN
Message-ID: <ec2448ff-ffda-447c-9d69-645c6901b2ec@gmail.com>

   I note that on r-release-macos-x86_64, glmmTMB is getting warnings 
like this:

  Error: processing vignette 'glmmTMB.Rnw' failed with diagnostics:
   Running 'texi2dvi' on 'glmmTMB.tex' failed.
   LaTeX errors:
   ! Undefined control sequence.
   l.176 \hlkwd{library}\hldef
                              {(}\hlsng{"glmmTMB"}\hldef{)}
   ?
   ! Emergency stop.
   ! Emergency stop.
   l.176

<https://cran.r-project.org/web/checks/check_results_glmmTMB.html>

   (I see similar but not identical problems with 
<https://cran.r-project.org/web/checks/check_results_robustbase.html>, 
although on different platforms.

   Has anyone seen this/does anyone have ideas for troubleshooting? 
(Haven't checked on the r-hub platforms yet ...)

   cheers
    Ben Bolker


From |kry|ov @end|ng |rom d|@root@org  Fri Aug  2 09:39:00 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Fri, 2 Aug 2024 10:39:00 +0300
Subject: [R-pkg-devel] LaTeX errors under MacOS on CRAN
In-Reply-To: <ec2448ff-ffda-447c-9d69-645c6901b2ec@gmail.com>
References: <ec2448ff-ffda-447c-9d69-645c6901b2ec@gmail.com>
Message-ID: <20240802103900.34ffff11@Tarkus>

? Thu, 1 Aug 2024 10:53:56 -0400
Ben Bolker <bbolker at gmail.com> ?????:

>    ! Undefined control sequence.
>    l.176 \hlkwd{library}\hldef
>                               {(}\hlsng{"glmmTMB"}\hldef{)}

Very strange.

This may be related to https://github.com/yihui/knitr/issues/2345
(no diagnosis) and possibly https://github.com/yihui/knitr/pull/2341
(where some of the highlight commands have been renamed).

It would be interesting to see the resulting *.tex file: somehow,
\hlkwd is defined, but \hldef isn't.

Looking at the code, knitr should be generating all these definitions
in styler_assistant_latex, called from theme_to_header_latex. This one
is either called from theme_to_header (thus from knit_theme$get(name)),
or at installation time, converting inst/themes/default.css (which
should have both hlkwd and hldef set).

Since you aren't setting any knitr highlighting themes or
opts_knit$set('header'), you should be getting both \hlkwd and \hldef
defined from themes/default.css via knitr::render_latex. Is there a way
to inadvertently set the 'header' knitr option?

-- 
Best regards,
Ivan


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Fri Aug  2 12:12:03 2024
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Fri, 2 Aug 2024 12:12:03 +0200
Subject: [R-pkg-devel] LaTeX errors under MacOS on CRAN
In-Reply-To: <20240802103900.34ffff11@Tarkus>
References: <ec2448ff-ffda-447c-9d69-645c6901b2ec@gmail.com>
 <20240802103900.34ffff11@Tarkus>
Message-ID: <d03b50d3-879a-492e-a2d7-1c1644e7b285@statistik.tu-dortmund.de>

A vague recollections tells me this happened when the set of packages 
was not fully updated.

Best,
Uwe LIgges




On 02.08.2024 09:39, Ivan Krylov via R-package-devel wrote:
> ? Thu, 1 Aug 2024 10:53:56 -0400
> Ben Bolker <bbolker at gmail.com> ?????:
> 
>>     ! Undefined control sequence.
>>     l.176 \hlkwd{library}\hldef
>>                                {(}\hlsng{"glmmTMB"}\hldef{)}
> 
> Very strange.
> 
> This may be related to https://github.com/yihui/knitr/issues/2345
> (no diagnosis) and possibly https://github.com/yihui/knitr/pull/2341
> (where some of the highlight commands have been renamed).
> 
> It would be interesting to see the resulting *.tex file: somehow,
> \hlkwd is defined, but \hldef isn't.
> 
> Looking at the code, knitr should be generating all these definitions
> in styler_assistant_latex, called from theme_to_header_latex. This one
> is either called from theme_to_header (thus from knit_theme$get(name)),
> or at installation time, converting inst/themes/default.css (which
> should have both hlkwd and hldef set).
> 
> Since you aren't setting any knitr highlighting themes or
> opts_knit$set('header'), you should be getting both \hlkwd and \hldef
> defined from themes/default.css via knitr::render_latex. Is there a way
> to inadvertently set the 'header' knitr option?
> 

From ro||turner @end|ng |rom po@teo@net  Fri Aug  2 13:10:59 2024
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Fri,  2 Aug 2024 11:10:59 +0000
Subject: [R-pkg-devel] rhub (version 2) baulking at building a vignette.
Message-ID: <20240802231059.0447ed2e@elderly-dell>


Some time back, in the mists of memory, I got advice (on this list, I'm
pretty sure) about building vignettes.  The advice was to the effect
that if the vignette was actually just a *.tex file, one could (after
putting in some preparatory code, in the form of comments, before the
documentclass command) pre-process the file (with pdflatex)
and the build would use the *.pdf file that was created, without any
processing being required.

Being a Bear of Very Little Brain (and understanding almost nothing of
the underlying intricacies) I simply followed instructions. It seemed
to work, I was able to build and install the package containing the
vignette in question.

Now I want to build a Windoze binary of the package.  Trying to do this
with rhub led to a failure.  The build process seemed to ignore the
pre-processed *.pdf file, tried to create it, and complained that
pdflatex was not available.

I raised an "issue" about this on rhub:

   https://github.com/r-hub/rhub/issues/629

I got a response from the redoubtable G?bor Cs?rdi saying that
when he tried a local build of my package, the build command threw
effectively the same error as did rhub.  So there's "something about my
system" that is different.  What could it be?

I have attached my session info in a *.txt file, to avoid cluttering the
email window too much.

If anyone should wish to experiment, they can clone the package in
question (I think!) by executing: 

git clone https://github.com/rolfTurner/kanova.git

Can anyone give me some avuncular advice as to how:

(a) to get rhub_check() to use the pre-compiled file testStat.pdf, or
(b) to make pdflatex available to rhub_check()
(c) to do something else that will permit me to build a Windoze binary
     using rhub?

Grateful for any tips.

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: sessionInfo.txt
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20240802/3c051ce6/attachment.txt>

From |kry|ov @end|ng |rom d|@root@org  Fri Aug  2 15:12:34 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Fri, 2 Aug 2024 16:12:34 +0300
Subject: [R-pkg-devel] rhub (version 2) baulking at building a vignette.
In-Reply-To: <20240802231059.0447ed2e@elderly-dell>
References: <20240802231059.0447ed2e@elderly-dell>
Message-ID: <20240802161234.6386eed1@arachnoid>

? Fri,  2 Aug 2024 11:10:59 +0000
Rolf Turner <rolfturner at posteo.net> ?????:

> The advice was to the effect that if the vignette was actually just a
> *.tex file, one could (after putting in some preparatory code, in the
> form of comments, before the documentclass command) pre-process the
> file (with pdflatex) and the build would use the *.pdf file that was
> created, without any processing being required.

I think that you are looking for the "asis" vignette engine from the
R.rsp package:
https://cran.r-project.org/package=R.rsp/vignettes/R_packages-Static_PDF_and_HTML_vignettes.pdf

> Now I want to build a Windoze binary of the package.

If the vignette uses LaTeX packages unavailable on the computer (rhub2
virtual machine) running R CMD build or R CMD check, that would indeed
not work. Not sure about CRAN.

Since your package doesn't seem to contain any native code, wouldn't
the Windows users be satisfied with a source package? Unless running R
CMD build --no-build-vignettes, it will include the PDF file.

-- 
Best regards,
Ivan


From @hu|@|@cheung @end|ng |rom gm@||@com  Fri Aug  2 16:35:20 2024
From: @hu|@|@cheung @end|ng |rom gm@||@com (Shu Fai Cheung)
Date: Fri, 2 Aug 2024 22:35:20 +0800
Subject: [R-pkg-devel] A function in one of my package is now a method in
 base R
Message-ID: <CAPVJd2UmGLh-NvdZd=ipSePFAVQjQe2-W=yi1Py+oE8wsbGUJw@mail.gmail.com>

Hi All,

I have a function (not a method), sort_by(), in one of my packages. A
new method with the same name was introduced in the recent versions of
R (4.4.0 or 4.4.1, I forgot which one), resulting in potential
conflict in users' code.

Certainly, users can simply use pkg_name::function_name() to solve the
conflict. However, I would like to be consistent with base R and so I
am thinking about converting my function to a method for the class for
which my function is intended to work on (e.g, est_table).

However, my function has arguments different from those in the base R sort_by():

Base R:

sort_by(x, y, ...)

My function:

sort_by(
  object,
  by = c("op", "lhs", "rhs"),
  op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
  number_rows = TRUE
)

If I write the function sort_by.est_table(), I would need to match the
argument names of the base R sort_by(). However, I think it is a bad
idea to rename the arguments in my function and it will break existing
code.

Any suggestions on how I should proceed? Is keeping my function as-is
a better option? Name conflict is not unusual across packages and so
users need to learn how to solve this problem anyway. Nevertheless, if
possible, I would like to solve the conflict internally such that
users do not need to do anything.

Regards,
Shu Fai Cheung


From edd @end|ng |rom deb|@n@org  Fri Aug  2 17:57:48 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 2 Aug 2024 10:57:48 -0500
Subject: [R-pkg-devel] rhub (version 2) baulking at building a vignette.
In-Reply-To: <20240802161234.6386eed1@arachnoid>
References: <20240802231059.0447ed2e@elderly-dell>
 <20240802161234.6386eed1@arachnoid>
Message-ID: <26285.508.100632.582973@rob.eddelbuettel.com>


On 2 August 2024 at 16:12, Ivan Krylov via R-package-devel wrote:
| ? Fri,  2 Aug 2024 11:10:59 +0000
| Rolf Turner <rolfturner at posteo.net> ?????:
| 
| > The advice was to the effect that if the vignette was actually just a
| > *.tex file, one could (after putting in some preparatory code, in the
| > form of comments, before the documentclass command) pre-process the
| > file (with pdflatex) and the build would use the *.pdf file that was
| > created, without any processing being required.
| 
| I think that you are looking for the "asis" vignette engine from the

Or the zero-dependency approach by Mark van der Loo of embedding a whole
(pre-made pdf) in a five-line Rnw sweave file described in 
  https://www.r-bloggers.com/2019/01/add-a-static-pdf-vignette-to-an-r-package/

So no real pdf processing requirement (besides the minimal include), so no
random failing over a .sty or font one uses suddenly missing on another machine.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Aug  2 20:43:20 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 2 Aug 2024 14:43:20 -0400
Subject: [R-pkg-devel] 
 A function in one of my package is now a method in base R
In-Reply-To: <CAPVJd2UmGLh-NvdZd=ipSePFAVQjQe2-W=yi1Py+oE8wsbGUJw@mail.gmail.com>
References: <CAPVJd2UmGLh-NvdZd=ipSePFAVQjQe2-W=yi1Py+oE8wsbGUJw@mail.gmail.com>
Message-ID: <f21dd671-259d-4c83-a770-8f2bcea8245a@gmail.com>

On 2024-08-02 10:35 a.m., Shu Fai Cheung wrote:
> Hi All,
> 
> I have a function (not a method), sort_by(), in one of my packages. A
> new method with the same name was introduced in the recent versions of
> R (4.4.0 or 4.4.1, I forgot which one), resulting in potential
> conflict in users' code.
> 
> Certainly, users can simply use pkg_name::function_name() to solve the
> conflict. However, I would like to be consistent with base R and so I
> am thinking about converting my function to a method for the class for
> which my function is intended to work on (e.g, est_table).
> 
> However, my function has arguments different from those in the base R sort_by():
> 
> Base R:
> 
> sort_by(x, y, ...)
> 
> My function:
> 
> sort_by(
>    object,
>    by = c("op", "lhs", "rhs"),
>    op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>    number_rows = TRUE
> )
> 
> If I write the function sort_by.est_table(), I would need to match the
> argument names of the base R sort_by(). However, I think it is a bad
> idea to rename the arguments in my function and it will break existing
> code.
> 
> Any suggestions on how I should proceed? Is keeping my function as-is
> a better option? Name conflict is not unusual across packages and so
> users need to learn how to solve this problem anyway. Nevertheless, if
> possible, I would like to solve the conflict internally such that
> users do not need to do anything.

I think it's impossible to avoid some inconvenience to your users.

Here's what I'd suggest:

- Create a method for base::sort_by(), as you suggested you could.  Use 
the generic's variable names for compatibility, but also add your extra 
variable names as additional arguments, e.g.

  sort_by.est_table <- function(x, y, object,
    by = c("op", "lhs", "rhs"),
    op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
    number_rows = TRUE, ...) {

   # This test seems unlikely:  how would we have dispatch here if we 
specified object explicitly?

   if (!missing(object) {
     if (!missing(x))
       stop("both x and object specified!")
     x <- object
   }

   # This one is more likely to do something:

   if (!missing(by)) {
     if (!missing(y))
       stop("both y and by specified!")
     y <- by
   }

   # Now proceed using x and y

   ...
}

- Create a separate function, e.g. sort_by_old() which is exactly 
compatible with your old sort_by().  For users where the above doesn't 
just work, they can switch to sort_by_old().

Duncan Murdoch


From ro||turner @end|ng |rom po@teo@net  Sat Aug  3 11:17:27 2024
From: ro||turner @end|ng |rom po@teo@net (Rolf Turner)
Date: Sat,  3 Aug 2024 09:17:27 +0000
Subject: [R-pkg-devel] rhub (version 2) baulking at building a vignette.
In-Reply-To: <20240802161234.6386eed1@arachnoid>
References: <20240802231059.0447ed2e@elderly-dell>
 <20240802161234.6386eed1@arachnoid>
Message-ID: <20240803211727.5f2b86b8@elderly-dell>


Thanks to Ivan Krylov and Dirk Eddelbuettel who came to my rescue.

At first I thought that Dirk's suggestion ("the zero-dependency
approach" due to Mark van der Loo) was exactly what I needed.  But this
turned out not to work; rhub_check() still failed with a complaint
about needing pdflatex.

Ivan's suggestion (the "asis" vignette from the R.rsp package) does
work.  This turns out to be easy enough to implement, but it has taken
me all day to get everything to run properly.  The difficulties were not
due to any characteristics of the "asis" approach, but rather to the
(to me) fussy, delicate, awkward, and counter-intuitive nature of rhub.
It kept finding new and innovative ways to frustrate me. ?? However I
finally won out.

I won't try to describe what I eventually did/had to do.  It is too
tortuous a tale of trial and error, with too many rhub "Gotchas!"
which I have difficulty reconstructing and to which I often cannot
remember the solutions.  I've got the solutions in place, and am just
crossing my fingers that I won't have to do it all over again.

Ivan Krylov <ikrylov at disroot.org> wrote:

<SNIP>

> Since your package doesn't seem to contain any native code, wouldn't
> the Windows users be satisfied with a source package? Unless running R
> CMD build --no-build-vignettes, it will include the PDF file.

Since I don't (ever) use Windoze myself, I have no feeling for what it
(and its users) will or will not tolerate.  Nor have I any way to test
out ideas.  So I prefer to go with building Windoze binaries, via rhub
or winbuilder.  (Using each as a back-up for the other.)  Now that I
know how (???) to do this, it's not too bad.

Thanks again to Ivan and Dirk.

cheers,

Rolf

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Stats. Dep't. (secretaries) phone:
         +64-9-373-7599 ext. 89622
Home phone: +64-9-480-4619


From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Sat Aug  3 13:13:20 2024
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Sat, 3 Aug 2024 16:43:20 +0530
Subject: [R-pkg-devel] 
 A function in one of my package is now a method in base R
In-Reply-To: <f21dd671-259d-4c83-a770-8f2bcea8245a@gmail.com>
References: <CAPVJd2UmGLh-NvdZd=ipSePFAVQjQe2-W=yi1Py+oE8wsbGUJw@mail.gmail.com>
 <f21dd671-259d-4c83-a770-8f2bcea8245a@gmail.com>
Message-ID: <CADfFDC7FPCSuk4Ohe9CDyj0k0_+NoX1JFh7kAT+1274OF1aMkA@mail.gmail.com>

I haven't thought about this carefully, but shouldn't this mostly work?

  sort_by.est_table <- function(x, y = c("op", "lhs", "rhs"),
    object = x,
    by = y,
    op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
    number_rows = TRUE, ...) {

<code unchanged>

}

-Deepayan

On Sat, 3 Aug 2024 at 00:13, Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 2024-08-02 10:35 a.m., Shu Fai Cheung wrote:
> > Hi All,
> >
> > I have a function (not a method), sort_by(), in one of my packages. A
> > new method with the same name was introduced in the recent versions of
> > R (4.4.0 or 4.4.1, I forgot which one), resulting in potential
> > conflict in users' code.
> >
> > Certainly, users can simply use pkg_name::function_name() to solve the
> > conflict. However, I would like to be consistent with base R and so I
> > am thinking about converting my function to a method for the class for
> > which my function is intended to work on (e.g, est_table).
> >
> > However, my function has arguments different from those in the base R
> sort_by():
> >
> > Base R:
> >
> > sort_by(x, y, ...)
> >
> > My function:
> >
> > sort_by(
> >    object,
> >    by = c("op", "lhs", "rhs"),
> >    op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
> >    number_rows = TRUE
> > )
> >
> > If I write the function sort_by.est_table(), I would need to match the
> > argument names of the base R sort_by(). However, I think it is a bad
> > idea to rename the arguments in my function and it will break existing
> > code.
> >
> > Any suggestions on how I should proceed? Is keeping my function as-is
> > a better option? Name conflict is not unusual across packages and so
> > users need to learn how to solve this problem anyway. Nevertheless, if
> > possible, I would like to solve the conflict internally such that
> > users do not need to do anything.
>
> I think it's impossible to avoid some inconvenience to your users.
>
> Here's what I'd suggest:
>
> - Create a method for base::sort_by(), as you suggested you could.  Use
> the generic's variable names for compatibility, but also add your extra
> variable names as additional arguments, e.g.
>
>   sort_by.est_table <- function(x, y, object,
>     by = c("op", "lhs", "rhs"),
>     op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>     number_rows = TRUE, ...) {
>
>    # This test seems unlikely:  how would we have dispatch here if we
> specified object explicitly?
>
>    if (!missing(object) {
>      if (!missing(x))
>        stop("both x and object specified!")
>      x <- object
>    }
>
>    # This one is more likely to do something:
>
>    if (!missing(by)) {
>      if (!missing(y))
>        stop("both y and by specified!")
>      y <- by
>    }
>
>    # Now proceed using x and y
>
>    ...
> }
>
> - Create a separate function, e.g. sort_by_old() which is exactly
> compatible with your old sort_by().  For users where the above doesn't
> just work, they can switch to sort_by_old().
>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @hu|@|@cheung @end|ng |rom gm@||@com  Sat Aug  3 13:32:04 2024
From: @hu|@|@cheung @end|ng |rom gm@||@com (Shu Fai Cheung)
Date: Sat, 3 Aug 2024 19:32:04 +0800
Subject: [R-pkg-devel] 
 A function in one of my package is now a method in base R
In-Reply-To: <CADfFDC7FPCSuk4Ohe9CDyj0k0_+NoX1JFh7kAT+1274OF1aMkA@mail.gmail.com>
References: <CAPVJd2UmGLh-NvdZd=ipSePFAVQjQe2-W=yi1Py+oE8wsbGUJw@mail.gmail.com>
 <f21dd671-259d-4c83-a770-8f2bcea8245a@gmail.com>
 <CADfFDC7FPCSuk4Ohe9CDyj0k0_+NoX1JFh7kAT+1274OF1aMkA@mail.gmail.com>
Message-ID: <CAPVJd2VLiXV3xXMiHjgKN4YE0N6wg0Zq0kUEdhTeKY2iuWSwLA@mail.gmail.com>

Thanks a lot for both suggestions! I haven't thought about these
approaches, They may solve my problem without breaking existing code.
I may just keep the original arguments for backward compatibility.
Coincidentally, "object" and "by" have the same meanings as "x" and
"y" in base::sort_by() and so the matching makes sense.

Regards,
Shu Fai Cheung

On Sat, Aug 3, 2024 at 7:13?PM Deepayan Sarkar
<deepayan.sarkar at gmail.com> wrote:
>
> I haven't thought about this carefully, but shouldn't this mostly work?
>
>   sort_by.est_table <- function(x, y = c("op", "lhs", "rhs"),
>     object = x,
>     by = y,
>     op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>     number_rows = TRUE, ...) {
>
> <code unchanged>
>
> }
>
> -Deepayan
>
> On Sat, 3 Aug 2024 at 00:13, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> On 2024-08-02 10:35 a.m., Shu Fai Cheung wrote:
>> > Hi All,
>> >
>> > I have a function (not a method), sort_by(), in one of my packages. A
>> > new method with the same name was introduced in the recent versions of
>> > R (4.4.0 or 4.4.1, I forgot which one), resulting in potential
>> > conflict in users' code.
>> >
>> > Certainly, users can simply use pkg_name::function_name() to solve the
>> > conflict. However, I would like to be consistent with base R and so I
>> > am thinking about converting my function to a method for the class for
>> > which my function is intended to work on (e.g, est_table).
>> >
>> > However, my function has arguments different from those in the base R sort_by():
>> >
>> > Base R:
>> >
>> > sort_by(x, y, ...)
>> >
>> > My function:
>> >
>> > sort_by(
>> >    object,
>> >    by = c("op", "lhs", "rhs"),
>> >    op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>> >    number_rows = TRUE
>> > )
>> >
>> > If I write the function sort_by.est_table(), I would need to match the
>> > argument names of the base R sort_by(). However, I think it is a bad
>> > idea to rename the arguments in my function and it will break existing
>> > code.
>> >
>> > Any suggestions on how I should proceed? Is keeping my function as-is
>> > a better option? Name conflict is not unusual across packages and so
>> > users need to learn how to solve this problem anyway. Nevertheless, if
>> > possible, I would like to solve the conflict internally such that
>> > users do not need to do anything.
>>
>> I think it's impossible to avoid some inconvenience to your users.
>>
>> Here's what I'd suggest:
>>
>> - Create a method for base::sort_by(), as you suggested you could.  Use
>> the generic's variable names for compatibility, but also add your extra
>> variable names as additional arguments, e.g.
>>
>>   sort_by.est_table <- function(x, y, object,
>>     by = c("op", "lhs", "rhs"),
>>     op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>>     number_rows = TRUE, ...) {
>>
>>    # This test seems unlikely:  how would we have dispatch here if we
>> specified object explicitly?
>>
>>    if (!missing(object) {
>>      if (!missing(x))
>>        stop("both x and object specified!")
>>      x <- object
>>    }
>>
>>    # This one is more likely to do something:
>>
>>    if (!missing(by)) {
>>      if (!missing(y))
>>        stop("both y and by specified!")
>>      y <- by
>>    }
>>
>>    # Now proceed using x and y
>>
>>    ...
>> }
>>
>> - Create a separate function, e.g. sort_by_old() which is exactly
>> compatible with your old sort_by().  For users where the above doesn't
>> just work, they can switch to sort_by_old().
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ke||ey @end|ng |rom d@|@c@  Sat Aug  3 15:12:39 2024
From: ke||ey @end|ng |rom d@|@c@ (Daniel Kelley)
Date: Sat, 3 Aug 2024 13:12:39 +0000
Subject: [R-pkg-devel] rhub (old and new) balks at building ncdf4 package
Message-ID: <1AB7C7BF-71C1-40D7-B4D4-4E0AFB6BE043@dal.ca>

I have a package, named 'oce' (developed at www.github.com/dankelley/oce and available through CRAN for over a decade) that uses 'ncdf4' to read some file types.  When I do test builds on the win and mac builders, all is fine.  When I do it with rhub, though, I get an error that ncdf4 cannot be built from source.

I think it's been this way for quite a while, perhaps months  Should I be doing something when I invoke rhub (locally or on github) to tell it to use a prebuild ncdf4 package?

Thanks in advance for any advice.

Dan E. Kelley
Professor, Department of Oceanography
Dalhousie University


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Aug  3 15:29:21 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 3 Aug 2024 09:29:21 -0400
Subject: [R-pkg-devel] 
 A function in one of my package is now a method in base R
In-Reply-To: <CADfFDC7FPCSuk4Ohe9CDyj0k0_+NoX1JFh7kAT+1274OF1aMkA@mail.gmail.com>
References: <CAPVJd2UmGLh-NvdZd=ipSePFAVQjQe2-W=yi1Py+oE8wsbGUJw@mail.gmail.com>
 <f21dd671-259d-4c83-a770-8f2bcea8245a@gmail.com>
 <CADfFDC7FPCSuk4Ohe9CDyj0k0_+NoX1JFh7kAT+1274OF1aMkA@mail.gmail.com>
Message-ID: <02d1fb9b-ff55-4df7-bf7f-8571e14a0799@gmail.com>

The problem with that is a call like

   sort_by( object = foo, by = bar )

wouldn't be dispatched to the est_table method when foo is an est_table 
object, it would give a "argument 'x' is missing" kind of error.  It 
would be fine for

  sort_by( foo, bar )

but would also mess up on

  sort_by( foo, bar, priority )

Duncan Murdoch

On 2024-08-03 7:13 a.m., Deepayan Sarkar wrote:
> I haven't thought about this carefully, but shouldn't this mostly work?
> 
>  ? sort_by.est_table <- function(x, y = c("op", "lhs", "rhs"),
>  ? ? object = x,
>  ? ? by = y,
>  ? ? op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>  ? ? number_rows = TRUE, ...) 
> 
> <code unchanged>
> 
> }
> 
> -Deepayan
> 
> On Sat, 3 Aug 2024 at 00:13, Duncan Murdoch <murdoch.duncan at gmail.com 
> <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     On 2024-08-02 10:35 a.m., Shu Fai Cheung wrote:
>      > Hi All,
>      >
>      > I have a function (not a method), sort_by(), in one of my packages. A
>      > new method with the same name was introduced in the recent
>     versions of
>      > R (4.4.0 or 4.4.1, I forgot which one), resulting in potential
>      > conflict in users' code.
>      >
>      > Certainly, users can simply use pkg_name::function_name() to
>     solve the
>      > conflict. However, I would like to be consistent with base R and so I
>      > am thinking about converting my function to a method for the
>     class for
>      > which my function is intended to work on (e.g, est_table).
>      >
>      > However, my function has arguments different from those in the
>     base R sort_by():
>      >
>      > Base R:
>      >
>      > sort_by(x, y, ...)
>      >
>      > My function:
>      >
>      > sort_by(
>      >? ? object,
>      >? ? by = c("op", "lhs", "rhs"),
>      >? ? op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>      >? ? number_rows = TRUE
>      > )
>      >
>      > If I write the function sort_by.est_table(), I would need to
>     match the
>      > argument names of the base R sort_by(). However, I think it is a bad
>      > idea to rename the arguments in my function and it will break
>     existing
>      > code.
>      >
>      > Any suggestions on how I should proceed? Is keeping my function as-is
>      > a better option? Name conflict is not unusual across packages and so
>      > users need to learn how to solve this problem anyway.
>     Nevertheless, if
>      > possible, I would like to solve the conflict internally such that
>      > users do not need to do anything.
> 
>     I think it's impossible to avoid some inconvenience to your users.
> 
>     Here's what I'd suggest:
> 
>     - Create a method for base::sort_by(), as you suggested you could.? Use
>     the generic's variable names for compatibility, but also add your extra
>     variable names as additional arguments, e.g.
> 
>      ? sort_by.est_table <- function(x, y, object,
>      ? ? by = c("op", "lhs", "rhs"),
>      ? ? op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>      ? ? number_rows = TRUE, ...) {
> 
>      ? ?# This test seems unlikely:? how would we have dispatch here if we
>     specified object explicitly?
> 
>      ? ?if (!missing(object) {
>      ? ? ?if (!missing(x))
>      ? ? ? ?stop("both x and object specified!")
>      ? ? ?x <- object
>      ? ?}
> 
>      ? ?# This one is more likely to do something:
> 
>      ? ?if (!missing(by)) {
>      ? ? ?if (!missing(y))
>      ? ? ? ?stop("both y and by specified!")
>      ? ? ?y <- by
>      ? ?}
> 
>      ? ?# Now proceed using x and y
> 
>      ? ?...
>     }
> 
>     - Create a separate function, e.g. sort_by_old() which is exactly
>     compatible with your old sort_by().? For users where the above doesn't
>     just work, they can switch to sort_by_old().
> 
>     Duncan Murdoch
> 
>     ______________________________________________
>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>     mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk  Sat Aug  3 23:36:41 2024
From: georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk (Georgi Boshnakov)
Date: Sat, 3 Aug 2024 21:36:41 +0000
Subject: [R-pkg-devel] 
 A function in one of my package is now a method in base R
In-Reply-To: <f21dd671-259d-4c83-a770-8f2bcea8245a@gmail.com>
References: <CAPVJd2UmGLh-NvdZd=ipSePFAVQjQe2-W=yi1Py+oE8wsbGUJw@mail.gmail.com>
 <f21dd671-259d-4c83-a770-8f2bcea8245a@gmail.com>
Message-ID: <LO0P265MB63257B789E022815E6140F1AAEBC2@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>

Since the main problem is that in base-R's function your 'object' is called  'x',  you could consider issuing an intermediate version of the package, where you strongly advise users not to name the first argument and to always name the remaining arguments. Also, make sure that your examples follow this advice.

If the function is used by package authors, you could send them emails, telling them exactly what to change.

After a year or so you could make the method following Duncan's advice.

Since sort_by is in package 'base', packages that use your package will no longer need to import sort_by from your package. There are some further subtleties here that could be discussed if packages that import explicitly sort_by from your package exist.


Georgi Boshnakov



Sent from Outlook for Android<https://aka.ms/AAb9ysg>

________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Duncan Murdoch <murdoch.duncan at gmail.com>
Sent: Friday, August 2, 2024 7:43:46 pm
To: Shu Fai Cheung <shufai.cheung at gmail.com>; r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel]  A function in one of my package is now a method in base R

On 2024-08-02 10:35 a.m., Shu Fai Cheung wrote:
> Hi All,
>
> I have a function (not a method), sort_by(), in one of my packages. A
> new method with the same name was introduced in the recent versions of
> R (4.4.0 or 4.4.1, I forgot which one), resulting in potential
> conflict in users' code.
>
> Certainly, users can simply use pkg_name::function_name() to solve the
> conflict. However, I would like to be consistent with base R and so I
> am thinking about converting my function to a method for the class for
> which my function is intended to work on (e.g, est_table).
>
> However, my function has arguments different from those in the base R sort_by():
>
> Base R:
>
> sort_by(x, y, ...)
>
> My function:
>
> sort_by(
>    object,
>    by = c("op", "lhs", "rhs"),
>    op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
>    number_rows = TRUE
> )
>
> If I write the function sort_by.est_table(), I would need to match the
> argument names of the base R sort_by(). However, I think it is a bad
> idea to rename the arguments in my function and it will break existing
> code.
>
> Any suggestions on how I should proceed? Is keeping my function as-is
> a better option? Name conflict is not unusual across packages and so
> users need to learn how to solve this problem anyway. Nevertheless, if
> possible, I would like to solve the conflict internally such that
> users do not need to do anything.

I think it's impossible to avoid some inconvenience to your users.

Here's what I'd suggest:

- Create a method for base::sort_by(), as you suggested you could.  Use
the generic's variable names for compatibility, but also add your extra
variable names as additional arguments, e.g.

  sort_by.est_table <- function(x, y, object,
    by = c("op", "lhs", "rhs"),
    op_priority = c("=~", "~", "~~", ":=", "~1", "|", "~*~"),
    number_rows = TRUE, ...) {

   # This test seems unlikely:  how would we have dispatch here if we
specified object explicitly?

   if (!missing(object) {
     if (!missing(x))
       stop("both x and object specified!")
     x <- object
   }

   # This one is more likely to do something:

   if (!missing(by)) {
     if (!missing(y))
       stop("both y and by specified!")
     y <- by
   }

   # Now proceed using x and y

   ...
}

- Create a separate function, e.g. sort_by_old() which is exactly
compatible with your old sort_by().  For users where the above doesn't
just work, they can switch to sort_by_old().

Duncan Murdoch

______________________________________________
R-package-devel at r-project.org mailing list
https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!DMhcKnV6t06-gQP_syUMUckB9X-q2dwf-t0gwHnslUVystLyIK742SL2XYMJ-ugEvVxGfGLffUOBLR_lXvVhbltAha5tPmWPr6cdoQ$ [stat[.]ethz[.]ch]


	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Sun Aug  4 02:55:03 2024
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sun, 4 Aug 2024 12:55:03 +1200
Subject: [R-pkg-devel] LaTeX errors under MacOS on CRAN
In-Reply-To: <ec2448ff-ffda-447c-9d69-645c6901b2ec@gmail.com>
References: <ec2448ff-ffda-447c-9d69-645c6901b2ec@gmail.com>
Message-ID: <08527BC4-655F-40D2-A906-60D818A261B8@R-project.org>

Ben,

if I recall there were a couple regressions in knitr that broke things, but since this is only a WARNING it means the check has not been automatically repeated after knitr update (ERRORs are re-tried nightly). I can kick off things manually which is likely to remove the WARNING.

Cheers,
Simon


> On 2/08/2024, at 2:53 AM, Ben Bolker <bbolker at gmail.com> wrote:
> 
>  I note that on r-release-macos-x86_64, glmmTMB is getting warnings like this:
> 
> Error: processing vignette 'glmmTMB.Rnw' failed with diagnostics:
>  Running 'texi2dvi' on 'glmmTMB.tex' failed.
>  LaTeX errors:
>  ! Undefined control sequence.
>  l.176 \hlkwd{library}\hldef
>                             {(}\hlsng{"glmmTMB"}\hldef{)}
>  ?
>  ! Emergency stop.
>  ! Emergency stop.
>  l.176
> 
> <https://cran.r-project.org/web/checks/check_results_glmmTMB.html>
> 
>  (I see similar but not identical problems with <https://cran.r-project.org/web/checks/check_results_robustbase.html>, although on different platforms.
> 
>  Has anyone seen this/does anyone have ideas for troubleshooting? (Haven't checked on the r-hub platforms yet ...)
> 
>  cheers
>   Ben Bolker
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From @@j5xsj9 m@iii@g oii @iiiy@@ddy@io  Mon Aug 12 20:24:30 2024
From: @@j5xsj9 m@iii@g oii @iiiy@@ddy@io (@@j5xsj9 m@iii@g oii @iiiy@@ddy@io)
Date: Mon, 12 Aug 2024 18:24:30 +0000
Subject: [R-pkg-devel] Build process generated non-portable files
Message-ID: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>

I'm working on a package that uses some fortran copied from elsewhere. It compiles and build fine everywhere but exclusively in the intel environment (provided by rhub), the intel fortran compiler generates intermediary files from *.f -> *__genmod.f90. The R check then complains that the genmod files are not portable. I include removal of the files in my cleanup file so the files do not exist in the original package source or in the final source tarball but it seems the portable files check is done after compilation but before cleanup.

- Is there a way to get around this complaint?
- Should this complaint be here in the first place?

I'm not familar with fortran but the warning message is: "Found the following files with non-portbale usage of KIND:." In "Writing R Extensions/Writing portable packages/Portable Fortran code" it mentions the use of REAL(KIND=8)? types are not portable since compilers can map values to different types (and these declarations are in the f90 files), but the compiler called the preprocessing of the files so it should be correct for this specific compiler. The docs also mention the intel compiler will perform this preprocessing so this seems to be expected behavior. Shouldn't the portable files check only be performed on the shipped source code? In general, isn't it reasonable that build processes generate files specific to the environment?

- David R. Connell
	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Tue Aug 13 10:08:14 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Tue, 13 Aug 2024 11:08:14 +0300
Subject: [R-pkg-devel] Build process generated non-portable files
In-Reply-To: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
References: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
Message-ID: <20240813110814.21a43010@Tarkus>

? Mon, 12 Aug 2024 18:24:30 +0000
David via R-package-devel <r-package-devel at r-project.org> ?????:

> in the intel environment (provided by rhub), the intel fortran
> compiler generates intermediary files from *.f -> *__genmod.f90. The
> R check then complains that the genmod files are not portable. I
> include removal of the files in my cleanup file so the files do not
> exist in the original package source or in the final source tarball
> but it seems the portable files check is done after compilation but
> before cleanup.
> 
> - Is there a way to get around this complaint?

Include the first 'all' target in your Makevars, make it depend on the
package shared library, and make it remove genmod files in the recipe:

all: $(SHLIB)
	-rm -f arpack/*genmod.f90

A similar trick is mentioned in
<https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Using-Makevars>.

> - Should this complaint be here in the first place?

Perhaps not. If you manage to find an option for the ifx compiler that
disables creation of these files (a brief Web search says they are for
only the user to read, but most results are from early 2010's), post it
here. This may be a good argument to make this option recommended for R.

> Shouldn't the portable files check only be performed on the shipped
> source code?

False negatives are possible too, in case the installation stage
(configure and/or make) performs a lot of preprocessing, or unpacks
extra sources. You could be right; I don't have statistics to back
either option as less wasteful of effort.

-- 
Best regards,
Ivan


From j|@c@@hu|@m@n @end|ng |rom gm@||@com  Tue Aug 13 10:17:40 2024
From: j|@c@@hu|@m@n @end|ng |rom gm@||@com (Jisca Huisman)
Date: Tue, 13 Aug 2024 10:17:40 +0200
Subject: [R-pkg-devel] Build process generated non-portable files
In-Reply-To: <20240813110814.21a43010@Tarkus>
References: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
 <20240813110814.21a43010@Tarkus>
Message-ID: <1581c0ce-a066-4436-9c46-2b170ef3ea8f@gmail.com>

> I'm not familar with fortran but the warning message is: "Found the following files with non-portbale usage of KIND:." In "Writing R Extensions/Writing portable packages/Portable Fortran code" it mentions the use of REAL(KIND=8)? types are not portable since compilers can map values to different types (and these declarations are in the f90 files), but the compiler called the preprocessing of the files so it should be correct for this specific compiler.

This might actually be the main problem. As it says, REAL(KIND=8) does 
not have a consistent defintion, but the most common definition is 
double the precision of a default REAL (commonly KIND=8). So, replacing 
all 'REAL(KIND=8)' by 'DOUBLE PRECISION' in declarations should (might) 
solve the error message. Alternatively, you could use 
selected_real_kind(), see 
https://fortranwiki.org/fortran/show/Real+precision .

Best,

Jisca



On Tue, 13/08/2024 10:08, Ivan Krylov via R-package-devel wrote:
> ? Mon, 12 Aug 2024 18:24:30 +0000
> David via R-package-devel <r-package-devel at r-project.org> ?????:
>
>> in the intel environment (provided by rhub), the intel fortran
>> compiler generates intermediary files from *.f -> *__genmod.f90. The
>> R check then complains that the genmod files are not portable. I
>> include removal of the files in my cleanup file so the files do not
>> exist in the original package source or in the final source tarball
>> but it seems the portable files check is done after compilation but
>> before cleanup.
>>
>> - Is there a way to get around this complaint?
> Include the first 'all' target in your Makevars, make it depend on the
> package shared library, and make it remove genmod files in the recipe:
>
> all: $(SHLIB)
> 	-rm -f arpack/*genmod.f90
>
> A similar trick is mentioned in
> <https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Using-Makevars>.
>
>> - Should this complaint be here in the first place?
> Perhaps not. If you manage to find an option for the ifx compiler that
> disables creation of these files (a brief Web search says they are for
> only the user to read, but most results are from early 2010's), post it
> here. This may be a good argument to make this option recommended for R.
>
>> Shouldn't the portable files check only be performed on the shipped
>> source code?
> False negatives are possible too, in case the installation stage
> (configure and/or make) performs a lot of preprocessing, or unpacks
> extra sources. You could be right; I don't have statistics to back
> either option as less wasteful of effort.
>


From @@j5xsj9 m@iii@g oii @iiiy@@ddy@io  Thu Aug 15 20:58:39 2024
From: @@j5xsj9 m@iii@g oii @iiiy@@ddy@io (@@j5xsj9 m@iii@g oii @iiiy@@ddy@io)
Date: Thu, 15 Aug 2024 18:58:39 +0000
Subject: [R-pkg-devel] Build process generated non-portable files
In-Reply-To: <20240813110814.21a43010@Tarkus>
References: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
 <20240813110814.21a43010@Tarkus>
Message-ID: <5301b8e64edc0ce9e85e272a60cd5535@nilly.addy.io>

This seems like it should work. Unfortunately my rhub github actions is failing to get past the setup deps step which has been occuring inconsistently in the past but right now it's consistently failing to build deps so I can't confirm it work. I was also unable to successfully build R using intel compilers, even when using Rhubs container as template.

> Include the first 'all' target in your Makevars

I was really trying to avoid explicitly creating a target in makevars but this is simple enough.

In case anyone else comes across this, the genmod files end up in `src` even if the original source files are under a subdirectory so the recipe ends up being:

> -rm -f *genmod.f90

> If you manage to find an option for the ifx compiler that disables creation of these files

I installed intel compilers and checked the `ifx` man page. Could not find an option for turning off generation of the genmod files.

> a brief Web search says they are for only the user to read, but most results are from early 2010's

Yeah I checked one of the files again and it does say that it's generated only for reference.

?- David R. Connell

On Tuesday, August 13th, 2024 at 3:08 AM, Ivan Krylov 'ikrylov at disroot.org' wrote:

> ? Mon, 12 Aug 2024 18:24:30 +0000
> David via R-package-devel r-package-devel at r-project.org ?????:
> 
> > in the intel environment (provided by rhub), the intel fortran
> > compiler generates intermediary files from *.f -> *__genmod.f90. The
> > R check then complains that the genmod files are not portable. I
> > include removal of the files in my cleanup file so the files do not
> > exist in the original package source or in the final source tarball
> > but it seems the portable files check is done after compilation but
> > before cleanup.
> > 
> > - Is there a way to get around this complaint?
> 
> 
> Include the first 'all' target in your Makevars, make it depend on the
> package shared library, and make it remove genmod files in the recipe:
> 
> all: $(SHLIB)
> -rm -f arpack/*genmod.f90
> 
> A similar trick is mentioned in
> https://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Using-Makevars.
> 
> > - Should this complaint be here in the first place?
> 
> 
> Perhaps not. If you manage to find an option for the ifx compiler that
> disables creation of these files (a brief Web search says they are for
> only the user to read, but most results are from early 2010's), post it
> here. This may be a good argument to make this option recommended for R.
> 
> > Shouldn't the portable files check only be performed on the shipped
> > source code?
> 
> 
> False negatives are possible too, in case the installation stage
> (configure and/or make) performs a lot of preprocessing, or unpacks
> extra sources. You could be right; I don't have statistics to back
> either option as less wasteful of effort.
> 
> --
> Best regards,
> Ivan


From |kry|ov @end|ng |rom d|@root@org  Fri Aug 16 14:58:41 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Fri, 16 Aug 2024 15:58:41 +0300
Subject: [R-pkg-devel] Build process generated non-portable files
In-Reply-To: <94db9a3e5dcb79a6629143e1752a2816@nilly.addy.io>
References: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
 <20240813110814.21a43010@Tarkus>
 <94db9a3e5dcb79a6629143e1752a2816@nilly.addy.io>
Message-ID: <20240816155841.456cfd2f@arachnoid>

? Thu, 15 Aug 2024 18:58:41 +0000
anj5xsj9 at nilly.addy.io ?????:

> This seems like it should work. Unfortunately my rhub github actions
> is failing to get past the setup deps step which has been occuring
> inconsistently in the past but right now it's consistently failing to
> build deps so I can't confirm it work.

This may be worth reporting to the rhub developers. The error is really
strange. It looks like the package at
https://github.com/cran/igraph/releases/download/2.0.3/igraph_2.0.3_b1_R4.5_x86_64-pc-linux-gnu-fedora-38.tar.gz
(referenced from https://github.com/r-hub/repos) has a binary
dependency on OpenBLAS:

$ readelf -d igraph/libs/igraph.so | grep openblas
0x0000000000000001 (NEEDED) Shared library: [libopenblasp.so.0]

...but that's either not noted or not installed correctly.

> I was also unable to successfully build R using intel compilers, even
> when using Rhubs container as template.

If you'd like to dig deeper, feel free to ask here with details.
 
> In case anyone else comes across this, the genmod files end up in
> `src` even if the original source files are under a subdirectory so
> the recipe ends up being:
> 
> > -rm -f *genmod.f90  

Thank you for letting us know!
 
> I installed intel compilers and checked the `ifx` man page. Could not
> find an option for turning off generation of the genmod files.

I experimented with the "ghcr.io/r-hub/containers/intel:latest"
container and was able to find out that the option -[no]gen-interfaces
controls the generation of *__genmod* files:

/opt/intel/oneapi/compiler/latest/bin/ifx -O3 -fp-model precise \
 -warn all,noexternals -c -o arpack/dgetv0.o arpack/dgetv0.f; \
 ls *genmod*
#  ...
# dgetv0__genmod.f90  dgetv0__genmod.mod
rm -vf *genmod*
# removed 'dgetv0__genmod.f90'
# removed 'dgetv0__genmod.mod'
/opt/intel/oneapi/compiler/latest/bin/ifx -nogen-interfaces -O3 \
 -fp-model precise -warn all,noexternals -c -o arpack/dgetv0.o \
 arpack/dgetv0.f; \
 ls *genmod*
#  ...
# ls: cannot access '*genmod*': No such file or directory

This option is already used as part of the "Intel" additional checks
performed by Prof. Brian D. Ripley, so the *__genmod.* files should not
be a problem on CRAN:
https://svn.r-project.org/R-dev-web/trunk/CRAN/QA/BDR/gannet/Intel/config.site

-- 
Best regards,
Ivan


From kev|n@r@coombe@ @end|ng |rom gm@||@com  Fri Aug 16 19:25:36 2024
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Fri, 16 Aug 2024 13:25:36 -0400
Subject: [R-pkg-devel] Inherited methods
Message-ID: <afbd9900-31ac-4a9b-996a-2d27417c5c7f@gmail.com>

Hi,

I seem to have gotten myself confused about inheritance of S4 classes 
and the dispatch of inherited methods.

The core situation is that

  * The graphics package already defines the function "hist"
  * My package A creates an S4 generic "hist", using the existing
    function as the default method.
  * Package A also defines a class B with its own implementation of the
    method "hist". It exports both the generic method and the class B
    specific method.
  * Now I create a new package C. In that package, I define a new class
    D that inherits from class B. The implementation of "hist" for class
    B should do everything I want for class D, so I don't want to have
    to re-implement it.

My question: what do I have to do to enable users of package D to call 
"hist(B)" and have it work without complaint? After many go-rounds of 
changing the code, changing the NAMESPACE, and running "R CMD check" 
approximately an infinite number of times, I now have

NAMESPACE:
importMethodFrom("A", "hist")
exportMethod("hist")

R SCRIPT:
setClass("D", slots = c(some_extra_stuff), contains = "B")

setMethod("hist", "D", function(x, ...) {
 ? callNextMethod(x, ...)
 ? invisible(x)
})

Do I really need all that? Why do I even need *any* of it? Shouldn't I 
be able to leave out the implementation that just says "callNextMethod" 
and have the standard dispatch figure out what to call? Why does it want 
to call the default function if it knows there is a B-method? (And it 
must know it, since callNextMethod knows it.)

Confused,
 ?? Kevin

	[[alternative HTML version deleted]]


From kev|n@r@coombe@ @end|ng |rom gm@||@com  Fri Aug 16 19:32:57 2024
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Fri, 16 Aug 2024 13:32:57 -0400
Subject: [R-pkg-devel] R CMD check options
Message-ID: <52ea54f5-2a6a-4a6b-bb5d-2309f8c86f1f@gmail.com>

Hi,

I maintain a bunch of packages on CRAN. When updating packages, I often 
find two sort of NOTES on some of the platforms that CRAN checks that 
don't show up on my stupid Windows (I know that's redundant; you don't 
have to tell me) machine at home. The two most common issues are

  * spelling (especially in the DESCRIPTION file), and
  * links in the documentation with missing package anchors.

How do I enable these checks so that when I run "R CMD check --as-cran" 
it actually does behave like those CRAN machines do, so I can find and 
fix the issues before submitting the package?

Thanks,
 ? Kevin


	[[alternative HTML version deleted]]


From @@j5xsj9 m@iii@g oii @iiiy@@ddy@io  Fri Aug 16 20:53:49 2024
From: @@j5xsj9 m@iii@g oii @iiiy@@ddy@io (@@j5xsj9 m@iii@g oii @iiiy@@ddy@io)
Date: Fri, 16 Aug 2024 18:53:49 +0000
Subject: [R-pkg-devel] Build process generated non-portable files
In-Reply-To: <20240816155841.456cfd2f@arachnoid>
References: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
 <20240813110814.21a43010@Tarkus>
 <94db9a3e5dcb79a6629143e1752a2816@nilly.addy.io>
 <20240816155841.456cfd2f@arachnoid>
Message-ID: <17411dc6e7509077db21c3a0dfcb1020@nilly.addy.io>

I locally ran the rhub intel docker and that was much easier to set up. So I can now confirm the change to Makevars does work.

> I experimented with the "ghcr.io/r-hub/containers/intel:latest" container and was able to find out that the option -[no]gen-interfaces controls the generation of __genmod files:

You are right. I temporarily removed the changes to Makevar and added the `-nogen-interfaces` flag to FFLAGS and that also prevented the warning. I can open an issue at rhub and suggest adding that as a default for the intel compilers.

> This may be worth reporting to the rhub developers. The error is really strange. It looks like the package at https://github.com/cran/igraph/releases/download/2.0.3/igraph_2.0.3_b1_R4.5_x86_64-pc-linux-gnu-fedora-38.tar.gz

The strange thing is the intel container on github actions has succeeded in the past but now is consistently failing to build `targets`:

> ? Failed to build targets 1.7.1 (2.1s)
> Error: 
> ! error in pak subprocess
> Caused by error in `stop_task_build(state, worker)`:
> ! Failed to build source package targets.
> Full installation output:
> * installing *source* package ?targets? ...
> ** package ?targets? successfully unpacked and MD5 sums checked
> staged installation is only possible with locking
> ** using non-staged installation
> ** R
> ** inst
> ** byte-compile and prepare package for lazy loading
> Error in dyn.load(file, DLLpath = DLLpath, ...) : 
>   unable to load shared object '/github/home/R/x86_64-pc-linux-gnu-library/4.5/igraph/libs/igraph.so':
>   libopenblasp.so.0: cannot open shared object file: No such file or directory
> Calls: <Anonymous> ... asNamespace -> loadNamespace -> library.dynam -> dyn.load
> Execution halted
> ERROR: lazy loading failed for package ?targets?
> * removing ?/tmp/RtmpLpWRX0/pkg-lib3c3299c227c/targets?

Which is related to the igraph issue you mentioned. Checking the packages installed in a previous successful intel action, targets was not listed. I don't know why it's being installed now but not previously, I haven't changed dependencies.

In the past other packages have failed to build and not only on the intel container see "https://github.com/SpeakEasy-2/speakeasyR/actions/runs/10202337528/job/28226219457" where several containers failed at the setup-deps step. There is overlap in which package fails (i.e. protGenerics and sparseArray fail in multiple containers but succeed in others while in one container ExperimentHub fails). It seems the only packages failing are from Bioconductor. Assume this is a bioconductor or pak issue.

The issue with igraph is interesting though since I do use the igraph package for some examples and inside the intel container, R CMD build has no problem running igraph. Inspecting the resulting tarball shows the html version of my vignette contains results that depends on running igraph code and my test using igraph succeeds with R CMD check. Yet when I run R inside the container and try to load the igraph library or run code via `igraph::` I get an error

> > igraph::sample_pref(10)
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>  unable to load shared object '/root/R/x86_64-pc-linux-gnu-library/4.5/igraph/libs/igraph.so':
>  libopenblasp.so.0: cannot open shared object file: No such file or directory

I.e. the same error with building targets. I can raise an issue on rigraph as well.

?- David R. Connell

On Friday, August 16th, 2024 at 7:58 AM, Ivan Krylov 'ikrylov at disroot.org' wrote:

> ? Thu, 15 Aug 2024 18:58:41 +0000
> anj5xsj9 at nilly.addy.io ?????:
> 
> > This seems like it should work. Unfortunately my rhub github actions
> > is failing to get past the setup deps step which has been occuring
> > inconsistently in the past but right now it's consistently failing to
> > build deps so I can't confirm it work.
> 
> 
> This may be worth reporting to the rhub developers. The error is really
> strange. It looks like the package at
> https://github.com/cran/igraph/releases/download/2.0.3/igraph_2.0.3_b1_R4.5_x86_64-pc-linux-gnu-fedora-38.tar.gz
> (referenced from https://github.com/r-hub/repos) has a binary
> dependency on OpenBLAS:
> 
> $ readelf -d igraph/libs/igraph.so | grep openblas
> 0x0000000000000001 (NEEDED) Shared library: [libopenblasp.so.0]
> 
> ...but that's either not noted or not installed correctly.
> 
> > I was also unable to successfully build R using intel compilers, even
> > when using Rhubs container as template.
> 
> 
> If you'd like to dig deeper, feel free to ask here with details.
> 
> > In case anyone else comes across this, the genmod files end up in
> > `src` even if the original source files are under a subdirectory so
> > the recipe ends up being:
> > 
> > > -rm -f *genmod.f90
> 
> 
> Thank you for letting us know!
> 
> > I installed intel compilers and checked the `ifx` man page. Could not
> > find an option for turning off generation of the genmod files.
> 
> 
> I experimented with the "ghcr.io/r-hub/containers/intel:latest"
> container and was able to find out that the option -[no]gen-interfaces
> controls the generation of __genmod files:
> 
> /opt/intel/oneapi/compiler/latest/bin/ifx -O3 -fp-model precise \
> -warn all,noexternals -c -o arpack/dgetv0.o arpack/dgetv0.f; \
> ls genmod
> # ...
> # dgetv0__genmod.f90 dgetv0__genmod.mod
> rm -vf genmod
> # removed 'dgetv0__genmod.f90'
> # removed 'dgetv0__genmod.mod'
> /opt/intel/oneapi/compiler/latest/bin/ifx -nogen-interfaces -O3 \
> -fp-model precise -warn all,noexternals -c -o arpack/dgetv0.o \
> arpack/dgetv0.f; \
> ls genmod
> # ...
> # ls: cannot access 'genmod': No such file or directory
> 
> This option is already used as part of the "Intel" additional checks
> performed by Prof. Brian D. Ripley, so the __genmod. files should not
> be a problem on CRAN:
> https://svn.r-project.org/R-dev-web/trunk/CRAN/QA/BDR/gannet/Intel/config.site
> 
> --
> Best regards,
> Ivan


From georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk  Sat Aug 17 11:05:52 2024
From: georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk (Georgi Boshnakov)
Date: Sat, 17 Aug 2024 09:05:52 +0000
Subject: [R-pkg-devel] R CMD check options
In-Reply-To: <52ea54f5-2a6a-4a6b-bb5d-2309f8c86f1f@gmail.com>
References: <52ea54f5-2a6a-4a6b-bb5d-2309f8c86f1f@gmail.com>
Message-ID: <LO0P265MB6325F7552088F7CB5C642014AE822@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>

In most cases, installing a recent version of R-devel will do (here, the check with it will show the notes about missing package anchors).

Georgi Boshnakov 

________________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Kevin R. Coombes <kevin.r.coombes at gmail.com>
Sent: 16 August 2024 18:32
To: r-package-devel at r-project.org
Subject: [R-pkg-devel] R CMD check options

Hi, I maintain a bunch of packages on CRAN. When updating packages, I often find two sort of NOTES on some of the platforms that CRAN checks that don't show up on my stupid Windows (I know that's redundant; you don't have to tell me) machine
ZjQcmQRYFpfptBannerStart
This Message Is From a New External Sender
You have not previously corresponded with this sender. Please exercise caution when opening links or attachments included in this message.

ZjQcmQRYFpfptBannerEnd

Hi,

I maintain a bunch of packages on CRAN. When updating packages, I often
find two sort of NOTES on some of the platforms that CRAN checks that
don't show up on my stupid Windows (I know that's redundant; you don't
have to tell me) machine at home. The two most common issues are

  * spelling (especially in the DESCRIPTION file), and
  * links in the documentation with missing package anchors.

How do I enable these checks so that when I run "R CMD check --as-cran"
it actually does behave like those CRAN machines do, so I can find and
fix the issues before submitting the package?

Thanks,
   Kevin


        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!E2Ma-V8bhj8k-YfGsRWAQHNJSG51USXTaeHl8IHyVh3CnziYF9t3isoCoR3Lzs13rfjPktwG-mm5LBdm2sWKZVxnV7PDLaqoBMEpMJI$[stat[.]ethz[.]ch]



From ||@t@ @end|ng |rom dewey@myzen@co@uk  Sat Aug 17 14:45:15 2024
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Sat, 17 Aug 2024 13:45:15 +0100
Subject: [R-pkg-devel] R CMD check options
In-Reply-To: <LO0P265MB6325F7552088F7CB5C642014AE822@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
References: <52ea54f5-2a6a-4a6b-bb5d-2309f8c86f1f@gmail.com>
 <LO0P265MB6325F7552088F7CB5C642014AE822@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <6ac7a7fe-a549-7551-a02f-af63258a19ae@dewey.myzen.co.uk>

And if all else fails submit to Winbuilder using the R-devel branch.

Michael

On 17/08/2024 10:05, Georgi Boshnakov wrote:
> In most cases, installing a recent version of R-devel will do (here, the check with it will show the notes about missing package anchors).
> 
> Georgi Boshnakov
> 
> ________________________________________
> From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Kevin R. Coombes <kevin.r.coombes at gmail.com>
> Sent: 16 August 2024 18:32
> To: r-package-devel at r-project.org
> Subject: [R-pkg-devel] R CMD check options
> 
> Hi, I maintain a bunch of packages on CRAN. When updating packages, I often find two sort of NOTES on some of the platforms that CRAN checks that don't show up on my stupid Windows (I know that's redundant; you don't have to tell me) machine
> ZjQcmQRYFpfptBannerStart
> This Message Is From a New External Sender
> You have not previously corresponded with this sender. Please exercise caution when opening links or attachments included in this message.
> 
> ZjQcmQRYFpfptBannerEnd
> 
> Hi,
> 
> I maintain a bunch of packages on CRAN. When updating packages, I often
> find two sort of NOTES on some of the platforms that CRAN checks that
> don't show up on my stupid Windows (I know that's redundant; you don't
> have to tell me) machine at home. The two most common issues are
> 
>    * spelling (especially in the DESCRIPTION file), and
>    * links in the documentation with missing package anchors.
> 
> How do I enable these checks so that when I run "R CMD check --as-cran"
> it actually does behave like those CRAN machines do, so I can find and
> fix the issues before submitting the package?
> 
> Thanks,
>     Kevin
> 
> 
>          [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!E2Ma-V8bhj8k-YfGsRWAQHNJSG51USXTaeHl8IHyVh3CnziYF9t3isoCoR3Lzs13rfjPktwG-mm5LBdm2sWKZVxnV7PDLaqoBMEpMJI$[stat[.]ethz[.]ch]
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 

-- 
Michael


From bbo|ker @end|ng |rom gm@||@com  Sat Aug 17 15:17:40 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sat, 17 Aug 2024 09:17:40 -0400
Subject: [R-pkg-devel] R CMD check options
In-Reply-To: <6ac7a7fe-a549-7551-a02f-af63258a19ae@dewey.myzen.co.uk>
References: <52ea54f5-2a6a-4a6b-bb5d-2309f8c86f1f@gmail.com>
 <LO0P265MB6325F7552088F7CB5C642014AE822@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
 <6ac7a7fe-a549-7551-a02f-af63258a19ae@dewey.myzen.co.uk>
Message-ID: <CABghstQQ2+z5i0o04vrDxGt8WjtGTHetYrqiic55OAGgLXpWZg@mail.gmail.com>

Slight thread hijacking: does there exist/has someone compiled a list of
the environment variables that determine R CMD check's behaviour?

On Sat, Aug 17, 2024, 9:03 AM Michael Dewey <lists at dewey.myzen.co.uk> wrote:

> And if all else fails submit to Winbuilder using the R-devel branch.
>
> Michael
>
> On 17/08/2024 10:05, Georgi Boshnakov wrote:
> > In most cases, installing a recent version of R-devel will do (here, the
> check with it will show the notes about missing package anchors).
> >
> > Georgi Boshnakov
> >
> > ________________________________________
> > From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf
> of Kevin R. Coombes <kevin.r.coombes at gmail.com>
> > Sent: 16 August 2024 18:32
> > To: r-package-devel at r-project.org
> > Subject: [R-pkg-devel] R CMD check options
> >
> > Hi, I maintain a bunch of packages on CRAN. When updating packages, I
> often find two sort of NOTES on some of the platforms that CRAN checks that
> don't show up on my stupid Windows (I know that's redundant; you don't have
> to tell me) machine
> > ZjQcmQRYFpfptBannerStart
> > This Message Is From a New External Sender
> > You have not previously corresponded with this sender. Please exercise
> caution when opening links or attachments included in this message.
> >
> > ZjQcmQRYFpfptBannerEnd
> >
> > Hi,
> >
> > I maintain a bunch of packages on CRAN. When updating packages, I often
> > find two sort of NOTES on some of the platforms that CRAN checks that
> > don't show up on my stupid Windows (I know that's redundant; you don't
> > have to tell me) machine at home. The two most common issues are
> >
> >    * spelling (especially in the DESCRIPTION file), and
> >    * links in the documentation with missing package anchors.
> >
> > How do I enable these checks so that when I run "R CMD check --as-cran"
> > it actually does behave like those CRAN machines do, so I can find and
> > fix the issues before submitting the package?
> >
> > Thanks,
> >     Kevin
> >
> >
> >          [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> >
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!PDiH4ENfjr2_Jw!E2Ma-V8bhj8k-YfGsRWAQHNJSG51USXTaeHl8IHyVh3CnziYF9t3isoCoR3Lzs13rfjPktwG-mm5LBdm2sWKZVxnV7PDLaqoBMEpMJI$[stat[.]ethz[.]ch]
> >
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
> --
> Michael
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Sat Aug 17 15:24:31 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Sat, 17 Aug 2024 16:24:31 +0300
Subject: [R-pkg-devel] R CMD check options
In-Reply-To: <CABghstQQ2+z5i0o04vrDxGt8WjtGTHetYrqiic55OAGgLXpWZg@mail.gmail.com>
References: <52ea54f5-2a6a-4a6b-bb5d-2309f8c86f1f@gmail.com>
 <LO0P265MB6325F7552088F7CB5C642014AE822@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
 <6ac7a7fe-a549-7551-a02f-af63258a19ae@dewey.myzen.co.uk>
 <CABghstQQ2+z5i0o04vrDxGt8WjtGTHetYrqiic55OAGgLXpWZg@mail.gmail.com>
Message-ID: <20240817162431.3a7727da@trisector>

? Sat, 17 Aug 2024 09:17:40 -0400
Ben Bolker <bbolker at gmail.com> ?????:

> does there exist/has someone compiled a list of
> the environment variables that determine R CMD check's behaviour?

https://cran.r-project.org/doc/manuals/R-ints.html#Tools

But the _R_CHECK_CRAN_INCOMING_USE_ASPELL_ variable that Kevin would
need to set to "TRUE" in order to enable the spell checks is not
documented there.

-- 
Best regards,
Ivan


From |kry|ov @end|ng |rom d|@root@org  Sat Aug 17 16:22:32 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Sat, 17 Aug 2024 17:22:32 +0300
Subject: [R-pkg-devel] Build process generated non-portable files
In-Reply-To: <32c21f19cb644375bc4790dce67725fa@nilly.addy.io>
References: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
 <20240813110814.21a43010@Tarkus>
 <94db9a3e5dcb79a6629143e1752a2816@nilly.addy.io>
 <20240816155841.456cfd2f@arachnoid>
 <32c21f19cb644375bc4790dce67725fa@nilly.addy.io>
Message-ID: <20240817172232.03f94a10@trisector>

? Fri, 16 Aug 2024 18:53:55 +0000
anj5xsj9 at nilly.addy.io ?????:

> In the past other packages have failed to build and not only on the
> intel container see
> "https://github.com/SpeakEasy-2/speakeasyR/actions/runs/10202337528/job/28226219457"
> where several containers failed at the setup-deps step. There is
> overlap in which package fails (i.e. protGenerics and sparseArray
> fail in multiple containers but succeed in others while in one
> container ExperimentHub fails). It seems the only packages failing
> are from Bioconductor. Assume this is a bioconductor or pak issue.

Could also be an rhub issue, although unlike the igraph problem below,
I have no idea where to start diagnosing it.

> > > igraph::sample_pref(10)  
> > Error in dyn.load(file, DLLpath = DLLpath, ...) :
> >  unable to load shared object
> > '/root/R/x86_64-pc-linux-gnu-library/4.5/igraph/libs/igraph.so':
> > libopenblasp.so.0: cannot open shared object file: No such file or
> > directory  
> 
> I.e. the same error with building targets. I can raise an issue on
> rigraph as well.

This is a problem with the binary package used by rhub. If you
reinstall the source package from CRAN instead of
https://github.com/r-hub/repos and
https://github.com/cran/igraph/releases/, it will work, but take much
more time compiling the package:

options(repos = getOption('repos')['CRAN'])
install.packages('igraph')

-- 
Best regards,
Ivan


From edd @end|ng |rom deb|@n@org  Sat Aug 17 16:33:24 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sat, 17 Aug 2024 09:33:24 -0500
Subject: [R-pkg-devel] Build process generated non-portable files
In-Reply-To: <20240817172232.03f94a10@trisector>
References: <3f8d2aec95fb552733dc236aa611130e@nilly.addy.io>
 <20240813110814.21a43010@Tarkus>
 <94db9a3e5dcb79a6629143e1752a2816@nilly.addy.io>
 <20240816155841.456cfd2f@arachnoid>
 <32c21f19cb644375bc4790dce67725fa@nilly.addy.io>
 <20240817172232.03f94a10@trisector>
Message-ID: <26304.46260.827467.518754@rob.eddelbuettel.com>


On 17 August 2024 at 17:22, Ivan Krylov via R-package-devel wrote:
| ? Fri, 16 Aug 2024 18:53:55 +0000
| anj5xsj9 at nilly.addy.io ?????:
| 
| > In the past other packages have failed to build and not only on the
| > intel container see
| > "https://github.com/SpeakEasy-2/speakeasyR/actions/runs/10202337528/job/28226219457"
| > where several containers failed at the setup-deps step. There is
| > overlap in which package fails (i.e. protGenerics and sparseArray
| > fail in multiple containers but succeed in others while in one
| > container ExperimentHub fails). It seems the only packages failing
| > are from Bioconductor. Assume this is a bioconductor or pak issue.
| 
| Could also be an rhub issue, although unlike the igraph problem below,
| I have no idea where to start diagnosing it.
| 
| > > > igraph::sample_pref(10)  
| > > Error in dyn.load(file, DLLpath = DLLpath, ...) :
| > >  unable to load shared object
| > > '/root/R/x86_64-pc-linux-gnu-library/4.5/igraph/libs/igraph.so':
| > > libopenblasp.so.0: cannot open shared object file: No such file or
| > > directory  
| > 
| > I.e. the same error with building targets. I can raise an issue on
| > rigraph as well.
| 
| This is a problem with the binary package used by rhub. If you
| reinstall the source package from CRAN instead of
| https://github.com/r-hub/repos and
| https://github.com/cran/igraph/releases/, it will work, but take much
| more time compiling the package:
| 
| options(repos = getOption('repos')['CRAN'])
| install.packages('igraph')

The r2u binaries can offer help here for running on Ubuntu. They are a
'superset' of the same p3m binaries but aim to (and generally manage to)
provide working binaries. I just validated via a Docker container running it:

edd at rob:~$ docker run --rm -ti rocker/r2u:jammy bash
root at 64a8b23a9bc7:/# install.r igraph    # install.packages() works too
[ ... log of installation of 14 binaries omitted here ... ]
root at 64a8b23a9bc7:/# R

R version 4.4.1 (2024-06-14) -- "Race for Your Life"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(igraph)

Attaching package: ?igraph?

The following objects are masked from ?package:stats?:

    decompose, spectrum

The following object is masked from ?package:base?:

    union

> 


Best, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kev|n@r@coombe@ @end|ng |rom gm@||@com  Sat Aug 17 16:58:16 2024
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Sat, 17 Aug 2024 10:58:16 -0400
Subject: [R-pkg-devel] R CMD check options
In-Reply-To: <20240817162431.3a7727da@trisector>
References: <52ea54f5-2a6a-4a6b-bb5d-2309f8c86f1f@gmail.com>
 <LO0P265MB6325F7552088F7CB5C642014AE822@LO0P265MB6325.GBRP265.PROD.OUTLOOK.COM>
 <6ac7a7fe-a549-7551-a02f-af63258a19ae@dewey.myzen.co.uk>
 <CABghstQQ2+z5i0o04vrDxGt8WjtGTHetYrqiic55OAGgLXpWZg@mail.gmail.com>
 <20240817162431.3a7727da@trisector>
Message-ID: <9d390252-f6b9-4fa8-9f45-740544dd4db6@gmail.com>

Thank you!

On 8/17/2024 9:24 AM, Ivan Krylov wrote:
> ? Sat, 17 Aug 2024 09:17:40 -0400
> Ben Bolker <bbolker at gmail.com> ?????:
>
>> does there exist/has someone compiled a list of
>> the environment variables that determine R CMD check's behaviour?
> https://cran.r-project.org/doc/manuals/R-ints.html#Tools
>
> But the _R_CHECK_CRAN_INCOMING_USE_ASPELL_ variable that Kevin would
> need to set to "TRUE" in order to enable the spell checks is not
> documented there.
>


From edd @end|ng |rom deb|@n@org  Mon Aug 19 14:54:22 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 19 Aug 2024 07:54:22 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
Message-ID: <26307.16510.300799.974636@rob.eddelbuettel.com>


Has anybody written a quick helper function that extracts the Authors at R field
from tools::CRAN_package_db() and 'stems' it into 'Name, Firstname, ORCID'
which one could use to look up ORCID IDs at CRAN? The lookup at orcid.org
sometimes gives us 'private entries' that make it harder / impossible to
confirm a match. Having a normalised matrix or data.frame (or ...) would also
make it easier to generate Authors at R.

Cheers, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From th|erry@onke||nx @end|ng |rom |nbo@be  Mon Aug 19 15:15:22 2024
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Mon, 19 Aug 2024 15:15:22 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26307.16510.300799.974636@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
Message-ID: <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>

Dear Dirk,

Maybe checklist:::author2df() might be useful. It is an unexported function
from my checklist package. It converts a person() object to a dataframe.
https://github.com/inbo/checklist/blob/5649985b58693acb88337873ae14a7d5bc018d96/R/store_authors.R#L38

df <- tools::CRAN_package_db()
lapply(
  df$`Authors at R`[df$Package  %in% c("git2rdata", "qrcode")],
  function(x) {
    parse(text = x) |>
      eval() |>
      vapply(checklist:::author2df, vector(mode = "list", 1)) |>
      do.call(what = rbind)
  }
)

[[1]]
    given       family                       email               orcid
affiliation usage
1 Thierry     Onkelinx    thierry.onkelinx at inbo.be 0000-0001-8804-4216
       <NA>     1
2  Floris Vanderhaeghe floris.vanderhaeghe at inbo.be 0000-0002-6378-6229
       <NA>     1
3   Peter       Desmet        peter.desmet at inbo.be 0000-0002-8442-8025
       <NA>     1
4     Els     Lommelen        els.lommelen at inbo.be 0000-0002-3481-5684
       <NA>     1

[[2]]
    given   family                 email               orcid affiliation usage
1 Thierry Onkelinx qrcode at muscardinus.be 0000-0001-8804-4216        <NA>     1
2  Victor      Teh   victorteh at gmail.com


ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
*Postadres:* Koning Albert II-laan 15 bus 186, 1210 Brussel
*Poststukken die naar dit adres worden gestuurd, worden ingescand en
digitaal aan de geadresseerde bezorgd. Zo kan de Vlaamse overheid haar
dossiers volledig digitaal behandelen. Poststukken met de vermelding
?vertrouwelijk? worden niet ingescand, maar ongeopend aan de geadresseerde
bezorgd.*
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op ma 19 aug 2024 om 14:54 schreef Dirk Eddelbuettel <edd at debian.org>:

>
> Has anybody written a quick helper function that extracts the Authors at R
> field
> from tools::CRAN_package_db() and 'stems' it into 'Name, Firstname, ORCID'
> which one could use to look up ORCID IDs at CRAN? The lookup at orcid.org
> sometimes gives us 'private entries' that make it harder / impossible to
> confirm a match. Having a normalised matrix or data.frame (or ...) would
> also
> make it easier to generate Authors at R.
>
> Cheers, Dirk
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Mon Aug 19 15:39:04 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 19 Aug 2024 08:39:04 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
Message-ID: <26307.19192.825552.550821@rob.eddelbuettel.com>


On 19 August 2024 at 15:15, Thierry Onkelinx wrote:
| Maybe checklist:::author2df() might be useful. It is an unexported function
| from my checklist package. It converts a person() object to a dataframe.
| https://github.com/inbo/checklist/blob/5649985b58693acb88337873ae14a7d5bc018d96
| /R/store_authors.R#L38
| 
| df <- tools::CRAN_package_db()
| lapply(
| ? df$`Authors at R`[df$Package ?%in% c("git2rdata", "qrcode")],
| ? function(x) {
| ? ? parse(text = x) |>
| ? ? ? eval() |>
| ? ? ? vapply(checklist:::author2df, vector(mode = "list", 1)) |>
| ? ? ? do.call(what = rbind)
| ? }
| )
| 
| 
| [[1]]
|     given       family                       email               orcid affiliation usage
| 1 Thierry     Onkelinx    thierry.onkelinx at inbo.be 0000-0001-8804-4216        <NA>     1
| 2  Floris Vanderhaeghe floris.vanderhaeghe at inbo.be 0000-0002-6378-6229        <NA>     1
| 3   Peter       Desmet        peter.desmet at inbo.be 0000-0002-8442-8025        <NA>     1
| 4     Els     Lommelen        els.lommelen at inbo.be 0000-0002-3481-5684        <NA>     1
| 
| [[2]]
|     given   family                 email               orcid affiliation usage
| 1 Thierry Onkelinx qrcode at muscardinus.be 0000-0001-8804-4216        <NA>     1
| 2  Victor      Teh   victorteh at gmail.com  

That's a very nice start, thank you. (Will also look more closely at
checklist.)  It needs an `na.omit()` or alike, and even with that `rbind`
barked a few entries in (i = 19 if you select the full vector right now).

But definitely something to play with and possibly build upon. Thanks!  (And
the IDs of Floris and you were two of the ones I 'manually' added to a
DESCRIPTION file ;-)

Best,  Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From th|erry@onke||nx @end|ng |rom |nbo@be  Tue Aug 20 13:43:20 2024
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Tue, 20 Aug 2024 13:43:20 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26307.19192.825552.550821@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
Message-ID: <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>

Hi Dirk,

Happy to help. I'm working on a new version of the checklist package. I
could export the function if that makes it easier for you.

Best regards,

Thierry

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
*Postadres:* Koning Albert II-laan 15 bus 186, 1210 Brussel
*Poststukken die naar dit adres worden gestuurd, worden ingescand en
digitaal aan de geadresseerde bezorgd. Zo kan de Vlaamse overheid haar
dossiers volledig digitaal behandelen. Poststukken met de vermelding
?vertrouwelijk? worden niet ingescand, maar ongeopend aan de geadresseerde
bezorgd.*
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op ma 19 aug 2024 om 15:39 schreef Dirk Eddelbuettel <edd at debian.org>:

>
> On 19 August 2024 at 15:15, Thierry Onkelinx wrote:
> | Maybe checklist:::author2df() might be useful. It is an unexported
> function
> | from my checklist package. It converts a person() object to a dataframe.
> |
> https://github.com/inbo/checklist/blob/5649985b58693acb88337873ae14a7d5bc018d96
> | /R/store_authors.R#L38
> |
> | df <- tools::CRAN_package_db()
> | lapply(
> |   df$`Authors at R`[df$Package  %in% c("git2rdata", "qrcode")],
> |   function(x) {
> |     parse(text = x) |>
> |       eval() |>
> |       vapply(checklist:::author2df, vector(mode = "list", 1)) |>
> |       do.call(what = rbind)
> |   }
> | )
> |
> |
> | [[1]]
> |     given       family                       email               orcid
> affiliation usage
> | 1 Thierry     Onkelinx    thierry.onkelinx at inbo.be 0000-0001-8804-4216
>       <NA>     1
> | 2  Floris Vanderhaeghe floris.vanderhaeghe at inbo.be 0000-0002-6378-6229
>       <NA>     1
> | 3   Peter       Desmet        peter.desmet at inbo.be 0000-0002-8442-8025
>       <NA>     1
> | 4     Els     Lommelen        els.lommelen at inbo.be 0000-0002-3481-5684
>       <NA>     1
> |
> | [[2]]
> |     given   family                 email               orcid affiliation
> usage
> | 1 Thierry Onkelinx qrcode at muscardinus.be 0000-0001-8804-4216
> <NA>     1
> | 2  Victor      Teh   victorteh at gmail.com
>
> That's a very nice start, thank you. (Will also look more closely at
> checklist.)  It needs an `na.omit()` or alike, and even with that `rbind`
> barked a few entries in (i = 19 if you select the full vector right now).
>
> But definitely something to play with and possibly build upon. Thanks!
> (And
> the IDs of Floris and you were two of the ones I 'manually' added to a
> DESCRIPTION file ;-)
>
> Best,  Dirk
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Aug 20 13:50:20 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 20 Aug 2024 06:50:20 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
Message-ID: <26308.33532.40021.698529@rob.eddelbuettel.com>


Salut Thierry,

On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
| Happy to help. I'm working on a new version of the checklist package. I could
| export the function if that makes it easier for you.

Would be happy to help / iterate. Can you take a stab at making the
per-column split more robust so that we can bulk-process all non-NA entries
of the returned db?

Best, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Tue Aug 20 14:29:50 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Tue, 20 Aug 2024 14:29:50 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.33532.40021.698529@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
Message-ID: <26308.35902.672739.512614@hornik.net>

>>>>> Dirk Eddelbuettel writes:

Dirk et al,

Sorry for not replying any sooner :-)

I think for now you could use something like what I attach below.

Not ideal: I had not too long ago starting adding orcidtools.R to tools,
which e.g. has .persons_from_metadata(), but that works on the unpacked
sources and not the CRAN package db.  Need to think about that ...

Best
-k

********************************************************************
x <- tools::CRAN_package_db()
a <- lapply(x[["Authors at R"]],
            function(a) {
                if(!is.na(a)) {
                    a <- tryCatch(utils:::.read_authors_at_R_field(a), 
                                  error = identity)
                    if (inherits(a, "person")) 
                        return(a)
                }
                NULL
            })
a <- do.call(c, a)
a <- lapply(a,
            function(e) {
                if(is.null(o <- e$comment["ORCID"]) || is.na(o))
                    return(NULL)
                cbind(given = paste(e$given, collapse = " "),
                      family = paste(e$family, collapse = " "),
                      oid = unname(o))
            })
a <- as.data.frame(do.call(rbind, a))
********************************************************************

> Salut Thierry,

> On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
> | Happy to help. I'm working on a new version of the checklist package. I could
> | export the function if that makes it easier for you.

> Would be happy to help / iterate. Can you take a stab at making the
> per-column split more robust so that we can bulk-process all non-NA entries
> of the returned db?

> Best, Dirk

> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd @end|ng |rom deb|@n@org  Tue Aug 20 14:57:14 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 20 Aug 2024 07:57:14 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.35902.672739.512614@hornik.net>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
Message-ID: <26308.37546.287996.39155@rob.eddelbuettel.com>


Hi Kurt,

On 20 August 2024 at 14:29, Kurt Hornik wrote:
| I think for now you could use something like what I attach below.
| 
| Not ideal: I had not too long ago starting adding orcidtools.R to tools,
| which e.g. has .persons_from_metadata(), but that works on the unpacked
| sources and not the CRAN package db.  Need to think about that ...

We need something like that too as I fat-fingered the string 'ORCID'. See
fortune::fortunes("Dirk can type").

Will the function below later. Many thanks for sending it along.

Dirk

| 
| Best
| -k
| 
| ********************************************************************
| x <- tools::CRAN_package_db()
| a <- lapply(x[["Authors at R"]],
|             function(a) {
|                 if(!is.na(a)) {
|                     a <- tryCatch(utils:::.read_authors_at_R_field(a), 
|                                   error = identity)
|                     if (inherits(a, "person")) 
|                         return(a)
|                 }
|                 NULL
|             })
| a <- do.call(c, a)
| a <- lapply(a,
|             function(e) {
|                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
|                     return(NULL)
|                 cbind(given = paste(e$given, collapse = " "),
|                       family = paste(e$family, collapse = " "),
|                       oid = unname(o))
|             })
| a <- as.data.frame(do.call(rbind, a))
| ********************************************************************
| 
| > Salut Thierry,
| 
| > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
| > | Happy to help. I'm working on a new version of the checklist package. I could
| > | export the function if that makes it easier for you.
| 
| > Would be happy to help / iterate. Can you take a stab at making the
| > per-column split more robust so that we can bulk-process all non-NA entries
| > of the returned db?
| 
| > Best, Dirk
| 
| > -- 
| > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From chr|@ho|d @end|ng |rom p@yctc@org  Tue Aug 20 15:13:24 2024
From: chr|@ho|d @end|ng |rom p@yctc@org (Chris Evans)
Date: Tue, 20 Aug 2024 15:13:24 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.37546.287996.39155@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
Message-ID: <a9afccbb-8ccc-4a26-b624-59a42ec599c9@psyctc.org>

As I think that should be

fortunes::fortune("Dirk can type")

rather than

fortune::fortunes("Dirk can type")

I think that has become both recursive and demonstrating excellent 
test-retest stability!? Oh boy do I know that issue!

Chris

On 20/08/2024 14:57, Dirk Eddelbuettel wrote:
> Hi Kurt,
>
> On 20 August 2024 at 14:29, Kurt Hornik wrote:
> | I think for now you could use something like what I attach below.
> |
> | Not ideal: I had not too long ago starting adding orcidtools.R to tools,
> | which e.g. has .persons_from_metadata(), but that works on the unpacked
> | sources and not the CRAN package db.  Need to think about that ...
>
> We need something like that too as I fat-fingered the string 'ORCID'. See
> fortune::fortunes("Dirk can type").
>
> Will the function below later. Many thanks for sending it along.
>
> Dirk
>
> |
> | Best
> | -k
> |
> | ********************************************************************
> | x <- tools::CRAN_package_db()
> | a <- lapply(x[["Authors at R"]],
> |             function(a) {
> |                 if(!is.na(a)) {
> |                     a <- tryCatch(utils:::.read_authors_at_R_field(a),
> |                                   error = identity)
> |                     if (inherits(a, "person"))
> |                         return(a)
> |                 }
> |                 NULL
> |             })
> | a <- do.call(c, a)
> | a <- lapply(a,
> |             function(e) {
> |                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
> |                     return(NULL)
> |                 cbind(given = paste(e$given, collapse = " "),
> |                       family = paste(e$family, collapse = " "),
> |                       oid = unname(o))
> |             })
> | a <- as.data.frame(do.call(rbind, a))
> | ********************************************************************
> |
> | > Salut Thierry,
> |
> | > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
> | > | Happy to help. I'm working on a new version of the checklist package. I could
> | > | export the function if that makes it easier for you.
> |
> | > Would be happy to help / iterate. Can you take a stab at making the
> | > per-column split more robust so that we can bulk-process all non-NA entries
> | > of the returned db?
> |
> | > Best, Dirk
> |
> | > --
> | > dirk.eddelbuettel.com | @eddelbuettel |edd at debian.org
>
-- 
Chris Evans (he/him)
Visiting Professor, UDLA, Quito, Ecuador & Honorary Professor, 
University of Roehampton, London, UK.
Work web site: https://www.psyctc.org/psyctc/
CORE site: http://www.coresystemtrust.org.uk/
Personal site: https://www.psyctc.org/pelerinage2016/
Emeetings (Thursdays): 
https://www.psyctc.org/psyctc/booking-meetings-with-me/
(Beware: French time, generally an hour ahead of UK)
<https://ombook.psyctc.org/book>
	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Aug 20 15:29:19 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 20 Aug 2024 08:29:19 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <a9afccbb-8ccc-4a26-b624-59a42ec599c9@psyctc.org>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <a9afccbb-8ccc-4a26-b624-59a42ec599c9@psyctc.org>
Message-ID: <26308.39471.752585.593306@rob.eddelbuettel.com>


On 20 August 2024 at 15:13, Chris Evans wrote:
| As I think that should be
| 
| fortunes::fortune("Dirk can type")
| 
| rather than
| 
| fortune::fortunes("Dirk can type")

Yes, thank you. I also failed to run that post through CI and testing before
sending.  Doing too many things at once...

Dirk
 
| I think that has become both recursive and demonstrating excellent 
| test-retest stability!? Oh boy do I know that issue!
| 
| Chris
| 
| On 20/08/2024 14:57, Dirk Eddelbuettel wrote:
| > Hi Kurt,
| >
| > On 20 August 2024 at 14:29, Kurt Hornik wrote:
| > | I think for now you could use something like what I attach below.
| > |
| > | Not ideal: I had not too long ago starting adding orcidtools.R to tools,
| > | which e.g. has .persons_from_metadata(), but that works on the unpacked
| > | sources and not the CRAN package db.  Need to think about that ...
| >
| > We need something like that too as I fat-fingered the string 'ORCID'. See
| > fortune::fortunes("Dirk can type").
| >
| > Will the function below later. Many thanks for sending it along.
| >
| > Dirk
| >
| > |
| > | Best
| > | -k
| > |
| > | ********************************************************************
| > | x <- tools::CRAN_package_db()
| > | a <- lapply(x[["Authors at R"]],
| > |             function(a) {
| > |                 if(!is.na(a)) {
| > |                     a <- tryCatch(utils:::.read_authors_at_R_field(a),
| > |                                   error = identity)
| > |                     if (inherits(a, "person"))
| > |                         return(a)
| > |                 }
| > |                 NULL
| > |             })
| > | a <- do.call(c, a)
| > | a <- lapply(a,
| > |             function(e) {
| > |                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
| > |                     return(NULL)
| > |                 cbind(given = paste(e$given, collapse = " "),
| > |                       family = paste(e$family, collapse = " "),
| > |                       oid = unname(o))
| > |             })
| > | a <- as.data.frame(do.call(rbind, a))
| > | ********************************************************************
| > |
| > | > Salut Thierry,
| > |
| > | > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
| > | > | Happy to help. I'm working on a new version of the checklist package. I could
| > | > | export the function if that makes it easier for you.
| > |
| > | > Would be happy to help / iterate. Can you take a stab at making the
| > | > per-column split more robust so that we can bulk-process all non-NA entries
| > | > of the returned db?
| > |
| > | > Best, Dirk
| > |
| > | > --
| > | > dirk.eddelbuettel.com | @eddelbuettel |edd at debian.org
| >
| -- 
| Chris Evans (he/him)
| Visiting Professor, UDLA, Quito, Ecuador & Honorary Professor, 
| University of Roehampton, London, UK.
| Work web site: https://www.psyctc.org/psyctc/
| CORE site: http://www.coresystemtrust.org.uk/
| Personal site: https://www.psyctc.org/pelerinage2016/
| Emeetings (Thursdays): 
| https://www.psyctc.org/psyctc/booking-meetings-with-me/
| (Beware: French time, generally an hour ahead of UK)
| <https://ombook.psyctc.org/book>
| 	[[alternative HTML version deleted]]
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd @end|ng |rom deb|@n@org  Tue Aug 20 15:31:45 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 20 Aug 2024 08:31:45 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.37546.287996.39155@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
Message-ID: <26308.39617.980467.97910@rob.eddelbuettel.com>


On 20 August 2024 at 07:57, Dirk Eddelbuettel wrote:
| 
| Hi Kurt,
| 
| On 20 August 2024 at 14:29, Kurt Hornik wrote:
| | I think for now you could use something like what I attach below.
| | 
| | Not ideal: I had not too long ago starting adding orcidtools.R to tools,
| | which e.g. has .persons_from_metadata(), but that works on the unpacked
| | sources and not the CRAN package db.  Need to think about that ...
| 
| We need something like that too as I fat-fingered the string 'ORCID'. See
| fortune::fortunes("Dirk can type").
| 
| Will the function below later. Many thanks for sending it along.

Very nice. Resisted my common impulse to make it a data.table for easy
sorting via keys etc.  After running your code the line

   head(with(a, sort_by(a, ~ family + given)), 100)

shows that we need a bit more QA as person entries are not properly split
between 'family' and 'given', use the URL and that we have repeats.
Excluding those is next.

Dirk
 
| Dirk
| 
| | 
| | Best
| | -k
| | 
| | ********************************************************************
| | x <- tools::CRAN_package_db()
| | a <- lapply(x[["Authors at R"]],
| |             function(a) {
| |                 if(!is.na(a)) {
| |                     a <- tryCatch(utils:::.read_authors_at_R_field(a), 
| |                                   error = identity)
| |                     if (inherits(a, "person")) 
| |                         return(a)
| |                 }
| |                 NULL
| |             })
| | a <- do.call(c, a)
| | a <- lapply(a,
| |             function(e) {
| |                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
| |                     return(NULL)
| |                 cbind(given = paste(e$given, collapse = " "),
| |                       family = paste(e$family, collapse = " "),
| |                       oid = unname(o))
| |             })
| | a <- as.data.frame(do.call(rbind, a))
| | ********************************************************************
| | 
| | > Salut Thierry,
| | 
| | > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
| | > | Happy to help. I'm working on a new version of the checklist package. I could
| | > | export the function if that makes it easier for you.
| | 
| | > Would be happy to help / iterate. Can you take a stab at making the
| | > per-column split more robust so that we can bulk-process all non-NA entries
| | > of the returned db?
| | 
| | > Best, Dirk
| | 
| | > -- 
| | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
| 
| -- 
| dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Tue Aug 20 15:43:04 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Tue, 20 Aug 2024 15:43:04 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.39617.980467.97910@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
Message-ID: <26308.40296.318704.764186@hornik.net>

>>>>> Dirk Eddelbuettel writes:

> On 20 August 2024 at 07:57, Dirk Eddelbuettel wrote:
> | 
> | Hi Kurt,
> | 
> | On 20 August 2024 at 14:29, Kurt Hornik wrote:
> | | I think for now you could use something like what I attach below.
> | | 
> | | Not ideal: I had not too long ago starting adding orcidtools.R to tools,
> | | which e.g. has .persons_from_metadata(), but that works on the unpacked
> | | sources and not the CRAN package db.  Need to think about that ...
> | 
> | We need something like that too as I fat-fingered the string 'ORCID'. See
> | fortune::fortunes("Dirk can type").
> | 
> | Will the function below later. Many thanks for sending it along.

> Very nice. Resisted my common impulse to make it a data.table for easy
> sorting via keys etc.  After running your code the line

>    head(with(a, sort_by(a, ~ family + given)), 100)

> shows that we need a bit more QA as person entries are not properly split
> between 'family' and 'given', use the URL and that we have repeats.
> Excluding those is next.

Right.  One should canonicalize the ORCID (having the URLs is from being
nice) and then do unique() ...

Best
-k



> Dirk
 
> | Dirk
> | 
> | | 
> | | Best
> | | -k
> | | 
> | | ********************************************************************
> | | x <- tools::CRAN_package_db()
> | | a <- lapply(x[["Authors at R"]],
> | |             function(a) {
> | |                 if(!is.na(a)) {
> | |                     a <- tryCatch(utils:::.read_authors_at_R_field(a), 
> | |                                   error = identity)
> | |                     if (inherits(a, "person")) 
> | |                         return(a)
> | |                 }
> | |                 NULL
> | |             })
> | | a <- do.call(c, a)
> | | a <- lapply(a,
> | |             function(e) {
> | |                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
> | |                     return(NULL)
> | |                 cbind(given = paste(e$given, collapse = " "),
> | |                       family = paste(e$family, collapse = " "),
> | |                       oid = unname(o))
> | |             })
> | | a <- as.data.frame(do.call(rbind, a))
> | | ********************************************************************
> | | 
> | | > Salut Thierry,
> | | 
> | | > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
> | | > | Happy to help. I'm working on a new version of the checklist package. I could
> | | > | export the function if that makes it easier for you.
> | | 
> | | > Would be happy to help / iterate. Can you take a stab at making the
> | | > per-column split more robust so that we can bulk-process all non-NA entries
> | | > of the returned db?
> | | 
> | | > Best, Dirk
> | | 
> | | > -- 
> | | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> | 
> | -- 
> | dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Tue Aug 20 15:47:22 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Tue, 20 Aug 2024 15:47:22 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.40296.318704.764186@hornik.net>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net>
Message-ID: <26308.40554.894652.252504@hornik.net>

>>>>> Kurt Hornik writes:

The variant attaches drops the URL and does unique.

Hmm, the ones in

  head(with(a, sort_by(a, ~ family + given)), 100)

without a family look suspicious ...

Best
-k


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: orcid.R
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20240820/76546959/attachment.ksh>

-------------- next part --------------


>>>>> Dirk Eddelbuettel writes:
>> On 20 August 2024 at 07:57, Dirk Eddelbuettel wrote:
>> | 
>> | Hi Kurt,
>> | 
>> | On 20 August 2024 at 14:29, Kurt Hornik wrote:
>> | | I think for now you could use something like what I attach below.
>> | | 
>> | | Not ideal: I had not too long ago starting adding orcidtools.R to tools,
>> | | which e.g. has .persons_from_metadata(), but that works on the unpacked
>> | | sources and not the CRAN package db.  Need to think about that ...
>> | 
>> | We need something like that too as I fat-fingered the string 'ORCID'. See
>> | fortune::fortunes("Dirk can type").
>> | 
>> | Will the function below later. Many thanks for sending it along.

>> Very nice. Resisted my common impulse to make it a data.table for easy
>> sorting via keys etc.  After running your code the line

>> head(with(a, sort_by(a, ~ family + given)), 100)

>> shows that we need a bit more QA as person entries are not properly split
>> between 'family' and 'given', use the URL and that we have repeats.
>> Excluding those is next.

> Right.  One should canonicalize the ORCID (having the URLs is from being
> nice) and then do unique() ...

> Best
> -k



>> Dirk
 
>> | Dirk
>> | 
>> | | 
>> | | Best
>> | | -k
>> | | 
>> | | ********************************************************************
>> | | x <- tools::CRAN_package_db()
>> | | a <- lapply(x[["Authors at R"]],
>> | |             function(a) {
>> | |                 if(!is.na(a)) {
>> | |                     a <- tryCatch(utils:::.read_authors_at_R_field(a), 
>> | |                                   error = identity)
>> | |                     if (inherits(a, "person")) 
>> | |                         return(a)
>> | |                 }
>> | |                 NULL
>> | |             })
>> | | a <- do.call(c, a)
>> | | a <- lapply(a,
>> | |             function(e) {
>> | |                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
>> | |                     return(NULL)
>> | |                 cbind(given = paste(e$given, collapse = " "),
>> | |                       family = paste(e$family, collapse = " "),
>> | |                       oid = unname(o))
>> | |             })
>> | | a <- as.data.frame(do.call(rbind, a))
>> | | ********************************************************************
>> | | 
>> | | > Salut Thierry,
>> | | 
>> | | > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
>> | | > | Happy to help. I'm working on a new version of the checklist package. I could
>> | | > | export the function if that makes it easier for you.
>> | | 
>> | | > Would be happy to help / iterate. Can you take a stab at making the
>> | | > per-column split more robust so that we can bulk-process all non-NA entries
>> | | > of the returned db?
>> | | 
>> | | > Best, Dirk
>> | | 
>> | | > -- 
>> | | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> | 
>> | -- 
>> | dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

>> -- 
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

From bbo|ker @end|ng |rom gm@||@com  Tue Aug 20 15:58:49 2024
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Tue, 20 Aug 2024 09:58:49 -0400
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.40554.894652.252504@hornik.net>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net> <26308.40554.894652.252504@hornik.net>
Message-ID: <65590043-337b-4d89-b540-36fb5ba27101@gmail.com>

  Looking into one particular example,

https://github.com/seabbs/idmodelr/blob/master/DESCRIPTION

this appears to be the authors' fault:

Authors at R: c(
     person(given = "Sam Abbott",
            role = c("aut", "cre"),
            email = "contact at samabbott.co.uk",
            comment = c(ORCID = "0000-0001-8057-8037")),
     person(given = "Akira Endo",
            role = c("aut"),
            email = "akira.endo at lshtm.ac.uk",
            comment = c(ORCID = "0000-0001-6377-7296")))

   Maybe CRAN should start checking for missing 'family' fields in 
Authors at R ... ???

   cheers
    Ben Bolker

On 2024-08-20 9:47 a.m., Kurt Hornik wrote:
>>>>>> Kurt Hornik writes:
> 
> The variant attaches drops the URL and does unique.
> 
> Hmm, the ones in
> 
>    head(with(a, sort_by(a, ~ family + given)), 100)
> 
> without a family look suspicious ...
> 
> Best
> -k
> 
> 
> 
> 
>>>>>> Dirk Eddelbuettel writes:
>>> On 20 August 2024 at 07:57, Dirk Eddelbuettel wrote:
>>> |
>>> | Hi Kurt,
>>> |
>>> | On 20 August 2024 at 14:29, Kurt Hornik wrote:
>>> | | I think for now you could use something like what I attach below.
>>> | |
>>> | | Not ideal: I had not too long ago starting adding orcidtools.R to tools,
>>> | | which e.g. has .persons_from_metadata(), but that works on the unpacked
>>> | | sources and not the CRAN package db.  Need to think about that ...
>>> |
>>> | We need something like that too as I fat-fingered the string 'ORCID'. See
>>> | fortune::fortunes("Dirk can type").
>>> |
>>> | Will the function below later. Many thanks for sending it along.
> 
>>> Very nice. Resisted my common impulse to make it a data.table for easy
>>> sorting via keys etc.  After running your code the line
> 
>>> head(with(a, sort_by(a, ~ family + given)), 100)
> 
>>> shows that we need a bit more QA as person entries are not properly split
>>> between 'family' and 'given', use the URL and that we have repeats.
>>> Excluding those is next.
> 
>> Right.  One should canonicalize the ORCID (having the URLs is from being
>> nice) and then do unique() ...
> 
>> Best
>> -k
> 
> 
> 
>>> Dirk
>   
>>> | Dirk
>>> |
>>> | |
>>> | | Best
>>> | | -k
>>> | |
>>> | | ********************************************************************
>>> | | x <- tools::CRAN_package_db()
>>> | | a <- lapply(x[["Authors at R"]],
>>> | |             function(a) {
>>> | |                 if(!is.na(a)) {
>>> | |                     a <- tryCatch(utils:::.read_authors_at_R_field(a),
>>> | |                                   error = identity)
>>> | |                     if (inherits(a, "person"))
>>> | |                         return(a)
>>> | |                 }
>>> | |                 NULL
>>> | |             })
>>> | | a <- do.call(c, a)
>>> | | a <- lapply(a,
>>> | |             function(e) {
>>> | |                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
>>> | |                     return(NULL)
>>> | |                 cbind(given = paste(e$given, collapse = " "),
>>> | |                       family = paste(e$family, collapse = " "),
>>> | |                       oid = unname(o))
>>> | |             })
>>> | | a <- as.data.frame(do.call(rbind, a))
>>> | | ********************************************************************
>>> | |
>>> | | > Salut Thierry,
>>> | |
>>> | | > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
>>> | | > | Happy to help. I'm working on a new version of the checklist package. I could
>>> | | > | export the function if that makes it easier for you.
>>> | |
>>> | | > Would be happy to help / iterate. Can you take a stab at making the
>>> | | > per-column split more robust so that we can bulk-process all non-NA entries
>>> | | > of the returned db?
>>> | |
>>> | | > Best, Dirk
>>> | |
>>> | | > --
>>> | | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>> |
>>> | --
>>> | dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
>>> -- 
>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From th|erry@onke||nx @end|ng |rom |nbo@be  Tue Aug 20 16:25:25 2024
From: th|erry@onke||nx @end|ng |rom |nbo@be (Thierry Onkelinx)
Date: Tue, 20 Aug 2024 16:25:25 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <65590043-337b-4d89-b540-36fb5ba27101@gmail.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net> <26308.40554.894652.252504@hornik.net>
 <65590043-337b-4d89-b540-36fb5ba27101@gmail.com>
Message-ID: <CAJuCY5wLg3pV+u+rgakcti4BZFsEvEA9i-kB2a9pE=+mvpnjVg@mail.gmail.com>

Dear Ben,

This is as simple as setting mandatory given and family fields.
checklist::check_description() ensures that given and family are set unless
the role is "cph" or "fnd". Allowing for organisations to be listed with
only the given field.

The 0.4.1 branch of checklist
<https://github.com/inbo/checklist/tree/0.4.1> now
exports the author2df() function which now can handle objects of call
person, list, logical (NA) and NULL. Feedback is welcome.

library(checklist)
df <- tools::CRAN_package_db()
vapply(
  df$`Authors at R`[df$Package %in% c("git2rdata", "A3", "digest", "abe")],
  function(x) {
    parse(text = x) |>
      eval() |>
      list()
  },
  vector(mode = "list", 1)
) |>
  unname() |>
  author2df()

Best regards,

ir. Thierry Onkelinx
Statisticus / Statistician

Vlaamse Overheid / Government of Flanders
INSTITUUT VOOR NATUUR- EN BOSONDERZOEK / RESEARCH INSTITUTE FOR NATURE AND
FOREST
Team Biometrie & Kwaliteitszorg / Team Biometrics & Quality Assurance
thierry.onkelinx at inbo.be
Havenlaan 88 bus 73, 1000 Brussel
*Postadres:* Koning Albert II-laan 15 bus 186, 1210 Brussel
*Poststukken die naar dit adres worden gestuurd, worden ingescand en
digitaal aan de geadresseerde bezorgd. Zo kan de Vlaamse overheid haar
dossiers volledig digitaal behandelen. Poststukken met de vermelding
?vertrouwelijk? worden niet ingescand, maar ongeopend aan de geadresseerde
bezorgd.*
www.inbo.be

///////////////////////////////////////////////////////////////////////////////////////////
To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to say
what the experiment died of. ~ Sir Ronald Aylmer Fisher
The plural of anecdote is not data. ~ Roger Brinner
The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey
///////////////////////////////////////////////////////////////////////////////////////////

<https://www.inbo.be>


Op di 20 aug 2024 om 15:59 schreef Ben Bolker <bbolker at gmail.com>:

>   Looking into one particular example,
>
> https://github.com/seabbs/idmodelr/blob/master/DESCRIPTION
>
> this appears to be the authors' fault:
>
> Authors at R: c(
>      person(given = "Sam Abbott",
>             role = c("aut", "cre"),
>             email = "contact at samabbott.co.uk",
>             comment = c(ORCID = "0000-0001-8057-8037")),
>      person(given = "Akira Endo",
>             role = c("aut"),
>             email = "akira.endo at lshtm.ac.uk",
>             comment = c(ORCID = "0000-0001-6377-7296")))
>
>    Maybe CRAN should start checking for missing 'family' fields in
> Authors at R ... ???
>
>    cheers
>     Ben Bolker
>
> On 2024-08-20 9:47 a.m., Kurt Hornik wrote:
> >>>>>> Kurt Hornik writes:
> >
> > The variant attaches drops the URL and does unique.
> >
> > Hmm, the ones in
> >
> >    head(with(a, sort_by(a, ~ family + given)), 100)
> >
> > without a family look suspicious ...
> >
> > Best
> > -k
> >
> >
> >
> >
> >>>>>> Dirk Eddelbuettel writes:
> >>> On 20 August 2024 at 07:57, Dirk Eddelbuettel wrote:
> >>> |
> >>> | Hi Kurt,
> >>> |
> >>> | On 20 August 2024 at 14:29, Kurt Hornik wrote:
> >>> | | I think for now you could use something like what I attach below.
> >>> | |
> >>> | | Not ideal: I had not too long ago starting adding orcidtools.R to
> tools,
> >>> | | which e.g. has .persons_from_metadata(), but that works on the
> unpacked
> >>> | | sources and not the CRAN package db.  Need to think about that ...
> >>> |
> >>> | We need something like that too as I fat-fingered the string
> 'ORCID'. See
> >>> | fortune::fortunes("Dirk can type").
> >>> |
> >>> | Will the function below later. Many thanks for sending it along.
> >
> >>> Very nice. Resisted my common impulse to make it a data.table for easy
> >>> sorting via keys etc.  After running your code the line
> >
> >>> head(with(a, sort_by(a, ~ family + given)), 100)
> >
> >>> shows that we need a bit more QA as person entries are not properly
> split
> >>> between 'family' and 'given', use the URL and that we have repeats.
> >>> Excluding those is next.
> >
> >> Right.  One should canonicalize the ORCID (having the URLs is from being
> >> nice) and then do unique() ...
> >
> >> Best
> >> -k
> >
> >
> >
> >>> Dirk
> >
> >>> | Dirk
> >>> |
> >>> | |
> >>> | | Best
> >>> | | -k
> >>> | |
> >>> | |
> ********************************************************************
> >>> | | x <- tools::CRAN_package_db()
> >>> | | a <- lapply(x[["Authors at R"]],
> >>> | |             function(a) {
> >>> | |                 if(!is.na(a)) {
> >>> | |                     a <-
> tryCatch(utils:::.read_authors_at_R_field(a),
> >>> | |                                   error = identity)
> >>> | |                     if (inherits(a, "person"))
> >>> | |                         return(a)
> >>> | |                 }
> >>> | |                 NULL
> >>> | |             })
> >>> | | a <- do.call(c, a)
> >>> | | a <- lapply(a,
> >>> | |             function(e) {
> >>> | |                 if(is.null(o <- e$comment["ORCID"]) || is.na(o))
> >>> | |                     return(NULL)
> >>> | |                 cbind(given = paste(e$given, collapse = " "),
> >>> | |                       family = paste(e$family, collapse = " "),
> >>> | |                       oid = unname(o))
> >>> | |             })
> >>> | | a <- as.data.frame(do.call(rbind, a))
> >>> | |
> ********************************************************************
> >>> | |
> >>> | | > Salut Thierry,
> >>> | |
> >>> | | > On 20 August 2024 at 13:43, Thierry Onkelinx wrote:
> >>> | | > | Happy to help. I'm working on a new version of the checklist
> package. I could
> >>> | | > | export the function if that makes it easier for you.
> >>> | |
> >>> | | > Would be happy to help / iterate. Can you take a stab at making
> the
> >>> | | > per-column split more robust so that we can bulk-process all
> non-NA entries
> >>> | | > of the returned db?
> >>> | |
> >>> | | > Best, Dirk
> >>> | |
> >>> | | > --
> >>> | | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >>> |
> >>> | --
> >>> | dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >
> >>> --
> >>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >>>
> >>> ______________________________________________
> >>> R-package-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> Dr. Benjamin Bolker
> Professor, Mathematics & Statistics and Biology, McMaster University
> Director, School of Computational Science and Engineering
>  > E-mail is sent at my convenience; I don't expect replies outside of
> working hours.
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From kev|n@r@coombe@ @end|ng |rom gm@||@com  Tue Aug 20 17:51:03 2024
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Tue, 20 Aug 2024 11:51:03 -0400
Subject: [R-pkg-devel] Spell Check with Hunspell on Windows
Message-ID: <68c9f4e1-fe16-4f60-b317-f82a3c3e339e@gmail.com>

Hi,

This is a follow-up to an earlier question where I asked about R CMD 
check on Windows to be able to check R packages in a manner closer to 
the checks on CRAN machines before i submit (new or updated) packages.? 
 From the answers to the previous question, I learned the (magic) 
environment variable to set in order to trigger spell checks.

So, I then managed to install "hunspell" n my Windows machine. I have 
confirmed that hunspell works

  * from the command line
  * inside emacs
  * inside R when running the "aspell" (or "hunspell") command to check
    files. (Note that I do not need to set? the "program" argument to
    aspell in order for this to work.)

However, when I run R CMD check from the command line, I get the message:
 ??? ''No suitable spell-checker program found."

Is there some other environment variable or command line option that I 
have to set in order to get R CMD check to use "hunspell" instead of 
"aspell" or "ispell"?

Thanks,
 ? Kevin

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Aug 20 18:02:06 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 20 Aug 2024 12:02:06 -0400
Subject: [R-pkg-devel] Spell Check with Hunspell on Windows
In-Reply-To: <68c9f4e1-fe16-4f60-b317-f82a3c3e339e@gmail.com>
References: <68c9f4e1-fe16-4f60-b317-f82a3c3e339e@gmail.com>
Message-ID: <5d6cc0d9-3ba4-4610-b1c3-3451b2e5f768@gmail.com>

When running R CMD check I think the test is using

  Sys.which(c("aspell", "hunspell", "ispell"))

to find the spell check program, so the fact that the aspell() command 
worked in R suggests that the PATH that R CMD check saw is different 
than the one that R saw.  Were you running R from the command line when 
aspell() worked?

Duncan Murdoch

On 2024-08-20 11:51 a.m., Kevin R. Coombes wrote:
> Hi,
> 
> This is a follow-up to an earlier question where I asked about R CMD
> check on Windows to be able to check R packages in a manner closer to
> the checks on CRAN machines before i submit (new or updated) packages.
>   From the answers to the previous question, I learned the (magic)
> environment variable to set in order to trigger spell checks.
> 
> So, I then managed to install "hunspell" n my Windows machine. I have
> confirmed that hunspell works
> 
>    * from the command line
>    * inside emacs
>    * inside R when running the "aspell" (or "hunspell") command to check
>      files. (Note that I do not need to set? the "program" argument to
>      aspell in order for this to work.)
> 
> However, when I run R CMD check from the command line, I get the message:
>   ??? ''No suitable spell-checker program found."
> 
> Is there some other environment variable or command line option that I
> have to set in order to get R CMD check to use "hunspell" instead of
> "aspell" or "ispell"?
> 
> Thanks,
>   ? Kevin
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Wed Aug 21 14:43:05 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 21 Aug 2024 07:43:05 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26308.40554.894652.252504@hornik.net>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net>
 <26308.40554.894652.252504@hornik.net>
Message-ID: <26309.57561.42726.681094@rob.eddelbuettel.com>


On 20 August 2024 at 15:47, Kurt Hornik wrote:
| >>>>> Kurt Hornik writes:
| 
| The variant attaches drops the URL and does unique.

Nice. Alas, some of us default to r-release as the daily driver and then

  Error in unname(tools:::.ORCID_iD_canonicalize(o)) : 
    object '.ORCID_iD_canonicalize' not found
  > 

Will play with my 'RD' which I keep approximately 'weekly-current'. Quick
rebuild first.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Wed Aug 21 14:50:20 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Wed, 21 Aug 2024 14:50:20 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26309.57561.42726.681094@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net>
 <26308.40554.894652.252504@hornik.net>
 <26309.57561.42726.681094@rob.eddelbuettel.com>
Message-ID: <26309.57996.150219.355206@hornik.net>

>>>>> Dirk Eddelbuettel writes:

Meanwhile, I am close to committing a change to R-devel which adds
tools::CRAN_authors_db() with docs

  \code{CRAN_authors_db()} returns information on the authors of the
  current CRAN packages extracted from the \samp{Authors at R} fields in
  the package \file{DESCRIPTION} files, as a data frame with character
  columns giving the given and family names, email addresses,
  \abbr{ORCID} identifier, roles, and comments of the person entries,
  and the corresponding package.

Once make check-all is done ...

Best
-k

PS.  Sorry about tools:::.ORCID_iD_canonicalize(), had run into the same
issue when building the authors db on the CRAN master (which uses
current R release ...)

> On 20 August 2024 at 15:47, Kurt Hornik wrote:
> | >>>>> Kurt Hornik writes:
> | 
> | The variant attaches drops the URL and does unique.

> Nice. Alas, some of us default to r-release as the daily driver and then

>   Error in unname(tools:::.ORCID_iD_canonicalize(o)) : 
>     object '.ORCID_iD_canonicalize' not found
>> 

> Will play with my 'RD' which I keep approximately 'weekly-current'. Quick
> rebuild first.

> Dirk

> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd @end|ng |rom deb|@n@org  Wed Aug 21 14:54:00 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 21 Aug 2024 07:54:00 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26309.57561.42726.681094@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net>
 <26308.40554.894652.252504@hornik.net>
 <26309.57561.42726.681094@rob.eddelbuettel.com>
Message-ID: <26309.58216.837682.944710@rob.eddelbuettel.com>


On 21 August 2024 at 07:43, Dirk Eddelbuettel wrote:
| 
| On 20 August 2024 at 15:47, Kurt Hornik wrote:
| | >>>>> Kurt Hornik writes:
| | 
| | The variant attaches drops the URL and does unique.
| 
| Nice. Alas, some of us default to r-release as the daily driver and then
| 
|   Error in unname(tools:::.ORCID_iD_canonicalize(o)) : 
|     object '.ORCID_iD_canonicalize' not found
|   > 
| 
| Will play with my 'RD' which I keep approximately 'weekly-current'. Quick
| rebuild first.

As simple as adding

  .ORCID_iD_canonicalize <- function (x) sub(tools:::.ORCID_iD_variants_regexp, "\\3", x)

and making the call (or maybe making it a lambda anyway ...)

  oid = unname(.ORCID_iD_canonicalize(o)))

After adding

  a <- sort_by(a, ~ a$family + a$given)

the first 48 out if a (currently) total of 6465 are empty for family.

  > sum(a$family == "")
  [1] 48
  > 

Rest is great!

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Wed Aug 21 15:47:53 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Wed, 21 Aug 2024 15:47:53 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26309.57996.150219.355206@hornik.net>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net>
 <26308.40554.894652.252504@hornik.net>
 <26309.57561.42726.681094@rob.eddelbuettel.com>
 <26309.57996.150219.355206@hornik.net>
Message-ID: <26309.61449.590848.266355@hornik.net>

>>>>> Kurt Hornik writes:

Committed now.

Best
-k

>>>>> Dirk Eddelbuettel writes:
> Meanwhile, I am close to committing a change to R-devel which adds
> tools::CRAN_authors_db() with docs

>   \code{CRAN_authors_db()} returns information on the authors of the
>   current CRAN packages extracted from the \samp{Authors at R} fields in
>   the package \file{DESCRIPTION} files, as a data frame with character
>   columns giving the given and family names, email addresses,
>   \abbr{ORCID} identifier, roles, and comments of the person entries,
>   and the corresponding package.

> Once make check-all is done ...

> Best
> -k

> PS.  Sorry about tools:::.ORCID_iD_canonicalize(), had run into the same
> issue when building the authors db on the CRAN master (which uses
> current R release ...)

>> On 20 August 2024 at 15:47, Kurt Hornik wrote:
>> | >>>>> Kurt Hornik writes:
>> | 
>> | The variant attaches drops the URL and does unique.

>> Nice. Alas, some of us default to r-release as the daily driver and then

>> Error in unname(tools:::.ORCID_iD_canonicalize(o)) : 
>> object '.ORCID_iD_canonicalize' not found
>>> 

>> Will play with my 'RD' which I keep approximately 'weekly-current'. Quick
>> rebuild first.

>> Dirk

>> -- 
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd @end|ng |rom deb|@n@org  Wed Aug 21 15:56:57 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 21 Aug 2024 08:56:57 -0500
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26309.61449.590848.266355@hornik.net>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net>
 <26308.40554.894652.252504@hornik.net>
 <26309.57561.42726.681094@rob.eddelbuettel.com>
 <26309.57996.150219.355206@hornik.net>
 <26309.61449.590848.266355@hornik.net>
Message-ID: <26309.61993.756836.505160@rob.eddelbuettel.com>


On 21 August 2024 at 15:47, Kurt Hornik wrote:
| >>>>> Kurt Hornik writes:
| 
| Committed now.

That is just *lovely*:

   > aut <- tools::CRAN_authors_db()
   > dim(aut)
   [1] 47433     7
   > head(aut)
         given  family                     email               orcid     role comment       package
   1    Martin   Bladt    martinbladt at math.ku.dk                <NA> aut, cre    <NA> AalenJohansen
   2 Christian  Furrer         furrer at math.ku.dk                <NA>      aut    <NA> AalenJohansen
   3    Sercan Kahveci sercan.kahveci at plus.ac.at                <NA> aut, cre    <NA>      AATtools
   4    Andrew   Pilny        andy.pilny at uky.edu 0000-0001-6603-5490 aut, cre    <NA>   abasequence
   5   Sigbert  Klinke      sigbert at hu-berlin.de                <NA> aut, cre    <NA>    abbreviate
   6  Csillery Katalin   kati.csillery at gmail.com                <NA>      aut    <NA>           abc
   > 

Can we possibly get this into r-patched and the next r-release?

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Wed Aug 21 18:01:49 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Wed, 21 Aug 2024 18:01:49 +0200
Subject: [R-pkg-devel] ORCID ID finder via tools::CRAN_package_db() ?
In-Reply-To: <26309.61993.756836.505160@rob.eddelbuettel.com>
References: <26307.16510.300799.974636@rob.eddelbuettel.com>
 <CAJuCY5ycWMGu9RpVknkuwWLHKjsiBe+J1cQxwoF=B+MT-vc29g@mail.gmail.com>
 <26307.19192.825552.550821@rob.eddelbuettel.com>
 <CAJuCY5xaXjchJbA+k=kPLszP9GjXRFYjJbxduqE+6vZ0phcqxw@mail.gmail.com>
 <26308.33532.40021.698529@rob.eddelbuettel.com>
 <26308.35902.672739.512614@hornik.net>
 <26308.37546.287996.39155@rob.eddelbuettel.com>
 <26308.39617.980467.97910@rob.eddelbuettel.com>
 <26308.40296.318704.764186@hornik.net>
 <26308.40554.894652.252504@hornik.net>
 <26309.57561.42726.681094@rob.eddelbuettel.com>
 <26309.57996.150219.355206@hornik.net>
 <26309.61449.590848.266355@hornik.net>
 <26309.61993.756836.505160@rob.eddelbuettel.com>
Message-ID: <26310.3949.654647.24648@hornik.net>

>>>>> Dirk Eddelbuettel writes:

Possibly yes, if there is enough "need" :-)

Best
-k

> On 21 August 2024 at 15:47, Kurt Hornik wrote:
> | >>>>> Kurt Hornik writes:
> | 
> | Committed now.

> That is just *lovely*:

>> aut <- tools::CRAN_authors_db()
>> dim(aut)
>    [1] 47433     7
>> head(aut)
>          given  family                     email               orcid     role comment       package
>    1    Martin   Bladt    martinbladt at math.ku.dk                <NA> aut, cre    <NA> AalenJohansen
>    2 Christian  Furrer         furrer at math.ku.dk                <NA>      aut    <NA> AalenJohansen
>    3    Sercan Kahveci sercan.kahveci at plus.ac.at                <NA> aut, cre    <NA>      AATtools
>    4    Andrew   Pilny        andy.pilny at uky.edu 0000-0001-6603-5490 aut, cre    <NA>   abasequence
>    5   Sigbert  Klinke      sigbert at hu-berlin.de                <NA> aut, cre    <NA>    abbreviate
>    6  Csillery Katalin   kati.csillery at gmail.com                <NA>      aut    <NA>           abc
>> 

> Can we possibly get this into r-patched and the next r-release?

> Dirk

> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From j|ox @end|ng |rom mcm@@ter@c@  Mon Sep  2 17:34:09 2024
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Mon, 2 Sep 2024 11:34:09 -0400
Subject: [R-pkg-devel] unregistered S3 methods in a package
Message-ID: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>

Dear R-package-devel list members,

I want to introduce several unregistered S3 methods into the cv package 
(code at <https://github.com/gmonette/cv>). These methods have the form

	coef.merMod <- function(object, ...) lme4::fixef(object)

The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs 
rather than fixed effects, internally in the cv package but *not* to 
mask the lme4 version of the method for users of the cv package -- that 
could wreak havoc with their work. Doing this substantially simplifies 
some of the code in the cv package.

My question: Is it legitimate to define a method in a package for 
internal use without registering it?

This approach appears to work fine, and R CMD check doesn't complain, 
although Roxygen does complain that the method isn't "exported" 
(actually, isn't registered).

Any advice or relevant information would be appreciated.

Thank you,
  John
-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://www.john-fox.ca/
--


From j|ox @end|ng |rom mcm@@ter@c@  Mon Sep  2 20:57:58 2024
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Mon, 2 Sep 2024 14:57:58 -0400
Subject: [R-pkg-devel] unregistered S3 methods in a package
In-Reply-To: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
References: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
Message-ID: <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>

As it turned out, I was able to avoid redefining coef.merMod(), etc., by 
making a simple modification to the cv package.

I'm still curious about whether it's OK to have unregistered S3 methods 
for internal use in a package even though that's no longer necessary for 
the cv package.

On 2024-09-02 11:34 a.m., John Fox wrote:
> Caution: External email.
> 
> 
> Dear R-package-devel list members,
> 
> I want to introduce several unregistered S3 methods into the cv package
> (code at <https://github.com/gmonette/cv>). These methods have the form
> 
>  ?????? coef.merMod <- function(object, ...) lme4::fixef(object)
> 
> The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs
> rather than fixed effects, internally in the cv package but *not* to
> mask the lme4 version of the method for users of the cv package -- that
> could wreak havoc with their work. Doing this substantially simplifies
> some of the code in the cv package.
> 
> My question: Is it legitimate to define a method in a package for
> internal use without registering it?
> 
> This approach appears to work fine, and R CMD check doesn't complain,
> although Roxygen does complain that the method isn't "exported"
> (actually, isn't registered).
> 
> Any advice or relevant information would be appreciated.
> 
> Thank you,
>  ?John
> -- 
> John Fox, Professor Emeritus
> McMaster University
> Hamilton, Ontario, Canada
> web: https://www.john-fox.ca/
> -- 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From tdhock5 @end|ng |rom gm@||@com  Wed Sep  4 20:21:22 2024
From: tdhock5 @end|ng |rom gm@||@com (Toby Hocking)
Date: Wed, 4 Sep 2024 14:21:22 -0400
Subject: [R-pkg-devel] unregistered S3 methods in a package
In-Reply-To: <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>
References: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
 <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>
Message-ID: <CALK03d3aHJDTLQK7OoVWV=1721cM8k2fRxFGctyXupBxxf=xVQ@mail.gmail.com>

I got this warning too, so I filed an issue to ask
https://github.com/r-lib/roxygen2/issues/1654

On Mon, Sep 2, 2024 at 2:58?PM John Fox <jfox at mcmaster.ca> wrote:
>
> As it turned out, I was able to avoid redefining coef.merMod(), etc., by
> making a simple modification to the cv package.
>
> I'm still curious about whether it's OK to have unregistered S3 methods
> for internal use in a package even though that's no longer necessary for
> the cv package.
>
> On 2024-09-02 11:34 a.m., John Fox wrote:
> > Caution: External email.
> >
> >
> > Dear R-package-devel list members,
> >
> > I want to introduce several unregistered S3 methods into the cv package
> > (code at <https://github.com/gmonette/cv>). These methods have the form
> >
> >         coef.merMod <- function(object, ...) lme4::fixef(object)
> >
> > The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs
> > rather than fixed effects, internally in the cv package but *not* to
> > mask the lme4 version of the method for users of the cv package -- that
> > could wreak havoc with their work. Doing this substantially simplifies
> > some of the code in the cv package.
> >
> > My question: Is it legitimate to define a method in a package for
> > internal use without registering it?
> >
> > This approach appears to work fine, and R CMD check doesn't complain,
> > although Roxygen does complain that the method isn't "exported"
> > (actually, isn't registered).
> >
> > Any advice or relevant information would be appreciated.
> >
> > Thank you,
> >   John
> > --
> > John Fox, Professor Emeritus
> > McMaster University
> > Hamilton, Ontario, Canada
> > web: https://www.john-fox.ca/
> > --
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Wed Sep  4 23:12:09 2024
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Wed, 04 Sep 2024 14:12:09 -0700
Subject: [R-pkg-devel] unregistered S3 methods in a package
In-Reply-To: <CALK03d3aHJDTLQK7OoVWV=1721cM8k2fRxFGctyXupBxxf=xVQ@mail.gmail.com>
References: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
 <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>
 <CALK03d3aHJDTLQK7OoVWV=1721cM8k2fRxFGctyXupBxxf=xVQ@mail.gmail.com>
Message-ID: <F143B615-962D-4EB3-8D39-77C8A479E447@dcn.davis.ca.us>

I have been reluctant to pipe up on this because I am no expert on the dark corners of the S3 dispatch mechanism, but I think unregistered S3 methods in packages are verboten. Perhaps [1] will shed some light?

[1] https://blog.r-project.org/2019/08/19/s3-method-lookup/

On September 4, 2024 11:21:22 AM PDT, Toby Hocking <tdhock5 at gmail.com> wrote:
>I got this warning too, so I filed an issue to ask
>https://github.com/r-lib/roxygen2/issues/1654
>
>On Mon, Sep 2, 2024 at 2:58?PM John Fox <jfox at mcmaster.ca> wrote:
>>
>> As it turned out, I was able to avoid redefining coef.merMod(), etc., by
>> making a simple modification to the cv package.
>>
>> I'm still curious about whether it's OK to have unregistered S3 methods
>> for internal use in a package even though that's no longer necessary for
>> the cv package.
>>
>> On 2024-09-02 11:34 a.m., John Fox wrote:
>> > Caution: External email.
>> >
>> >
>> > Dear R-package-devel list members,
>> >
>> > I want to introduce several unregistered S3 methods into the cv package
>> > (code at <https://github.com/gmonette/cv>). These methods have the form
>> >
>> >         coef.merMod <- function(object, ...) lme4::fixef(object)
>> >
>> > The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs
>> > rather than fixed effects, internally in the cv package but *not* to
>> > mask the lme4 version of the method for users of the cv package -- that
>> > could wreak havoc with their work. Doing this substantially simplifies
>> > some of the code in the cv package.
>> >
>> > My question: Is it legitimate to define a method in a package for
>> > internal use without registering it?
>> >
>> > This approach appears to work fine, and R CMD check doesn't complain,
>> > although Roxygen does complain that the method isn't "exported"
>> > (actually, isn't registered).
>> >
>> > Any advice or relevant information would be appreciated.
>> >
>> > Thank you,
>> >   John
>> > --
>> > John Fox, Professor Emeritus
>> > McMaster University
>> > Hamilton, Ontario, Canada
>> > web: https://www.john-fox.ca/
>> > --
>> >
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From j|ox @end|ng |rom mcm@@ter@c@  Thu Sep  5 00:10:22 2024
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Wed, 4 Sep 2024 18:10:22 -0400
Subject: [R-pkg-devel] unregistered S3 methods in a package
In-Reply-To: <F143B615-962D-4EB3-8D39-77C8A479E447@dcn.davis.ca.us>
References: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
 <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>
 <CALK03d3aHJDTLQK7OoVWV=1721cM8k2fRxFGctyXupBxxf=xVQ@mail.gmail.com>
 <F143B615-962D-4EB3-8D39-77C8A479E447@dcn.davis.ca.us>
Message-ID: <1e4f4cfc-85ef-4220-947e-f080e56c70f5@mcmaster.ca>

Thanks Toby and Jeff for chiming in on this.

Jeff: I already read Kurt Hornik's post on "S3 Method Lookup" and quite 
a few other sources.

The main point is that failing to register the methods works in that the 
methods are nevertheless invoked internally by functions in the package 
but don't shadow versions of the methods registered by other package 
externally (e.g., at the command prompt), which was the effect that I 
wanted. Moreover, as I said, R CMD check (unlike roxygen) didn't complain.

As I mentioned, this is now moot for the cv package, but I'm still 
interested in the answer, as, apparently, is Toby.

Best,
  John

On 2024-09-04 5:12 p.m., Jeff Newmiller wrote:
> Caution: External email.
> 
> 
> I have been reluctant to pipe up on this because I am no expert on the dark corners of the S3 dispatch mechanism, but I think unregistered S3 methods in packages are verboten. Perhaps [1] will shed some light?
> 
> [1] https://blog.r-project.org/2019/08/19/s3-method-lookup/
> 
> On September 4, 2024 11:21:22 AM PDT, Toby Hocking <tdhock5 at gmail.com> wrote:
>> I got this warning too, so I filed an issue to ask
>> https://github.com/r-lib/roxygen2/issues/1654
>>
>> On Mon, Sep 2, 2024 at 2:58?PM John Fox <jfox at mcmaster.ca> wrote:
>>>
>>> As it turned out, I was able to avoid redefining coef.merMod(), etc., by
>>> making a simple modification to the cv package.
>>>
>>> I'm still curious about whether it's OK to have unregistered S3 methods
>>> for internal use in a package even though that's no longer necessary for
>>> the cv package.
>>>
>>> On 2024-09-02 11:34 a.m., John Fox wrote:
>>>> Caution: External email.
>>>>
>>>>
>>>> Dear R-package-devel list members,
>>>>
>>>> I want to introduce several unregistered S3 methods into the cv package
>>>> (code at <https://github.com/gmonette/cv>). These methods have the form
>>>>
>>>>          coef.merMod <- function(object, ...) lme4::fixef(object)
>>>>
>>>> The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs
>>>> rather than fixed effects, internally in the cv package but *not* to
>>>> mask the lme4 version of the method for users of the cv package -- that
>>>> could wreak havoc with their work. Doing this substantially simplifies
>>>> some of the code in the cv package.
>>>>
>>>> My question: Is it legitimate to define a method in a package for
>>>> internal use without registering it?
>>>>
>>>> This approach appears to work fine, and R CMD check doesn't complain,
>>>> although Roxygen does complain that the method isn't "exported"
>>>> (actually, isn't registered).
>>>>
>>>> Any advice or relevant information would be appreciated.
>>>>
>>>> Thank you,
>>>>    John
>>>> --
>>>> John Fox, Professor Emeritus
>>>> McMaster University
>>>> Hamilton, Ontario, Canada
>>>> web: https://www.john-fox.ca/
>>>> --
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> --
> Sent from my phone. Please excuse my brevity.


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu Sep  5 08:47:06 2024
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 5 Sep 2024 08:47:06 +0200
Subject: [R-pkg-devel] unregistered S3 methods in a package
In-Reply-To: <1e4f4cfc-85ef-4220-947e-f080e56c70f5@mcmaster.ca>
References: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
 <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>
 <CALK03d3aHJDTLQK7OoVWV=1721cM8k2fRxFGctyXupBxxf=xVQ@mail.gmail.com>
 <F143B615-962D-4EB3-8D39-77C8A479E447@dcn.davis.ca.us>
 <1e4f4cfc-85ef-4220-947e-f080e56c70f5@mcmaster.ca>
Message-ID: <d7cdb549-9dd0-4c10-a558-02d2c2cfe2e7@statistik.tu-dortmund.de>

Dear John,

the question is not really easy to answer, but there is a nice summary 
Kurt pointed me to: The code of checkS3methods() includes the following 
comments with the last paragraph containing the short answer to your 
question:

     ## Check S3 generics and methods consistency.

     ## Unfortunately, what is an S3 method is not clear.
     ## These days, S3 methods for a generic GEN are found
     ## A. via GEN.CLS lookup from the callenv to its topenv;
     ## B. the S3 registry;
     ## C. GEN.CLS lookup from the parent of the topenv to baseenv,
     ##    skipping everything on the search path between globalenv and
     ##    baseenv.
     ## Thus if "package code" calls GEN, we first look in the package
     ## namespace itself, then in the registry, and then in the package
     ## imports and .BaseNamespaceEnv (and globalenv and baseenv again).
     ##
     ## Clearly, everything registered via S3method() should be an S3
     ## method.  Interestingly, we seem to have some registrations for
     ## non-generics, such as grDevices::axis().  These are "harmless"
     ## but likely not "as intended", and hence inconsistencies are not
     ## ignored.
     ##
     ## If the package namespace has a function named GEN.CLS, it is used
     ## as an S3 method for an S3 generic named GEN (and hence "is an S3
     ## method") only if the package code actually calls GEN (see A
     ## above).  So one could argue that we should not be looking at all
     ## GEN.CLS matches with GEN a generic in the package itself, its
     ## imports or base, but restrict to only the ones where the package
     ## code calls GEN.  Doable, but not straightforward (calls could be
     ## PKG::GEN) and possibly quite time consuming.  For generics from
     ## the package itself or its imports, not restricting should not
     ## make a difference (why define or import when not calling?), but
     ## for generics from base it may: hence we filter out the mismatches
     ## for base GEN not called in the package.
     ##
     ## If a package provides an S3 generic GEN, there is no need to
     ## register GEN.CLS functions for "internal use" (see above).
     ## However, if GEN is exported then likely all GEN.CLS functions
     ## should be registered as S3 methods.


Best wishes,
Uwe


On 05.09.2024 00:10, John Fox wrote:
> Thanks Toby and Jeff for chiming in on this.
> 
> Jeff: I already read Kurt Hornik's post on "S3 Method Lookup" and quite 
> a few other sources.
> 
> The main point is that failing to register the methods works in that the 
> methods are nevertheless invoked internally by functions in the package 
> but don't shadow versions of the methods registered by other package 
> externally (e.g., at the command prompt), which was the effect that I 
> wanted. Moreover, as I said, R CMD check (unlike roxygen) didn't complain.
> 
> As I mentioned, this is now moot for the cv package, but I'm still 
> interested in the answer, as, apparently, is Toby.
> 
> Best,
>  ?John
> 
> On 2024-09-04 5:12 p.m., Jeff Newmiller wrote:
>> Caution: External email.
>>
>>
>> I have been reluctant to pipe up on this because I am no expert on the 
>> dark corners of the S3 dispatch mechanism, but I think unregistered S3 
>> methods in packages are verboten. Perhaps [1] will shed some light?
>>
>> [1] https://blog.r-project.org/2019/08/19/s3-method-lookup/
>>
>> On September 4, 2024 11:21:22 AM PDT, Toby Hocking <tdhock5 at gmail.com> 
>> wrote:
>>> I got this warning too, so I filed an issue to ask
>>> https://github.com/r-lib/roxygen2/issues/1654
>>>
>>> On Mon, Sep 2, 2024 at 2:58?PM John Fox <jfox at mcmaster.ca> wrote:
>>>>
>>>> As it turned out, I was able to avoid redefining coef.merMod(), 
>>>> etc., by
>>>> making a simple modification to the cv package.
>>>>
>>>> I'm still curious about whether it's OK to have unregistered S3 methods
>>>> for internal use in a package even though that's no longer necessary 
>>>> for
>>>> the cv package.
>>>>
>>>> On 2024-09-02 11:34 a.m., John Fox wrote:
>>>>> Caution: External email.
>>>>>
>>>>>
>>>>> Dear R-package-devel list members,
>>>>>
>>>>> I want to introduce several unregistered S3 methods into the cv 
>>>>> package
>>>>> (code at <https://github.com/gmonette/cv>). These methods have the 
>>>>> form
>>>>>
>>>>> ???????? coef.merMod <- function(object, ...) lme4::fixef(object)
>>>>>
>>>>> The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs
>>>>> rather than fixed effects, internally in the cv package but *not* to
>>>>> mask the lme4 version of the method for users of the cv package -- 
>>>>> that
>>>>> could wreak havoc with their work. Doing this substantially simplifies
>>>>> some of the code in the cv package.
>>>>>
>>>>> My question: Is it legitimate to define a method in a package for
>>>>> internal use without registering it?
>>>>>
>>>>> This approach appears to work fine, and R CMD check doesn't complain,
>>>>> although Roxygen does complain that the method isn't "exported"
>>>>> (actually, isn't registered).
>>>>>
>>>>> Any advice or relevant information would be appreciated.
>>>>>
>>>>> Thank you,
>>>>> ?? John
>>>>> -- 
>>>>> John Fox, Professor Emeritus
>>>>> McMaster University
>>>>> Hamilton, Ontario, Canada
>>>>> web: https://www.john-fox.ca/
>>>>> -- 
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> -- 
>> Sent from my phone. Please excuse my brevity.
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu Sep  5 09:44:52 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 5 Sep 2024 09:44:52 +0200
Subject: [R-pkg-devel] unregistered S3 methods in a package
In-Reply-To: <d7cdb549-9dd0-4c10-a558-02d2c2cfe2e7@statistik.tu-dortmund.de>
References: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
 <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>
 <CALK03d3aHJDTLQK7OoVWV=1721cM8k2fRxFGctyXupBxxf=xVQ@mail.gmail.com>
 <F143B615-962D-4EB3-8D39-77C8A479E447@dcn.davis.ca.us>
 <1e4f4cfc-85ef-4220-947e-f080e56c70f5@mcmaster.ca>
 <d7cdb549-9dd0-4c10-a558-02d2c2cfe2e7@statistik.tu-dortmund.de>
Message-ID: <26329.24948.135486.590205@stat.math.ethz.ch>

>>>>> Uwe Ligges 
>>>>>     on Thu, 5 Sep 2024 08:47:06 +0200 writes:

    > Dear John,
    > the question is not really easy to answer, but there is a nice summary 
    > Kurt pointed me to: The code of checkS3methods() includes the following 
    > comments with the last paragraph containing the short answer to your 
    > question:

    > ## Check S3 generics and methods consistency.

    > ## Unfortunately, what is an S3 method is not clear.
    > ## These days, S3 methods for a generic GEN are found
    > ## A. via GEN.CLS lookup from the callenv to its topenv;
    > ## B. the S3 registry;
    > ## C. GEN.CLS lookup from the parent of the topenv to baseenv,
    > ##    skipping everything on the search path between globalenv and
    > ##    baseenv.
    > ## Thus if "package code" calls GEN, we first look in the package
    > ## namespace itself, then in the registry, and then in the package
    > ## imports and .BaseNamespaceEnv (and globalenv and baseenv again).
    > ##
    > ## Clearly, everything registered via S3method() should be an S3
    > ## method.  Interestingly, we seem to have some registrations for
    > ## non-generics, such as grDevices::axis().  These are "harmless"
    > ## but likely not "as intended", and hence inconsistencies are not
    > ## ignored.
    > ##
    > ## If the package namespace has a function named GEN.CLS, it is used
    > ## as an S3 method for an S3 generic named GEN (and hence "is an S3
    > ## method") only if the package code actually calls GEN (see A
    > ## above).  So one could argue that we should not be looking at all
    > ## GEN.CLS matches with GEN a generic in the package itself, its
    > ## imports or base, but restrict to only the ones where the package
    > ## code calls GEN.  Doable, but not straightforward (calls could be
    > ## PKG::GEN) and possibly quite time consuming.  For generics from
    > ## the package itself or its imports, not restricting should not
    > ## make a difference (why define or import when not calling?), but
    > ## for generics from base it may: hence we filter out the mismatches
    > ## for base GEN not called in the package.
    > ##
    > ## If a package provides an S3 generic GEN, there is no need to
    > ## register GEN.CLS functions for "internal use" (see above).
    > ## However, if GEN is exported then likely all GEN.CLS functions
    > ## should be registered as S3 methods.

    > Best wishes,
    > Uwe

Excellent!  Thank you, Uwe, for digging this out.

I'd also had answered to John Fox (even more strongly)
that it *must* remain to be allowed to define "private"
S3 methods in a package in all cases:
- for a generic from the package (where the generic would also
  not be exported)
- for a generic from another package (which is imported)
  or base (which need not and cannot be imported).

Note that the same is possible with S4 and (AFAIK, untested)
with S7.  {which people should really try using more ... }

Martin



    > On 05.09.2024 00:10, John Fox wrote:
    >> Thanks Toby and Jeff for chiming in on this.
    >> 
    >> Jeff: I already read Kurt Hornik's post on "S3 Method Lookup" and quite 
    >> a few other sources.
    >> 
    >> The main point is that failing to register the methods works in that the 
    >> methods are nevertheless invoked internally by functions in the package 
    >> but don't shadow versions of the methods registered by other package 
    >> externally (e.g., at the command prompt), which was the effect that I 
    >> wanted. Moreover, as I said, R CMD check (unlike roxygen) didn't complain.
    >> 
    >> As I mentioned, this is now moot for the cv package, but I'm still 
    >> interested in the answer, as, apparently, is Toby.
    >> 
    >> Best,
    >> ?John
    >> 
    >> On 2024-09-04 5:12 p.m., Jeff Newmiller wrote:
    >>> Caution: External email.
    >>> 
    >>> 
    >>> I have been reluctant to pipe up on this because I am no expert on the 
    >>> dark corners of the S3 dispatch mechanism, but I think unregistered S3 
    >>> methods in packages are verboten. Perhaps [1] will shed some light?
    >>> 
    >>> [1] https://blog.r-project.org/2019/08/19/s3-method-lookup/
    >>> 
    >>> On September 4, 2024 11:21:22 AM PDT, Toby Hocking <tdhock5 at gmail.com> 
    >>> wrote:
    >>>> I got this warning too, so I filed an issue to ask
    >>>> https://github.com/r-lib/roxygen2/issues/1654
    >>>> 
    >>>> On Mon, Sep 2, 2024 at 2:58?PM John Fox <jfox at mcmaster.ca> wrote:
    >>>>> 
    >>>>> As it turned out, I was able to avoid redefining coef.merMod(), 
    >>>>> etc., by
    >>>>> making a simple modification to the cv package.
    >>>>> 
    >>>>> I'm still curious about whether it's OK to have unregistered S3 methods
    >>>>> for internal use in a package even though that's no longer necessary 
    >>>>> for
    >>>>> the cv package.
    >>>>> 
    >>>>> On 2024-09-02 11:34 a.m., John Fox wrote:
>>>>> Caution: External email.
    >>>>>> 
    >>>>>> 
>>>>> Dear R-package-devel list members,
    >>>>>> 
>>>>> I want to introduce several unregistered S3 methods into the cv 
>>>>> package
>>>>> (code at <https://github.com/gmonette/cv>). These methods have the 
>>>>> form
    >>>>>> 
>>>>> ???????? coef.merMod <- function(object, ...) lme4::fixef(object)
    >>>>>> 
>>>>> The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs
>>>>> rather than fixed effects, internally in the cv package but *not* to
>>>>> mask the lme4 version of the method for users of the cv package -- 
>>>>> that
>>>>> could wreak havoc with their work. Doing this substantially simplifies
>>>>> some of the code in the cv package.
    >>>>>> 
>>>>> My question: Is it legitimate to define a method in a package for
>>>>> internal use without registering it?
    >>>>>> 
>>>>> This approach appears to work fine, and R CMD check doesn't complain,
>>>>> although Roxygen does complain that the method isn't "exported"
>>>>> (actually, isn't registered).
    >>>>>> 
>>>>> Any advice or relevant information would be appreciated.
    >>>>>> 
>>>>> Thank you,
>>>>> ?? John
>>>>> -- 
>>>>> John Fox, Professor Emeritus
>>>>> McMaster University
>>>>> Hamilton, Ontario, Canada
>>>>> web: https://www.john-fox.ca/


From t@eyongp @end|ng |rom @ndrew@cmu@edu  Thu Sep  5 22:40:00 2024
From: t@eyongp @end|ng |rom @ndrew@cmu@edu (Taeyong Park)
Date: Thu, 5 Sep 2024 23:40:00 +0300
Subject: [R-pkg-devel] Error in creating virtual environment on Debian
 machines
Message-ID: <CA+xzKwwxqL=cazuECCaiWBsdRNire2k+WJ9_BsgweRSez3idwQ@mail.gmail.com>

Hello,

I am trying to create a virtual environment in the zzz.r file of my
package, and my package is currently passing on Windows and failing on
Debian with 1 ERROR.


This is the ERROR:

* installing *source* package ?PytrendsLongitudinalR? ...
** using staged installation
** R
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded from temporary location
Using Python: /usr/bin/python3.12
Creating virtual environment '/home/hornik/.virtualenvs/pytrends-in-r-new' ...
+ /usr/bin/python3.12 -m venv /home/hornik/.virtualenvs/pytrends-in-r-new
The virtual environment was not created successfully because ensurepip is not
available.  On Debian/Ubuntu systems, you need to install the python3-venv
package using the following command.

    apt install python3.12-venv

You may need to use sudo with that command.  After installing the python3-venv
package, recreate your virtual environment.

Failing command: /home/hornik/.virtualenvs/pytrends-in-r-new/bin/python3.12

FAILED
Error: package or namespace load failed for ?PytrendsLongitudinalR?:
 .onLoad failed in loadNamespace() for 'PytrendsLongitudinalR', details:
  call: NULL
  error: Error creating virtual environment
'/home/hornik/.virtualenvs/pytrends-in-r-new' [error code 1]
Error: loading failed
Execution halted
ERROR: loading failed
* removing ?/srv/hornik/tmp/CRAN_pretest/PytrendsLongitudinalR.Rcheck/PytrendsLongitudinalR?

and this is the onLoad function of my zzz.r file:


.onLoad <- function(libname, pkgname) {


  # Define paths
  venv_path <- file.path(Sys.getenv("HOME"), ".virtualenvs",
"pytrends-in-r-new")
  python_path <- file.path(venv_path, "bin", "python")

  # Ensure 'virtualenv' is installed
  if (!reticulate::py_module_available("virtualenv")) {
    reticulate::py_install("virtualenv")
  }


  # Check if the virtual environment exists
  if (!reticulate::virtualenv_exists(venv_path)) {
    # If it doesn't exist, attempt to create it
    tryCatch({
      reticulate::virtualenv_create(envname = venv_path, python =
python_path, force = TRUE, module =
getOption("reticulate.virtualenv.module"))
    }, error = function(e) {
      # Fallback: install Python and create the virtual environment
      reticulate::virtualenv_create(envname = venv_path, force = TRUE,
module = getOption("reticulate.virtualenv.module"))
    })
  }

  # Use the virtual environment for reticulate operations
  reticulate::use_virtualenv(venv_path, required = TRUE)

  # Install packages if not already installed
  packages_to_install <- c("pandas", "requests", "pytrends", "rich")
  for (package in packages_to_install) {
    if (!reticulate::py_module_available(package)) {
      reticulate::py_install(package, envname = "pytrends-in-r-new")
    }
  }


  TrendReq <<- reticulate::import("pytrends.request", delay_load =
TRUE)$TrendReq
  ResponseError <<- reticulate::import("pytrends.exceptions",
delay_load = TRUE)$ResponseError
  pd <<- reticulate::import("pandas", delay_load = TRUE)
  os <<- reticulate::import("os", delay_load = TRUE)
  glob <<- reticulate::import("glob", delay_load = TRUE)
  json <<- reticulate::import("json", delay_load = TRUE)
  requests <<- reticulate::import("requests", delay_load = TRUE)
  dt <<- reticulate::import("datetime", delay_load = TRUE)
  relativedelta <<- reticulate::import("dateutil.relativedelta",
delay_load = TRUE)
  time <<- reticulate::import("time", delay_load = TRUE)
  logging <<- reticulate::import("logging", delay_load = TRUE)
  console <<- reticulate::import("rich.console", delay_load = TRUE)$Console
  RichHandler <<- reticulate::import("rich.logging", delay_load =
TRUE)$RichHandler
  math <<- reticulate::import("math", delay_load = TRUE)
  platform <<- reticulate::import("platform", delay_load = TRUE)

  # Configure logging
  configure_logging()
}

How do I ensure that the virtual environment is created properly on
Debian systems?  I tried the instructions in the error message but
still got the error.

Thank you in advance for your help!


Best,

Taeyong




*Taeyong Park, Ph.D.*
*Assistant Teaching Professor of Statistics*
*Director, Statistical Consulting Center*
*Carnegie Mellon University Qatar*

	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Fri Sep  6 12:45:03 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Fri, 6 Sep 2024 13:45:03 +0300
Subject: [R-pkg-devel] Error in creating virtual environment on Debian
 machines
In-Reply-To: <CA+xzKwwxqL=cazuECCaiWBsdRNire2k+WJ9_BsgweRSez3idwQ@mail.gmail.com>
References: <CA+xzKwwxqL=cazuECCaiWBsdRNire2k+WJ9_BsgweRSez3idwQ@mail.gmail.com>
Message-ID: <20240906134503.2ff1f2da@arachnoid>

Hello Taeyong and welcome to R-package-devel!

? Thu, 5 Sep 2024 23:40:00 +0300
Taeyong Park <taeyongp at andrew.cmu.edu> ?????:

>   # Define paths
>   venv_path <- file.path(Sys.getenv("HOME"), ".virtualenvs",
> "pytrends-in-r-new")
>   python_path <- file.path(venv_path, "bin", "python")

Please don't require placing the virtual environments under
~/.virtualenvs. 'reticulate' will use this path as a default if you only
provide the name of the virtual environment, but will also let the user
configure virtualenv_root() using environment variables.

>   TrendReq <<- reticulate::import("pytrends.request", delay_load =
> TRUE)$TrendReq
>   ResponseError <<- reticulate::import("pytrends.exceptions",
> delay_load = TRUE)$ResponseError

I'm afraid this defeats the purpose of 'delay_load' by immediately
accessing the module object and forcing 'reticulate' to load it.

I understand the desire to get everything working automatically right
when the package is loaded, but Python dependency management is a
complex topic and not all of it is safe to perform from .onLoad. In
particular, if .onLoad fails, you don't get to let the user call
PytrendsLongitudinalR::install_pytrends() because the namespace will
not be available. Try following the guidance in the 'reticulate'
vignettes [1]:

1. In .onLoad, only express a soft preference for a named virtual
environment and create but do not access lazy-load Python module
objects:

.onLoad <- function(libname, pkgname) {
 use_virtualenv("pytrends-in-r-new", required = FALSE)
 pytrends.request <<- reticulate::import("pytrends.request", delay_load
= TRUE)
 pd <<- reticulate::import("pandas", delay_load = TRUE)
 # and so on
}

2. Move all the installation work into a separate function:

install_pytrends <- function(envname = "pytrends-in-r-new", ...)
 # the vignette suggests wiping the "pytrends-in-r-new" venv here,
 # just in case
 py_install(
  c("pandas", "requests", "pytrends", "rich"),
  envname = envname, ...
 )

3. In tests and examples, wrap all uses of Python in checks for
py_module_available(...). In regular code, you can suggest running
install_pytrends(), but don't run it for the user. _Automatically_
installing additional software, whether Python modules or Python
itself, is prohibited by the CRAN policy [2]:

>> Packages should not write in the user?s home filespace <...> nor
>> anywhere else on the file system apart from the R session?s
>> temporary directory (or during installation in the location pointed
>> to by TMPDIR: and such usage should be cleaned up). <...>
>> Limited exceptions may be allowed in interactive sessions if the
>> package obtains confirmation from the user.

Admittedly, this complicates the tests and the examples for your
package with boilerplate. I see that 'tensorflow', for example, wraps
all its examples in \dontrun{}, but it's an exceptional package. A few
other packages that depend on 'reticulate' that I've just taken a look
at do wrap their examples in checks for the Python packages being
available.

-- 
Best regards,
Ivan

[1]
https://cran.r-project.org/package=reticulate/vignettes/package.html
https://cran.r-project.org/package=reticulate/vignettes/python_dependencies.html

[2]
https://cran.r-project.org/web/packages/policies.html


From @|gbert @end|ng |rom w|w|@hu-ber||n@de  Fri Sep  6 14:43:31 2024
From: @|gbert @end|ng |rom w|w|@hu-ber||n@de (Sigbert Klinke)
Date: Fri, 6 Sep 2024 14:43:31 +0200
Subject: [R-pkg-devel] devtools::build() and Authors@R
Message-ID: <70311e44-7477-4e05-9956-cb7e9e5be549@wiwi.hu-berlin.de>

Hi,

upon resubmitting my package to CRAN, I received the following note:



Author field differs from that derived from Authors at R



Author: 'Sigbert Klinke [aut, cre] 
(https://orcid.org/0000-0003-3337-1863), Jekaterina Zukovska [ctb] 
(https://orcid.org/0000-0002-7753-9210)'

Authors at R: 'Sigbert Klinke [aut, cre] (ORCID: 
https://orcid.org/0000-0003-3337-1863), Jekaterina Zukovska [ctb] 
(ORCID: https://orcid.org/0000-0002-7753-9210)'

Since my DESCRIPTION file only includes the Authors at R field, I was 
initially confused.



However, after inspecting the *.tgz file generated with 
devtools::build(), I found that both fields (Author and Authors at R) were 
indeed present in the DESCRIPTION file inside the *.tgz. This was also 
the case with older *.tgz files, but CRAN hadn?t flagged it before.



As a workaround, I replaced Authors at R with separate Author and 
Maintainer fields.



Do you have any other suggestions on how to resolve this?

Thanks Sigbert

-- 
https://hu.berlin/sk


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Fri Sep  6 14:47:37 2024
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Fri, 6 Sep 2024 14:47:37 +0200
Subject: [R-pkg-devel] devtools::build() and Authors@R
In-Reply-To: <70311e44-7477-4e05-9956-cb7e9e5be549@wiwi.hu-berlin.de>
References: <70311e44-7477-4e05-9956-cb7e9e5be549@wiwi.hu-berlin.de>
Message-ID: <99e84273-d74d-4bb5-8fc3-49a12fd928d9@statistik.tu-dortmund.de>



On 06.09.2024 14:43, Sigbert Klinke wrote:
> Hi,
> 
> upon resubmitting my package to CRAN, I received the following note:
> 
> 
> 
> Author field differs from that derived from Authors at R
> 
> 
> 
> Author: 'Sigbert Klinke [aut, cre] 
> (https://orcid.org/0000-0003-3337-1863), Jekaterina Zukovska [ctb] 
> (https://orcid.org/0000-0002-7753-9210)'
> 
> Authors at R: 'Sigbert Klinke [aut, cre] (ORCID: 
> https://orcid.org/0000-0003-3337-1863), Jekaterina Zukovska [ctb] 
> (ORCID: https://orcid.org/0000-0002-7753-9210)'
> 
> Since my DESCRIPTION file only includes the Authors at R field, I was 
> initially confused.
> 
> 
> 
> However, after inspecting the *.tgz file generated with 
> devtools::build(), I found that both fields (Author and Authors at R) were 
> indeed present in the DESCRIPTION file inside the *.tgz. This was also 
> the case with older *.tgz files, but CRAN hadn?t flagged it before.
> 
> 
> 
> As a workaround, I replaced Authors at R with separate Author and 
> Maintainer fields.
> 
> 
> 
> Do you have any other suggestions on how to resolve this?

Ignore for now:
This is from a very recent change in R-devel and should not have been 
flagged by the checks, now fixed.
The idea is to allow for more than only ORCID and hence give labels to 
these ids. This is now done automatically when the Author field is 
generated from Authors at R by R CMD build, and unfortunately got flagged 
by our checks that use a very recent version of R-devel from last night.

In short: Simply submit again, the note will be gone.

Best,
Uwe Ligges






From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Sep  6 14:49:21 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 6 Sep 2024 14:49:21 +0200
Subject: [R-pkg-devel] devtools::build() and Authors@R
In-Reply-To: <70311e44-7477-4e05-9956-cb7e9e5be549@wiwi.hu-berlin.de>
References: <70311e44-7477-4e05-9956-cb7e9e5be549@wiwi.hu-berlin.de>
Message-ID: <26330.64081.194155.832151@stat.math.ethz.ch>

>>>>> Sigbert Klinke 
>>>>>     on Fri, 6 Sep 2024 14:43:31 +0200 writes:

    > Hi,
    > upon resubmitting my package to CRAN, I received the following note:



    > Author field differs from that derived from Authors at R



    > Author: 'Sigbert Klinke [aut, cre] 
    > (https://orcid.org/0000-0003-3337-1863), Jekaterina Zukovska [ctb] 
    > (https://orcid.org/0000-0002-7753-9210)'

    > Authors at R: 'Sigbert Klinke [aut, cre] (ORCID: 
    > https://orcid.org/0000-0003-3337-1863), Jekaterina Zukovska [ctb] 
    > (ORCID: https://orcid.org/0000-0002-7753-9210)'

    > Since my DESCRIPTION file only includes the Authors at R field, I was 
    > initially confused.



    > However, after inspecting the *.tgz file generated with 
    > devtools::build(), I found that both fields (Author and Authors at R) were 
    > indeed present in the DESCRIPTION file inside the *.tgz. This was also 
    > the case with older *.tgz files, but CRAN hadn?t flagged it before.



    > As a workaround, I replaced Authors at R with separate Author and 
    > Maintainer fields.



    > Do you have any other suggestions on how to resolve this?

Well, that's definitely easy to answer:

Follow *the* reference, the 'R Extensions' manual,
and use   R CMD build ...


    > Thanks Sigbert

    > -- 
    > https://hu.berlin/sk

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From j|ox @end|ng |rom mcm@@ter@c@  Fri Sep  6 19:17:06 2024
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Fri, 6 Sep 2024 13:17:06 -0400
Subject: [R-pkg-devel] unregistered S3 methods in a package
In-Reply-To: <26329.24948.135486.590205@stat.math.ethz.ch>
References: <b9db0b2d-b863-4367-8e39-00f6a8c60f96@mcmaster.ca>
 <4aa634d6-01e1-4cb3-8119-35ccdec32ef9@mcmaster.ca>
 <CALK03d3aHJDTLQK7OoVWV=1721cM8k2fRxFGctyXupBxxf=xVQ@mail.gmail.com>
 <F143B615-962D-4EB3-8D39-77C8A479E447@dcn.davis.ca.us>
 <1e4f4cfc-85ef-4220-947e-f080e56c70f5@mcmaster.ca>
 <d7cdb549-9dd0-4c10-a558-02d2c2cfe2e7@statistik.tu-dortmund.de>
 <26329.24948.135486.590205@stat.math.ethz.ch>
Message-ID: <e28337bb-cb3e-4a97-b1ce-bfe58baea2a1@mcmaster.ca>

Thank you Uwe and Martin for clarifying this issue.

The last paragraph of the comments that Kurt pointed out refers to a 
generic function defined in a package; in my case, the generic is 
coef(), which is in the stats package not in the cv package, and the 
question concerned methods for coef() (previously) defined in the cv 
package and not registered. But the comments as a whole do cover that 
case as well.

Best,
  John


On 2024-09-05 3:44 a.m., Martin Maechler wrote:
> Caution: External email.
> 
> 
>>>>>> Uwe Ligges
>>>>>>      on Thu, 5 Sep 2024 08:47:06 +0200 writes:
> 
>      > Dear John,
>      > the question is not really easy to answer, but there is a nice summary
>      > Kurt pointed me to: The code of checkS3methods() includes the following
>      > comments with the last paragraph containing the short answer to your
>      > question:
> 
>      > ## Check S3 generics and methods consistency.
> 
>      > ## Unfortunately, what is an S3 method is not clear.
>      > ## These days, S3 methods for a generic GEN are found
>      > ## A. via GEN.CLS lookup from the callenv to its topenv;
>      > ## B. the S3 registry;
>      > ## C. GEN.CLS lookup from the parent of the topenv to baseenv,
>      > ##    skipping everything on the search path between globalenv and
>      > ##    baseenv.
>      > ## Thus if "package code" calls GEN, we first look in the package
>      > ## namespace itself, then in the registry, and then in the package
>      > ## imports and .BaseNamespaceEnv (and globalenv and baseenv again).
>      > ##
>      > ## Clearly, everything registered via S3method() should be an S3
>      > ## method.  Interestingly, we seem to have some registrations for
>      > ## non-generics, such as grDevices::axis().  These are "harmless"
>      > ## but likely not "as intended", and hence inconsistencies are not
>      > ## ignored.
>      > ##
>      > ## If the package namespace has a function named GEN.CLS, it is used
>      > ## as an S3 method for an S3 generic named GEN (and hence "is an S3
>      > ## method") only if the package code actually calls GEN (see A
>      > ## above).  So one could argue that we should not be looking at all
>      > ## GEN.CLS matches with GEN a generic in the package itself, its
>      > ## imports or base, but restrict to only the ones where the package
>      > ## code calls GEN.  Doable, but not straightforward (calls could be
>      > ## PKG::GEN) and possibly quite time consuming.  For generics from
>      > ## the package itself or its imports, not restricting should not
>      > ## make a difference (why define or import when not calling?), but
>      > ## for generics from base it may: hence we filter out the mismatches
>      > ## for base GEN not called in the package.
>      > ##
>      > ## If a package provides an S3 generic GEN, there is no need to
>      > ## register GEN.CLS functions for "internal use" (see above).
>      > ## However, if GEN is exported then likely all GEN.CLS functions
>      > ## should be registered as S3 methods.
> 
>      > Best wishes,
>      > Uwe
> 
> Excellent!  Thank you, Uwe, for digging this out.
> 
> I'd also had answered to John Fox (even more strongly)
> that it *must* remain to be allowed to define "private"
> S3 methods in a package in all cases:
> - for a generic from the package (where the generic would also
>    not be exported)
> - for a generic from another package (which is imported)
>    or base (which need not and cannot be imported).
> 
> Note that the same is possible with S4 and (AFAIK, untested)
> with S7.  {which people should really try using more ... }
> 
> Martin
> 
> 
> 
>      > On 05.09.2024 00:10, John Fox wrote:
>      >> Thanks Toby and Jeff for chiming in on this.
>      >>
>      >> Jeff: I already read Kurt Hornik's post on "S3 Method Lookup" and quite
>      >> a few other sources.
>      >>
>      >> The main point is that failing to register the methods works in that the
>      >> methods are nevertheless invoked internally by functions in the package
>      >> but don't shadow versions of the methods registered by other package
>      >> externally (e.g., at the command prompt), which was the effect that I
>      >> wanted. Moreover, as I said, R CMD check (unlike roxygen) didn't complain.
>      >>
>      >> As I mentioned, this is now moot for the cv package, but I'm still
>      >> interested in the answer, as, apparently, is Toby.
>      >>
>      >> Best,
>      >>  John
>      >>
>      >> On 2024-09-04 5:12 p.m., Jeff Newmiller wrote:
>      >>> Caution: External email.
>      >>>
>      >>>
>      >>> I have been reluctant to pipe up on this because I am no expert on the
>      >>> dark corners of the S3 dispatch mechanism, but I think unregistered S3
>      >>> methods in packages are verboten. Perhaps [1] will shed some light?
>      >>>
>      >>> [1] https://blog.r-project.org/2019/08/19/s3-method-lookup/
>      >>>
>      >>> On September 4, 2024 11:21:22 AM PDT, Toby Hocking <tdhock5 at gmail.com>
>      >>> wrote:
>      >>>> I got this warning too, so I filed an issue to ask
>      >>>> https://github.com/r-lib/roxygen2/issues/1654
>      >>>>
>      >>>> On Mon, Sep 2, 2024 at 2:58?PM John Fox <jfox at mcmaster.ca> wrote:
>      >>>>>
>      >>>>> As it turned out, I was able to avoid redefining coef.merMod(),
>      >>>>> etc., by
>      >>>>> making a simple modification to the cv package.
>      >>>>>
>      >>>>> I'm still curious about whether it's OK to have unregistered S3 methods
>      >>>>> for internal use in a package even though that's no longer necessary
>      >>>>> for
>      >>>>> the cv package.
>      >>>>>
>      >>>>> On 2024-09-02 11:34 a.m., John Fox wrote:
>>>>>> Caution: External email.
>      >>>>>>
>      >>>>>>
>>>>>> Dear R-package-devel list members,
>      >>>>>>
>>>>>> I want to introduce several unregistered S3 methods into the cv
>>>>>> package
>>>>>> (code at <https://github.com/gmonette/cv>). These methods have the
>>>>>> form
>      >>>>>>
>>>>>>           coef.merMod <- function(object, ...) lme4::fixef(object)
>      >>>>>>
>>>>>> The object is to mask, e.g., lme4:::coef.merMod(), which returns BLUPs
>>>>>> rather than fixed effects, internally in the cv package but *not* to
>>>>>> mask the lme4 version of the method for users of the cv package --
>>>>>> that
>>>>>> could wreak havoc with their work. Doing this substantially simplifies
>>>>>> some of the code in the cv package.
>      >>>>>>
>>>>>> My question: Is it legitimate to define a method in a package for
>>>>>> internal use without registering it?
>      >>>>>>
>>>>>> This approach appears to work fine, and R CMD check doesn't complain,
>>>>>> although Roxygen does complain that the method isn't "exported"
>>>>>> (actually, isn't registered).
>      >>>>>>
>>>>>> Any advice or relevant information would be appreciated.
>      >>>>>>
>>>>>> Thank you,
>>>>>>     John
>>>>>> --
>>>>>> John Fox, Professor Emeritus
>>>>>> McMaster University
>>>>>> Hamilton, Ontario, Canada
>>>>>> web: https://www.john-fox.ca/


From |@go@bonn|c| @end|ng |rom umontpe|||er@|r  Fri Sep 13 15:00:06 2024
From: |@go@bonn|c| @end|ng |rom umontpe|||er@|r (Iago Bonnici)
Date: Fri, 13 Sep 2024 15:00:06 +0200
Subject: [R-pkg-devel] Justification and status of the 100-bytes path length
 limit.
Message-ID: <ff1bda57-3603-448a-8947-6725669297dc@umontpellier.fr>

Hello @r-package-devel,

 ??? Reading from the following guide, I understand that file paths in 
my R package should remain under 100 bytes long:

https://cran.r-project.org/doc/manuals/R-exts.html#Package-structure-1

 ??? The only explanation I could find stands within the same line in 
this document:

/>??? ??? packages are normally distributed as tarballs, and these have 
a limit on path lengths: for maximal portability

/??? So, if I understand correctly, the limit set by CRAN is deferred to 
some limit of the `tar` archive format.

 ??? Now, reading from the following page:

https://en.wikipedia.org/wiki/Tar_(computing)#File_format

 ??? I learn that `tar` was indeed limited to 100-bytes paths prior to 
POSIX.1-1988.
 ??? If I understand correctly. This limitation has been bumped to 256 
bytes in year 1988.
 ??? Then, it has been completely lifted in 2001, meaning that 
POSIX.1-2001-compliant `tar` files have no limit on the file path lengths.

 ??? Although I do understand the importance of ensuring 
backward-compatibility, I find it suprising that the 100-bytes 
limitation ensures compatibility with files format /*older than R 
itself*/ (1993, right?).
 ??? Considering that the limitation is suprisingly short by modern 
standards, I have two questions about it:

 ??? - Is the 100-bytes paths limitation only supposed to ensure 
compatilbility with pre-POSIX.1-1998 `tar` files?

 ??? ??? - If not, then I believe it should be stated in the official 
guide what are the other reasons to set such a low limit.

 ??? ??? - If yes, then I believe the limitation should either:

 ??? ??? ??? - be reconsidered. For example, it could be lifted for 
packages targetting R versions posterior to 2021 (20 years after 
POSIX.1-2001) or anything similar.

 ??? ??? ??? - be justified deeper in the official guide. The guide 
should explain why CRAN considers it meaningful or important to support 
pre-POSIX.1-1998 format.

 ??? - Has this discussion already happened like 1000 times 
<https://stat.ethz.ch/mailman/listinfo/r-package-devel> ? If so, then I 
believe the answers should be clarified in the official guide anyway.

 ??? Thank you for kind responses, I am happy to help pushing this 
forward if required.

 ??? Best regards,


--
Iago-lito
	[[alternative HTML version deleted]]


