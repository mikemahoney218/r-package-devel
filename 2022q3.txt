From greg @end|ng |rom ||rm@n@y@h@com  Fri Jul  1 00:31:15 2022
From: greg @end|ng |rom ||rm@n@y@h@com (Greg Hunt)
Date: Fri, 1 Jul 2022 08:31:15 +1000
Subject: [R-pkg-devel] Slowdown running examples since 4.2 on Windows
In-Reply-To: <d76c5510-7f48-8a47-afff-5dd35d0c825d@mtholyoke.edu>
References: <be553b98-2057-49e0-1922-37679544eb81@mtholyoke.edu>
 <676322ff-0d24-ece2-ae0d-e7c536373dea@gmail.com>
 <d76c5510-7f48-8a47-afff-5dd35d0c825d@mtholyoke.edu>
Message-ID: <CAAS8PA+EO-ZqdZm0az4_9KMLo04oMD6TxtZNwin7kRwmn3QARw@mail.gmail.com>

Tomas,
Do you have any logging in the build environment that could tell you
whether the environment is running into resource constraints?  I can
imagine IO (disk or network) or CPU contention with that kind of workload
and memory pressure would be easy to identify.

Greg

On Fri, 1 Jul 2022 at 01:45, Barbara Lerner <blerner at mtholyoke.edu> wrote:

> Thanks for these suggestions.  I attempted to submit a slightly earlier
> version of my package a few weeks ago and saw the slowdown on winbuilder
> then, too.  I did not look into any further at that point.
>
> I have tested it on a local Windows computer running 4.2.0 and I did not
> see the slowdown there.  Here are those results:
>
> Name         user    system   elapsed
>
> prov.json 1.11   0.24 2.19
>
> prov.run    0.99    0.06 1.93
>
> version  R version 4.2.0 (2022-04-22 ucrt)
>
> os       Windows 10 x64 (build 19044)
>
> system   x86_64, mingw32
>
>
> Tomas Kalibera wrote on 6/30/22 10:09 AM:
> >
> > On 6/29/22 22:25, Barbara Lerner wrote:
> >> I have a package that I want to submit an updated version for but the
> >> examples run too slowly on win-builder since 4.2 came out.  I just
> >> submitted the exact same tar.gz file to all 3 versions of R available on
> >> win-builder and got the results shown below.  Notice the dramatic
> >> slowdown from 4.1.3 to 4.2.1.
> >>
> >> I don't know how to go about tracking down the cause of this slowdown.
> >> The examples are quite small.  I am reluctant to use \dontrun, but I am
> >> not sure what else to do.
> >
> > Could you perhaps submit to Winbuilder several times (with some
> > non-trivial delay between the runs) to see if the very long execution
> > is reproducible?
> >
> > If so, the next step could be trying on a Windows machine with
> > interactive access, to reproduce, and if it is still so slow, checking
> > where the time is spent, using an R profiler, using some C profiler
> > (e.g. VerySleepy is free), comparing possibly to 4.1.3. It might be
> > useful or necessary to also do the profiling with a debug build of
> > Windows and/or the package, while the performance numbers will be
> > skewed, one would see the symbol names.
> >
> > If you wanted specific help, please send a reproducible example -
> > instructions how to run the code and which code.
> >
> > Best
> > Tomas
> >
> >>
> >> June 29 2:33 PM  - old release
> >> * using R version 4.1.3 (2022-03-10)
> >> i386 timings
> >> name    user    system    elapsed
> >> prov.json    3.28    0.33    5.19
> >> prov.run    2.70    0.27    4.18
> >>
> >> x64 timings
> >> name    user    system    elapsed
> >> prov.json    3.51    0.27    4.93
> >> prov.run    3.05    0.28    4.48
> >>
> >>
> >> June 29 2:19 PM  - release
> >> * using R version 4.2.1 (2022-06-23 ucrt)
> >> * using platform: x86_64-w64-mingw32 (64-bit)
> >> name    user    system    elapsed
> >> prov.json    16.98    8.81    26.82
> >> prov.run    3.53    0.42    4.89
> >>
> >>
> >> June 29  1:52 PM - devel
> >> * using R Under development (unstable) (2022-06-28 r82534 ucrt)
> >> * using platform: x86_64-w64-mingw32 (64-bit)
> >> name    user    system    elapsed
> >> prov.json    16.60     9.09    26.66
> >> prov.run    3.57    0.22    4.70 I then ran the same timing script as
> >> win-builder uses on my Mac,
> >> using Rscript and got these results: name    user    system  elapsed
> >> prov.json       1.105   0.159   1.329 prov.run        0.890   0.103
> >> 1.053 session_info reports:  version  R version 4.2.0 (2022-04-22)
> >>    os       macOS Catalina 10.15.7  system   x86_64, darwin17.0 I then
> >> installed 4.2.1 on my Mac. The time is a little slower but nothing like
> >> the slowdown on Windows.
> >> name    user    system  elapsed prov.json       1.286   0.230 3.080
> >> prov.run        0.940   0.108   1.131  version  R version 4.2.1
> >> (2022-06-23)  os       macOS Catalina 10.15.7  system   x86_64,
> >> darwin17.0
> >>
>
> --
> <http://www.getpostbox.com>Barbara Lerner (she / her)
> Professor
> Computer Science Department
> Mount Holyoke College
>
> <http://www.getpostbox.com>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Fri Jul  1 09:23:30 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Fri, 1 Jul 2022 09:23:30 +0200
Subject: [R-pkg-devel] Slowdown running examples since 4.2 on Windows
In-Reply-To: <d76c5510-7f48-8a47-afff-5dd35d0c825d@mtholyoke.edu>
References: <be553b98-2057-49e0-1922-37679544eb81@mtholyoke.edu>
 <676322ff-0d24-ece2-ae0d-e7c536373dea@gmail.com>
 <d76c5510-7f48-8a47-afff-5dd35d0c825d@mtholyoke.edu>
Message-ID: <9e64db22-a8ee-977b-e0d5-394cb8805bab@gmail.com>


On 6/30/22 17:45, Barbara Lerner wrote:
> Thanks for these suggestions.? I attempted to submit a slightly 
> earlier version of my package a few weeks ago and saw the slowdown on 
> winbuilder then, too.? I did not look into any further at that point.

I was curious about repeatability to rule out the option that it was 
simply that Winbuilder was overloaded at the time of checking the package.

Is the current version that also caused the problem available anywhere?

>
> I have tested it on a local Windows computer running 4.2.0 and I did 
> not see the slowdown there.? Here are those results:
>
> Name ????????user?? ?system elapsed
>
> prov.json 1.11 ??0.24 2.19
>
> prov.run??? 0.99? ??0.06 1.93
>
> version? R version 4.2.0 (2022-04-22 ucrt)
>
> os?????? Windows 10 x64 (build 19044)
>
> system?? x86_64, mingw32

It would be difficult to profile without being able to reproduce on a 
machine that can be used interactively and exclusively for the profiling.
Still, you could try narrowing it down by instrumenting the package - 
adding some timings, printing the outputs, and sending such instrumented 
package to Winbuilder

Tomas


>
>
> Tomas Kalibera wrote on 6/30/22 10:09 AM:
>>
>> On 6/29/22 22:25, Barbara Lerner wrote:
>>> I have a package that I want to submit an updated version for but the
>>> examples run too slowly on win-builder since 4.2 came out.? I just
>>> submitted the exact same tar.gz file to all 3 versions of R 
>>> available on
>>> win-builder and got the results shown below.? Notice the dramatic
>>> slowdown from 4.1.3 to 4.2.1.
>>>
>>> I don't know how to go about tracking down the cause of this slowdown.
>>> The examples are quite small.? I am reluctant to use \dontrun, but I am
>>> not sure what else to do.
>>
>> Could you perhaps submit to Winbuilder several times (with some 
>> non-trivial delay between the runs) to see if the very long execution 
>> is reproducible?
>>
>> If so, the next step could be trying on a Windows machine with 
>> interactive access, to reproduce, and if it is still so slow, 
>> checking where the time is spent, using an R profiler, using some C 
>> profiler (e.g. VerySleepy is free), comparing possibly to 4.1.3. It 
>> might be useful or necessary to also do the profiling with a debug 
>> build of Windows and/or the package, while the performance numbers 
>> will be skewed, one would see the symbol names.
>>
>> If you wanted specific help, please send a reproducible example - 
>> instructions how to run the code and which code.
>>
>> Best
>> Tomas
>>
>>>
>>> June 29 2:33 PM? - old release
>>> * using R version 4.1.3 (2022-03-10)
>>> i386 timings
>>> name??? user??? system??? elapsed
>>> prov.json??? 3.28??? 0.33??? 5.19
>>> prov.run??? 2.70??? 0.27??? 4.18
>>>
>>> x64 timings
>>> name??? user??? system??? elapsed
>>> prov.json??? 3.51??? 0.27??? 4.93
>>> prov.run??? 3.05??? 0.28??? 4.48
>>>
>>>
>>> June 29 2:19 PM? - release
>>> * using R version 4.2.1 (2022-06-23 ucrt)
>>> * using platform: x86_64-w64-mingw32 (64-bit)
>>> name??? user??? system??? elapsed
>>> prov.json??? 16.98??? 8.81??? 26.82
>>> prov.run??? 3.53??? 0.42??? 4.89
>>>
>>>
>>> June 29? 1:52 PM - devel
>>> * using R Under development (unstable) (2022-06-28 r82534 ucrt)
>>> * using platform: x86_64-w64-mingw32 (64-bit)
>>> name??? user??? system??? elapsed
>>> prov.json??? 16.60???? 9.09??? 26.66
>>> prov.run??? 3.57??? 0.22??? 4.70 I then ran the same timing script 
>>> as win-builder uses on my Mac,
>>> using Rscript and got these results: name??? user??? system elapsed
>>> prov.json?????? 1.105?? 0.159?? 1.329 prov.run??????? 0.890 0.103
>>> 1.053 session_info reports: ?version? R version 4.2.0 (2022-04-22)
>>> ? ?os?????? macOS Catalina 10.15.7 ?system?? x86_64, darwin17.0 I then
>>> installed 4.2.1 on my Mac. The time is a little slower but nothing like
>>> the slowdown on Windows.
>>> name??? user??? system? elapsed prov.json?????? 1.286 0.230?? 3.080
>>> prov.run??????? 0.940?? 0.108?? 1.131 ?version? R version 4.2.1
>>> (2022-06-23) ?os?????? macOS Catalina 10.15.7 ?system x86_64, 
>>> darwin17.0
>>>
>
> -- 
> <http://www.getpostbox.com>Barbara Lerner (she / her)
> Professor
> Computer Science Department
> Mount Holyoke College
>
> <http://www.getpostbox.com>
	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Fri Jul  1 09:49:23 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Fri, 1 Jul 2022 09:49:23 +0200
Subject: [R-pkg-devel] Slowdown running examples since 4.2 on Windows
In-Reply-To: <9e64db22-a8ee-977b-e0d5-394cb8805bab@gmail.com>
References: <be553b98-2057-49e0-1922-37679544eb81@mtholyoke.edu>
 <676322ff-0d24-ece2-ae0d-e7c536373dea@gmail.com>
 <d76c5510-7f48-8a47-afff-5dd35d0c825d@mtholyoke.edu>
 <9e64db22-a8ee-977b-e0d5-394cb8805bab@gmail.com>
Message-ID: <47e31581-1866-e06c-b6fb-83f6a98b7149@statistik.tu-dortmund.de>

And if you told us what the package is you are tasking about or gave us 
access to the package sources, we could easily check that. Without 
reproducible examples we really cannot help.

Best,
Uwe Ligges


On 01.07.2022 09:23, Tomas Kalibera wrote:
> 
> On 6/30/22 17:45, Barbara Lerner wrote:
>> Thanks for these suggestions.? I attempted to submit a slightly
>> earlier version of my package a few weeks ago and saw the slowdown on
>> winbuilder then, too.? I did not look into any further at that point.
> 
> I was curious about repeatability to rule out the option that it was
> simply that Winbuilder was overloaded at the time of checking the package.
> 
> Is the current version that also caused the problem available anywhere?
> 
>>
>> I have tested it on a local Windows computer running 4.2.0 and I did
>> not see the slowdown there.? Here are those results:
>>
>> Name ????????user?? ?system elapsed
>>
>> prov.json 1.11 ??0.24 2.19
>>
>> prov.run??? 0.99? ??0.06 1.93
>>
>> version? R version 4.2.0 (2022-04-22 ucrt)
>>
>> os?????? Windows 10 x64 (build 19044)
>>
>> system?? x86_64, mingw32
> 
> It would be difficult to profile without being able to reproduce on a
> machine that can be used interactively and exclusively for the profiling.
> Still, you could try narrowing it down by instrumenting the package -
> adding some timings, printing the outputs, and sending such instrumented
> package to Winbuilder
> 
> Tomas
> 
> 
>>
>>
>> Tomas Kalibera wrote on 6/30/22 10:09 AM:
>>>
>>> On 6/29/22 22:25, Barbara Lerner wrote:
>>>> I have a package that I want to submit an updated version for but the
>>>> examples run too slowly on win-builder since 4.2 came out.? I just
>>>> submitted the exact same tar.gz file to all 3 versions of R
>>>> available on
>>>> win-builder and got the results shown below.? Notice the dramatic
>>>> slowdown from 4.1.3 to 4.2.1.
>>>>
>>>> I don't know how to go about tracking down the cause of this slowdown.
>>>> The examples are quite small.? I am reluctant to use \dontrun, but I am
>>>> not sure what else to do.
>>>
>>> Could you perhaps submit to Winbuilder several times (with some
>>> non-trivial delay between the runs) to see if the very long execution
>>> is reproducible?
>>>
>>> If so, the next step could be trying on a Windows machine with
>>> interactive access, to reproduce, and if it is still so slow,
>>> checking where the time is spent, using an R profiler, using some C
>>> profiler (e.g. VerySleepy is free), comparing possibly to 4.1.3. It
>>> might be useful or necessary to also do the profiling with a debug
>>> build of Windows and/or the package, while the performance numbers
>>> will be skewed, one would see the symbol names.
>>>
>>> If you wanted specific help, please send a reproducible example -
>>> instructions how to run the code and which code.
>>>
>>> Best
>>> Tomas
>>>
>>>>
>>>> June 29 2:33 PM? - old release
>>>> * using R version 4.1.3 (2022-03-10)
>>>> i386 timings
>>>> name??? user??? system??? elapsed
>>>> prov.json??? 3.28??? 0.33??? 5.19
>>>> prov.run??? 2.70??? 0.27??? 4.18
>>>>
>>>> x64 timings
>>>> name??? user??? system??? elapsed
>>>> prov.json??? 3.51??? 0.27??? 4.93
>>>> prov.run??? 3.05??? 0.28??? 4.48
>>>>
>>>>
>>>> June 29 2:19 PM? - release
>>>> * using R version 4.2.1 (2022-06-23 ucrt)
>>>> * using platform: x86_64-w64-mingw32 (64-bit)
>>>> name??? user??? system??? elapsed
>>>> prov.json??? 16.98??? 8.81??? 26.82
>>>> prov.run??? 3.53??? 0.42??? 4.89
>>>>
>>>>
>>>> June 29? 1:52 PM - devel
>>>> * using R Under development (unstable) (2022-06-28 r82534 ucrt)
>>>> * using platform: x86_64-w64-mingw32 (64-bit)
>>>> name??? user??? system??? elapsed
>>>> prov.json??? 16.60???? 9.09??? 26.66
>>>> prov.run??? 3.57??? 0.22??? 4.70 I then ran the same timing script
>>>> as win-builder uses on my Mac,
>>>> using Rscript and got these results: name??? user??? system elapsed
>>>> prov.json?????? 1.105?? 0.159?? 1.329 prov.run??????? 0.890 0.103
>>>> 1.053 session_info reports: ?version? R version 4.2.0 (2022-04-22)
>>>>  ? ?os?????? macOS Catalina 10.15.7 ?system?? x86_64, darwin17.0 I then
>>>> installed 4.2.1 on my Mac. The time is a little slower but nothing like
>>>> the slowdown on Windows.
>>>> name??? user??? system? elapsed prov.json?????? 1.286 0.230?? 3.080
>>>> prov.run??????? 0.940?? 0.108?? 1.131 ?version? R version 4.2.1
>>>> (2022-06-23) ?os?????? macOS Catalina 10.15.7 ?system x86_64,
>>>> darwin17.0
>>>>
>>
>> -- 
>> <http://www.getpostbox.com>Barbara Lerner (she / her)
>> Professor
>> Computer Science Department
>> Mount Holyoke College
>>
>> <http://www.getpostbox.com>
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From b|erner @end|ng |rom mtho|yoke@edu  Fri Jul  1 18:04:57 2022
From: b|erner @end|ng |rom mtho|yoke@edu (Barbara Lerner)
Date: Fri, 1 Jul 2022 12:04:57 -0400
Subject: [R-pkg-devel] Slowdown running examples since 4.2 on Windows
In-Reply-To: <47e31581-1866-e06c-b6fb-83f6a98b7149@statistik.tu-dortmund.de>
References: <be553b98-2057-49e0-1922-37679544eb81@mtholyoke.edu>
 <676322ff-0d24-ece2-ae0d-e7c536373dea@gmail.com>
 <d76c5510-7f48-8a47-afff-5dd35d0c825d@mtholyoke.edu>
 <9e64db22-a8ee-977b-e0d5-394cb8805bab@gmail.com>
 <47e31581-1866-e06c-b6fb-83f6a98b7149@statistik.tu-dortmund.de>
Message-ID: <0253c20b-11ab-4855-096e-74720586d228@mtholyoke.edu>

The package can be downloaded from github:

https://github.com/End-to-end-provenance/rdtLite

Barbara

Uwe Ligges wrote on 7/1/22 3:49 AM:
> And if you told us what the package is you are tasking about or gave 
> us access to the package sources, we could easily check that. Without 
> reproducible examples we really cannot help.
>
> Best,
> Uwe Ligges
>
>
> On 01.07.2022 09:23, Tomas Kalibera wrote:
>>
>> On 6/30/22 17:45, Barbara Lerner wrote:
>>> Thanks for these suggestions.? I attempted to submit a slightly
>>> earlier version of my package a few weeks ago and saw the slowdown on
>>> winbuilder then, too.? I did not look into any further at that point.
>>
>> I was curious about repeatability to rule out the option that it was
>> simply that Winbuilder was overloaded at the time of checking the 
>> package.
>>
>> Is the current version that also caused the problem available anywhere?
>>
>>>
>>> I have tested it on a local Windows computer running 4.2.0 and I did
>>> not see the slowdown there.? Here are those results:
>>>
>>> Name ????????user?? ?system elapsed
>>>
>>> prov.json 1.11 ??0.24 2.19
>>>
>>> prov.run??? 0.99? ??0.06 1.93
>>>
>>> version? R version 4.2.0 (2022-04-22 ucrt)
>>>
>>> os?????? Windows 10 x64 (build 19044)
>>>
>>> system?? x86_64, mingw32
>>
>> It would be difficult to profile without being able to reproduce on a
>> machine that can be used interactively and exclusively for the 
>> profiling.
>> Still, you could try narrowing it down by instrumenting the package -
>> adding some timings, printing the outputs, and sending such instrumented
>> package to Winbuilder
>>
>> Tomas
>>
>>
>>>
>>>
>>> Tomas Kalibera wrote on 6/30/22 10:09 AM:
>>>>
>>>> On 6/29/22 22:25, Barbara Lerner wrote:
>>>>> I have a package that I want to submit an updated version for but the
>>>>> examples run too slowly on win-builder since 4.2 came out.? I just
>>>>> submitted the exact same tar.gz file to all 3 versions of R
>>>>> available on
>>>>> win-builder and got the results shown below.? Notice the dramatic
>>>>> slowdown from 4.1.3 to 4.2.1.
>>>>>
>>>>> I don't know how to go about tracking down the cause of this 
>>>>> slowdown.
>>>>> The examples are quite small.? I am reluctant to use \dontrun, but 
>>>>> I am
>>>>> not sure what else to do.
>>>>
>>>> Could you perhaps submit to Winbuilder several times (with some
>>>> non-trivial delay between the runs) to see if the very long execution
>>>> is reproducible?
>>>>
>>>> If so, the next step could be trying on a Windows machine with
>>>> interactive access, to reproduce, and if it is still so slow,
>>>> checking where the time is spent, using an R profiler, using some C
>>>> profiler (e.g. VerySleepy is free), comparing possibly to 4.1.3. It
>>>> might be useful or necessary to also do the profiling with a debug
>>>> build of Windows and/or the package, while the performance numbers
>>>> will be skewed, one would see the symbol names.
>>>>
>>>> If you wanted specific help, please send a reproducible example -
>>>> instructions how to run the code and which code.
>>>>
>>>> Best
>>>> Tomas
>>>>
>>>>>
>>>>> June 29 2:33 PM? - old release
>>>>> * using R version 4.1.3 (2022-03-10)
>>>>> i386 timings
>>>>> name??? user??? system??? elapsed
>>>>> prov.json??? 3.28??? 0.33??? 5.19
>>>>> prov.run??? 2.70??? 0.27??? 4.18
>>>>>
>>>>> x64 timings
>>>>> name??? user??? system??? elapsed
>>>>> prov.json??? 3.51??? 0.27??? 4.93
>>>>> prov.run??? 3.05??? 0.28??? 4.48
>>>>>
>>>>>
>>>>> June 29 2:19 PM? - release
>>>>> * using R version 4.2.1 (2022-06-23 ucrt)
>>>>> * using platform: x86_64-w64-mingw32 (64-bit)
>>>>> name??? user??? system??? elapsed
>>>>> prov.json??? 16.98??? 8.81??? 26.82
>>>>> prov.run??? 3.53??? 0.42??? 4.89
>>>>>
>>>>>
>>>>> June 29? 1:52 PM - devel
>>>>> * using R Under development (unstable) (2022-06-28 r82534 ucrt)
>>>>> * using platform: x86_64-w64-mingw32 (64-bit)
>>>>> name??? user??? system??? elapsed
>>>>> prov.json??? 16.60???? 9.09??? 26.66
>>>>> prov.run??? 3.57??? 0.22??? 4.70 I then ran the same timing script
>>>>> as win-builder uses on my Mac,
>>>>> using Rscript and got these results: name??? user??? system elapsed
>>>>> prov.json?????? 1.105?? 0.159?? 1.329 prov.run??????? 0.890 0.103
>>>>> 1.053 session_info reports: ?version? R version 4.2.0 (2022-04-22)
>>>>> ?? ?os?????? macOS Catalina 10.15.7 ?system?? x86_64, darwin17.0 I 
>>>>> then
>>>>> installed 4.2.1 on my Mac. The time is a little slower but nothing 
>>>>> like
>>>>> the slowdown on Windows.
>>>>> name??? user??? system? elapsed prov.json?????? 1.286 0.230?? 3.080
>>>>> prov.run??????? 0.940?? 0.108?? 1.131 ?version? R version 4.2.1
>>>>> (2022-06-23) ?os?????? macOS Catalina 10.15.7 ?system x86_64,
>>>>> darwin17.0
>>>>>
>>>
>>> -- 
>>> <http://www.getpostbox.com>Barbara Lerner (she / her)
>>> Professor
>>> Computer Science Department
>>> Mount Holyoke College
>>>
>>> <http://www.getpostbox.com>
>> ????[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
<http://www.getpostbox.com>Barbara Lerner (she / her)
Professor
Computer Science Department
Mount Holyoke College

<http://www.getpostbox.com>

	[[alternative HTML version deleted]]


From joh@nne@@r@nke @end|ng |rom jrwb@de  Fri Jul  1 11:10:03 2022
From: joh@nne@@r@nke @end|ng |rom jrwb@de (Johannes Ranke)
Date: Fri, 01 Jul 2022 11:10:03 +0200
Subject: [R-pkg-devel] Slow down in R 4.2.x
Message-ID: <13505960.q0Az33yFfb@ryz>

Dear list,

independent of the thread on this list about slow examples on R 4.2 on windows 
I have discovered over the last few days that some of my benchmarks (look for 
t4 and t9) run by a factor of 3 slower on R 4.2.x than on R 4.1.3 [1].

This is on Linux, using my own backported R packages for R 4.2.x and locally 
compiled versions (with default configure options) of R-4-1-branch on two 
different CPUs. The results for R 4.2.1 are only slightly modulated by the use 
of different BLAS version (openblas-serial versus atlas versus lapack).

I also tested the R 4.0.4 version that is part of Debian bullseye, it is as 
fast as the locally compiled R 4.1.3.

I went through the NEWS for R 4.2.0 (because the first slow results were 
obtained using that version), but the only change I could imagine causing such 
a change is the additional check of the length of the arguments && and ||.

Any other thoughts?

Johannes

[1] https://pkgdown.jrwb.de/mkin/articles/web_only/benchmarks.html#results 



	[[alternative HTML version deleted]]


From t@r@@@z@kh@rko @end|ng |rom uzh@ch  Fri Jul  1 14:59:22 2022
From: t@r@@@z@kh@rko @end|ng |rom uzh@ch (Taras Zakharko)
Date: Fri, 1 Jul 2022 12:59:22 +0000
Subject: [R-pkg-devel] Seeking feedback on a package before submitting to
 CRAN
Message-ID: <GV0P278MB0417D418D560D7E2519E6BEAECBD9@GV0P278MB0417.CHEP278.PROD.OUTLOOK.COM>

Dear all,?

I have written a small?lightweight utility package for R developers that implements opinionated assertion checking routines. This is mostly a drop-in replacement for base::stopifnot() but with some additional features that simplify debugging and error location. Before submitting the package on CRAN I was hoping that someone here would be so kind to have a quick look and maybe offer some feedback. The package is called "precondition" and can be found on GitHub here:

? https://github.com/tzakharko/precondition?

If you would like to leave some feedback I have created a GitHub issue just for that:?

  https://github.com/tzakharko/precondition/issues/1

Here is a quick summary as to what this package is about: it implements a thematic collection of assertion routines that check some conditions and report an informative error if the conditions are not TRUE. The routines have been inspired by similar mechanisms in the Swift programming language and discussion on the Swift design mailing lists. There are three assertion routines:

- precondition(x>0) to check inputs/environment before executing some code (to be used to check function arguments, for example)

- postcondition(.value. > 0) to check the function result?

- sanity_check(!is.null(x)) to check internal assumptions/invariants of the algorithm and guard against bugs, will immediately abort the program bypassing error handling when failed. Sanity checks are internal assertions and failing them always mean that there is a critical bug ?in the code which would make any attempt at error recovery futile

Parts of the assertion predicate can be "embraced", which will print them on assertion failure, making it easier to see what went wrong, e.g.?

? x <- 0
? precondition({{x}} > 0)
??# Error:
? # ! precondition failure
? # ! `x > 0` is not TRUE
? # ?
? # ?`x` = dbl 10

The package README has some usage examples and background discussion.?

Thank you in advance for your help,?

Taras

P.S. To anticipate the mandatory (and justified) question, the reason why I decided to roll my own solution instead of using one of the existing packages (like the popular assertthat) is because I needed something very simple and with low performance overhead to help me debug my code and document program invariants.?

From r@||@hero|d @end|ng |rom gmx@net  Sat Jul  2 12:01:38 2022
From: r@||@hero|d @end|ng |rom gmx@net (Ralf Herold)
Date: Sat, 2 Jul 2022 12:01:38 +0200
Subject: [R-pkg-devel] R CMD checks URLs formatted for LaTeX instead of
 using the non-LaTeX URLs, and fails
Message-ID: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>

Hello, in my package documentation I want to include URLs with query string parameters and anchors, within a table. A minimally reproducible example is this content in file "man/mre.Rd":

\name{mre}
\title{mre}
\description{mre}
\details{
\tabular{l}{
  \ifelse{latex}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop}{latex link}}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop}{non-latex link}}
}}

The ifelse{}{}{} construct is necessary since ampersands in a table need to be escaped for LaTeX rendering.

Each of the following commands checks and renders the respective output correctly:

tools::checkRd("man/mre.Rd")
tools::Rd2txt("man/mre.Rd")
tools::Rd2latex("man/mre.Rd")
tools::Rd2HTML("man/mre.Rd")
system2("R", c("CMD", "Rd2pdf", "man/mre.Rd"))

However, rhub::check_for_cran() results in NOTES:

Found the following (possibly) invalid URLs:
  URL: https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop
    From: man/mre.Rd
    Status: 400
    Message: Bad Request

Subsequently, CRAN maintainers refused accepting the package.

However, the underlying cause is that, during such checks, all apparent URLs are extracted from .Rd files, irrespective of any \ifelse{}{}{} constructs. This in turn is due to such checks involving calls to function ".get_urls_from_Rd" without setting its argument "ifdef" to TRUE.

Here is how to see this behaviour:

db <- tools::Rd_db(dir = ".")

# get functions
source("https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R")
source("https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R")
.Rd_deparse <- tools:::.Rd_deparse
RdTags <- tools:::RdTags

# default, leading to invalid url in [1]
# > .get_urls_from_Rd(db)
# [1] "https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop"
# [2] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop"

# returning relevant valid url
#> .get_urls_from_Rd(db, ifdef = TRUE)
# [1] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop"

This can be addressed by either:

-- changing the signature of ".get_urls_from_Rd" in line 50 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R to read "ifdef = TRUE". Of note, this function has a code block to handle such ifdef constructs which indicates it should be possible to use them in Rd files.

-- changing the calling function "url_db_from_package_Rd_db" to include "ifdef = TRUE" on line 178 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R

Please advise how to advance on this issue, thank you very much.

Greetings
Ralf


From @eb@meyer @end|ng |rom |@u@de  Sun Jul  3 01:51:05 2022
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Sun, 3 Jul 2022 01:51:05 +0200
Subject: [R-pkg-devel] R CMD checks URLs formatted for LaTeX instead of
 using the non-LaTeX URLs, and fails
In-Reply-To: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>
References: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>
Message-ID: <f4be4bbf-4ae8-e2fc-1d12-bf56bffab6b1@fau.de>

Am 02.07.22 um 12:01 schrieb Ralf Herold:
> Hello, in my package documentation I want to include URLs with query string parameters and anchors, within a table. A minimally reproducible example is this content in file "man/mre.Rd":
> 
> \name{mre}
> \title{mre}
> \description{mre}
> \details{
> \tabular{l}{
>    \ifelse{latex}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop}{latex link}}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop}{non-latex link}}
> }}
> 
> The ifelse{}{}{} construct is necessary since ampersands in a table need to be escaped for LaTeX rendering.

This is a red herring. Ampersands do *not* need to be escaped in \href 
URLs. The problem is the hash symbol, which needs to be escaped if \href 
is nested within another markup macro, here \Tabular (from Rd.sty). This 
is a known limitation; Rd2latex will probably do the escaping in the 
future. It's good to see a use case.

I think currently the best solutions for you are to simply omit the 
#tableTop part in the LaTeX version or to not use such URLs inside a 
\tabular.

Hope this helps.
Best regards,

	Sebastian Meyer

> 
> Each of the following commands checks and renders the respective output correctly:
> 
> tools::checkRd("man/mre.Rd")
> tools::Rd2txt("man/mre.Rd")
> tools::Rd2latex("man/mre.Rd")
> tools::Rd2HTML("man/mre.Rd")
> system2("R", c("CMD", "Rd2pdf", "man/mre.Rd"))
> 
> However, rhub::check_for_cran() results in NOTES:
> 
> Found the following (possibly) invalid URLs:
>    URL: https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop
>      From: man/mre.Rd
>      Status: 400
>      Message: Bad Request
> 
> Subsequently, CRAN maintainers refused accepting the package.
> 
> However, the underlying cause is that, during such checks, all apparent URLs are extracted from .Rd files, irrespective of any \ifelse{}{}{} constructs. This in turn is due to such checks involving calls to function ".get_urls_from_Rd" without setting its argument "ifdef" to TRUE.
> 
> Here is how to see this behaviour:
> 
> db <- tools::Rd_db(dir = ".")
> 
> # get functions
> source("https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R")
> source("https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R")
> .Rd_deparse <- tools:::.Rd_deparse
> RdTags <- tools:::RdTags
> 
> # default, leading to invalid url in [1]
> # > .get_urls_from_Rd(db)
> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop"
> # [2] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop"
> 
> # returning relevant valid url
> #> .get_urls_from_Rd(db, ifdef = TRUE)
> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop"
> 
> This can be addressed by either:
> 
> -- changing the signature of ".get_urls_from_Rd" in line 50 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R to read "ifdef = TRUE". Of note, this function has a code block to handle such ifdef constructs which indicates it should be possible to use them in Rd files.
> 
> -- changing the calling function "url_db_from_package_Rd_db" to include "ifdef = TRUE" on line 178 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R
> 
> Please advise how to advance on this issue, thank you very much.
> 
> Greetings
> Ralf
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@||@hero|d @end|ng |rom gmx@net  Sun Jul  3 08:27:28 2022
From: r@||@hero|d @end|ng |rom gmx@net (Ralf Herold)
Date: Sun, 3 Jul 2022 08:27:28 +0200
Subject: [R-pkg-devel] R CMD checks URLs formatted for LaTeX instead of
 using the non-LaTeX URLs, and fails
In-Reply-To: <f4be4bbf-4ae8-e2fc-1d12-bf56bffab6b1@fau.de>
References: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>
 <f4be4bbf-4ae8-e2fc-1d12-bf56bffab6b1@fau.de>
Message-ID: <F44171D0-CCE4-4049-9C52-BCC3625C2B2A@gmx.net>

Thanks Sebastian, 

but not only hash, also ampersand in \href in a tabular environment does need to be escaped, otherwise it does not latex (example below). I was not aware it is a known limitation for .Rd files despite searching for it. 

My use case (with eventually more meaningful query parameters and possibly anchors) would work if the existing R code block for handling \ifelse in urltools.R was activated as shown below, and this is my suggestion. How could I propose this? 

Kind regards,
Ralf


\name{mre}
\title{mre}
\description{mre}
\details{
\tabular{l}{
  \href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With}{link}
}}


LaTeX errors:

! Argument of \href at split has an extra }.
<inserted text> 
                \par 
l.24 }
      
Runaway argument?
https://clinicaltrials.gov/ct2/results?cond=Infections\unskip \hfil 
! Paragraph ended before \href at split was complete.
<to be read again> 
                   \par 
l.24 }
      
! Extra }, or forgotten \endgroup.
<recently read> }


> Am 03.07.2022 um 01:51 schrieb Sebastian Meyer <seb.meyer at fau.de>:
> 
> Am 02.07.22 um 12:01 schrieb Ralf Herold:
>> Hello, in my package documentation I want to include URLs with query string parameters and anchors, within a table. A minimally reproducible example is this content in file "man/mre.Rd":
>> \name{mre}
>> \title{mre}
>> \description{mre}
>> \details{
>> \tabular{l}{
>>   \ifelse{latex}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop}{latex link}}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop}{non-latex link}}
>> }}
>> The ifelse{}{}{} construct is necessary since ampersands in a table need to be escaped for LaTeX rendering.
> 
> This is a red herring. Ampersands do *not* need to be escaped in \href URLs. The problem is the hash symbol, which needs to be escaped if \href is nested within another markup macro, here \Tabular (from Rd.sty). This is a known limitation; Rd2latex will probably do the escaping in the future. It's good to see a use case.
> 
> I think currently the best solutions for you are to simply omit the #tableTop part in the LaTeX version or to not use such URLs inside a \tabular.
> 
> Hope this helps.
> Best regards,
> 
> 	Sebastian Meyer
> 
>> Each of the following commands checks and renders the respective output correctly:
>> tools::checkRd("man/mre.Rd")
>> tools::Rd2txt("man/mre.Rd")
>> tools::Rd2latex("man/mre.Rd")
>> tools::Rd2HTML("man/mre.Rd")
>> system2("R", c("CMD", "Rd2pdf", "man/mre.Rd"))
>> However, rhub::check_for_cran() results in NOTES:
>> Found the following (possibly) invalid URLs:
>>   URL: https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop
>>     From: man/mre.Rd
>>     Status: 400
>>     Message: Bad Request
>> Subsequently, CRAN maintainers refused accepting the package.
>> However, the underlying cause is that, during such checks, all apparent URLs are extracted from .Rd files, irrespective of any \ifelse{}{}{} constructs. This in turn is due to such checks involving calls to function ".get_urls_from_Rd" without setting its argument "ifdef" to TRUE.
>> Here is how to see this behaviour:
>> db <- tools::Rd_db(dir = ".")
>> # get functions
>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R")
>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R")
>> .Rd_deparse <- tools:::.Rd_deparse
>> RdTags <- tools:::RdTags
>> # default, leading to invalid url in [1]
>> # > .get_urls_from_Rd(db)
>> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop"
>> # [2] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop"
>> # returning relevant valid url
>> #> .get_urls_from_Rd(db, ifdef = TRUE)
>> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop"
>> This can be addressed by either:
>> -- changing the signature of ".get_urls_from_Rd" in line 50 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R to read "ifdef = TRUE". Of note, this function has a code block to handle such ifdef constructs which indicates it should be possible to use them in Rd files.
>> -- changing the calling function "url_db_from_package_Rd_db" to include "ifdef = TRUE" on line 178 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R
>> Please advise how to advance on this issue, thank you very much.
>> Greetings
>> Ralf
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


	[[alternative HTML version deleted]]


From @eb@meyer @end|ng |rom |@u@de  Mon Jul  4 00:08:01 2022
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Mon, 4 Jul 2022 00:08:01 +0200
Subject: [R-pkg-devel] R CMD checks URLs formatted for LaTeX instead of
 using the non-LaTeX URLs, and fails
In-Reply-To: <F44171D0-CCE4-4049-9C52-BCC3625C2B2A@gmx.net>
References: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>
 <f4be4bbf-4ae8-e2fc-1d12-bf56bffab6b1@fau.de>
 <F44171D0-CCE4-4049-9C52-BCC3625C2B2A@gmx.net>
Message-ID: <a6797515-d9ce-06b4-ef49-83f473954e5f@fau.de>

Am 03.07.22 um 08:27 schrieb Ralf Herold:
> Thanks Sebastian,
> 
> but not only hash, also ampersand in \href in a tabular environment does 
> need to be escaped, otherwise it does not latex (example below). I was 
> not aware it is a known limitation for .Rd files despite searching for it.

I stumbled over that problem a while ago and found that the escaping 
issue for the hash symbol is documented in the hyperref manual (but 
currently not accounted for by Rd2latex):

> The special characters # and ~ do *not* need to be escaped in any way (unless the command is used in the argument of another command). 

For example, this LaTeX code fails to compile:
\emph{\href{https://example.org/#}{hash}}
In contrast, an ampersand would not need to be escaped in that LaTeX 
example.

However, I can confirm that a LaTeX error results if an ampersand is 
used in a \href URL (but not in \url} that is passed to the special 
\Tabular LaTeX command from Rd.sty that is used by Rd2latex() for 
\tabular Rd input. Thank you for the heads-up.

I think it would be good to improve Rd2latex() / Rd.sty for URLs in 
\tabular that contain & or # rather than require special LaTeX treatment 
in the Rd source. My preliminary testing shows that hyperref is happy if 
[&%#] are always escaped in URLs (sometimes it is not necessary but it 
also does not seem to hurt).

Best regards,

	Sebastian Meyer

> 
> My use case (with eventually more meaningful query parameters and 
> possibly anchors) would work if the existing R code block for handling 
> \ifelse in urltools.R was activated as shown below, and this is my 
> suggestion. How could I propose this?
> 
> Kind regards,
> Ralf
> 
> 
> \name{mre}
> \title{mre}
> \description{mre}
> \details{
> \tabular{l}{
>    
> \href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With 
> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With>}{link}
> }}
> 
> 
> LaTeX errors:
> 
> ! Argument of \href at split has an extra }.
> <inserted text>
>  ? ? ? ? ? ? ? ? \par
> l.24 }
> Runaway argument?
> https://clinicaltrials.gov/ct2/results?cond=Infections\unskip 
> <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip> \hfil
> ! Paragraph ended before \href at split was complete.
> <to be read again>
>  ? ? ? ? ? ? ? ? ? ?\par
> l.24 }
> ! Extra }, or forgotten \endgroup.
> <recently read> }
> 
> 
>> Am 03.07.2022 um 01:51 schrieb Sebastian Meyer <seb.meyer at fau.de 
>> <mailto:seb.meyer at fau.de>>:
>>
>> Am 02.07.22 um 12:01 schrieb Ralf Herold:
>>> Hello, in my package documentation I want to include URLs with query 
>>> string parameters and anchors, within a table. A minimally 
>>> reproducible example is this content in file "man/mre.Rd":
>>> \name{mre}
>>> \title{mre}
>>> \description{mre}
>>> \details{
>>> \tabular{l}{
>>> ??\ifelse{latex}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>}{latex 
>>> link}}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>}{non-latex 
>>> link}}
>>> }}
>>> The ifelse{}{}{} construct is necessary since ampersands in a table 
>>> need to be escaped for LaTeX rendering.
>>
>> This is a red herring. Ampersands do *not* need to be escaped in \href 
>> URLs. The problem is the hash symbol, which needs to be escaped if 
>> \href is nested within another markup macro, here \Tabular (from 
>> Rd.sty). This is a known limitation; Rd2latex will probably do the 
>> escaping in the future. It's good to see a use case.
>>
>> I think currently the best solutions for you are to simply omit the 
>> #tableTop part in the LaTeX version or to not use such URLs inside a 
>> \tabular.
>>
>> Hope this helps.
>> Best regards,
>>
>> Sebastian Meyer
>>
>>> Each of the following commands checks and renders the respective 
>>> output correctly:
>>> tools::checkRd("man/mre.Rd")
>>> tools::Rd2txt("man/mre.Rd")
>>> tools::Rd2latex("man/mre.Rd")
>>> tools::Rd2HTML("man/mre.Rd")
>>> system2("R", c("CMD", "Rd2pdf", "man/mre.Rd"))
>>> However, rhub::check_for_cran() results in NOTES:
>>> Found the following (possibly) invalid URLs:
>>> ??URL: 
>>> https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>
>>> ????From: man/mre.Rd
>>> ????Status: 400
>>> ????Message: Bad Request
>>> Subsequently, CRAN maintainers refused accepting the package.
>>> However, the underlying cause is that, during such checks, all 
>>> apparent URLs are extracted from .Rd files, irrespective of any 
>>> \ifelse{}{}{} constructs. This in turn is due to such checks 
>>> involving calls to function ".get_urls_from_Rd" without setting its 
>>> argument "ifdef" to TRUE.
>>> Here is how to see this behaviour:
>>> db <- tools::Rd_db(dir = ".")
>>> # get functions
>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>")
>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R 
>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R>")
>>> .Rd_deparse <- tools:::.Rd_deparse
>>> RdTags <- tools:::RdTags
>>> # default, leading to invalid url in [1]
>>> # > .get_urls_from_Rd(db)
>>> # [1] 
>>> "https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop>"
>>> # [2] 
>>> "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>"
>>> # returning relevant valid url
>>> #> .get_urls_from_Rd(db, ifdef = TRUE)
>>> # [1] 
>>> "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>"
>>> This can be addressed by either:
>>> -- changing the signature of ".get_urls_from_Rd" in line 50 in 
>>> https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> to 
>>> read "ifdef = TRUE". Of note, this function has a code block to 
>>> handle such ifdef constructs which indicates it should be possible to 
>>> use them in Rd files.
>>> -- changing the calling function "url_db_from_package_Rd_db" to 
>>> include "ifdef = TRUE" on line 178 in 
>>> https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>
>>> Please advise how to advance on this issue, thank you very much.
>>> Greetings
>>> Ralf
>>> ______________________________________________
>>> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> 
>>> mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel 
>>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From A@J@God|rey @end|ng |rom m@@@ey@@c@nz  Tue Jul  5 03:59:43 2022
From: A@J@God|rey @end|ng |rom m@@@ey@@c@nz (Jonathan Godfrey)
Date: Tue, 5 Jul 2022 01:59:43 +0000
Subject: [R-pkg-devel] problem with regdmp finding v4.2.x under Windows
Message-ID: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>

Hi all,

In order to support my local students and other blind users, I install every version of R and re-build every document used, almost all of which are R markdown documents.

That means re-installing or updating packages as if I was a novice user following instructions. I try to give my students a clean start experience at the beginning of semester so that we're all using the same versions, and gives me time to sort out the messes before semester begins.

To do all of that efficiently, I make extensive use of batch files (Windows user alert) and a key ingredient of those batch files is that I avoid having to edit the R version number with each installation.

I've been using a Windows utility called regdmp to look in the registry for the highest version number. Up to v4.1.3, that was working extremely well for me.

In addition, I've been investigating quarto, and have struck the same problem because quarto looks for the path to Rscript.exe using the regdmp utility. I've had help from the quarto team, and we've established that the regdmp utility should be finding a version of R if one exists. On my newish laptop where there is just one R installation (4.2.0) regdmp fails to find any installation because it has an "Access denied" error message.

On my older desktop which has multiple R installations, I do not get an "Access denied" error, quarto finds the path to the 4.2.0 installation via brute force, but regdmp via my batch files gives me 4.1.x instead.

I'm currently able to provide the service to my students I want, but only by doing all R work by explicitly naming the version of R I want used. I really do want to get back to my previous workflow so that I just install new versions of R and carry on.

I'm now seeking your advice on the differences in installation of versions 4.2.x and 4.1.x that could have an impact on the Windows registry and therefore regdmp's ability to find the relevant entries there.


Many thanks,
Jonathan








	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Jul  5 10:15:05 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 5 Jul 2022 11:15:05 +0300
Subject: [R-pkg-devel] problem with regdmp finding v4.2.x under Windows
In-Reply-To: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>
References: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>
Message-ID: <20220705111505.0ead2d07@Tarkus>

Hi Jonathan,

Since we don't have a separate "R on Windows" or "R installation
and administration" mailing list, I think that this question is a
better fit for R-help, not R-package-devel. Although R-devel could be
an option too (if we determine that the R installer is doing something
wrong), the last time R installer has been significantly changed is
2020, so the problem is likely elsewhere.

On Tue, 5 Jul 2022 01:59:43 +0000
Jonathan Godfrey <A.J.Godfrey at massey.ac.nz> wrote:

> To do all of that efficiently, I make extensive use of batch files
> (Windows user alert) and a key ingredient of those batch files is
> that I avoid having to edit the R version number with each
> installation.

Can you show us the relevant parts of the batch files?
 
> On my older desktop which has multiple R installations, I do not get
> an "Access denied" error, quarto finds the path to the 4.2.0
> installation via brute force, but regdmp via my batch files gives me
> 4.1.x instead.

What is the output of the following commands on the machines where you
have troubles finding R-4.2.x?

reg query "HKEY_LOCAL_MACHINE\Software\R-core"
reg query "HKEY_CURRENT_USER\Software\R-core"

> 	[[alternative HTML version deleted]]

This mailing list removes the HTML parts from our messages, so we only
see the automatically-generated plain text part. In this case, I think
that your message wasn't damaged at all, but sometimes (especially when
pasting code or output examples) the results can be undesirable.

-- 
Best regards,
Ivan


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Jul  5 15:35:05 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 5 Jul 2022 09:35:05 -0400
Subject: [R-pkg-devel] Changing optimization level when building package?
Message-ID: <2fe007d4-f575-34e6-714c-aa28edf86887@gmail.com>

I'm trying to track down a segfault in rgl on macOS, so I need to load R 
under lldb and set breakpoints in the C++ code, examine local variables, 
etc.  Reading WRE, I thought setting CXXFLAGS=-O0 in ~/.R/Makevars would 
do minimal optimization, but I'm still getting messages about local 
variables being optimized out.  For example, here's what I see during 
compiling:

   clang++ -mmacosx-version-min=10.13 -std=gnu++11 
-I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG 
-DHAVE_PNG_H -I/usr/local/Cellar/libpng/1.6.37/include/libpng16 -DDarwin 
-I/opt/X11/include -DHAVE_FREETYPE -Iext/ftgl 
-I/usr/local/opt/freetype/include/freetype2 -Iext  -I/usr/local/include 
-O0 -fPIC  -Wall -g -O2  -c x11gui.cpp -o x11gui.o

I see the -O0 option that I added, but afterwards -O2 coming from 
somewhere in R.  I believe the second one has precedence, because I see 
this in lldb:

   (lldb) p fontnames
   error: Couldn't materialize: couldn't get the value of variable 
fontnames: no location, value may have been optimized out

If I manually run the clang++ line after editing the -O2 to -O0 before 
rebuilding, I don't have this problem, but that's really tedious.

So, my question:  how should I be asking R CMD INSTALL to use -O0?

Duncan Murdoch


From @ergue|@@oko| @end|ng |rom gm@||@com  Tue Jul  5 15:53:42 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Tue, 5 Jul 2022 15:53:42 +0200
Subject: [R-pkg-devel] 
 Changing optimization level when building package?
In-Reply-To: <2fe007d4-f575-34e6-714c-aa28edf86887@gmail.com>
References: <2fe007d4-f575-34e6-714c-aa28edf86887@gmail.com>
Message-ID: <b3526dc5-921d-9148-ef56-da8fdf630241@gmail.com>

Le 05/07/2022 ? 15:35, Duncan Murdoch a ?crit?:
> I'm trying to track down a segfault in rgl on macOS, so I need to load 
> R under lldb and set breakpoints in the C++ code, examine local 
> variables, etc.? Reading WRE, I thought setting CXXFLAGS=-O0 in 
> ~/.R/Makevars would do minimal optimization, but I'm still getting 
> messages about local variables being optimized out.? For example, 
> here's what I see during compiling:
>
> ? clang++ -mmacosx-version-min=10.13 -std=gnu++11 
> -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG 
> -DHAVE_PNG_H -I/usr/local/Cellar/libpng/1.6.37/include/libpng16 
> -DDarwin -I/opt/X11/include -DHAVE_FREETYPE -Iext/ftgl 
> -I/usr/local/opt/freetype/include/freetype2 -Iext -I/usr/local/include 
> -O0 -fPIC? -Wall -g -O2? -c x11gui.cpp -o x11gui.o
>
> I see the -O0 option that I added, but afterwards -O2 coming from 
> somewhere in R.? I believe the second one has precedence, because I 
> see this in lldb:
>
> ? (lldb) p fontnames
> ? error: Couldn't materialize: couldn't get the value of variable 
> fontnames: no location, value may have been optimized out
>
> If I manually run the clang++ line after editing the -O2 to -O0 before 
> rebuilding, I don't have this problem, but that's really tedious.
>
> So, my question:? how should I be asking R CMD INSTALL to use -O0?

I use the following "hakish" solution: add in your Makevars something 
similar to:

MYFLAGS=-g -O0
%.o: %.cpp
 ?? ?$(CXX) $(ALL_CPPFLAGS) $(ALL_CXXFLAGS) $(MYFLAGS) -c $< -o $@
%.o: %.c
 ?? ?$(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) $(MYFLAGS) -c $< -o $@
%.o: %.F
 ?? ?$(FC) $(ALL_FCFLAGS) $(MYFLAGS) -c $< -o $@

Best,
Serguei.

>
> Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Jul  5 16:11:52 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 5 Jul 2022 17:11:52 +0300
Subject: [R-pkg-devel] 
 Changing optimization level when building package?
In-Reply-To: <2fe007d4-f575-34e6-714c-aa28edf86887@gmail.com>
References: <2fe007d4-f575-34e6-714c-aa28edf86887@gmail.com>
Message-ID: <20220705171152.48710915@arachnoid>

On Tue, 5 Jul 2022 09:35:05 -0400
Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> I see the -O0 option that I added, but afterwards -O2 coming from 
> somewhere in R.

It seems to come from the CXXFLAGS macro defined in /etc/R/Makeconf.
It's the last to be added to ALL_CXXFLAGS, so you probably have to
overwrite it in ~/.R/Makevars.

-- 
Best regards,
Ivan


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Tue Jul  5 17:00:29 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Tue, 5 Jul 2022 17:00:29 +0200
Subject: [R-pkg-devel] problem with regdmp finding v4.2.x under Windows
In-Reply-To: <20220705111505.0ead2d07@Tarkus>
References: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>
 <20220705111505.0ead2d07@Tarkus>
Message-ID: <e113b07d-59d6-598b-2e13-d31d367820b3@statistik.tu-dortmund.de>

The installer asks you

"Save Version in Registry" with Description "Save the R version and 
install path in the Registry". If this is checked in the installation 
wizard, it should work, otherwise not.

Best,
Uwe Ligges


On 05.07.2022 10:15, Ivan Krylov wrote:
> Hi Jonathan,
> 
> Since we don't have a separate "R on Windows" or "R installation
> and administration" mailing list, I think that this question is a
> better fit for R-help, not R-package-devel. Although R-devel could be
> an option too (if we determine that the R installer is doing something
> wrong), the last time R installer has been significantly changed is
> 2020, so the problem is likely elsewhere.
> 
> On Tue, 5 Jul 2022 01:59:43 +0000
> Jonathan Godfrey <A.J.Godfrey at massey.ac.nz> wrote:
> 
>> To do all of that efficiently, I make extensive use of batch files
>> (Windows user alert) and a key ingredient of those batch files is
>> that I avoid having to edit the R version number with each
>> installation.
> 
> Can you show us the relevant parts of the batch files?
>   
>> On my older desktop which has multiple R installations, I do not get
>> an "Access denied" error, quarto finds the path to the 4.2.0
>> installation via brute force, but regdmp via my batch files gives me
>> 4.1.x instead.
> 
> What is the output of the following commands on the machines where you
> have troubles finding R-4.2.x?
> 
> reg query "HKEY_LOCAL_MACHINE\Software\R-core"
> reg query "HKEY_CURRENT_USER\Software\R-core"
> 
>> 	[[alternative HTML version deleted]]
> 
> This mailing list removes the HTML parts from our messages, so we only
> see the automatically-generated plain text part. In this case, I think
> that your message wasn't damaged at all, but sometimes (especially when
> pasting code or output examples) the results can be undesirable.
>


From kev|nu@hey @end|ng |rom gm@||@com  Tue Jul  5 19:27:55 2022
From: kev|nu@hey @end|ng |rom gm@||@com (Kevin Ushey)
Date: Tue, 5 Jul 2022 10:27:55 -0700
Subject: [R-pkg-devel] problem with regdmp finding v4.2.x under Windows
In-Reply-To: <e113b07d-59d6-598b-2e13-d31d367820b3@statistik.tu-dortmund.de>
References: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>
 <20220705111505.0ead2d07@Tarkus>
 <e113b07d-59d6-598b-2e13-d31d367820b3@statistik.tu-dortmund.de>
Message-ID: <CAJXgQP0YomJOW3eiNOMqGC86yPfrRjx9ziV8PD5Rb6T50QW38Q@mail.gmail.com>

Hi Jonathan,

I'm not certain if this is the issue you're encountering, but I've
noticed that different versions of R may write to different locations
in the registry.

Right now, on my machine, I see entries for R 4.1.3 installed at:

    Computer\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\R-core\R

And for my installation of R 4.2.1, I see it at:

    Computer\HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R

Note that the registry location for R 4.2.1 is no longer part of the
WOW6432Node.

I'm not sure if this is a hiccup unique to my own local machine, but
perhaps you're seeing something similar? A way to verify would be to
check and compare what you see with:

    reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:32
    reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:64

In my case, I see:

C:\Users\kevin>reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:32

HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R
    InstallPath    REG_SZ    C:\R\R-4.1.3
    Current Version    REG_SZ    4.1.3

C:\Users\kevin>reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:64

HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R
    InstallPath    REG_SZ    C:\R\R-4.2.1
    Current Version    REG_SZ    4.2.1

Best,
Kevin

On Tue, Jul 5, 2022 at 8:00 AM Uwe Ligges
<ligges at statistik.tu-dortmund.de> wrote:
>
> The installer asks you
>
> "Save Version in Registry" with Description "Save the R version and
> install path in the Registry". If this is checked in the installation
> wizard, it should work, otherwise not.
>
> Best,
> Uwe Ligges
>
>
> On 05.07.2022 10:15, Ivan Krylov wrote:
> > Hi Jonathan,
> >
> > Since we don't have a separate "R on Windows" or "R installation
> > and administration" mailing list, I think that this question is a
> > better fit for R-help, not R-package-devel. Although R-devel could be
> > an option too (if we determine that the R installer is doing something
> > wrong), the last time R installer has been significantly changed is
> > 2020, so the problem is likely elsewhere.
> >
> > On Tue, 5 Jul 2022 01:59:43 +0000
> > Jonathan Godfrey <A.J.Godfrey at massey.ac.nz> wrote:
> >
> >> To do all of that efficiently, I make extensive use of batch files
> >> (Windows user alert) and a key ingredient of those batch files is
> >> that I avoid having to edit the R version number with each
> >> installation.
> >
> > Can you show us the relevant parts of the batch files?
> >
> >> On my older desktop which has multiple R installations, I do not get
> >> an "Access denied" error, quarto finds the path to the 4.2.0
> >> installation via brute force, but regdmp via my batch files gives me
> >> 4.1.x instead.
> >
> > What is the output of the following commands on the machines where you
> > have troubles finding R-4.2.x?
> >
> > reg query "HKEY_LOCAL_MACHINE\Software\R-core"
> > reg query "HKEY_CURRENT_USER\Software\R-core"
> >
> >>      [[alternative HTML version deleted]]
> >
> > This mailing list removes the HTML parts from our messages, so we only
> > see the automatically-generated plain text part. In this case, I think
> > that your message wasn't damaged at all, but sometimes (especially when
> > pasting code or output examples) the results can be undesirable.
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From r@||@hero|d @end|ng |rom gmx@net  Tue Jul  5 19:56:03 2022
From: r@||@hero|d @end|ng |rom gmx@net (Ralf Herold)
Date: Tue, 5 Jul 2022 19:56:03 +0200
Subject: [R-pkg-devel] R CMD checks URLs formatted for LaTeX instead of
 using the non-LaTeX URLs, and fails
In-Reply-To: <a6797515-d9ce-06b4-ef49-83f473954e5f@fau.de>
References: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>
 <f4be4bbf-4ae8-e2fc-1d12-bf56bffab6b1@fau.de>
 <F44171D0-CCE4-4049-9C52-BCC3625C2B2A@gmx.net>
 <a6797515-d9ce-06b4-ef49-83f473954e5f@fau.de>
Message-ID: <B0D5C060-C722-46D0-BFE5-5888D352BE17@gmx.net>

Thanks and I would like to define the follow-up actions: 

1) change function "writeURL" on line 207 to read, for example, url <- fsub("([%#&])", "\\\\1",  url) in https://svn.r-project.org/R/trunk/src/library/tools/R/Rd2latex.R <https://svn.r-project.org/R/trunk/src/library/tools/R/Rd2latex.R> to always escape URLs as you mention. 

How can this be moved forward? This seems R core code, thus needs to be reported in R Bugzilla by one of its members (I am not one): https://www.r-project.org/bugs.html#where-to-submit-bug-reports-and-patches <https://www.r-project.org/bugs.html#where-to-submit-bug-reports-and-patches>. 

Could someone from this list do this? Many thanks

2) change function "url_db_from_package_Rd_db" to call  ".get_urls_from_Rd" with parameter "ifdef = TRUE" on line 178 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>. This will activate the existing code that is intended to handle ifdef{}{}{}. This seems important for the issue I have reported and beyond. Same procedure as above? 

3) change Rd.sty, not sure, 1) seems more relevant. 

Please advise, thanks 

Ralf



> Am 04.07.2022 um 00:08 schrieb Sebastian Meyer <seb.meyer at fau.de>:
> 
> Am 03.07.22 um 08:27 schrieb Ralf Herold:
>> Thanks Sebastian,
>> but not only hash, also ampersand in \href in a tabular environment does need to be escaped, otherwise it does not latex (example below). I was not aware it is a known limitation for .Rd files despite searching for it.
> 
> I stumbled over that problem a while ago and found that the escaping issue for the hash symbol is documented in the hyperref manual (but currently not accounted for by Rd2latex):
> 
>> The special characters # and ~ do *not* need to be escaped in any way (unless the command is used in the argument of another command). 
> 
> For example, this LaTeX code fails to compile:
> \emph{\href{https://example.org/#}{hash}}
> In contrast, an ampersand would not need to be escaped in that LaTeX example.
> 
> However, I can confirm that a LaTeX error results if an ampersand is used in a \href URL (but not in \url} that is passed to the special \Tabular LaTeX command from Rd.sty that is used by Rd2latex() for \tabular Rd input. Thank you for the heads-up.
> 
> I think it would be good to improve Rd2latex() / Rd.sty for URLs in \tabular that contain & or # rather than require special LaTeX treatment in the Rd source. My preliminary testing shows that hyperref is happy if [&%#] are always escaped in URLs (sometimes it is not necessary but it also does not seem to hurt).
> 
> Best regards,
> 
> 	Sebastian Meyer
> 
>> My use case (with eventually more meaningful query parameters and possibly anchors) would work if the existing R code block for handling \ifelse in urltools.R was activated as shown below, and this is my suggestion. How could I propose this?
>> Kind regards,
>> Ralf
>> \name{mre}
>> \title{mre}
>> \description{mre}
>> \details{
>> \tabular{l}{
>>   \href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With>}{link}
>> }}
>> LaTeX errors:
>> ! Argument of \href at split has an extra }.
>> <inserted text>
>>                 \par
>> l.24 }
>> Runaway argument?
>> https://clinicaltrials.gov/ct2/results?cond=Infections\unskip <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip> \hfil
>> ! Paragraph ended before \href at split was complete.
>> <to be read again>
>>                    \par
>> l.24 }
>> ! Extra }, or forgotten \endgroup.
>> <recently read> }
>>> Am 03.07.2022 um 01:51 schrieb Sebastian Meyer <seb.meyer at fau.de <mailto:seb.meyer at fau.de>>:
>>> 
>>> Am 02.07.22 um 12:01 schrieb Ralf Herold:
>>>> Hello, in my package documentation I want to include URLs with query string parameters and anchors, within a table. A minimally reproducible example is this content in file "man/mre.Rd":
>>>> \name{mre}
>>>> \title{mre}
>>>> \description{mre}
>>>> \details{
>>>> \tabular{l}{
>>>>   \ifelse{latex}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>}{latex link}}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>}{non-latex link}}
>>>> }}
>>>> The ifelse{}{}{} construct is necessary since ampersands in a table need to be escaped for LaTeX rendering.
>>> 
>>> This is a red herring. Ampersands do *not* need to be escaped in \href URLs. The problem is the hash symbol, which needs to be escaped if \href is nested within another markup macro, here \Tabular (from Rd.sty). This is a known limitation; Rd2latex will probably do the escaping in the future. It's good to see a use case.
>>> 
>>> I think currently the best solutions for you are to simply omit the #tableTop part in the LaTeX version or to not use such URLs inside a \tabular.
>>> 
>>> Hope this helps.
>>> Best regards,
>>> 
>>> Sebastian Meyer
>>> 
>>>> Each of the following commands checks and renders the respective output correctly:
>>>> tools::checkRd("man/mre.Rd")
>>>> tools::Rd2txt("man/mre.Rd")
>>>> tools::Rd2latex("man/mre.Rd")
>>>> tools::Rd2HTML("man/mre.Rd")
>>>> system2("R", c("CMD", "Rd2pdf", "man/mre.Rd"))
>>>> However, rhub::check_for_cran() results in NOTES:
>>>> Found the following (possibly) invalid URLs:
>>>>   URL: https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>
>>>>     From: man/mre.Rd
>>>>     Status: 400
>>>>     Message: Bad Request
>>>> Subsequently, CRAN maintainers refused accepting the package.
>>>> However, the underlying cause is that, during such checks, all apparent URLs are extracted from .Rd files, irrespective of any \ifelse{}{}{} constructs. This in turn is due to such checks involving calls to function ".get_urls_from_Rd" without setting its argument "ifdef" to TRUE.
>>>> Here is how to see this behaviour:
>>>> db <- tools::Rd_db(dir = ".")
>>>> # get functions
>>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>")
>>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R>")
>>>> .Rd_deparse <- tools:::.Rd_deparse
>>>> RdTags <- tools:::RdTags
>>>> # default, leading to invalid url in [1]
>>>> # > .get_urls_from_Rd(db)
>>>> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop>"
>>>> # [2] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>"
>>>> # returning relevant valid url
>>>> #> .get_urls_from_Rd(db, ifdef = TRUE)
>>>> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>"
>>>> This can be addressed by either:
>>>> -- changing the signature of ".get_urls_from_Rd" in line 50 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> to read "ifdef = TRUE". Of note, this function has a code block to handle such ifdef constructs which indicates it should be possible to use them in Rd files.
>>>> -- changing the calling function "url_db_from_package_Rd_db" to include "ifdef = TRUE" on line 178 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>
>>>> Please advise how to advance on this issue, thank you very much.
>>>> Greetings
>>>> Ralf
>>>> ______________________________________________
>>>> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel <https://stat.ethz.ch/mailman/listinfo/r-package-devel>


	[[alternative HTML version deleted]]


From greg @end|ng |rom ||rm@n@y@h@com  Wed Jul  6 09:27:06 2022
From: greg @end|ng |rom ||rm@n@y@h@com (Greg Hunt)
Date: Wed, 6 Jul 2022 17:27:06 +1000
Subject: [R-pkg-devel] problem with regdmp finding v4.2.x under Windows
In-Reply-To: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>
References: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>
Message-ID: <CAAS8PA+TmJZT6bBKKjOc5b5=BUA_d8tPuBM-YVR4YmW9oSP8hg@mail.gmail.com>

Jonathon,
Are you using a very old version of regdump?  Could it be a 32 bit
version?

Greg

On Tue, 5 Jul 2022 at 12:00, Jonathan Godfrey <A.J.Godfrey at massey.ac.nz>
wrote:

> Hi all,
>
> In order to support my local students and other blind users, I install
> every version of R and re-build every document used, almost all of which
> are R markdown documents.
>
> That means re-installing or updating packages as if I was a novice user
> following instructions. I try to give my students a clean start experience
> at the beginning of semester so that we're all using the same versions, and
> gives me time to sort out the messes before semester begins.
>
> To do all of that efficiently, I make extensive use of batch files
> (Windows user alert) and a key ingredient of those batch files is that I
> avoid having to edit the R version number with each installation.
>
> I've been using a Windows utility called regdmp to look in the registry
> for the highest version number. Up to v4.1.3, that was working extremely
> well for me.
>
> In addition, I've been investigating quarto, and have struck the same
> problem because quarto looks for the path to Rscript.exe using the regdmp
> utility. I've had help from the quarto team, and we've established that the
> regdmp utility should be finding a version of R if one exists. On my newish
> laptop where there is just one R installation (4.2.0) regdmp fails to find
> any installation because it has an "Access denied" error message.
>
> On my older desktop which has multiple R installations, I do not get an
> "Access denied" error, quarto finds the path to the 4.2.0 installation via
> brute force, but regdmp via my batch files gives me 4.1.x instead.
>
> I'm currently able to provide the service to my students I want, but only
> by doing all R work by explicitly naming the version of R I want used. I
> really do want to get back to my previous workflow so that I just install
> new versions of R and carry on.
>
> I'm now seeking your advice on the differences in installation of versions
> 4.2.x and 4.1.x that could have an impact on the Windows registry and
> therefore regdmp's ability to find the relevant entries there.
>
>
> Many thanks,
> Jonathan
>
>
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu Jul  7 09:41:20 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 7 Jul 2022 09:41:20 +0200
Subject: [R-pkg-devel] 
 Changing optimization level when building package?
In-Reply-To: <20220705171152.48710915@arachnoid>
References: <2fe007d4-f575-34e6-714c-aa28edf86887@gmail.com>
 <20220705171152.48710915@arachnoid>
Message-ID: <8a3450df-fff4-bba1-2802-97a21cd74240@gmail.com>


On 7/5/22 16:11, Ivan Krylov wrote:
> On Tue, 5 Jul 2022 09:35:05 -0400
> Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>
>> I see the -O0 option that I added, but afterwards -O2 coming from
>> somewhere in R.
> It seems to come from the CXXFLAGS macro defined in /etc/R/Makeconf.
> It's the last to be added to ALL_CXXFLAGS, so you probably have to
> overwrite it in ~/.R/Makevars.
>
Yes. I set both CFLAGS and CXXFLAGS in my Makevars_dbg0 file and let R 
use it via R_MAKEVARS_USER.
See R-Admin, 6.3.3, Customizing package compilation, for more.

Tomas


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jul  7 12:04:54 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 7 Jul 2022 06:04:54 -0400
Subject: [R-pkg-devel] 
 Changing optimization level when building package?
In-Reply-To: <8a3450df-fff4-bba1-2802-97a21cd74240@gmail.com>
References: <2fe007d4-f575-34e6-714c-aa28edf86887@gmail.com>
 <20220705171152.48710915@arachnoid>
 <8a3450df-fff4-bba1-2802-97a21cd74240@gmail.com>
Message-ID: <45df63d4-3fe2-abed-157a-52649f185d4e@gmail.com>

On 07/07/2022 3:41 a.m., Tomas Kalibera wrote:
> 
> On 7/5/22 16:11, Ivan Krylov wrote:
>> On Tue, 5 Jul 2022 09:35:05 -0400
>> Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>>> I see the -O0 option that I added, but afterwards -O2 coming from
>>> somewhere in R.
>> It seems to come from the CXXFLAGS macro defined in /etc/R/Makeconf.
>> It's the last to be added to ALL_CXXFLAGS, so you probably have to
>> overwrite it in ~/.R/Makevars.
>>
> Yes. I set both CFLAGS and CXXFLAGS in my Makevars_dbg0 file and let R
> use it via R_MAKEVARS_USER.
> See R-Admin, 6.3.3, Customizing package compilation, for more.
> 
> Tomas
> 

In my case, the necessary settings needed to be put in CXX11FLAGS, 
because rgl defines CXX_STD = CXX11.  Thanks to Kevin Ushey and Prof. 
Brian Ripley for spotting this.

Duncan Murdoch


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu Jul  7 13:28:44 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 7 Jul 2022 13:28:44 +0200
Subject: [R-pkg-devel] problem with regdmp finding v4.2.x under Windows
In-Reply-To: <CAJXgQP0YomJOW3eiNOMqGC86yPfrRjx9ziV8PD5Rb6T50QW38Q@mail.gmail.com>
References: <MEAPR01MB3829E66FE3C79E43E78A401693819@MEAPR01MB3829.ausprd01.prod.outlook.com>
 <20220705111505.0ead2d07@Tarkus>
 <e113b07d-59d6-598b-2e13-d31d367820b3@statistik.tu-dortmund.de>
 <CAJXgQP0YomJOW3eiNOMqGC86yPfrRjx9ziV8PD5Rb6T50QW38Q@mail.gmail.com>
Message-ID: <e9a0aa19-eb05-392e-848d-5ad66a225a7c@gmail.com>


On 7/5/22 19:27, Kevin Ushey wrote:
> Hi Jonathan,
>
> I'm not certain if this is the issue you're encountering, but I've
> noticed that different versions of R may write to different locations
> in the registry.

The R installer does not write R version information to the 32-bit view 
of the registry when installing only 64-bit files. This is the same with 
previous versions of R as can be seen from the code. I've tested with 
4.1.3 - when you opt out from installing 32-bit files, version 
information won't appear in the 32-bit view. In principle, one could 
still write something to the 32-bit view, though I think this decision 
was intentional as it required an extra condition in the sources.

R 4.2.x doesn't support 32-bit files anymore, hence? for users using the 
defaults, it is R 4.2.0 when the version information no longer appears 
in the 32-bit view.

One could proceed by searching both the 32-bit and the 64-bit views when 
looking for the newest installed version, preferring 64-bit. For 
practical use on current systems, using the 64-bit view only should 
probably do.

Best,
Tomas

>
> Right now, on my machine, I see entries for R 4.1.3 installed at:
>
>      Computer\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\R-core\R
>
> And for my installation of R 4.2.1, I see it at:
>
>      Computer\HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R
>
> Note that the registry location for R 4.2.1 is no longer part of the
> WOW6432Node.
>
> I'm not sure if this is a hiccup unique to my own local machine, but
> perhaps you're seeing something similar? A way to verify would be to
> check and compare what you see with:
>
>      reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:32
>      reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:64
>
> In my case, I see:
>
> C:\Users\kevin>reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:32
>
> HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R
>      InstallPath    REG_SZ    C:\R\R-4.1.3
>      Current Version    REG_SZ    4.1.3
>
> C:\Users\kevin>reg query HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R /reg:64
>
> HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R
>      InstallPath    REG_SZ    C:\R\R-4.2.1
>      Current Version    REG_SZ    4.2.1
>
> Best,
> Kevin
>
> On Tue, Jul 5, 2022 at 8:00 AM Uwe Ligges
> <ligges at statistik.tu-dortmund.de> wrote:
>> The installer asks you
>>
>> "Save Version in Registry" with Description "Save the R version and
>> install path in the Registry". If this is checked in the installation
>> wizard, it should work, otherwise not.
>>
>> Best,
>> Uwe Ligges
>>
>>
>> On 05.07.2022 10:15, Ivan Krylov wrote:
>>> Hi Jonathan,
>>>
>>> Since we don't have a separate "R on Windows" or "R installation
>>> and administration" mailing list, I think that this question is a
>>> better fit for R-help, not R-package-devel. Although R-devel could be
>>> an option too (if we determine that the R installer is doing something
>>> wrong), the last time R installer has been significantly changed is
>>> 2020, so the problem is likely elsewhere.
>>>
>>> On Tue, 5 Jul 2022 01:59:43 +0000
>>> Jonathan Godfrey <A.J.Godfrey at massey.ac.nz> wrote:
>>>
>>>> To do all of that efficiently, I make extensive use of batch files
>>>> (Windows user alert) and a key ingredient of those batch files is
>>>> that I avoid having to edit the R version number with each
>>>> installation.
>>> Can you show us the relevant parts of the batch files?
>>>
>>>> On my older desktop which has multiple R installations, I do not get
>>>> an "Access denied" error, quarto finds the path to the 4.2.0
>>>> installation via brute force, but regdmp via my batch files gives me
>>>> 4.1.x instead.
>>> What is the output of the following commands on the machines where you
>>> have troubles finding R-4.2.x?
>>>
>>> reg query "HKEY_LOCAL_MACHINE\Software\R-core"
>>> reg query "HKEY_CURRENT_USER\Software\R-core"
>>>
>>>>       [[alternative HTML version deleted]]
>>> This mailing list removes the HTML parts from our messages, so we only
>>> see the automatically-generated plain text part. In this case, I think
>>> that your message wasn't damaged at all, but sometimes (especially when
>>> pasting code or output examples) the results can be undesirable.
>>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org  Thu Jul  7 21:55:06 2022
From: p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org (Plamen Mirazchiyski)
Date: Thu, 7 Jul 2022 21:55:06 +0200
Subject: [R-pkg-devel] No news entries found
Message-ID: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>

Hi,

Today I have submitted a new version of the RALSA package. Soon after I 
received an automatic email letting me know that the package did not 
pass some of the pre-tests:

> package RALSA_1.3.0.tar.gz does not pass the incoming checks automatically, please see the following pre-tests:
> Windows:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Windows/00check.log>
> Status: 2 NOTEs
> Debian:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Debian/00check.log>
> Status: 1 NOTE
>   
> Last released version's CRAN status: OK: 9, NOTE: 4
> See:<https://CRAN.R-project.org/web/checks/check_results_RALSA.html>

To summarize:

1. Windows checks found possibly invalid DOIs. This is to be ignored, as 
stated here: 
https://www.mail-archive.com/r-package-devel at r-project.org/msg07116.html

2. Windows, Debian (gcc) and Fedora (clang and gcc) drop the following note:

checking package subdirectories ... NOTE
Problems with news in 'NEWS.md':
No news entries found.

This is rather strange because I have added one of the largest news 
updates I ever made for this package in the NEWS.md file with this 
submission. Further, this note appears only in these four of the 13 
platforms where the package is checked.

Apparently, this is beyond my control and I can do nothing to fix it on 
my end. I have already replied to the email to notify the 
CRAN-submissions at R-project.org this is a false-positive as advised in 
the email itself, but I thought the mailing list should also be aware of 
this issue.

Best,
Plamen

-- 
======================
Plamen Mirazchiyski, PhD
International Educational Research and Evaluation Institute
24 Tehnolo?ki park
SI-1000 Ljubljana
Slovenia
tel.: +386 51 303 817
email: plamen.mirazchiyski at ineri.org


From @eb@meyer @end|ng |rom |@u@de  Thu Jul  7 22:41:23 2022
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Thu, 7 Jul 2022 22:41:23 +0200
Subject: [R-pkg-devel] R CMD checks URLs formatted for LaTeX instead of
 using the non-LaTeX URLs, and fails
In-Reply-To: <B0D5C060-C722-46D0-BFE5-5888D352BE17@gmx.net>
References: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>
 <f4be4bbf-4ae8-e2fc-1d12-bf56bffab6b1@fau.de>
 <F44171D0-CCE4-4049-9C52-BCC3625C2B2A@gmx.net>
 <a6797515-d9ce-06b4-ef49-83f473954e5f@fau.de>
 <B0D5C060-C722-46D0-BFE5-5888D352BE17@gmx.net>
Message-ID: <bb4e57b8-088f-3d40-1150-125c3194ec6b@fau.de>

Am 05.07.22 um 19:56 schrieb Ralf Herold:
> Thanks and I would like to define the follow-up actions:
> 
> 1) change function "writeURL" on line 207 to read, for example, url <- 
> fsub("([%#&])", "\\\\1", ?url) in 
> https://svn.r-project.org/R/trunk/src/library/tools/R/Rd2latex.R 
> <https://svn.r-project.org/R/trunk/src/library/tools/R/Rd2latex.R>?to 
> always escape URLs as you mention.
> 
> How can this be moved forward? This seems R core code, thus needs to be 
> reported in R Bugzilla by one of its members (I am not one): 
> https://www.r-project.org/bugs.html#where-to-submit-bug-reports-and-patches 
> <https://www.r-project.org/bugs.html#where-to-submit-bug-reports-and-patches>. 
> 

A Bugzilla entry would have been nice for future reference but is no 
longer necessary. The Rd2latex() bug is now fixed in the development 
version of R (>= r82557) such that URLs with & or # characters can then 
also be used inside \tabular and give the same link as in the HTML 
version: \tabular{l}{\url{https://example.org/a&b#c}} should just work.
In other words, Rd2latex() now correctly handles the input URL as 
'verbatim' text (as specified in WRE Section 2.3), which also means that 
backslashes in the input that do not escape percent or braces (Rd 
specials) are preserved in the output (as was already the case for HTML).

It is planned to port the fix to R-patched (future R 4.2.2).

In package development I'd probably avoid such URLs inside \tabular 
until after that release. Otherwise, if you want to support building the 
PDF manual in current and future R, you'd need to use \out{} and do all 
the escaping there yourself, for example:

\name{test}
\title{test}
\description{
\tabular{l}{
    \ifelse{latex}{
      \out{\href{https://example.org/a\&b\#c}{link}}
    }{
      \href{https://example.org/a&b#c}{link}
    }
}
}

AFAICS, the below points are obsolete.

Best regards,

	Sebastian Meyer

> 
> Could someone from this list do this? Many thanks
> 
> 2) change function "url_db_from_package_Rd_db" to call 
>  ?".get_urls_from_Rd" with parameter "ifdef = TRUE" on line 178 in 
> https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>. This 
> will activate the existing code that is intended to handle ifdef{}{}{}. 
> This seems important for the issue I have reported and beyond. Same 
> procedure as above?
> 
> 3) change Rd.sty, not sure, 1) seems more relevant.
> 
> Please advise, thanks
> 
> Ralf
> 
> 
> 
>> Am 04.07.2022 um 00:08 schrieb Sebastian Meyer <seb.meyer at fau.de 
>> <mailto:seb.meyer at fau.de>>:
>>
>> Am 03.07.22 um 08:27 schrieb Ralf Herold:
>>> Thanks Sebastian,
>>> but not only hash, also ampersand in \href in a tabular environment 
>>> does need to be escaped, otherwise it does not latex (example below). 
>>> I was not aware it is a known limitation for .Rd files despite 
>>> searching for it.
>>
>> I stumbled over that problem a while ago and found that the escaping 
>> issue for the hash symbol is documented in the hyperref manual (but 
>> currently not accounted for by Rd2latex):
>>
>>> The special characters # and ~ do *not* need to be escaped in any way 
>>> (unless the command is used in the argument of another command).
>>
>> For example, this LaTeX code fails to compile:
>> \emph{\href{https://example.org/# <https://example.org/#>}{hash}}
>> In contrast, an ampersand would not need to be escaped in that LaTeX 
>> example.
>>
>> However, I can confirm that a LaTeX error results if an ampersand is 
>> used in a \href URL (but not in \url} that is passed to the special 
>> \Tabular LaTeX command from Rd.sty that is used by Rd2latex() for 
>> \tabular Rd input. Thank you for the heads-up.
>>
>> I think it would be good to improve Rd2latex() / Rd.sty for URLs in 
>> \tabular that contain & or # rather than require special LaTeX 
>> treatment in the Rd source. My preliminary testing shows that hyperref 
>> is happy if [&%#] are always escaped in URLs (sometimes it is not 
>> necessary but it also does not seem to hurt).
>>
>> Best regards,
>>
>> Sebastian Meyer
>>
>>> My use case (with eventually more meaningful query parameters and 
>>> possibly anchors) would work if the existing R code block for 
>>> handling \ifelse in urltools.R was activated as shown below, and this 
>>> is my suggestion. How could I propose this?
>>> Kind regards,
>>> Ralf
>>> \name{mre}
>>> \title{mre}
>>> \description{mre}
>>> \details{
>>> \tabular{l}{
>>> ??\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With> 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With>>}{link}
>>> }}
>>> LaTeX errors:
>>> ! Argument of \href at split has an extra }.
>>> <inserted text>
>>> ? ? ? ? ? ? ? ? \par
>>> l.24 }
>>> Runaway argument?
>>> https://clinicaltrials.gov/ct2/results?cond=Infections\unskip 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip> 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip 
>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip>> \hfil
>>> ! Paragraph ended before \href at split was complete.
>>> <to be read again>
>>> ? ? ? ? ? ? ? ? ? ?\par
>>> l.24 }
>>> ! Extra }, or forgotten \endgroup.
>>> <recently read> }
>>>> Am 03.07.2022 um 01:51 schrieb Sebastian Meyer <seb.meyer at fau.de 
>>>> <mailto:seb.meyer at fau.de> <mailto:seb.meyer at fau.de 
>>>> <mailto:seb.meyer at fau.de>>>:
>>>>
>>>> Am 02.07.22 um 12:01 schrieb Ralf Herold:
>>>>> Hello, in my package documentation I want to include URLs with 
>>>>> query string parameters and anchors, within a table. A minimally 
>>>>> reproducible example is this content in file "man/mre.Rd":
>>>>> \name{mre}
>>>>> \title{mre}
>>>>> \description{mre}
>>>>> \details{
>>>>> \tabular{l}{
>>>>> ??\ifelse{latex}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop> 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>>}{latex 
>>>>> link}}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop> 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>>}{non-latex 
>>>>> link}}
>>>>> }}
>>>>> The ifelse{}{}{} construct is necessary since ampersands in a table 
>>>>> need to be escaped for LaTeX rendering.
>>>>
>>>> This is a red herring. Ampersands do *not* need to be escaped in 
>>>> \href URLs. The problem is the hash symbol, which needs to be 
>>>> escaped if \href is nested within another markup macro, here 
>>>> \Tabular (from Rd.sty). This is a known limitation; Rd2latex will 
>>>> probably do the escaping in the future. It's good to see a use case.
>>>>
>>>> I think currently the best solutions for you are to simply omit the 
>>>> #tableTop part in the LaTeX version or to not use such URLs inside a 
>>>> \tabular.
>>>>
>>>> Hope this helps.
>>>> Best regards,
>>>>
>>>> Sebastian Meyer
>>>>
>>>>> Each of the following commands checks and renders the respective 
>>>>> output correctly:
>>>>> tools::checkRd("man/mre.Rd")
>>>>> tools::Rd2txt("man/mre.Rd")
>>>>> tools::Rd2latex("man/mre.Rd")
>>>>> tools::Rd2HTML("man/mre.Rd")
>>>>> system2("R", c("CMD", "Rd2pdf", "man/mre.Rd"))
>>>>> However, rhub::check_for_cran() results in NOTES:
>>>>> Found the following (possibly) invalid URLs:
>>>>> ??URL: 
>>>>> https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop> 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>>
>>>>> ????From: man/mre.Rd
>>>>> ????Status: 400
>>>>> ????Message: Bad Request
>>>>> Subsequently, CRAN maintainers refused accepting the package.
>>>>> However, the underlying cause is that, during such checks, all 
>>>>> apparent URLs are extracted from .Rd files, irrespective of any 
>>>>> \ifelse{}{}{} constructs. This in turn is due to such checks 
>>>>> involving calls to function ".get_urls_from_Rd" without setting its 
>>>>> argument "ifdef" to TRUE.
>>>>> Here is how to see this behaviour:
>>>>> db <- tools::Rd_db(dir = ".")
>>>>> # get functions
>>>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>>")
>>>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R> 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R>>")
>>>>> .Rd_deparse <- tools:::.Rd_deparse
>>>>> RdTags <- tools:::RdTags
>>>>> # default, leading to invalid url in [1]
>>>>> # > .get_urls_from_Rd(db)
>>>>> # [1] 
>>>>> "https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop> 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop>>"
>>>>> # [2] 
>>>>> "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop> 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>>"
>>>>> # returning relevant valid url
>>>>> #> .get_urls_from_Rd(db, ifdef = TRUE)
>>>>> # [1] 
>>>>> "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop> 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop 
>>>>> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>>"
>>>>> This can be addressed by either:
>>>>> -- changing the signature of ".get_urls_from_Rd" in line 50 in 
>>>>> https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>> 
>>>>> to read "ifdef = TRUE". Of note, this function has a code block to 
>>>>> handle such ifdef constructs which indicates it should be possible 
>>>>> to use them in Rd files.
>>>>> -- changing the calling function "url_db_from_package_Rd_db" to 
>>>>> include "ifdef = TRUE" on line 178 in 
>>>>> https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R 
>>>>> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>>
>>>>> Please advise how to advance on this issue, thank you very much.
>>>>> Greetings
>>>>> Ralf
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org 
>>>>> <mailto:R-package-devel at r-project.org> 
>>>>> <mailto:R-package-devel at r-project.org 
>>>>> <mailto:R-package-devel at r-project.org>> mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel 
>>>>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel> 
>>>>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel 
>>>>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Jul  7 23:37:05 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 7 Jul 2022 17:37:05 -0400
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
Message-ID: <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>

On 07/07/2022 3:55 p.m., Plamen Mirazchiyski wrote:
> Hi,
> 
> Today I have submitted a new version of the RALSA package. Soon after I
> received an automatic email letting me know that the package did not
> pass some of the pre-tests:

It would be helpful to let us know where to see the troublesome NEWS.md 
file.  Maybe a small change in formatting is causing these false positives.

Duncan Murdoch


> 
>> package RALSA_1.3.0.tar.gz does not pass the incoming checks automatically, please see the following pre-tests:
>> Windows:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Windows/00check.log>
>> Status: 2 NOTEs
>> Debian:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Debian/00check.log>
>> Status: 1 NOTE
>>    
>> Last released version's CRAN status: OK: 9, NOTE: 4
>> See:<https://CRAN.R-project.org/web/checks/check_results_RALSA.html>
> 
> To summarize:
> 
> 1. Windows checks found possibly invalid DOIs. This is to be ignored, as
> stated here:
> https://www.mail-archive.com/r-package-devel at r-project.org/msg07116.html
> 
> 2. Windows, Debian (gcc) and Fedora (clang and gcc) drop the following note:
> 
> checking package subdirectories ... NOTE
> Problems with news in 'NEWS.md':
> No news entries found.
> 
> This is rather strange because I have added one of the largest news
> updates I ever made for this package in the NEWS.md file with this
> submission. Further, this note appears only in these four of the 13
> platforms where the package is checked.
> 
> Apparently, this is beyond my control and I can do nothing to fix it on
> my end. I have already replied to the email to notify the
> CRAN-submissions at R-project.org this is a false-positive as advised in
> the email itself, but I thought the mailing list should also be aware of
> this issue.
> 
> Best,
> Plamen
>


From henr|k@bengt@@on @end|ng |rom gm@||@com  Fri Jul  8 00:21:49 2022
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Fri, 8 Jul 2022 00:21:49 +0200
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
Message-ID: <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>

)There's been recent updates in R-devel
(https://github.com/wch/r-source/commit/baf375d8b65414daebf85e226a1e5103a93ab138
that do more validation of the syntax/format in NEWS and NEWS.md
files. This was done to make sure news() works in more cases (e.g. it
may return just NULL if the NEWS.md file is not formatted as the tool
expect).  I guess it will also help render NEWS/NEWS.md files on the
CRAN package pages.

If you run,

news(package = "RALSA")

and see the NEWS entries, then the format should be correct, otherwise
not.  You can use:

news <- tools:::.build_news_db_from_package_NEWS_md("NEWS.md")
if (is.null(news)) stop("Syntax error in NEWS.md")

to troubleshoot.  If you get an error, i.e. 'news' is NULL, then you
need to fix up your NEWS.md file.  I don't think the format is
documented yet, so you might have to do some trial error to figure it
out.  Although it's not an official format, if you follow
https://pkgdown.r-lib.org/reference/build_news.html, it typically
works.  When I did it some weeks ago, I started with a minimal
NEWS.md, e.g. the top version, and then I added the other entries back
to find which ones were problematic.  See
https://raw.githubusercontent.com/HenrikBengtsson/progressr/0.10.1/NEWS.md
for an example that works on CRAN
(https://cran.r-project.org/web/packages/progressr/news/news.html) and
with news(package = "progressr").

Hope this helps,

Henrik

On Thu, Jul 7, 2022 at 11:37 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>
> On 07/07/2022 3:55 p.m., Plamen Mirazchiyski wrote:
> > Hi,
> >
> > Today I have submitted a new version of the RALSA package. Soon after I
> > received an automatic email letting me know that the package did not
> > pass some of the pre-tests:
>
> It would be helpful to let us know where to see the troublesome NEWS.md
> file.  Maybe a small change in formatting is causing these false positives.
>
> Duncan Murdoch
>
>
> >
> >> package RALSA_1.3.0.tar.gz does not pass the incoming checks automatically, please see the following pre-tests:
> >> Windows:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Windows/00check.log>
> >> Status: 2 NOTEs
> >> Debian:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Debian/00check.log>
> >> Status: 1 NOTE
> >>
> >> Last released version's CRAN status: OK: 9, NOTE: 4
> >> See:<https://CRAN.R-project.org/web/checks/check_results_RALSA.html>
> >
> > To summarize:
> >
> > 1. Windows checks found possibly invalid DOIs. This is to be ignored, as
> > stated here:
> > https://www.mail-archive.com/r-package-devel at r-project.org/msg07116.html
> >
> > 2. Windows, Debian (gcc) and Fedora (clang and gcc) drop the following note:
> >
> > checking package subdirectories ... NOTE
> > Problems with news in 'NEWS.md':
> > No news entries found.
> >
> > This is rather strange because I have added one of the largest news
> > updates I ever made for this package in the NEWS.md file with this
> > submission. Further, this note appears only in these four of the 13
> > platforms where the package is checked.
> >
> > Apparently, this is beyond my control and I can do nothing to fix it on
> > my end. I have already replied to the email to notify the
> > CRAN-submissions at R-project.org this is a false-positive as advised in
> > the email itself, but I thought the mailing list should also be aware of
> > this issue.
> >
> > Best,
> > Plamen
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Jul  8 00:22:57 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 8 Jul 2022 01:22:57 +0300
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
Message-ID: <20220708012257.0d5b0c87@Tarkus>

On Thu, 7 Jul 2022 21:55:06 +0200
Plamen Mirazchiyski <plamen.mirazchiyski at ineri.org> wrote:

> Problems with news in 'NEWS.md':
> No news entries found.

This is a new check in R-devel:
https://github.com/r-devel/r-svn/commit/b1dce2cd3a59b80e870dc218dc668d90ff2a50fa
https://github.com/r-devel/r-svn/commit/be94aacfbc62c211e765e00bcb9a4749d5be31c6

R can parse plain text and Markdown NEWS files and build news databases
out of those, but the files are expected to follow a certain format
documented in ?news. Do your headings look like "Changes in version
1.2-3 (2022-07-08)"? Try looking at the output of news(package =
'RALSA'), maybe it would tell you what R thinks is wrong with your
NEWS.md.

-- 
Best regards,
Ivan


From r@||@hero|d @end|ng |rom gmx@net  Fri Jul  8 07:17:59 2022
From: r@||@hero|d @end|ng |rom gmx@net (Ralf Herold)
Date: Fri, 8 Jul 2022 07:17:59 +0200
Subject: [R-pkg-devel] R CMD checks URLs formatted for LaTeX instead of
 using the non-LaTeX URLs, and fails
In-Reply-To: <bb4e57b8-088f-3d40-1150-125c3194ec6b@fau.de>
References: <DBA296A1-ABF8-496E-A3D2-6A2FF8B4294A@gmx.net>
 <f4be4bbf-4ae8-e2fc-1d12-bf56bffab6b1@fau.de>
 <F44171D0-CCE4-4049-9C52-BCC3625C2B2A@gmx.net>
 <a6797515-d9ce-06b4-ef49-83f473954e5f@fau.de>
 <B0D5C060-C722-46D0-BFE5-5888D352BE17@gmx.net>
 <bb4e57b8-088f-3d40-1150-125c3194ec6b@fau.de>
Message-ID: <DF257022-0396-45E5-9840-A1EE4FD9ADF0@gmx.net>

Great, thanks -- 

using \out{} to wrap \href{} in .Rd for latex rendering does circumvent the issue that I reported, which is that .get_urls_from_Rd() is called such that it cannot handle \ifelse{} even though there is code in that R function for handling \ifelse{}.

The \out{} wrapper is useful, thanks. 

Not sure if the issue or the code is obsolete, but thanks again and happy to close this thread. 

Best,
Ralf


> Am 07.07.2022 um 22:41 schrieb Sebastian Meyer <seb.meyer at fau.de>:
> 
> Am 05.07.22 um 19:56 schrieb Ralf Herold:
>> Thanks and I would like to define the follow-up actions:
>> 1) change function "writeURL" on line 207 to read, for example, url <- fsub("([%#&])", "\\\\1",  url) in https://svn.r-project.org/R/trunk/src/library/tools/R/Rd2latex.R <https://svn.r-project.org/R/trunk/src/library/tools/R/Rd2latex.R> to always escape URLs as you mention.
>> How can this be moved forward? This seems R core code, thus needs to be reported in R Bugzilla by one of its members (I am not one): https://www.r-project.org/bugs.html#where-to-submit-bug-reports-and-patches <https://www.r-project.org/bugs.html#where-to-submit-bug-reports-and-patches>. 
> 
> A Bugzilla entry would have been nice for future reference but is no longer necessary. The Rd2latex() bug is now fixed in the development version of R (>= r82557) such that URLs with & or # characters can then also be used inside \tabular and give the same link as in the HTML version: \tabular{l}{\url{https://example.org/a&b#c}} should just work.
> In other words, Rd2latex() now correctly handles the input URL as 'verbatim' text (as specified in WRE Section 2.3), which also means that backslashes in the input that do not escape percent or braces (Rd specials) are preserved in the output (as was already the case for HTML).
> 
> It is planned to port the fix to R-patched (future R 4.2.2).
> 
> In package development I'd probably avoid such URLs inside \tabular until after that release. Otherwise, if you want to support building the PDF manual in current and future R, you'd need to use \out{} and do all the escaping there yourself, for example:
> 
> \name{test}
> \title{test}
> \description{
> \tabular{l}{
>   \ifelse{latex}{
>     \out{\href{https://example.org/a\&b\#c}{link}}
>   }{
>     \href{https://example.org/a&b#c}{link}
>   }
> }
> }
> 
> AFAICS, the below points are obsolete.
> 
> Best regards,
> 
> 	Sebastian Meyer
> 
>> Could someone from this list do this? Many thanks
>> 2) change function "url_db_from_package_Rd_db" to call   ".get_urls_from_Rd" with parameter "ifdef = TRUE" on line 178 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>. This will activate the existing code that is intended to handle ifdef{}{}{}. This seems important for the issue I have reported and beyond. Same procedure as above?
>> 3) change Rd.sty, not sure, 1) seems more relevant.
>> Please advise, thanks
>> Ralf
>>> Am 04.07.2022 um 00:08 schrieb Sebastian Meyer <seb.meyer at fau.de <mailto:seb.meyer at fau.de>>:
>>> 
>>> Am 03.07.22 um 08:27 schrieb Ralf Herold:
>>>> Thanks Sebastian,
>>>> but not only hash, also ampersand in \href in a tabular environment does need to be escaped, otherwise it does not latex (example below). I was not aware it is a known limitation for .Rd files despite searching for it.
>>> 
>>> I stumbled over that problem a while ago and found that the escaping issue for the hash symbol is documented in the hyperref manual (but currently not accounted for by Rd2latex):
>>> 
>>>> The special characters # and ~ do *not* need to be escaped in any way (unless the command is used in the argument of another command).
>>> 
>>> For example, this LaTeX code fails to compile:
>>> \emph{\href{https://example.org/# <https://example.org/#>}{hash}}
>>> In contrast, an ampersand would not need to be escaped in that LaTeX example.
>>> 
>>> However, I can confirm that a LaTeX error results if an ampersand is used in a \href URL (but not in \url} that is passed to the special \Tabular LaTeX command from Rd.sty that is used by Rd2latex() for \tabular Rd input. Thank you for the heads-up.
>>> 
>>> I think it would be good to improve Rd2latex() / Rd.sty for URLs in \tabular that contain & or # rather than require special LaTeX treatment in the Rd source. My preliminary testing shows that hyperref is happy if [&%#] are always escaped in URLs (sometimes it is not necessary but it also does not seem to hurt).
>>> 
>>> Best regards,
>>> 
>>> Sebastian Meyer
>>> 
>>>> My use case (with eventually more meaningful query parameters and possibly anchors) would work if the existing R code block for handling \ifelse in urltools.R was activated as shown below, and this is my suggestion. How could I propose this?
>>>> Kind regards,
>>>> Ralf
>>>> \name{mre}
>>>> \title{mre}
>>>> \description{mre}
>>>> \details{
>>>> \tabular{l}{
>>>>   \href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With>>}{link}
>>>> }}
>>>> LaTeX errors:
>>>> ! Argument of \href at split has an extra }.
>>>> <inserted text>
>>>>                 \par
>>>> l.24 }
>>>> Runaway argument?
>>>> https://clinicaltrials.gov/ct2/results?cond=Infections\unskip <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip> <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip <https://clinicaltrials.gov/ct2/results?cond=Infections\unskip>> \hfil
>>>> ! Paragraph ended before \href at split was complete.
>>>> <to be read again>
>>>>                    \par
>>>> l.24 }
>>>> ! Extra }, or forgotten \endgroup.
>>>> <recently read> }
>>>>> Am 03.07.2022 um 01:51 schrieb Sebastian Meyer <seb.meyer at fau.de <mailto:seb.meyer at fau.de> <mailto:seb.meyer at fau.de <mailto:seb.meyer at fau.de>>>:
>>>>> 
>>>>> Am 02.07.22 um 12:01 schrieb Ralf Herold:
>>>>>> Hello, in my package documentation I want to include URLs with query string parameters and anchors, within a table. A minimally reproducible example is this content in file "man/mre.Rd":
>>>>>> \name{mre}
>>>>>> \title{mre}
>>>>>> \description{mre}
>>>>>> \details{
>>>>>> \tabular{l}{
>>>>>>   \ifelse{latex}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>>}{latex link}}{\href{https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>>}{non-latex link}}
>>>>>> }}
>>>>>> The ifelse{}{}{} construct is necessary since ampersands in a table need to be escaped for LaTeX rendering.
>>>>> 
>>>>> This is a red herring. Ampersands do *not* need to be escaped in \href URLs. The problem is the hash symbol, which needs to be escaped if \href is nested within another markup macro, here \Tabular (from Rd.sty). This is a known limitation; Rd2latex will probably do the escaping in the future. It's good to see a use case.
>>>>> 
>>>>> I think currently the best solutions for you are to simply omit the #tableTop part in the LaTeX version or to not use such URLs inside a \tabular.
>>>>> 
>>>>> Hope this helps.
>>>>> Best regards,
>>>>> 
>>>>> Sebastian Meyer
>>>>> 
>>>>>> Each of the following commands checks and renders the respective output correctly:
>>>>>> tools::checkRd("man/mre.Rd")
>>>>>> tools::Rd2txt("man/mre.Rd")
>>>>>> tools::Rd2latex("man/mre.Rd")
>>>>>> tools::Rd2HTML("man/mre.Rd")
>>>>>> system2("R", c("CMD", "Rd2pdf", "man/mre.Rd"))
>>>>>> However, rhub::check_for_cran() results in NOTES:
>>>>>> Found the following (possibly) invalid URLs:
>>>>>>   URL: https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop> <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\&rslt=With\#tableTop>>
>>>>>>     From: man/mre.Rd
>>>>>>     Status: 400
>>>>>>     Message: Bad Request
>>>>>> Subsequently, CRAN maintainers refused accepting the package.
>>>>>> However, the underlying cause is that, during such checks, all apparent URLs are extracted from .Rd files, irrespective of any \ifelse{}{}{} constructs. This in turn is due to such checks involving calls to function ".get_urls_from_Rd" without setting its argument "ifdef" to TRUE.
>>>>>> Here is how to see this behaviour:
>>>>>> db <- tools::Rd_db(dir = ".")
>>>>>> # get functions
>>>>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>>")
>>>>>> source("https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R> <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R <https://svn.r-project.org/R/trunk/src/library/tools/R/utils.R>>")
>>>>>> .Rd_deparse <- tools:::.Rd_deparse
>>>>>> RdTags <- tools:::RdTags
>>>>>> # default, leading to invalid url in [1]
>>>>>> # > .get_urls_from_Rd(db)
>>>>>> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop> <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections\\&rslt=With\\#tableTop>>"
>>>>>> # [2] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>>"
>>>>>> # returning relevant valid url
>>>>>> #> .get_urls_from_Rd(db, ifdef = TRUE)
>>>>>> # [1] "https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop> <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop <https://clinicaltrials.gov/ct2/results?cond=Infections&rslt=With#tableTop>>"
>>>>>> This can be addressed by either:
>>>>>> -- changing the signature of ".get_urls_from_Rd" in line 50 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>> to read "ifdef = TRUE". Of note, this function has a code block to handle such ifdef constructs which indicates it should be possible to use them in Rd files.
>>>>>> -- changing the calling function "url_db_from_package_Rd_db" to include "ifdef = TRUE" on line 178 in https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R> <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R <https://svn.r-project.org/R/trunk/src/library/tools/R/urltools.R>>
>>>>>> Please advise how to advance on this issue, thank you very much.
>>>>>> Greetings
>>>>>> Ralf
>>>>>> ______________________________________________
>>>>>> R-package-devel at r-project.org <mailto:R-package-devel at r-project.org> <mailto:R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>> mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel <https://stat.ethz.ch/mailman/listinfo/r-package-devel> <https://stat.ethz.ch/mailman/listinfo/r-package-devel <https://stat.ethz.ch/mailman/listinfo/r-package-devel>>
> 


	[[alternative HTML version deleted]]


From p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org  Fri Jul  8 14:23:14 2022
From: p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org (Plamen Mirazchiyski)
Date: Fri, 8 Jul 2022 14:23:14 +0200
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
 <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
Message-ID: <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>

Thank you all for your help.

I have found the problem - I had accented characters in names of people 
I was thanking for discovering bugs. After replacing them with 
non-accented characters everything went just fine and the package is on 
its way to CRAN.

I do find, though, the message "No news entries found." quite 
misleading. Yes, there is a problem, but the message is not even close 
to what actual the problem is. Unfortunately, the r-svn repository on 
GitHub does not have the possibility to report this as an issue.

Thank you once again.

Best,
Plamen

On 7/8/2022 12:21 AM, Henrik Bengtsson wrote:
> )There's been recent updates in R-devel
> (https://github.com/wch/r-source/commit/baf375d8b65414daebf85e226a1e5103a93ab138
> that do more validation of the syntax/format in NEWS and NEWS.md
> files. This was done to make sure news() works in more cases (e.g. it
> may return just NULL if the NEWS.md file is not formatted as the tool
> expect).  I guess it will also help render NEWS/NEWS.md files on the
> CRAN package pages.
>
> If you run,
>
> news(package = "RALSA")
>
> and see the NEWS entries, then the format should be correct, otherwise
> not.  You can use:
>
> news <- tools:::.build_news_db_from_package_NEWS_md("NEWS.md")
> if (is.null(news)) stop("Syntax error in NEWS.md")
>
> to troubleshoot.  If you get an error, i.e. 'news' is NULL, then you
> need to fix up your NEWS.md file.  I don't think the format is
> documented yet, so you might have to do some trial error to figure it
> out.  Although it's not an official format, if you follow
> https://pkgdown.r-lib.org/reference/build_news.html, it typically
> works.  When I did it some weeks ago, I started with a minimal
> NEWS.md, e.g. the top version, and then I added the other entries back
> to find which ones were problematic.  See
> https://raw.githubusercontent.com/HenrikBengtsson/progressr/0.10.1/NEWS.md
> for an example that works on CRAN
> (https://cran.r-project.org/web/packages/progressr/news/news.html) and
> with news(package = "progressr").
>
> Hope this helps,
>
> Henrik
>
> On Thu, Jul 7, 2022 at 11:37 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 07/07/2022 3:55 p.m., Plamen Mirazchiyski wrote:
>>> Hi,
>>>
>>> Today I have submitted a new version of the RALSA package. Soon after I
>>> received an automatic email letting me know that the package did not
>>> pass some of the pre-tests:
>> It would be helpful to let us know where to see the troublesome NEWS.md
>> file.  Maybe a small change in formatting is causing these false positives.
>>
>> Duncan Murdoch
>>
>>
>>>> package RALSA_1.3.0.tar.gz does not pass the incoming checks automatically, please see the following pre-tests:
>>>> Windows:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Windows/00check.log>
>>>> Status: 2 NOTEs
>>>> Debian:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Debian/00check.log>
>>>> Status: 1 NOTE
>>>>
>>>> Last released version's CRAN status: OK: 9, NOTE: 4
>>>> See:<https://CRAN.R-project.org/web/checks/check_results_RALSA.html>
>>> To summarize:
>>>
>>> 1. Windows checks found possibly invalid DOIs. This is to be ignored, as
>>> stated here:
>>> https://www.mail-archive.com/r-package-devel at r-project.org/msg07116.html
>>>
>>> 2. Windows, Debian (gcc) and Fedora (clang and gcc) drop the following note:
>>>
>>> checking package subdirectories ... NOTE
>>> Problems with news in 'NEWS.md':
>>> No news entries found.
>>>
>>> This is rather strange because I have added one of the largest news
>>> updates I ever made for this package in the NEWS.md file with this
>>> submission. Further, this note appears only in these four of the 13
>>> platforms where the package is checked.
>>>
>>> Apparently, this is beyond my control and I can do nothing to fix it on
>>> my end. I have already replied to the email to notify the
>>> CRAN-submissions at R-project.org this is a false-positive as advised in
>>> the email itself, but I thought the mailing list should also be aware of
>>> this issue.
>>>
>>> Best,
>>> Plamen
>>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
======================
Plamen Mirazchiyski, PhD
International Educational Research and Evaluation Institute
24 Tehnolo?ki park
SI-1000 Ljubljana
Slovenia
tel.: +386 51 303 817
email: plamen.mirazchiyski at ineri.org


From henr|k@bengt@@on @end|ng |rom gm@||@com  Fri Jul  8 14:30:39 2022
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Fri, 8 Jul 2022 14:30:39 +0200
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
 <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
 <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
Message-ID: <CAFDcVCTJpwoaTbHO5gNkBsS5h2kGndwssumC0DDXjqSdX+D4dQ@mail.gmail.com>

Good you figured it out. If you can share a minimal NEWS.md illustrating
the problem here, it'll probably help lots of others who run into the same
problem. It might even be bug that your have discovered, but without
details no one can improve on it.

/Henrik

On Fri, Jul 8, 2022, 14:23 Plamen Mirazchiyski <
plamen.mirazchiyski at ineri.org> wrote:

> Thank you all for your help.
>
> I have found the problem - I had accented characters in names of people
> I was thanking for discovering bugs. After replacing them with
> non-accented characters everything went just fine and the package is on
> its way to CRAN.
>
> I do find, though, the message "No news entries found." quite
> misleading. Yes, there is a problem, but the message is not even close
> to what actual the problem is. Unfortunately, the r-svn repository on
> GitHub does not have the possibility to report this as an issue.
>
> Thank you once again.
>
> Best,
> Plamen
>
> On 7/8/2022 12:21 AM, Henrik Bengtsson wrote:
> > )There's been recent updates in R-devel
> > (
> https://github.com/wch/r-source/commit/baf375d8b65414daebf85e226a1e5103a93ab138
> > that do more validation of the syntax/format in NEWS and NEWS.md
> > files. This was done to make sure news() works in more cases (e.g. it
> > may return just NULL if the NEWS.md file is not formatted as the tool
> > expect).  I guess it will also help render NEWS/NEWS.md files on the
> > CRAN package pages.
> >
> > If you run,
> >
> > news(package = "RALSA")
> >
> > and see the NEWS entries, then the format should be correct, otherwise
> > not.  You can use:
> >
> > news <- tools:::.build_news_db_from_package_NEWS_md("NEWS.md")
> > if (is.null(news)) stop("Syntax error in NEWS.md")
> >
> > to troubleshoot.  If you get an error, i.e. 'news' is NULL, then you
> > need to fix up your NEWS.md file.  I don't think the format is
> > documented yet, so you might have to do some trial error to figure it
> > out.  Although it's not an official format, if you follow
> > https://pkgdown.r-lib.org/reference/build_news.html, it typically
> > works.  When I did it some weeks ago, I started with a minimal
> > NEWS.md, e.g. the top version, and then I added the other entries back
> > to find which ones were problematic.  See
> >
> https://raw.githubusercontent.com/HenrikBengtsson/progressr/0.10.1/NEWS.md
> > for an example that works on CRAN
> > (https://cran.r-project.org/web/packages/progressr/news/news.html) and
> > with news(package = "progressr").
> >
> > Hope this helps,
> >
> > Henrik
> >
> > On Thu, Jul 7, 2022 at 11:37 PM Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
> >> On 07/07/2022 3:55 p.m., Plamen Mirazchiyski wrote:
> >>> Hi,
> >>>
> >>> Today I have submitted a new version of the RALSA package. Soon after I
> >>> received an automatic email letting me know that the package did not
> >>> pass some of the pre-tests:
> >> It would be helpful to let us know where to see the troublesome NEWS.md
> >> file.  Maybe a small change in formatting is causing these false
> positives.
> >>
> >> Duncan Murdoch
> >>
> >>
> >>>> package RALSA_1.3.0.tar.gz does not pass the incoming checks
> automatically, please see the following pre-tests:
> >>>> Windows:<
> https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Windows/00check.log
> >
> >>>> Status: 2 NOTEs
> >>>> Debian:<
> https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Debian/00check.log
> >
> >>>> Status: 1 NOTE
> >>>>
> >>>> Last released version's CRAN status: OK: 9, NOTE: 4
> >>>> See:<https://CRAN.R-project.org/web/checks/check_results_RALSA.html>
> >>> To summarize:
> >>>
> >>> 1. Windows checks found possibly invalid DOIs. This is to be ignored,
> as
> >>> stated here:
> >>>
> https://www.mail-archive.com/r-package-devel at r-project.org/msg07116.html
> >>>
> >>> 2. Windows, Debian (gcc) and Fedora (clang and gcc) drop the following
> note:
> >>>
> >>> checking package subdirectories ... NOTE
> >>> Problems with news in 'NEWS.md':
> >>> No news entries found.
> >>>
> >>> This is rather strange because I have added one of the largest news
> >>> updates I ever made for this package in the NEWS.md file with this
> >>> submission. Further, this note appears only in these four of the 13
> >>> platforms where the package is checked.
> >>>
> >>> Apparently, this is beyond my control and I can do nothing to fix it on
> >>> my end. I have already replied to the email to notify the
> >>> CRAN-submissions at R-project.org this is a false-positive as advised in
> >>> the email itself, but I thought the mailing list should also be aware
> of
> >>> this issue.
> >>>
> >>> Best,
> >>> Plamen
> >>>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> ======================
> Plamen Mirazchiyski, PhD
> International Educational Research and Evaluation Institute
> 24 Tehnolo?ki park
> SI-1000 Ljubljana
> Slovenia
> tel.: +386 51 303 817
> email: plamen.mirazchiyski at ineri.org
>
>

	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Fri Jul  8 14:52:27 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Fri, 8 Jul 2022 14:52:27 +0200
Subject: [R-pkg-devel] Slow down in R 4.2.x
In-Reply-To: <13505960.q0Az33yFfb@ryz>
References: <13505960.q0Az33yFfb@ryz>
Message-ID: <f110f828-c011-8a15-3236-f2ccb4e9e6ee@gmail.com>


On 7/1/22 11:10, Johannes Ranke wrote:
> Dear list,
>
> independent of the thread on this list about slow examples on R 4.2 on windows
> I have discovered over the last few days that some of my benchmarks (look for
> t4 and t9) run by a factor of 3 slower on R 4.2.x than on R 4.1.3 [1].
>
> This is on Linux, using my own backported R packages for R 4.2.x and locally
> compiled versions (with default configure options) of R-4-1-branch on two
> different CPUs. The results for R 4.2.1 are only slightly modulated by the use
> of different BLAS version (openblas-serial versus atlas versus lapack).
>
> I also tested the R 4.0.4 version that is part of Debian bullseye, it is as
> fast as the locally compiled R 4.1.3.
>
> I went through the NEWS for R 4.2.0 (because the first slow results were
> obtained using that version), but the only change I could imagine causing such
> a change is the additional check of the length of the arguments && and ||.
>
> Any other thoughts?

I can reproduce slowdown in one of your tests:

library(mkin)
FOCUS_D <- subset(FOCUS_2006_D, value != 0)
SFO_SFO <- mkinmod(
 ? parent = mkinsub("SFO", "m1"),
 ? m1 = mkinsub("SFO"))
FOMC_SFO <- mkinmod(
 ? parent = mkinsub("FOMC", "m1"),
 ? m1 = mkinsub("SFO"))
DFOP_SFO <- mkinmod(
 ? parent = mkinsub("FOMC", "m1"),
 ? m1 = mkinsub("SFO"))

mmkin_bench <- function(models, datasets, error_model = "const") {
 ? mmkin(models, datasets, error_model = error_model, cores = 1, quiet = 
TRUE)
}

t4 <- system.time(mmkin_bench(list(SFO_SFO, FOMC_SFO, DFOP_SFO), 
list(FOCUS_D), error_model = "tc"))[["elapsed"]]

This is slower in R 4-devel than R 4.1 because of bug fixes in DLL info 
interface (PR#16446, r80285). "perf" tool on Linux shows extra time 
spent in R_registerSymbolEptr and R_WeakRefKey. This is because of 
repeated calls to getLoadedDLLs(), via repeated calls to 
inline::getDynLib(x$cf)[["name"]]

Perhaps one could save dll_info, once computed in mkin, alongside "cf" 
in the model, instead of re-computing it every time?

Best
Tomas


>
> Johannes
>
> [1] https://pkgdown.jrwb.de/mkin/articles/web_only/benchmarks.html#results
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Fri Jul  8 14:55:40 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 8 Jul 2022 07:55:40 -0500
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
 <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
 <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
Message-ID: <25288.10572.792507.993341@rob.eddelbuettel.com>


On 8 July 2022 at 14:23, Plamen Mirazchiyski wrote:
| to what actual the problem is. Unfortunately, the r-svn repository on 
| GitHub does not have the possibility to report this as an issue.

Please see  https://bugs.r-project.org/    but also see old mailing list (and
elsewhere) posts on how to create a bugzilla account for which you need a human.

The R FAQ is also there for you:

  9.2 How to report a bug
      https://cran.r-project.org/doc/FAQ/R-FAQ.html#How-to-report-a-bug

which could arguably do with a paragraph on how to get a bugzilla account ...

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org  Fri Jul  8 14:58:37 2022
From: p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org (Plamen Mirazchiyski)
Date: Fri, 8 Jul 2022 14:58:37 +0200
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <CAFDcVCTJpwoaTbHO5gNkBsS5h2kGndwssumC0DDXjqSdX+D4dQ@mail.gmail.com>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
 <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
 <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
 <CAFDcVCTJpwoaTbHO5gNkBsS5h2kGndwssumC0DDXjqSdX+D4dQ@mail.gmail.com>
Message-ID: <23691b0e-10e8-fb57-bad7-652a3dd3c37a@ineri.org>

Yes, here is an excerpt from the NEWS.md with a problematic case at the end:

#######################################################

# RALSA v1.3.0 (2022-07-08)

This update focuses mainly on bugfixes and improvements in the GUI and 
its workflow, but also introduces some new features.

## Bug fixes
* All analysis functions, as well `lsa.data.diag`, `lsa.recode.vars` and 
`lsa.vars.dict` crash with an error message `Error in 
exists(all.vars(match.call())) : first argument has length > 1` when any 
of the arguments specifying analysis variables point to objects which 
contain character vectors containing them. Thanks to Rodolfo Ilizaliturri.

* `lsa.prctls` - The percentiles on the x-axis are not properly added 
for every percentile computed. Thanks to Someone ?ome?ne.

#######################################################

If I remove the accented characters at the very last word, it all works 
fine when the package is submitted at CRAN.

Best,
Plamen

On 7/8/2022 2:30 PM, Henrik Bengtsson wrote:
> Good you figured it out. If you can share a minimal NEWS.md 
> illustrating the problem here, it'll probably help lots of others who 
> run into the same problem. It might even be bug that your have 
> discovered, but without details no one can improve on it.
>
> /Henrik
>
> On Fri, Jul 8, 2022, 14:23 Plamen Mirazchiyski 
> <plamen.mirazchiyski at ineri.org> wrote:
>
>     Thank you all for your help.
>
>     I have found the problem - I had accented characters in names of
>     people
>     I was thanking for discovering bugs. After replacing them with
>     non-accented characters everything went just fine and the package
>     is on
>     its way to CRAN.
>
>     I do find, though, the message "No news entries found." quite
>     misleading. Yes, there is a problem, but the message is not even
>     close
>     to what actual the problem is. Unfortunately, the r-svn repository on
>     GitHub does not have the possibility to report this as an issue.
>
>     Thank you once again.
>
>     Best,
>     Plamen
>
>     On 7/8/2022 12:21 AM, Henrik Bengtsson wrote:
>     > )There's been recent updates in R-devel
>     >
>     (https://github.com/wch/r-source/commit/baf375d8b65414daebf85e226a1e5103a93ab138
>     > that do more validation of the syntax/format in NEWS and NEWS.md
>     > files. This was done to make sure news() works in more cases
>     (e.g. it
>     > may return just NULL if the NEWS.md file is not formatted as the
>     tool
>     > expect).? I guess it will also help render NEWS/NEWS.md files on the
>     > CRAN package pages.
>     >
>     > If you run,
>     >
>     > news(package = "RALSA")
>     >
>     > and see the NEWS entries, then the format should be correct,
>     otherwise
>     > not.? You can use:
>     >
>     > news <- tools:::.build_news_db_from_package_NEWS_md("NEWS.md")
>     > if (is.null(news)) stop("Syntax error in NEWS.md")
>     >
>     > to troubleshoot.? If you get an error, i.e. 'news' is NULL, then you
>     > need to fix up your NEWS.md file.? I don't think the format is
>     > documented yet, so you might have to do some trial error to
>     figure it
>     > out.? Although it's not an official format, if you follow
>     > https://pkgdown.r-lib.org/reference/build_news.html, it typically
>     > works.? When I did it some weeks ago, I started with a minimal
>     > NEWS.md, e.g. the top version, and then I added the other
>     entries back
>     > to find which ones were problematic.? See
>     >
>     https://raw.githubusercontent.com/HenrikBengtsson/progressr/0.10.1/NEWS.md
>     > for an example that works on CRAN
>     >
>     (https://cran.r-project.org/web/packages/progressr/news/news.html) and
>     > with news(package = "progressr").
>     >
>     > Hope this helps,
>     >
>     > Henrik
>     >
>     > On Thu, Jul 7, 2022 at 11:37 PM Duncan Murdoch
>     <murdoch.duncan at gmail.com> wrote:
>     >> On 07/07/2022 3:55 p.m., Plamen Mirazchiyski wrote:
>     >>> Hi,
>     >>>
>     >>> Today I have submitted a new version of the RALSA package.
>     Soon after I
>     >>> received an automatic email letting me know that the package
>     did not
>     >>> pass some of the pre-tests:
>     >> It would be helpful to let us know where to see the troublesome
>     NEWS.md
>     >> file.? Maybe a small change in formatting is causing these
>     false positives.
>     >>
>     >> Duncan Murdoch
>     >>
>     >>
>     >>>> package RALSA_1.3.0.tar.gz does not pass the incoming checks
>     automatically, please see the following pre-tests:
>     >>>>
>     Windows:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Windows/00check.log>
>     >>>> Status: 2 NOTEs
>     >>>>
>     Debian:<https://win-builder.r-project.org/incoming_pretest/RALSA_1.3.0_20220707_190307/Debian/00check.log>
>     >>>> Status: 1 NOTE
>     >>>>
>     >>>> Last released version's CRAN status: OK: 9, NOTE: 4
>     >>>>
>     See:<https://CRAN.R-project.org/web/checks/check_results_RALSA.html
>     <https://CRAN.R-project.org/web/checks/check_results_RALSA.html>>
>     >>> To summarize:
>     >>>
>     >>> 1. Windows checks found possibly invalid DOIs. This is to be
>     ignored, as
>     >>> stated here:
>     >>>
>     https://www.mail-archive.com/r-package-devel at r-project.org/msg07116.html
>     >>>
>     >>> 2. Windows, Debian (gcc) and Fedora (clang and gcc) drop the
>     following note:
>     >>>
>     >>> checking package subdirectories ... NOTE
>     >>> Problems with news in 'NEWS.md':
>     >>> No news entries found.
>     >>>
>     >>> This is rather strange because I have added one of the largest
>     news
>     >>> updates I ever made for this package in the NEWS.md file with this
>     >>> submission. Further, this note appears only in these four of
>     the 13
>     >>> platforms where the package is checked.
>     >>>
>     >>> Apparently, this is beyond my control and I can do nothing to
>     fix it on
>     >>> my end. I have already replied to the email to notify the
>     >>> CRAN-submissions at R-project.org this is a false-positive as
>     advised in
>     >>> the email itself, but I thought the mailing list should also
>     be aware of
>     >>> this issue.
>     >>>
>     >>> Best,
>     >>> Plamen
>     >>>
>     >> ______________________________________________
>     >> R-package-devel at r-project.org mailing list
>     >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>     -- 
>     ======================
>     Plamen Mirazchiyski, PhD
>     International Educational Research and Evaluation Institute
>     24 Tehnolo?ki park
>     SI-1000 Ljubljana
>     Slovenia
>     tel.: +386 51 303 817
>     email: plamen.mirazchiyski at ineri.org
>

-- 
======================
Plamen Mirazchiyski, PhD
International Educational Research and Evaluation Institute
24 Tehnolo?ki park
SI-1000 Ljubljana
Slovenia
tel.: +386 51 303 817
email:plamen.mirazchiyski at ineri.org

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Jul  8 15:00:57 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 8 Jul 2022 16:00:57 +0300
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <25288.10572.792507.993341@rob.eddelbuettel.com>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
 <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
 <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
 <25288.10572.792507.993341@rob.eddelbuettel.com>
Message-ID: <20220708160057.3092a69c@arachnoid>

On Fri, 8 Jul 2022 07:55:40 -0500
Dirk Eddelbuettel <edd at debian.org> wrote:

> which could arguably do with a paragraph on how to get a bugzilla
> account ...

Perhaps the FAQ could link to the https://www.r-project.org/bugs.html
web page, which is also linked from the front page.

-- 
Best regards,
Ivan


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Jul  8 15:28:25 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 8 Jul 2022 16:28:25 +0300
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <23691b0e-10e8-fb57-bad7-652a3dd3c37a@ineri.org>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
 <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
 <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
 <CAFDcVCTJpwoaTbHO5gNkBsS5h2kGndwssumC0DDXjqSdX+D4dQ@mail.gmail.com>
 <23691b0e-10e8-fb57-bad7-652a3dd3c37a@ineri.org>
Message-ID: <20220708162825.28e16346@arachnoid>

On Fri, 8 Jul 2022 14:58:37 +0200
Plamen Mirazchiyski <plamen.mirazchiyski at ineri.org> wrote:

> Yes, here is an excerpt from the NEWS.md with a problematic case at
> the end:

Interesting. The "No news entries found." branch is taken by R CMD
check in case when the news-reading function returns something that
doesn't inherit from 'news_db' or has zero rows without producing any
warning or error messages. Yet if I save this excerpt to a file and
feed it to tools:::.build_news_db_from_package_NEWS_md, I get a valid
news_db object. Can you see any difference in its output between the
NEWS.md that causes a NOTE and the one that doesn't?

-- 
Best regards,
Ivan


From @@mue|@gr@nje@ud @end|ng |rom |n@erm@|r  Fri Jul  8 15:50:07 2022
From: @@mue|@gr@nje@ud @end|ng |rom |n@erm@|r (Samuel Granjeaud)
Date: Fri, 8 Jul 2022 15:50:07 +0200
Subject: [R-pkg-devel] Unused data is silently kept in the environment of a
 function
Message-ID: <81e9fea1-5752-6e8a-097e-44acf079ec7d@inserm.fr>

Dear all,

I want to compute processing functions to apply to the data.
I apply the functions to the data in a second step.
proc_0 increases the memory, proc_1 is safe.
reprex below.

If this behavior is known, could you tell me a workaround before I try 
to guess the best one?

Best,
Samuel

``` r
# for memory tracking
library(pryr)

# a class
setClass(
 ? "fb",
 ? slots = list(d = "numeric", f = "list"),
 ? prototype=list(d = NULL, f = NULL)
)

# memory increased: keep dat somewhere and link it back to the returned 
value
proc_0 <- function(x) {
 ? dat = sample(x at d)
 ? cofactors = c(mean(dat), median(dat), IQR(dat))
 ? model = sapply(cofactors, function(cofactor) function(z) z / cofactor)
 ? x at f = list(model)
 ? x
}

# init data
mem_used()
#> 47 MB
a = new("fb")
a at d = sample(rnorm(1e7))
a at f = list()
mem_used()
#> 127 MB
# memory increased of 80 MB
# process
b = proc_0(a)
mem_used()
#> 207 MB
# memory increased of 80 MB again
rm(a)
mem_used()
#> 207 MB
# memory didn't decreased
b at d = b at d + 1
mem_used()
#> 287 MB
# memory increased
# b at d was really pointing to a at d before increment
sapply(1:3, function(i) ls(environment(b at f[[1]][[i]])))
#> [1] "cofactor" "cofactor" "cofactor"
sapply(1:3, function(i) get("cofactor", environment(b at f[[1]][[i]])))
#> [1] -0.0003085559? 0.0001107148? 1.3485980291
# environments look fine
rm(b)
mem_used()
#> 47.5 MB
# memory released back


# memory safe
proc_1 <- function(x) {
 ? cofactors = c(mean(x at d), median(x at d), IQR(x at d))
 ? model = sapply(cofactors, function(cofactor) function(z) z / cofactor)
 ? x at f = list(model)
 ? x
}

# init data
mem_used()
#> 47.5 MB
a = new("fb")
a at d = sample(rnorm(1e7))
a at f = list()
mem_used()
#> 128 MB
b = proc_1(a)
mem_used()
#> 128 MB
# memory didn't increased; b at d points to a at d; functions weight a few KB
rm(a)
mem_used()
#> 128 MB
sapply(1:3, function(i) ls(environment(b at f[[1]][[i]])))
#> [1] "cofactor" "cofactor" "cofactor"
sapply(1:3, function(i) get("cofactor", environment(b at f[[1]][[i]])))
#> [1] -0.0003133312 -0.0002510665? 1.3491459433

rm(b)
mem_used()
#> 47.5 MB

```

<sup>Created on 2022-07-08 by the [reprex 
package](https://reprex.tidyverse.org) (v2.0.1)</sup>

<details style="margin-bottom:10px;">
<summary>
Session info
</summary>

``` r
sessionInfo()
#> R version 4.2.1 (2022-06-23 ucrt)
#> Platform: x86_64-w64-mingw32/x64 (64-bit)
#> Running under: Windows 10 x64 (build 19044)
#>
#> Matrix products: default
#>
#> locale:
#> [1] LC_COLLATE=French_France.utf8 LC_CTYPE=French_France.utf8
#> [3] LC_MONETARY=French_France.utf8 LC_NUMERIC=C
#> [5] LC_TIME=French_France.utf8
#>
#> attached base packages:
#> [1] stats???? graphics? grDevices utils???? datasets methods?? base
#>
#> other attached packages:
#> [1] pryr_0.1.5
#>
#> loaded via a namespace (and not attached):
#>? [1] Rcpp_1.0.8.3???? codetools_0.2-18 digest_0.6.29 withr_2.5.0
#>? [5] magrittr_2.0.3?? reprex_2.0.1???? evaluate_0.15 highr_0.9
#>? [9] stringi_1.7.6??? rlang_1.0.3????? cli_3.3.0 rstudioapi_0.13
#> [13] fs_1.5.2???????? lobstr_1.1.2???? rmarkdown_2.14 tools_4.2.1
#> [17] stringr_1.4.0??? glue_1.6.2?????? xfun_0.31 yaml_2.3.5
#> [21] fastmap_1.1.0??? compiler_4.2.1?? htmltools_0.5.2 knitr_1.39
```

</details>


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Jul  8 17:01:23 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 8 Jul 2022 11:01:23 -0400
Subject: [R-pkg-devel] 
 Unused data is silently kept in the environment of a function
In-Reply-To: <81e9fea1-5752-6e8a-097e-44acf079ec7d@inserm.fr>
References: <81e9fea1-5752-6e8a-097e-44acf079ec7d@inserm.fr>
Message-ID: <ef370207-e029-1916-36f6-eb406dd48c4f@gmail.com>

I accidentally replied privately to this message.  Here is the reply 
that I intended to send to the list, along with an addition based on 
Samuel's reply to me.

On 08/07/2022 9:50 a.m., Samuel Granjeaud wrote:
 > > Dear all,
 > >
 > > I want to compute processing functions to apply to the data.
 > > I apply the functions to the data in a second step.
 > > proc_0 increases the memory, proc_1 is safe.
 > > reprex below.
 > >
 > > If this behavior is known, could you tell me a workaround before I try
 > > to guess the best one?

When a function is called, it creates an environment that holds the
arguments and all local variables.  If the function returns that
environment, or a value that references it, all the local variables will
still be there.

In your function I believe the anonymous functions you create in `model`
are catching the environment.  Since those functions are created as part
of the evaluation of proc_0, each of them will have the evaluation
environment attached.

NEW addition:  In R, functions have an associated environment set as the 
parent of the evaluation environment mentioned above.  Those are called 
"the environment of the function", and can be retrieved from function fn 
using `environment(fn)`.  For top-level functions like proc_0, 
environment(proc_0) would be the global environment, but for functions 
created within another function, it would be the evaluation environment 
active at the time of creation.

Your code has

   sapply(cofactors, function(cofactor) function(z) z / cofactor)

This creates the function with definition

   function(cofactor) function(z) z / cofactor

The environment of that function will be the evaluation environment of 
proc_0.  When that function is called by sapply(), it will create an 
evaluation environment holding cofactor, and that environment will be 
used by the function returned, i.e. the result of

   function(z) z / cofactor

So you'll end up with this chain of environments:

   environment(function(z) z / cofactor) is the evaluation environment 
of function(cofactor) function(z) z / cofactor;

   its parent is the evaluation environment of proc_0, containing dat;

   its parent is environment(proc_0), which is the global environment.

The global environment isn't captured, but the others are, so you save a 
copy of dat every time you call proc_0.

But none of those functions need access to dat, so there's no need to 
keep it, and after your last use of it in proc_0, just run rm(dat) to 
get rid of it.

OLD part again:

By the way, mem_used() isn't a great way to measure memory use, because
it will count things that will be cleaned up in a future garbage
collection.  When I added "rm(dat)" to your function, I saw this:

  > a = new("fb")
  > a at d = sample(rnorm(1e7))
  > a at f = list()
  > mem_used()
363 MB
  > b = proc_0(a)
  > mem_used()
283 MB

i.e. *less* memory was used after b was created, presumably because a gc
happened.

It's better to use object.size() or pryr::object_size() to measure the
size of individual objects.  Neither one is perfect: they use different
rules to decide what to include, and in some cases, memory used in one
object is counted again as part of another.  The way R allocated memory
means there is *no* perfect definition of the size of an object.

Duncan Murdoch


 > >
 > > Best,
 > > Samuel
 > >
 > > ``` r
 > > # for memory tracking
 > > library(pryr)
 > >
 > > # a class
 > > setClass(
 > >     "fb",
 > >     slots = list(d = "numeric", f = "list"),
 > >     prototype=list(d = NULL, f = NULL)
 > > )
 > >
 > > # memory increased: keep dat somewhere and link it back to the returned
 > > value
 > > proc_0 <- function(x) {
 > >     dat = sample(x at d)
 > >     cofactors = c(mean(dat), median(dat), IQR(dat))
 > >     model = sapply(cofactors, function(cofactor) function(z) z / 
cofactor)
 > >     x at f = list(model)
 > >     x
 > > }
 > >
 > > # init data
 > > mem_used()
 > > #> 47 MB
 > > a = new("fb")
 > > a at d = sample(rnorm(1e7))
 > > a at f = list()
 > > mem_used()
 > > #> 127 MB
 > > # memory increased of 80 MB
 > > # process
 > > b = proc_0(a)
 > > mem_used()
 > > #> 207 MB
 > > # memory increased of 80 MB again
 > > rm(a)
 > > mem_used()
 > > #> 207 MB
 > > # memory didn't decreased
 > > b at d = b at d + 1
 > > mem_used()
 > > #> 287 MB
 > > # memory increased
 > > # b at d was really pointing to a at d before increment
 > > sapply(1:3, function(i) ls(environment(b at f[[1]][[i]])))
 > > #> [1] "cofactor" "cofactor" "cofactor"
 > > sapply(1:3, function(i) get("cofactor", environment(b at f[[1]][[i]])))
 > > #> [1] -0.0003085559  0.0001107148  1.3485980291
 > > # environments look fine
 > > rm(b)
 > > mem_used()
 > > #> 47.5 MB
 > > # memory released back
 > >
 > >
 > > # memory safe
 > > proc_1 <- function(x) {
 > >     cofactors = c(mean(x at d), median(x at d), IQR(x at d))
 > >     model = sapply(cofactors, function(cofactor) function(z) z / 
cofactor)
 > >     x at f = list(model)
 > >     x
 > > }
 > >
 > > # init data
 > > mem_used()
 > > #> 47.5 MB
 > > a = new("fb")
 > > a at d = sample(rnorm(1e7))
 > > a at f = list()
 > > mem_used()
 > > #> 128 MB
 > > b = proc_1(a)
 > > mem_used()
 > > #> 128 MB
 > > # memory didn't increased; b at d points to a at d; functions weight a few KB
 > > rm(a)
 > > mem_used()
 > > #> 128 MB
 > > sapply(1:3, function(i) ls(environment(b at f[[1]][[i]])))
 > > #> [1] "cofactor" "cofactor" "cofactor"
 > > sapply(1:3, function(i) get("cofactor", environment(b at f[[1]][[i]])))
 > > #> [1] -0.0003133312 -0.0002510665  1.3491459433
 > >
 > > rm(b)
 > > mem_used()
 > > #> 47.5 MB
 > >
 > > ```
 > >
 > > <sup>Created on 2022-07-08 by the [reprex
 > > package](https://reprex.tidyverse.org) (v2.0.1)</sup>
 > >
 > > <details style="margin-bottom:10px;">
 > > <summary>
 > > Session info
 > > </summary>
 > >
 > > ``` r
 > > sessionInfo()
 > > #> R version 4.2.1 (2022-06-23 ucrt)
 > > #> Platform: x86_64-w64-mingw32/x64 (64-bit)
 > > #> Running under: Windows 10 x64 (build 19044)
 > > #>
 > > #> Matrix products: default
 > > #>
 > > #> locale:
 > > #> [1] LC_COLLATE=French_France.utf8 LC_CTYPE=French_France.utf8
 > > #> [3] LC_MONETARY=French_France.utf8 LC_NUMERIC=C
 > > #> [5] LC_TIME=French_France.utf8
 > > #>
 > > #> attached base packages:
 > > #> [1] stats     graphics  grDevices utils     datasets methods   base
 > > #>
 > > #> other attached packages:
 > > #> [1] pryr_0.1.5
 > > #>
 > > #> loaded via a namespace (and not attached):
 > > #>  [1] Rcpp_1.0.8.3     codetools_0.2-18 digest_0.6.29 withr_2.5.0
 > > #>  [5] magrittr_2.0.3   reprex_2.0.1     evaluate_0.15 highr_0.9
 > > #>  [9] stringi_1.7.6    rlang_1.0.3      cli_3.3.0 rstudioapi_0.13
 > > #> [13] fs_1.5.2         lobstr_1.1.2     rmarkdown_2.14 tools_4.2.1
 > > #> [17] stringr_1.4.0    glue_1.6.2       xfun_0.31 yaml_2.3.5
 > > #> [21] fastmap_1.1.0    compiler_4.2.1   htmltools_0.5.2 knitr_1.39
 > > ```
 > >
 > > </details>
 > >
 > > ______________________________________________
 > > R-package-devel at r-project.org mailing list
 > > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Jul  8 17:10:20 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 8 Jul 2022 11:10:20 -0400
Subject: [R-pkg-devel] 
 Unused data is silently kept in the environment of a function
In-Reply-To: <ef370207-e029-1916-36f6-eb406dd48c4f@gmail.com>
References: <81e9fea1-5752-6e8a-097e-44acf079ec7d@inserm.fr>
 <ef370207-e029-1916-36f6-eb406dd48c4f@gmail.com>
Message-ID: <235a9cc8-5b3a-d02d-dc50-3943f9beb177@gmail.com>

On 08/07/2022 11:01 a.m., Duncan Murdoch wrote:
  ... lots deleted

> So you'll end up with this chain of environments:
> 
>     environment(function(z) z / cofactor) is the evaluation environment
> of function(cofactor) function(z) z / cofactor;
> 
>     its parent is the evaluation environment of proc_0, containing dat;
> 
>     its parent is environment(proc_0), which is the global environment.
> 
> The global environment isn't captured, but the others are, so you save a
> copy of dat every time you call proc_0.

This may be misleading.  The reference to the global environment will be 
there; what I meant is that there's no extra copy of the global 
environment.  If we didn't have the references in the chain above, the 
evaluation environments would all have been garbage collected after 
proc_0 finished, but because we still have references to them, they are 
"captured", so we keep a copy until those references go away when the 
result of the proc_0 call is deleted.

Duncan Murdoch


From @@mue|@gr@nje@ud @end|ng |rom |n@erm@|r  Fri Jul  8 17:34:24 2022
From: @@mue|@gr@nje@ud @end|ng |rom |n@erm@|r (Samuel Granjeaud)
Date: Fri, 8 Jul 2022 17:34:24 +0200
Subject: [R-pkg-devel] 
 Unused data is silently kept in the environment of a function
In-Reply-To: <235a9cc8-5b3a-d02d-dc50-3943f9beb177@gmail.com>
References: <81e9fea1-5752-6e8a-097e-44acf079ec7d@inserm.fr>
 <ef370207-e029-1916-36f6-eb406dd48c4f@gmail.com>
 <235a9cc8-5b3a-d02d-dc50-3943f9beb177@gmail.com>
Message-ID: <67f9adfc-7675-cd62-06c9-c2457073a231@inserm.fr>

Great answer. I think I missed the point on the parent environment 
although I did my best to care about the environment.

What Ducan removed from my reply is the following and I share it with you:

> Great to have feedback from persons like you,
> Samuel


From joh@nne@@r@nke @end|ng |rom jrwb@de  Fri Jul  8 19:39:32 2022
From: joh@nne@@r@nke @end|ng |rom jrwb@de (Johannes Ranke)
Date: Fri, 08 Jul 2022 19:39:32 +0200
Subject: [R-pkg-devel] Slow down in R 4.2.x; Solved
In-Reply-To: <f110f828-c011-8a15-3236-f2ccb4e9e6ee@gmail.com>
References: <13505960.q0Az33yFfb@ryz>
 <f110f828-c011-8a15-3236-f2ccb4e9e6ee@gmail.com>
Message-ID: <15645492.6oDDn9FRUE@tux>

Am Freitag, 8. Juli 2022, 14:52:27 CEST schrieb Tomas Kalibera:
> On 7/1/22 11:10, Johannes Ranke wrote:
> > Dear list,
> > 
> > independent of the thread on this list about slow examples on R 4.2 on
> > windows I have discovered over the last few days that some of my
> > benchmarks (look for t4 and t9) run by a factor of 3 slower on R 4.2.x
> > than on R 4.1.3 [1].
> > 
> > This is on Linux, using my own backported R packages for R 4.2.x and
> > locally compiled versions (with default configure options) of
> > R-4-1-branch on two different CPUs. The results for R 4.2.1 are only
> > slightly modulated by the use of different BLAS version (openblas-serial
> > versus atlas versus lapack).
> > 
> > I also tested the R 4.0.4 version that is part of Debian bullseye, it is
> > as
> > fast as the locally compiled R 4.1.3.
> > 
> > I went through the NEWS for R 4.2.0 (because the first slow results were
> > obtained using that version), but the only change I could imagine causing
> > such a change is the additional check of the length of the arguments &&
> > and ||.
> > 
> > Any other thoughts?
> 
> I can reproduce slowdown in one of your tests:
> 
> library(mkin)
> FOCUS_D <- subset(FOCUS_2006_D, value != 0)
> SFO_SFO <- mkinmod(
>    parent = mkinsub("SFO", "m1"),
>    m1 = mkinsub("SFO"))
> FOMC_SFO <- mkinmod(
>    parent = mkinsub("FOMC", "m1"),
>    m1 = mkinsub("SFO"))
> DFOP_SFO <- mkinmod(
>    parent = mkinsub("FOMC", "m1"),
>    m1 = mkinsub("SFO"))
> 
> mmkin_bench <- function(models, datasets, error_model = "const") {
>    mmkin(models, datasets, error_model = error_model, cores = 1, quiet =
> TRUE)
> }
> 
> t4 <- system.time(mmkin_bench(list(SFO_SFO, FOMC_SFO, DFOP_SFO),
> list(FOCUS_D), error_model = "tc"))[["elapsed"]]
> 
> This is slower in R 4-devel than R 4.1 because of bug fixes in DLL info
> interface (PR#16446, r80285). "perf" tool on Linux shows extra time
> spent in R_registerSymbolEptr and R_WeakRefKey. This is because of
> repeated calls to getLoadedDLLs(), via repeated calls to
> inline::getDynLib(x$cf)[["name"]]

Thanks a lot for this concise analysis...

> Perhaps one could save dll_info, once computed in mkin, alongside "cf"
> in the model, instead of re-computing it every time?

... and for this excellent suggestion - I did so and the benchmarks are better 
than ever [1].
 
Cheers

Johannes

[1] https://pkgdown.jrwb.de/mkin/articles/web_only/benchmarks.html#results


From bbo|ker @end|ng |rom gm@||@com  Sat Jul  9 22:29:57 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sat, 9 Jul 2022 16:29:57 -0400
Subject: [R-pkg-devel] help/advice on debugging
Message-ID: <d2a61bd8-1b87-a2b2-8f24-14ba72b9e6f0@mcmaster.ca>

   For some stupid reason I agreed to take over maintenance of the 
now-orphaned `gtools` package ("how much trouble could that be, after 
all?"), which has 203 strong reverse dependencies.

   CRAN is reporting that exactly **one** of them, dnapath, is
failing reverse dependency checks ("changed to worse").

   I am having trouble replicating this (I'm running R-devel, can't 
install bioconductor packages on R-devel, working on doing everything in 
a Docker container, blah blah blah ...)

   In any case I am mystified as to how my new version of the package 
could be breaking something in the downstream package, since AFAICT the 
*only* functionality that `dnapath` is using from gtools is `permute()`, 
which is (1) a one-line wrapper for sample() and (2) hasn't changed in 
many years.

    I will try to figure out how much more time to invest in this rabbit 
hole before continuing the conversation with the CRAN maintainers, but 
in the meantime any insights or advice would be welcome.

   The problem is in vignette rebuilding, errors of this form in both of 
the package vignettes:

   Can't join on `x$entrezgene_id` x `y$entrezgene_id` because of
   incompatible types.
   ? `x$entrezgene_id` is of type <double>>.
   ? `y$entrezgene_id` is of type <character>>.

References:

https://win-builder.r-project.org/incoming_pretest/gtools_3.9.3_20220709_010826/reverseDependencies/summary.txt

https://github.com/r-gregmisc/gtools

  cheers
    Ben Bolker


From p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org  Sun Jul 10 13:08:21 2022
From: p|@men@m|r@zch|y@k| @end|ng |rom |ner|@org (Plamen Mirazchiyski)
Date: Sun, 10 Jul 2022 13:08:21 +0200
Subject: [R-pkg-devel] No news entries found
In-Reply-To: <25288.10572.792507.993341@rob.eddelbuettel.com>
References: <45a5fb16-f07e-7760-ed2e-bfe67a93946e@ineri.org>
 <2216f174-35ec-08cf-89da-87f9f4dbaca4@gmail.com>
 <CAFDcVCRidRMRdB7_nJprrXYsKZ=Y1ES7YHUmRohm5k-2Lu+u1g@mail.gmail.com>
 <00068109-285b-ce42-282a-2632915f7c7e@ineri.org>
 <25288.10572.792507.993341@rob.eddelbuettel.com>
Message-ID: <fda4f633-a583-f852-ce75-483eed35a4f1@ineri.org>

Thank you, I contacted R-Bugzilla to create an account for me, 
explaining the reason. The answer was that this is related with CRAN 
incoming packages' checks which does not mean it is an R bug which is to 
be reported and that the CRAN checks are performed using R-devel 
version, not the released, so it is not a bug that shall be reported.

I actually agree with the answer, especially given that the issue I 
encountered was with four out of the 10 platforms where the package was 
checked and not all, so I don't really think it is an R-bug that should 
be reported to R-Bugzilla.

Plamen

On 7/8/2022 2:55 PM, Dirk Eddelbuettel wrote:
> On 8 July 2022 at 14:23, Plamen Mirazchiyski wrote:
> | to what actual the problem is. Unfortunately, the r-svn repository on
> | GitHub does not have the possibility to report this as an issue.
>
> Please see  https://bugs.r-project.org/    but also see old mailing list (and
> elsewhere) posts on how to create a bugzilla account for which you need a human.
>
> The R FAQ is also there for you:
>
>    9.2 How to report a bug
>        https://cran.r-project.org/doc/FAQ/R-FAQ.html#How-to-report-a-bug
>
> which could arguably do with a paragraph on how to get a bugzilla account ...
>
> Dirk
>

-- 
======================
Plamen Mirazchiyski, PhD
International Educational Research and Evaluation Institute
24 Tehnolo?ki park
SI-1000 Ljubljana
Slovenia
tel.: +386 51 303 817
email: plamen.mirazchiyski at ineri.org


From kry|ov@r00t @end|ng |rom gm@||@com  Sun Jul 10 17:54:16 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 10 Jul 2022 18:54:16 +0300
Subject: [R-pkg-devel] help/advice on debugging
In-Reply-To: <d2a61bd8-1b87-a2b2-8f24-14ba72b9e6f0@mcmaster.ca>
References: <d2a61bd8-1b87-a2b2-8f24-14ba72b9e6f0@mcmaster.ca>
Message-ID: <20220710185416.6ad0a7ea@trisector>

On Sat, 9 Jul 2022 16:29:57 -0400
Ben Bolker <bbolker at gmail.com> wrote:

>    The problem is in vignette rebuilding, errors of this form in both
> of the package vignettes:
> 
>    Can't join on `x$entrezgene_id` x `y$entrezgene_id` because of
>    incompatible types.
>    ? `x$entrezgene_id` is of type <double>>.
>    ? `y$entrezgene_id` is of type <character>>.

I'd hazard a guess that both vignettes crash in a call to
entrez_to_symbol (a direct one or via rename_genes). Specifically, its
first argument (`x`) is converted to numeric, then the following
happens:

    df <- data.frame(entrezgene_id = x)
    df <- dplyr::left_join(df, gene_info, by = "entrezgene_id")

gene_info is obtained above, using the following:

  gene_info <- get_biomart_mapping(species, symbol_name, dir_save,
                                   verbose) %>%
    dplyr::group_by(entrezgene_id) %>%
    dplyr::summarise(dplyr::across(dplyr::everything(), dplyr::first))

get_biomart_mapping accesses the Internet using biomaRt::getBM if it
can, but otherwise uses a copy of the information for human genome
cached inside the package.

There doesn't seem to be any mention of special cases for
"entrezgene_id" in the code of the biomaRt package. biomaRt::getBM
POSTs XML queries to ensembl.org/biomart/martservice?... and parses the
resulting tab-separated values using read.table.

My guess is, ensembl.org started returning something that isn't a
number in the entrezgene_id column, and you were the first one to
rebuild the vignette and notice that.

-- 
Best regards,
Ivan


From edwwe|2020 @end|ng |rom gm@||@com  Sun Jul 10 22:41:12 2022
From: edwwe|2020 @end|ng |rom gm@||@com (Edward Wei)
Date: Sun, 10 Jul 2022 13:41:12 -0700
Subject: [R-pkg-devel] Unsure why my package failed pre-check
Message-ID: <CAEf_eRBeAnOw3DY-Rt_UmN_tD5XabDUL89ovTm05AMQAoHuqNg@mail.gmail.com>

Is the reason my package failed because the functions assign global
variables? If this is the case, can I see where it says that functions
should not assign global variables?



* using log directory 'd:/RCompile/CRANincoming/R-devel/avfintools.Rcheck'
* using R Under development (unstable) (2022-07-09 r82572 ucrt)
* using platform: x86_64-w64-mingw32 (64-bit)
* using session charset: UTF-8
* checking for file 'avfintools/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'avfintools' version '0.1.0'
* package encoding: UTF-8
* checking CRAN incoming feasibility ... NOTE
Maintainer: 'Edward Wei <edwwei2020 at gmail.com>'

New submission

Possibly misspelled words in DESCRIPTION:
  Avfintools (10:18)
  CRAN (9:34)
  Vantager (3:55, 10:46, 11:56)
  alphavantager (8:3, 9:7)
  api (7:49)
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for hidden files and directories ... OK
* checking for portable file names ... OK
* checking whether package 'avfintools' can be installed ... OK
* checking installed package size ... OK
* checking package directory ... OK
* checking for future file timestamps ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking for left-over files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* checking whether the package can be loaded ... OK
* checking whether the package can be loaded with stated dependencies ... OK
* checking whether the package can be unloaded cleanly ... OK
* checking whether the namespace can be loaded with stated dependencies ... OK
* checking whether the namespace can be unloaded cleanly ... OK
* checking loading without being on the library search path ... OK
* checking use of S3 registration ... OK
* checking dependencies in R code ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking R code for possible problems ... [8s] NOTE
Found the following assignments to the global environment:
File 'avfintools/R/avfintools.R':
  assign(paste0(ticker, "daily"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(ticker, "15"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(ticker, "15"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(ticker, "wk"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(ticker, "60"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(ticker, "60"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(ticker, "5"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(ticker, "5"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(coin_name, "60"), addreturns(retdata), envir = .GlobalEnv)
  assign(paste0(coin_name, "daily"), retdata, envir = .GlobalEnv)
* checking Rd files ... [1s] OK
* checking Rd metadata ... OK
* checking Rd line widths ... OK
* checking Rd cross-references ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking Rd contents ... OK
* checking for unstated dependencies in examples ... OK
* checking contents of 'data' directory ... OK
* checking data for non-ASCII characters ... OK
* checking LazyData ... OK
* checking data for ASCII and uncompressed saves ... OK
* checking examples ... [9s] OK
* checking PDF version of manual ... OK
* checking for detritus in the temp directory ... OK
* DONE
Status: 2 NOTEs

	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Sun Jul 10 23:11:19 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Sun, 10 Jul 2022 14:11:19 -0700
Subject: [R-pkg-devel] Unsure why my package failed pre-check
In-Reply-To: <CAEf_eRBeAnOw3DY-Rt_UmN_tD5XabDUL89ovTm05AMQAoHuqNg@mail.gmail.com>
References: <CAEf_eRBeAnOw3DY-Rt_UmN_tD5XabDUL89ovTm05AMQAoHuqNg@mail.gmail.com>
Message-ID: <B677D5C8-0435-456A-ABA4-ECFDF0C63549@dcn.davis.ca.us>

https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Package-namespaces

Namespaces are sealed after loading. Workaround is to create a global variable that is an environment in an `.onLoad` hook, and modify variables in that environment instead.

On July 10, 2022 1:41:12 PM PDT, Edward Wei <edwwei2020 at gmail.com> wrote:
>Is the reason my package failed because the functions assign global
>variables? If this is the case, can I see where it says that functions
>should not assign global variables?
>
>
>
>* using log directory 'd:/RCompile/CRANincoming/R-devel/avfintools.Rcheck'
>* using R Under development (unstable) (2022-07-09 r82572 ucrt)
>* using platform: x86_64-w64-mingw32 (64-bit)
>* using session charset: UTF-8
>* checking for file 'avfintools/DESCRIPTION' ... OK
>* checking extension type ... Package
>* this is package 'avfintools' version '0.1.0'
>* package encoding: UTF-8
>* checking CRAN incoming feasibility ... NOTE
>Maintainer: 'Edward Wei <edwwei2020 at gmail.com>'
>
>New submission
>
>Possibly misspelled words in DESCRIPTION:
>  Avfintools (10:18)
>  CRAN (9:34)
>  Vantager (3:55, 10:46, 11:56)
>  alphavantager (8:3, 9:7)
>  api (7:49)
>* checking package namespace information ... OK
>* checking package dependencies ... OK
>* checking if this is a source package ... OK
>* checking if there is a namespace ... OK
>* checking for hidden files and directories ... OK
>* checking for portable file names ... OK
>* checking whether package 'avfintools' can be installed ... OK
>* checking installed package size ... OK
>* checking package directory ... OK
>* checking for future file timestamps ... OK
>* checking DESCRIPTION meta-information ... OK
>* checking top-level files ... OK
>* checking for left-over files ... OK
>* checking index information ... OK
>* checking package subdirectories ... OK
>* checking R files for non-ASCII characters ... OK
>* checking R files for syntax errors ... OK
>* checking whether the package can be loaded ... OK
>* checking whether the package can be loaded with stated dependencies ... OK
>* checking whether the package can be unloaded cleanly ... OK
>* checking whether the namespace can be loaded with stated dependencies ... OK
>* checking whether the namespace can be unloaded cleanly ... OK
>* checking loading without being on the library search path ... OK
>* checking use of S3 registration ... OK
>* checking dependencies in R code ... OK
>* checking S3 generic/method consistency ... OK
>* checking replacement functions ... OK
>* checking foreign function calls ... OK
>* checking R code for possible problems ... [8s] NOTE
>Found the following assignments to the global environment:
>File 'avfintools/R/avfintools.R':
>  assign(paste0(ticker, "daily"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(ticker, "15"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(ticker, "15"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(ticker, "wk"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(ticker, "60"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(ticker, "60"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(ticker, "5"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(ticker, "5"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(coin_name, "60"), addreturns(retdata), envir = .GlobalEnv)
>  assign(paste0(coin_name, "daily"), retdata, envir = .GlobalEnv)
>* checking Rd files ... [1s] OK
>* checking Rd metadata ... OK
>* checking Rd line widths ... OK
>* checking Rd cross-references ... OK
>* checking for missing documentation entries ... OK
>* checking for code/documentation mismatches ... OK
>* checking Rd \usage sections ... OK
>* checking Rd contents ... OK
>* checking for unstated dependencies in examples ... OK
>* checking contents of 'data' directory ... OK
>* checking data for non-ASCII characters ... OK
>* checking LazyData ... OK
>* checking data for ASCII and uncompressed saves ... OK
>* checking examples ... [9s] OK
>* checking PDF version of manual ... OK
>* checking for detritus in the temp directory ... OK
>* DONE
>Status: 2 NOTEs
>
>	[[alternative HTML version deleted]]
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Jul 11 01:31:36 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 10 Jul 2022 19:31:36 -0400
Subject: [R-pkg-devel] Unsure why my package failed pre-check
In-Reply-To: <CAEf_eRBeAnOw3DY-Rt_UmN_tD5XabDUL89ovTm05AMQAoHuqNg@mail.gmail.com>
References: <CAEf_eRBeAnOw3DY-Rt_UmN_tD5XabDUL89ovTm05AMQAoHuqNg@mail.gmail.com>
Message-ID: <f0b1843c-d3a7-bc60-a9da-ee9c0c73b383@gmail.com>

On 10/07/2022 4:41 p.m., Edward Wei wrote:
> Is the reason my package failed because the functions assign global
> variables? If this is the case, can I see where it says that functions
> should not assign global variables?

It's in the CRAN repository policy:

"- Packages should not modify the global environment (user?s workspace)."

Duncan Murdoch

> 
> 
> 
> * using log directory 'd:/RCompile/CRANincoming/R-devel/avfintools.Rcheck'
> * using R Under development (unstable) (2022-07-09 r82572 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: UTF-8
> * checking for file 'avfintools/DESCRIPTION' ... OK
> * checking extension type ... Package
> * this is package 'avfintools' version '0.1.0'
> * package encoding: UTF-8
> * checking CRAN incoming feasibility ... NOTE
> Maintainer: 'Edward Wei <edwwei2020 at gmail.com>'
> 
> New submission
> 
> Possibly misspelled words in DESCRIPTION:
>    Avfintools (10:18)
>    CRAN (9:34)
>    Vantager (3:55, 10:46, 11:56)
>    alphavantager (8:3, 9:7)
>    api (7:49)
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking whether package 'avfintools' can be installed ... OK
> * checking installed package size ... OK
> * checking package directory ... OK
> * checking for future file timestamps ... OK
> * checking DESCRIPTION meta-information ... OK
> * checking top-level files ... OK
> * checking for left-over files ... OK
> * checking index information ... OK
> * checking package subdirectories ... OK
> * checking R files for non-ASCII characters ... OK
> * checking R files for syntax errors ... OK
> * checking whether the package can be loaded ... OK
> * checking whether the package can be loaded with stated dependencies ... OK
> * checking whether the package can be unloaded cleanly ... OK
> * checking whether the namespace can be loaded with stated dependencies ... OK
> * checking whether the namespace can be unloaded cleanly ... OK
> * checking loading without being on the library search path ... OK
> * checking use of S3 registration ... OK
> * checking dependencies in R code ... OK
> * checking S3 generic/method consistency ... OK
> * checking replacement functions ... OK
> * checking foreign function calls ... OK
> * checking R code for possible problems ... [8s] NOTE
> Found the following assignments to the global environment:
> File 'avfintools/R/avfintools.R':
>    assign(paste0(ticker, "daily"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(ticker, "15"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(ticker, "15"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(ticker, "wk"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(ticker, "60"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(ticker, "60"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(ticker, "5"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(ticker, "5"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(coin_name, "60"), addreturns(retdata), envir = .GlobalEnv)
>    assign(paste0(coin_name, "daily"), retdata, envir = .GlobalEnv)
> * checking Rd files ... [1s] OK
> * checking Rd metadata ... OK
> * checking Rd line widths ... OK
> * checking Rd cross-references ... OK
> * checking for missing documentation entries ... OK
> * checking for code/documentation mismatches ... OK
> * checking Rd \usage sections ... OK
> * checking Rd contents ... OK
> * checking for unstated dependencies in examples ... OK
> * checking contents of 'data' directory ... OK
> * checking data for non-ASCII characters ... OK
> * checking LazyData ... OK
> * checking data for ASCII and uncompressed saves ... OK
> * checking examples ... [9s] OK
> * checking PDF version of manual ... OK
> * checking for detritus in the temp directory ... OK
> * DONE
> Status: 2 NOTEs
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bertc@rne|| @end|ng |rom gm@||@com  Sun Jul 10 14:03:54 2022
From: bertc@rne|| @end|ng |rom gm@||@com (Rob C)
Date: Sun, 10 Jul 2022 08:03:54 -0400
Subject: [R-pkg-devel] help/advice on debugging
In-Reply-To: <mailman.8255.3.1657447202.42275.r-package-devel@r-project.org>
References: <mailman.8255.3.1657447202.42275.r-package-devel@r-project.org>
Message-ID: <CAPtunJYVcj1wpGMRB-jQhuE5_0CVHaLERudwLkKcprAu2=P3EQ@mail.gmail.com>

Comments in-line:

> Date: Sat, 9 Jul 2022 16:29:57 -0400
> From: Ben Bolker <bbolker at gmail.com>
> To: R Package Development <r-package-devel at r-project.org>
> Subject: [R-pkg-devel] help/advice on debugging
> Message-ID: <d2a61bd8-1b87-a2b2-8f24-14ba72b9e6f0 at mcmaster.ca>
> Content-Type: text/plain; charset="utf-8"; Format="flowed"
>
>    For some stupid reason I agreed to take over maintenance of the
> now-orphaned `gtools` package ("how much trouble could that be, after
> all?"), which has 203 strong reverse dependencies.

Thanks for taking over an orphaned package.  Not an easy task!

>
>    CRAN is reporting that exactly **one** of them, dnapath, is
> failing reverse dependency checks ("changed to worse").
>
>    I am having trouble replicating this (I'm running R-devel, can't
> install bioconductor packages on R-devel, working on doing everything in
> a Docker container, blah blah blah ...)
>
>    In any case I am mystified as to how my new version of the package
> could be breaking something in the downstream package, since AFAICT the
> *only* functionality that `dnapath` is using from gtools is `permute()`,
> which is (1) a one-line wrapper for sample() and (2) hasn't changed in
> many years.

I think that dnapath is calling `gtools::permutations` from
`dnapath.R` around lines 339-343 [1], not `gtools::permute`.

Changes to  the file `combinations.R` in `gtools` where `permutations`
resides were made in June 2021 [2].

>
>     I will try to figure out how much more time to invest in this rabbit
> hole before continuing the conversation with the CRAN maintainers, but
> in the meantime any insights or advice would be welcome.
>
>    The problem is in vignette rebuilding, errors of this form in both of
> the package vignettes:
>
>    Can't join on `x$entrezgene_id` x `y$entrezgene_id` because of
>    incompatible types.
>    ? `x$entrezgene_id` is of type <double>>.
>    ? `y$entrezgene_id` is of type <character>>.
>

I could not find an obvious place where the join above is happening in
the vignette, unfortunately, so I can't be of more help than just
pointing you in a different direction.

> References:
>
> https://win-builder.r-project.org/incoming_pretest/gtools_3.9.3_20220709_010826/reverseDependencies/summary.txt
>
> https://github.com/r-gregmisc/gtools
>
>   cheers
>     Ben Bolker

Rob Carnell

[1] https://github.com/cran/dnapath/blob/34089ec1f3c505692554dcaa49b55d0ce36a91e2/R/dna.R
[2] https://github.com/r-gregmisc/gtools/blob/62e599c3f634f0bc0f99f586e39200a850ef186c/R/combinations.R


From georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk  Fri Jul 15 14:50:34 2022
From: georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk (Georgi Boshnakov)
Date: Fri, 15 Jul 2022 12:50:34 +0000
Subject: [R-pkg-devel] package stuck in CRAN 'pretest' for a day
Message-ID: <CWLP265MB3505F2DAC952509AC6F86A58AE8B9@CWLP265MB3505.GBRP265.PROD.OUTLOOK.COM>

Submitted package 'fGarch' has been stuck in CRAN 'pretest' for about 24 hours now. The same seems to hold for several other packages. Is this something that can be expected normally?

The pretest service seems to work normally in that other packages come and go.

Thanks,
Georgi Boshnakov

	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Fri Jul 15 16:07:18 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Fri, 15 Jul 2022 16:07:18 +0200
Subject: [R-pkg-devel] package stuck in CRAN 'pretest' for a day
In-Reply-To: <CWLP265MB3505F2DAC952509AC6F86A58AE8B9@CWLP265MB3505.GBRP265.PROD.OUTLOOK.COM>
References: <CWLP265MB3505F2DAC952509AC6F86A58AE8B9@CWLP265MB3505.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <6df55e9b-b0f6-34a9-7b39-8640971caddf@gmail.com>

On 7/15/22 14:50, Georgi Boshnakov wrote:
> Submitted package 'fGarch' has been stuck in CRAN 'pretest' for about 24 hours now. The same seems to hold for several other packages. Is this something that can be expected normally?
>
> The pretest service seems to work normally in that other packages come and go.

My guess is it is because of a problem in R-devel, the development 
version of R, which has been fixed/reverted but it may take some time 
for systems to recover (82587+82589, the former tested on 
CRAN/Bioconductor packages, the latter being a hot-fix of the former, 
which unfortunately made a very large number of CRAN packages to fail). 
It is part of an attempt to fix semantics of useBytes=TRUE ([1] is 
somewhat related). Sorry for the inconvenience.

Tomas

[1] 
https://blog.r-project.org/2022/07/12/speedups-in-operations-with-regular-expressions

>
> Thanks,
> Georgi Boshnakov
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Fri Jul 15 16:57:15 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Fri, 15 Jul 2022 16:57:15 +0200
Subject: [R-pkg-devel] package stuck in CRAN 'pretest' for a day
In-Reply-To: <6df55e9b-b0f6-34a9-7b39-8640971caddf@gmail.com>
References: <CWLP265MB3505F2DAC952509AC6F86A58AE8B9@CWLP265MB3505.GBRP265.PROD.OUTLOOK.COM>
 <6df55e9b-b0f6-34a9-7b39-8640971caddf@gmail.com>
Message-ID: <105a538c-eea0-63cb-9db2-6e59fddb834d@statistik.tu-dortmund.de>



On 15.07.2022 16:07, Tomas Kalibera wrote:
> On 7/15/22 14:50, Georgi Boshnakov wrote:
>> Submitted package 'fGarch' has been stuck in CRAN 'pretest' for about 
>> 24 hours now. The same seems to hold for several other packages. Is 
>> this something that can be expected normally?
>>
>> The pretest service seems to work normally in that other packages come 
>> and go.
> 
> My guess is it is because of a problem in R-devel, the development 
> version of R, which has been fixed/reverted but it may take some time 
> for systems to recover (82587+82589, the former tested on 
> CRAN/Bioconductor packages, the latter being a hot-fix of the former, 
> which unfortunately made a very large number of CRAN packages to fail). 
> It is part of an attempt to fix semantics of useBytes=TRUE ([1] is 
> somewhat related). Sorry for the inconvenience.

I have not had the time to look into the details of the stuck packages, 
but Tomas explanation is most likely true, as both the recheck systems 
maintained by Kurt and also my winbuilder platform have packages stuck 
in the queues.
Please be patient, we try to fix this soon.

Best,
Uwe


> 
> Tomas
> 
> [1] 
> https://blog.r-project.org/2022/07/12/speedups-in-operations-with-regular-expressions 
> 
> 
>>
>> Thanks,
>> Georgi Boshnakov
>>
>> ????[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @n248 @end|ng |rom corne||@edu  Tue Jul 19 05:22:52 2022
From: @n248 @end|ng |rom corne||@edu (Satyaprakash Nayak)
Date: Mon, 18 Jul 2022 23:22:52 -0400
Subject: [R-pkg-devel] Fwd: cmake based compilation works on macOS but fails
 on Linux machines
In-Reply-To: <CAM3Cqv+4HXyrxVDzLw9k2J6j1iRLXM9o2Tdr6RyDBa54XHdrwg@mail.gmail.com>
References: <CAM3Cqv+4HXyrxVDzLw9k2J6j1iRLXM9o2Tdr6RyDBa54XHdrwg@mail.gmail.com>
Message-ID: <CAM3CqvKLLuQxbV_5zXM5aJ58SGGWSzDDT3hQC2mM3J2+KYyHFA@mail.gmail.com>

Hi everyone

I am trying to compile a package which provides an interface to the Ceres
solver <http://ceres-solver.org/> C++ library for large-scale,
unconstrained optimization. The requirements for compiling this library are
non-trivial and I am using cmake based compilation into static libraries,
following the steps in the excellent nloptr package
<https://github.com/astamm/nloptr>

The package code can be found here <https://github.com/sn248/ceres>

The package requires Eigen
<https://eigen.tuxfamily.org/index.php?title=Main_Page>, gflags
<https://gflags.github.io/gflags/> and glog <https://github.com/google/glog>
as requirements and they are all compiled from source before compiling
ceres from source using cmake. The package successfully compiles and I am
able to run the helloworld example in the library on my macOS (10.15.7),
see the example on the github page <https://github.com/sn248/ceres>. I am
also able to compile on rhub's mac OS machines (i.e., macOS 10.13.6 High
Sierra, R-release, brew AND macOS 10.13.6 High Sierra, R-release, CRAN's
setup). However, _exactly_ the same package fails to compile on Ubuntu and
Debian machines on rhub.

In summary,

Case 1 - When my Makevars is the following, the package compiles
successfully on my local macOS and rhub's macOS (all except Apple Silicon,
M1).

CXX_STD = CXX17
> PKG_CPPFLAGS = -I../inst/include
> PKG_LDFLAGS = ../inst/
> PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS) -L$(PKG_LDFLAGS)
> ../inst/libceres.a ../inst/libgflags.a ../inst/libgflags_nothreads.a
> ../inst/libglog.a


But I get the following error on Linux machines (e.g., Debian Linux,
R-devel, GCC)

Error: package or namespace load failed for 'ceres' in dyn.load(file,
> DLLpath = DLLpath, ...):
>  unable to load shared object
> '/home/docker/R/00LOCK-ceres/00new/ceres/libs/ceres.so':
>   /home/docker/R/00LOCK-ceres/00new/ceres/libs/ceres.so: undefined symbol:
> _ZN6google14FlagRegistererC1IiEEPKcS3_S3_PT_S5_
> Error: loading failed


Case 2 - When my Makevars is the following, I get error shown below on my
local machine (macOS 10.15.7)

CXX_STD = CXX17
> PKG_CPPFLAGS = -I../inst/include
> PKG_LDFLAGS = ../inst/
> PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS) -L$(PKG_LDFLAGS) -lceres
> -lgflags -lgflags_nothreads -lglog


Error message:

Error in dyn.load(dll_copy_file) :
>   unable to load shared object
> '/var/folders/nk/j257crk53f9__1tfl_r91gm40000gq/T//Rtmp75jns4/pkgloadfebd425b03cc/ceres.so':
>
> dlopen(/var/folders/nk/j257crk53f9__1tfl_r91gm40000gq/T//Rtmp75jns4/pkgloadfebd425b03cc/ceres.so,
> 6): Library not loaded: @rpath/libglog.1.dylib
>   Referenced from:
> /private/var/folders/nk/j257crk53f9__1tfl_r91gm40000gq/T/Rtmp75jns4/pkgloadfebd425b03cc/ceres.so
>   Reason: image not found


I am thinking this is because of the fact that glog has the default cmake
option of being built as a shared library (although a static library can
also be built and is being built in the package).  However, I don't know
how I can link the shared library libglog.dylib.

To make the matters more interesting, if I install the packages on an
Ubuntu system (i.e., rocker/rstudio <https://rocker-project.org/images/>
with system installs of Eigen, glog and gflags), the package compiles
successfully with Makevars as in Case 2.

I would be very thankful if any help/pointers can be provided to compile
the package on Linux machines. Additionally, it seems on Apple Mac (M1) and
Solaris machines the compilation of package fails due to cmake
non-availability, how can I compile on those platforms?

Thanks
Satya

	[[alternative HTML version deleted]]


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jul 19 08:37:30 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 19 Jul 2022 01:37:30 -0500
Subject: [R-pkg-devel] Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
Message-ID: <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>

Hello:


	  What's the recommended fix for "?Warning in gsub(gsLi$pattern, 
gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m' to a wide 
string; Error in gsub(gsLi$pattern, gsLi$replacement, xo) : input string 
1 is invalid"?


	  This is in:


https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd


	  R-devel is now rejecting some non-ASCII characters that it previously 
accepted;  see below.


	  Thanks,
	  Spencer Graves


-------- Forwarded Message --------
Subject: CRAN package Ecfun and its reverse dependencies
Date: Wed, 13 Jul 2022 06:34:24 +0100
From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
Reply-To: CRAN at R-project.org
To: veronica.vinciotti at brunel.ac.uk, 
spencer.graves at effectivedefense.org, hamedhaseli at gmail.com, 
dennis.prangle at gmail.com
CC: CRAN at R-project.org

Dear maintainers,

This concerns the CRAN packages

   BDWreg DWreg Ecdat Ecfun gk

maintained by one of you:

   Dennis Prangle <dennis.prangle at gmail.com>: gk
   Hamed Haselimashhadi <hamedhaseli at gmail.com>: BDWreg
   Spencer Graves <spencer.graves at effectivedefense.org>: Ecfun Ecdat
   Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk>: DWreg

We have asked for an update fixing the check problems shown at
   <https://cran.r-project.org/web/checks/check_results_Ecfun.html>
with no update from the maintainer thus far.

Thus, package Ecfun is now scheduled for archival on 2022-08-08, and
archiving this will necessitate also archiving its CRAN strong reverse
dependencies.

Please negotiate the necessary actions.

The CRAN Team


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Tue Jul 19 09:20:15 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Tue, 19 Jul 2022 09:20:15 +0200
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
Message-ID: <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>


On 7/19/22 08:37, Spencer Graves wrote:
> Hello:
>
>
> ????? What's the recommended fix for "?Warning in gsub(gsLi$pattern, 
> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m' to a wide 
> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo) : input 
> string 1 is invalid"?
>
>
> ????? This is in:
>
>
> https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd 
>
>
>
> ????? R-devel is now rejecting some non-ASCII characters that it 
> previously accepted;? see below.

Please see 
https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions

Looking at the code I guess you should change the strings in icx to use 
\u escapes instead of \x. The use of \x as it is there was probably 
correct when the code was ran in Latin-1 encoding, but not in other 
encodings. Using \u would make it portable. Feel free to ask more if my 
guess is wrong and reading the blog post doesn't help.

Best
Tomas



>
>
> ????? Thanks,
> ????? Spencer Graves
>
>
> -------- Forwarded Message --------
> Subject: CRAN package Ecfun and its reverse dependencies
> Date: Wed, 13 Jul 2022 06:34:24 +0100
> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> Reply-To: CRAN at R-project.org
> To: veronica.vinciotti at brunel.ac.uk, 
> spencer.graves at effectivedefense.org, hamedhaseli at gmail.com, 
> dennis.prangle at gmail.com
> CC: CRAN at R-project.org
>
> Dear maintainers,
>
> This concerns the CRAN packages
>
> ? BDWreg DWreg Ecdat Ecfun gk
>
> maintained by one of you:
>
> ? Dennis Prangle <dennis.prangle at gmail.com>: gk
> ? Hamed Haselimashhadi <hamedhaseli at gmail.com>: BDWreg
> ? Spencer Graves <spencer.graves at effectivedefense.org>: Ecfun Ecdat
> ? Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk>: DWreg
>
> We have asked for an update fixing the check problems shown at
> <https://cran.r-project.org/web/checks/check_results_Ecfun.html>
> with no update from the maintainer thus far.
>
> Thus, package Ecfun is now scheduled for archival on 2022-08-08, and
> archiving this will necessitate also archiving its CRAN strong reverse
> dependencies.
>
> Please negotiate the necessary actions.
>
> The CRAN Team
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jul 19 18:38:12 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 19 Jul 2022 11:38:12 -0500
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
Message-ID: <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>

Hi, Tomas:


On 7/19/22 2:20 AM, Tomas Kalibera wrote:
> 
> On 7/19/22 08:37, Spencer Graves wrote:
>> Hello:
>>
>>
>> ????? What's the recommended fix for "?Warning in gsub(gsLi$pattern, 
>> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m' to a wide 
>> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo) : input 
>> string 1 is invalid"?
>>
>>
>> ????? This is in:
>>
>>
>> https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd 
>>
>>
>>
>> ????? R-devel is now rejecting some non-ASCII characters that it 
>> previously accepted;? see below.
> 
> Please see 
> https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions 
> 
> 
> Looking at the code I guess you should change the strings in icx to use 
> \u escapes instead of \x. The use of \x as it is there was probably 
> correct when the code was ran in Latin-1 encoding, but not in other 
> encodings. Using \u would make it portable. Feel free to ask more if my 
> guess is wrong and reading the blog post doesn't help.


	  "subNonStandardCharacters.Rd" copies examples from:


https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv


	  This file still contains "\x" in 5 places.  What's the recommended 
fix?  Replace "\x" with "\u00" everyplace?


	  I could try that, but I don't know if I have access to platforms that 
would tell me if I fixed it or not ;-)


	  Thanks very much.
	  Spencer Graves

> 
> Best
> Tomas
> 
> 
> 
>>
>>
>> ????? Thanks,
>> ????? Spencer Graves
>>
>>
>> -------- Forwarded Message --------
>> Subject: CRAN package Ecfun and its reverse dependencies
>> Date: Wed, 13 Jul 2022 06:34:24 +0100
>> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>> Reply-To: CRAN at R-project.org
>> To: veronica.vinciotti at brunel.ac.uk, 
>> spencer.graves at effectivedefense.org, hamedhaseli at gmail.com, 
>> dennis.prangle at gmail.com
>> CC: CRAN at R-project.org
>>
>> Dear maintainers,
>>
>> This concerns the CRAN packages
>>
>> ? BDWreg DWreg Ecdat Ecfun gk
>>
>> maintained by one of you:
>>
>> ? Dennis Prangle <dennis.prangle at gmail.com>: gk
>> ? Hamed Haselimashhadi <hamedhaseli at gmail.com>: BDWreg
>> ? Spencer Graves <spencer.graves at effectivedefense.org>: Ecfun Ecdat
>> ? Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk>: DWreg
>>
>> We have asked for an update fixing the check problems shown at
>> <https://cran.r-project.org/web/checks/check_results_Ecfun.html>
>> with no update from the maintainer thus far.
>>
>> Thus, package Ecfun is now scheduled for archival on 2022-08-08, and
>> archiving this will necessitate also archiving its CRAN strong reverse
>> dependencies.
>>
>> Please negotiate the necessary actions.
>>
>> The CRAN Team
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From w||||@mwdun|@p @end|ng |rom gm@||@com  Tue Jul 19 19:10:29 2022
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Tue, 19 Jul 2022 10:10:29 -0700
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
Message-ID: <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>

Have you tried changing the \x's in that file with \u's?

> qx <- c("\xf6", "\xf8", "\xdf", "\xfc")
> Encoding(qx) <- "latin1"
> qu <- c("\uf6", "\uf8", "\udf", "\ufc")
> Encoding(qu)
[1] "UTF-8" "UTF-8" "UTF-8" "UTF-8"
> qx == qu
[1] TRUE TRUE TRUE TRUE

(charToRaw shows that qu and qx are not byte-for-byte identical: '=='
coerces the latin1 strings to utf-8.)

-Bill

On Tue, Jul 19, 2022 at 9:38 AM Spencer Graves <
spencer.graves at effectivedefense.org> wrote:

> Hi, Tomas:
>
>
> On 7/19/22 2:20 AM, Tomas Kalibera wrote:
> >
> > On 7/19/22 08:37, Spencer Graves wrote:
> >> Hello:
> >>
> >>
> >>       What's the recommended fix for "?Warning in gsub(gsLi$pattern,
> >> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m' to a wide
> >> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo) : input
> >> string 1 is invalid"?
> >>
> >>
> >>       This is in:
> >>
> >>
> >>
> https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd
> >>
> >>
> >>
> >>       R-devel is now rejecting some non-ASCII characters that it
> >> previously accepted;  see below.
> >
> > Please see
> >
> https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions
> >
> >
> > Looking at the code I guess you should change the strings in icx to use
> > \u escapes instead of \x. The use of \x as it is there was probably
> > correct when the code was ran in Latin-1 encoding, but not in other
> > encodings. Using \u would make it portable. Feel free to ask more if my
> > guess is wrong and reading the blog post doesn't help.
>
>
>           "subNonStandardCharacters.Rd" copies examples from:
>
>
> https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv
>
>
>           This file still contains "\x" in 5 places.  What's the
> recommended
> fix?  Replace "\x" with "\u00" everyplace?
>
>
>           I could try that, but I don't know if I have access to platforms
> that
> would tell me if I fixed it or not ;-)
>
>
>           Thanks very much.
>           Spencer Graves
>
> >
> > Best
> > Tomas
> >
> >
> >
> >>
> >>
> >>       Thanks,
> >>       Spencer Graves
> >>
> >>
> >> -------- Forwarded Message --------
> >> Subject: CRAN package Ecfun and its reverse dependencies
> >> Date: Wed, 13 Jul 2022 06:34:24 +0100
> >> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> >> Reply-To: CRAN at R-project.org
> >> To: veronica.vinciotti at brunel.ac.uk,
> >> spencer.graves at effectivedefense.org, hamedhaseli at gmail.com,
> >> dennis.prangle at gmail.com
> >> CC: CRAN at R-project.org
> >>
> >> Dear maintainers,
> >>
> >> This concerns the CRAN packages
> >>
> >>   BDWreg DWreg Ecdat Ecfun gk
> >>
> >> maintained by one of you:
> >>
> >>   Dennis Prangle <dennis.prangle at gmail.com>: gk
> >>   Hamed Haselimashhadi <hamedhaseli at gmail.com>: BDWreg
> >>   Spencer Graves <spencer.graves at effectivedefense.org>: Ecfun Ecdat
> >>   Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk>: DWreg
> >>
> >> We have asked for an update fixing the check problems shown at
> >> <https://cran.r-project.org/web/checks/check_results_Ecfun.html>
> >> with no update from the maintainer thus far.
> >>
> >> Thus, package Ecfun is now scheduled for archival on 2022-08-08, and
> >> archiving this will necessitate also archiving its CRAN strong reverse
> >> dependencies.
> >>
> >> Please negotiate the necessary actions.
> >>
> >> The CRAN Team
> >>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jul 19 19:32:20 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 19 Jul 2022 12:32:20 -0500
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
Message-ID: <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>

Hi, Bill, Tomas, et al.:


On 7/19/22 12:10 PM, Bill Dunlap wrote:
> Have you tried changing the \x's in that file with \u's?
> 
>  > qx <- c("\xf6", "\xf8", "\xdf", "\xfc")
>  > Encoding(qx) <- "latin1"
>  > qu <- c("\uf6", "\uf8", "\udf", "\ufc")
>  > Encoding(qu)
> [1] "UTF-8" "UTF-8" "UTF-8" "UTF-8"
>  > qx == qu
> [1] TRUE TRUE TRUE TRUE


I have not tried anything yet for three reasons:


	  1.  I don't know that I have access to anything that can do the 
proper test that's required, so I can know if I've fixed it or not.


	  2.  Tomas' blog included examples that seemed to say to replace 
"\xa0" with "\u00a0", NOT "\ua0", and I don't know if this difference 
matters or not.


	  3.  Can someone provide me with a link to the correct development 
version of help('iconv')?  The current version includes the exact 
offending "\x" strings that I have.  If I know the fix in the correct 
development version of help('iconv'), I can copy that.  Without that, 
I'm being asked to correct something that may not have been corrected in 
the development version of the base package.


	  Thanks,
	  Spencer

> 
> (charToRaw shows that qu and qx are not byte-for-byte identical: '==' 
> coerces the latin1 strings to utf-8.)
> 
> -Bill
> 
> On Tue, Jul 19, 2022 at 9:38 AM Spencer Graves 
> <spencer.graves at effectivedefense.org 
> <mailto:spencer.graves at effectivedefense.org>> wrote:
> 
>     Hi, Tomas:
> 
> 
>     On 7/19/22 2:20 AM, Tomas Kalibera wrote:
>      >
>      > On 7/19/22 08:37, Spencer Graves wrote:
>      >> Hello:
>      >>
>      >>
>      >> ????? What's the recommended fix for "?Warning in
>     gsub(gsLi$pattern,
>      >> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m' to a wide
>      >> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo) : input
>      >> string 1 is invalid"?
>      >>
>      >>
>      >> ????? This is in:
>      >>
>      >>
>      >>
>     https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd
>     <https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd>
> 
>      >>
>      >>
>      >>
>      >> ????? R-devel is now rejecting some non-ASCII characters that it
>      >> previously accepted;? see below.
>      >
>      > Please see
>      >
>     https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions
>     <https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions>
> 
>      >
>      >
>      > Looking at the code I guess you should change the strings in icx
>     to use
>      > \u escapes instead of \x. The use of \x as it is there was probably
>      > correct when the code was ran in Latin-1 encoding, but not in other
>      > encodings. Using \u would make it portable. Feel free to ask more
>     if my
>      > guess is wrong and reading the blog post doesn't help.
> 
> 
>      ? ? ? ? ? "subNonStandardCharacters.Rd" copies examples from:
> 
> 
>     https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv
>     <https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv>
> 
> 
>      ? ? ? ? ? This file still contains "\x" in 5 places.? What's the
>     recommended
>     fix?? Replace "\x" with "\u00" everyplace?
> 
> 
>      ? ? ? ? ? I could try that, but I don't know if I have access to
>     platforms that
>     would tell me if I fixed it or not ;-)
> 
> 
>      ? ? ? ? ? Thanks very much.
>      ? ? ? ? ? Spencer Graves
> 
>      >
>      > Best
>      > Tomas
>      >
>      >
>      >
>      >>
>      >>
>      >> ????? Thanks,
>      >> ????? Spencer Graves
>      >>
>      >>
>      >> -------- Forwarded Message --------
>      >> Subject: CRAN package Ecfun and its reverse dependencies
>      >> Date: Wed, 13 Jul 2022 06:34:24 +0100
>      >> From: Prof Brian Ripley <ripley at stats.ox.ac.uk
>     <mailto:ripley at stats.ox.ac.uk>>
>      >> Reply-To: CRAN at R-project.org
>      >> To: veronica.vinciotti at brunel.ac.uk
>     <mailto:veronica.vinciotti at brunel.ac.uk>,
>      >> spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>, hamedhaseli at gmail.com
>     <mailto:hamedhaseli at gmail.com>,
>      >> dennis.prangle at gmail.com <mailto:dennis.prangle at gmail.com>
>      >> CC: CRAN at R-project.org
>      >>
>      >> Dear maintainers,
>      >>
>      >> This concerns the CRAN packages
>      >>
>      >> ? BDWreg DWreg Ecdat Ecfun gk
>      >>
>      >> maintained by one of you:
>      >>
>      >> ? Dennis Prangle <dennis.prangle at gmail.com
>     <mailto:dennis.prangle at gmail.com>>: gk
>      >> ? Hamed Haselimashhadi <hamedhaseli at gmail.com
>     <mailto:hamedhaseli at gmail.com>>: BDWreg
>      >> ? Spencer Graves <spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>>: Ecfun Ecdat
>      >> ? Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk
>     <mailto:veronica.vinciotti at brunel.ac.uk>>: DWreg
>      >>
>      >> We have asked for an update fixing the check problems shown at
>      >> <https://cran.r-project.org/web/checks/check_results_Ecfun.html
>     <https://cran.r-project.org/web/checks/check_results_Ecfun.html>>
>      >> with no update from the maintainer thus far.
>      >>
>      >> Thus, package Ecfun is now scheduled for archival on 2022-08-08, and
>      >> archiving this will necessitate also archiving its CRAN strong
>     reverse
>      >> dependencies.
>      >>
>      >> Please negotiate the necessary actions.
>      >>
>      >> The CRAN Team
>      >>
>      >> ______________________________________________
>      >> R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> 
>     ______________________________________________
>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>     mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From w||||@mwdun|@p @end|ng |rom gm@||@com  Tue Jul 19 19:42:05 2022
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Tue, 19 Jul 2022 10:42:05 -0700
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
Message-ID: <CAHqSRuTcLCu7wzQMQniFQ_dAi2FdBRuXqKX1rL6SifRGwJPq9A@mail.gmail.com>

Adding the initial zeroes is a bit safer, as would be \u{df}; either
protects against the next character being a hex digit.  There are 6 byte
utf-8 'characters', but I don't think R's parser accepts more than 4.

-Bill

On Tue, Jul 19, 2022 at 10:32 AM Spencer Graves <
spencer.graves at effectivedefense.org> wrote:

> Hi, Bill, Tomas, et al.:
>
>
> On 7/19/22 12:10 PM, Bill Dunlap wrote:
> > Have you tried changing the \x's in that file with \u's?
> >
> >  > qx <- c("\xf6", "\xf8", "\xdf", "\xfc")
> >  > Encoding(qx) <- "latin1"
> >  > qu <- c("\uf6", "\uf8", "\udf", "\ufc")
> >  > Encoding(qu)
> > [1] "UTF-8" "UTF-8" "UTF-8" "UTF-8"
> >  > qx == qu
> > [1] TRUE TRUE TRUE TRUE
>
>
> I have not tried anything yet for three reasons:
>
>
>           1.  I don't know that I have access to anything that can do the
> proper test that's required, so I can know if I've fixed it or not.
>
>
>           2.  Tomas' blog included examples that seemed to say to replace
> "\xa0" with "\u00a0", NOT "\ua0", and I don't know if this difference
> matters or not.
>
>
>           3.  Can someone provide me with a link to the correct
> development
> version of help('iconv')?  The current version includes the exact
> offending "\x" strings that I have.  If I know the fix in the correct
> development version of help('iconv'), I can copy that.  Without that,
> I'm being asked to correct something that may not have been corrected in
> the development version of the base package.
>
>
>           Thanks,
>           Spencer
>
> >
> > (charToRaw shows that qu and qx are not byte-for-byte identical: '=='
> > coerces the latin1 strings to utf-8.)
> >
> > -Bill
> >
> > On Tue, Jul 19, 2022 at 9:38 AM Spencer Graves
> > <spencer.graves at effectivedefense.org
> > <mailto:spencer.graves at effectivedefense.org>> wrote:
> >
> >     Hi, Tomas:
> >
> >
> >     On 7/19/22 2:20 AM, Tomas Kalibera wrote:
> >      >
> >      > On 7/19/22 08:37, Spencer Graves wrote:
> >      >> Hello:
> >      >>
> >      >>
> >      >>       What's the recommended fix for "?Warning in
> >     gsub(gsLi$pattern,
> >      >> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m' to a
> wide
> >      >> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo) : input
> >      >> string 1 is invalid"?
> >      >>
> >      >>
> >      >>       This is in:
> >      >>
> >      >>
> >      >>
> >
> https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd
> >     <
> https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd
> >
> >
> >      >>
> >      >>
> >      >>
> >      >>       R-devel is now rejecting some non-ASCII characters that it
> >      >> previously accepted;  see below.
> >      >
> >      > Please see
> >      >
> >
> https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions
> >     <
> https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions
> >
> >
> >      >
> >      >
> >      > Looking at the code I guess you should change the strings in icx
> >     to use
> >      > \u escapes instead of \x. The use of \x as it is there was
> probably
> >      > correct when the code was ran in Latin-1 encoding, but not in
> other
> >      > encodings. Using \u would make it portable. Feel free to ask more
> >     if my
> >      > guess is wrong and reading the blog post doesn't help.
> >
> >
> >                "subNonStandardCharacters.Rd" copies examples from:
> >
> >
> >
> https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv
> >     <
> https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv>
> >
> >
> >                This file still contains "\x" in 5 places.  What's the
> >     recommended
> >     fix?  Replace "\x" with "\u00" everyplace?
> >
> >
> >                I could try that, but I don't know if I have access to
> >     platforms that
> >     would tell me if I fixed it or not ;-)
> >
> >
> >                Thanks very much.
> >                Spencer Graves
> >
> >      >
> >      > Best
> >      > Tomas
> >      >
> >      >
> >      >
> >      >>
> >      >>
> >      >>       Thanks,
> >      >>       Spencer Graves
> >      >>
> >      >>
> >      >> -------- Forwarded Message --------
> >      >> Subject: CRAN package Ecfun and its reverse dependencies
> >      >> Date: Wed, 13 Jul 2022 06:34:24 +0100
> >      >> From: Prof Brian Ripley <ripley at stats.ox.ac.uk
> >     <mailto:ripley at stats.ox.ac.uk>>
> >      >> Reply-To: CRAN at R-project.org
> >      >> To: veronica.vinciotti at brunel.ac.uk
> >     <mailto:veronica.vinciotti at brunel.ac.uk>,
> >      >> spencer.graves at effectivedefense.org
> >     <mailto:spencer.graves at effectivedefense.org>, hamedhaseli at gmail.com
> >     <mailto:hamedhaseli at gmail.com>,
> >      >> dennis.prangle at gmail.com <mailto:dennis.prangle at gmail.com>
> >      >> CC: CRAN at R-project.org
> >      >>
> >      >> Dear maintainers,
> >      >>
> >      >> This concerns the CRAN packages
> >      >>
> >      >>   BDWreg DWreg Ecdat Ecfun gk
> >      >>
> >      >> maintained by one of you:
> >      >>
> >      >>   Dennis Prangle <dennis.prangle at gmail.com
> >     <mailto:dennis.prangle at gmail.com>>: gk
> >      >>   Hamed Haselimashhadi <hamedhaseli at gmail.com
> >     <mailto:hamedhaseli at gmail.com>>: BDWreg
> >      >>   Spencer Graves <spencer.graves at effectivedefense.org
> >     <mailto:spencer.graves at effectivedefense.org>>: Ecfun Ecdat
> >      >>   Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk
> >     <mailto:veronica.vinciotti at brunel.ac.uk>>: DWreg
> >      >>
> >      >> We have asked for an update fixing the check problems shown at
> >      >> <https://cran.r-project.org/web/checks/check_results_Ecfun.html
> >     <https://cran.r-project.org/web/checks/check_results_Ecfun.html>>
> >      >> with no update from the maintainer thus far.
> >      >>
> >      >> Thus, package Ecfun is now scheduled for archival on 2022-08-08,
> and
> >      >> archiving this will necessitate also archiving its CRAN strong
> >     reverse
> >      >> dependencies.
> >      >>
> >      >> Please negotiate the necessary actions.
> >      >>
> >      >> The CRAN Team
> >      >>
> >      >> ______________________________________________
> >      >> R-package-devel at r-project.org
> >     <mailto:R-package-devel at r-project.org> mailing list
> >      >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> >
> >     ______________________________________________
> >     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
> >     mailing list
> >     https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> >
>

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Tue Jul 19 19:45:49 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Tue, 19 Jul 2022 13:45:49 -0400
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
Message-ID: <4cedd143-2b4e-e5f7-de0e-c4a1580ca14f@gmail.com>


 ?The help pages are at

https://github.com/wch/r-source/blob/trunk/src/library/base/man/iconv.Rd

or the equivalent at https://github.com/r-devel/r-svn

or https://svn.r-project.org/R/trunk/src/library/base/man/iconv.Rd

 ? they still have \x examples in them, but maybe the use of \x is not 
flagged in the particular context of those examples?


On 2022-07-19 1:32 PM, Spencer Graves wrote:
> Hi, Bill, Tomas, et al.:
>
>
> On 7/19/22 12:10 PM, Bill Dunlap wrote:
>> Have you tried changing the \x's in that file with \u's?
>>
>> ?> qx <- c("\xf6", "\xf8", "\xdf", "\xfc")
>> ?> Encoding(qx) <- "latin1"
>> ?> qu <- c("\uf6", "\uf8", "\udf", "\ufc")
>> ?> Encoding(qu)
>> [1] "UTF-8" "UTF-8" "UTF-8" "UTF-8"
>> ?> qx == qu
>> [1] TRUE TRUE TRUE TRUE
>
>
> I have not tried anything yet for three reasons:
>
>
> ????? 1.? I don't know that I have access to anything that can do the 
> proper test that's required, so I can know if I've fixed it or not.


 ? I'm not sure what you need.? AFAIK r-hub's test platforms are still 
down, but win-builder and

>
>
> ????? 2.? Tomas' blog included examples that seemed to say to replace 
> "\xa0" with "\u00a0", NOT "\ua0", and I don't know if this difference 
> matters or not.
>
>
> ????? 3.? Can someone provide me with a link to the correct 
> development version of help('iconv')?? The current version includes 
> the exact offending "\x" strings that I have.? If I know the fix in 
> the correct development version of help('iconv'), I can copy that.? 
> Without that, I'm being asked to correct something that may not have 
> been corrected in the development version of the base package.


 ? There are \x's in the examples there

>
>
> ????? Thanks,
> ????? Spencer
>
>>
>> (charToRaw shows that qu and qx are not byte-for-byte identical: '==' 
>> coerces the latin1 strings to utf-8.)
>>
>> -Bill
>>
>> On Tue, Jul 19, 2022 at 9:38 AM Spencer Graves 
>> <spencer.graves at effectivedefense.org 
>> <mailto:spencer.graves at effectivedefense.org>> wrote:
>>
>> ??? Hi, Tomas:
>>
>>
>> ??? On 7/19/22 2:20 AM, Tomas Kalibera wrote:
>> ???? >
>> ???? > On 7/19/22 08:37, Spencer Graves wrote:
>> ???? >> Hello:
>> ???? >>
>> ???? >>
>> ???? >> ????? What's the recommended fix for "?Warning in
>> ??? gsub(gsLi$pattern,
>> ???? >> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m' to a 
>> wide
>> ???? >> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo) : 
>> input
>> ???? >> string 1 is invalid"?
>> ???? >>
>> ???? >>
>> ???? >> ????? This is in:
>> ???? >>
>> ???? >>
>> ???? >>
>> https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd
>> <https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd>
>>
>> ???? >>
>> ???? >>
>> ???? >>
>> ???? >> ????? R-devel is now rejecting some non-ASCII characters that it
>> ???? >> previously accepted;? see below.
>> ???? >
>> ???? > Please see
>> ???? >
>> https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions
>> <https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions>
>>
>> ???? >
>> ???? >
>> ???? > Looking at the code I guess you should change the strings in icx
>> ??? to use
>> ???? > \u escapes instead of \x. The use of \x as it is there was 
>> probably
>> ???? > correct when the code was ran in Latin-1 encoding, but not in 
>> other
>> ???? > encodings. Using \u would make it portable. Feel free to ask more
>> ??? if my
>> ???? > guess is wrong and reading the blog post doesn't help.
>>
>>
>> ???? ? ? ? ? ? "subNonStandardCharacters.Rd" copies examples from:
>>
>>
>> https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv
>> <https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv>
>>
>>
>> ???? ? ? ? ? ? This file still contains "\x" in 5 places. What's the
>> ??? recommended
>> ??? fix?? Replace "\x" with "\u00" everyplace?
>>
>>
>> ???? ? ? ? ? ? I could try that, but I don't know if I have access to
>> ??? platforms that
>> ??? would tell me if I fixed it or not ;-)
>>
>>
>> ???? ? ? ? ? ? Thanks very much.
>> ???? ? ? ? ? ? Spencer Graves
>>
>> ???? >
>> ???? > Best
>> ???? > Tomas
>> ???? >
>> ???? >
>> ???? >
>> ???? >>
>> ???? >>
>> ???? >> ????? Thanks,
>> ???? >> ????? Spencer Graves
>> ???? >>
>> ???? >>
>> ???? >> -------- Forwarded Message --------
>> ???? >> Subject: CRAN package Ecfun and its reverse dependencies
>> ???? >> Date: Wed, 13 Jul 2022 06:34:24 +0100
>> ???? >> From: Prof Brian Ripley <ripley at stats.ox.ac.uk
>> ??? <mailto:ripley at stats.ox.ac.uk>>
>> ???? >> Reply-To: CRAN at R-project.org
>> ???? >> To: veronica.vinciotti at brunel.ac.uk
>> ??? <mailto:veronica.vinciotti at brunel.ac.uk>,
>> ???? >> spencer.graves at effectivedefense.org
>> ??? <mailto:spencer.graves at effectivedefense.org>, hamedhaseli at gmail.com
>> ??? <mailto:hamedhaseli at gmail.com>,
>> ???? >> dennis.prangle at gmail.com <mailto:dennis.prangle at gmail.com>
>> ???? >> CC: CRAN at R-project.org
>> ???? >>
>> ???? >> Dear maintainers,
>> ???? >>
>> ???? >> This concerns the CRAN packages
>> ???? >>
>> ???? >> ? BDWreg DWreg Ecdat Ecfun gk
>> ???? >>
>> ???? >> maintained by one of you:
>> ???? >>
>> ???? >> ? Dennis Prangle <dennis.prangle at gmail.com
>> ??? <mailto:dennis.prangle at gmail.com>>: gk
>> ???? >> ? Hamed Haselimashhadi <hamedhaseli at gmail.com
>> ??? <mailto:hamedhaseli at gmail.com>>: BDWreg
>> ???? >> ? Spencer Graves <spencer.graves at effectivedefense.org
>> ??? <mailto:spencer.graves at effectivedefense.org>>: Ecfun Ecdat
>> ???? >> ? Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk
>> ??? <mailto:veronica.vinciotti at brunel.ac.uk>>: DWreg
>> ???? >>
>> ???? >> We have asked for an update fixing the check problems shown at
>> ???? >> <https://cran.r-project.org/web/checks/check_results_Ecfun.html
>> <https://cran.r-project.org/web/checks/check_results_Ecfun.html>>
>> ???? >> with no update from the maintainer thus far.
>> ???? >>
>> ???? >> Thus, package Ecfun is now scheduled for archival on 
>> 2022-08-08, and
>> ???? >> archiving this will necessitate also archiving its CRAN strong
>> ??? reverse
>> ???? >> dependencies.
>> ???? >>
>> ???? >> Please negotiate the necessary actions.
>> ???? >>
>> ???? >> The CRAN Team
>> ???? >>
>> ???? >> ______________________________________________
>> ???? >> R-package-devel at r-project.org
>> ??? <mailto:R-package-devel at r-project.org> mailing list
>> ???? >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>
>> ??? ______________________________________________
>> ??? R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>> ??? mailing list
>> ??? https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jul 19 19:54:35 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 19 Jul 2022 12:54:35 -0500
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <CAHqSRuTcLCu7wzQMQniFQ_dAi2FdBRuXqKX1rL6SifRGwJPq9A@mail.gmail.com>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
 <CAHqSRuTcLCu7wzQMQniFQ_dAi2FdBRuXqKX1rL6SifRGwJPq9A@mail.gmail.com>
Message-ID: <03c7bca0-1e73-a9b0-7fd3-431d5abff7ea@effectivedefense.org>



On 7/19/22 12:42 PM, Bill Dunlap wrote:
> Adding the initial zeroes is a bit safer, as would be \u{df}; either 
> protects against the next character being a hex digit.? There are 6 byte 
> utf-8 'characters', but I don't think R's parser accepts more than 4.


	  Thanks.  Tomas' blog was good in documenting the need and some of the 
pitfalls, but I don't know the difference between "\ua0", "\u00a0", 
"\u{a0}" or anything else, and I don't know how to find documentation 
that would explain that.  As I wrote years ago, it's hard to RTFM if I 
don't know which FMTR ;-)


	  Most important, I think for my current issue:  How can I find the 
correct development version of help('iconv')?


	  Since I copied the example used in subNonStandardCharacters.Rd from 
help('iconv'), I should be fine if I do what the R Core Team did with 
help('iconv').  Or if I guess and guess wrong, I could get another email 
from Prof Brian Ripley, ordering me to fix something.  I could search 
myself for the current development version of the base package, but I'm 
not sure I'd know if I got the correct version and not some other 
experiment that is different from the actual official development version.


	  ???
	  Spencer

> 
> -Bill
> 
> On Tue, Jul 19, 2022 at 10:32 AM Spencer Graves 
> <spencer.graves at effectivedefense.org 
> <mailto:spencer.graves at effectivedefense.org>> wrote:
> 
>     Hi, Bill, Tomas, et al.:
> 
> 
>     On 7/19/22 12:10 PM, Bill Dunlap wrote:
>      > Have you tried changing the \x's in that file with \u's?
>      >
>      >? > qx <- c("\xf6", "\xf8", "\xdf", "\xfc")
>      >? > Encoding(qx) <- "latin1"
>      >? > qu <- c("\uf6", "\uf8", "\udf", "\ufc")
>      >? > Encoding(qu)
>      > [1] "UTF-8" "UTF-8" "UTF-8" "UTF-8"
>      >? > qx == qu
>      > [1] TRUE TRUE TRUE TRUE
> 
> 
>     I have not tried anything yet for three reasons:
> 
> 
>      ? ? ? ? ? 1.? I don't know that I have access to anything that can
>     do the
>     proper test that's required, so I can know if I've fixed it or not.
> 
> 
>      ? ? ? ? ? 2.? Tomas' blog included examples that seemed to say to
>     replace
>     "\xa0" with "\u00a0", NOT "\ua0", and I don't know if this difference
>     matters or not.
> 
> 
>      ? ? ? ? ? 3.? Can someone provide me with a link to the correct
>     development
>     version of help('iconv')?? The current version includes the exact
>     offending "\x" strings that I have.? If I know the fix in the correct
>     development version of help('iconv'), I can copy that.? Without that,
>     I'm being asked to correct something that may not have been
>     corrected in
>     the development version of the base package.
> 
> 
>      ? ? ? ? ? Thanks,
>      ? ? ? ? ? Spencer
> 
>      >
>      > (charToRaw shows that qu and qx are not byte-for-byte identical:
>     '=='
>      > coerces the latin1 strings to utf-8.)
>      >
>      > -Bill
>      >
>      > On Tue, Jul 19, 2022 at 9:38 AM Spencer Graves
>      > <spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>
>      > <mailto:spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>>> wrote:
>      >
>      >? ? ?Hi, Tomas:
>      >
>      >
>      >? ? ?On 7/19/22 2:20 AM, Tomas Kalibera wrote:
>      >? ? ? >
>      >? ? ? > On 7/19/22 08:37, Spencer Graves wrote:
>      >? ? ? >> Hello:
>      >? ? ? >>
>      >? ? ? >>
>      >? ? ? >> ????? What's the recommended fix for "?Warning in
>      >? ? ?gsub(gsLi$pattern,
>      >? ? ? >> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m'
>     to a wide
>      >? ? ? >> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo)
>     : input
>      >? ? ? >> string 1 is invalid"?
>      >? ? ? >>
>      >? ? ? >>
>      >? ? ? >> ????? This is in:
>      >? ? ? >>
>      >? ? ? >>
>      >? ? ? >>
>      >
>     https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd
>     <https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd>
>      >   
>      ?<https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd <https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd>>
>      >
>      >? ? ? >>
>      >? ? ? >>
>      >? ? ? >>
>      >? ? ? >> ????? R-devel is now rejecting some non-ASCII characters
>     that it
>      >? ? ? >> previously accepted;? see below.
>      >? ? ? >
>      >? ? ? > Please see
>      >? ? ? >
>      >
>     https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions
>     <https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions>
>      >   
>      ?<https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions <https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions>>
>      >
>      >? ? ? >
>      >? ? ? >
>      >? ? ? > Looking at the code I guess you should change the strings
>     in icx
>      >? ? ?to use
>      >? ? ? > \u escapes instead of \x. The use of \x as it is there was
>     probably
>      >? ? ? > correct when the code was ran in Latin-1 encoding, but not
>     in other
>      >? ? ? > encodings. Using \u would make it portable. Feel free to
>     ask more
>      >? ? ?if my
>      >? ? ? > guess is wrong and reading the blog post doesn't help.
>      >
>      >
>      >? ? ? ? ? ? ? ? "subNonStandardCharacters.Rd" copies examples from:
>      >
>      >
>      >
>     https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv
>     <https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv>
>      >   
>      ?<https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv <https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv>>
>      >
>      >
>      >? ? ? ? ? ? ? ? This file still contains "\x" in 5 places.? What's the
>      >? ? ?recommended
>      >? ? ?fix?? Replace "\x" with "\u00" everyplace?
>      >
>      >
>      >? ? ? ? ? ? ? ? I could try that, but I don't know if I have access to
>      >? ? ?platforms that
>      >? ? ?would tell me if I fixed it or not ;-)
>      >
>      >
>      >? ? ? ? ? ? ? ? Thanks very much.
>      >? ? ? ? ? ? ? ? Spencer Graves
>      >
>      >? ? ? >
>      >? ? ? > Best
>      >? ? ? > Tomas
>      >? ? ? >
>      >? ? ? >
>      >? ? ? >
>      >? ? ? >>
>      >? ? ? >>
>      >? ? ? >> ????? Thanks,
>      >? ? ? >> ????? Spencer Graves
>      >? ? ? >>
>      >? ? ? >>
>      >? ? ? >> -------- Forwarded Message --------
>      >? ? ? >> Subject: CRAN package Ecfun and its reverse dependencies
>      >? ? ? >> Date: Wed, 13 Jul 2022 06:34:24 +0100
>      >? ? ? >> From: Prof Brian Ripley <ripley at stats.ox.ac.uk
>     <mailto:ripley at stats.ox.ac.uk>
>      >? ? ?<mailto:ripley at stats.ox.ac.uk <mailto:ripley at stats.ox.ac.uk>>>
>      >? ? ? >> Reply-To: CRAN at R-project.org
>      >? ? ? >> To: veronica.vinciotti at brunel.ac.uk
>     <mailto:veronica.vinciotti at brunel.ac.uk>
>      >? ? ?<mailto:veronica.vinciotti at brunel.ac.uk
>     <mailto:veronica.vinciotti at brunel.ac.uk>>,
>      >? ? ? >> spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>
>      >? ? ?<mailto:spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>>, hamedhaseli at gmail.com
>     <mailto:hamedhaseli at gmail.com>
>      >? ? ?<mailto:hamedhaseli at gmail.com <mailto:hamedhaseli at gmail.com>>,
>      >? ? ? >> dennis.prangle at gmail.com
>     <mailto:dennis.prangle at gmail.com> <mailto:dennis.prangle at gmail.com
>     <mailto:dennis.prangle at gmail.com>>
>      >? ? ? >> CC: CRAN at R-project.org
>      >? ? ? >>
>      >? ? ? >> Dear maintainers,
>      >? ? ? >>
>      >? ? ? >> This concerns the CRAN packages
>      >? ? ? >>
>      >? ? ? >> ? BDWreg DWreg Ecdat Ecfun gk
>      >? ? ? >>
>      >? ? ? >> maintained by one of you:
>      >? ? ? >>
>      >? ? ? >> ? Dennis Prangle <dennis.prangle at gmail.com
>     <mailto:dennis.prangle at gmail.com>
>      >? ? ?<mailto:dennis.prangle at gmail.com
>     <mailto:dennis.prangle at gmail.com>>>: gk
>      >? ? ? >> ? Hamed Haselimashhadi <hamedhaseli at gmail.com
>     <mailto:hamedhaseli at gmail.com>
>      >? ? ?<mailto:hamedhaseli at gmail.com
>     <mailto:hamedhaseli at gmail.com>>>: BDWreg
>      >? ? ? >> ? Spencer Graves <spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>
>      >? ? ?<mailto:spencer.graves at effectivedefense.org
>     <mailto:spencer.graves at effectivedefense.org>>>: Ecfun Ecdat
>      >? ? ? >> ? Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk
>     <mailto:veronica.vinciotti at brunel.ac.uk>
>      >? ? ?<mailto:veronica.vinciotti at brunel.ac.uk
>     <mailto:veronica.vinciotti at brunel.ac.uk>>>: DWreg
>      >? ? ? >>
>      >? ? ? >> We have asked for an update fixing the check problems
>     shown at
>      >? ? ? >>
>     <https://cran.r-project.org/web/checks/check_results_Ecfun.html
>     <https://cran.r-project.org/web/checks/check_results_Ecfun.html>
>      >   
>      ?<https://cran.r-project.org/web/checks/check_results_Ecfun.html
>     <https://cran.r-project.org/web/checks/check_results_Ecfun.html>>>
>      >? ? ? >> with no update from the maintainer thus far.
>      >? ? ? >>
>      >? ? ? >> Thus, package Ecfun is now scheduled for archival on
>     2022-08-08, and
>      >? ? ? >> archiving this will necessitate also archiving its CRAN
>     strong
>      >? ? ?reverse
>      >? ? ? >> dependencies.
>      >? ? ? >>
>      >? ? ? >> Please negotiate the necessary actions.
>      >? ? ? >>
>      >? ? ? >> The CRAN Team
>      >? ? ? >>
>      >? ? ? >> ______________________________________________
>      >? ? ? >> R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org>
>      >? ? ?<mailto:R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org>> mailing list
>      >? ? ? >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>      >? ? ?<https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>>
>      >
>      >? ? ?______________________________________________
>      > R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org>
>     <mailto:R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org>>
>      >? ? ?mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>      >? ? ?<https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>>
>      >
>


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Jul 19 20:03:40 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 19 Jul 2022 21:03:40 +0300
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
Message-ID: <20220719210340.2033a6c1@trisector>

On Tue, 19 Jul 2022 12:32:20 -0500
Spencer Graves <spencer.graves at effectivedefense.org> wrote:

> Can someone provide me with a link to the correct development 
> version of help('iconv')?  The current version includes the exact 
> offending "\x" strings that I have.  

http://svn.r-project.org/R/trunk/src/library/base/man/iconv.Rd

It still does, because it works with byte strings the right way: by
passing them to iconv(), which is designed to work with bytes in
"unknown" encodings.

In contrast, your use of arbitrary bytes with gsub() is invalid,
because gsub() assumes that the strings match their declared encoding:
UTF-8, Latin-1, or the native locale encoding. (See ?Encoding.)

When you write "Ekstr\xf8m", you get a string that consists of Latin-1
bytes but has the wrong encoding property set. Given this string,
gsub() and friends will break on a UTF-8 system (because "r\xf8m" is
not a valid UTF-8 sequence of bytes), while iconv() will not.

Depending on the desired semantics of subNonStandardCharacters(), you
might be able to avoid the failures with the useBytes argument, or you
might silently return invalid data in some corner cases. Is the "x"
argument supposed to be bytes in arbitrary encoding, or properly decoded
characters that might include those that don't map to ASCII?

-- 
Best regards,
Ivan


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Tue Jul 19 20:23:11 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 19 Jul 2022 13:23:11 -0500
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <20220719210340.2033a6c1@trisector>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
 <20220719210340.2033a6c1@trisector>
Message-ID: <163d9fb1-3988-1ab9-4079-e8db681e7eb7@effectivedefense.org>

Hi, Ivan et al.:


On 7/19/22 1:03 PM, Ivan Krylov wrote:
> On Tue, 19 Jul 2022 12:32:20 -0500
> Spencer Graves <spencer.graves at effectivedefense.org> wrote:
> 
>> Can someone provide me with a link to the correct development
>> version of help('iconv')?  The current version includes the exact
>> offending "\x" strings that I have.
> 
> http://svn.r-project.org/R/trunk/src/library/base/man/iconv.Rd
> 
> It still does, because it works with byte strings the right way: by
> passing them to iconv(), which is designed to work with bytes in
> "unknown" encodings.
> 
> In contrast, your use of arbitrary bytes with gsub() is invalid,
> because gsub() assumes that the strings match their declared encoding:
> UTF-8, Latin-1, or the native locale encoding. (See ?Encoding.)
> 
> When you write "Ekstr\xf8m", you get a string that consists of Latin-1
> bytes but has the wrong encoding property set. Given this string,
> gsub() and friends will break on a UTF-8 system (because "r\xf8m" is
> not a valid UTF-8 sequence of bytes), while iconv() will not.
> 
> Depending on the desired semantics of subNonStandardCharacters(), you
> might be able to avoid the failures with the useBytes argument, or you
> might silently return invalid data in some corner cases. Is the "x"
> argument supposed to be bytes in arbitrary encoding, or properly decoded
> characters that might include those that don't map to ASCII?
> 

	  Wow.  So what's the recommended fix?


	  If I understand correctly, "\u**" should work with ** being f8, f6, 
df, or fc [all hex digits, I assume?].  However, "\u00**" may be 
preferred over "\u**", and "\u{**}" may be better still.


	  The blog that Tomas wrote might be more useful if it included a 
recommendation like this.


	  Thanks for all your work to make R better and thereby help people 
everywhere extract better information from the data available to them.


	  Spencer


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Tue Jul 19 20:26:59 2022
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Tue, 19 Jul 2022 11:26:59 -0700
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <03c7bca0-1e73-a9b0-7fd3-431d5abff7ea@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
 <CAHqSRuTcLCu7wzQMQniFQ_dAi2FdBRuXqKX1rL6SifRGwJPq9A@mail.gmail.com>
 <03c7bca0-1e73-a9b0-7fd3-431d5abff7ea@effectivedefense.org>
Message-ID: <D42C3211-EEB5-4702-925B-C1857EA371DF@dcn.davis.ca.us>

Perhaps look at [1]? iconv is trying to handle conformity with the Unicode standard, so try starting out by assuming it will succeed.

Meanwhile, you should consider using a docker container to test your code in an environment similar to to the ones throwing errors. [2] Or just make the change and resubmit.

[1] https://en.m.wikipedia.org/wiki/List_of_Unicode_characters
[2] https://colinfay.me/docker-r-reproducibility/

On July 19, 2022 10:54:35 AM PDT, Spencer Graves <spencer.graves at effectivedefense.org> wrote:
>
>
>On 7/19/22 12:42 PM, Bill Dunlap wrote:
>> Adding the initial zeroes is a bit safer, as would be \u{df}; either protects against the next character being a hex digit.? There are 6 byte utf-8 'characters', but I don't think R's parser accepts more than 4.
>
>
>	  Thanks.  Tomas' blog was good in documenting the need and some of the pitfalls, but I don't know the difference between "\ua0", "\u00a0", "\u{a0}" or anything else, and I don't know how to find documentation that would explain that.  As I wrote years ago, it's hard to RTFM if I don't know which FMTR ;-)
>
>
>	  Most important, I think for my current issue:  How can I find the correct development version of help('iconv')?
>
>
>	  Since I copied the example used in subNonStandardCharacters.Rd from help('iconv'), I should be fine if I do what the R Core Team did with help('iconv').  Or if I guess and guess wrong, I could get another email from Prof Brian Ripley, ordering me to fix something.  I could search myself for the current development version of the base package, but I'm not sure I'd know if I got the correct version and not some other experiment that is different from the actual official development version.
>
>
>	  ???
>	  Spencer
>
>> 
>> -Bill
>> 
>> On Tue, Jul 19, 2022 at 10:32 AM Spencer Graves <spencer.graves at effectivedefense.org <mailto:spencer.graves at effectivedefense.org>> wrote:
>> 
>>     Hi, Bill, Tomas, et al.:
>> 
>> 
>>     On 7/19/22 12:10 PM, Bill Dunlap wrote:
>>      > Have you tried changing the \x's in that file with \u's?
>>      >
>>      >? > qx <- c("\xf6", "\xf8", "\xdf", "\xfc")
>>      >? > Encoding(qx) <- "latin1"
>>      >? > qu <- c("\uf6", "\uf8", "\udf", "\ufc")
>>      >? > Encoding(qu)
>>      > [1] "UTF-8" "UTF-8" "UTF-8" "UTF-8"
>>      >? > qx == qu
>>      > [1] TRUE TRUE TRUE TRUE
>> 
>> 
>>     I have not tried anything yet for three reasons:
>> 
>> 
>>      ? ? ? ? ? 1.? I don't know that I have access to anything that can
>>     do the
>>     proper test that's required, so I can know if I've fixed it or not.
>> 
>> 
>>      ? ? ? ? ? 2.? Tomas' blog included examples that seemed to say to
>>     replace
>>     "\xa0" with "\u00a0", NOT "\ua0", and I don't know if this difference
>>     matters or not.
>> 
>> 
>>      ? ? ? ? ? 3.? Can someone provide me with a link to the correct
>>     development
>>     version of help('iconv')?? The current version includes the exact
>>     offending "\x" strings that I have.? If I know the fix in the correct
>>     development version of help('iconv'), I can copy that.? Without that,
>>     I'm being asked to correct something that may not have been
>>     corrected in
>>     the development version of the base package.
>> 
>> 
>>      ? ? ? ? ? Thanks,
>>      ? ? ? ? ? Spencer
>> 
>>      >
>>      > (charToRaw shows that qu and qx are not byte-for-byte identical:
>>     '=='
>>      > coerces the latin1 strings to utf-8.)
>>      >
>>      > -Bill
>>      >
>>      > On Tue, Jul 19, 2022 at 9:38 AM Spencer Graves
>>      > <spencer.graves at effectivedefense.org
>>     <mailto:spencer.graves at effectivedefense.org>
>>      > <mailto:spencer.graves at effectivedefense.org
>>     <mailto:spencer.graves at effectivedefense.org>>> wrote:
>>      >
>>      >? ? ?Hi, Tomas:
>>      >
>>      >
>>      >? ? ?On 7/19/22 2:20 AM, Tomas Kalibera wrote:
>>      >? ? ? >
>>      >? ? ? > On 7/19/22 08:37, Spencer Graves wrote:
>>      >? ? ? >> Hello:
>>      >? ? ? >>
>>      >? ? ? >>
>>      >? ? ? >> ????? What's the recommended fix for "?Warning in
>>      >? ? ?gsub(gsLi$pattern,
>>      >? ? ? >> gsLi$replacement, xo) : unable to translate 'Ekstr<f8>m'
>>     to a wide
>>      >? ? ? >> string; Error in gsub(gsLi$pattern, gsLi$replacement, xo)
>>     : input
>>      >? ? ? >> string 1 is invalid"?
>>      >? ? ? >>
>>      >? ? ? >>
>>      >? ? ? >> ????? This is in:
>>      >? ? ? >>
>>      >? ? ? >>
>>      >? ? ? >>
>>      >
>>     https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd
>>     <https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd>
>>      >        ?<https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd <https://github.com/sbgraves237/Ecfun/blob/master/man/subNonStandardCharacters.Rd>>
>>      >
>>      >? ? ? >>
>>      >? ? ? >>
>>      >? ? ? >>
>>      >? ? ? >> ????? R-devel is now rejecting some non-ASCII characters
>>     that it
>>      >? ? ? >> previously accepted;? see below.
>>      >? ? ? >
>>      >? ? ? > Please see
>>      >? ? ? >
>>      >
>>     https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions
>>     <https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions>
>>      >        ?<https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions <https://blog.r-project.org/2022/06/27/why-to-avoid-%5Cx-in-regular-expressions>>
>>      >
>>      >? ? ? >
>>      >? ? ? >
>>      >? ? ? > Looking at the code I guess you should change the strings
>>     in icx
>>      >? ? ?to use
>>      >? ? ? > \u escapes instead of \x. The use of \x as it is there was
>>     probably
>>      >? ? ? > correct when the code was ran in Latin-1 encoding, but not
>>     in other
>>      >? ? ? > encodings. Using \u would make it portable. Feel free to
>>     ask more
>>      >? ? ?if my
>>      >? ? ? > guess is wrong and reading the blog post doesn't help.
>>      >
>>      >
>>      >? ? ? ? ? ? ? ? "subNonStandardCharacters.Rd" copies examples from:
>>      >
>>      >
>>      >
>>     https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv
>>     <https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv>
>>      >        ?<https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv <https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/iconv>>
>>      >
>>      >
>>      >? ? ? ? ? ? ? ? This file still contains "\x" in 5 places.? What's the
>>      >? ? ?recommended
>>      >? ? ?fix?? Replace "\x" with "\u00" everyplace?
>>      >
>>      >
>>      >? ? ? ? ? ? ? ? I could try that, but I don't know if I have access to
>>      >? ? ?platforms that
>>      >? ? ?would tell me if I fixed it or not ;-)
>>      >
>>      >
>>      >? ? ? ? ? ? ? ? Thanks very much.
>>      >? ? ? ? ? ? ? ? Spencer Graves
>>      >
>>      >? ? ? >
>>      >? ? ? > Best
>>      >? ? ? > Tomas
>>      >? ? ? >
>>      >? ? ? >
>>      >? ? ? >
>>      >? ? ? >>
>>      >? ? ? >>
>>      >? ? ? >> ????? Thanks,
>>      >? ? ? >> ????? Spencer Graves
>>      >? ? ? >>
>>      >? ? ? >>
>>      >? ? ? >> -------- Forwarded Message --------
>>      >? ? ? >> Subject: CRAN package Ecfun and its reverse dependencies
>>      >? ? ? >> Date: Wed, 13 Jul 2022 06:34:24 +0100
>>      >? ? ? >> From: Prof Brian Ripley <ripley at stats.ox.ac.uk
>>     <mailto:ripley at stats.ox.ac.uk>
>>      >? ? ?<mailto:ripley at stats.ox.ac.uk <mailto:ripley at stats.ox.ac.uk>>>
>>      >? ? ? >> Reply-To: CRAN at R-project.org
>>      >? ? ? >> To: veronica.vinciotti at brunel.ac.uk
>>     <mailto:veronica.vinciotti at brunel.ac.uk>
>>      >? ? ?<mailto:veronica.vinciotti at brunel.ac.uk
>>     <mailto:veronica.vinciotti at brunel.ac.uk>>,
>>      >? ? ? >> spencer.graves at effectivedefense.org
>>     <mailto:spencer.graves at effectivedefense.org>
>>      >? ? ?<mailto:spencer.graves at effectivedefense.org
>>     <mailto:spencer.graves at effectivedefense.org>>, hamedhaseli at gmail.com
>>     <mailto:hamedhaseli at gmail.com>
>>      >? ? ?<mailto:hamedhaseli at gmail.com <mailto:hamedhaseli at gmail.com>>,
>>      >? ? ? >> dennis.prangle at gmail.com
>>     <mailto:dennis.prangle at gmail.com> <mailto:dennis.prangle at gmail.com
>>     <mailto:dennis.prangle at gmail.com>>
>>      >? ? ? >> CC: CRAN at R-project.org
>>      >? ? ? >>
>>      >? ? ? >> Dear maintainers,
>>      >? ? ? >>
>>      >? ? ? >> This concerns the CRAN packages
>>      >? ? ? >>
>>      >? ? ? >> ? BDWreg DWreg Ecdat Ecfun gk
>>      >? ? ? >>
>>      >? ? ? >> maintained by one of you:
>>      >? ? ? >>
>>      >? ? ? >> ? Dennis Prangle <dennis.prangle at gmail.com
>>     <mailto:dennis.prangle at gmail.com>
>>      >? ? ?<mailto:dennis.prangle at gmail.com
>>     <mailto:dennis.prangle at gmail.com>>>: gk
>>      >? ? ? >> ? Hamed Haselimashhadi <hamedhaseli at gmail.com
>>     <mailto:hamedhaseli at gmail.com>
>>      >? ? ?<mailto:hamedhaseli at gmail.com
>>     <mailto:hamedhaseli at gmail.com>>>: BDWreg
>>      >? ? ? >> ? Spencer Graves <spencer.graves at effectivedefense.org
>>     <mailto:spencer.graves at effectivedefense.org>
>>      >? ? ?<mailto:spencer.graves at effectivedefense.org
>>     <mailto:spencer.graves at effectivedefense.org>>>: Ecfun Ecdat
>>      >? ? ? >> ? Veronica Vinciotti<veronica.vinciotti at brunel.ac.uk
>>     <mailto:veronica.vinciotti at brunel.ac.uk>
>>      >? ? ?<mailto:veronica.vinciotti at brunel.ac.uk
>>     <mailto:veronica.vinciotti at brunel.ac.uk>>>: DWreg
>>      >? ? ? >>
>>      >? ? ? >> We have asked for an update fixing the check problems
>>     shown at
>>      >? ? ? >>
>>     <https://cran.r-project.org/web/checks/check_results_Ecfun.html
>>     <https://cran.r-project.org/web/checks/check_results_Ecfun.html>
>>      >        ?<https://cran.r-project.org/web/checks/check_results_Ecfun.html
>>     <https://cran.r-project.org/web/checks/check_results_Ecfun.html>>>
>>      >? ? ? >> with no update from the maintainer thus far.
>>      >? ? ? >>
>>      >? ? ? >> Thus, package Ecfun is now scheduled for archival on
>>     2022-08-08, and
>>      >? ? ? >> archiving this will necessitate also archiving its CRAN
>>     strong
>>      >? ? ?reverse
>>      >? ? ? >> dependencies.
>>      >? ? ? >>
>>      >? ? ? >> Please negotiate the necessary actions.
>>      >? ? ? >>
>>      >? ? ? >> The CRAN Team
>>      >? ? ? >>
>>      >? ? ? >> ______________________________________________
>>      >? ? ? >> R-package-devel at r-project.org
>>     <mailto:R-package-devel at r-project.org>
>>      >? ? ?<mailto:R-package-devel at r-project.org
>>     <mailto:R-package-devel at r-project.org>> mailing list
>>      >? ? ? >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>      >? ? ?<https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>>
>>      >
>>      >? ? ?______________________________________________
>>      > R-package-devel at r-project.org
>>     <mailto:R-package-devel at r-project.org>
>>     <mailto:R-package-devel at r-project.org
>>     <mailto:R-package-devel at r-project.org>>
>>      >? ? ?mailing list
>>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>      >? ? ?<https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>>
>>      >
>> 
>
>______________________________________________
>R-package-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Sent from my phone. Please excuse my brevity.


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Jul 19 21:12:38 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 19 Jul 2022 15:12:38 -0400
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <163d9fb1-3988-1ab9-4079-e8db681e7eb7@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
 <20220719210340.2033a6c1@trisector>
 <163d9fb1-3988-1ab9-4079-e8db681e7eb7@effectivedefense.org>
Message-ID: <ea3d139c-fee3-48f3-0f60-ba99ce7664b3@gmail.com>

On 19/07/2022 2:23 p.m., Spencer Graves wrote:
> Hi, Ivan et al.:
> 
> 
> On 7/19/22 1:03 PM, Ivan Krylov wrote:
>> On Tue, 19 Jul 2022 12:32:20 -0500
>> Spencer Graves <spencer.graves at effectivedefense.org> wrote:
>>
>>> Can someone provide me with a link to the correct development
>>> version of help('iconv')?  The current version includes the exact
>>> offending "\x" strings that I have.
>>
>> http://svn.r-project.org/R/trunk/src/library/base/man/iconv.Rd
>>
>> It still does, because it works with byte strings the right way: by
>> passing them to iconv(), which is designed to work with bytes in
>> "unknown" encodings.
>>
>> In contrast, your use of arbitrary bytes with gsub() is invalid,
>> because gsub() assumes that the strings match their declared encoding:
>> UTF-8, Latin-1, or the native locale encoding. (See ?Encoding.)
>>
>> When you write "Ekstr\xf8m", you get a string that consists of Latin-1
>> bytes but has the wrong encoding property set. Given this string,
>> gsub() and friends will break on a UTF-8 system (because "r\xf8m" is
>> not a valid UTF-8 sequence of bytes), while iconv() will not.
>>
>> Depending on the desired semantics of subNonStandardCharacters(), you
>> might be able to avoid the failures with the useBytes argument, or you
>> might silently return invalid data in some corner cases. Is the "x"
>> argument supposed to be bytes in arbitrary encoding, or properly decoded
>> characters that might include those that don't map to ASCII?
>>
> 
> 	  Wow.  So what's the recommended fix?
> 
> 
> 	  If I understand correctly, "\u**" should work with ** being f8, f6,
> df, or fc [all hex digits, I assume?].  However, "\u00**" may be
> preferred over "\u**", and "\u{**}" may be better still.

That's all correct.

> 	  The blog that Tomas wrote might be more useful if it included a
> recommendation like this.

I think that advice is too specific to this example.  Here's a short 
explanation about what's going on:

Strings in R are assumed to be in the ASCII encoding if they have no 
bytes bigger than 128 (hex 80).

If they do have such bytes, they can be marked as "latin1", or "UTF-8", 
or not marked, in which case they are assumed to be in the local encoding.

If you write a string containing "\u....", it is marked as being in the 
"utf8" encoding.

If you write a string containing "\x....", it is not marked.

Thus if you are writing strings for others to use, you don't know how 
those strings will be interpreted unless you explicitly set their 
encoding.  For example, this is ambiguous:

    x <- "fa\xE7ile"

This is not:

    x <- "fa\xE7ile"
    Encoding(x) <- "latin1"

The advice you received to change the \x to \u works for your examples, 
but might fail in other examples.  As help("Quotes") says, "\uE7" is the 
Unicode code point hex E7, which is a c with a cedilla.  (The two hex 
digit Unicode values from 80 to FF match the Latin-1 values; but not 
everyone lives and works in a Latin-1 locale, so \xE7 might not be 
equivalent to \uE7 for some people.)

You can have 1-4 hex digits after \u.  If the next character happens to 
be a hex digit, you'll get some other character, e.g. "\uE7" is a ? (a c 
with a cedilla), but "\uE7a" is a single Thai character, and "\uE7ab" is 
some other single character (in the "private use area" of Unicode).

So it's safest to use exactly 4 hex digits as \u00E7, or to wrap the 
value in curly braces, \u{E7}.

Some Unicode characters need more than 4 hex digits.  Use \U for those.

Duncan Murdoch


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Jul 19 20:56:23 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 19 Jul 2022 21:56:23 +0300
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <163d9fb1-3988-1ab9-4079-e8db681e7eb7@effectivedefense.org>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
 <20220719210340.2033a6c1@trisector>
 <163d9fb1-3988-1ab9-4079-e8db681e7eb7@effectivedefense.org>
Message-ID: <20220719215623.01e89125@trisector>

On Tue, 19 Jul 2022 13:23:11 -0500
Spencer Graves <spencer.graves at effectivedefense.org> wrote:

> So what's the recommended fix?

Is subNonStandardCharacters() supposed to work with strings with
Encoding(.) == 'unknown' that are also invalid in current locale
encoding? (I think it's fair to not support Encoding(.) == 'bytes' for
such a function, because such strings aren't supposed to be text.)

If yes, the function itself needs to be fixed. I think that
useBytes=TRUE may help, as long as the standardCharacters argument is
limited to characters representable in ASCII. Alternatively, find a way
to transform the 'x' argument into something that is guaranteed to be
valid in its declared encoding. enc2utf8() could be an option, but any
invalid bytes are replaced by their <hexadecimal codes>, which defeats
the purpose of subNonStandardCharacters(). Find a way to feed the
output of Encoding(x) to iconv() as its "from" argument?

If not, it's enough to fix the example.

> 	  If I understand correctly, "\u**" should work with ** being
> f8, f6, df, or fc [all hex digits, I assume?].  However, "\u00**" may
> be preferred over "\u**", and "\u{**}" may be better still.

This is described in ?Quotes, although admittedly harder to find than
desired. The "\u" escape sequences take 1 to 4 hexadecimal digits. As
long as your escape sequence isn't followed by something that looks
like a hexadecimal digit, you can keep it short, like "\uf8m" (m is not
a hex digit). If you want to be 100% unambiguous, either padding the
code point number to 4 digits ("\u00f8m") or wrapping it into braces
("\u{f8}m") is enough. The belt-and-bracers approach ("\u{00f8}m") is
not an error, either.

You can also use the Encoding(x) <- 'latin1' trick to mark the strings
produced from bytes as Latin-1. Then gsub() will work normally, the
same way things happily work in example(iconv).

-- 
Best regards,
Ivan


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Wed Jul 20 02:56:45 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 19 Jul 2022 19:56:45 -0500
Subject: [R-pkg-devel] 
 Warning... unable to translate 'Ekstr<f8>m' to a wide
 string; Error... input string 1 is invalid
In-Reply-To: <ea3d139c-fee3-48f3-0f60-ba99ce7664b3@gmail.com>
References: <62ce5960.r6Obj/obxw/7rU4A%ripley@stats.ox.ac.uk>
 <b6adef1e-1003-c807-e543-b745070c7e0a@effectivedefense.org>
 <4a79b027-45cb-5236-70a1-c6c5edeb03ec@gmail.com>
 <f80c936b-8580-54db-66be-707ca49a8d25@effectivedefense.org>
 <CAHqSRuRtF6vsvKvnTuZLbfmMkBuCb3akAm3Obz7GQ54pYnGhyg@mail.gmail.com>
 <dab77229-faec-2337-a6b6-fee502518032@effectivedefense.org>
 <20220719210340.2033a6c1@trisector>
 <163d9fb1-3988-1ab9-4079-e8db681e7eb7@effectivedefense.org>
 <ea3d139c-fee3-48f3-0f60-ba99ce7664b3@gmail.com>
Message-ID: <7395e74a-88bc-1452-39ea-cab56cb4d711@effectivedefense.org>



On 7/19/22 2:12 PM, Duncan Murdoch wrote:
> On 19/07/2022 2:23 p.m., Spencer Graves wrote:
>> Hi, Ivan et al.:
>>
>>
>> On 7/19/22 1:03 PM, Ivan Krylov wrote:
>>> On Tue, 19 Jul 2022 12:32:20 -0500
>>> Spencer Graves <spencer.graves at effectivedefense.org> wrote:
>>>
>>>> Can someone provide me with a link to the correct development
>>>> version of help('iconv')?? The current version includes the exact
>>>> offending "\x" strings that I have.
>>>
>>> http://svn.r-project.org/R/trunk/src/library/base/man/iconv.Rd
>>>
>>> It still does, because it works with byte strings the right way: by
>>> passing them to iconv(), which is designed to work with bytes in
>>> "unknown" encodings.
>>>
>>> In contrast, your use of arbitrary bytes with gsub() is invalid,
>>> because gsub() assumes that the strings match their declared encoding:
>>> UTF-8, Latin-1, or the native locale encoding. (See ?Encoding.)
>>>
>>> When you write "Ekstr\xf8m", you get a string that consists of Latin-1
>>> bytes but has the wrong encoding property set. Given this string,
>>> gsub() and friends will break on a UTF-8 system (because "r\xf8m" is
>>> not a valid UTF-8 sequence of bytes), while iconv() will not.
>>>
>>> Depending on the desired semantics of subNonStandardCharacters(), you
>>> might be able to avoid the failures with the useBytes argument, or you
>>> might silently return invalid data in some corner cases. Is the "x"
>>> argument supposed to be bytes in arbitrary encoding, or properly decoded
>>> characters that might include those that don't map to ASCII?
>>>
>>
>> ????? Wow.? So what's the recommended fix?
>>
>>
>> ????? If I understand correctly, "\u**" should work with ** being f8, f6,
>> df, or fc [all hex digits, I assume?].? However, "\u00**" may be
>> preferred over "\u**", and "\u{**}" may be better still.
> 
> That's all correct.
> 
>> ????? The blog that Tomas wrote might be more useful if it included a
>> recommendation like this.
> 
> I think that advice is too specific to this example.? Here's a short 
> explanation about what's going on:
> 
> Strings in R are assumed to be in the ASCII encoding if they have no 
> bytes bigger than 128 (hex 80).
> 
> If they do have such bytes, they can be marked as "latin1", or "UTF-8", 
> or not marked, in which case they are assumed to be in the local encoding.
> 
> If you write a string containing "\u....", it is marked as being in the 
> "utf8" encoding.
> 
> If you write a string containing "\x....", it is not marked.
> 
> Thus if you are writing strings for others to use, you don't know how 
> those strings will be interpreted unless you explicitly set their 
> encoding.? For example, this is ambiguous:
> 
>  ?? x <- "fa\xE7ile"
> 
> This is not:
> 
>  ?? x <- "fa\xE7ile"
>  ?? Encoding(x) <- "latin1"
> 
> The advice you received to change the \x to \u works for your examples, 
> but might fail in other examples.? As help("Quotes") says, "\uE7" is the 
> Unicode code point hex E7, which is a c with a cedilla.? (The two hex 
> digit Unicode values from 80 to FF match the Latin-1 values; but not 
> everyone lives and works in a Latin-1 locale, so \xE7 might not be 
> equivalent to \uE7 for some people.)
> 
> You can have 1-4 hex digits after \u.? If the next character happens to 
> be a hex digit, you'll get some other character, e.g. "\uE7" is a ? (a c 
> with a cedilla), but "\uE7a" is a single Thai character, and "\uE7ab" is 
> some other single character (in the "private use area" of Unicode).
> 
> So it's safest to use exactly 4 hex digits as \u00E7, or to wrap the 
> value in curly braces, \u{E7}.


Thanks to all who replied.  I've changed all the "\x.." to "\u{..}".  I 
have other issues to deal with, but this seems to answer this question. 
  Thanks again, Spencer Graves

> 
> Some Unicode characters need more than 4 hex digits.? Use \U for those.
> 
> Duncan Murdoch
> 
> 
>


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Wed Jul 20 03:05:18 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 19 Jul 2022 20:05:18 -0500
Subject: [R-pkg-devel] NOTE, Problems with news in 'NEWS.md':,
 No news entries found.
In-Reply-To: <01d89bbe$Blat.v3.2.22$0f209195$1263c3d46@mail.statistik.tu-dortmund.de>
References: <01d89bbe$Blat.v3.2.22$0f209195$1263c3d46@mail.statistik.tu-dortmund.de>
Message-ID: <1ecc3e8f-937e-5b55-7f21-8a458b5c7800@effectivedefense.org>

Hello, All:


	  Winbuilder with R-Devel complains, " NOTE
Problems with news in 'NEWS.md': No news entries found." See below.


	  What should I do with this?  Document it in "cran-comments.md" and 
not worry about it otherwise?  Thanks,
	

	  Spencer Graves


-------- Forwarded Message --------
Subject: winbuilder: Package Ecfun_0.2-7.tar.gz has been checked and built
Date: Wed, 20 Jul 2022 00:22:40 +0200
From: ligges at statistik.tu-dortmund.de
To: spencer.graves at effectivedefense.org
CC: ligges at statistik.tu-dortmund.de

Dear package maintainer,
  this notification has been generated automatically.
Your package Ecfun_0.2-7.tar.gz has been built (if working) and checked 
for Windows.
Please check the log files and (if working) the binary package at:
https://win-builder.r-project.org/e3NjJDDwiq0Z
The files will be removed after roughly 72 hours.
Installation time in seconds: 16
Check time in seconds: 141
Status: 1 NOTE
R Under development (unstable) (2022-07-18 r82603 ucrt)
  All the best,
Uwe Ligges
(CRAN maintainer of binary packages for Windows)


From M@x@Turgeon @end|ng |rom um@n|tob@@c@  Wed Jul 20 03:27:55 2022
From: M@x@Turgeon @end|ng |rom um@n|tob@@c@ (Max Turgeon)
Date: Wed, 20 Jul 2022 01:27:55 +0000
Subject: [R-pkg-devel] NOTE, Problems with news in 'NEWS.md':,
 No news entries found.
In-Reply-To: <1ecc3e8f-937e-5b55-7f21-8a458b5c7800@effectivedefense.org>
References: <01d89bbe$Blat.v3.2.22$0f209195$1263c3d46@mail.statistik.tu-dortmund.de>
 <1ecc3e8f-937e-5b55-7f21-8a458b5c7800@effectivedefense.org>
Message-ID: <YQXPR01MB4579F4D6BA3B4B50B67BFD179A8E9@YQXPR01MB4579.CANPRD01.PROD.OUTLOOK.COM>

Hi Spencer,

This NOTE was discussed a couple weeks ago on this list, it's (as you may expect) a new check in R-devel. Here's what Ivan had to say: https://stat.ethz.ch/pipermail/r-package-devel/2022q3/008239.html

Others also chimed in, you can see the first message of the thread here: https://stat.ethz.ch/pipermail/r-package-devel/2022q3/008235.html

Good luck!


Max Turgeon<https://www.name-coach.com/maxime-turgeon>
Assistant Professor

Department of Statistics
University of Manitoba

maxturgeon.ca<http://maxturgeon.ca/>

________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Spencer Graves <spencer.graves at effectivedefense.org>
Sent: Tuesday, July 19, 2022 8:05 PM
To: List r-package-devel <r-package-devel at r-project.org>
Subject: [R-pkg-devel] NOTE, Problems with news in 'NEWS.md':, No news entries found.

********************************************************
Caution: This message was sent from outside the University of Manitoba.
********************************************************

Hello, All:


          Winbuilder with R-Devel complains, " NOTE
Problems with news in 'NEWS.md': No news entries found." See below.


          What should I do with this?  Document it in "cran-comments.md" and
not worry about it otherwise?  Thanks,


          Spencer Graves


-------- Forwarded Message --------
Subject: winbuilder: Package Ecfun_0.2-7.tar.gz has been checked and built
Date: Wed, 20 Jul 2022 00:22:40 +0200
From: ligges at statistik.tu-dortmund.de
To: spencer.graves at effectivedefense.org
CC: ligges at statistik.tu-dortmund.de

Dear package maintainer,
  this notification has been generated automatically.
Your package Ecfun_0.2-7.tar.gz has been built (if working) and checked
for Windows.
Please check the log files and (if working) the binary package at:
https://win-builder.r-project.org/e3NjJDDwiq0Z
The files will be removed after roughly 72 hours.
Installation time in seconds: 16
Check time in seconds: 141
Status: 1 NOTE
R Under development (unstable) (2022-07-18 r82603 ucrt)
  All the best,
Uwe Ligges
(CRAN maintainer of binary packages for Windows)

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel


	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Jul 20 18:50:50 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 20 Jul 2022 18:50:50 +0200
Subject: [R-pkg-devel] NOTE, Problems with news in 'NEWS.md':,
 No news entries found.
In-Reply-To: <YQXPR01MB4579F4D6BA3B4B50B67BFD179A8E9@YQXPR01MB4579.CANPRD01.PROD.OUTLOOK.COM>
References: <01d89bbe$Blat.v3.2.22$0f209195$1263c3d46@mail.statistik.tu-dortmund.de>
 <1ecc3e8f-937e-5b55-7f21-8a458b5c7800@effectivedefense.org>
 <YQXPR01MB4579F4D6BA3B4B50B67BFD179A8E9@YQXPR01MB4579.CANPRD01.PROD.OUTLOOK.COM>
Message-ID: <3af7bb83-94d1-87be-fd33-a3eadce91463@statistik.tu-dortmund.de>

Or simply read ?news which explains how the three formats (plain text 
NEWS, NEWS.Rd and NEWS.md) should look like.

Best,
Uwe Ligges

On 20.07.2022 03:27, Max Turgeon wrote:
> Hi Spencer,
> 
> This NOTE was discussed a couple weeks ago on this list, it's (as you may expect) a new check in R-devel. Here's what Ivan had to say: https://stat.ethz.ch/pipermail/r-package-devel/2022q3/008239.html
> 
> Others also chimed in, you can see the first message of the thread here: https://stat.ethz.ch/pipermail/r-package-devel/2022q3/008235.html
> 
> Good luck!
> 
> 
> Max Turgeon<https://www.name-coach.com/maxime-turgeon>
> Assistant Professor
> 
> Department of Statistics
> University of Manitoba
> 
> maxturgeon.ca<http://maxturgeon.ca/>
> 
> ________________________________
> From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Spencer Graves <spencer.graves at effectivedefense.org>
> Sent: Tuesday, July 19, 2022 8:05 PM
> To: List r-package-devel <r-package-devel at r-project.org>
> Subject: [R-pkg-devel] NOTE, Problems with news in 'NEWS.md':, No news entries found.
> 
> ********************************************************
> Caution: This message was sent from outside the University of Manitoba.
> ********************************************************
> 
> Hello, All:
> 
> 
>            Winbuilder with R-Devel complains, " NOTE
> Problems with news in 'NEWS.md': No news entries found." See below.
> 
> 
>            What should I do with this?  Document it in "cran-comments.md" and
> not worry about it otherwise?  Thanks,
> 
> 
>            Spencer Graves
> 
> 
> -------- Forwarded Message --------
> Subject: winbuilder: Package Ecfun_0.2-7.tar.gz has been checked and built
> Date: Wed, 20 Jul 2022 00:22:40 +0200
> From: ligges at statistik.tu-dortmund.de
> To: spencer.graves at effectivedefense.org
> CC: ligges at statistik.tu-dortmund.de
> 
> Dear package maintainer,
>    this notification has been generated automatically.
> Your package Ecfun_0.2-7.tar.gz has been built (if working) and checked
> for Windows.
> Please check the log files and (if working) the binary package at:
> https://win-builder.r-project.org/e3NjJDDwiq0Z
> The files will be removed after roughly 72 hours.
> Installation time in seconds: 16
> Check time in seconds: 141
> Status: 1 NOTE
> R Under development (unstable) (2022-07-18 r82603 ucrt)
>    All the best,
> Uwe Ligges
> (CRAN maintainer of binary packages for Windows)
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m@|| @end|ng |rom jon@@kur|e@com  Fri Jul 22 22:09:15 2022
From: m@|| @end|ng |rom jon@@kur|e@com (Jonas Kurle)
Date: Fri, 22 Jul 2022 21:09:15 +0100
Subject: [R-pkg-devel] CRAN pre-test failure due to long runtime / timeout
Message-ID: <cce163c9-5ef2-96e2-8127-c0aa2efc8b81@jonaskurle.com>

Dear all,

I submitted a new version of my package "robust2sls" (released version 
on CRAN <https://cran.r-project.org/package=robust2sls>, new submitted 
version on GitHub <https://github.com/jkurle/robust2sls>).

The automatic CRAN pre-tests fail and it seems that this is due to 
runtime timeout (in the tests). For Windows, I get the message "Check 
process probably crashed or hung up for 20 minutes ... killed" and for 
Debian, I get "checking tests ... [30m/30m] ERROR". See below for the 
links to the log files.

https://win-builder.r-project.org/incoming_pretest/robust2sls_0.2.1_20220722_180126/Windows/00check.log
https://win-builder.r-project.org/incoming_pretest/robust2sls_0.2.1_20220722_180126/Debian/00check.log 


It seems that the development version of R might be causing this 
problem, and others have already discussed longer running times of their 
checks on this mailing list.

If I do the checks on winbuilder using the old version 
<https://win-builder.r-project.org/VCReLD0u8Svj/00check.log> or release 
version <https://win-builder.r-project.org/l0zOMEvibJ1b/00check.log> of 
R, it works fine. But with the development version 
<https://win-builder.r-project.org/5ZebbySXV99X/00check.log> it fails.

Surprisingly, the CRAN checks work well on all five settings that I have 
tried with GitHub Actions 
<https://github.com/jkurle/robust2sls/actions/runs/2719662067>, 
including the one with the development version of R on Ubuntu. The check 
took less than 10 minutes in this case.

Can anyone advise me what to do? I could skip most of my tests based on 
the "testthat" package to decrease the runtime, such that they can 
finish when re-submitting to CRAN even if the development version of R 
is slower. But of course, I would prefer to keep my tests and figure out 
the reason for the slowdown.

Thank you for any suggestions and help!

Best wishes,
Jonas


	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Sat Jul 23 02:19:02 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 22 Jul 2022 19:19:02 -0500
Subject: [R-pkg-devel] 
 CRAN pre-test failure due to long runtime / timeout
In-Reply-To: <cce163c9-5ef2-96e2-8127-c0aa2efc8b81@jonaskurle.com>
References: <cce163c9-5ef2-96e2-8127-c0aa2efc8b81@jonaskurle.com>
Message-ID: <25307.15990.782414.909474@rob.eddelbuettel.com>


On 22 July 2022 at 21:09, Jonas Kurle wrote:
| The automatic CRAN pre-tests fail and it seems that this is due to 
| runtime timeout (in the tests). For Windows, I get the message "Check 
| process probably crashed or hung up for 20 minutes ... killed" and for 
| Debian, I get "checking tests ... [30m/30m] ERROR". See below for the 
| links to the log files.

[...]

| Can anyone advise me what to do?

There is a "fix" addressing the _symptom_ but not the _cause_: simply do not
run the tests. Your time is finite, CRAN maintainer time is certainly finite.
Even today we still do not have a real ability to cleanly reproduce CRAN
checks (win-builder is pretty close, but eg CRAN Debian is not Dockerized and
hence not really reproducible (I once offered help but this petered out
without generating anything tangible).

This topic has been discussed a few times before. Some people advocate using
skip_on_cran() (if you use testthat). I don't testthat but in some packages
only run tests if an env. var is set which I set eg for GitHUb Actions.

Hth, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Sat Jul 23 08:21:21 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sat, 23 Jul 2022 09:21:21 +0300
Subject: [R-pkg-devel] 
 CRAN pre-test failure due to long runtime / timeout
In-Reply-To: <cce163c9-5ef2-96e2-8127-c0aa2efc8b81@jonaskurle.com>
References: <cce163c9-5ef2-96e2-8127-c0aa2efc8b81@jonaskurle.com>
Message-ID: <20220723092121.0e27509b@trisector>

On Fri, 22 Jul 2022 21:09:15 +0100
Jonas Kurle <mail at jonaskurle.com> wrote:

> Can anyone advise me what to do? 

I see you're using testthat. Is there a way to make it produce verbose
output for every test during their runtime? As far as I know, testthat
tests look like a single test to R CMD check which only outputs
everything after it's done (or an error occurs). Since the R process is
terminated on timeout, it doesn't get a chance to handle an error and
print anything.

One way I see is relatively time-consuming, but so is blindly playing
skip_on_cran with individual tests and resubmitting jobs to
win-builder. If you move your tests from tests/testthat/*.R into
tests/*.R (and adjust them to work outside the testthat harness if
necessary), R should be able to tell you which *.R file times out
and show you the approximate location where it was terminated.

Alternatively, you could try instrumenting your tests with debugging
print commands and see if any of them end up in 00check.log, but I
think that testthat uses capture.output to declutter the console when
running tests, which, sadly, ends up interfering with your ability to
debug the problem in this case.

-- 
Best regards,
Ivan


From m@|| @end|ng |rom jon@@kur|e@com  Sat Jul 23 12:16:06 2022
From: m@|| @end|ng |rom jon@@kur|e@com (Jonas Kurle)
Date: Sat, 23 Jul 2022 11:16:06 +0100
Subject: [R-pkg-devel] 
 CRAN pre-test failure due to long runtime / timeout
In-Reply-To: <20220723092121.0e27509b@trisector>
References: <cce163c9-5ef2-96e2-8127-c0aa2efc8b81@jonaskurle.com>
 <20220723092121.0e27509b@trisector>
Message-ID: <40c41d20-8fc9-356e-4305-48f0de6f8e43@jonaskurle.com>

Dear Ivan and Dirk,

Thank you both for your suggestions and your help.

For now, I will simply skip the automatic unit testing on CRAN. My 
submission to winbuilder is now successful for all versions of R.

In the long run, I might move away from testthat to have more 
flexibility with respect to debugging and being able to see in more 
detail what is going on. I also received a hint from another user 
(thanks Johannes!) who ran my tests locally on their Debian system, 
where the tests did not time out but eventually produced an error. It 
turns out that some of my tests / functions work slightly differently on 
different platforms, so I can now adjust these tests to be 
platform-specific.

Thanks again and best wishes,
Jonas


Am 23.07.2022 um 07:21 schrieb Ivan Krylov:
> On Fri, 22 Jul 2022 21:09:15 +0100
> Jonas Kurle <mail at jonaskurle.com> wrote:
>
>> Can anyone advise me what to do?
> I see you're using testthat. Is there a way to make it produce verbose
> output for every test during their runtime? As far as I know, testthat
> tests look like a single test to R CMD check which only outputs
> everything after it's done (or an error occurs). Since the R process is
> terminated on timeout, it doesn't get a chance to handle an error and
> print anything.
>
> One way I see is relatively time-consuming, but so is blindly playing
> skip_on_cran with individual tests and resubmitting jobs to
> win-builder. If you move your tests from tests/testthat/*.R into
> tests/*.R (and adjust them to work outside the testthat harness if
> necessary), R should be able to tell you which *.R file times out
> and show you the approximate location where it was terminated.
>
> Alternatively, you could try instrumenting your tests with debugging
> print commands and see if any of them end up in 00check.log, but I
> think that testthat uses capture.output to declutter the console when
> running tests, which, sadly, ends up interfering with your ability to
> debug the problem in this case.
>


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Sun Jul 24 04:08:07 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Sat, 23 Jul 2022 21:08:07 -0500
Subject: [R-pkg-devel] Thanks -- success after 4 package submissions in 3
 days
In-Reply-To: <3af7bb83-94d1-87be-fd33-a3eadce91463@statistik.tu-dortmund.de>
References: <01d89bbe$Blat.v3.2.22$0f209195$1263c3d46@mail.statistik.tu-dortmund.de>
 <1ecc3e8f-937e-5b55-7f21-8a458b5c7800@effectivedefense.org>
 <YQXPR01MB4579F4D6BA3B4B50B67BFD179A8E9@YQXPR01MB4579.CANPRD01.PROD.OUTLOOK.COM>
 <3af7bb83-94d1-87be-fd33-a3eadce91463@statistik.tu-dortmund.de>
Message-ID: <11b485e5-e42a-7e00-77d8-2ea20e80b97b@effectivedefense.org>

Hello, All:


	  Thanks to Uwe Ligges, Max Turgeon, Duncan Murdoch, Ivan Krylov, Jeff 
Newmiller, Ben Bolker, Bill Dunlap, and Tomas Kalibera, Ecfun 0.3-0 is 
now available on CRAN, after three earlier versions were rejected in 
three days due to my limited ability to understand the error messages I 
saw.


	  My excuse for being so dense is that all the problems I encountered 
were changes required to meet new, more stringent standards implemented 
to reduce ambiguity and tighten coding standards to convert more subtle, 
intermittent problems that are difficult to trace into coding errors 
that are more easily fixed.


	  Spencer Graves


On 7/20/22 11:50 AM, Uwe Ligges wrote:
> Or simply read ?news which explains how the three formats (plain text 
> NEWS, NEWS.Rd and NEWS.md) should look like.
> 
> Best,
> Uwe Ligges
> 
> On 20.07.2022 03:27, Max Turgeon wrote:
>> Hi Spencer,
>>
>> This NOTE was discussed a couple weeks ago on this list, it's (as you 
>> may expect) a new check in R-devel. Here's what Ivan had to say: 
>> https://stat.ethz.ch/pipermail/r-package-devel/2022q3/008239.html
>>
>> Others also chimed in, you can see the first message of the thread 
>> here: https://stat.ethz.ch/pipermail/r-package-devel/2022q3/008235.html
>>
>> Good luck!
>>
>>
>> Max Turgeon<https://www.name-coach.com/maxime-turgeon>
>> Assistant Professor
>>
>> Department of Statistics
>> University of Manitoba
>>
>> maxturgeon.ca<http://maxturgeon.ca/>
>>
>> ________________________________
>> From: R-package-devel <r-package-devel-bounces at r-project.org> on 
>> behalf of Spencer Graves <spencer.graves at effectivedefense.org>
>> Sent: Tuesday, July 19, 2022 8:05 PM
>> To: List r-package-devel <r-package-devel at r-project.org>
>> Subject: [R-pkg-devel] NOTE, Problems with news in 'NEWS.md':, No news 
>> entries found.
>>
>> ********************************************************
>> Caution: This message was sent from outside the University of Manitoba.
>> ********************************************************
>>
>> Hello, All:
>>
>>
>> ?????????? Winbuilder with R-Devel complains, " NOTE
>> Problems with news in 'NEWS.md': No news entries found." See below.
>>
>>
>> ?????????? What should I do with this?? Document it in 
>> "cran-comments.md" and
>> not worry about it otherwise?? Thanks,
>>
>>
>> ?????????? Spencer Graves
>>
>>
>> -------- Forwarded Message --------
>> Subject: winbuilder: Package Ecfun_0.2-7.tar.gz has been checked and 
>> built
>> Date: Wed, 20 Jul 2022 00:22:40 +0200
>> From: ligges at statistik.tu-dortmund.de
>> To: spencer.graves at effectivedefense.org
>> CC: ligges at statistik.tu-dortmund.de
>>
>> Dear package maintainer,
>> ?? this notification has been generated automatically.
>> Your package Ecfun_0.2-7.tar.gz has been built (if working) and checked
>> for Windows.
>> Please check the log files and (if working) the binary package at:
>> https://win-builder.r-project.org/e3NjJDDwiq0Z
>> The files will be removed after roughly 72 hours.
>> Installation time in seconds: 16
>> Check time in seconds: 141
>> Status: 1 NOTE
>> R Under development (unstable) (2022-07-18 r82603 ucrt)
>> ?? All the best,
>> Uwe Ligges
>> (CRAN maintainer of binary packages for Windows)
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>>
>> ????[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Wed Jul 27 00:30:22 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Wed, 27 Jul 2022 07:30:22 +0900
Subject: [R-pkg-devel] About the CRAN policy on downloading pre-compiled
 binary
In-Reply-To: <b97a6d91-ad00-413f-14f4-e78a0c0e6d1e@stats.ox.ac.uk>
References: <b97a6d91-ad00-413f-14f4-e78a0c0e6d1e@stats.ox.ac.uk>
Message-ID: <CALyqOb_+E=EMg8w0wmBaB8=1by3SyBcBbrAC6KVd4PTygQT=3g@mail.gmail.com>

Hi,

Recently I got the following email from the CRAN maintainer about my
package, string2path[1].

However, I do ensure the binary is the pinned version and verify if the
hash matches with the embedded one in the DESCRIPTION [2][3]. In case of a
mismatch, the build fails. So, this mechanism should ensure that I (or
anyone) cannot change the version of the binary without actually
resubmitting to CRAN.

I believe this complies with the CRAN policy (except for not clearing the
authorship and copyright). Is there anything I have to address to prove I
do "ensure that the download is of a fixed version"? Any suggestions are
welcome.

The CRAN policy stipulates
>
> "Where a package wishes to make use of a library not written solely for
> the package, the package installation should first look to see if it is
> already installed and if so is of a suitable version. In case not, it is
> desirable to include the library sources in the package and compile them
> as part of package installation. If the sources are too large, it is
> acceptable to download them as part of installation, but do ensure that
> the download is of a fixed version rather than the latest. Only as a
> last resort and with the agreement of the CRAN team should a package
> download pre-compiled software."
>
> and we have recently seen an instance of a rust-using package whose
> check output changed because what it downloaded had changed.  CRAN
> checking is not set up for that (for example, macOS checks are done once
> only for each version).
>
> Whilst investigating, the Windows' maintainers found that binary libs
> were being downloaded.  And subsequently I found that salso, string2path
> and ymd are downloading compiled code on Intel macOS.
>
> Also. make sure that the authorship and copyright of code you download
> (and hence include in the package) is clear from the DESCRIPTION file.
> as required by the CRAN policy.
>

Best,
Hiroaki Yutani

[1]: https://cran.r-project.org/package=string2path
[2]:
https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/DESCRIPTION#L29-L40
[3]:
https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/tools/configure.R#L177-L295

	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jul 27 08:08:16 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 27 Jul 2022 08:08:16 +0200
Subject: [R-pkg-devel] About the CRAN policy on downloading pre-compiled
 binary
In-Reply-To: <CALyqOb_+E=EMg8w0wmBaB8=1by3SyBcBbrAC6KVd4PTygQT=3g@mail.gmail.com>
References: <b97a6d91-ad00-413f-14f4-e78a0c0e6d1e@stats.ox.ac.uk>
 <CALyqOb_+E=EMg8w0wmBaB8=1by3SyBcBbrAC6KVd4PTygQT=3g@mail.gmail.com>
Message-ID: <22bf93a2-0abc-24e2-da24-ca1a219e4913@gmail.com>


On 7/27/22 00:30, Hiroaki Yutani wrote:
> Hi,
>
> Recently I got the following email from the CRAN maintainer about my
> package, string2path[1].
>
> However, I do ensure the binary is the pinned version and verify if the
> hash matches with the embedded one in the DESCRIPTION [2][3]. In case of a
> mismatch, the build fails. So, this mechanism should ensure that I (or
> anyone) cannot change the version of the binary without actually
> resubmitting to CRAN.

Please see the policy cited. Ensuring that the download is of a fixed 
version refers to the sources (which can be downloaded under the 
conditions mentioned).

Downloading binaries are only a last resort option and requires the 
agreement of the CRAN team in the first place.

> I believe this complies with the CRAN policy (except for not clearing the
> authorship and copyright). Is there anything I have to address to prove I
> do "ensure that the download is of a fixed version"? Any suggestions are
> welcome.

My understanding from your email is you are ensuring a fixed version 
download, and with most projects you could probably do even less (simply 
hardcode a URL which includes a specific version of the sources if that 
is stable for the project), but you are not downloading sources.

In either case, of course if there is anything unclear in an email from 
CRAN, you can simply respond to that and ask.

Best
Tomas

>
> The CRAN policy stipulates
>> "Where a package wishes to make use of a library not written solely for
>> the package, the package installation should first look to see if it is
>> already installed and if so is of a suitable version. In case not, it is
>> desirable to include the library sources in the package and compile them
>> as part of package installation. If the sources are too large, it is
>> acceptable to download them as part of installation, but do ensure that
>> the download is of a fixed version rather than the latest. Only as a
>> last resort and with the agreement of the CRAN team should a package
>> download pre-compiled software."
>>
>> and we have recently seen an instance of a rust-using package whose
>> check output changed because what it downloaded had changed.  CRAN
>> checking is not set up for that (for example, macOS checks are done once
>> only for each version).
>>
>> Whilst investigating, the Windows' maintainers found that binary libs
>> were being downloaded.  And subsequently I found that salso, string2path
>> and ymd are downloading compiled code on Intel macOS.
>>
>> Also. make sure that the authorship and copyright of code you download
>> (and hence include in the package) is clear from the DESCRIPTION file.
>> as required by the CRAN policy.
>>
> Best,
> Hiroaki Yutani
>
> [1]: https://cran.r-project.org/package=string2path
> [2]:
> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/DESCRIPTION#L29-L40
> [3]:
> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/tools/configure.R#L177-L295
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Wed Jul 27 09:03:25 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Wed, 27 Jul 2022 16:03:25 +0900
Subject: [R-pkg-devel] About the CRAN policy on downloading pre-compiled
 binary
In-Reply-To: <22bf93a2-0abc-24e2-da24-ca1a219e4913@gmail.com>
References: <b97a6d91-ad00-413f-14f4-e78a0c0e6d1e@stats.ox.ac.uk>
 <CALyqOb_+E=EMg8w0wmBaB8=1by3SyBcBbrAC6KVd4PTygQT=3g@mail.gmail.com>
 <22bf93a2-0abc-24e2-da24-ca1a219e4913@gmail.com>
Message-ID: <CALyqOb9bDwyh9ahnaaHQwsxC=Ys=iNGBVqVjLPNOykigvxzvUw@mail.gmail.com>

Thank you. I'll read the policy again more carefully.

> but you are not downloading sources.

The case is that, I include the Rust source code, but since the CRAN's
Windows & macOS machines don't have the Rust compiler installed, there's no
choice but to download the pre-compiled binary (other than downloading the
Rust compiler).

> In either case, of course if there is anything unclear in an email from
> CRAN, you can simply respond to that and ask.

Thanks, I already responded with what I wrote above, so I hope I can get
the reply.
But, since the CRAN team might be on vacation now, I wanted to get some
advice on this mailing list.
Thanks for your help!

Best,
Yutani

2022?7?27?(?) 15:08 Tomas Kalibera <tomas.kalibera at gmail.com>:

>
> On 7/27/22 00:30, Hiroaki Yutani wrote:
> > Hi,
> >
> > Recently I got the following email from the CRAN maintainer about my
> > package, string2path[1].
> >
> > However, I do ensure the binary is the pinned version and verify if the
> > hash matches with the embedded one in the DESCRIPTION [2][3]. In case of
> a
> > mismatch, the build fails. So, this mechanism should ensure that I (or
> > anyone) cannot change the version of the binary without actually
> > resubmitting to CRAN.
>
> Please see the policy cited. Ensuring that the download is of a fixed
> version refers to the sources (which can be downloaded under the
> conditions mentioned).
>
> Downloading binaries are only a last resort option and requires the
> agreement of the CRAN team in the first place.
>
> > I believe this complies with the CRAN policy (except for not clearing the
> > authorship and copyright). Is there anything I have to address to prove I
> > do "ensure that the download is of a fixed version"? Any suggestions are
> > welcome.
>
> My understanding from your email is you are ensuring a fixed version
> download, and with most projects you could probably do even less (simply
> hardcode a URL which includes a specific version of the sources if that
> is stable for the project), but you are not downloading sources.
>
> In either case, of course if there is anything unclear in an email from
> CRAN, you can simply respond to that and ask.
>
> Best
> Tomas
>
> >
> > The CRAN policy stipulates
> >> "Where a package wishes to make use of a library not written solely for
> >> the package, the package installation should first look to see if it is
> >> already installed and if so is of a suitable version. In case not, it is
> >> desirable to include the library sources in the package and compile them
> >> as part of package installation. If the sources are too large, it is
> >> acceptable to download them as part of installation, but do ensure that
> >> the download is of a fixed version rather than the latest. Only as a
> >> last resort and with the agreement of the CRAN team should a package
> >> download pre-compiled software."
> >>
> >> and we have recently seen an instance of a rust-using package whose
> >> check output changed because what it downloaded had changed.  CRAN
> >> checking is not set up for that (for example, macOS checks are done once
> >> only for each version).
> >>
> >> Whilst investigating, the Windows' maintainers found that binary libs
> >> were being downloaded.  And subsequently I found that salso, string2path
> >> and ymd are downloading compiled code on Intel macOS.
> >>
> >> Also. make sure that the authorship and copyright of code you download
> >> (and hence include in the package) is clear from the DESCRIPTION file.
> >> as required by the CRAN policy.
> >>
> > Best,
> > Hiroaki Yutani
> >
> > [1]: https://cran.r-project.org/package=string2path
> > [2]:
> >
> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/DESCRIPTION#L29-L40
> > [3]:
> >
> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/tools/configure.R#L177-L295
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jul 27 09:53:08 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 27 Jul 2022 09:53:08 +0200
Subject: [R-pkg-devel] About the CRAN policy on downloading pre-compiled
 binary
In-Reply-To: <CALyqOb9bDwyh9ahnaaHQwsxC=Ys=iNGBVqVjLPNOykigvxzvUw@mail.gmail.com>
References: <b97a6d91-ad00-413f-14f4-e78a0c0e6d1e@stats.ox.ac.uk>
 <CALyqOb_+E=EMg8w0wmBaB8=1by3SyBcBbrAC6KVd4PTygQT=3g@mail.gmail.com>
 <22bf93a2-0abc-24e2-da24-ca1a219e4913@gmail.com>
 <CALyqOb9bDwyh9ahnaaHQwsxC=Ys=iNGBVqVjLPNOykigvxzvUw@mail.gmail.com>
Message-ID: <261ca70f-54dc-a663-4a94-4e8756645a02@gmail.com>

On 7/27/22 09:03, Hiroaki Yutani wrote:
> Thank you. I'll read the policy again more carefully.
>
> > but you are not downloading sources.
>
> The case is that, I include the Rust source code, but since the CRAN's 
> Windows & macOS machines don't have the Rust compiler installed, 
> there's no choice but to download the pre-compiled binary (other than 
> downloading the Rust compiler).

I'd say at least check whether the compiler is present (during package 
installation), and use it if it is. Only if you want to download 
binaries as a last resort when it isn't, consult that first with the 
CRAN team. Perhaps it could also be a hard dependency for installing the 
package, and perhaps Rust compiler would be installed on the CRAN machines.

I think it is better not to hard-code which software is installed on the 
CRAN systems, because that may change and because different software may 
be installed on user machines. However, on Windows, it is ok to expect 
that say Rtools42 is available when building packages for R 4.2 (yet 
Rtools42 don't have a rust compiler, so it doesn't help you here).

Right, downloading the source code of the Rust compiler and building it 
seems a bit too resource intensive and then, a bit too much if multiple 
R packages need it. Ideally the compiler will be installed and the R 
source packages will really be source packages (no binaries).

>
> > In either case, of course if there is anything unclear in an email from
> > CRAN, you can simply respond to that and ask.
>
> Thanks, I already responded with what I wrote above, so I hope I can 
> get the reply.
> But, since the CRAN team might be on vacation now, I wanted to get 
> some advice on this mailing list.
> Thanks for your help!

No problem, just please only regard it as my advice.

Best
Tomas

>
> Best,
> Yutani
>
> 2022?7?27?(?) 15:08 Tomas Kalibera <tomas.kalibera at gmail.com>:
>
>
>     On 7/27/22 00:30, Hiroaki Yutani wrote:
>     > Hi,
>     >
>     > Recently I got the following email from the CRAN maintainer about my
>     > package, string2path[1].
>     >
>     > However, I do ensure the binary is the pinned version and verify
>     if the
>     > hash matches with the embedded one in the DESCRIPTION [2][3]. In
>     case of a
>     > mismatch, the build fails. So, this mechanism should ensure that
>     I (or
>     > anyone) cannot change the version of the binary without actually
>     > resubmitting to CRAN.
>
>     Please see the policy cited. Ensuring that the download is of a fixed
>     version refers to the sources (which can be downloaded under the
>     conditions mentioned).
>
>     Downloading binaries are only a last resort option and requires the
>     agreement of the CRAN team in the first place.
>
>     > I believe this complies with the CRAN policy (except for not
>     clearing the
>     > authorship and copyright). Is there anything I have to address
>     to prove I
>     > do "ensure that the download is of a fixed version"? Any
>     suggestions are
>     > welcome.
>
>     My understanding from your email is you are ensuring a fixed version
>     download, and with most projects you could probably do even less
>     (simply
>     hardcode a URL which includes a specific version of the sources if
>     that
>     is stable for the project), but you are not downloading sources.
>
>     In either case, of course if there is anything unclear in an email
>     from
>     CRAN, you can simply respond to that and ask.
>
>     Best
>     Tomas
>
>     >
>     > The CRAN policy stipulates
>     >> "Where a package wishes to make use of a library not written
>     solely for
>     >> the package, the package installation should first look to see
>     if it is
>     >> already installed and if so is of a suitable version. In case
>     not, it is
>     >> desirable to include the library sources in the package and
>     compile them
>     >> as part of package installation. If the sources are too large,
>     it is
>     >> acceptable to download them as part of installation, but do
>     ensure that
>     >> the download is of a fixed version rather than the latest. Only
>     as a
>     >> last resort and with the agreement of the CRAN team should a
>     package
>     >> download pre-compiled software."
>     >>
>     >> and we have recently seen an instance of a rust-using package whose
>     >> check output changed because what it downloaded had changed.? CRAN
>     >> checking is not set up for that (for example, macOS checks are
>     done once
>     >> only for each version).
>     >>
>     >> Whilst investigating, the Windows' maintainers found that
>     binary libs
>     >> were being downloaded.? And subsequently I found that salso,
>     string2path
>     >> and ymd are downloading compiled code on Intel macOS.
>     >>
>     >> Also. make sure that the authorship and copyright of code you
>     download
>     >> (and hence include in the package) is clear from the
>     DESCRIPTION file.
>     >> as required by the CRAN policy.
>     >>
>     > Best,
>     > Hiroaki Yutani
>     >
>     > [1]: https://cran.r-project.org/package=string2path
>     > [2]:
>     >
>     https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/DESCRIPTION#L29-L40
>     > [3]:
>     >
>     https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/tools/configure.R#L177-L295
>     >
>     >? ? ? ?[[alternative HTML version deleted]]
>     >
>     > ______________________________________________
>     > R-package-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed Jul 27 10:12:31 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 27 Jul 2022 10:12:31 +0200
Subject: [R-pkg-devel] About the CRAN policy on downloading pre-compiled
 binary
In-Reply-To: <22bf93a2-0abc-24e2-da24-ca1a219e4913@gmail.com>
References: <b97a6d91-ad00-413f-14f4-e78a0c0e6d1e@stats.ox.ac.uk>
 <CALyqOb_+E=EMg8w0wmBaB8=1by3SyBcBbrAC6KVd4PTygQT=3g@mail.gmail.com>
 <22bf93a2-0abc-24e2-da24-ca1a219e4913@gmail.com>
Message-ID: <59d6931a-3326-c20a-fb60-0f7a6a9cbcb6@gmail.com>


On 7/27/22 08:08, Tomas Kalibera wrote:
>
> On 7/27/22 00:30, Hiroaki Yutani wrote:
>> Hi,
>>
>> Recently I got the following email from the CRAN maintainer about my
>> package, string2path[1].
>>
>> However, I do ensure the binary is the pinned version and verify if the
>> hash matches with the embedded one in the DESCRIPTION [2][3]. In case 
>> of a
>> mismatch, the build fails. So, this mechanism should ensure that I (or
>> anyone) cannot change the version of the binary without actually
>> resubmitting to CRAN.
>
> Please see the policy cited. Ensuring that the download is of a fixed 
> version refers to the sources (which can be downloaded under the 
> conditions mentioned).
>
> Downloading binaries are only a last resort option and requires the 
> agreement of the CRAN team in the first place.
>
>> I believe this complies with the CRAN policy (except for not clearing 
>> the
>> authorship and copyright). Is there anything I have to address to 
>> prove I
>> do "ensure that the download is of a fixed version"? Any suggestions are
>> welcome.
>
> My understanding from your email is you are ensuring a fixed version 
> download, and with most projects you could probably do even less 
> (simply hardcode a URL which includes a specific version of the 
> sources if that is stable for the project), but you are not 
> downloading sources.

I take back the comment about doing less to ensure a fixed version - it 
is good to use a hash always when having to download sources, as 
software distributions do (of course including MXE and Msys2, so Rtools 
on Windows, etc). It is better as a guard against that the content is in 
fact not stable for the project (I've been told it sometimes happens and 
may be surprising to package authors), but of course also for security 
reasons.

Tomas
>
> In either case, of course if there is anything unclear in an email 
> from CRAN, you can simply respond to that and ask.
>
> Best
> Tomas
>
>>
>> The CRAN policy stipulates
>>> "Where a package wishes to make use of a library not written solely for
>>> the package, the package installation should first look to see if it is
>>> already installed and if so is of a suitable version. In case not, 
>>> it is
>>> desirable to include the library sources in the package and compile 
>>> them
>>> as part of package installation. If the sources are too large, it is
>>> acceptable to download them as part of installation, but do ensure that
>>> the download is of a fixed version rather than the latest. Only as a
>>> last resort and with the agreement of the CRAN team should a package
>>> download pre-compiled software."
>>>
>>> and we have recently seen an instance of a rust-using package whose
>>> check output changed because what it downloaded had changed. CRAN
>>> checking is not set up for that (for example, macOS checks are done 
>>> once
>>> only for each version).
>>>
>>> Whilst investigating, the Windows' maintainers found that binary libs
>>> were being downloaded.? And subsequently I found that salso, 
>>> string2path
>>> and ymd are downloading compiled code on Intel macOS.
>>>
>>> Also. make sure that the authorship and copyright of code you download
>>> (and hence include in the package) is clear from the DESCRIPTION file.
>>> as required by the CRAN policy.
>>>
>> Best,
>> Hiroaki Yutani
>>
>> [1]: https://cran.r-project.org/package=string2path
>> [2]:
>> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/DESCRIPTION#L29-L40 
>>
>> [3]:
>> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/tools/configure.R#L177-L295 
>>
>>
>> ????[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From yut@n|@|n| @end|ng |rom gm@||@com  Fri Aug  5 03:28:00 2022
From: yut@n|@|n| @end|ng |rom gm@||@com (Hiroaki Yutani)
Date: Fri, 5 Aug 2022 10:28:00 +0900
Subject: [R-pkg-devel] About the CRAN policy on downloading pre-compiled
 binary
In-Reply-To: <59d6931a-3326-c20a-fb60-0f7a6a9cbcb6@gmail.com>
References: <b97a6d91-ad00-413f-14f4-e78a0c0e6d1e@stats.ox.ac.uk>
 <CALyqOb_+E=EMg8w0wmBaB8=1by3SyBcBbrAC6KVd4PTygQT=3g@mail.gmail.com>
 <22bf93a2-0abc-24e2-da24-ca1a219e4913@gmail.com>
 <59d6931a-3326-c20a-fb60-0f7a6a9cbcb6@gmail.com>
Message-ID: <CALyqOb_v2_rkfFpNjUZbYokhqg1YWFdfjFh9TPGGgJGvSyZOFg@mail.gmail.com>

Hi,

Thank you so much Tomas for helping me to figure out the things. Let me
share some updates (some of them are what you've seen already in the reply
to the CRAN maintainer) in case this might be eventually useful to those
who are curious about using Rust on CRAN.

First of all, let me correct my misunderstanding. I thought what violates
the CRAN policy was that my package downloads a binary, but in actual, it
seems my fault was

    1. if the compiler exists, my package downloads the **sources** of the
dependency, whose authorships are not described.
    2. if the compiler doesn't exist, my package downloads the pre-compiled
binary **without the agreement of the CRAN team**

For point 2, as suggested in the previous comment,

> at least check whether the compiler is present (during package
installation), and use it if it is.

my package first checks if Cargo, Rust's compiler toolchain and package
manager, is installed (more specifically, whether the `cargo` command can
be found on PATH), and falls back to downloading the pre-compiled binary
only when Cargo is not available. So, I believe this can be considered as
"a last resort". Again, it was clearly my fault that I didn't ask the CRAN
maintainers for permission on my first submission.

However, it seems Cargo is already available on the following CRAN machines:

    - Linux machines
    - Windows Server 2022 (at least on winbuilder. Thanks David B. Dahl for
the information!)
    - M1 macOS machine (guessed from the comment from the CRAN maintainer)

If I remember correctly, the Windows machine didn't have Cargo installed
when I submitted my package to CRAN. I'd really appreciate the CRAN
maintainers' effort to improve the infrastructure, and I hope Cargo will be
available on Intel macOS machines in the not so distant future so that I no
longer need to provide the pre-compiled binary (I'm not sure if I can have
the same hope on the Windows 2008, which might be a bit too old to install
some latest-ish version of Cargo, though [2]).


For point 1, it's Cargo that downloads the sources. It does download the
fixed versions recorded in the bundled "Cargo.lock" file, and verifies the
checksum. While Cargo provides the vendoring mechanism [1], I thought it
was not realistic to include the sources because my dependency was so huge
(132MB). But, I was wrong at two points.

First, no matter whether to download or to bundle the sources, the CRAN
Policy requires to describe the copyright information of "all components of
the package," which should refer to all the individual Rust crate in the
context of my package.

>  The ownership of copyright and intellectual property rights of all
components of the package must be clear and unambiguous (including from the
authors specification in the DESCRIPTION file). Where code is copied (or
derived) from the work of others (including from R itself), care must be
taken that any copyright/license statements are preserved and authorship is
not misrepresented.

Second, it was possible to reduce the size to the extent where I can bundle
it. I could tweak some libraries to drop the heavy dependency, and compress
the source code (again, thanks David B. Dahl for the idea).

I'm yet to figure out what's the proper way to list up the authors (I'm
currently using inst/COPYRIGHTS, but I'm not fully sure at the moment), but
I'm working on tweaking my package to bundle all the sources and to clarify
the authorships of these dependencies [2]. I hope this will keep my package
on CRAN.

Best,
Yutani

[1]: https://doc.rust-lang.org/cargo/commands/cargo-vendor.html
[2]: Actually, it keeps failing on Windows Server 2008 with the
pre-compiled binary probably due to lack of some system API:
https://www.r-project.org/nosvn/R.check/r-oldrel-windows-ix86+x86_64/string2path-00check.html
[3]: https://github.com/yutannihilation/string2path/pull/35 (work in
progress)

2022?7?27?(?) 17:12 Tomas Kalibera <tomas.kalibera at gmail.com>:

>
> On 7/27/22 08:08, Tomas Kalibera wrote:
> >
> > On 7/27/22 00:30, Hiroaki Yutani wrote:
> >> Hi,
> >>
> >> Recently I got the following email from the CRAN maintainer about my
> >> package, string2path[1].
> >>
> >> However, I do ensure the binary is the pinned version and verify if the
> >> hash matches with the embedded one in the DESCRIPTION [2][3]. In case
> >> of a
> >> mismatch, the build fails. So, this mechanism should ensure that I (or
> >> anyone) cannot change the version of the binary without actually
> >> resubmitting to CRAN.
> >
> > Please see the policy cited. Ensuring that the download is of a fixed
> > version refers to the sources (which can be downloaded under the
> > conditions mentioned).
> >
> > Downloading binaries are only a last resort option and requires the
> > agreement of the CRAN team in the first place.
> >
> >> I believe this complies with the CRAN policy (except for not clearing
> >> the
> >> authorship and copyright). Is there anything I have to address to
> >> prove I
> >> do "ensure that the download is of a fixed version"? Any suggestions are
> >> welcome.
> >
> > My understanding from your email is you are ensuring a fixed version
> > download, and with most projects you could probably do even less
> > (simply hardcode a URL which includes a specific version of the
> > sources if that is stable for the project), but you are not
> > downloading sources.
>
> I take back the comment about doing less to ensure a fixed version - it
> is good to use a hash always when having to download sources, as
> software distributions do (of course including MXE and Msys2, so Rtools
> on Windows, etc). It is better as a guard against that the content is in
> fact not stable for the project (I've been told it sometimes happens and
> may be surprising to package authors), but of course also for security
> reasons.
>
> Tomas
> >
> > In either case, of course if there is anything unclear in an email
> > from CRAN, you can simply respond to that and ask.
> >
> > Best
> > Tomas
> >
> >>
> >> The CRAN policy stipulates
> >>> "Where a package wishes to make use of a library not written solely for
> >>> the package, the package installation should first look to see if it is
> >>> already installed and if so is of a suitable version. In case not,
> >>> it is
> >>> desirable to include the library sources in the package and compile
> >>> them
> >>> as part of package installation. If the sources are too large, it is
> >>> acceptable to download them as part of installation, but do ensure that
> >>> the download is of a fixed version rather than the latest. Only as a
> >>> last resort and with the agreement of the CRAN team should a package
> >>> download pre-compiled software."
> >>>
> >>> and we have recently seen an instance of a rust-using package whose
> >>> check output changed because what it downloaded had changed. CRAN
> >>> checking is not set up for that (for example, macOS checks are done
> >>> once
> >>> only for each version).
> >>>
> >>> Whilst investigating, the Windows' maintainers found that binary libs
> >>> were being downloaded.  And subsequently I found that salso,
> >>> string2path
> >>> and ymd are downloading compiled code on Intel macOS.
> >>>
> >>> Also. make sure that the authorship and copyright of code you download
> >>> (and hence include in the package) is clear from the DESCRIPTION file.
> >>> as required by the CRAN policy.
> >>>
> >> Best,
> >> Hiroaki Yutani
> >>
> >> [1]: https://cran.r-project.org/package=string2path
> >> [2]:
> >>
> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/DESCRIPTION#L29-L40
> >>
> >> [3]:
> >>
> https://github.com/cran/string2path/blob/46020296410cd78e2021bff86cb6f17c681d13a6/tools/configure.R#L177-L295
> >>
> >>
> >>     [[alternative HTML version deleted]]
> >>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From cdorm @end|ng |rom g@ecc@u-tokyo@@c@jp  Sat Aug  6 23:16:30 2022
From: cdorm @end|ng |rom g@ecc@u-tokyo@@c@jp (Richard Shefferson)
Date: Sun, 7 Aug 2022 06:16:30 +0900
Subject: [R-pkg-devel] cran submission check produces note on news file
Message-ID: <CAD7xazv8Y9uQPaRJeiwyusByCQQJwxtCCwdDFe-5Dc=oghYUdA@mail.gmail.com>

Hi,

I am the creator and maintainer of package lefko3, which creates matrix
projections for use in population ecology. I just submitted a version of
this package to CRAN, and got a Note on the debian check that showed that
it could not process the NEWS file. All other system pretests (including
Windows and MAC) were fine, and my own checks on Mac, Ubuntu, and Windows
had no such issues. I have looked through the CRAN documentation seeing if
there is any formatting issue, but I cannot find any problems. Can anyone
provide any help?

Here is a link to my R Forge site holding the NEWS file itself:

https://r-forge.r-project.org/scm/viewvc.php/pkg/?root=lefko3

The check log from the pretest is here:

https://win-builder.r-project.org/incoming_pretest/lefko3_5.4.1_20220805_235501/Debian/00check.log

The particular Note that appears to have failed CRANs prechecks is the
following:

Flavor: r-devel-linux-x86_64-debian-gcc
Check: package subdirectories, Result: NOTE
  Problems with news in 'NEWS':
    Cannot process chunk/lines:
      CHANGES IN VERSION 5.4.1 (2022-07-29)
        USER-VISIBLE CHANGES
          1. Output to summary_hfv() now fits within screen width.
          2. Exponent tolerance limits and warnings added to functions
projection3()
             and f_projection3(). Warnings and help file notes have also
been added.
    Cannot process chunk/lines:
      CHANGES IN VERSION 5.4.0 (2022-07-21)
        NEW FEATURES
          1. Function actualstage3() has been rewritten in C++ to handle
all stage,
             age-by-stage, and age inputs. Can now remove stages as
necessary, and
             allows different stages to be removed in times t1 and t2 in
historical
             stage pair assessments.
          2. Function hist_null() can now produce historically-formatted
ahistorical
             matrices that do not include impossible transitions.
          3. Anthyllis matrices are now also provided as a new dataset, in
lefkoMat
             format.
        USER-VISIBLE CHANGES
          1. Updates and corrections to help files.
        BUG FIXES
          1. Lathyrus vignettes corrected to account for duplicated
individual
             identity across subpopulations.
          2. Corrected issue in repvalue3() causing warnings in MPMs with
certain rare
             conditions.
          3. Corrected issue in lambda3() causing rare eigen analysis
failure in
             sparse matrices.
          4. Reference matrix warnings in ltre3() have been corrected.
    Cannot process chunk/lines:
      CHANGES IN VERSION 5.3.0 (2022-06-24)
        NEW FEATURES
          1. Function actualstage3() now also outputs proportions of ages
and age-
             stages within hfv datasets.
          2. Function vrm_import() created to allow IPM and other
function-based model
             slope coefficients can now be imported directly without
conducting linear
             model searches through modelsearch().
          3. Functions flefko3(), flefko2(), aflefko2(), fleslie(), and
             f_projection3() have been updated to allow the use of
vrm_input objects,
             allowing slope coefficients to be imported directly.
          4. Function hfv_qc() developed to test hfv datasets for quality
control
             using the same parameterizations and subsetting strategies
used in
             function modelsearch().
        USER-VISIBLE CHANGES
          1. Function create_pm() can now yield paramnames objects with
default
             model variable names used instead of "none" strings.
          2. Vignettes updated with new functions. Particularly, material
for
             sf_distrib() replaced with material for hfv_qc().
          3. Tweaks and corrections to help files.
        BUG FIXES
          1. Fixed bug causing substochasticity setting 2 in functions
projection3()
             and f_projection3() to yield negative survival probabilities
under some
             circumstances in which survival column sums totaled more than
1.0.
          2. Fix bug omitting substochasticity correction in fecundity
under some
             conditions when function f_projection3() is run with substoch
= 2.
    Cannot process chunk/lines:
      CHANGES IN VERSION 5.2.0 (2022-05-18)
        NEW FEATURES
          1. Function f_projection3() can now run density dependent
projections in
             which the vital rates used are modified by projected density.
          2. Function density_vr() created to provide vital rate density
dependence
             information for function f_projection3().
          3. Option added to functions projection3() and f_projection3() to
suppress
             warnings.
          4. Function summary.lefkoProj() now has an option to interpret
NaN values as
             positive infinity, changing the count of replicates still
alive in the
             milepost section. This option, inf_alive, may also be set to
FALSE to
             count NaNs as evidence of extinction.
          5. A new summary_hfv() function has been created to simplify
quality
             control checks on historical vertical format datasets.
          6. Function verticalize3() now warns the user to check the
resulting dataset
             if the dataset is censored and the blocksize option is used
without
             the censorRepeat option being set to TRUE, as these cases may
result in
             excessive data pruning.
          7. Function summary.lefkoProj() now calculates mean extinction
time when
             prompted.
        USER-VISIBLE CHANGES
          1. Function modelsearch() now allows an "age" setting for the
suite option,
             which yields the same results as "cons" but checks to make
sure that an
             age variable is properly added.
          2. Function modelsearch() now allows a "leslie" setting for the
vitalrates
             option, which provides a shorthand for c("surv", "fec") as
would be used
             by fleslie().
          3. The documentation for functions modelsearch() and fleslie()
have been
             updated to provide more information for handling Leslie MPMs.
          4. Added series of new error messages if expected data frame size
input in
             verticalize3() is too large.
          5. Vignettes have been updated with new functions.
          6. Some error messages made more informative.
        BUG FIXES
          1. The stageframe developed with functions rleslie() and
fleslie() has been
             fixed to include stage_id, alive, and almost_born variables,
allowing
             Leslie-formatted lefkoMat objects to be passed to all lefko3
functions
             analyzing them, including lmean().
          2. Fixed bug yielding vector leaks from other variables when
using the
             blocksize feature in verticalize3().
          3. Fixed incorrect fecundity summation in rlefko3(), resulting
from
             miscounting offspring from individuals dying the transition in
which they
             reproduced.
    Cannot process chunk/lines:
      CHANGES IN VERSION 5.1.0 (2022-04-01)
        NEW FEATURES
          1. Added ability to run ordered annual matrix progressions in
function
             projection3().
          2. Function projection3() can now run arithmetic mean matrix
projections
             without any modifications required to the input lefkoMat
object.
          3. Function plot.lefkoProj() now has an auto-title feature.
        USER-VISIBLE CHANGES
          1. Added cancel handling to verticalize3(), historicalize3(),
slambda3(),
             sensitivity3(), elasticity3(), and ltre3().
          2. Added transitions to some supplemental() in function examples
and
             vignettes, reflecting more exact transition specification.
        BUG FIXES
          1. Fixed incorrect substochastic correction in projection3() and
             f_projection3() when substoch = 2 and negative survival
entries occur.
          2. Cleaned up minor memory issues in some functions.
          3. Corrected class lefkoProj structure output by function
f_projection3()
             to correspond exactly to that produced by function
projection3().
          4. Fixed bug preventing proxy multipliers from being properly
integrated in
             function-based and raw MPMs.
          5. Corrected issue in which truncated distributions occasionally
led to NA
             size probabilities when the probability of a 0 under the
un-truncated
             distribution was sufficiently high.
    Cannot process chunk/lines:
      CHANGES IN VERSION 5.0.1 (2022-03-08)
        USER-VISIBLE CHANGES
          1. Updated help files for projection functions.
        BUG FIXES
          1. Updated primitive class checks in some functions.
    Cannot process chunk/lines:
      CHANGES IN VERSION 5.0.0 (2022-03-01)
        NEW FEATURES
          1. New function arlefko2() created to handle raw age-by-stage MPM
             estimation.
          2. Function aflefko2() now fixes the starting age by whether the
life
             history model is pre-breeding or post-breeding.
          3. Functions verticalize3() and historicalize3() now handle age
offsets and
             automatically offset age by 1 if set to prebreeding = TRUE.
          4. Further output has been added when err_check = TRUE is set in
all
             function-based matrix estimators.
          5. New function f_projection3() runs MPM and IPM projections in
which
             matrices are developed from vital rate models at each step.
        USER-VISIBLE CHANGES
          1. Default final_age in function aflefko2() is now the final age
at time t
             in the original dataset.
          2. All function-based matrix estimators have been sped up.
          3. Population dynamics functions have been sped up.
          4. All population dynamics functions involving actual projection
can now be
             cancelled during runs.
          5. Function create_lM() now produces a properly edited stageframe
usable
             with all other functions taking lefkoMat objects as input.
        BUG FIXES
          1. Function plot.lefkoProj() now uses the correct default axis
labels when
             conducting a state-space plot.
          2. Function hist_null() now correctly estimates the numbers of
survival and
             fecundity elements.
          3. Eliminated bug in functions flefko3(), flefko2(), and
aflefko2()
             preventing incorporation of random year effects into matrix
estimation.
          4. Eliminated bug causing inflation of lambda under some
instances of the
             Poisson distribution in function-based matrix estimation.
          5. Fixed erroneous mixing of QC information in lmean() output.
          6. Fixed issue preventing multiple replicates from being
displayed in
             plot.lefkoProj under the timeseries option.
          7. Fixed issue causing certain impossible transitions linked to
the
             prior stage to be estimated as non-zero in deVries-format
function-based
             hMPMs.
          8. Fixed incorrect formatting of deVries hMPMs resulting from
function
             hist_null().
          9. Function create_pm() updated to handle maturity status models.
    Cannot process chunk/lines:
      CHANGES IN VERSION 4.2.0 (2022-01-17)
        NEW FEATURES
          1. Functions rleslie() and fleslie() created to estimate raw and
             function-based Leslie MPMs, respectively.
          2. Added a beta term setting K as hard maximum in the logistic
function
             using functions density_input() and projection3().
          3. Accuracy check added to size and fecundity models in
modelsearch().
          4. Function modelsearch() new runs exhaustive model selection
under the
             `suite = "cons"` setting if age, density, or any individual
covariate is
             added to the analysis.
          5. Function modelsearch() now performs accuracy checks by
default, and
             allows an opt-out.
          6. Function actualstage3() now removes stages if wished,
including stage
             NotAlive be default.
          7. New plot.lefkoProj() function added.
          8. All function-based matrix estimators now incorporate a default
method
             for continuous distributions using cumulative density
functions to
             estimate size transition probabilities. The midpoint rule is
now only an
             option (and not advised).
          9. New standalone density dependence functions ricker3(),
beverton3(),
             usher3(), and logistic3() added.
          10. Substochasticity options for projection3() now include the
option to
              force fecundity to stay non-negative.
          11. Function projection3() now issues warnings if density
dependence yields
              matrix impossible matrix values.
          12. Function modelsearch() now also estimates maturity status
probability in
              juveniles.
          13. Functions supplemental(), density_input(), and start_input()
now also
              include automated handling of keywords "obs" and "nobs",
which specify
              the use of all observable or unobservable stages,
respectively.
        USER-VISIBLE CHANGES
          1. Functions rlefko2() and rlefko3() now provide warnings if
individual
             identity variable name or column number is not provided.
          2. Function summary.lefkoMat() now provides appropriate
descriptions of
             data quality control sections with missing values.
          3. Added spatial coordinates to cypdata and cypvert.
          4. Function modelsearch() is now more flexible with input errors
in some
             key settings.
          5. Ended dependence on package stringr.
          6. Expanded data frame output with actualstage3() to give
individual stage
             designations in times t and t-1.
          7. Function summary.lefkoMat() now yields warnings if any
fecundity matrix
             contains a negative value, and if any matrix contains an NA
value.
          8. Added equations in key help files.
          9. Corrections and updates to all vignettes.
          10. Function modelsearch() now tries several more
parameterizations if the
              global model fails.
          11. Function lmean() now also incorporates modelqc and dataqc
elements for
              quality control purposes.
          12. Function aflefko2() now treats missing minimum ages as
zeroes, allowing
              estimation even when age info is missing from stageframes.
        BUG FIXES
          1. Matrix quality control summaries corrected when functions
add_lM(),
             delete_lM(), and subset_lM() are used.
          2. Corrected errors in documentation regatding censoring
variables used in
             rlefko3() and rlefko2().
          3. Corrected issue yielding fatal error in historicalize3() when
spatial
             coordinates are set and reduce = TRUE.
          4. Corrected improper matrix formatting in some integer variables
used in
             historicalize3().
          5. Fixed bug ignoring coordsRepeat setting in verticalize3().
          6. Fixed bug causing inconsistent coordinate assignment under
unobserved
             stages in historicalize3().
          7. Corrected bug capable of causing the logistic function to
yield negative
             matrix elements.
          8. Fixed improper handling of numeric entries for year and patch
options in
             function modelsearch().
          9. Corrected issue in flefko3(), flefko2(), and aflefko2()
affecting the
             incorporation of zero-inflated Poisson and negative binomial
models.
          10. Fixed fecundity estimation issue arising in some
circumstances with
              deVries-formatted historical models.
          11. Fixed bug leading size of 0 to be treated as zero-inflated in
Poisson
              and negative binomial models.
          12. Added tolerance limit to binomial probability estimation in
all
              function-based matrix estimators, to prevent some conditions
yielding
              NA probabilities.
          13. Eliminated bug causing rare error in formulae creation in
modelsearch().
          14. Eliminated bug causing unrealistic pseudo-R^2 in rare runs of
              modelsearch().
          15. Eliminated fatal error in modelsearch() occurring under rare
instances
              when all attempts to build a working global model fail.
          16. Fixed bug incorrectly importing non-standard variable names
into
              modelsearch().
          17. Fixed error causing density dependent projections under large,
              historical MPMs in projection3() to issue substochasticity
warnings
              continuously regardless of actual substochasticity violation.
    Cannot process chunk/lines:
      CHANGES IN VERSION 4.1.1 (2021-12-07)
        BUG FIXES
          1. Fixed C++ runtime error in function hist_null().
    Cannot process chunk/lines:
      CHANGES IN VERSION 4.1.0 (2021-12-06)
        NEW FEATURES
          1. Included option to ignore observation status during stage
assignment in
             verticalize3() and historicalize3().
          2. Included option to quiet all warnings in verticalize3() and
             historicalize3().
          3. New options to prevent display of overdispersion and
zero-inflation tests
             in sf_distrib().
          4. Added hist_null() function to create historically-structured
MPM to serve
             as a null model MPM assuming no individual history.
          5. Created function diff_lM() that creates lefkoDiff objects,
which are
             MPM style objects that are actually matrix differences between
             two lefkoMat objects with equivalent dimensions.
          6. Added cond_diff() function to create conditional difference
matrices
             from supplied lefkoDiff objects.
          7. Created actualstage3() function to calculate actual stage
frequencies and
             proportions from input hfv dataset.
          8. Created create_pm() function to create a skeleton paramnames
object for
             users building vital rate models manually.
        USER-VISIBLE CHANGES
          1. Introduced an integer check in function sf_distrib() that
stops tests on
             non-integer variables.
          2. All vignettes have been updated to the latest functions and
results.
        BUG FIXES
          1. Fixed incorrect time step calculation in summary.lefkoMat().
          2. Fixed incorrect P values for zero-inflation when fewer than
expected 0s
             found in sf_distrib().
          3. Fixed fatal issue affecting certain kinds of proxy transitions
in
             function-based matrix estimation.
          4. Fixed incorrect stage distribution calculation in stochastic
             stablestage3() and projection3().
          5. Fixed fatal error in summary.lefkoProj() that occurred when
summarizing
             projections with single replicates.
          6. Fixed fatal errors in flefko2(), flefko3(), aflefko2(), and
             summary.lefkoMat() relating to the use of user-defined vital
rate
             functions.
          7. Corrected incorrect assignment of stages in flefko3(),
flefko2(), and
             aflefko2() based on use of groups in supplement tables.
    Cannot process chunk/lines:
      CHANGES IN VERSION 4.0.1 (2021-11-15)
        BUG FIXES
          1. Function aflefko2() now properly removes agestages rows when
             reduce = TRUE.
          2. Problems with mathjaxr integration fixed.
    Cannot process chunk/lines:
      CHANGES IN VERSION 4.0.0 (2021-11-14)
        NEW FEATURES
          1. Function projection3() can now run density dependent
projections using
             the Ricker, Beverton-Holt, Usher, and logistic functions.
          2. Functions start_input() and density_input() have been created
to describe
             starting vectors and density dependence in the simplest format
possible.
          3. Function modelsearch() now also calculates the accuracy of
binomial
             models and adds the output to the QC section of the output.
Function
             summary.lefkoMod() reports this output.
          4. Function sf_create() now handles dual- and triple-size
classification
          5. Functions sf_create() and supplemental() now handle the
designation of
             core stage groups.
          6. Functions verticalize3() and historicalize3() now handle dual-
and
             triple-size metric classification.
          7. Function modelsearch() can now test the impacts of three
different size
             variables, and can also develop vital rate models for up to
three
             separate response size variables.
          8. Function modelsearch() can now test the impacts of spatial
density and
             stage group.
          9. Function modelsearch() now allows individual covariates to be
             incorporated as random categorical variables, as well as fixed
             continuous quantitative variables.
          10. Function modelsearch() now also allows the Gamma distribution
for size
              and fecundity.
          11. Function flefko2() now handles up to three size metrics,
stage groups,
              random categorical variables, and density.
          12. Function sf_distrib() now handles up to three size metrics,
and also
              handles fecundity estimation in both times t and t+1.
          13. Function projection3() now allows two forms of enforced
              substochasticity. The first keeps all survival-transition
probabilities
              within bounds, while the second keeps all stage survival
probabilities
              within bounds.
        USER-VISIBLE CHANGES
          1. Function projection3() now creates easier-to-understand output
structures
             clearly dividing numbers of individuals from stage
distributions from
             reproductive values and population sizes.
          2. Function supplemental() now takes proxy multipliers, and gives
errors for
             negative given rates and multipliers.
          3. Corrected some figure dimensions in vignettes.
          4. Corrected help text for some functions.
          5. Functions sf_distrib(), summary.lefkoMat(),
summary.lefkoCondMat(),
             summary.lefkoMod(), and image3() no longer return a NULL to
the console.
          6. The default for option censorRepeat in function verticalize3()
has been
             changed to FALSE, in order to prevent overzealous censoring by
default.
          7. Text output from summary functions and sf_distrib() has been
altered to
             fit within standard output consoles, including typical page
widths.
          8. Added sparse matrix override to slambda3() in case of errors
incurred in
             eigen analysis.
        BUG FIXES
          1. Corrected bug causing code "npr" to yield propagule stages in
time t+1
             in supplement and overwrite tables.
          2. Fixed issue preventing estimation of size transition into
observable
             classes with size 0 under the Poisson distribution in
flefko3() and
             flefko2().
          3. Corrected porous stage assignment handling in historicalize3().
          4. Eliminated incorrect projection set assignment when running
multiple
             patches or populations through function projection3().
          5. Eliminated bug giving warnings when running rlefko2() and
rlefko3() with
             specific choices of patches or populations given as input
options.
          6. Fixed issue causing rlefko2() and rlefko3() to estimate only
some
             transition-survival probabilities and fecundities when
patchcol or popcol
             is given without any respective specific patch or pop options
given.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.8.0 (2021-09-08)
        NEW FEATURES
          1. Function projection3() now includes the ability to produce
replicate
             simulations.
          2. Function summary.lefkoProj() created to summarize the results
of
             population projection using function projection3().
          3. Functions verticalize3() and historicalize3() now handle true
radial
             density estimation, if X and Y coordinates and a valid spacing
threshold
             are supplied.
          4. Functions add_lM() and delete_lM() added to add and delete
matrices from
             lefkoMat objects.
          5. Function subset_lM() added to create new lefkoMat objects as
subsets of
             other lefkoMat objects.
        USER-VISIBLE CHANGES
          1. Sensitivity and elasticity descriptions corrected in vignettes.
          2. Increased consistency in terminology used in output for
stablestage3()
             and repvalue3().
          3. Function create_lM() now handles age-by-stage matrices.
        BUG FIXES
          1. Fixed issue that could lead rlefko2() and rlefko3() to stop
processing
             matrices if specific years or patches are called.
          2. Fixed issue affecting stochastic reproductive value estimation
in
             historical lefkoMat objects.
          3. Fixed issue affecting some deterministic reproductive value
estimates,
             particularly in large historical MPMs, where a base reference
value for
             standardization cannot be determined.
          4. Fixed issue preventing proper handling of historical matrix
inputs in
             create_lM().
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.7.0 (2021-08-18)
        NEW FEATURES
          1. Function ltre3() developed to conduct deterministic and
stochastic life
             table response experiments.
          2. Function create_lM() developed to allow the incorporation of
lists of
             matrices developed outside of package lefko3.
          3. Function summary.lefkoLTRE() developed to quickly summarize
LTRE
             contributions according to transition type.
          4. Added new vignette to showcase LTRE and sLTRE analysis, and
the import of
             matrices as lefkoMat objects.
        USER-VISIBLE CHANGES
          1. Altered some terminology in help files and vignettes to
reflect most
             recent best practice in population ecology. Updated vignettes
with new
             information, particularly related to LTRE and sLTRE analysis.
          2. Option append_mats has been added to sensitivity3.lefkoMat(),
             sensitivity3.list(), elasticity3.lefkoMat(), and
elasticity3.list(). This
             option allows users to prevent the incorporation of the
original matrices
             into output lefkoSens and lefkoElas objects, resulting in
lower memory
             usage.
          3. Function summary.lefkoElas() can now handle age-by-stage MPMs.
          4. Corrected problematic Cypripedium examples involving the
construction of
             matrices with stage survival probabilities rising above 1.0.
        BUG FIXES
          1. Fixed indexing bug in function summary.lefkoElas() that had
led to
             incorrect elasticity summation.
          2. Fixed memory leak affecting sparse matrices in projection3()
and related
             functions.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.6.0 (2021-07-21)
        NEW FEATURES
          1. Automatic sparse matrix detection and override options have
been added to
             all population dynamics functions.
        USER-VISIBLE CHANGES
          1. All population dynamics analysis functions have been
substantially sped
             up through better memory management techniques.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.5.3 (2021-07-14)
        NEW FEATURES
          1. Function summary.lefkoMat() now also displays column sums from
all
             U (survival-transition) matrices as a quality control check.
        USER-VISIBLE CHANGES
          1. Package glmmTMB has been reintegrated, allowing mixed modeling
of
             negative binomial, zero-inflated, and zero-truncated response
             distributions again.
          2. Error and warning messages from compiled functions provide
cleaner
             messages.
        BUG FIXES
          1. Corrected incorrect handling of missing patch terms in lm,
glm, vglm, and
             zeroinfl objects.
          2. Corrected static_cast issue that might prevent package
installation in
             Solaris systems.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.5.2 (2021-07-12)
        USER-VISIBLE CHANGES
          1. Negative binomial response, zero-truncated, and zero-inflated
             have been temporarily disabled in function modelsearch() while
package
             glmmTMB() is being reprogrammed for compatibility with R
4.1.0. These
             distributions are still available through the glm approach.
          2. Examples have been updated for clarity and consistency.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.5.1 (2021-07-07)
        NEW FEATURES
          1. Function supplemental() now allows entry stage proxies to be
marked for
             raw historical MPMs.
          2. Shortcuts included covering non-propagule stages and
non-reproductive
             mature stages for functions overwrite() and supplemental().
        USER-VISIBLE CHANGES
          1. Updated Lathyrus vignettes to correct improper handling of
entry stages.
          2. Negative binomial response in mixed modeling has been moved to
package
             lme4, and zero-truncated and zero-inflated distributions are
available
             only through the glm approach in modelsearch() for the time
being.
        BUG FIXES
          1. Corrected improper handling of prior forms of entry stages in
raw
             historical MPMs.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.5.0 (2021-06-29)
        NEW FEATURES
          1. Historical MPM estimating functions can now estimate hMPMs in
deVries
             format, in which newborns have an unique prior stage. All
population
             dynamics functions have also been reworked to handle this
format.
          2. New output has been added showing the exact order of age-stage
             combinations across all rows in estimated age-by-stage MPMs,
as output
             from function aflefko2().
          3. Stochastic sensitivities of historical MPMs now yield
ahistorical
             equivalents in all output.
          4. Added manual designation of ahistorical vs. historical output
in
             functions sensitivity3.list() and elasticity3.list().
        USER-VISIBLE CHANGES
          1. Function modelsearch() can now handle invariant response terms.
          2. Functions flefko3() and flefko2() can now handle invariant
fecundity.
          3. Function verticalize3() can now handle horizontal datasets
without clear
             patterns in order.
          4. Amended overwrite() and supplemental() functions to account
for possible
             prior newborn stage in deVries formatted hMPMs.
          5. Function supplemental() now details stage names not accounted
for in the
             input stageframe in error messages.
          6. Some error and warning messages have been clarified for better
             understanding.
          7. Many examples have been expanded to include extra conditions.
        BUG FIXES
          1. Function rlefko3() now handles dimension reduction properly.
          2. Function cond_hmpm() now produces conditional matrices from all
             combinations of population, subpopulation, and year, and also
properly
             labels them.
          3. Typos and other issues corrected in vignettes.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.4.0 (2021-03-31)
        NEW FEATURES
          1. Zero-truncated Poisson and negative binomial distributions
have been
             added to function modelsearch(), and as underlying size and
fecundity
             distributions in flefko3(), flefko2(), and aflefko2().
          2. New function image3() created to easily create matrix images
for lefkoMat
             and other objects. Function acts as a wrapper for the image()
function in
             package SparseM.
          3. New vignette showcasing the estimation and analysis of age x
stage MPMs.
        USER-VISIBLE CHANGES
          1. Added err_check option to function-based matrix estimators,
allowing the
             output of vital rates used in the estimation of U matrices.
          2. The test used to assess overdispersion in size and fecundity
has been
             changed to deal more accurately with count-based variance
(including
             tests performed and how data are subsetted), and to offer more
choices in
             which tests to run.
          3. Function modelsearch() has been rewritten to result in a
smaller
             installed package size.
          4. Function parasearch() has been removed pending revision of
modeling
             methodology.
          5. Reproductive value vectors are now all standardized to the
first non-zero
             value in the vector.
          6. Function sf_create() can now handle stage comments as input.
          7. Functions sensitivity3() and elasticity3() have been
redesigned for
             increased speed with unusually large matrices.
          8. Stochastic analysis functions have been streamlined for speed
and
             efficiency.
          9. Expanded all examples to include both Lathyrus and Cypripedium
versions.
          10. Corrections and expansions to package vignettes.
        BUG FIXES
          1. Fixed issue in which loss of one of the year or patch terms in
modeling
             of zero-inflated mixed models could lead to errors in
function-based
             matrix estimation.
          2. Corrected error in estimation algorithm for size transition
probability
             under negative binomial distribution, and difficulty in
handling low
             levels of overdispersion in some negative binomial models.
          3. Fixed issue making lmean() unable to take element-wise mean
matrices of
             age x stage MPMs produced using aflefko2().
          4. Fixed bug yielding erroneous reproductive values in historical
matrices.
          5. Fixed bug yielding erroneous sensitivity elements in
historically-
             corrected ahistorical sensitivity matrices.
          6. Fixed bug occasionally yielding 3d arrays in response to
stochastic
             calls of sensitivity3() and elasticity3().
          7. Corrected stablestage3() and repvalue3() to properly handle
age x stage
             MPMs.
          8. Corrected memory leak issue in aflefko2().
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.3.2 (2021-02-25)
        BUG FIXES
          1. Fixed Imports field related to function parasearch().
          2. Fixed loss of fecundity placement in age-by-stage matrices
when using
             function supplemental() with function aflefko2().
          3. Fixed default year and patch settings in aflefko2().
          4. Corrected memory allocation issue in historicalize3().
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.3.1 (2021-02-23)
        USER-VISIBLE CHANGES
          1. Corrections to vignettes.
          2. Help file typos fixed.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.3.0 (2021-02-21)
        NEW FEATURES
          1. Function supplemental() created to allow greater flexibility
in the input
             of reproductive multipliers. All matrix creation functions can
now handle
             its output.
          2. Stochastic sensitivity and elasticity analyses now enabled
through
             functions sensitivity3() and elasticity3(), respectively.
          3. Functions sensitivity3() and elasticity3() now handle simple
lists of A
             matrices, in addition to lefkoMat objects and simple matrices.
          4. Function parasearch() created to allow parallelized model
building and
             selection.
        USER-VISIBLE CHANGES
          1. Censoring options in verticalize3() and historicalize3() can
now handle
             both static and temporally-variable censor variables.
          2. Overwrite and supplemental tables can now include "prop",
"immat", and
             "mat" as shorthand for suites of all propagule, immature, and
mature
             stages.
          3. Function modelsearch() now gives warning if a dataset is used
with NAs in
             individual ID when a mixed modeling approach is requested. It
now also
             provides standard diagnostic messages at each step.
          4. Corrections and additions to help files.
        BUG FIXES
          1. Fixed censoring protocols in verticalize3(), historicalize3()
rlefko3(),
             and rlefko2().
          2. Corrected distribtution algorithm for zero inflation and text
output in
             sf_distrib().
          3. Eliminated bug causing high overdispersion parameters from
negative
             binomial-based size models to yield function-based matrices
with NA
             values for all transitions to stages with positive size.
          4. Fixed issue in which mixed models with a non-zero-inflated
negative
             binomial distribution fails to estimate function-based
martrices.
          5. Fixed compatibility issues in matrix creation functions with R
3.6.3.
          6. Fixed minor issue in summary.lefkoMat output text.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.2.0 (2021-01-03)
        NEW FEATURES
          1. Function cond_hmpm() added to create conditional hMPMs.
          2. Function slambda3() added to estimate the log stochastic
growth rate.
          3. Function summary.lefkoElas() added to summarize elasticities
by kind of
             transition.
          4. Added citation() data for package.
          5. Added NEWS section, using package lme4 NEWS as a template.
        USER-VISIBLE CHANGES
          1. Corrected inconsistent stage name variable in stage frame
creation and
             manipulation functions.
          2. Updated and reorganized vignettes.
          3. Modified stageframes exported by matrix creation functions now
include
             entry status variable.
          4. Objects of class lefkoElas now include the original A, U, and
F matrices.
          5. Elasticity and sensitivity outputs for lefkoMat objects now
include the
             original A, U, and F matrices used as input.
        BUG FIXES
          1. Matrix estimation function now create loy tables treating pop
and patch
             as strings by default, eliminating possible conversion errors.
          2. Corrected incorrect overwrite() call in lathyrus example used
in function
             flefko3() and all population dynamics analysis functions.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.1.2 (2020-11-16)
        BUG FIXES
          1. Corrected auto-conversion of characters to factors occurring
on R 3.6.3,
             which affected the creation and interpretation of the $labels
element in
             matrix estimation.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.1.1 (2020-11-13)
        BUG FIXES
          1. Fixed bug in lmean() function resulting from an implicit cast
and
             affecting users operating lefko3 on Solaris systems.
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.1.0 (2020-11-08)
        NEW FEATURES
          1. Added function sfdistrib() to test whether mean = var and the
level of
             zero-inflation in count variable data to be used for size and
fecundity.
          2. Added zero-inflated Poisson and negative binomial
distributions as
             choices for the underlying distribution of size and fecundity.
          3. Added individual and environmental covariates to function-based
             MPM estimation functions.
        USER-VISIBLE CHANGES
          1. Corrected, updated, and reorganized vignettes.
        BUG FIXES
          1. Corrected parameterization of negative binomial distribution in
              function modelsarch().
    Cannot process chunk/lines:
      CHANGES IN VERSION 3.0.0 (2020-10-22)
        NEW FEATURES
          1. Added function aflefko2() function to estimate age x stage
MPMs.
          2. Added function sensitivity3() to estimate sensitivity matrices
of
             historical and ahistorical MPMs.
          3. Added Function elasticity3() to estimate elasticity matrices of
             historical and ahistorical MPMs.
        USER-VISIBLE CHANGES
          1. Increased consistency of output variable names across
functions.
          2. Corrected, updated, and reorganized vignettes.
          3. Eliminated faulty parameterization of matrix geometric mean in
lmean()
             function.
        BUG FIXES
          1. Corrected core kernel underlying lmean(), and redeveloped in
C++ to yield
             faster results.
          2. Corrected parameterization of negative binomial distribution.
          3. Function summary.lefkoMat() now shows which vital rate models
were not
             estimated.
    Cannot process chunk/lines:
      CHANGES IN VERSION 2.4.2 (2020-09-12)
        USER-VISIBLE CHANGES
          1. All matrix estimators sped up through lapply()-based calls to
C++
             kernels.
          2. Function lmean() now keeps the original names of populations
and patches.
          3. Corrected incorrect reference links in vignettes.
        BUG FIXES
          1. Fixed memory leak in kernel behind function historicalize3().
          2. Fixed faulty indexing affecting all matrix estimators under
certain
             conditions.
          3. Bugs in Cypripedium candidum vignettes and examples caused by
incomplete
             overwrite tables fixed.
    Cannot process chunk/lines:
      CHANGES IN VERSION 2.3.0 (2020-08-18)
        USER-VISIBLE CHANGES
          1. Major speed up to flefko2() and flefko3() through the
incorporation of
             C++ core kernels.
        BUG FIXES
          1. Bug fixed that could lead to the erroneous incorporation of
mature
             stages as immature in flefko3() under certain rare
circumstances.
          2. Bug fixed that could fit proxy rates into the wrong elements
in all
             matrix construction under certain rare circumstances.
          3. Bug fixed that could, under some circumstances, lead to
individuals
             being treated as dead when not observed for a period of more
than a year.
    Cannot process chunk/lines:
      CHANGES IN VERSION 2.2.2 (2020-07-28)
        USER-VISIBLE CHANGES
          1. Revised vignettes.
          2. Improved default handling of reproductive ratio and fecundity
ratio.
        BUG FIXES
          1. Fixed calculation of observed lifespan in functions
verticalize3()
             and historicalize3().
    Cannot process chunk/lines:
      CHANGES IN VERSION 2.2.1 (2020-07-18)
        USER-VISIBLE CHANGES
          1. Removed some vignettes to reduce size.
          2. Added greater detail to Metadata in DESCRIPTION file
        BUG FIXES
          1. Added on.exit() to modelsearch() to keep user options through
that
             routine.
          2. Fixed bugs in repvalue3.lefkoMat() and repvalue3.matrix().
    Cannot process chunk/lines:
      CHANGES IN VERSION 2.2.0 (2020-07-08)
        USER-VISIBLE CHANGES
          1. All internal function documentation now complete.
          2. Reduced vignette sizes.
        BUG FIXES
          1. Fixed bugs in summary.lefkoMod().
    Cannot process chunk/lines:
      CHANGES IN VERSION 2.1.0 (2020-07-06)
        NEW FEATURES
          1. Advanced routines developed for deterministic analysis
functions,
             including repvalue3() and stablestage3().
        USER-VISIBLE CHANGES
          1. Cleaned up all help pages.
        BUG FIXES
          1. Scattered bugs eliminated.
    Cannot process chunk/lines:
      CHANGES IN VERSION 2.0.0 (2020-06-27)
        NEW FEATURES
          1. Stageframe objects now have their own class, and stageframes
now handle
             log-size based bin widths.
          2. Sf_create() also now stops if vector lengths are not equal,
and can
             create stageframes for IPMs.
          3. Mean matrix function lmean() created.
          4. Added size in time t to juvenile models.
          5. Fecundity models can now use fecundity in t+1 as a response.
          6. Integrated estimation function into verticalize3() and
historicalize3().
        USER-VISIBLE CHANGES
          1. All matrix creation functions have been fully rewritten for
speed
             (eliminated extraneous find() calls and long loops).
          2. Vignettes split up across chapter files.
        BUG FIXES
          1. Eliminated problems with class interpretation in modelsearch().
    Cannot process chunk/lines:
      CHANGES IN VERSION 1.0.0 (2020-03-24)
        NEW FEATURES
          1. Lathyrus dataset added.
          2. Examples added to all core functions.
        USER-VISIBLE CHANGES
          1. All matrix estimation functions have been rewritten to include
core C++
             functions, for speed up and memory efficiency.
          2. Added patch functionality to modelsearch(), flefko3(), and
flefko2().
        BUG FIXES
          1. Bugs corrected in probability and rate estimation functions.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.13.1 (2020-02-16)
        USER-VISIBLE CHANGES
          1. Reorganized flefko2() around Rcpp functions.
        BUG FIXES
          1. Cleaned up bugs discovered in rlefko3().
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.13.0 (2020-02-14)
        USER-VISIBLE CHANGES
          1. Re-developed core functions of rlefko3() with Rcpp and
RcppArmadillo.
             Functions now run lightning quick.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.12.1 (2020-02-11)
        USER-VISIBLE CHANGES
          1. Re-developed rlefko3() function per new approach to rlefko2().
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.12.0 (2020-02-05)
        NEW FEATURES
          1. Developed rlefko2() function.
        USER-VISIBLE CHANGES
          1. Developed rlefko2() function.
          2. Redesigned all matrix functions to handle different
populations and
             patches.
          3. Made core matrix creators invisible.
          4. Increased standardization of inputs.
          5. Eliminated class lefkoMatMulti.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.11.0 (2020-01-31)
        NEW FEATURES
          1. Created the hfvdata class for standardized, vertical
demographic data
             frames.
          2. Added quality control sections to lefkoMod and lefkoMatMulti
objects,
             including functions that create these objects.
          3. Created new summary.lefkoMatMulti function.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.10.2 (2020-01-29)
        NEW FEATURES
          1. Added negative binomial functionality to vital rate estimators.
        USER-VISIBLE CHANGES
          1. Massive changes and improvements to tutorials.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.10.1 (2020-01-22)
        NEW FEATURES
          1. Added negative binomial functionality to modelsearch().
          2. Added a summary function for class lefkoMod.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.10.0 (2020-01-19)
        NEW FEATURES
          1. Added Cypripedium candidum vignette.
          2. Data mgmt functions can now prune unused variables from output.
        USER-VISIBLE CHANGES
          1. Replaced all flw and frt entries with repst and fec.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.9.0 (2020-01-15)
        NEW FEATURES
          1. Added cypdata.
        USER-VISIBLE CHANGES
          1. Formatted code and help files.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.8.3 (2020-01-11)
        USER-VISIBLE CHANGES
          1. Eliminated year effect warnings by option.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.8.2 (2020-01-10)
        NEW FEATURES
          1. Added the lefkoMatMulti class.
          2. Gave matrix creation functions the ability to create output
with lists of
             A, T, and F matrices for all years requested.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.8.1 (2020-01-10)
        NEW FEATURES
          1. Added greater flexibility to modelsearch() function to allow
it to
             estimate binomial models under constant response.
        USER-VISIBLE CHANGES
          1. Synchronized data management function to modelsearch()
function.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.8.0 (2020-01-01)
        NEW FEATURES
          1. Added modelsearch function to handle model building and
selection workflow.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.7.0 (2019-11-22)
        NEW FEATURES
          1. All workhorse functions are now generally debugged C++
functions.
        BUG FIXES
          1. Fixed overwriting and estimating portions of matrix creation
functions.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.6.1 (2019-11-22)
        BUG FIXES
          1. Fixed overwriting portion of matrix design, so that given
transitions are
             properly added to historical matrices.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.6.0 (2019-11-20)
        NEW FEATURES
          1. Fully rebuilt flefko3 and flefko2 so that fecundity is now
estimated
             using binaries written in C++.
        USER-VISIBLE CHANGES
          1. Matrix design is reworked to make everything faster.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.5.1 (2019-11-19)
        NEW FEATURES
          1. Rebuilt flefko2 to use C++ precompiled probability density
functions.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.5.0 (2019-11-18)
        NEW FEATURES
          1. Rewrote workhorse portions of survival transition estimators as
             precompiled binaries in C++.
          2. Rewrote historical matrix function (flefko3()) to handle
reworked pxy
             functions.
        BUG FIXES
          1. Corrected issues in help files.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.4.4 (2019-11-11)
        NEW FEATURES
          1. Added a patch term to ahv2hv() function.
        USER-VISIBLE CHANGES
          1. Changed plantid variable to individ.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.4.3 (2019-11-08)
        NEW FEATURES
          1. Added density3() function.
        USER-VISIBLE CHANGES
          1. Sped up verticalize3() and ahv2hv() functions.
        BUG FIXES
          1. Corrected links throughout.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.4.2 (2019-11-07)
        NEW FEATURES
          1. Added ability to handle character column names to
verticalize_h().
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.4.1 (2019-11-06)
        BUG FIXES
          1. Corrected issues in verticalize_h function.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.4.0 (2019-11-03)
        NEW FEATURES
          1. Added RSpectra-based population matrix projection analysis
functions.
        USER-VISIBLE CHANGES
          1. Added GPL license.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.3.1 (2019-11-02)
        BUG FIXES
          1. Corrected bug leading to infinite mu values in probbin for
some models.
          2. Corrected the method of using proxy transitions from certain
juvenile
             stages to mature stages in all lefko functions.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.3.0 (2019-11-01)
        USER-VISIBLE CHANGES
          1. Increased ability to choose which unobserved stages lead to
which
            vobserved stages.
          2. Standardized terms in more functions for cross-compatibility
and easier
             workflow.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.2.1 (2019-10-29)
        NEW FEATURES
          1. Added Gaussian probability calculation.
          2. Developed sf_create function.
          3. First version of rlefko3() created.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.1.1 (2019-10-26)
        NEW FEATURES
          1. Matrix creation functions now discriminate size and fecundity
on the
             basis of probability distribution.
        USER-VISIBLE CHANGES
          1. Adds numeric class recognition.
          2. Documentation improvements.
    Cannot process chunk/lines:
      CHANGES IN VERSION 0.1.0 (2019-10-25)
        NEW FEATURES
          1. First development version. Main 2d and 3d matrix functions
created.



-- 
-------------------------------------------------------
Dr. Richard P. Shefferson
Associate Professor
Organization for Programs on Environmental Sciences
Graduate School of Arts and Sciences
University of Tokyo
3-8-1 Komaba
Meguro-ku, Tokyo 153-8902, Japan

???????????? ???
????????????????????
153-8902 ???????? 3-8-1 (?6??209A???

E-mail:cdorm at g.ecc.u-tokyo.ac.jp <cdorm at g.ecc.u-tokyo.ac.jp>
Tel: +81-3-5465-7235
Fax: +81-3-5465-7236

Web: www.sheffersonlab.com
Book on the Evolution of Senescence in the Tree of Life
http://tinyurl.com/SenescenceBook

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Sun Aug  7 15:53:10 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 7 Aug 2022 16:53:10 +0300
Subject: [R-pkg-devel] cran submission check produces note on news file
In-Reply-To: <CAD7xazv8Y9uQPaRJeiwyusByCQQJwxtCCwdDFe-5Dc=oghYUdA@mail.gmail.com>
References: <CAD7xazv8Y9uQPaRJeiwyusByCQQJwxtCCwdDFe-5Dc=oghYUdA@mail.gmail.com>
Message-ID: <20220807165310.57c08a61@trisector>

On Sun, 7 Aug 2022 06:16:30 +0900
Richard Shefferson <cdorm at g.ecc.u-tokyo.ac.jp> wrote:

> I just submitted a version of this package to CRAN, and got a Note on
> the debian check that showed that it could not process the NEWS file.
> All other system pretests (including Windows and MAC) were fine, and
> my own checks on Mac, Ubuntu, and Windows had no such issues. 

I seem to be able to reproduce the errors by setting options(verbose
= TRUE) and then trying to parse the NEWS file with
tools:::.news_reader_default('https://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/NEWS?revision=95&root=lefko3').
(It's not a documented entry point, but it's what gets called to read
the news database for your package.)

A plain text NEWS file is supposed to follow a format described in
?news. Your NEWS file looks like Markdown; in fact,
tools:::.build_news_db_from_package_NEWS_md('https://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/NEWS?revision=95&root=lefko3')
parses it without producing error messages (so renaming NEWS into
NEWS.md could work around your immediate problems), but the result
doesn't look well: each numbered list is collapsed into a single
paragraph. Try separating the subsections (e.g. "NEW FEATURES" and
"USER-VISIBLE CHANGES") into separate Markdown paragraphs with
double-newlines and following other recommendations for Markdown news
files in ?news.

-- 
Best regards,
Ivan


From rhe|p @end|ng |rom eoo@@dd@@n|  Mon Aug  8 15:10:37 2022
From: rhe|p @end|ng |rom eoo@@dd@@n| (Jan van der Laan)
Date: Mon, 8 Aug 2022 15:10:37 +0200
Subject: [R-pkg-devel] Using function with same name as argument as default
 argument
Message-ID: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>

Not sure if this belongs on r-help or r-package-devel; decided for the 
latter as the question is mainly relevant when writing code to be used 
by others.

The issue I run into is that I want to write a function similar to:


foo <- function(x, schema = schema(x)) {
   if (is.null(schema)) stop("schema missing")
   # ...
}

with 'schema()' something like (strongly simplified):

schema <- function(x) attr(x, "schema")


However using both the argument schema and calling the schema() function 
in one of the default arguments is not allowed ans results in the 
following somewhat cryptic error message:

Error in foo(1:3) :
   promise already under evaluation: recursive default argument 
reference or earlier problems?

I am looking for a clean solution to this. I can rename the argument or 
function, but calling it something other than schema feels impractical 
as both refer to the same thing (the schema of x). The best solution I 
have come up with until now is to define a second function to be used in 
default function arguments:

schema_ <- schema

foo <- function(x, schema = schema_(x)) {
   if (is.null(schema)) stop("schema missing")
   # ...
}

I guess another solution would be:

foo <- function(x, schema) {
   if (missing(schema)) schema <- schema(x)
}

But then it is not clear for the user from the interface that the 
'schema' argument can be omitted.

I am hoping some of you have other suggestions.

And, is this something that could be 'fixed' in the R-parser?


Thanks,
Jan


From @kw@|mmo @end|ng |rom gm@||@com  Mon Aug  8 15:42:32 2022
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Mon, 8 Aug 2022 09:42:32 -0400
Subject: [R-pkg-devel] 
 Using function with same name as argument as default argument
In-Reply-To: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
References: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
Message-ID: <CAPcHnpQT=L6BDnYCVGgebyx1xNQcF84UvJO2=-S=xqW-+b-Amg@mail.gmail.com>

Hello,


This isn't something that can be fixed in the parser. If an argument isn't
provided, its default value is evaluated inside the function, so it gives
you a loop where schema = schema(x), but then what's schema, it's
schema(x), thus the recursion error. you could do something like this:

foo <- function (x, schema = schema(x))
{
    if (missing(schema)) {
        rm(schema)
        schema <- schema(x)
    }
}

which, while kinda gross looking, means that schema = schema(x) can be
evaluated without causing a recursion error.

On Mon, Aug 8, 2022, 09:11 Jan van der Laan <rhelp at eoos.dds.nl> wrote:

> Not sure if this belongs on r-help or r-package-devel; decided for the
> latter as the question is mainly relevant when writing code to be used
> by others.
>
> The issue I run into is that I want to write a function similar to:
>
>
> foo <- function(x, schema = schema(x)) {
>    if (is.null(schema)) stop("schema missing")
>    # ...
> }
>
> with 'schema()' something like (strongly simplified):
>
> schema <- function(x) attr(x, "schema")
>
>
> However using both the argument schema and calling the schema() function
> in one of the default arguments is not allowed ans results in the
> following somewhat cryptic error message:
>
> Error in foo(1:3) :
>    promise already under evaluation: recursive default argument
> reference or earlier problems?
>
> I am looking for a clean solution to this. I can rename the argument or
> function, but calling it something other than schema feels impractical
> as both refer to the same thing (the schema of x). The best solution I
> have come up with until now is to define a second function to be used in
> default function arguments:
>
> schema_ <- schema
>
> foo <- function(x, schema = schema_(x)) {
>    if (is.null(schema)) stop("schema missing")
>    # ...
> }
>
> I guess another solution would be:
>
> foo <- function(x, schema) {
>    if (missing(schema)) schema <- schema(x)
> }
>
> But then it is not clear for the user from the interface that the
> 'schema' argument can be omitted.
>
> I am hoping some of you have other suggestions.
>
> And, is this something that could be 'fixed' in the R-parser?
>
>
> Thanks,
> Jan
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Mon Aug  8 15:56:03 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Mon, 8 Aug 2022 16:56:03 +0300
Subject: [R-pkg-devel] 
 Using function with same name as argument as default argument
In-Reply-To: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
References: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
Message-ID: <20220808165603.5bb3715b@trisector>

On Mon, 8 Aug 2022 15:10:37 +0200
Jan van der Laan <rhelp at eoos.dds.nl> wrote:

> I guess another solution would be:
> 
> foo <- function(x, schema) {
>    if (missing(schema)) schema <- schema(x)
> }
> 
> But then it is not clear for the user from the interface that the 
> 'schema' argument can be omitted.

Here's a workaround that should work inside a package:

function(x, schema = mypackagename::schema(x))

For inline functions, this workaround is also possible, but I can only
think of an extremely ugly variant:

schema <- function(x) { force(x); 'schema' }
foo <- function(
 x, schema = get('schema', parent.env(environment()))(x)
) { force(schema); 'foo' }
foo(1) # works

-- 
Best regards,
Ivan


From rhe|p @end|ng |rom eoo@@dd@@n|  Mon Aug  8 16:23:35 2022
From: rhe|p @end|ng |rom eoo@@dd@@n| (Jan van der Laan)
Date: Mon, 8 Aug 2022 16:23:35 +0200
Subject: [R-pkg-devel] 
 Using function with same name as argument as default argument
In-Reply-To: <CAPcHnpQT=L6BDnYCVGgebyx1xNQcF84UvJO2=-S=xqW-+b-Amg@mail.gmail.com>
References: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
 <CAPcHnpQT=L6BDnYCVGgebyx1xNQcF84UvJO2=-S=xqW-+b-Amg@mail.gmail.com>
Message-ID: <01b15a8e-e4d8-38c0-695d-4b1c20763926@eoos.dds.nl>

Hi Andrew and Ivan,

Thanks for the suggestion. Both are good suggestions; better than what I 
have.


Andrews solution:

 > foo <- function (x, schema = schema(x))
 > {
 >      if (missing(schema)) {
 >          rm(schema)
 >          schema <- schema(x)
 >      }
 > }

Ivans:

 > function(x, schema = mypackagename::schema(x))

Both would work in this case. Ivans is a bit cleaner/simpler; Andrews 
appears simpler from a user perspective. Not sure yet which one I will 
use; I am currently leaning towards Ivans solution.

Thanks!
Jan





On 08-08-2022 15:42, Andrew Simmons wrote:
> Hello,
> 
> 
> This isn't something that can be fixed in the parser. If an argument 
> isn't provided, its default value is evaluated inside the function, so 
> it gives you a loop where schema = schema(x), but then what's schema, 
> it's schema(x), thus the recursion error. you could do something like this:
> 
> foo <- function (x, schema = schema(x))
> {
>  ? ? if (missing(schema)) {
>  ? ? ? ? rm(schema)
>  ? ? ? ? schema <- schema(x)
>  ? ? }
> }
> 
> which, while kinda gross looking, means that schema = schema(x) can be 
> evaluated without causing a recursion error.
> 
> On Mon, Aug 8, 2022, 09:11 Jan van der Laan <rhelp at eoos.dds.nl 
> <mailto:rhelp at eoos.dds.nl>> wrote:
> 
>     Not sure if this belongs on r-help or r-package-devel; decided for the
>     latter as the question is mainly relevant when writing code to be used
>     by others.
> 
>     The issue I run into is that I want to write a function similar to:
> 
> 
>     foo <- function(x, schema = schema(x)) {
>      ? ?if (is.null(schema)) stop("schema missing")
>      ? ?# ...
>     }
> 
>     with 'schema()' something like (strongly simplified):
> 
>     schema <- function(x) attr(x, "schema")
> 
> 
>     However using both the argument schema and calling the schema()
>     function
>     in one of the default arguments is not allowed ans results in the
>     following somewhat cryptic error message:
> 
>     Error in foo(1:3) :
>      ? ?promise already under evaluation: recursive default argument
>     reference or earlier problems?
> 
>     I am looking for a clean solution to this. I can rename the argument or
>     function, but calling it something other than schema feels impractical
>     as both refer to the same thing (the schema of x). The best solution I
>     have come up with until now is to define a second function to be
>     used in
>     default function arguments:
> 
>     schema_ <- schema
> 
>     foo <- function(x, schema = schema_(x)) {
>      ? ?if (is.null(schema)) stop("schema missing")
>      ? ?# ...
>     }
> 
>     I guess another solution would be:
> 
>     foo <- function(x, schema) {
>      ? ?if (missing(schema)) schema <- schema(x)
>     }
> 
>     But then it is not clear for the user from the interface that the
>     'schema' argument can be omitted.
> 
>     I am hoping some of you have other suggestions.
> 
>     And, is this something that could be 'fixed' in the R-parser?
> 
> 
>     Thanks,
>     Jan
> 
>     ______________________________________________
>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>     mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Aug  8 18:14:23 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 8 Aug 2022 12:14:23 -0400
Subject: [R-pkg-devel] 
 Using function with same name as argument as default argument
In-Reply-To: <01b15a8e-e4d8-38c0-695d-4b1c20763926@eoos.dds.nl>
References: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
 <CAPcHnpQT=L6BDnYCVGgebyx1xNQcF84UvJO2=-S=xqW-+b-Amg@mail.gmail.com>
 <01b15a8e-e4d8-38c0-695d-4b1c20763926@eoos.dds.nl>
Message-ID: <f736802e-213a-95a6-2d07-224328e89e76@gmail.com>

I kind of prefer Ivan's solution.  A variation on Andrew's that doesn't 
require you to code the default in two places is:

foo <- function(x, schema = schema(x)) {
   if (missing(schema)) {
     default <- substitute(schema)
     rm(schema)
     schema <- eval(default)
   }
}

You could also change the name of the argument and let users rely on 
partial argument matching:


foo <- function(x, schema. = schema(x)) {
    schema <- schema.   # if you don't want to type the dot again
    if (is.null(schema)) stop("schema missing")
    # ...
}

This allows users to say foo(x, schema = myschema(x)) .

However, I'd say it's not a great design.  Probably changing your 
function name to `getSchema` would be the best overall solution:


foo <- function(x, schema = getSchema(x)) {
    if (is.null(schema)) stop("schema missing")
    # ...
}

Functions do actions, so their names should be verb-like.

Duncan Murdoch

On 08/08/2022 10:23 a.m., Jan van der Laan wrote:
> Hi Andrew and Ivan,
> 
> Thanks for the suggestion. Both are good suggestions; better than what I
> have.
> 
> 
> Andrews solution:
> 
>   > foo <- function (x, schema = schema(x))
>   > {
>   >      if (missing(schema)) {
>   >          rm(schema)
>   >          schema <- schema(x)
>   >      }
>   > }
> 
> Ivans:
> 
>   > function(x, schema = mypackagename::schema(x))
> 
> Both would work in this case. Ivans is a bit cleaner/simpler; Andrews
> appears simpler from a user perspective. Not sure yet which one I will
> use; I am currently leaning towards Ivans solution.
> 
> Thanks!
> Jan
> 
> 
> 
> 
> 
> On 08-08-2022 15:42, Andrew Simmons wrote:
>> Hello,
>>
>>
>> This isn't something that can be fixed in the parser. If an argument
>> isn't provided, its default value is evaluated inside the function, so
>> it gives you a loop where schema = schema(x), but then what's schema,
>> it's schema(x), thus the recursion error. you could do something like this:
>>
>> foo <- function (x, schema = schema(x))
>> {
>>   ? ? if (missing(schema)) {
>>   ? ? ? ? rm(schema)
>>   ? ? ? ? schema <- schema(x)
>>   ? ? }
>> }
>>
>> which, while kinda gross looking, means that schema = schema(x) can be
>> evaluated without causing a recursion error.
>>
>> On Mon, Aug 8, 2022, 09:11 Jan van der Laan <rhelp at eoos.dds.nl
>> <mailto:rhelp at eoos.dds.nl>> wrote:
>>
>>      Not sure if this belongs on r-help or r-package-devel; decided for the
>>      latter as the question is mainly relevant when writing code to be used
>>      by others.
>>
>>      The issue I run into is that I want to write a function similar to:
>>
>>
>>      foo <- function(x, schema = schema(x)) {
>>       ? ?if (is.null(schema)) stop("schema missing")
>>       ? ?# ...
>>      }
>>
>>      with 'schema()' something like (strongly simplified):
>>
>>      schema <- function(x) attr(x, "schema")
>>
>>
>>      However using both the argument schema and calling the schema()
>>      function
>>      in one of the default arguments is not allowed ans results in the
>>      following somewhat cryptic error message:
>>
>>      Error in foo(1:3) :
>>       ? ?promise already under evaluation: recursive default argument
>>      reference or earlier problems?
>>
>>      I am looking for a clean solution to this. I can rename the argument or
>>      function, but calling it something other than schema feels impractical
>>      as both refer to the same thing (the schema of x). The best solution I
>>      have come up with until now is to define a second function to be
>>      used in
>>      default function arguments:
>>
>>      schema_ <- schema
>>
>>      foo <- function(x, schema = schema_(x)) {
>>       ? ?if (is.null(schema)) stop("schema missing")
>>       ? ?# ...
>>      }
>>
>>      I guess another solution would be:
>>
>>      foo <- function(x, schema) {
>>       ? ?if (missing(schema)) schema <- schema(x)
>>      }
>>
>>      But then it is not clear for the user from the interface that the
>>      'schema' argument can be omitted.
>>
>>      I am hoping some of you have other suggestions.
>>
>>      And, is this something that could be 'fixed' in the R-parser?
>>
>>
>>      Thanks,
>>      Jan
>>
>>      ______________________________________________
>>      R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>>      mailing list
>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>      <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From j|ox @end|ng |rom mcm@@ter@c@  Mon Aug  8 18:57:26 2022
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Mon, 8 Aug 2022 12:57:26 -0400
Subject: [R-pkg-devel] 
 Using function with same name as argument as default argument
In-Reply-To: <31453_1659964261_278DB0lL016698_64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
References: <31453_1659964261_278DB0lL016698_64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
Message-ID: <e168a0b1-f5b2-b89d-f981-837f32bd03ca@mcmaster.ca>

Dear Jan,

Here's yet another solution that takes advantage of partial matching:

 > foo <- function(x, schema. = schema(x)) {
+   if (is.null(schema.)) stop("schema missing")
+   x
+ }

 > schema <- function(x) attr(x, "schema")

 > y <- 1
 > z <- 2
 > attr(y, "schema") <- "bar"

 > foo(y)
[1] 1
attr(,"schema")
[1] "bar"

 > foo(z)
Error in foo(z) : schema missing

 > foo(z, schema="baz")
[1] 2


I hope this helps,
  John

On 2022-08-08 9:10 a.m., Jan van der Laan wrote:
> Not sure if this belongs on r-help or r-package-devel; decided for the 
> latter as the question is mainly relevant when writing code to be used 
> by others.
> 
> The issue I run into is that I want to write a function similar to:
> 
> 
> foo <- function(x, schema = schema(x)) {
>  ? if (is.null(schema)) stop("schema missing")
>  ? # ...
> }
> 
> with 'schema()' something like (strongly simplified):
> 
> schema <- function(x) attr(x, "schema")
> 
> 
> However using both the argument schema and calling the schema() function 
> in one of the default arguments is not allowed ans results in the 
> following somewhat cryptic error message:
> 
> Error in foo(1:3) :
>  ? promise already under evaluation: recursive default argument 
> reference or earlier problems?
> 
> I am looking for a clean solution to this. I can rename the argument or 
> function, but calling it something other than schema feels impractical 
> as both refer to the same thing (the schema of x). The best solution I 
> have come up with until now is to define a second function to be used in 
> default function arguments:
> 
> schema_ <- schema
> 
> foo <- function(x, schema = schema_(x)) {
>  ? if (is.null(schema)) stop("schema missing")
>  ? # ...
> }
> 
> I guess another solution would be:
> 
> foo <- function(x, schema) {
>  ? if (missing(schema)) schema <- schema(x)
> }
> 
> But then it is not clear for the user from the interface that the 
> 'schema' argument can be omitted.
> 
> I am hoping some of you have other suggestions.
> 
> And, is this something that could be 'fixed' in the R-parser?
> 
> 
> Thanks,
> Jan
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/


From rhe|p @end|ng |rom eoo@@dd@@n|  Mon Aug  8 22:10:06 2022
From: rhe|p @end|ng |rom eoo@@dd@@n| (Jan van der Laan)
Date: Mon, 8 Aug 2022 22:10:06 +0200
Subject: [R-pkg-devel] 
 Using function with same name as argument as default argument
In-Reply-To: <f736802e-213a-95a6-2d07-224328e89e76@gmail.com>
References: <64133a55-2ba0-448c-1770-02fdce65b797@dds.nl>
 <CAPcHnpQT=L6BDnYCVGgebyx1xNQcF84UvJO2=-S=xqW-+b-Amg@mail.gmail.com>
 <01b15a8e-e4d8-38c0-695d-4b1c20763926@eoos.dds.nl>
 <f736802e-213a-95a6-2d07-224328e89e76@gmail.com>
Message-ID: <042c32ae-6039-790d-61e2-2d118d5e95c1@dds.nl>

Thanks.

I think I prefer Ivan's solution too.


> 
> However, I'd say it's not a great design.? Probably changing your 
> function name to `getSchema` would be the best overall solution:
> 
> 
> foo <- function(x, schema = getSchema(x)) {
>  ?? if (is.null(schema)) stop("schema missing")
>  ?? # ...
> }
> 
> Functions do actions, so their names should be verb-like.

Thought about naming the function something like that. On the other 
hand, a lot of base R functions follow the following pattern in a 
similar case

foo <- levels(x)
levels(x) <- ...

(There is also a `schema<-` method). Other examples of this are 'attr', 
'class', 'length', 'dim', and 'names'. So for getters and setters the 
pattern seems to be to not use get and set. I like this feature of R, so 
would like to stick with it.

Best,
Jan



> 
> Duncan Murdoch
> 
> On 08/08/2022 10:23 a.m., Jan van der Laan wrote:
>> Hi Andrew and Ivan,
>>
>> Thanks for the suggestion. Both are good suggestions; better than what I
>> have.
>>
>>
>> Andrews solution:
>>
>> ? > foo <- function (x, schema = schema(x))
>> ? > {
>> ? >????? if (missing(schema)) {
>> ? >????????? rm(schema)
>> ? >????????? schema <- schema(x)
>> ? >????? }
>> ? > }
>>
>> Ivans:
>>
>> ? > function(x, schema = mypackagename::schema(x))
>>
>> Both would work in this case. Ivans is a bit cleaner/simpler; Andrews
>> appears simpler from a user perspective. Not sure yet which one I will
>> use; I am currently leaning towards Ivans solution.
>>
>> Thanks!
>> Jan
>>
>>
>>
>>
>>
>> On 08-08-2022 15:42, Andrew Simmons wrote:
>>> Hello,
>>>
>>>
>>> This isn't something that can be fixed in the parser. If an argument
>>> isn't provided, its default value is evaluated inside the function, so
>>> it gives you a loop where schema = schema(x), but then what's schema,
>>> it's schema(x), thus the recursion error. you could do something like 
>>> this:
>>>
>>> foo <- function (x, schema = schema(x))
>>> {
>>> ? ? ? if (missing(schema)) {
>>> ? ? ? ? ? rm(schema)
>>> ? ? ? ? ? schema <- schema(x)
>>> ? ? ? }
>>> }
>>>
>>> which, while kinda gross looking, means that schema = schema(x) can be
>>> evaluated without causing a recursion error.
>>>
>>> On Mon, Aug 8, 2022, 09:11 Jan van der Laan <rhelp at eoos.dds.nl
>>> <mailto:rhelp at eoos.dds.nl>> wrote:
>>>
>>> ???? Not sure if this belongs on r-help or r-package-devel; decided 
>>> for the
>>> ???? latter as the question is mainly relevant when writing code to 
>>> be used
>>> ???? by others.
>>>
>>> ???? The issue I run into is that I want to write a function similar to:
>>>
>>>
>>> ???? foo <- function(x, schema = schema(x)) {
>>> ????? ? ?if (is.null(schema)) stop("schema missing")
>>> ????? ? ?# ...
>>> ???? }
>>>
>>> ???? with 'schema()' something like (strongly simplified):
>>>
>>> ???? schema <- function(x) attr(x, "schema")
>>>
>>>
>>> ???? However using both the argument schema and calling the schema()
>>> ???? function
>>> ???? in one of the default arguments is not allowed ans results in the
>>> ???? following somewhat cryptic error message:
>>>
>>> ???? Error in foo(1:3) :
>>> ????? ? ?promise already under evaluation: recursive default argument
>>> ???? reference or earlier problems?
>>>
>>> ???? I am looking for a clean solution to this. I can rename the 
>>> argument or
>>> ???? function, but calling it something other than schema feels 
>>> impractical
>>> ???? as both refer to the same thing (the schema of x). The best 
>>> solution I
>>> ???? have come up with until now is to define a second function to be
>>> ???? used in
>>> ???? default function arguments:
>>>
>>> ???? schema_ <- schema
>>>
>>> ???? foo <- function(x, schema = schema_(x)) {
>>> ????? ? ?if (is.null(schema)) stop("schema missing")
>>> ????? ? ?# ...
>>> ???? }
>>>
>>> ???? I guess another solution would be:
>>>
>>> ???? foo <- function(x, schema) {
>>> ????? ? ?if (missing(schema)) schema <- schema(x)
>>> ???? }
>>>
>>> ???? But then it is not clear for the user from the interface that the
>>> ???? 'schema' argument can be omitted.
>>>
>>> ???? I am hoping some of you have other suggestions.
>>>
>>> ???? And, is this something that could be 'fixed' in the R-parser?
>>>
>>>
>>> ???? Thanks,
>>> ???? Jan
>>>
>>> ???? ______________________________________________
>>> ???? R-package-devel at r-project.org 
>>> <mailto:R-package-devel at r-project.org>
>>> ???? mailing list
>>> ???? https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>> ???? <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From rmh @end|ng |rom temp|e@edu  Tue Aug  9 05:26:25 2022
From: rmh @end|ng |rom temp|e@edu (Richard M. Heiberger)
Date: Tue, 9 Aug 2022 03:26:25 +0000
Subject: [R-pkg-devel] escaped latex specials
Message-ID: <BL1PR11MB5239C74C58C335CCF0B3A938D2629@BL1PR11MB5239.namprd11.prod.outlook.com>

There is a new NOTE.  This line with \& used to be acceptable.
I am not seeing what the suggested replacement is.

* checking Rd files ... [4s] NOTE
checkRd: (-1) bivariateNormal.Rd:42: Escaped LaTeX specials: \&

The full example is
\note{
  Based on the \code{galaxy} example on pages 204--205 in
  \emph{S \& S-PLUS Trellis Graphics User's Manual},
  Richard A. Becker and William S. Cleveland (1996),
\url{https://www.stat.auckland.ac.nz/~ihaka/courses/120/trellis.user.pdf} %% works 19Aug2019
}

Rich

	[[alternative HTML version deleted]]


From georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk  Tue Aug  9 09:37:45 2022
From: georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk (Georgi Boshnakov)
Date: Tue, 9 Aug 2022 07:37:45 +0000
Subject: [R-pkg-devel] escaped latex specials
In-Reply-To: <BL1PR11MB5239C74C58C335CCF0B3A938D2629@BL1PR11MB5239.namprd11.prod.outlook.com>
References: <BL1PR11MB5239C74C58C335CCF0B3A938D2629@BL1PR11MB5239.namprd11.prod.outlook.com>
Message-ID: <CWLP265MB350555EFC5E347E54EBDF387AE629@CWLP265MB3505.GBRP265.PROD.OUTLOOK.COM>

Just remove the backslash.

Georgi Boshnakov

Get Outlook for Android<https://aka.ms/AAb9ysg>
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Richard M. Heiberger <rmh at temple.edu>
Sent: Tuesday, August 9, 2022 4:26:25 AM
To: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [R-pkg-devel] escaped latex specials

There is a new NOTE.  This line with \& used to be acceptable.
I am not seeing what the suggested replacement is.

* checking Rd files ... [4s] NOTE
checkRd: (-1) bivariateNormal.Rd:42: Escaped LaTeX specials: \&

The full example is
\note{
  Based on the \code{galaxy} example on pages 204--205 in
  \emph{S \& S-PLUS Trellis Graphics User's Manual},
  Richard A. Becker and William S. Cleveland (1996),
\url{https://www.stat.auckland.ac.nz/~ihaka/courses/120/trellis.user.pdf} %% works 19Aug2019
}

Rich

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From j@cob@roved @end|ng |rom b|o|@|u@@e  Mon Aug  8 14:58:26 2022
From: j@cob@roved @end|ng |rom b|o|@|u@@e (Jacob Roved)
Date: Mon, 8 Aug 2022 12:58:26 +0000
Subject: [R-pkg-devel] Inputenc error when submitting package
Message-ID: <6FF6B300-65CC-4B56-AE2A-FFCAB8D583B1@biol.lu.se>

Dear fellow R-developers,
I received an error when submitting my package MHCtools v. 1.4.3 to CRAN, and I?m simply blank on what to do.

Please see: <https://CRAN.R-project.org/web/checks/check_results_MHCtools.html>

It appears to concern the pdf version of the manual, which is generated by the CRAN servers from the markdown docs in the package folder ?man?, which in turn are generated by Roxygen from the R code files. If I undestand the CRAN package check results correctly, the problem seems to be some characters, that are not translated by the package inputenc in the CRAN server:

    ! Package inputenc Error: Unicode char ?<c2><80><c2><90> (U+2010)
    (inputenc) not set up for use with LaTeX.

This was also listed as existing problems for the previous version of MHCtools (1.4.2), and I?m equally baffled about that, because that passed CRAN submission without errors on May 23rd this year.

I have browsed through all my code files and all the markdown files in the package folder ?man?, and I don?t find any odd characters.

Interestingly, I don?t get the error when running check_win_devel() or check_rhub().

I hope someone can shed some light on what is going on here.

Kind regards,
Jacob Roved
Postdoc
GLOBE Institute
University of Copenhagen

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Aug  9 10:30:46 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 9 Aug 2022 04:30:46 -0400
Subject: [R-pkg-devel] Inputenc error when submitting package
In-Reply-To: <6FF6B300-65CC-4B56-AE2A-FFCAB8D583B1@biol.lu.se>
References: <6FF6B300-65CC-4B56-AE2A-FFCAB8D583B1@biol.lu.se>
Message-ID: <aa546fc4-1faf-778a-a006-1ece6742fe87@gmail.com>

On 08/08/2022 8:58 a.m., Jacob Roved wrote:
> Dear fellow R-developers,
> I received an error when submitting my package MHCtools v. 1.4.3 to CRAN, and I?m simply blank on what to do.
> 
> Please see: <https://CRAN.R-project.org/web/checks/check_results_MHCtools.html>
> 
> It appears to concern the pdf version of the manual, which is generated by the CRAN servers from the markdown docs in the package folder ?man?, which in turn are generated by Roxygen from the R code files. If I undestand the CRAN package check results correctly, the problem seems to be some characters, that are not translated by the package inputenc in the CRAN server:
> 
>      ! Package inputenc Error: Unicode char ?<c2><80><c2><90> (U+2010)
>      (inputenc) not set up for use with LaTeX.

U+2010 is the hyphen character.  It looks a lot like the ascii "-" (code 
2D), which Unicode calls "hyphen-minus".

You can find occurrences of it (and other non-ASCII chars) in your files 
using the tools::showNonASCIIfile() function, e.g.

   files <- list.files(recursive = TRUE)
   for (f in files) tools::showNonASCIIfile(f)

Duncan Murdoch

> 
> This was also listed as existing problems for the previous version of MHCtools (1.4.2), and I?m equally baffled about that, because that passed CRAN submission without errors on May 23rd this year.
> 
> I have browsed through all my code files and all the markdown files in the package folder ?man?, and I don?t find any odd characters.
> 
> Interestingly, I don?t get the error when running check_win_devel() or check_rhub().
> 
> I hope someone can shed some light on what is going on here.
> 
> Kind regards,
> Jacob Roved
> Postdoc
> GLOBE Institute
> University of Copenhagen
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @eb@meyer @end|ng |rom |@u@de  Tue Aug  9 11:32:07 2022
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Tue, 9 Aug 2022 11:32:07 +0200
Subject: [R-pkg-devel] Inputenc error when submitting package
In-Reply-To: <aa546fc4-1faf-778a-a006-1ece6742fe87@gmail.com>
References: <6FF6B300-65CC-4B56-AE2A-FFCAB8D583B1@biol.lu.se>
 <aa546fc4-1faf-778a-a006-1ece6742fe87@gmail.com>
Message-ID: <2e4b4b7e-2258-1d19-368c-29f0e2108740@fau.de>

Am 09.08.22 um 10:30 schrieb Duncan Murdoch:
> On 08/08/2022 8:58 a.m., Jacob Roved wrote:
>> Dear fellow R-developers,
>> I received an error when submitting my package MHCtools v. 1.4.3 to 
>> CRAN, and I?m simply blank on what to do.
>>
>> Please see: 
>> <https://CRAN.R-project.org/web/checks/check_results_MHCtools.html>
>>
>> It appears to concern the pdf version of the manual, which is 
>> generated by the CRAN servers from the markdown docs in the package 
>> folder ?man?, which in turn are generated by Roxygen from the R code 
>> files. If I undestand the CRAN package check results correctly, the 
>> problem seems to be some characters, that are not translated by the 
>> package inputenc in the CRAN server:
>>
>> ???? ! Package inputenc Error: Unicode char ?<c2><80><c2><90> (U+2010)
>> ???? (inputenc) not set up for use with LaTeX.
> 
> U+2010 is the hyphen character.? It looks a lot like the ascii "-" (code 
> 2D), which Unicode calls "hyphen-minus".

In most fonts, "\u2010" is indistinguishable from the ASCII 
"hyphen-minus". LaTeX/inputenc gained support for the Unicode hyphen in 
the March 2016 release (substituting an ASCII hyphen), so you need a 
rather old OS to reproduce the error.

Among CRAN's check systems, r-oldrel-windows seems to be the only one 
using a sufficiently old LaTeX version. FWIW, Debian oldoldstable 
(stretch) is at TeX Live 2016, so supports U+2010.

	Sebastian Meyer

> 
> You can find occurrences of it (and other non-ASCII chars) in your files 
> using the tools::showNonASCIIfile() function, e.g.
> 
>  ? files <- list.files(recursive = TRUE)
>  ? for (f in files) tools::showNonASCIIfile(f)
> 
> Duncan Murdoch
> 
>>
>> This was also listed as existing problems for the previous version of 
>> MHCtools (1.4.2), and I?m equally baffled about that, because that 
>> passed CRAN submission without errors on May 23rd this year.
>>
>> I have browsed through all my code files and all the markdown files in 
>> the package folder ?man?, and I don?t find any odd characters.
>>
>> Interestingly, I don?t get the error when running check_win_devel() or 
>> check_rhub().
>>
>> I hope someone can shed some light on what is going on here.
>>
>> Kind regards,
>> Jacob Roved
>> Postdoc
>> GLOBE Institute
>> University of Copenhagen
>>
>> ????[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From rmh @end|ng |rom temp|e@edu  Tue Aug  9 15:58:28 2022
From: rmh @end|ng |rom temp|e@edu (Richard M. Heiberger)
Date: Tue, 9 Aug 2022 13:58:28 +0000
Subject: [R-pkg-devel] [External] Re: escaped latex specials
In-Reply-To: <CWLP265MB350555EFC5E347E54EBDF387AE629@CWLP265MB3505.GBRP265.PROD.OUTLOOK.COM>
References: <BL1PR11MB5239C74C58C335CCF0B3A938D2629@BL1PR11MB5239.namprd11.prod.outlook.com>
 <CWLP265MB350555EFC5E347E54EBDF387AE629@CWLP265MB3505.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <BL1PR11MB5239CC3086BC6F125869BE9AD2629@BL1PR11MB5239.namprd11.prod.outlook.com>

Will do.
________________________________
From: Georgi Boshnakov <georgi.boshnakov at manchester.ac.uk>
Sent: Tuesday, August 9, 2022 3:37:45 AM
To: Richard M. Heiberger <rmh at temple.edu>; r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [External] Re: escaped latex specials

Just remove the backslash.

Georgi Boshnakov

Get Outlook for Android<https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2FAAb9ysg&data=05%7C01%7Crmh%40temple.edu%7Ce23fa75b70e04873032408da79da0e4d%7C716e81efb52244738e3110bd02ccf6e5%7C0%7C0%7C637956275123317137%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=WpjvWhf2YkYvxKTvcIzyMhMkXfkT%2Brd7McINqfpQd8s%3D&reserved=0>
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Richard M. Heiberger <rmh at temple.edu>
Sent: Tuesday, August 9, 2022 4:26:25 AM
To: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [R-pkg-devel] escaped latex specials

There is a new NOTE.  This line with \& used to be acceptable.
I am not seeing what the suggested replacement is.

* checking Rd files ... [4s] NOTE
checkRd: (-1) bivariateNormal.Rd:42: Escaped LaTeX specials: \&

The full example is
\note{
  Based on the \code{galaxy} example on pages 204--205 in
  \emph{S \& S-PLUS Trellis Graphics User's Manual},
  Richard A. Becker and William S. Cleveland (1996),
\url{https://www.stat.auckland.ac.nz/~ihaka/courses/120/trellis.user.pdf} %% works 19Aug2019
}

Rich

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel<https://nam10.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&data=05%7C01%7Crmh%40temple.edu%7Ce23fa75b70e04873032408da79da0e4d%7C716e81efb52244738e3110bd02ccf6e5%7C0%7C0%7C637956275123317137%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=3rl37%2Fs9WFOM3Y1MXWEGqzvlGLQqUZSwRzeh9K9xQVo%3D&reserved=0>

	[[alternative HTML version deleted]]


From y@nn@r|chet @end|ng |rom |r@n@|r  Tue Aug  9 16:38:14 2022
From: y@nn@r|chet @end|ng |rom |r@n@|r (RICHET Yann)
Date: Tue, 9 Aug 2022 14:38:14 +0000
Subject: [R-pkg-devel] Advice concerning a wrapper package
Message-ID: <91E98C94545DA84BBCE16EE6BB38CFB4015B2244B1@irsn.fr>

Dear all,

This is a slightly exotic situation: I need to publish on CRAN an R package, which do not hold any source code itself, just makefiles and scripts.
The whole source code belongs to another project (C++, python, R, ...) and for now I put it in another directory at same level that R, inst, ...
Indeed, this directory is a git submodule of the wrapped project in C++, so my R package has just some scripts for pre-compile stuff, moving some dirs, ...

Of course, it returns some CRAN WARNING and NOTE due to that:
...
* checking top-level files ... NOTE
Non-standard file/directory found at top level:
  'libKriging'
...
* checking package subdirectories ... WARNING
Subdirectory 'src' contains no source files.
...
* checking use of PKG_*FLAGS in Makefiles ... NOTE
   PKG_CPPFLAGS set in 'src/Makevars' without any corresponding files
   PKG_CXXFLAGS set in 'src/Makevars.win' without any corresponding files
   PKG_CPPFLAGS set in 'src/Makevars.win' without any corresponding files
* checking use of SHLIB_OPENMP_*FLAGS in Makefiles ... NOTE
  src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_CXXFLAGS without any C++ files
  src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_LIBS but linking is by C
...


My questions:

* any ideas to fix these warnings ?
* what will be really blocking for CRAN submisison ? (I mean which NOTE should be 'tolerated' ?)
* do you already know such exotic container-package that could hold some good ideas ?

Best regards,

Yann

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Aug  9 18:18:07 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 9 Aug 2022 12:18:07 -0400
Subject: [R-pkg-devel] Advice concerning a wrapper package
In-Reply-To: <91E98C94545DA84BBCE16EE6BB38CFB4015B2244B1@irsn.fr>
References: <91E98C94545DA84BBCE16EE6BB38CFB4015B2244B1@irsn.fr>
Message-ID: <f859d5bb-f0a6-474e-416c-be4c37a44c96@gmail.com>

On 09/08/2022 10:38 a.m., RICHET Yann wrote:
> Dear all,
> 
> This is a slightly exotic situation: I need to publish on CRAN an R package, which do not hold any source code itself, just makefiles and scripts.
> The whole source code belongs to another project (C++, python, R, ...) and for now I put it in another directory at same level that R, inst, ...
> Indeed, this directory is a git submodule of the wrapped project in C++, so my R package has just some scripts for pre-compile stuff, moving some dirs, ...
> 
> Of course, it returns some CRAN WARNING and NOTE due to that:
> ...
> * checking top-level files ... NOTE
> Non-standard file/directory found at top level:
>    'libKriging'

This should be fixed by putting that directory under "inst".  Then it 
will be installed to the top level.

> ...
> * checking package subdirectories ... WARNING
> Subdirectory 'src' contains no source files.
> ...
> * checking use of PKG_*FLAGS in Makefiles ... NOTE
>     PKG_CPPFLAGS set in 'src/Makevars' without any corresponding files
>     PKG_CXXFLAGS set in 'src/Makevars.win' without any corresponding files
>     PKG_CPPFLAGS set in 'src/Makevars.win' without any corresponding files
> * checking use of SHLIB_OPENMP_*FLAGS in Makefiles ... NOTE
>    src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_CXXFLAGS without any C++ files
>    src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_LIBS but linking is by C
> ...
> 
> 
> My questions:
> 
> * any ideas to fix these warnings ?
> * what will be really blocking for CRAN submisison ? (I mean which NOTE should be 'tolerated' ?)
> * do you already know such exotic container-package that could hold some good ideas ?

If your package is accepted by CRAN and a user chooses to install it, 
where will they get the source files from?

Duncan Murdoch


From edwwe|2020 @end|ng |rom gm@||@com  Tue Aug  9 22:38:33 2022
From: edwwe|2020 @end|ng |rom gm@||@com (Edward Wei)
Date: Tue, 9 Aug 2022 13:38:33 -0700
Subject: [R-pkg-devel] Misspelled words in descrition and tar.gz inside
 folder
Message-ID: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>

Hello. Here is my "NOTE" message.

* checking CRAN incoming feasibility ... NOTE
Maintainer: ?Edward Wei <edwwei2020 at gmail.com>?

New submission

Possibly misspelled words in DESCRIPTION:
  alphavantager (8:3, 9:7)
  Alphavantager (7:32)
  api (7:58, 8:36)
  Avfintools (10:18)
  Vantager (3:55, 10:46, 11:56)

* checking top-level files ... NOTE
Non-standard file/directory found at top level:
  ?avfintools.tar.gz?

My questions are:

1. My misspelled words are just referencing names of packages and
programming terms etc. Is there a way to get around this or should I omit
them from my description and put them somewhere else.

2. I wanted to confirm this, but the tar.gz for CRAN submission SHOULD NOT
be in the folder of the directory for my package.

Thanks for your time,

	[[alternative HTML version deleted]]


From @ergue|@@oko| @end|ng |rom gm@||@com  Wed Aug 10 12:02:18 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Wed, 10 Aug 2022 12:02:18 +0200
Subject: [R-pkg-devel] Misspelled words in descrition and tar.gz inside
 folder
In-Reply-To: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
References: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
Message-ID: <fac712c9-a6e9-bdb3-2a70-bd854475c752@gmail.com>

Le 09/08/2022 ? 22:38, Edward Wei a ?crit?:
> Hello. Here is my "NOTE" message.
>
> * checking CRAN incoming feasibility ... NOTE
> Maintainer: ?Edward Wei <edwwei2020 at gmail.com>?
>
> New submission
>
> Possibly misspelled words in DESCRIPTION:
>    alphavantager (8:3, 9:7)
>    Alphavantager (7:32)
>    api (7:58, 8:36)
>    Avfintools (10:18)
>    Vantager (3:55, 10:46, 11:56)
>
> * checking top-level files ... NOTE
> Non-standard file/directory found at top level:
>    ?avfintools.tar.gz?
>
> My questions are:
>
> 1. My misspelled words are just referencing names of packages and
> programming terms etc. Is there a way to get around this or should I omit
> them from my description and put them somewhere else.

You can try to surround package names in singe quotes <'>.


>
> 2. I wanted to confirm this, but the tar.gz for CRAN submission SHOULD NOT
> be in the folder of the directory for my package.
Right. However, you can want to distribute some auxiliary data, e.g. 
data supporting examples in your doc. In this case, such auxiliary files 
can go in "inst/" directory. All the content from this directory will be 
placed in the root of your package. So it may be more informative for an 
end-user to place them in "inst/examples/" or alike. Thus, the user will 
find them in "<package_dir>/examples/".

Best,
Serguei.


>
> Thanks for your time,
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Aug 10 10:29:21 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 10 Aug 2022 10:29:21 +0200
Subject: [R-pkg-devel] Misspelled words in descrition and tar.gz inside
 folder
In-Reply-To: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
References: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
Message-ID: <d488e61d-63cf-15b5-2487-bfab8fbff178@statistik.tu-dortmund.de>



On 09.08.2022 22:38, Edward Wei wrote:
> Hello. Here is my "NOTE" message.
> 
> * checking CRAN incoming feasibility ... NOTE
> Maintainer: ?Edward Wei <edwwei2020 at gmail.com>?
> 
> New submission
> 
> Possibly misspelled words in DESCRIPTION:
>    alphavantager (8:3, 9:7)
>    Alphavantager (7:32)
>    api (7:58, 8:36)
>    Avfintools (10:18)
>    Vantager (3:55, 10:46, 11:56)
> 
> * checking top-level files ... NOTE
> Non-standard file/directory found at top level:
>    ?avfintools.tar.gz?
> 
> My questions are:
> 
> 1. My misspelled words are just referencing names of packages and
> programming terms etc. Is there a way to get around this or should I omit
> them from my description and put them somewhere else.

Software names should be single quotes in the Title and Description 
fields of the DESCRIPTION file. Other "possibly misspelled" words that 
are actually fine will be reviewed by manual inspection anyway. Just 
ignore these.


> 
> 2. I wanted to confirm this, but the tar.gz for CRAN submission SHOULD NOT
> be in the folder of the directory for my package.

No. You should submit a package created by R CMD build which will not 
generated tar.gz files within in your package structure.

Best,
Uwe Ligges

> 
> Thanks for your time,
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Aug 10 11:02:52 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 10 Aug 2022 05:02:52 -0400
Subject: [R-pkg-devel] Advice concerning a wrapper package
In-Reply-To: <91E98C94545DA84BBCE16EE6BB38CFB4015B224539@irsn.fr>
References: <91E98C94545DA84BBCE16EE6BB38CFB4015B2244B1@irsn.fr>
 <f859d5bb-f0a6-474e-416c-be4c37a44c96@gmail.com>
 <91E98C94545DA84BBCE16EE6BB38CFB4015B224539@irsn.fr>
Message-ID: <15621d86-28cc-1722-35b2-dbd4612532fc@gmail.com>

On 09/08/2022 5:35 p.m., RICHET Yann wrote:
> Thank you for your answer.
> 
> All sources (.cpp, .h and .R files) are in the libKriging directory, so as you suggested inside inst/libKriging
> But as the whole size before compiling is exceeding 15MB, I would add some cleanup to delete inst/libKriging sources after compiling.
> Is it a bad solution ?

The normal layout would put .cpp and .h files in src, and .R files in R. 
  The src directory can have subdirectories, e.g. src/libKriging.  Those 
won't get compiled automatically, but your makefiles can compile them.

Duncan Murdoch

> 
> Regards
> 
> Yann
> 
> 
> ________________________________________
> From: Duncan Murdoch [murdoch.duncan at gmail.com]
> Sent: Tuesday, August 09, 2022 6:18 PM
> To: RICHET Yann; r-package-devel at r-project.org
> Subject: Re: [R-pkg-devel] Advice concerning a wrapper package
> 
> On 09/08/2022 10:38 a.m., RICHET Yann wrote:
>> Dear all,
>>
>> This is a slightly exotic situation: I need to publish on CRAN an R package, which do not hold any source code itself, just makefiles and scripts.
>> The whole source code belongs to another project (C++, python, R, ...) and for now I put it in another directory at same level that R, inst, ...
>> Indeed, this directory is a git submodule of the wrapped project in C++, so my R package has just some scripts for pre-compile stuff, moving some dirs, ...
>>
>> Of course, it returns some CRAN WARNING and NOTE due to that:
>> ...
>> * checking top-level files ... NOTE
>> Non-standard file/directory found at top level:
>>     'libKriging'
> 
> This should be fixed by putting that directory under "inst".  Then it
> will be installed to the top level.
> 
>> ...
>> * checking package subdirectories ... WARNING
>> Subdirectory 'src' contains no source files.
>> ...
>> * checking use of PKG_*FLAGS in Makefiles ... NOTE
>>      PKG_CPPFLAGS set in 'src/Makevars' without any corresponding files
>>      PKG_CXXFLAGS set in 'src/Makevars.win' without any corresponding files
>>      PKG_CPPFLAGS set in 'src/Makevars.win' without any corresponding files
>> * checking use of SHLIB_OPENMP_*FLAGS in Makefiles ... NOTE
>>     src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_CXXFLAGS without any C++ files
>>     src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_LIBS but linking is by C
>> ...
>>
>>
>> My questions:
>>
>> * any ideas to fix these warnings ?
>> * what will be really blocking for CRAN submisison ? (I mean which NOTE should be 'tolerated' ?)
>> * do you already know such exotic container-package that could hold some good ideas ?
> 
> If your package is accepted by CRAN and a user chooses to install it,
> where will they get the source files from?
> 
> Duncan Murdoch


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Aug  9 23:43:16 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 10 Aug 2022 00:43:16 +0300
Subject: [R-pkg-devel] Misspelled words in descrition and tar.gz inside
 folder
In-Reply-To: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
References: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
Message-ID: <20220810004316.6ece571f@Tarkus>

On Tue, 9 Aug 2022 13:38:33 -0700
Edward Wei <edwwei2020 at gmail.com> wrote:

> 1. My misspelled words are just referencing names of packages and
> programming terms etc. Is there a way to get around this or should I
> omit them from my description and put them somewhere else.

If you can, mention them in the comments to the CRAN submission.

> 2. I wanted to confirm this, but the tar.gz for CRAN submission
> SHOULD NOT be in the folder of the directory for my package.

Check your R CMD build process. There seemed to have been an
avfintools.tar.gz file in the package directory at the time when you
were preparing the package tarball. If you prefer to build the package
in the current directory (i.e. by running R CMD build .) or otherwise
need that file there, use .Rbuildignore to prevent it from ending up
inside the tarball. For example, you can put \.tar\.gz$ on a line there
to skip all files with names ending with .tar.gz.

-- 
Best regards,
Ivan


From y@nn@r|chet @end|ng |rom |r@n@|r  Tue Aug  9 23:35:58 2022
From: y@nn@r|chet @end|ng |rom |r@n@|r (RICHET Yann)
Date: Tue, 9 Aug 2022 21:35:58 +0000
Subject: [R-pkg-devel] Advice concerning a wrapper package
In-Reply-To: <f859d5bb-f0a6-474e-416c-be4c37a44c96@gmail.com>
References: <91E98C94545DA84BBCE16EE6BB38CFB4015B2244B1@irsn.fr>,
 <f859d5bb-f0a6-474e-416c-be4c37a44c96@gmail.com>
Message-ID: <91E98C94545DA84BBCE16EE6BB38CFB4015B224539@irsn.fr>

Thank you for your answer.

All sources (.cpp, .h and .R files) are in the libKriging directory, so as you suggested inside inst/libKriging
But as the whole size before compiling is exceeding 15MB, I would add some cleanup to delete inst/libKriging sources after compiling.
Is it a bad solution ?

Regards

Yann


________________________________________
From: Duncan Murdoch [murdoch.duncan at gmail.com]
Sent: Tuesday, August 09, 2022 6:18 PM
To: RICHET Yann; r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] Advice concerning a wrapper package

On 09/08/2022 10:38 a.m., RICHET Yann wrote:
> Dear all,
>
> This is a slightly exotic situation: I need to publish on CRAN an R package, which do not hold any source code itself, just makefiles and scripts.
> The whole source code belongs to another project (C++, python, R, ...) and for now I put it in another directory at same level that R, inst, ...
> Indeed, this directory is a git submodule of the wrapped project in C++, so my R package has just some scripts for pre-compile stuff, moving some dirs, ...
>
> Of course, it returns some CRAN WARNING and NOTE due to that:
> ...
> * checking top-level files ... NOTE
> Non-standard file/directory found at top level:
>    'libKriging'

This should be fixed by putting that directory under "inst".  Then it
will be installed to the top level.

> ...
> * checking package subdirectories ... WARNING
> Subdirectory 'src' contains no source files.
> ...
> * checking use of PKG_*FLAGS in Makefiles ... NOTE
>     PKG_CPPFLAGS set in 'src/Makevars' without any corresponding files
>     PKG_CXXFLAGS set in 'src/Makevars.win' without any corresponding files
>     PKG_CPPFLAGS set in 'src/Makevars.win' without any corresponding files
> * checking use of SHLIB_OPENMP_*FLAGS in Makefiles ... NOTE
>    src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_CXXFLAGS without any C++ files
>    src/Makevars.win: SHLIB_OPENMP_CXXFLAGS is included in PKG_LIBS but linking is by C
> ...
>
>
> My questions:
>
> * any ideas to fix these warnings ?
> * what will be really blocking for CRAN submisison ? (I mean which NOTE should be 'tolerated' ?)
> * do you already know such exotic container-package that could hold some good ideas ?

If your package is accepted by CRAN and a user chooses to install it,
where will they get the source files from?

Duncan Murdoch


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Wed Aug 10 00:11:20 2022
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Tue, 9 Aug 2022 17:11:20 -0500
Subject: [R-pkg-devel] Misspelled words in descrition and tar.gz inside
 folder
In-Reply-To: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
References: <CAEf_eRCv4SNL5Fh5WFg7iq9OuDwEQ92=3t_v6TF658iPr4UYww@mail.gmail.com>
Message-ID: <54bba332-9fdb-53bb-f064-9c5235b29d46@effectivedefense.org>

Hello, Edward Wei:


	  Are you familiar with R Packages (2nd edition) Hadley Wickham and 
Jenny Bryan?


https://r-pkgs.org


	  This book is the most up-to-date information I know on preparing 
something for CRAN.  To your question specifically, I have a "WORDLIST" 
file in an "inst" folder.


	  Below please find notes I've prepared for myself on the various tests 
I've gotten from their book, etc.  The section numbers refer to an 
earlier version of this book.  Ignore or use with caution.


	  Hope this helps.
	  Spencer Graves


# File > "Open Project..." > [parent of Package file]

# https://r-pkgs.org/release.html

#20.1.  Pick a version number:
#       in DESCRIPTION: must be later than any version on CRAN
#20.3.  The submission process
#       Store submission comments in cran-comments.md
#20.3.1.  Test environments
# devtools::check_win_*()
dir()

PkgName <- "Ecdat"
PkgRegExpr <- paste0('^', PkgName, '$')
(Pkg <- dir(pattern=PkgRegExpr))

devtools::check_win_devel(Pkg)
devtools::check_win_release(Pkg)
devtools::check_win_oldrelease(Pkg)

# devtools::check_rhub(Pkg)
#Error in match_platform(platform) :
#   Unknown R-hub platform, see rhub::platforms() for a list
# on 2022-07-04.

# https://r-pkgs.org/release.html
# now recommends:

rhub::check(Pkg)

# Select
# 3.  Apple Silicon (M1), macOS 11.6 Big Sur, R-release 
(macos-m1-bigsur-release)
# This may not be correct:  I have mac)S 11.6.7 running an Intel core i7.


#20.3.3.  Reverse dependencies

# install.packages("revdepcheck")
#devtools::install_github('r-lib/revdepcheck')

# revdepcheck::revdep_reset(Pkg)

# revdepcheck::revdep_check(Pkg, num_workers = 4)

#20.4.  Update README.md and NEWS.md

#20.5.  Submit to CRAN

library(devtools)
# spell_check(Pkg)

release(Pkg)

#20.6.  Update the version number for the future
#20.7.  Publicise

#20.1.  Pick a version number:  in DESCRIPTION > what's on CRAN

#20.2.  Run & document R CMD check
# 2.1-0 because this is to match the move of
# the database maintenance to wu.ut.at

#20.3.  Check CRAN policies
#20.4.  Update README.md and NEWS.md
#20.5.  Submit to CRAN
#20.6.  Update the version number for the future
#20.7.  Publicise


On 8/9/22 3:38 PM, Edward Wei wrote:
> Hello. Here is my "NOTE" message.
> 
> * checking CRAN incoming feasibility ... NOTE
> Maintainer: ?Edward Wei <edwwei2020 at gmail.com>?
> 
> New submission
> 
> Possibly misspelled words in DESCRIPTION:
>    alphavantager (8:3, 9:7)
>    Alphavantager (7:32)
>    api (7:58, 8:36)
>    Avfintools (10:18)
>    Vantager (3:55, 10:46, 11:56)
> 
> * checking top-level files ... NOTE
> Non-standard file/directory found at top level:
>    ?avfintools.tar.gz?
> 
> My questions are:
> 
> 1. My misspelled words are just referencing names of packages and
> programming terms etc. Is there a way to get around this or should I omit
> them from my description and put them somewhere else.
> 
> 2. I wanted to confirm this, but the tar.gz for CRAN submission SHOULD NOT
> be in the folder of the directory for my package.
> 
> Thanks for your time,
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m@r|u@@ho|ert @end|ng |rom uw@ter|oo@c@  Thu Aug 11 20:43:44 2022
From: m@r|u@@ho|ert @end|ng |rom uw@ter|oo@c@ (Marius Hofert)
Date: Thu, 11 Aug 2022 18:43:44 +0000
Subject: [R-pkg-devel] How to write a 'cases' environment in .Rd files?
Message-ID: <YT3PR01MB1025002716E1ED5379E80126587649@YT3PR01MB10250.CANPRD01.PROD.OUTLOOK.COM>

Hi,

For quite some time my .Rd files had 'cases' environments like these:

\deqn{F(x) = \cases{
1,&if x > 0,\cr
0,&if x = 0.\cr}}{...}

Since recently, r-devel-linux-x86_64-debian-clang and r-devel-linux-x86_64-debian-gcc trigger the note 'Undefined control sequence: \cases in F(x) = \cases{...', possibly due to KaTeX rendering help pages. I looked around quite a bit but couldn't find a way to implement 'cases' environments. For example, https://katex.org/docs/supported.html#environments mentions \begin{cases} \end{cases}, so I tried

\deqn{F(x) = \begin{cases}
1,&\text{if}\ x > 0,\\
0,&\text{if} x = 0.}}{...}

but that triggers:

...
* checking PDF version of manual ... WARNING
LaTeX errors when creating PDF version.
This typically indicates Rd problems.
LaTeX errors found:
! Misplaced alignment tab character &
....

What is the proper way (is there one?) to get displayed 'cases' environments in .Rd files?

Thanks & cheers,
Marius

From deep@y@n@@@rk@r @end|ng |rom gm@||@com  Fri Aug 12 05:56:46 2022
From: deep@y@n@@@rk@r @end|ng |rom gm@||@com (Deepayan Sarkar)
Date: Fri, 12 Aug 2022 09:26:46 +0530
Subject: [R-pkg-devel] How to write a 'cases' environment in .Rd files?
In-Reply-To: <YT3PR01MB1025002716E1ED5379E80126587649@YT3PR01MB10250.CANPRD01.PROD.OUTLOOK.COM>
References: <YT3PR01MB1025002716E1ED5379E80126587649@YT3PR01MB10250.CANPRD01.PROD.OUTLOOK.COM>
Message-ID: <CADfFDC6zrqtD0tUsJbEDe2buo=nEeBXeUib7h+6LE5ZbTxkXyA@mail.gmail.com>

On Fri, Aug 12, 2022 at 12:14 AM Marius Hofert <marius.hofert at uwaterloo.ca>
wrote:

> Hi,
>
> For quite some time my .Rd files had 'cases' environments like these:
>
> \deqn{F(x) = \cases{
> 1,&if x > 0,\cr
> 0,&if x = 0.\cr}}{...}
>
> Since recently, r-devel-linux-x86_64-debian-clang and
> r-devel-linux-x86_64-debian-gcc trigger the note 'Undefined control
> sequence: \cases in F(x) = \cases{...', possibly due to KaTeX rendering
> help pages. I looked around quite a bit but couldn't find a way to
> implement 'cases' environments. For example,
> https://katex.org/docs/supported.html#environments mentions \begin{cases}
> \end{cases}, so I tried
>
> \deqn{F(x) = \begin{cases}
> 1,&\text{if}\ x > 0,\\
> 0,&\text{if} x = 0.}}{...}
>
> but that triggers:
>

Yes, the PDF refmans don't support amsmath (so no \begin{pmatrix},
\begin{cases}, etc.), although \pmatrix and \cases are supported. KaTeX has
it the other way around.

Unfortunately there is no nice workaround at the moment. Even if the PDF
version begins supporting \begin{cases} by including amsmath, \cases will
stop working, and your package will need to depend on a very recent R.

Possibly the only practical workaround is to use more basic LaTeX
constructs such as \begin{array}.

Best,
-Deepayan



>
> ...
> * checking PDF version of manual ... WARNING
> LaTeX errors when creating PDF version.
> This typically indicates Rd problems.
> LaTeX errors found:
> ! Misplaced alignment tab character &
> ....
>
> What is the proper way (is there one?) to get displayed 'cases'
> environments in .Rd files?
>
> Thanks & cheers,
> Marius
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Aug 12 08:15:39 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 12 Aug 2022 09:15:39 +0300
Subject: [R-pkg-devel] How to write a 'cases' environment in .Rd files?
In-Reply-To: <YT3PR01MB1025002716E1ED5379E80126587649@YT3PR01MB10250.CANPRD01.PROD.OUTLOOK.COM>
References: <YT3PR01MB1025002716E1ED5379E80126587649@YT3PR01MB10250.CANPRD01.PROD.OUTLOOK.COM>
Message-ID: <20220812091539.037d26da@trisector>

On Thu, 11 Aug 2022 18:43:44 +0000
Marius Hofert <marius.hofert at uwaterloo.ca> wrote:

> Since recently, r-devel-linux-x86_64-debian-clang and
> r-devel-linux-x86_64-debian-gcc trigger the note 'Undefined control
> sequence: \cases in F(x) = \cases{...', possibly due to KaTeX
> rendering help pages. I looked around quite a bit but couldn't find a
> way to implement 'cases' environments. For example,
> https://katex.org/docs/supported.html#environments mentions
> \begin{cases} \end{cases}, so I tried
> 
> \deqn{F(x) = \begin{cases}
> 1,&\text{if}\ x > 0,\\
> 0,&\text{if} x = 0.}}{...}
> 
> but that triggers:
> 
> ...
> * checking PDF version of manual ... WARNING
> LaTeX errors when creating PDF version.
> This typically indicates Rd problems.
> LaTeX errors found:
> ! Misplaced alignment tab character &

There is a possible workaround, but it's the opposite of beautiful. You
can use conditional text to compile one version of the formula for HTML
help and another one for PDF help:

\ifelse{html}{\eqn{\begin{cases}...}}{\eqn{\cases{...}}{ascii}}

It's as tedious as it looks. For extra style(?) points, you can put a
three-argument user-defined macro in man/macros/whatever.Rd that
forwards its arguments to one of the \ifelse branches. As far as I
remember, \newcommand{}{} has to fit on one line, but in R ? 3.6.0,
macros themselves can take multi-line arguments.

If you're targeting an earlier version of R, you can make multi-line
arguments work by forcing R to cache the parse tree of the man page
while building a source tarball with a newer R version using
\Sexpr[stage=build]{}, costing you some time during R CMD build and a
slightly larger source tarball. (It's an implementation detail that one
normally shouldn't depend upon. Thankfully, as of 2022, there won't be
any newer versions of R ? 3.5.x to break it.) Support for
man/macros/*.Rd only appeared in R-3.2.0, so I haven't researched
compatibility tricks for even older versions of R.

-- 
Best regards,
Ivan


From m@r|u@@ho|ert @end|ng |rom uw@ter|oo@c@  Fri Aug 12 13:00:50 2022
From: m@r|u@@ho|ert @end|ng |rom uw@ter|oo@c@ (Marius Hofert)
Date: Fri, 12 Aug 2022 11:00:50 +0000
Subject: [R-pkg-devel] How to write a 'cases' environment in .Rd files?
In-Reply-To: <1MNKhm-1o33f53oF8-00On1j@mail.gmx.net>
References: <20220812091539.037d26da@trisector>
 <1MNKhm-1o33f53oF8-00On1j@mail.gmx.net>
Message-ID: <YT3PR01MB10250F9BD5E7AFE967231082A87679@YT3PR01MB10250.CANPRD01.PROD.OUTLOOK.COM>

Hi,

Thanks everyone for your suggestions. I now went with the easiest solution, namely something of the form

\deqn{F(x) = \left\{\begin{array}{ll}
1,&\text{if}\ x > 0,\\
0,&\text{if} x = 0.
\end{array}\right.}{...}

which worked flawlessly (and avoids having to type the formula twice or define a macro as suggested by Ivan).

Cheers,
Marius

________________________________________
From: matthias-gondan <matthias-gondan at gmx.de>
Sent: Friday, August 12, 2022 03:09
To: Ivan Krylov; Marius Hofert
Cc: r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] How to write a 'cases' environment in .Rd files?

I am currently developing an R package that translates R expressions to Html and Latex, things like dbinom(x, size, prob) to P\left(x; N, \pi\right)

Generation of Rd files may be an interesting use case. It's still at an early stage, I appreciate contributions and interesting feature requests.

github.com/mgondan/mathml




Von meinem/meiner Galaxy gesendet


-------- Urspr?ngliche Nachricht --------
Von: Ivan Krylov <krylov.r00t at gmail.com>
Datum: 12.08.22 08:16 (GMT+01:00)
An: Marius Hofert <marius.hofert at uwaterloo.ca>
Cc: r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] How to write a 'cases' environment in .Rd files?

On Thu, 11 Aug 2022 18:43:44 +0000
Marius Hofert <marius.hofert at uwaterloo.ca> wrote:

> Since recently, r-devel-linux-x86_64-debian-clang and
> r-devel-linux-x86_64-debian-gcc trigger the note 'Undefined control
> sequence: \cases in F(x) = \cases{...', possibly due to KaTeX
> rendering help pages. I looked around quite a bit but couldn't find a
> way to implement 'cases' environments. For example,
> https://katex.org/docs/supported.html#environments mentions
> \begin{cases} \end{cases}, so I tried
>
> \deqn{F(x) = \begin{cases}
> 1,&\text{if}\ x > 0,\\
> 0,&\text{if} x = 0.}}{...}
>
> but that triggers:
>
> ...
> * checking PDF version of manual ... WARNING
> LaTeX errors when creating PDF version.
> This typically indicates Rd problems.
> LaTeX errors found:
> ! Misplaced alignment tab character &

There is a possible workaround, but it's the opposite of beautiful. You
can use conditional text to compile one version of the formula for HTML
help and another one for PDF help:

\ifelse{html}{\eqn{\begin{cases}...}}{\eqn{\cases{...}}{ascii}}

It's as tedious as it looks. For extra style(?) points, you can put a
three-argument user-defined macro in man/macros/whatever.Rd that
forwards its arguments to one of the \ifelse branches. As far as I
remember, \newcommand{}{} has to fit on one line, but in R ? 3.6.0,
macros themselves can take multi-line arguments.

If you're targeting an earlier version of R, you can make multi-line
arguments work by forcing R to cache the parse tree of the man page
while building a source tarball with a newer R version using
\Sexpr[stage=build]{}, costing you some time during R CMD build and a
slightly larger source tarball. (It's an implementation detail that one
normally shouldn't depend upon. Thankfully, as of 2022, there won't be
any newer versions of R ? 3.5.x to break it.) Support for
man/macros/*.Rd only appeared in R-3.2.0, so I haven't researched
compatibility tricks for even older versions of R.

--
Best regards,
Ivan

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

From pro|jcn@@h @end|ng |rom gm@||@com  Sat Aug 13 00:40:39 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Fri, 12 Aug 2022 18:40:39 -0400
Subject: [R-pkg-devel] Strange behaviour of function called from within a
 function
Message-ID: <81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>

I have been trying to sort out an odd issue for the last few days in upgrading package
nlsr (for nonlinear least squares). It generally does much better in finding solutions from
poor starts than nls(), but it does not generate the full nls returned object. I've written a
wrapper wrapnlsr() that calls my nlsr functions then uses the resulting parameters in nls()
to get the nls object. But up to now, neither weights nor subset are allowed. I've not got
to subset, but have been trying weights, with very strange results. The full example is too
much code for the list, so I've faked the nlsr output as "firstcoef" in the example below.
What is troubling is that a hand-run example "works", but using a function to do it fails
when there are weights.

The nls.R code referenced in the example around line 570 may suggest that its handling the
weights may be the culprit here. I don't understand why
     eval(substitute(weights), data, environment(formula))
is needed for a fixed numeric vector of weights (as required by the manual).

Any help welcome.

John Nash

The example:

# wterr.R -- reproduce nls error when called from function
rm(list=ls()) # probably not needed, but clear the workspace

tnow <- function(formula, data, start, control, trace) {
   firstcoef <- c(b1=199, b2=50, b3=0.3) # as if from another solver
   cat("firstcoef:\n")
   print(firstcoef)
   cat("No weights\n")
   second<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE)
   second
}

tw <- function(formula, data, start, control, trace, weights) {
   firstcoef <- c(b1=199, b2=50, b3=0.3)
   cat("firstcoef:\n")
   print(firstcoef)
   cat("weights:"); print(weights)
   secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights=weights)
   secondw
}

weed <- c(5.308, 7.24, 9.638, 12.866, 17.069, 23.192, 31.443,
           38.558, 50.156, 62.948, 75.995, 91.972)
tt <- 1:12
weeddf <- data.frame(tt, weed)
hobbsu <- weed ~ b1/(1+b2*exp(-b3*tt))
st2 <- c(b1=200, b2=50, b3=0.3)
wts <- 0.5^tt # a straight scaling comes via wts <- rep(0.01, 12)
# From this level, we can do the calculation
firstcoef <- c(b1=199, b2=50, b3=0.3)

# Does NOT work from the function tw with weights, but unweighted OK.
# Is the issue line 570/571 of ./R-4.2.1/src/library/stats/R/nls.R ??
tn2<-tnow(hobbsu, weeddf, st2, control=list(), trace=TRUE)
tn2
tt2<-tw(hobbsu, weeddf, st2, control=list(), trace=TRUE, weights=wts)
tt2

# But we can get it running directly
formula<-hobbsu
data<-weeddf
control<-list()
weights<-wts
second<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE)
second
secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights=weights)
secondw
# And if we rerun the functions AFTER succeeding here, tw now works
tn2<-tnow(hobbsu, weeddf, st2, control=list(), trace=TRUE)
tn2
tt2<-tw(hobbsu, weeddf, st2, control=list(), trace=TRUE, weights=wts)
tt2


From no@h@gre||er @end|ng |rom gm@||@com  Sat Aug 13 00:52:56 2022
From: no@h@gre||er @end|ng |rom gm@||@com (Noah Greifer)
Date: Fri, 12 Aug 2022 18:52:56 -0400
Subject: [R-pkg-devel] 
 Strange behaviour of function called from within a function
In-Reply-To: <81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
References: <81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
Message-ID: <CAPhhD8khrJK1WLrYzZeLC+xCq6JRVirZm3MkcX9BvjjKW_+9Eg@mail.gmail.com>

This is an unfortunate problem caused by non-standard evaluation of the
`weights` argument. It happens with `lm()`, too. To solve it, you should
use do.call(), e.g.,

secondw <- do.call("nls", list(formula, data, firstcoef, control,
algorithm=NULL, TRUE, weights = weights))

The reason this works is that `weights` is evaluated in the `list()` call,
which uses standard evaluation, before being passed to `nls()`, rather than
in the `nls()` call. Using `alist()` instead, which doesn't evaluate its
arguments, creates the same problem. You unfortunately have to do this with
every function that involves nonstandard evaluation.

The error that you get, "invalid type (closure) for variable '(weights)'",
occurs because `nls()` is interpreting `weights` as the function
`weights()`, which is a closure (basically the same thing as a function),
rather than as the argument passed through the `weights` argument of
`tw()`.

Noah

On Fri, Aug 12, 2022 at 6:41 PM J C Nash <profjcnash at gmail.com> wrote:

> I have been trying to sort out an odd issue for the last few days in
> upgrading package
> nlsr (for nonlinear least squares). It generally does much better in
> finding solutions from
> poor starts than nls(), but it does not generate the full nls returned
> object. I've written a
> wrapper wrapnlsr() that calls my nlsr functions then uses the resulting
> parameters in nls()
> to get the nls object. But up to now, neither weights nor subset are
> allowed. I've not got
> to subset, but have been trying weights, with very strange results. The
> full example is too
> much code for the list, so I've faked the nlsr output as "firstcoef" in
> the example below.
> What is troubling is that a hand-run example "works", but using a function
> to do it fails
> when there are weights.
>
> The nls.R code referenced in the example around line 570 may suggest that
> its handling the
> weights may be the culprit here. I don't understand why
>      eval(substitute(weights), data, environment(formula))
> is needed for a fixed numeric vector of weights (as required by the
> manual).
>
> Any help welcome.
>
> John Nash
>
> The example:
>
> # wterr.R -- reproduce nls error when called from function
> rm(list=ls()) # probably not needed, but clear the workspace
>
> tnow <- function(formula, data, start, control, trace) {
>    firstcoef <- c(b1=199, b2=50, b3=0.3) # as if from another solver
>    cat("firstcoef:\n")
>    print(firstcoef)
>    cat("No weights\n")
>    second<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE)
>    second
> }
>
> tw <- function(formula, data, start, control, trace, weights) {
>    firstcoef <- c(b1=199, b2=50, b3=0.3)
>    cat("firstcoef:\n")
>    print(firstcoef)
>    cat("weights:"); print(weights)
>    secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE,
> weights=weights)
>    secondw
> }
>
> weed <- c(5.308, 7.24, 9.638, 12.866, 17.069, 23.192, 31.443,
>            38.558, 50.156, 62.948, 75.995, 91.972)
> tt <- 1:12
> weeddf <- data.frame(tt, weed)
> hobbsu <- weed ~ b1/(1+b2*exp(-b3*tt))
> st2 <- c(b1=200, b2=50, b3=0.3)
> wts <- 0.5^tt # a straight scaling comes via wts <- rep(0.01, 12)
> # From this level, we can do the calculation
> firstcoef <- c(b1=199, b2=50, b3=0.3)
>
> # Does NOT work from the function tw with weights, but unweighted OK.
> # Is the issue line 570/571 of ./R-4.2.1/src/library/stats/R/nls.R ??
> tn2<-tnow(hobbsu, weeddf, st2, control=list(), trace=TRUE)
> tn2
> tt2<-tw(hobbsu, weeddf, st2, control=list(), trace=TRUE, weights=wts)
> tt2
>
> # But we can get it running directly
> formula<-hobbsu
> data<-weeddf
> control<-list()
> weights<-wts
> second<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE)
> second
> secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE,
> weights=weights)
> secondw
> # And if we rerun the functions AFTER succeeding here, tw now works
> tn2<-tnow(hobbsu, weeddf, st2, control=list(), trace=TRUE)
> tn2
> tt2<-tw(hobbsu, weeddf, st2, control=list(), trace=TRUE, weights=wts)
> tt2
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From j|ox @end|ng |rom mcm@@ter@c@  Sat Aug 13 00:54:40 2022
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Fri, 12 Aug 2022 18:54:40 -0400
Subject: [R-pkg-devel] 
 Strange behaviour of function called from within a function
In-Reply-To: <4312_1660344060_27CMexOO029722_81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
References: <4312_1660344060_27CMexOO029722_81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
Message-ID: <9a39963d-9d48-806c-81f6-5f6174da5c2f@mcmaster.ca>

Dear John,

This is a scoping issue due to how model formulas are evaluated by nls() 
and other modeling functions. Try this:

tw2 <- function(formula, data, start, control, trace, weights) {
   firstcoef <- c(b1=199, b2=50, b3=0.3)
   cat("firstcoef:\n")
   print(firstcoef)
   cat("weights:"); print(weights)
   data$weights <- weights
   secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, 
weights=weights)
   secondw
}

 > tw2(hobbsu, weeddf, st2, control=list(), trace=TRUE, weights=wts)
firstcoef:
    b1    b2    b3
199.0  50.0   0.3
weights: [1] 0.5000000000 0.2500000000 0.1250000000 0.0625000000 
0.0312500000 0.0156250000
  [7] 0.0078125000 0.0039062500 0.0019531250 0.0009765625 0.0004882812 
0.0002441406
0.3342481   (3.98e+00): par = (199 50 0.3)
0.01987378  (1.14e-01): par = (199.2897 50.14155 0.3139337)
0.01961683  (2.88e-04): par = (199.8481 50.2582 0.3133964)
0.01961683  (1.97e-06): par = (199.8595 50.26061 0.3133932)
Nonlinear regression model
   model: weed ~ b1/(1 + b2 * exp(-b3 * tt))
    data: data
       b1       b2       b3
199.8595  50.2606   0.3134
  weighted residual sum-of-squares: 0.01962

Number of iterations to convergence: 3
Achieved convergence tolerance: 1.975e-06

(Your second attempt worked because you stuck the variable weights in 
the global environment.)

I hope that this does what you want.

John

On 2022-08-12 6:40 p.m., J C Nash wrote:
> I have been trying to sort out an odd issue for the last few days in 
> upgrading package
> nlsr (for nonlinear least squares). It generally does much better in 
> finding solutions from
> poor starts than nls(), but it does not generate the full nls returned 
> object. I've written a
> wrapper wrapnlsr() that calls my nlsr functions then uses the resulting 
> parameters in nls()
> to get the nls object. But up to now, neither weights nor subset are 
> allowed. I've not got
> to subset, but have been trying weights, with very strange results. The 
> full example is too
> much code for the list, so I've faked the nlsr output as "firstcoef" in 
> the example below.
> What is troubling is that a hand-run example "works", but using a 
> function to do it fails
> when there are weights.
> 
> The nls.R code referenced in the example around line 570 may suggest 
> that its handling the
> weights may be the culprit here. I don't understand why
>  ??? eval(substitute(weights), data, environment(formula))
> is needed for a fixed numeric vector of weights (as required by the 
> manual).
> 
> Any help welcome.
> 
> John Nash
> 
> The example:
> 
> # wterr.R -- reproduce nls error when called from function
> rm(list=ls()) # probably not needed, but clear the workspace
> 
> tnow <- function(formula, data, start, control, trace) {
>  ? firstcoef <- c(b1=199, b2=50, b3=0.3) # as if from another solver
>  ? cat("firstcoef:\n")
>  ? print(firstcoef)
>  ? cat("No weights\n")
>  ? second<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE)
>  ? second
> }
> 
> tw <- function(formula, data, start, control, trace, weights) {
>  ? firstcoef <- c(b1=199, b2=50, b3=0.3)
>  ? cat("firstcoef:\n")
>  ? print(firstcoef)
>  ? cat("weights:"); print(weights)
>  ? secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, 
> weights=weights)
>  ? secondw
> }
> 
> weed <- c(5.308, 7.24, 9.638, 12.866, 17.069, 23.192, 31.443,
>  ????????? 38.558, 50.156, 62.948, 75.995, 91.972)
> tt <- 1:12
> weeddf <- data.frame(tt, weed)
> hobbsu <- weed ~ b1/(1+b2*exp(-b3*tt))
> st2 <- c(b1=200, b2=50, b3=0.3)
> wts <- 0.5^tt # a straight scaling comes via wts <- rep(0.01, 12)
> # From this level, we can do the calculation
> firstcoef <- c(b1=199, b2=50, b3=0.3)
> 
> # Does NOT work from the function tw with weights, but unweighted OK.
> # Is the issue line 570/571 of ./R-4.2.1/src/library/stats/R/nls.R ??
> tn2<-tnow(hobbsu, weeddf, st2, control=list(), trace=TRUE)
> tn2
> tt2<-tw(hobbsu, weeddf, st2, control=list(), trace=TRUE, weights=wts)
> tt2
> 
> # But we can get it running directly
> formula<-hobbsu
> data<-weeddf
> control<-list()
> weights<-wts
> second<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE)
> second
> secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, 
> weights=weights)
> secondw
> # And if we rerun the functions AFTER succeeding here, tw now works
> tn2<-tnow(hobbsu, weeddf, st2, control=list(), trace=TRUE)
> tn2
> tt2<-tw(hobbsu, weeddf, st2, control=list(), trace=TRUE, weights=wts)
> tt2
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/


From pro|jcn@@h @end|ng |rom gm@||@com  Sat Aug 13 15:41:02 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sat, 13 Aug 2022 09:41:02 -0400
Subject: [R-pkg-devel] 
 Strange behaviour of function called from within a function
In-Reply-To: <9a39963d-9d48-806c-81f6-5f6174da5c2f@mcmaster.ca>
References: <4312_1660344060_27CMexOO029722_81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
 <9a39963d-9d48-806c-81f6-5f6174da5c2f@mcmaster.ca>
Message-ID: <f0058c1e-5f42-c2f4-cc06-751d5f7380c8@gmail.com>


Thanks to John Fox and Noah Greifer. Both their approaches resolved my immediate
problem.

That is, to provide a summary of the fix of my example code,

tw <- function(formula, data, start, control, trace, weights) {
   firstcoef <- c(b1=199, b2=50, b3=0.3)
   cat("firstcoef:\n")
   print(firstcoef)
   cat("weights:"); print(weights)
# Following fails -- closure error
#  secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights=weights)
# from noah.greifer at gmail.com # this works OK
   secondw <- do.call("nls", list(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights = weights))
#  As does putting weights in the data dataframe (here not active)
#  data$weights <- weights # from John Fox
#  secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights=weights)
   secondw
}

Afraid I avoid the wonders of non-standard evaluation, and this time it jumped up and bit me.
But then I remember what machine instruction 260000800009 did on an IBM 1620.

The swiftness of reply from John and Noah was much appreciated.

Best, JN


From j|ox @end|ng |rom mcm@@ter@c@  Sat Aug 13 18:58:44 2022
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Sat, 13 Aug 2022 12:58:44 -0400
Subject: [R-pkg-devel] 
 Strange behaviour of function called from within a function
In-Reply-To: <f0058c1e-5f42-c2f4-cc06-751d5f7380c8@gmail.com>
References: <4312_1660344060_27CMexOO029722_81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
 <9a39963d-9d48-806c-81f6-5f6174da5c2f@mcmaster.ca>
 <f0058c1e-5f42-c2f4-cc06-751d5f7380c8@gmail.com>
Message-ID: <5081732f-0ec7-9d7d-8e6e-247ed1c7b6b7@mcmaster.ca>

Dear John,

After further thought, it's probably a better idea to evaluate the 
weights argument in the same environment as the formula rather than to 
bypass nonstandard evaluation. You could use lm() as a guide. I don't 
entirely understand what you're trying to do so maybe this suggestion is 
off-base.

Best,
  John

On 2022-08-13 9:41 a.m., J C Nash wrote:
> 
> Thanks to John Fox and Noah Greifer. Both their approaches resolved my 
> immediate
> problem.
> 
> That is, to provide a summary of the fix of my example code,
> 
> tw <- function(formula, data, start, control, trace, weights) {
>  ? firstcoef <- c(b1=199, b2=50, b3=0.3)
>  ? cat("firstcoef:\n")
>  ? print(firstcoef)
>  ? cat("weights:"); print(weights)
> # Following fails -- closure error
> #? secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, 
> weights=weights)
> # from noah.greifer at gmail.com # this works OK
>  ? secondw <- do.call("nls", list(formula, data, firstcoef, control, 
> algorithm=NULL, TRUE, weights = weights))
> #? As does putting weights in the data dataframe (here not active)
> #? data$weights <- weights # from John Fox
> #? secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, 
> weights=weights)
>  ? secondw
> }
> 
> Afraid I avoid the wonders of non-standard evaluation, and this time it 
> jumped up and bit me.
> But then I remember what machine instruction 260000800009 did on an IBM 
> 1620.
> 
> The swiftness of reply from John and Noah was much appreciated.
> 
> Best, JN
-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/


From pro|jcn@@h @end|ng |rom gm@||@com  Sat Aug 13 19:15:51 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sat, 13 Aug 2022 13:15:51 -0400
Subject: [R-pkg-devel] 
 Strange behaviour of function called from within a function
In-Reply-To: <5081732f-0ec7-9d7d-8e6e-247ed1c7b6b7@mcmaster.ca>
References: <4312_1660344060_27CMexOO029722_81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
 <9a39963d-9d48-806c-81f6-5f6174da5c2f@mcmaster.ca>
 <f0058c1e-5f42-c2f4-cc06-751d5f7380c8@gmail.com>
 <5081732f-0ec7-9d7d-8e6e-247ed1c7b6b7@mcmaster.ca>
Message-ID: <187d12ae-d324-e1a9-1741-98bb3fd455c1@gmail.com>

This posting is to answer "what I'm trying to do". Otherwise can be skipped.

My nlsr package has a completely different structure (philosophy?) from nls(). My aim is to
try VERY hard to get solutions and not give up with "singular gradient" or other issues as
nls() does. But the package is quite lean and doesn't return a lot of useful bits and pieces,
such as nls returned functions and model stuff. So I've got a wrapnlsr() function that runs my
solver, then passes the best parameters to nls(). This won't always work, for example, if
the Jacobian at the best parameters is still singular, but very often it will, and the
wrapper then returns all the goodies and a user can use the output as per nls().

Because my activities don't often get into those spin-offs of nls() -- for instance the
profile plots -- I really need some collaborators if nlsr is going to get more capable in
that regard. However, I feel the wrapper is at least a start.

For anyone interested, I have been tightening up the nlsr package and also trying to build a
quite comprehensive collection of examples. Some areas of improvement are in applying bounds
and masks (fixed parameters) and using selfStart models. There is still plenty to do, but the
base package nlsr should be upgraded on CRAN in a few weeks. If anyone is anxious to try it,
let me know. The changes are mostly internal. The examples collection is going to take a bit
longer to get tidy, but I'll be happy to share those too. Material is on Gitlab or Github,
though definitely a work in progress and updated daily, often with loose ends.

Best, JN

PS. Why would we "evaluate" the weights? The nls() man-page says they are fixed numbers, but
the nls.R code I pointed to does evaluate them, and that seems to be the trouble. Is that a bug?

On 2022-08-13 12:58, John Fox wrote:
> Dear John,
> 
> After further thought, it's probably a better idea to evaluate the weights argument in the same environment as the 
> formula rather than to bypass nonstandard evaluation. You could use lm() as a guide. I don't entirely understand what 
> you're trying to do so maybe this suggestion is off-base.
> 
> Best,
>  ?John
> 
> On 2022-08-13 9:41 a.m., J C Nash wrote:
>>
>> Thanks to John Fox and Noah Greifer. Both their approaches resolved my immediate
>> problem.
>>
>> That is, to provide a summary of the fix of my example code,
>>
>> tw <- function(formula, data, start, control, trace, weights) {
>> ?? firstcoef <- c(b1=199, b2=50, b3=0.3)
>> ?? cat("firstcoef:\n")
>> ?? print(firstcoef)
>> ?? cat("weights:"); print(weights)
>> # Following fails -- closure error
>> #? secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights=weights)
>> # from noah.greifer at gmail.com # this works OK
>> ?? secondw <- do.call("nls", list(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights = weights))
>> #? As does putting weights in the data dataframe (here not active)
>> #? data$weights <- weights # from John Fox
>> #? secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, TRUE, weights=weights)
>> ?? secondw
>> }
>>
>> Afraid I avoid the wonders of non-standard evaluation, and this time it jumped up and bit me.
>> But then I remember what machine instruction 260000800009 did on an IBM 1620.
>>
>> The swiftness of reply from John and Noah was much appreciated.
>>
>> Best, JN


From j|ox @end|ng |rom mcm@@ter@c@  Sat Aug 13 20:27:39 2022
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Sat, 13 Aug 2022 14:27:39 -0400
Subject: [R-pkg-devel] 
 Strange behaviour of function called from within a function
In-Reply-To: <187d12ae-d324-e1a9-1741-98bb3fd455c1@gmail.com>
References: <4312_1660344060_27CMexOO029722_81078bd7-d89f-ab7e-b8ec-793744ef2971@gmail.com>
 <9a39963d-9d48-806c-81f6-5f6174da5c2f@mcmaster.ca>
 <f0058c1e-5f42-c2f4-cc06-751d5f7380c8@gmail.com>
 <5081732f-0ec7-9d7d-8e6e-247ed1c7b6b7@mcmaster.ca>
 <187d12ae-d324-e1a9-1741-98bb3fd455c1@gmail.com>
Message-ID: <df5ebd1b-5885-1a8b-6c48-bda4b68ee593@mcmaster.ca>

Dear John,

Please see below interline:

On 2022-08-13 1:15 p.m., J C Nash wrote:
> This posting is to answer "what I'm trying to do". Otherwise can be 
> skipped.
> 
> My nlsr package has a completely different structure (philosophy?) from 
> nls(). My aim is to
> try VERY hard to get solutions and not give up with "singular gradient" 
> or other issues as
> nls() does. But the package is quite lean and doesn't return a lot of 
> useful bits and pieces,
> such as nls returned functions and model stuff. So I've got a wrapnlsr() 
> function that runs my
> solver, then passes the best parameters to nls(). This won't always 
> work, for example, if
> the Jacobian at the best parameters is still singular, but very often it 
> will, and the
> wrapper then returns all the goodies and a user can use the output as 
> per nls().
> 
> Because my activities don't often get into those spin-offs of nls() -- 
> for instance the
> profile plots -- I really need some collaborators if nlsr is going to 
> get more capable in
> that regard. However, I feel the wrapper is at least a start.

If I understand correctly, there are two contexts here: (1) the 
interface for your wrapnlsr() function, and (2) how nlsr() calls other 
functions, including nls().

The first should probably work like a standard statistical modelling 
function, including how the weights argument is evaluated. The second is 
hidden from the user, and is where the scoping issue that you reported 
arose. My suggestion to follow a standard statistical modelling function 
here is probably off-base, and the previous two solutions, one from me 
and one from Noah, both work.

With respect to my solution: if you actually adopt it, I'd prefer not to 
use a name like data$weights, for fear of overwriting an existing 
variable in data called weights, but rather some like .weights or even 
..weights.. .

> 
> For anyone interested, I have been tightening up the nlsr package and 
> also trying to build a
> quite comprehensive collection of examples. Some areas of improvement 
> are in applying bounds
> and masks (fixed parameters) and using selfStart models. There is still 
> plenty to do, but the
> base package nlsr should be upgraded on CRAN in a few weeks. If anyone 
> is anxious to try it,
> let me know. The changes are mostly internal. The examples collection is 
> going to take a bit
> longer to get tidy, but I'll be happy to share those too. Material is on 
> Gitlab or Github,
> though definitely a work in progress and updated daily, often with loose 
> ends.

I'm probably the wrong person for this -- I'm familiar with nonlinear 
regression, but your knowledge of the computational details vastly 
exceeds mine.

> 
> Best, JN
> 
> PS. Why would we "evaluate" the weights? The nls() man-page says they 
> are fixed numbers, but
> the nls.R code I pointed to does evaluate them, and that seems to be the 
> trouble. Is that a bug?

What I meant by "evaluate" was associate a value with the symbol 
weights. The scoping issue was that nls() ended up looking in the global 
environment, where it found the weights() function rather than the local 
variable (i.e., argument) weights in your function.

Best,
  John

> 
> On 2022-08-13 12:58, John Fox wrote:
>> Dear John,
>>
>> After further thought, it's probably a better idea to evaluate the 
>> weights argument in the same environment as the formula rather than to 
>> bypass nonstandard evaluation. You could use lm() as a guide. I don't 
>> entirely understand what you're trying to do so maybe this suggestion 
>> is off-base.
>>
>> Best,
>> ??John
>>
>> On 2022-08-13 9:41 a.m., J C Nash wrote:
>>>
>>> Thanks to John Fox and Noah Greifer. Both their approaches resolved 
>>> my immediate
>>> problem.
>>>
>>> That is, to provide a summary of the fix of my example code,
>>>
>>> tw <- function(formula, data, start, control, trace, weights) {
>>> ?? firstcoef <- c(b1=199, b2=50, b3=0.3)
>>> ?? cat("firstcoef:\n")
>>> ?? print(firstcoef)
>>> ?? cat("weights:"); print(weights)
>>> # Following fails -- closure error
>>> #? secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, 
>>> TRUE, weights=weights)
>>> # from noah.greifer at gmail.com # this works OK
>>> ?? secondw <- do.call("nls", list(formula, data, firstcoef, control, 
>>> algorithm=NULL, TRUE, weights = weights))
>>> #? As does putting weights in the data dataframe (here not active)
>>> #? data$weights <- weights # from John Fox
>>> #? secondw<-nls(formula, data, firstcoef, control, algorithm=NULL, 
>>> TRUE, weights=weights)
>>> ?? secondw
>>> }
>>>
>>> Afraid I avoid the wonders of non-standard evaluation, and this time 
>>> it jumped up and bit me.
>>> But then I remember what machine instruction 260000800009 did on an 
>>> IBM 1620.
>>>
>>> The swiftness of reply from John and Noah was much appreciated.
>>>
>>> Best, JN
-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Sun Aug 14 01:09:54 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Sat, 13 Aug 2022 23:09:54 +0000
Subject: [R-pkg-devel] Windows check time blowout on R-devel
Message-ID: <SY4PR01MB5658B18A5A97B37DA06BDE0AAC669@SY4PR01MB5658.ausprd01.prod.outlook.com>

A slight revision of a longstanding CRAN package 'secr' (prompted by CRAN changes in math rendering) was archived on pre-test because of an increase in overall check time on R-devel. This seems to be beyond my control - what should I do?

The package is at https://github.com/MurrayEfford/secr.

I have extracted what seem like the relevant check lines below

# Winbuilder R-oldrelease Check time in seconds: 660
* using R version 4.1.3 (2022-03-10)
* using platform: x86_64-w64-mingw32 (64-bit)
* checking R code for possible problems ... [82s] OK
* checking Rd files ... [4s] OK
** running examples for arch 'x64' ... [59s] OK
** running tests for arch 'x64' ... [56s] OK
* checking re-building of vignette outputs ... [24s] OK

# Winbuilder R-release Check time in seconds: 665
* using R version 4.2.1 (2022-06-23 ucrt)
* using platform: x86_64-w64-mingw32 (64-bit)
* checking R code for possible problems ... [89s] OK
* checking Rd files ... [6s] OK
* checking examples ... [72s] OK
* checking tests ... [67s] OK
* checking re-building of vignette outputs ... [53s] OK

# Winbuilder R-devel Check time in seconds: 835
* using R Under development (unstable) (2022-08-11 r82713 ucrt)
* using platform: x86_64-w64-mingw32 (64-bit)
* checking R code for possible problems ... [147s] OK
* checking Rd files ... [8s] OK
* checking examples ... [113s] OK
* checking tests ... [101s] OK
* checking re-building of vignette outputs ... [41s] OK

# CRAN pre-test Windows
* using log directory 'd:/RCompile/CRANincoming/R-devel/secr.Rcheck'
* using R Under development (unstable) (2022-08-11 r82713 ucrt)
* using platform: x86_64-w64-mingw32 (64-bit)
* checking R code for possible problems ... [147s] OK
* checking Rd files ... [8s] OK
* checking examples ... [106s] OK
* checking tests ... [102s] OK
* checking re-building of vignette outputs ... [39s] OK

# CRAN pre-test Debian
* using log directory ?/srv/hornik/tmp/CRAN/secr.Rcheck?
* using R Under development (unstable) (2022-08-11 r82713)
* using platform: x86_64-pc-linux-gnu (64-bit)
* checking R code for possible problems ... [52s/52s] OK
* checking Rd files ... [1s/1s] OK
* checking examples ... [47s/47s] OK
* checking tests ... [19s/19s] OK
* checking re-building of vignette outputs ... [10s/10s] OK


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Aug 15 11:10:57 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 15 Aug 2022 11:10:57 +0200
Subject: [R-pkg-devel] Windows check time blowout on R-devel
In-Reply-To: <SY4PR01MB5658B18A5A97B37DA06BDE0AAC669@SY4PR01MB5658.ausprd01.prod.outlook.com>
References: <SY4PR01MB5658B18A5A97B37DA06BDE0AAC669@SY4PR01MB5658.ausprd01.prod.outlook.com>
Message-ID: <1934c691-8dab-b3a5-caf6-81944135f80c@statistik.tu-dortmund.de>

Tell it the CRAN admins.

Best,
Uwe Ligges

On 14.08.2022 01:09, Murray Efford wrote:
> A slight revision of a longstanding CRAN package 'secr' (prompted by CRAN changes in math rendering) was archived on pre-test because of an increase in overall check time on R-devel. This seems to be beyond my control - what should I do?
> 
> The package is at https://github.com/MurrayEfford/secr.
> 
> I have extracted what seem like the relevant check lines below
> 
> # Winbuilder R-oldrelease Check time in seconds: 660
> * using R version 4.1.3 (2022-03-10)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [82s] OK
> * checking Rd files ... [4s] OK
> ** running examples for arch 'x64' ... [59s] OK
> ** running tests for arch 'x64' ... [56s] OK
> * checking re-building of vignette outputs ... [24s] OK
> 
> # Winbuilder R-release Check time in seconds: 665
> * using R version 4.2.1 (2022-06-23 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [89s] OK
> * checking Rd files ... [6s] OK
> * checking examples ... [72s] OK
> * checking tests ... [67s] OK
> * checking re-building of vignette outputs ... [53s] OK
> 
> # Winbuilder R-devel Check time in seconds: 835
> * using R Under development (unstable) (2022-08-11 r82713 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [147s] OK
> * checking Rd files ... [8s] OK
> * checking examples ... [113s] OK
> * checking tests ... [101s] OK
> * checking re-building of vignette outputs ... [41s] OK
> 
> # CRAN pre-test Windows
> * using log directory 'd:/RCompile/CRANincoming/R-devel/secr.Rcheck'
> * using R Under development (unstable) (2022-08-11 r82713 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [147s] OK
> * checking Rd files ... [8s] OK
> * checking examples ... [106s] OK
> * checking tests ... [102s] OK
> * checking re-building of vignette outputs ... [39s] OK
> 
> # CRAN pre-test Debian
> * using log directory ?/srv/hornik/tmp/CRAN/secr.Rcheck?
> * using R Under development (unstable) (2022-08-11 r82713)
> * using platform: x86_64-pc-linux-gnu (64-bit)
> * checking R code for possible problems ... [52s/52s] OK
> * checking Rd files ... [1s/1s] OK
> * checking examples ... [47s/47s] OK
> * checking tests ... [19s/19s] OK
> * checking re-building of vignette outputs ... [10s/10s] OK
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murr@y@e||ord @end|ng |rom ot@go@@c@nz  Mon Aug 15 12:00:04 2022
From: murr@y@e||ord @end|ng |rom ot@go@@c@nz (Murray Efford)
Date: Mon, 15 Aug 2022 10:00:04 +0000
Subject: [R-pkg-devel] Windows check time blowout on R-devel
In-Reply-To: <1934c691-8dab-b3a5-caf6-81944135f80c@statistik.tu-dortmund.de>
References: <SY4PR01MB5658B18A5A97B37DA06BDE0AAC669@SY4PR01MB5658.ausprd01.prod.outlook.com>
 <1934c691-8dab-b3a5-caf6-81944135f80c@statistik.tu-dortmund.de>
Message-ID: <SY4PR01MB565861A77FD73C2D98A9BEF8AC689@SY4PR01MB5658.ausprd01.prod.outlook.com>

Thank you!

________________________________________
From: Uwe Ligges <ligges at statistik.tu-dortmund.de>
Sent: 15 August 2022 21:10
To: Murray Efford; r-package-devel at r-project.org
Subject: Re: [R-pkg-devel] Windows check time blowout on R-devel

Tell it the CRAN admins.

Best,
Uwe Ligges

On 14.08.2022 01:09, Murray Efford wrote:
> A slight revision of a longstanding CRAN package 'secr' (prompted by CRAN changes in math rendering) was archived on pre-test because of an increase in overall check time on R-devel. This seems to be beyond my control - what should I do?
>
> The package is at https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FMurrayEfford%2Fsecr&amp;data=05%7C01%7Cmurray.efford%40otago.ac.nz%7C0d23bcf920b14c84827508da7e9e10a0%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637961514622179903%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=U%2Bn92AzpMxx%2BNg05%2Bt8QOSJSSFx7aryMrxw8%2BnmwIGs%3D&amp;reserved=0.
>
> I have extracted what seem like the relevant check lines below
>
> # Winbuilder R-oldrelease Check time in seconds: 660
> * using R version 4.1.3 (2022-03-10)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [82s] OK
> * checking Rd files ... [4s] OK
> ** running examples for arch 'x64' ... [59s] OK
> ** running tests for arch 'x64' ... [56s] OK
> * checking re-building of vignette outputs ... [24s] OK
>
> # Winbuilder R-release Check time in seconds: 665
> * using R version 4.2.1 (2022-06-23 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [89s] OK
> * checking Rd files ... [6s] OK
> * checking examples ... [72s] OK
> * checking tests ... [67s] OK
> * checking re-building of vignette outputs ... [53s] OK
>
> # Winbuilder R-devel Check time in seconds: 835
> * using R Under development (unstable) (2022-08-11 r82713 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [147s] OK
> * checking Rd files ... [8s] OK
> * checking examples ... [113s] OK
> * checking tests ... [101s] OK
> * checking re-building of vignette outputs ... [41s] OK
>
> # CRAN pre-test Windows
> * using log directory 'd:/RCompile/CRANincoming/R-devel/secr.Rcheck'
> * using R Under development (unstable) (2022-08-11 r82713 ucrt)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * checking R code for possible problems ... [147s] OK
> * checking Rd files ... [8s] OK
> * checking examples ... [106s] OK
> * checking tests ... [102s] OK
> * checking re-building of vignette outputs ... [39s] OK
>
> # CRAN pre-test Debian
> * using log directory ?/srv/hornik/tmp/CRAN/secr.Rcheck?
> * using R Under development (unstable) (2022-08-11 r82713)
> * using platform: x86_64-pc-linux-gnu (64-bit)
> * checking R code for possible problems ... [52s/52s] OK
> * checking Rd files ... [1s/1s] OK
> * checking examples ... [47s/47s] OK
> * checking tests ... [19s/19s] OK
> * checking re-building of vignette outputs ... [10s/10s] OK
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://apc01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-package-devel&amp;data=05%7C01%7Cmurray.efford%40otago.ac.nz%7C0d23bcf920b14c84827508da7e9e10a0%7C0225efc578fe4928b1579ef24809e9ba%7C0%7C0%7C637961514622179903%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=knum1tEL0DLXMO%2FGSvBK5zko8gOUEwwNB%2F0zoDmiOyo%3D&amp;reserved=0


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Aug 17 09:28:46 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 17 Aug 2022 09:28:46 +0200
Subject: [R-pkg-devel] namespace error with rlang
In-Reply-To: <BN8PR05MB5953D2E98585EE80A60A9C05926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
References: <BN8PR05MB5953692A7B21557CE48CFEFB926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB5953D2E98585EE80A60A9C05926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
Message-ID: <fb392bea-64d1-d1da-e84a-3b5eaed8b403@statistik.tu-dortmund.de>



On 17.08.2022 03:30, Zhang, Xueqiong wrote:
> error still exist after I removed both of testthat and rlang, and then 
> reinstalled testthat.
> 
> Would you please help how to fix?
> 
> Thanks.
> 
> *From: *Zhang, Xueqiong <joan.zhang at emory.edu>
> *Date: *Tuesday, August 16, 2022 at 7:35 PM
> *To: *ligges at statistik.tu-dortmund.de <ligges at statistik.tu-dortmund.de>, 
> r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject: *namespace error with rlang
> 
> Hi all,
> 
>  ? My package passed the ?R CMD check? on my local machine, however it 
> returns error of ?namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2 
> is required? when I sent it to win-builder.r-project.org .
> I actually do have rlang 1.0.4 install based on session info. What 
> should I do?
> 
> Thanks!
> 
> /Joan /
> 


Please provide the references and a full check log. Which version of R? 
Which OS? Date/Time  when it happened (as packages may change vbersion 
or status)?

I keep "r-package-devel" CCed as that is indeed the right address for 
asking such questions (rather than sending mails to individual members 
of the CRAN team).


Best,
Uwe Ligges


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Aug 17 16:40:35 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 17 Aug 2022 16:40:35 +0200
Subject: [R-pkg-devel] [External] Re: namespace error with rlang
In-Reply-To: <BN8PR05MB5953DB926CBA89885AB7A258926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
References: <BN8PR05MB5953692A7B21557CE48CFEFB926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB5953D2E98585EE80A60A9C05926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <fb392bea-64d1-d1da-e84a-3b5eaed8b403@statistik.tu-dortmund.de>
 <BN8PR05MB5953DB926CBA89885AB7A258926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
Message-ID: <b04e4503-7af9-6868-8e0d-e714f0f426b1@statistik.tu-dortmund.de>

Ah, this is from the winbuilder on demand service for R-release and not 
a CRAN incoming check!

I moved an outated rlang away, it should work now.

Best,
Uwe Ligges


On 17.08.2022 14:33, Zhang, Xueqiong wrote:
> Thanks so much!
> 
> Below are the information related to my submission on Tuesday night 
> (08/17/2022) -
> 
> *_1. My session info:_*
> R version 4.1.0 (2021-05-18)
> 
> Platform: x86_64-apple-darwin17.0 (64-bit)
> 
> Running under: macOS 12.5
> 
> Matrix products: default
> 
> LAPACK: 
> /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
> 
> locale:
> 
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> 
> [1] stats???? graphics? grDevices utils???? datasets? methods?? base
> 
> loaded via a namespace (and not attached):
> 
> [1] rstudioapi_0.13??????? XVector_0.32.0???????? magrittr_2.0.3
> 
>  ?[4] BiocGenerics_0.38.0??? zlibbioc_1.38.0??????? IRanges_2.26.0
> 
>  ?[7] tidyselect_1.1.2?????? R6_2.5.1?????????????? rlang_1.0.4
> 
> [10] fansi_1.0.3??????????? httr_1.4.3???????????? GenomeInfoDb_1.28.4
> 
> [13] dplyr_1.0.9??????????? tools_4.1.0??????????? parallel_4.1.0
> 
> [16] utf8_1.2.2???????????? DBI_1.1.3????????????? cli_3.3.0
> 
> [19] assertthat_0.2.1 ??????tibble_3.1.8?????????? lifecycle_1.0.1
> 
> [22] crayon_1.5.1?????????? brio_1.1.3???????????? GenomeInfoDbData_1.2.6
> 
> [25] purrr_0.3.4??????????? vctrs_0.4.1??????????? S4Vectors_0.30.2
> 
> [28] fs_1.5.2?????????????? bitops_1.0-7?????????? RCurl_1.98-1.7
> 
> [31] testthat_3.1.4???????? glue_1.6.2???????????? pillar_1.8.0
> 
> [34] compiler_4.1.0???????? generics_0.1.3???????? Biostrings_2.60.2
> 
> [37] stats4_4.1.0?????????? pkgconfig_2.0.3
> 
> *_2. check log_*
> 
> * using log directory 'd:/RCompile/CRANguest/R-release/epitopR.Rcheck'
> 
> * using R version 4.2.1 (2022-06-23 ucrt)
> 
> * using platform: x86_64-w64-mingw32 (64-bit)
> 
> * using session charset: UTF-8
> 
> * checking for file 'epitopR/DESCRIPTION' ... OK
> 
> * checking extension type ... Package
> 
> * this is package 'epitopR' version '0.1.0'
> 
> * package encoding: UTF-8
> 
> * checking CRAN incoming feasibility ... NOTE
> 
> Maintainer: 'Joan Zhang <joan.zhang at emory.edu>'
> 
> New submission
> 
> Possibly misspelled words in DESCRIPTION:
> 
>  ? DK (5:725)
> 
>  ? Dhanda (5:682)
> 
>  ? JA (5:678)
> 
>  ? MHC (3:24, 5:50, 5:250)
> 
>  ? Mahajan (5:659)
> 
>  ? Overton (5:670)
> 
>  ? Sette (5:729)
> 
>  ? epitope (5:355)
> 
>  ? histocompatibility (5:61)
> 
> * checking package namespace information ... OK
> 
> * checking package dependencies ... OK
> 
> * checking if this is a source package ... OK
> 
> * checking if there is a namespace ... OK
> 
> * checking for hidden files and directories ... OK
> 
> * checking for portable file names ... OK
> 
> * checking whether package 'epitopR' can be installed ... ERROR
> 
> Installation failed.
> 
> See 'd:/RCompile/CRANguest/R-release/epitopR.Rcheck/00install.out' for 
> details.
> 
> * DONE
> 
> Status: 1 ERROR, 1 NOTE
> 
> *_3. install out_*
> 
> * installing *source* package 'epitopR' ...
> 
> ** using staged installation
> 
> ** R
> 
> ** inst
> 
> ** byte-compile and prepare package for lazy loading
> 
> Error in loadNamespace(i, c(lib.loc, .libPaths()), versionCheck = 
> vI[[i]]) :
> 
>  ??namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2 is required
> 
> Calls: <Anonymous> ... namespaceImport -> loadNamespace -> 
> namespaceImport -> loadNamespace
> 
> Execution halted
> 
> ERROR: lazy loading failed for package 'epitopR'
> 
> * removing 'd:/RCompile/CRANguest/R-release/lib/epitopR'
> 
> * restoring previous 'd:/RCompile/CRANguest/R-release/lib/epitopR'
> 
> *From: *Uwe Ligges <ligges at statistik.tu-dortmund.de>
> *Date: *Wednesday, August 17, 2022 at 3:28 AM
> *To: *Zhang, Xueqiong <joan.zhang at emory.edu>, 
> r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject: *[External] Re: namespace error with rlang
> 
> 
> 
> On 17.08.2022 03:30, Zhang, Xueqiong wrote:
>  > error still exist after I removed both of testthat and rlang, and then
>  > reinstalled testthat.
>  >
>  > Would you please help how to fix?
>  >
>  > Thanks.
>  >
>  > *From: *Zhang, Xueqiong <joan.zhang at emory.edu>
>  > *Date: *Tuesday, August 16, 2022 at 7:35 PM
>  > *To: *ligges at statistik.tu-dortmund.de <ligges at statistik.tu-dortmund.de>,
>  > r-package-devel at r-project.org <r-package-devel at r-project.org>
>  > *Subject: *namespace error with rlang
>  >
>  > Hi all,
>  >
>  >? ? My package passed the ?R CMD check? on my local machine, however it
>  > returns error of ?namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2
>  > is required? when I sent it to win-builder.r-project.org .
>  > I actually do have rlang 1.0.4 install based on session info. What
>  > should I do?
>  >
>  > Thanks!
>  >
>  > /Joan /
>  >
> 
> 
> Please provide the references and a full check log. Which version of R?
> Which OS? Date/Time? when it happened (as packages may change vbersion
> or status)?
> 
> I keep "r-package-devel" CCed as that is indeed the right address for
> asking such questions (rather than sending mails to individual members
> of the CRAN team).
> 
> 
> Best,
> Uwe Ligges
>


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Aug 17 16:47:03 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 17 Aug 2022 16:47:03 +0200
Subject: [R-pkg-devel] toy example for testing purpose
In-Reply-To: <BN8PR05MB59538C543386F8CA1A695FF3926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
References: <BN8PR05MB595304CEFC03BB90D30B2BAC926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB595353DBEC076832DA2F97ED926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB59538C543386F8CA1A695FF3926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
Message-ID: <79ab7387-a515-6307-630d-711f68ae0570@statistik.tu-dortmund.de>



On 16.08.2022 20:28, Zhang, Xueqiong wrote:
> Hi all,
> 
>  ? I got this comment from our CRAN package reviewer ( blue content 
> below) , but I am not sure how to fix it ?
> 
>  ?If I put @example in source .R with \donttest then I lose the example 
> run; if without \donttest then the CPU time will exceed 5 sec. ?I 
> already do have examples in vignettes. ?Do I need add test calls in 
> other place/script?

Well, ideally you have short examples so that users see quickly how your 
function can be called. Ideally examples take less than 5 sec., becuase 
users are typically not very patient when runningn exmaples from help pages.

If your examples are lengthy we ask you to put them in \donttest{} but 
try to provide short ones in addition to the lengthy ones (rather 
provide some tiny toy data, use few iterations etc)

If all ends up in \donttest{}, no vignette runtime code and no tests, 
your packages won't have any code executed at runtime which is of course 
a vey bad idea. SAo we ask to provide tests in case you do not provide 
examples that get auto-executed during the checks.
In vignettes we typically see a workflow tested, but not all 
functionality of the package, and frequently only subseta of provided 
functions get executed in vignettes...

Best,
Uwe Ligges







> Thanks,
> 
> Joan
> 
> /
> />>>>>>>>>>>>>>>>>>>>>>>>>
> 
> 
> 
> Putting the lengthy examples in \donttest is correct. However, it would
> be great if you either could write shorter toy examples or if not
> possible at least write some test so that we can check the functionality
> of your functions.
>


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Aug 17 16:58:43 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 17 Aug 2022 16:58:43 +0200
Subject: [R-pkg-devel] [External] Re: toy example for testing purpose
In-Reply-To: <BN8PR05MB59537753992CCC82FF3747AC926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
References: <BN8PR05MB595304CEFC03BB90D30B2BAC926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB595353DBEC076832DA2F97ED926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB59538C543386F8CA1A695FF3926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <79ab7387-a515-6307-630d-711f68ae0570@statistik.tu-dortmund.de>
 <BN8PR05MB59537753992CCC82FF3747AC926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
Message-ID: <11e78f23-944a-a582-c1eb-3bb0559c6715@statistik.tu-dortmund.de>



On 17.08.2022 16:51, Zhang, Xueqiong wrote:
> Hi Dr Ligges and team,
> 
> Thanks for the explanation. it makes sense to me now!
> I am working on putting examples in testthat folder, hope it?s the right 
> way to do it.

Writing R Extensions well explains how to use the tests directory.
testthat is a contributed package which its own documentation.

Best,
Uwe Ligges




> /Joan Zhang, MS/
> Research Informatics Analyst
> 
> Larsen Lab - Emory Transplant Center
> 
> *From: *Uwe Ligges <ligges at statistik.tu-dortmund.de>
> *Date: *Wednesday, August 17, 2022 at 10:46 AM
> *To: *Zhang, Xueqiong <joan.zhang at emory.edu>, 
> r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject: *[External] Re: toy example for testing purpose
> 
> 
> 
> On 16.08.2022 20:28, Zhang, Xueqiong wrote:
>  > Hi all,
>  >
>  >? ? I got this comment from our CRAN package reviewer ( blue content
>  > below) , but I am not sure how to fix it ?
>  >
>  >? ?If I put @example in source .R with \donttest then I lose the example
>  > run; if without \donttest then the CPU time will exceed 5 sec. ?I
>  > already do have examples in vignettes. ?Do I need add test calls in
>  > other place/script?
> 
> Well, ideally you have short examples so that users see quickly how your
> function can be called. Ideally examples take less than 5 sec., becuase
> users are typically not very patient when runningn exmaples from help pages.
> 
> If your examples are lengthy we ask you to put them in \donttest{} but
> try to provide short ones in addition to the lengthy ones (rather
> provide some tiny toy data, use few iterations etc)
> 
> If all ends up in \donttest{}, no vignette runtime code and no tests,
> your packages won't have any code executed at runtime which is of course
> a vey bad idea. SAo we ask to provide tests in case you do not provide
> examples that get auto-executed during the checks.
> In vignettes we typically see a workflow tested, but not all
> functionality of the package, and frequently only subseta of provided
> functions get executed in vignettes...
> 
> Best,
> Uwe Ligges
> 
> 
> 
> 
> 
> 
> 
>  > Thanks,
>  >
>  > Joan
>  >
>  > /
>  > />>>>>>>>>>>>>>>>>>>>>>>>>
>  >
>  >
>  >
>  > Putting the lengthy examples in \donttest is correct. However, it would
>  > be great if you either could write shorter toy examples or if not
>  > possible at least write some test so that we can check the functionality
>  > of your functions.
>  >
>


From jo@n@zh@ng @end|ng |rom emory@edu  Wed Aug 17 01:35:58 2022
From: jo@n@zh@ng @end|ng |rom emory@edu (Zhang, Xueqiong)
Date: Tue, 16 Aug 2022 23:35:58 +0000
Subject: [R-pkg-devel] namespace error with rlang
Message-ID: <BN8PR05MB5953692A7B21557CE48CFEFB926B9@BN8PR05MB5953.namprd05.prod.outlook.com>

Hi all,

  My package passed the ?R CMD check? on my local machine, however it returns error of ?namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2 is required? when I sent it to win-builder.r-project.org .
I actually do have rlang 1.0.4 install based on session info. What should I do?



Thanks!

Joan


	[[alternative HTML version deleted]]


From jo@n@zh@ng @end|ng |rom emory@edu  Wed Aug 17 03:30:25 2022
From: jo@n@zh@ng @end|ng |rom emory@edu (Zhang, Xueqiong)
Date: Wed, 17 Aug 2022 01:30:25 +0000
Subject: [R-pkg-devel] namespace error with rlang
In-Reply-To: <BN8PR05MB5953692A7B21557CE48CFEFB926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
References: <BN8PR05MB5953692A7B21557CE48CFEFB926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
Message-ID: <BN8PR05MB5953D2E98585EE80A60A9C05926A9@BN8PR05MB5953.namprd05.prod.outlook.com>

error still exist after I removed both of testthat and rlang, and then reinstalled testthat.
Would you please help how to fix?
Thanks.

From: Zhang, Xueqiong <joan.zhang at emory.edu>
Date: Tuesday, August 16, 2022 at 7:35 PM
To: ligges at statistik.tu-dortmund.de <ligges at statistik.tu-dortmund.de>, r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: namespace error with rlang
Hi all,

  My package passed the ?R CMD check? on my local machine, however it returns error of ?namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2 is required? when I sent it to win-builder.r-project.org .
I actually do have rlang 1.0.4 install based on session info. What should I do?



Thanks!

Joan


	[[alternative HTML version deleted]]


From jo@n@zh@ng @end|ng |rom emory@edu  Wed Aug 17 14:33:18 2022
From: jo@n@zh@ng @end|ng |rom emory@edu (Zhang, Xueqiong)
Date: Wed, 17 Aug 2022 12:33:18 +0000
Subject: [R-pkg-devel] [External] Re: namespace error with rlang
In-Reply-To: <fb392bea-64d1-d1da-e84a-3b5eaed8b403@statistik.tu-dortmund.de>
References: <BN8PR05MB5953692A7B21557CE48CFEFB926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB5953D2E98585EE80A60A9C05926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <fb392bea-64d1-d1da-e84a-3b5eaed8b403@statistik.tu-dortmund.de>
Message-ID: <BN8PR05MB5953DB926CBA89885AB7A258926A9@BN8PR05MB5953.namprd05.prod.outlook.com>

Thanks so much!
Below are the information related to my submission on Tuesday night (08/17/2022) -

1. My session info:
R version 4.1.0 (2021-05-18)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS 12.5

Matrix products: default
LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] rstudioapi_0.13        XVector_0.32.0         magrittr_2.0.3
 [4] BiocGenerics_0.38.0    zlibbioc_1.38.0        IRanges_2.26.0
 [7] tidyselect_1.1.2       R6_2.5.1               rlang_1.0.4
[10] fansi_1.0.3            httr_1.4.3             GenomeInfoDb_1.28.4
[13] dplyr_1.0.9            tools_4.1.0            parallel_4.1.0
[16] utf8_1.2.2             DBI_1.1.3              cli_3.3.0
[19] assertthat_0.2.1       tibble_3.1.8           lifecycle_1.0.1
[22] crayon_1.5.1           brio_1.1.3             GenomeInfoDbData_1.2.6
[25] purrr_0.3.4            vctrs_0.4.1            S4Vectors_0.30.2
[28] fs_1.5.2               bitops_1.0-7           RCurl_1.98-1.7
[31] testthat_3.1.4         glue_1.6.2             pillar_1.8.0
[34] compiler_4.1.0         generics_0.1.3         Biostrings_2.60.2
[37] stats4_4.1.0           pkgconfig_2.0.3

2. check log
* using log directory 'd:/RCompile/CRANguest/R-release/epitopR.Rcheck'
* using R version 4.2.1 (2022-06-23 ucrt)
* using platform: x86_64-w64-mingw32 (64-bit)
* using session charset: UTF-8
* checking for file 'epitopR/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'epitopR' version '0.1.0'
* package encoding: UTF-8
* checking CRAN incoming feasibility ... NOTE
Maintainer: 'Joan Zhang <joan.zhang at emory.edu>'

New submission

Possibly misspelled words in DESCRIPTION:
  DK (5:725)
  Dhanda (5:682)
  JA (5:678)
  MHC (3:24, 5:50, 5:250)
  Mahajan (5:659)
  Overton (5:670)
  Sette (5:729)
  epitope (5:355)
  histocompatibility (5:61)
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for hidden files and directories ... OK
* checking for portable file names ... OK
* checking whether package 'epitopR' can be installed ... ERROR
Installation failed.
See 'd:/RCompile/CRANguest/R-release/epitopR.Rcheck/00install.out' for details.
* DONE
Status: 1 ERROR, 1 NOTE

3. install out

* installing *source* package 'epitopR' ...

** using staged installation

** R

** inst

** byte-compile and prepare package for lazy loading

Error in loadNamespace(i, c(lib.loc, .libPaths()), versionCheck = vI[[i]]) :

  namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2 is required

Calls: <Anonymous> ... namespaceImport -> loadNamespace -> namespaceImport -> loadNamespace

Execution halted

ERROR: lazy loading failed for package 'epitopR'

* removing 'd:/RCompile/CRANguest/R-release/lib/epitopR'

* restoring previous 'd:/RCompile/CRANguest/R-release/lib/epitopR'


From: Uwe Ligges <ligges at statistik.tu-dortmund.de>
Date: Wednesday, August 17, 2022 at 3:28 AM
To: Zhang, Xueqiong <joan.zhang at emory.edu>, r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [External] Re: namespace error with rlang


On 17.08.2022 03:30, Zhang, Xueqiong wrote:
> error still exist after I removed both of testthat and rlang, and then
> reinstalled testthat.
>
> Would you please help how to fix?
>
> Thanks.
>
> *From: *Zhang, Xueqiong <joan.zhang at emory.edu>
> *Date: *Tuesday, August 16, 2022 at 7:35 PM
> *To: *ligges at statistik.tu-dortmund.de <ligges at statistik.tu-dortmund.de>,
> r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject: *namespace error with rlang
>
> Hi all,
>
>    My package passed the ?R CMD check? on my local machine, however it
> returns error of ?namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2
> is required? when I sent it to win-builder.r-project.org .
> I actually do have rlang 1.0.4 install based on session info. What
> should I do?
>
> Thanks!
>
> /Joan /
>


Please provide the references and a full check log. Which version of R?
Which OS? Date/Time  when it happened (as packages may change vbersion
or status)?

I keep "r-package-devel" CCed as that is indeed the right address for
asking such questions (rather than sending mails to individual members
of the CRAN team).


Best,
Uwe Ligges

	[[alternative HTML version deleted]]


From jo@n@zh@ng @end|ng |rom emory@edu  Wed Aug 17 16:51:19 2022
From: jo@n@zh@ng @end|ng |rom emory@edu (Zhang, Xueqiong)
Date: Wed, 17 Aug 2022 14:51:19 +0000
Subject: [R-pkg-devel] [External] Re: toy example for testing purpose
In-Reply-To: <79ab7387-a515-6307-630d-711f68ae0570@statistik.tu-dortmund.de>
References: <BN8PR05MB595304CEFC03BB90D30B2BAC926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB595353DBEC076832DA2F97ED926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB59538C543386F8CA1A695FF3926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <79ab7387-a515-6307-630d-711f68ae0570@statistik.tu-dortmund.de>
Message-ID: <BN8PR05MB59537753992CCC82FF3747AC926A9@BN8PR05MB5953.namprd05.prod.outlook.com>

Hi Dr Ligges and team,
Thanks for the explanation. it makes sense to me now!
I am working on putting examples in testthat folder, hope it?s the right way to do it.

Joan Zhang, MS
Research Informatics Analyst
Larsen Lab - Emory Transplant Center


From: Uwe Ligges <ligges at statistik.tu-dortmund.de>
Date: Wednesday, August 17, 2022 at 10:46 AM
To: Zhang, Xueqiong <joan.zhang at emory.edu>, r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [External] Re: toy example for testing purpose


On 16.08.2022 20:28, Zhang, Xueqiong wrote:
> Hi all,
>
>    I got this comment from our CRAN package reviewer ( blue content
> below) , but I am not sure how to fix it ?
>
>   If I put @example in source .R with \donttest then I lose the example
> run; if without \donttest then the CPU time will exceed 5 sec.  I
> already do have examples in vignettes.  Do I need add test calls in
> other place/script?

Well, ideally you have short examples so that users see quickly how your
function can be called. Ideally examples take less than 5 sec., becuase
users are typically not very patient when runningn exmaples from help pages.

If your examples are lengthy we ask you to put them in \donttest{} but
try to provide short ones in addition to the lengthy ones (rather
provide some tiny toy data, use few iterations etc)

If all ends up in \donttest{}, no vignette runtime code and no tests,
your packages won't have any code executed at runtime which is of course
a vey bad idea. SAo we ask to provide tests in case you do not provide
examples that get auto-executed during the checks.
In vignettes we typically see a workflow tested, but not all
functionality of the package, and frequently only subseta of provided
functions get executed in vignettes...

Best,
Uwe Ligges







> Thanks,
>
> Joan
>
> /
> />>>>>>>>>>>>>>>>>>>>>>>>>
>
>
>
> Putting the lengthy examples in \donttest is correct. However, it would
> be great if you either could write shorter toy examples or if not
> possible at least write some test so that we can check the functionality
> of your functions.
>

	[[alternative HTML version deleted]]


From jo@n@zh@ng @end|ng |rom emory@edu  Wed Aug 17 17:39:08 2022
From: jo@n@zh@ng @end|ng |rom emory@edu (Zhang, Xueqiong)
Date: Wed, 17 Aug 2022 15:39:08 +0000
Subject: [R-pkg-devel] [External] Re: namespace error with rlang
In-Reply-To: <b04e4503-7af9-6868-8e0d-e714f0f426b1@statistik.tu-dortmund.de>
References: <BN8PR05MB5953692A7B21557CE48CFEFB926B9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <BN8PR05MB5953D2E98585EE80A60A9C05926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <fb392bea-64d1-d1da-e84a-3b5eaed8b403@statistik.tu-dortmund.de>
 <BN8PR05MB5953DB926CBA89885AB7A258926A9@BN8PR05MB5953.namprd05.prod.outlook.com>
 <b04e4503-7af9-6868-8e0d-e714f0f426b1@statistik.tu-dortmund.de>
Message-ID: <BN8PR05MB59530D59C0C2A72EF7B200A4926A9@BN8PR05MB5953.namprd05.prod.outlook.com>

Great! The error message is gone after I resent to the winbuilder.
Thanks,

Joan Zhang, MS
Research Informatics Analyst
Larsen Lab - Emory Transplant Center


From: Uwe Ligges <ligges at statistik.tu-dortmund.de>
Date: Wednesday, August 17, 2022 at 10:40 AM
To: Zhang, Xueqiong <joan.zhang at emory.edu>, r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [External] Re: namespace error with rlang
Ah, this is from the winbuilder on demand service for R-release and not
a CRAN incoming check!

I moved an outated rlang away, it should work now.

Best,
Uwe Ligges


On 17.08.2022 14:33, Zhang, Xueqiong wrote:
> Thanks so much!
>
> Below are the information related to my submission on Tuesday night
> (08/17/2022) -
>
> *_1. My session info:_*
> R version 4.1.0 (2021-05-18)
>
> Platform: x86_64-apple-darwin17.0 (64-bit)
>
> Running under: macOS 12.5
>
> Matrix products: default
>
> LAPACK:
> /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
>
> locale:
>
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
>
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
>
> [1] rstudioapi_0.13        XVector_0.32.0         magrittr_2.0.3
>
>   [4] BiocGenerics_0.38.0    zlibbioc_1.38.0        IRanges_2.26.0
>
>   [7] tidyselect_1.1.2       R6_2.5.1               rlang_1.0.4
>
> [10] fansi_1.0.3            httr_1.4.3             GenomeInfoDb_1.28.4
>
> [13] dplyr_1.0.9            tools_4.1.0            parallel_4.1.0
>
> [16] utf8_1.2.2             DBI_1.1.3              cli_3.3.0
>
> [19] assertthat_0.2.1       tibble_3.1.8           lifecycle_1.0.1
>
> [22] crayon_1.5.1           brio_1.1.3             GenomeInfoDbData_1.2.6
>
> [25] purrr_0.3.4            vctrs_0.4.1            S4Vectors_0.30.2
>
> [28] fs_1.5.2               bitops_1.0-7           RCurl_1.98-1.7
>
> [31] testthat_3.1.4         glue_1.6.2             pillar_1.8.0
>
> [34] compiler_4.1.0         generics_0.1.3         Biostrings_2.60.2
>
> [37] stats4_4.1.0           pkgconfig_2.0.3
>
> *_2. check log_*
>
> * using log directory 'd:/RCompile/CRANguest/R-release/epitopR.Rcheck'
>
> * using R version 4.2.1 (2022-06-23 ucrt)
>
> * using platform: x86_64-w64-mingw32 (64-bit)
>
> * using session charset: UTF-8
>
> * checking for file 'epitopR/DESCRIPTION' ... OK
>
> * checking extension type ... Package
>
> * this is package 'epitopR' version '0.1.0'
>
> * package encoding: UTF-8
>
> * checking CRAN incoming feasibility ... NOTE
>
> Maintainer: 'Joan Zhang <joan.zhang at emory.edu>'
>
> New submission
>
> Possibly misspelled words in DESCRIPTION:
>
>    DK (5:725)
>
>    Dhanda (5:682)
>
>    JA (5:678)
>
>    MHC (3:24, 5:50, 5:250)
>
>    Mahajan (5:659)
>
>    Overton (5:670)
>
>    Sette (5:729)
>
>    epitope (5:355)
>
>    histocompatibility (5:61)
>
> * checking package namespace information ... OK
>
> * checking package dependencies ... OK
>
> * checking if this is a source package ... OK
>
> * checking if there is a namespace ... OK
>
> * checking for hidden files and directories ... OK
>
> * checking for portable file names ... OK
>
> * checking whether package 'epitopR' can be installed ... ERROR
>
> Installation failed.
>
> See 'd:/RCompile/CRANguest/R-release/epitopR.Rcheck/00install.out' for
> details.
>
> * DONE
>
> Status: 1 ERROR, 1 NOTE
>
> *_3. install out_*
>
> * installing *source* package 'epitopR' ...
>
> ** using staged installation
>
> ** R
>
> ** inst
>
> ** byte-compile and prepare package for lazy loading
>
> Error in loadNamespace(i, c(lib.loc, .libPaths()), versionCheck =
> vI[[i]]) :
>
>    namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2 is required
>
> Calls: <Anonymous> ... namespaceImport -> loadNamespace ->
> namespaceImport -> loadNamespace
>
> Execution halted
>
> ERROR: lazy loading failed for package 'epitopR'
>
> * removing 'd:/RCompile/CRANguest/R-release/lib/epitopR'
>
> * restoring previous 'd:/RCompile/CRANguest/R-release/lib/epitopR'
>
> *From: *Uwe Ligges <ligges at statistik.tu-dortmund.de>
> *Date: *Wednesday, August 17, 2022 at 3:28 AM
> *To: *Zhang, Xueqiong <joan.zhang at emory.edu>,
> r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject: *[External] Re: namespace error with rlang
>
>
>
> On 17.08.2022 03:30, Zhang, Xueqiong wrote:
>  > error still exist after I removed both of testthat and rlang, and then
>  > reinstalled testthat.
>  >
>  > Would you please help how to fix?
>  >
>  > Thanks.
>  >
>  > *From: *Zhang, Xueqiong <joan.zhang at emory.edu>
>  > *Date: *Tuesday, August 16, 2022 at 7:35 PM
>  > *To: *ligges at statistik.tu-dortmund.de <ligges at statistik.tu-dortmund.de>,
>  > r-package-devel at r-project.org <r-package-devel at r-project.org>
>  > *Subject: *namespace error with rlang
>  >
>  > Hi all,
>  >
>  >    My package passed the ?R CMD check? on my local machine, however it
>  > returns error of ?namespace 'rlang' 1.0.1 is being loaded, but >= 1.0.2
>  > is required? when I sent it to win-builder.r-project.org .
>  > I actually do have rlang 1.0.4 install based on session info. What
>  > should I do?
>  >
>  > Thanks!
>  >
>  > /Joan /
>  >
>
>
> Please provide the references and a full check log. Which version of R?
> Which OS? Date/Time  when it happened (as packages may change vbersion
> or status)?
>
> I keep "r-package-devel" CCed as that is indeed the right address for
> asking such questions (rather than sending mails to individual members
> of the CRAN team).
>
>
> Best,
> Uwe Ligges
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Thu Aug 18 13:55:01 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 18 Aug 2022 06:55:01 -0500
Subject: [R-pkg-devel] CRAN valgrind reports with zero leaks - actionable?
Message-ID: <25342.10389.559082.344505@rob.eddelbuettel.com>


[ Five days ago, I sent (most) of the message below to a CRAN team member. I
have not had a reply, and it now appears that we are asked to email here so I
am resending. ]

A package of mine shows a valgrind report at with the details clearly
indicating that no memory is lost: 

    ==3533933== LEAK SUMMARY:
    ==3533933==    definitely lost: 0 bytes in 0 blocks
    ==3533933==    indirectly lost: 0 bytes in 0 blocks
    ==3533933==      possibly lost: 0 bytes in 0 blocks

The continuous integration setup for the package includes a nightly job
against multiple version of the underlying C++ library to check just this.
In those job we do NOT trigger an alert when, as here, zero bytes are
reported lost.

Now, valgrind does report something possibly due (as the _Writing R
Extensions_ manual notes) to compiler optimisation. So we currently consider
this spurious.

Could CRAN let us know if this is considered a 'must fix' issue?  And if so,
maybe so not show the alarmingly red 'valgrind' link to a report with zero leaks?

Many thanks as always for all these thorough tests.

Sincerely,  Dirk


-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Thu Aug 18 14:53:59 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 18 Aug 2022 15:53:59 +0300
Subject: [R-pkg-devel] 
 CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <25342.10389.559082.344505@rob.eddelbuettel.com>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
Message-ID: <20220818155359.59f12c36@arachnoid>

On Thu, 18 Aug 2022 06:55:01 -0500
Dirk Eddelbuettel <edd at debian.org> wrote:

> A package of mine shows a valgrind report at with the details clearly
> indicating that no memory is lost: 

Apologies if I'm misunderstanding the problem, but which package is it?
Does the ERROR SUMMARY also show 0 errors?

I would have assumed it's the dtts package, but that one shows a
non-zero "possibly lost" value. For dtts [*], there's also "invalid
read" messages intermixed with the test output, although I'm finding
them very confusing: how can it be invalid if it's within the bounds of
the allocation and the address seems to indicate correct alignment?

-- 
Best regards,
Ivan

[*]
https://www.stats.ox.ac.uk/pub/bdr/memtests/valgrind/dtts/tests/tinytest.Rout


From edd @end|ng |rom deb|@n@org  Thu Aug 18 15:37:39 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 18 Aug 2022 08:37:39 -0500
Subject: [R-pkg-devel] 
 CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <20220818155359.59f12c36@arachnoid>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
 <20220818155359.59f12c36@arachnoid>
Message-ID: <25342.16547.736229.899950@rob.eddelbuettel.com>


On 18 August 2022 at 15:53, Ivan Krylov wrote:
| Apologies if I'm misunderstanding the problem, but which package is it?

I do not believe it matters for the overall policy question I asked CRAN.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From d@n@gro@e @end|ng |rom |@nc@@ter@@c@uk  Tue Aug 23 14:06:44 2022
From: d@n@gro@e @end|ng |rom |@nc@@ter@@c@uk (Grose, Daniel)
Date: Tue, 23 Aug 2022 12:06:44 +0000
Subject: [R-pkg-devel] cannot reduce vignette size in package
Message-ID: <LO2P265MB41513A2FAA72F43D54ABB76ABE709@LO2P265MB4151.GBRP265.PROD.OUTLOOK.COM>

Hi

I have just added a vignette to an R package that is already on CRAN. However, when I submit the new version I get

* checking sizes of PDF files under 'inst/doc' ... WARNING

  'gs+qpdf' made some significant size reductions:
     compacted 'article.pdf' from 794Kb to 530Kb

I have tried building the package using

R CMD build --compact-vignettes="gs+pdf"

but the size of the vignette pdf does not get reduced

I have also tried


R CMD build --compact-vignettes="pdf"

R CMD build --compact-vignettes="gs"

R CMD build --compact-vignettes="both"

and

devtools::build(args = c('--compact-vignettes=gs+qpdf'))

devtools::build(args = c('--compact-vignettes=qpdf'))

devtools::build(args = c('--compact-vignettes=gs'))

devtools::build(args = c('--compact-vignettes=both'))

In all cases these options have no effect on the size of the pdf.

I do have both gs and qpdf available on the system.

$ which gs

/usr/bin/gs

$ which qpdf

/usr/bin/qpdf

Any help / guidance would be much appreciated.

Many thanks,

Dan








	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Tue Aug 23 15:24:42 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Tue, 23 Aug 2022 15:24:42 +0200
Subject: [R-pkg-devel] cannot reduce vignette size in package
In-Reply-To: <LO2P265MB41513A2FAA72F43D54ABB76ABE709@LO2P265MB4151.GBRP265.PROD.OUTLOOK.COM>
References: <LO2P265MB41513A2FAA72F43D54ABB76ABE709@LO2P265MB4151.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <6a7d9127-4388-00b5-1939-f5507cba4f52@statistik.tu-dortmund.de>

Perhaps your versions of qpdf and/or  gs are outdated or unavailable?

Best,
Uwe Ligges

On 23.08.2022 14:06, Grose, Daniel wrote:
> Hi
> 
> I have just added a vignette to an R package that is already on CRAN. However, when I submit the new version I get
> 
> * checking sizes of PDF files under 'inst/doc' ... WARNING
> 
>    'gs+qpdf' made some significant size reductions:
>       compacted 'article.pdf' from 794Kb to 530Kb
> 
> I have tried building the package using
> 
> R CMD build --compact-vignettes="gs+pdf"
> 
> but the size of the vignette pdf does not get reduced
> 
> I have also tried
> 
> 
> R CMD build --compact-vignettes="pdf"
> 
> R CMD build --compact-vignettes="gs"
> 
> R CMD build --compact-vignettes="both"
> 
> and
> 
> devtools::build(args = c('--compact-vignettes=gs+qpdf'))
> 
> devtools::build(args = c('--compact-vignettes=qpdf'))
> 
> devtools::build(args = c('--compact-vignettes=gs'))
> 
> devtools::build(args = c('--compact-vignettes=both'))
> 
> In all cases these options have no effect on the size of the pdf.
> 
> I do have both gs and qpdf available on the system.
> 
> $ which gs
> 
> /usr/bin/gs
> 
> $ which qpdf
> 
> /usr/bin/qpdf
> 
> Any help / guidance would be much appreciated.
> 
> Many thanks,
> 
> Dan
> 
> 
> 
> 
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Tue Aug 23 15:33:04 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Tue, 23 Aug 2022 09:33:04 -0400
Subject: [R-pkg-devel] cannot reduce vignette size in package
In-Reply-To: <6a7d9127-4388-00b5-1939-f5507cba4f52@statistik.tu-dortmund.de>
References: <LO2P265MB41513A2FAA72F43D54ABB76ABE709@LO2P265MB4151.GBRP265.PROD.OUTLOOK.COM>
 <6a7d9127-4388-00b5-1939-f5507cba4f52@statistik.tu-dortmund.de>
Message-ID: <CABghstTxMv65Vee6cB9ahugjkYh0kcKx62exMufJgMd6AS9LiQ@mail.gmail.com>

Have you tried R CMD build --compact-vignettes=both ? (I get confused
every time about whether the arguments are supposed to be quoted or
not; I don't remember, although the next line in the help
'--compact-vignettes   same as --compact-vignettes=qpdf' makes me
think they're *not* supposed to be quoted ...)

On Tue, Aug 23, 2022 at 9:24 AM Uwe Ligges
<ligges at statistik.tu-dortmund.de> wrote:
>
> Perhaps your versions of qpdf and/or  gs are outdated or unavailable?
>
> Best,
> Uwe Ligges
>
> On 23.08.2022 14:06, Grose, Daniel wrote:
> > Hi
> >
> > I have just added a vignette to an R package that is already on CRAN. However, when I submit the new version I get
> >
> > * checking sizes of PDF files under 'inst/doc' ... WARNING
> >
> >    'gs+qpdf' made some significant size reductions:
> >       compacted 'article.pdf' from 794Kb to 530Kb
> >
> > I have tried building the package using
> >
> > R CMD build --compact-vignettes="gs+pdf"
> >
> > but the size of the vignette pdf does not get reduced
> >
> > I have also tried
> >
> >
> > R CMD build --compact-vignettes="pdf"
> >
> > R CMD build --compact-vignettes="gs"
> >
> > R CMD build --compact-vignettes="both"
> >
> > and
> >
> > devtools::build(args = c('--compact-vignettes=gs+qpdf'))
> >
> > devtools::build(args = c('--compact-vignettes=qpdf'))
> >
> > devtools::build(args = c('--compact-vignettes=gs'))
> >
> > devtools::build(args = c('--compact-vignettes=both'))
> >
> > In all cases these options have no effect on the size of the pdf.
> >
> > I do have both gs and qpdf available on the system.
> >
> > $ which gs
> >
> > /usr/bin/gs
> >
> > $ which qpdf
> >
> > /usr/bin/qpdf
> >
> > Any help / guidance would be much appreciated.
> >
> > Many thanks,
> >
> > Dan
> >
> >
> >
> >
> >
> >
> >
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From p@u|h|bb|ng @end|ng |rom gm@||@com  Tue Aug 23 19:39:33 2022
From: p@u|h|bb|ng @end|ng |rom gm@||@com (Paul Hibbing)
Date: Tue, 23 Aug 2022 12:39:33 -0500
Subject: [R-pkg-devel] No package called 'scales' (r-oldrel-windows)
Message-ID: <CANA-rNMkh3MmSr0ZGcJMnS14xENAQRNa+9AQP6Fh0ymZRZ_4Ww@mail.gmail.com>

Hi all,

I recently submitted an update to `PAutilities`.

It has errored for r-oldrel-windows with "there is no package called
'scales'" (see https://www.r-project.org/nosvn/R.check/r-oldrel-windows-ix86+x86_64/PAutilities-00install.html).

I am a bit mystified by this, as the package builds fine on Winbuilder
old release (see
https://win-builder.r-project.org/g6EPG1y3nGN9/00check.log), as well
as my older local Windows installation (4.0.5) and all other platforms
I have checked.

Does anyone have insights about this? I assume it is related to
dependency on ggplot2, but I'm struggling to replicate the error and
thus unsure where to start.

Many thanks,
Paul


From @vr@h@m@@d|er @end|ng |rom gm@||@com  Tue Aug 23 20:19:14 2022
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Tue, 23 Aug 2022 18:19:14 +0000
Subject: [R-pkg-devel] No package called 'scales' (r-oldrel-windows)
In-Reply-To: <CANA-rNMkh3MmSr0ZGcJMnS14xENAQRNa+9AQP6Fh0ymZRZ_4Ww@mail.gmail.com>
References: <CANA-rNMkh3MmSr0ZGcJMnS14xENAQRNa+9AQP6Fh0ymZRZ_4Ww@mail.gmail.com>
Message-ID: <CAL6gwn+C7TjC4AiXfxejNEQM8cFiHdOEkgJ5um8KGN-xSo2wwQ@mail.gmail.com>

Scales is the package which is called when you use something like
"dollar" or "comma" in scale_x_whatever(); perhaps you have a similar
invocation without realizing it?

Thanks,

Avi

On Tue, Aug 23, 2022 at 5:40 PM Paul Hibbing <paulhibbing at gmail.com> wrote:
>
> Hi all,
>
> I recently submitted an update to `PAutilities`.
>
> It has errored for r-oldrel-windows with "there is no package called
> 'scales'" (see https://www.r-project.org/nosvn/R.check/r-oldrel-windows-ix86+x86_64/PAutilities-00install.html).
>
> I am a bit mystified by this, as the package builds fine on Winbuilder
> old release (see
> https://win-builder.r-project.org/g6EPG1y3nGN9/00check.log), as well
> as my older local Windows installation (4.0.5) and all other platforms
> I have checked.
>
> Does anyone have insights about this? I assume it is related to
> dependency on ggplot2, but I'm struggling to replicate the error and
> thus unsure where to start.
>
> Many thanks,
> Paul
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Aug 23 20:27:18 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 23 Aug 2022 21:27:18 +0300
Subject: [R-pkg-devel] No package called 'scales' (r-oldrel-windows)
In-Reply-To: <CANA-rNMkh3MmSr0ZGcJMnS14xENAQRNa+9AQP6Fh0ymZRZ_4Ww@mail.gmail.com>
References: <CANA-rNMkh3MmSr0ZGcJMnS14xENAQRNa+9AQP6Fh0ymZRZ_4Ww@mail.gmail.com>
Message-ID: <20220823212718.68ee38ee@arachnoid>

? Tue, 23 Aug 2022 12:39:33 -0500
Paul Hibbing <paulhibbing at gmail.com> ?????:

> It has errored for r-oldrel-windows with "there is no package called
> 'scales'" (see
> https://www.r-project.org/nosvn/R.check/r-oldrel-windows-ix86+x86_64/PAutilities-00install.html).

I think it's a hiccup on the testing machine. There doesn't seem to be
anything you would be able to fix on your side: you correctly declare
PAutilities to depend on the "scales" package, and yet the machine
running the test doesn't have it installed.

-- 
Best regards,
Ivan


From p@u|h|bb|ng @end|ng |rom gm@||@com  Tue Aug 23 22:14:36 2022
From: p@u|h|bb|ng @end|ng |rom gm@||@com (Paul Hibbing)
Date: Tue, 23 Aug 2022 15:14:36 -0500
Subject: [R-pkg-devel] No package called 'scales' (r-oldrel-windows)
In-Reply-To: <20220823212718.68ee38ee@arachnoid>
References: <CANA-rNMkh3MmSr0ZGcJMnS14xENAQRNa+9AQP6Fh0ymZRZ_4Ww@mail.gmail.com>
 <20220823212718.68ee38ee@arachnoid>
Message-ID: <CANA-rNNrXonzr2ujXgE0-m0+YUj4JovZKkKwP5mZmCghoNsN0A@mail.gmail.com>

Thanks Avi and Ivan. It appears there was indeed a hiccup on the
testing machine, as the error has now resolved. (I wasn't sure if I
needed to manually initiate anything, so it was informative to see the
issue resolved without me.)

Best,
Paul

On Tue, Aug 23, 2022 at 1:27 PM Ivan Krylov <krylov.r00t at gmail.com> wrote:
>
> ? Tue, 23 Aug 2022 12:39:33 -0500
> Paul Hibbing <paulhibbing at gmail.com> ?????:
>
> > It has errored for r-oldrel-windows with "there is no package called
> > 'scales'" (see
> > https://www.r-project.org/nosvn/R.check/r-oldrel-windows-ix86+x86_64/PAutilities-00install.html).
>
> I think it's a hiccup on the testing machine. There doesn't seem to be
> anything you would be able to fix on your side: you correctly declare
> PAutilities to depend on the "scales" package, and yet the machine
> running the test doesn't have it installed.
>
> --
> Best regards,
> Ivan


From edd @end|ng |rom deb|@n@org  Wed Aug 24 22:12:38 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 24 Aug 2022 15:12:38 -0500
Subject: [R-pkg-devel] 
 CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <25342.10389.559082.344505@rob.eddelbuettel.com>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
Message-ID: <25350.34358.937791.492479@rob.eddelbuettel.com>


Dear CRAN Team,

On 18 August 2022 at 06:55, Dirk Eddelbuettel wrote:
| 
| [ Five days ago, I sent (most) of the message below to a CRAN team member. I
| have not had a reply, and it now appears that we are asked to email here so I
| am resending. ]

An answer would be much appreciated after the five initial days of this being
ignored as a private mail followed by a further six days of silence out here
in the open on this very list we once set up for help with packaging issues.

Can we ignore valgrind reports which show 'definitely lost: 0 bytes' ?

Curious,  Dirk


| A package of mine shows a valgrind report at with the details clearly
| indicating that no memory is lost: 
| 
|     ==3533933== LEAK SUMMARY:
|     ==3533933==    definitely lost: 0 bytes in 0 blocks
|     ==3533933==    indirectly lost: 0 bytes in 0 blocks
|     ==3533933==      possibly lost: 0 bytes in 0 blocks
| 
| The continuous integration setup for the package includes a nightly job
| against multiple version of the underlying C++ library to check just this.
| In those job we do NOT trigger an alert when, as here, zero bytes are
| reported lost.
| 
| Now, valgrind does report something possibly due (as the _Writing R
| Extensions_ manual notes) to compiler optimisation. So we currently consider
| this spurious.
| 
| Could CRAN let us know if this is considered a 'must fix' issue?  And if so,
| maybe so not show the alarmingly red 'valgrind' link to a report with zero leaks?
| 
| Many thanks as always for all these thorough tests.
| 
| Sincerely,  Dirk
| 
| 
| -- 
| dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Aug 24 23:57:43 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Thu, 25 Aug 2022 09:57:43 +1200
Subject: [R-pkg-devel] 
 CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <25350.34358.937791.492479@rob.eddelbuettel.com>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
 <25350.34358.937791.492479@rob.eddelbuettel.com>
Message-ID: <89F2D059-4C20-470E-843C-40A8250A209A@R-project.org>

Dirk,

as Ivan pointed out there is no indication that your package was flagged due to 0 byte leaks given other possible problems in the report which is likely why it is red, but we can't know since you didn't say, so it's all purely speculative. Given the total lack of details I wouldn't expect any further answer here unless you can provide those.

BTW: if you want an answer from CRAN, you should write to cran at R-project.org (I have not seen any mention of it there) since the actually relevant member may not see it otherwise.

Cheers,
Simon


> On 25/08/2022, at 8:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> Dear CRAN Team,
> 
> On 18 August 2022 at 06:55, Dirk Eddelbuettel wrote:
> | 
> | [ Five days ago, I sent (most) of the message below to a CRAN team member. I
> | have not had a reply, and it now appears that we are asked to email here so I
> | am resending. ]
> 
> An answer would be much appreciated after the five initial days of this being
> ignored as a private mail followed by a further six days of silence out here
> in the open on this very list we once set up for help with packaging issues.
> 
> Can we ignore valgrind reports which show 'definitely lost: 0 bytes' ?
> 
> Curious,  Dirk
> 
> 
> | A package of mine shows a valgrind report at with the details clearly
> | indicating that no memory is lost: 
> | 
> |     ==3533933== LEAK SUMMARY:
> |     ==3533933==    definitely lost: 0 bytes in 0 blocks
> |     ==3533933==    indirectly lost: 0 bytes in 0 blocks
> |     ==3533933==      possibly lost: 0 bytes in 0 blocks
> | 
> | The continuous integration setup for the package includes a nightly job
> | against multiple version of the underlying C++ library to check just this.
> | In those job we do NOT trigger an alert when, as here, zero bytes are
> | reported lost.
> | 
> | Now, valgrind does report something possibly due (as the _Writing R
> | Extensions_ manual notes) to compiler optimisation. So we currently consider
> | this spurious.
> | 
> | Could CRAN let us know if this is considered a 'must fix' issue?  And if so,
> | maybe so not show the alarmingly red 'valgrind' link to a report with zero leaks?
> | 
> | Many thanks as always for all these thorough tests.
> | 
> | Sincerely,  Dirk
> | 
> | 
> | -- 
> | dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From edd @end|ng |rom deb|@n@org  Thu Aug 25 00:12:49 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 24 Aug 2022 17:12:49 -0500
Subject: [R-pkg-devel] 
 CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <89F2D059-4C20-470E-843C-40A8250A209A@R-project.org>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
 <25350.34358.937791.492479@rob.eddelbuettel.com>
 <89F2D059-4C20-470E-843C-40A8250A209A@R-project.org>
Message-ID: <25350.41569.163309.330321@rob.eddelbuettel.com>


Simon,

What you attempt to answer is not the relevant question (as Ivan concurred in
private email).  I can only invite you again to maybe venture to answer the
question I asked rather than belabor a point I didn't make (even if you fancy
lecturing on that one).

Lastly, as you may may missed it in two previous emails: this public post was
preceded by a private email that was also ignored, hence no repeat to private
email to cran at r-project.org.

Cheers,  Dirk



On 25 August 2022 at 09:57, Simon Urbanek wrote:
| Dirk,
| 
| as Ivan pointed out there is no indication that your package was flagged due to 0 byte leaks given other possible problems in the report which is likely why it is red, but we can't know since you didn't say, so it's all purely speculative. Given the total lack of details I wouldn't expect any further answer here unless you can provide those.
| 
| BTW: if you want an answer from CRAN, you should write to cran at R-project.org (I have not seen any mention of it there) since the actually relevant member may not see it otherwise.
| 
| Cheers,
| Simon
| 
| 
| > On 25/08/2022, at 8:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
| > 
| > 
| > Dear CRAN Team,
| > 
| > On 18 August 2022 at 06:55, Dirk Eddelbuettel wrote:
| > | 
| > | [ Five days ago, I sent (most) of the message below to a CRAN team member. I
| > | have not had a reply, and it now appears that we are asked to email here so I
| > | am resending. ]
| > 
| > An answer would be much appreciated after the five initial days of this being
| > ignored as a private mail followed by a further six days of silence out here
| > in the open on this very list we once set up for help with packaging issues.
| > 
| > Can we ignore valgrind reports which show 'definitely lost: 0 bytes' ?
| > 
| > Curious,  Dirk
| > 
| > 
| > | A package of mine shows a valgrind report at with the details clearly
| > | indicating that no memory is lost: 
| > | 
| > |     ==3533933== LEAK SUMMARY:
| > |     ==3533933==    definitely lost: 0 bytes in 0 blocks
| > |     ==3533933==    indirectly lost: 0 bytes in 0 blocks
| > |     ==3533933==      possibly lost: 0 bytes in 0 blocks
| > | 
| > | The continuous integration setup for the package includes a nightly job
| > | against multiple version of the underlying C++ library to check just this.
| > | In those job we do NOT trigger an alert when, as here, zero bytes are
| > | reported lost.
| > | 
| > | Now, valgrind does report something possibly due (as the _Writing R
| > | Extensions_ manual notes) to compiler optimisation. So we currently consider
| > | this spurious.
| > | 
| > | Could CRAN let us know if this is considered a 'must fix' issue?  And if so,
| > | maybe so not show the alarmingly red 'valgrind' link to a report with zero leaks?
| > | 
| > | Many thanks as always for all these thorough tests.
| > | 
| > | Sincerely,  Dirk
| > | 
| > | 
| > | -- 
| > | dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
| > 
| > -- 
| > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
| > 
| > ______________________________________________
| > R-package-devel at r-project.org mailing list
| > https://stat.ethz.ch/mailman/listinfo/r-package-devel
| > 
| 

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd @end|ng |rom deb|@n@org  Thu Aug 25 01:58:42 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 24 Aug 2022 18:58:42 -0500
Subject: [R-pkg-devel] 
 CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <25350.41569.163309.330321@rob.eddelbuettel.com>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
 <25350.34358.937791.492479@rob.eddelbuettel.com>
 <89F2D059-4C20-470E-843C-40A8250A209A@R-project.org>
 <25350.41569.163309.330321@rob.eddelbuettel.com>
Message-ID: <25350.47922.152687.713247@rob.eddelbuettel.com>


As a follow-up:

1. The valgrind summary states 'zero leaks' (see my Subject) but hints at
   'errors' even when none are in the output. It suggests `valgrind -s` but
   when we run `R CMD check --use-valgrind` there is no means for setting
   such options. 

2. I once attempted what _Writing R Extensions_ suggests and created a file
   ~/.valgrindrc which contained `-s` but to no avail.

3. But _Writing R Extensions_ has another (newer ?) hint and using the
   command-line invocation of
     VALGRIND_OPTS="-s" R CMD check --use-valgrind package_verion.tar.gz
   did the trick. The resulting report is clear, the errors all come from
   a third-party system library I have no zero control over.

4. I will look into amending the nightly valgrind at GitHub Actions run to
   set this option to collect some more data.

5. The lack of any response from CRAN is very frustrating. 

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu Aug 25 12:02:36 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 25 Aug 2022 12:02:36 +0200
Subject: [R-pkg-devel] 
 CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <25350.41569.163309.330321@rob.eddelbuettel.com>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
 <25350.34358.937791.492479@rob.eddelbuettel.com>
 <89F2D059-4C20-470E-843C-40A8250A209A@R-project.org>
 <25350.41569.163309.330321@rob.eddelbuettel.com>
Message-ID: <feaa38dc-ea9b-1799-da43-dabd207ee782@statistik.tu-dortmund.de>



On 25.08.2022 00:12, Dirk Eddelbuettel wrote:
> 
> Simon,
> 
> What you attempt to answer is not the relevant question (as Ivan concurred in
> private email).  I can only invite you again to maybe venture to answer the
> question I asked rather than belabor a point I didn't make (even if you fancy
> lecturing on that one).
> 
> Lastly, as you may may missed it in two previous emails: this public post was
> preceded by a private email that was also ignored, hence no repeat to private
> email to cran at r-project.org.

Can you please tell us the subject / date you used? I do not see it in 
our archive, but I may use the wrong search criteria.
(Note that we are searching in an archive of 70000 messages from/to 
CRAN/CRAN-submissions produced only in 2022, i.e. > 300 mail messages a 
day.)

Best,
Uwe



> Cheers,  Dirk
> 
> 
> 
> On 25 August 2022 at 09:57, Simon Urbanek wrote:
> | Dirk,
> |
> | as Ivan pointed out there is no indication that your package was flagged due to 0 byte leaks given other possible problems in the report which is likely why it is red, but we can't know since you didn't say, so it's all purely speculative. Given the total lack of details I wouldn't expect any further answer here unless you can provide those.
> |
> | BTW: if you want an answer from CRAN, you should write to cran at R-project.org (I have not seen any mention of it there) since the actually relevant member may not see it otherwise.
> |
> | Cheers,
> | Simon
> |
> |
> | > On 25/08/2022, at 8:12 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> | >
> | >
> | > Dear CRAN Team,
> | >
> | > On 18 August 2022 at 06:55, Dirk Eddelbuettel wrote:
> | > |
> | > | [ Five days ago, I sent (most) of the message below to a CRAN team member. I
> | > | have not had a reply, and it now appears that we are asked to email here so I
> | > | am resending. ]
> | >
> | > An answer would be much appreciated after the five initial days of this being
> | > ignored as a private mail followed by a further six days of silence out here
> | > in the open on this very list we once set up for help with packaging issues.
> | >
> | > Can we ignore valgrind reports which show 'definitely lost: 0 bytes' ?
> | >
> | > Curious,  Dirk
> | >
> | >
> | > | A package of mine shows a valgrind report at with the details clearly
> | > | indicating that no memory is lost:
> | > |
> | > |     ==3533933== LEAK SUMMARY:
> | > |     ==3533933==    definitely lost: 0 bytes in 0 blocks
> | > |     ==3533933==    indirectly lost: 0 bytes in 0 blocks
> | > |     ==3533933==      possibly lost: 0 bytes in 0 blocks
> | > |
> | > | The continuous integration setup for the package includes a nightly job
> | > | against multiple version of the underlying C++ library to check just this.
> | > | In those job we do NOT trigger an alert when, as here, zero bytes are
> | > | reported lost.
> | > |
> | > | Now, valgrind does report something possibly due (as the _Writing R
> | > | Extensions_ manual notes) to compiler optimisation. So we currently consider
> | > | this spurious.
> | > |
> | > | Could CRAN let us know if this is considered a 'must fix' issue?  And if so,
> | > | maybe so not show the alarmingly red 'valgrind' link to a report with zero leaks?
> | > |
> | > | Many thanks as always for all these thorough tests.
> | > |
> | > | Sincerely,  Dirk
> | > |
> | > |
> | > | --
> | > | dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> | >
> | > --
> | > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> | >
> | > ______________________________________________
> | > R-package-devel at r-project.org mailing list
> | > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> | >
> |
>


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Fri Aug 26 13:36:48 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Fri, 26 Aug 2022 07:36:48 -0400
Subject: [R-pkg-devel] Accepted pkg missing from CRAN
Message-ID: <CAG5xu54dzxprwUp0rSedgwD3gJPVOLVWZM0a0iyha=nMc+MfKg@mail.gmail.com>

Hello,

I submitted a package to CRAN a few days ago, and it was accepted over two
days ago.  BUT, the CRAN website does not list the package (404 Error), and
you can't install the pkg from CRAN either.
https://cran.r-project.org/web/packages/ggsurvfit/index.html

In the past, pkgs seem to be posted immediately after acceptance. Is this
delay something I should be concerned about? How would I go about
contacting CRAN if needed?

Thank you,
Daniel

	[[alternative HTML version deleted]]


From ||u|@@rev|||@ @end|ng |rom gm@||@com  Fri Aug 26 14:33:41 2022
From: ||u|@@rev|||@ @end|ng |rom gm@||@com (=?UTF-8?Q?Llu=C3=ADs_Revilla?=)
Date: Fri, 26 Aug 2022 14:33:41 +0200
Subject: [R-pkg-devel] Accepted pkg missing from CRAN
In-Reply-To: <CAG5xu54dzxprwUp0rSedgwD3gJPVOLVWZM0a0iyha=nMc+MfKg@mail.gmail.com>
References: <CAG5xu54dzxprwUp0rSedgwD3gJPVOLVWZM0a0iyha=nMc+MfKg@mail.gmail.com>
Message-ID: <CAN+W6_swhBsCQv8uemVNGbHJvjWuxq2HdqrDFkwL6H5eJXOXmQ@mail.gmail.com>

Hi Daniel,

I found ggsurvfit in a dashboard of the submission process under the
publish folder (https://r-hub.github.io/cransays/articles/dashboard.html)
.
CRAN volunteers haven't published it yet, and will probably do so soon.

To contact CRAN:
You have the instructions at the bottom of cran.r-project.org: "send
an email to CRAN-submissions at R-project.org following the policy.
Please do not attach submissions to emails, because this will clutter
up the mailboxes of half a dozen people."
In the policy there is also this: "Submission difficulties (such as
non-receipt of the confirmation email) can be discussed with
cran-sysadmin at R-project.org.".

I would wait a couple more days (till a week since the acceptance), if
there hasn't been any change I would send an email explaining the
situation to cran-submissions at r-project.org.

Congratulations on your package acceptance.
Best,

Llu?s

On Fri, 26 Aug 2022 at 13:37, Daniel Sjoberg <danield.sjoberg at gmail.com> wrote:
>
> Hello,
>
> I submitted a package to CRAN a few days ago, and it was accepted over two
> days ago.  BUT, the CRAN website does not list the package (404 Error), and
> you can't install the pkg from CRAN either.
> https://cran.r-project.org/web/packages/ggsurvfit/index.html
>
> In the past, pkgs seem to be posted immediately after acceptance. Is this
> delay something I should be concerned about? How would I go about
> contacting CRAN if needed?
>
> Thank you,
> Daniel
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Fri Aug 26 15:02:45 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Fri, 26 Aug 2022 09:02:45 -0400
Subject: [R-pkg-devel] Accepted pkg missing from CRAN
In-Reply-To: <CAN+W6_swhBsCQv8uemVNGbHJvjWuxq2HdqrDFkwL6H5eJXOXmQ@mail.gmail.com>
References: <CAG5xu54dzxprwUp0rSedgwD3gJPVOLVWZM0a0iyha=nMc+MfKg@mail.gmail.com>
 <CAN+W6_swhBsCQv8uemVNGbHJvjWuxq2HdqrDFkwL6H5eJXOXmQ@mail.gmail.com>
Message-ID: <CAG5xu57y9hV1NWTA9q6Okgy39RiMzHMZ4DCXrXzHjt4TYNxnHQ@mail.gmail.com>

Thank you, thank you, Llu?s!

On Fri, Aug 26, 2022 at 8:33 AM Llu?s Revilla <lluis.revilla at gmail.com>
wrote:

> Hi Daniel,
>
> I found ggsurvfit in a dashboard of the submission process under the
> publish folder (https://r-hub.github.io/cransays/articles/dashboard.html)
> .
> CRAN volunteers haven't published it yet, and will probably do so soon.
>
> To contact CRAN:
> You have the instructions at the bottom of cran.r-project.org: "send
> an email to CRAN-submissions at R-project.org following the policy.
> Please do not attach submissions to emails, because this will clutter
> up the mailboxes of half a dozen people."
> In the policy there is also this: "Submission difficulties (such as
> non-receipt of the confirmation email) can be discussed with
> cran-sysadmin at R-project.org.".
>
> I would wait a couple more days (till a week since the acceptance), if
> there hasn't been any change I would send an email explaining the
> situation to cran-submissions at r-project.org.
>
> Congratulations on your package acceptance.
> Best,
>
> Llu?s
>
> On Fri, 26 Aug 2022 at 13:37, Daniel Sjoberg <danield.sjoberg at gmail.com>
> wrote:
> >
> > Hello,
> >
> > I submitted a package to CRAN a few days ago, and it was accepted over
> two
> > days ago.  BUT, the CRAN website does not list the package (404 Error),
> and
> > you can't install the pkg from CRAN either.
> > https://cran.r-project.org/web/packages/ggsurvfit/index.html
> >
> > In the past, pkgs seem to be posted immediately after acceptance. Is this
> > delay something I should be concerned about? How would I go about
> > contacting CRAN if needed?
> >
> > Thank you,
> > Daniel
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Sat Aug 27 15:41:08 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Sat, 27 Aug 2022 15:41:08 +0200
Subject: [R-pkg-devel] Accepted pkg missing from CRAN
In-Reply-To: <CAG5xu54dzxprwUp0rSedgwD3gJPVOLVWZM0a0iyha=nMc+MfKg@mail.gmail.com>
References: <CAG5xu54dzxprwUp0rSedgwD3gJPVOLVWZM0a0iyha=nMc+MfKg@mail.gmail.com>
Message-ID: <6f1629a5-c449-0690-b8f4-24fd47c3b377@statistik.tu-dortmund.de>

Yes, this one failed to go through the auto-publication queue with a 
LaTeX issue when building the manuals for CRAN:

"...
[6] [7]

! Package textcomp Error: Symbol \textrightarrow not provided by
(textcomp)                font family ptm in TS1 encoding.
(textcomp)                Default family used instead.

See the textcomp package documentation for explanation.
Type  H <return>  for immediate help.
  ...

l.379 ...t therapy with V, T, their sequence (T?
                                                   V), or their
...
"



Please fix and resubmit.

Best,
Uwe Ligges





On 26.08.2022 13:36, Daniel Sjoberg wrote:
> Hello,
> 
> I submitted a package to CRAN a few days ago, and it was accepted over two
> days ago.  BUT, the CRAN website does not list the package (404 Error), and
> you can't install the pkg from CRAN either.
> https://cran.r-project.org/web/packages/ggsurvfit/index.html
> 
> In the past, pkgs seem to be posted immediately after acceptance. Is this
> delay something I should be concerned about? How would I go about
> contacting CRAN if needed?
> 
> Thank you,
> Daniel
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@n|e|d@@joberg @end|ng |rom gm@||@com  Sun Aug 28 04:27:16 2022
From: d@n|e|d@@joberg @end|ng |rom gm@||@com (Daniel Sjoberg)
Date: Sat, 27 Aug 2022 22:27:16 -0400
Subject: [R-pkg-devel] Accepted pkg missing from CRAN
In-Reply-To: <6f1629a5-c449-0690-b8f4-24fd47c3b377@statistik.tu-dortmund.de>
References: <CAG5xu54dzxprwUp0rSedgwD3gJPVOLVWZM0a0iyha=nMc+MfKg@mail.gmail.com>
 <6f1629a5-c449-0690-b8f4-24fd47c3b377@statistik.tu-dortmund.de>
Message-ID: <CAG5xu54vy6FcoTB7KHqE0ckveZU14FxWxbshhvRWiiVr-v2vNQ@mail.gmail.com>

Thank you, Uwe! We're now on CRAN. Much appreciated!

On Sat, Aug 27, 2022 at 9:40 AM Uwe Ligges <ligges at statistik.tu-dortmund.de>
wrote:

> Yes, this one failed to go through the auto-publication queue with a
> LaTeX issue when building the manuals for CRAN:
>
> "...
> [6] [7]
>
> ! Package textcomp Error: Symbol \textrightarrow not provided by
> (textcomp)                font family ptm in TS1 encoding.
> (textcomp)                Default family used instead.
>
> See the textcomp package documentation for explanation.
> Type  H <return>  for immediate help.
>   ...
>
> l.379 ...t therapy with V, T, their sequence (T?
>                                                    V), or their
> ...
> "
>
>
>
> Please fix and resubmit.
>
> Best,
> Uwe Ligges
>
>
>
>
>
> On 26.08.2022 13:36, Daniel Sjoberg wrote:
> > Hello,
> >
> > I submitted a package to CRAN a few days ago, and it was accepted over
> two
> > days ago.  BUT, the CRAN website does not list the package (404 Error),
> and
> > you can't install the pkg from CRAN either.
> > https://cran.r-project.org/web/packages/ggsurvfit/index.html
> >
> > In the past, pkgs seem to be posted immediately after acceptance. Is this
> > delay something I should be concerned about? How would I go about
> > contacting CRAN if needed?
> >
> > Thank you,
> > Daniel
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From @zz@||n| @end|ng |rom @t@t@un|pd@|t  Mon Aug 29 11:01:52 2022
From: @zz@||n| @end|ng |rom @t@t@un|pd@|t (Adelchi Azzalini)
Date: Mon, 29 Aug 2022 11:01:52 +0200
Subject: [R-pkg-devel] dates in NEWS.Rd headers are ignored
Message-ID: <F699593A-C371-4B68-80B1-E1A6E9038009@stat.unipd.it>

Hi. In the last version of package ?sn? (v. 2.1.0) the old NEWS text file 
has been converted to inst/NEWS.Rd. The headers in this file are of the form

\section{Changes in sn version 2.1.0 (2022-07-30)}
\section{Changes in sn version 2.0.2 (2022-03-07)}
and so on

However, when I now look at the package documentation in the HTML rendering, 
the ?NEWS in packages ?sn??  does NOT display the dates!

Details on the session are reported below, in case they are relevant.

Can anyone explain how show these dates? 

---
Adelchi Azzalini
http://azzalini.stat.unipd.it



R> sessionInfo()
R version 4.2.1 (2022-06-23)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Monterey 12.5.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib

Random number generation:
 RNG:     Mersenne-Twister 
 Normal:  Inversion 
 Sample:  Rounding 
 
locale:
[1] en_US.UTF-8/UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] grid      stats4    stats     utils     datasets  grDevices graphics  methods   base     

other attached packages:
[1] gtable_0.3.0  ggplot2_3.3.6 sn_2.1.0     

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.8.3        highr_0.9           pillar_1.7.0        compiler_4.2.1     
 [5] tools_4.2.1         digest_0.6.29       evaluate_0.15       lifecycle_1.0.1    
 [9] tibble_3.1.7        lattice_0.20-45     pkgconfig_2.0.3     rlang_1.0.2        
[13] Matrix_1.4-1        cli_3.3.0           xfun_0.31           stringr_1.4.0      
[17] withr_2.5.0         dplyr_1.0.9         knitr_1.39          generics_0.1.2     
[21] vctrs_0.4.1         isoband_0.2.5       tidyselect_1.1.2    glue_1.6.2         
[25] R6_2.5.1            fansi_1.0.3         purrr_0.3.4         farver_2.1.0       
[29] magrittr_2.0.3      scales_1.2.0        ellipsis_0.3.2      mnormt_2.1.0       
[33] colorspace_2.0-3    numDeriv_2016.8-1.1 labeling_0.4.2      utf8_1.2.2         
[37] stringi_1.7.6       munsell_0.5.0       crayon_1.5.1       
R> 

From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Aug 29 12:36:01 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 29 Aug 2022 12:36:01 +0200
Subject: [R-pkg-devel] dates in NEWS.Rd headers are ignored
In-Reply-To: <F699593A-C371-4B68-80B1-E1A6E9038009@stat.unipd.it>
References: <F699593A-C371-4B68-80B1-E1A6E9038009@stat.unipd.it>
Message-ID: <7fcdf5a6-c11e-9d70-ebc6-49184dd3c6f5@statistik.tu-dortmund.de>



On 29.08.2022 11:01, Adelchi Azzalini wrote:
> Hi. In the last version of package ?sn? (v. 2.1.0) the old NEWS text file
> has been converted to inst/NEWS.Rd. The headers in this file are of the form
> 
> \section{Changes in sn version 2.1.0 (2022-07-30)}
> \section{Changes in sn version 2.0.2 (2022-03-07)}
> and so on
> 
> However, when I now look at the package documentation in the HTML rendering,
> the ?NEWS in packages ?sn??  does NOT display the dates!
> 
> Details on the session are reported below, in case they are relevant.
> 
> Can anyone explain how show these dates?

In an interacticve session news(package="sn")  open a web page in some 
web browser and the html code does not contain the dates, but the text 
form does:

print(news(package="sn"), doBrowse=FALSE)

To analyzse more precisely, we can directly look at the database if the 
format was read correctly:

db <- news(package="sn")
str(db)
db$Date

and all dates were read correctly.

Best,
Uwe Ligges

> ---
> Adelchi Azzalini
> http://azzalini.stat.unipd.it
> 
> 
> 
> R> sessionInfo()
> R version 4.2.1 (2022-06-23)
> Platform: aarch64-apple-darwin20 (64-bit)
> Running under: macOS Monterey 12.5.1
> 
> Matrix products: default
> BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib
> LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib
> 
> Random number generation:
>   RNG:     Mersenne-Twister
>   Normal:  Inversion
>   Sample:  Rounding
>   
> locale:
> [1] en_US.UTF-8/UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] grid      stats4    stats     utils     datasets  grDevices graphics  methods   base
> 
> other attached packages:
> [1] gtable_0.3.0  ggplot2_3.3.6 sn_2.1.0
> 
> loaded via a namespace (and not attached):
>   [1] Rcpp_1.0.8.3        highr_0.9           pillar_1.7.0        compiler_4.2.1
>   [5] tools_4.2.1         digest_0.6.29       evaluate_0.15       lifecycle_1.0.1
>   [9] tibble_3.1.7        lattice_0.20-45     pkgconfig_2.0.3     rlang_1.0.2
> [13] Matrix_1.4-1        cli_3.3.0           xfun_0.31           stringr_1.4.0
> [17] withr_2.5.0         dplyr_1.0.9         knitr_1.39          generics_0.1.2
> [21] vctrs_0.4.1         isoband_0.2.5       tidyselect_1.1.2    glue_1.6.2
> [25] R6_2.5.1            fansi_1.0.3         purrr_0.3.4         farver_2.1.0
> [29] magrittr_2.0.3      scales_1.2.0        ellipsis_0.3.2      mnormt_2.1.0
> [33] colorspace_2.0-3    numDeriv_2016.8-1.1 labeling_0.4.2      utf8_1.2.2
> [37] stringi_1.7.6       munsell_0.5.0       crayon_1.5.1
> R>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @zz@||n| @end|ng |rom @t@t@un|pd@|t  Mon Aug 29 13:06:33 2022
From: @zz@||n| @end|ng |rom @t@t@un|pd@|t (Adelchi Azzalini)
Date: Mon, 29 Aug 2022 13:06:33 +0200
Subject: [R-pkg-devel] dates in NEWS.Rd headers are ignored
In-Reply-To: <7fcdf5a6-c11e-9d70-ebc6-49184dd3c6f5@statistik.tu-dortmund.de>
References: <F699593A-C371-4B68-80B1-E1A6E9038009@stat.unipd.it>
 <7fcdf5a6-c11e-9d70-ebc6-49184dd3c6f5@statistik.tu-dortmund.de>
Message-ID: <FBF0B61E-B9C8-4111-AAD8-D95B279BF919@stat.unipd.it>

Thanks, Uwe. What you write illustrates in greater detail the state of affairs,
but from here I cannot see a way of sorting out the problem, which is as follows 
(as I see it):

1. the inst/NEWS.Rd file contains the required dates;
2. when the package is built and installed, the dates do not show, specifically by
   help(package="sn?), followed by a click on ?Package NEWS; 
3. I do not know how to control the proper translation from Rd to HTML.

So the specific question is: how can I enforce the presence on the dates show by
 help(package="sn?) + click on ?Package NEWS ?

Best wishes,

Adelchi


> On 29 Aug 2022, at 12:36, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
> 
> 
> 
> On 29.08.2022 11:01, Adelchi Azzalini wrote:
>> Hi. In the last version of package ?sn? (v. 2.1.0) the old NEWS text file
>> has been converted to inst/NEWS.Rd. The headers in this file are of the form
>> \section{Changes in sn version 2.1.0 (2022-07-30)}
>> \section{Changes in sn version 2.0.2 (2022-03-07)}
>> and so on
>> However, when I now look at the package documentation in the HTML rendering,
>> the ?NEWS in packages ?sn??  does NOT display the dates!
>> Details on the session are reported below, in case they are relevant.
>> Can anyone explain how show these dates?
> 
> In an interacticve session news(package="sn")  open a web page in some web browser and the html code does not contain the dates, but the text form does:
> 
> print(news(package="sn"), doBrowse=FALSE)
> 
> To analyzse more precisely, we can directly look at the database if the format was read correctly:
> 
> db <- news(package="sn")
> str(db)
> db$Date
> 
> and all dates were read correctly.
> 
> Best,
> Uwe Ligges
> 
>> ---
>> Adelchi Azzalini
>> http://azzalini.stat.unipd.it
>> R> sessionInfo()
>> R version 4.2.1 (2022-06-23)
>> Platform: aarch64-apple-darwin20 (64-bit)
>> Running under: macOS Monterey 12.5.1
>> Matrix products: default
>> BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib
>> LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib
>> Random number generation:
>>  RNG:     Mersenne-Twister
>>  Normal:  Inversion
>>  Sample:  Rounding
>>  locale:
>> [1] en_US.UTF-8/UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>> attached base packages:
>> [1] grid      stats4    stats     utils     datasets  grDevices graphics  methods   base
>> other attached packages:
>> [1] gtable_0.3.0  ggplot2_3.3.6 sn_2.1.0
>> loaded via a namespace (and not attached):
>>  [1] Rcpp_1.0.8.3        highr_0.9           pillar_1.7.0        compiler_4.2.1
>>  [5] tools_4.2.1         digest_0.6.29       evaluate_0.15       lifecycle_1.0.1
>>  [9] tibble_3.1.7        lattice_0.20-45     pkgconfig_2.0.3     rlang_1.0.2
>> [13] Matrix_1.4-1        cli_3.3.0           xfun_0.31           stringr_1.4.0
>> [17] withr_2.5.0         dplyr_1.0.9         knitr_1.39          generics_0.1.2
>> [21] vctrs_0.4.1         isoband_0.2.5       tidyselect_1.1.2    glue_1.6.2
>> [25] R6_2.5.1            fansi_1.0.3         purrr_0.3.4         farver_2.1.0
>> [29] magrittr_2.0.3      scales_1.2.0        ellipsis_0.3.2      mnormt_2.1.0
>> [33] colorspace_2.0-3    numDeriv_2016.8-1.1 labeling_0.4.2      utf8_1.2.2
>> [37] stringi_1.7.6       munsell_0.5.0       crayon_1.5.1
>> R>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Aug 29 13:22:48 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 29 Aug 2022 13:22:48 +0200
Subject: [R-pkg-devel] dates in NEWS.Rd headers are ignored
In-Reply-To: <FBF0B61E-B9C8-4111-AAD8-D95B279BF919@stat.unipd.it>
References: <F699593A-C371-4B68-80B1-E1A6E9038009@stat.unipd.it>
 <7fcdf5a6-c11e-9d70-ebc6-49184dd3c6f5@statistik.tu-dortmund.de>
 <FBF0B61E-B9C8-4111-AAD8-D95B279BF919@stat.unipd.it>
Message-ID: <499b4782-a1fe-ab64-7367-7be2fcd88f06@statistik.tu-dortmund.de>



On 29.08.2022 13:06, Adelchi Azzalini wrote:
> Thanks, Uwe. What you write illustrates in greater detail the state of affairs,
> but from here I cannot see a way of sorting out the problem, which is as follows
> (as I see it):
> 
> 1. the inst/NEWS.Rd file contains the required dates;
> 2. when the package is built and installed, the dates do not show, specifically by
>     help(package="sn?), followed by a click on ?Package NEWS;
> 3. I do not know how to control the proper translation from Rd to HTML.
> 
> So the specific question is: how can I enforce the presence on the dates show by
>   help(package="sn?) + click on ?Package NEWS ?

Currently you cannot, as the code that translates to html does not 
handle the dates. We will discuss this.

Best,
Uwe


> 
> Best wishes,
> 
> Adelchi
> 
> 
>> On 29 Aug 2022, at 12:36, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
>>
>>
>>
>> On 29.08.2022 11:01, Adelchi Azzalini wrote:
>>> Hi. In the last version of package ?sn? (v. 2.1.0) the old NEWS text file
>>> has been converted to inst/NEWS.Rd. The headers in this file are of the form
>>> \section{Changes in sn version 2.1.0 (2022-07-30)}
>>> \section{Changes in sn version 2.0.2 (2022-03-07)}
>>> and so on
>>> However, when I now look at the package documentation in the HTML rendering,
>>> the ?NEWS in packages ?sn??  does NOT display the dates!
>>> Details on the session are reported below, in case they are relevant.
>>> Can anyone explain how show these dates?
>>
>> In an interacticve session news(package="sn")  open a web page in some web browser and the html code does not contain the dates, but the text form does:
>>
>> print(news(package="sn"), doBrowse=FALSE)
>>
>> To analyzse more precisely, we can directly look at the database if the format was read correctly:
>>
>> db <- news(package="sn")
>> str(db)
>> db$Date
>>
>> and all dates were read correctly.
>>
>> Best,
>> Uwe Ligges
>>
>>> ---
>>> Adelchi Azzalini
>>> http://azzalini.stat.unipd.it
>>> R> sessionInfo()
>>> R version 4.2.1 (2022-06-23)
>>> Platform: aarch64-apple-darwin20 (64-bit)
>>> Running under: macOS Monterey 12.5.1
>>> Matrix products: default
>>> BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib
>>> LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib
>>> Random number generation:
>>>   RNG:     Mersenne-Twister
>>>   Normal:  Inversion
>>>   Sample:  Rounding
>>>   locale:
>>> [1] en_US.UTF-8/UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>> attached base packages:
>>> [1] grid      stats4    stats     utils     datasets  grDevices graphics  methods   base
>>> other attached packages:
>>> [1] gtable_0.3.0  ggplot2_3.3.6 sn_2.1.0
>>> loaded via a namespace (and not attached):
>>>   [1] Rcpp_1.0.8.3        highr_0.9           pillar_1.7.0        compiler_4.2.1
>>>   [5] tools_4.2.1         digest_0.6.29       evaluate_0.15       lifecycle_1.0.1
>>>   [9] tibble_3.1.7        lattice_0.20-45     pkgconfig_2.0.3     rlang_1.0.2
>>> [13] Matrix_1.4-1        cli_3.3.0           xfun_0.31           stringr_1.4.0
>>> [17] withr_2.5.0         dplyr_1.0.9         knitr_1.39          generics_0.1.2
>>> [21] vctrs_0.4.1         isoband_0.2.5       tidyselect_1.1.2    glue_1.6.2
>>> [25] R6_2.5.1            fansi_1.0.3         purrr_0.3.4         farver_2.1.0
>>> [29] magrittr_2.0.3      scales_1.2.0        ellipsis_0.3.2      mnormt_2.1.0
>>> [33] colorspace_2.0-3    numDeriv_2016.8-1.1 labeling_0.4.2      utf8_1.2.2
>>> [37] stringi_1.7.6       munsell_0.5.0       crayon_1.5.1
>>> R>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From @zz@||n| @end|ng |rom @t@t@un|pd@|t  Mon Aug 29 15:23:15 2022
From: @zz@||n| @end|ng |rom @t@t@un|pd@|t (Adelchi Azzalini)
Date: Mon, 29 Aug 2022 15:23:15 +0200
Subject: [R-pkg-devel] dates in NEWS.Rd headers are ignored
In-Reply-To: <499b4782-a1fe-ab64-7367-7be2fcd88f06@statistik.tu-dortmund.de>
References: <F699593A-C371-4B68-80B1-E1A6E9038009@stat.unipd.it>
 <7fcdf5a6-c11e-9d70-ebc6-49184dd3c6f5@statistik.tu-dortmund.de>
 <FBF0B61E-B9C8-4111-AAD8-D95B279BF919@stat.unipd.it>
 <499b4782-a1fe-ab64-7367-7be2fcd88f06@statistik.tu-dortmund.de>
Message-ID: <E784FD47-0455-46A6-BC5C-A4A54368DA19@stat.unipd.it>



> On 29 Aug 2022, at 13:22, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
> 
> 
> 
> On 29.08.2022 13:06, Adelchi Azzalini wrote:
>> Thanks, Uwe. What you write illustrates in greater detail the state of affairs,
>> but from here I cannot see a way of sorting out the problem, which is as follows
>> (as I see it):
>> 1. the inst/NEWS.Rd file contains the required dates;
>> 2. when the package is built and installed, the dates do not show, specifically by
>>    help(package="sn?), followed by a click on ?Package NEWS;
>> 3. I do not know how to control the proper translation from Rd to HTML.
>> So the specific question is: how can I enforce the presence on the dates show by
>>  help(package="sn?) + click on ?Package NEWS ?
> 
> Currently you cannot, as the code that translates to html does not handle the dates. We will discuss this.

Thanks for the explanation/confirmation. 

Best wishes,

Adelchi

> 
> Best,
> Uwe
> 
> 
>> Best wishes,
>> Adelchi
>>> On 29 Aug 2022, at 12:36, Uwe Ligges <ligges at statistik.tu-dortmund.de> wrote:
>>> 
>>> 
>>> 
>>> On 29.08.2022 11:01, Adelchi Azzalini wrote:
>>>> Hi. In the last version of package ?sn? (v. 2.1.0) the old NEWS text file
>>>> has been converted to inst/NEWS.Rd. The headers in this file are of the form
>>>> \section{Changes in sn version 2.1.0 (2022-07-30)}
>>>> \section{Changes in sn version 2.0.2 (2022-03-07)}
>>>> and so on
>>>> However, when I now look at the package documentation in the HTML rendering,
>>>> the ?NEWS in packages ?sn??  does NOT display the dates!
>>>> Details on the session are reported below, in case they are relevant.
>>>> Can anyone explain how show these dates?
>>> 
>>> In an interacticve session news(package="sn")  open a web page in some web browser and the html code does not contain the dates, but the text form does:
>>> 
>>> print(news(package="sn"), doBrowse=FALSE)
>>> 
>>> To analyzse more precisely, we can directly look at the database if the format was read correctly:
>>> 
>>> db <- news(package="sn")
>>> str(db)
>>> db$Date
>>> 
>>> and all dates were read correctly.
>>> 
>>> Best,
>>> Uwe Ligges
>>> 
>>>> ---
>>>> Adelchi Azzalini
>>>> http://azzalini.stat.unipd.it
>>>> R> sessionInfo()
>>>> R version 4.2.1 (2022-06-23)
>>>> Platform: aarch64-apple-darwin20 (64-bit)
>>>> Running under: macOS Monterey 12.5.1
>>>> Matrix products: default
>>>> BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib
>>>> LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib
>>>> Random number generation:
>>>>  RNG:     Mersenne-Twister
>>>>  Normal:  Inversion
>>>>  Sample:  Rounding
>>>>  locale:
>>>> [1] en_US.UTF-8/UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>>> attached base packages:
>>>> [1] grid      stats4    stats     utils     datasets  grDevices graphics  methods   base
>>>> other attached packages:
>>>> [1] gtable_0.3.0  ggplot2_3.3.6 sn_2.1.0
>>>> loaded via a namespace (and not attached):
>>>>  [1] Rcpp_1.0.8.3        highr_0.9           pillar_1.7.0        compiler_4.2.1
>>>>  [5] tools_4.2.1         digest_0.6.29       evaluate_0.15       lifecycle_1.0.1
>>>>  [9] tibble_3.1.7        lattice_0.20-45     pkgconfig_2.0.3     rlang_1.0.2
>>>> [13] Matrix_1.4-1        cli_3.3.0           xfun_0.31           stringr_1.4.0
>>>> [17] withr_2.5.0         dplyr_1.0.9         knitr_1.39          generics_0.1.2
>>>> [21] vctrs_0.4.1         isoband_0.2.5       tidyselect_1.1.2    glue_1.6.2
>>>> [25] R6_2.5.1            fansi_1.0.3         purrr_0.3.4         farver_2.1.0
>>>> [29] magrittr_2.0.3      scales_1.2.0        ellipsis_0.3.2      mnormt_2.1.0
>>>> [33] colorspace_2.0-3    numDeriv_2016.8-1.1 labeling_0.4.2      utf8_1.2.2
>>>> [37] stringi_1.7.6       munsell_0.5.0       crayon_1.5.1
>>>> R>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@tr7320 @end|ng |rom un|@@ydney@edu@@u  Mon Aug 29 17:00:04 2022
From: d@tr7320 @end|ng |rom un|@@ydney@edu@@u (Dario Strbenac)
Date: Mon, 29 Aug 2022 15:00:04 +0000
Subject: [R-pkg-devel] Dispatch for S3 and Ordinary Function with Same Name
Message-ID: <SY2PR01MB300376E48BB4307783EBF4E9CD769@SY2PR01MB3003.ausprd01.prod.outlook.com>

Good day,

If there is a function named predict in my package and another in another package, such as randomForest, which is also called in a particular wrapper function in my package, how may I ensure that the call to predict inside of the wrapper function will call randomForest's prediction function and not the predict function defined elsewhere in my package? To illustrate

randomForestPredictInterface <- function(forest, measurementsTest, ...)
{
  predictions <- predict(forest, measurementsTest) # Currently, executes predict defined in my package.

--------------------------------------
Dario Strbenac
University of Sydney
Camperdown NSW 2050
Australia

From @|ex@ndre@court|o| @end|ng |rom gm@||@com  Mon Aug 29 17:48:09 2022
From: @|ex@ndre@court|o| @end|ng |rom gm@||@com (Alexandre Courtiol)
Date: Mon, 29 Aug 2022 17:48:09 +0200
Subject: [R-pkg-devel] 
 Dispatch for S3 and Ordinary Function with Same Name
In-Reply-To: <SY2PR01MB300376E48BB4307783EBF4E9CD769@SY2PR01MB3003.ausprd01.prod.outlook.com>
References: <SY2PR01MB300376E48BB4307783EBF4E9CD769@SY2PR01MB3003.ausprd01.prod.outlook.com>
Message-ID: <CAERMt4cjR0m4FfwGMjkSCq0i0F0PiZ4scfCOze1j-xp+7BmGqw@mail.gmail.com>

Hi Dario,
I would have suggested using randomForest::predict.randomForest but you
cannot because it is not exported by randomForest :-(
There is probably a better way but my workaround would be for you to define
your own class to avoid the ambiguity in scope.
Whenever you want to use the predict from randomForest rather than yours, I
would just strip out your specific class name.
Hopefully someone will advise something more elegant to force the scoping...
++



On Mon, 29 Aug 2022 at 17:00, Dario Strbenac <dstr7320 at uni.sydney.edu.au>
wrote:

> Good day,
>
> If there is a function named predict in my package and another in another
> package, such as randomForest, which is also called in a particular wrapper
> function in my package, how may I ensure that the call to predict inside of
> the wrapper function will call randomForest's prediction function and not
> the predict function defined elsewhere in my package? To illustrate
>
> randomForestPredictInterface <- function(forest, measurementsTest, ...)
> {
>   predictions <- predict(forest, measurementsTest) # Currently, executes
> predict defined in my package.
>
> --------------------------------------
> Dario Strbenac
> University of Sydney
> Camperdown NSW 2050
> Australia
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


-- 
Alexandre Courtiol, www.datazoogang.de

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Aug 29 18:04:40 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 29 Aug 2022 18:04:40 +0200
Subject: [R-pkg-devel] 
 Dispatch for S3 and Ordinary Function with Same Name
In-Reply-To: <SY2PR01MB300376E48BB4307783EBF4E9CD769@SY2PR01MB3003.ausprd01.prod.outlook.com>
References: <SY2PR01MB300376E48BB4307783EBF4E9CD769@SY2PR01MB3003.ausprd01.prod.outlook.com>
Message-ID: <607f57f5-c736-85ad-7f62-33115e03b78e@statistik.tu-dortmund.de>



On 29.08.2022 17:00, Dario Strbenac wrote:
> Good day,
> 
> If there is a function named predict in my package and another in another package, such as randomForest, which is also called in a particular wrapper function in my package, how may I ensure that the call to predict inside of the wrapper function will call randomForest's prediction function and not the predict function defined elsewhere in my package? To illustrate
> 
> randomForestPredictInterface <- function(forest, measurementsTest, ...)
> {
>    predictions <- predict(forest, measurementsTest) # Currently, executes predict defined in my package.

Idealy do not define a new predict which is a generic function in  R.

Rather, you methods may produce objects that follow,e g.g., the classes 
provided by randomForest plus eventiually extra elements.
Then you invent a new class name, e.g. moreRandomForest that inherits 
from randomForest:

...
class(x)  <- c("moreRandomForest", "randomForest")

if you provide your own moreRandomForest method for predict, dispatch 
will choose it, if you do not provide it, mathod dispatch will choose 
the one from the pterh package. Please simply read some introductory 
material about S3.


Best,
Uwe Ligges



> --------------------------------------
> Dario Strbenac
> University of Sydney
> Camperdown NSW 2050
> Australia
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Mon Aug 29 18:10:20 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Mon, 29 Aug 2022 11:10:20 -0500
Subject: [R-pkg-devel] [Solved,
 sort-of] CRAN valgrind reports with zero leaks - actionable?
In-Reply-To: <feaa38dc-ea9b-1799-da43-dabd207ee782@statistik.tu-dortmund.de>
References: <25342.10389.559082.344505@rob.eddelbuettel.com>
 <25350.34358.937791.492479@rob.eddelbuettel.com>
 <89F2D059-4C20-470E-843C-40A8250A209A@R-project.org>
 <25350.41569.163309.330321@rob.eddelbuettel.com>
 <feaa38dc-ea9b-1799-da43-dabd207ee782@statistik.tu-dortmund.de>
Message-ID: <25356.58604.642889.44028@rob.eddelbuettel.com>


Based on further (off-list) follow-ups with Simon and Uwe, the situation can
now be summarized as follows:

 - there appears to be no word about non-leak errors reported by valgrind in
   the official documentation; I will have to plead that those with the power
   to amend these documents maybe address that one day

 - it has been confirmed that when such a valgrind report is present, there
   is no auto-processing of the package and a manual re-check is done; as a
   package maintainer I rather avoid that to minimize manual interventions by
   both the CRAN team and the package maintainer (i.e. myself)

 - using `VALGRIND_OPTS="-s" R -d valgrind -f nameOfTheFile.R` is helpful,
   especially for the test framework I use where test files are standard R
   scripts; this helps in locating the issue

 - in the case that spawned this, the error actually comes from just one test
   and is tickled by a third-party system library so there is nothing for us
   to do here, besides not to run the test

 - so I moved the test into a testfile matching 'test_.*_extra.R' and now
   exclude files with that pattern via .Rbuildignore; that gives us a fuller
   test surface when testing locally via the full the test directory yet
   permits to isolate-away tests we would rather not be running at CRAN.

My thanks to everybody who helped with the question and clarified the context.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From y@nn@r|chet @end|ng |rom |r@n@|r  Tue Aug 30 14:14:07 2022
From: y@nn@r|chet @end|ng |rom |r@n@|r (RICHET Yann)
Date: Tue, 30 Aug 2022 12:14:07 +0000
Subject: [R-pkg-devel] src/ subdirectories contains sources....
Message-ID: <91E98C94545DA84BBCE16EE6BB38CFB4015B230994@irsn.fr>

Dear all,

I already asked some advice to well integrate a full C++ library as a submodule in my package... (which is just a wrapper for that cpp lib). As suggested, I moved the submodule inside src/, fixed some makefiles, ...

But I still have a WARNING on Windows (only): 
* checking package subdirectories ... WARNING
Subdirectory 'src' contains no source files.

https://win-builder.r-project.org/incoming_pretest/rlibkriging_0.6-0_20220830_115756/Windows/00check.log

While my src/ is well populated with subdirectories containing source files...

Regards,

Yann


From @teph@n@@truckm@nn @end|ng |rom un|-gre||@w@|d@de  Tue Aug 30 14:38:36 2022
From: @teph@n@@truckm@nn @end|ng |rom un|-gre||@w@|d@de (Stephan Struckmann)
Date: Tue, 30 Aug 2022 14:38:36 +0200
Subject: [R-pkg-devel] r-oldrel-windows-ix86+x86_64 -- bioconductor links?
Message-ID: <D475C395-0034-4963-B215-1562009D9B13@uni-greifswald.de>

Dear list members,

thank you for reading. For a few weeks, I have a WARNING on CRAN package checks for our dataquieR package, which does not even
indirectly use Bioconductor nor cites anything from there. The warning states, that an old bioconductor release is not available any more:

> Check: for unstated dependencies in ?tests?
> Result: WARN
>     Warning: unable to access index for repository https://bioconductor.org/packages/3.14/bioc/src/contrib:
>      cannot open URL 'https://bioconductor.org/packages/3.14/bioc/src/contrib/PACKAGES'
>     Warning: unable to access index for repository https://bioconductor.org/packages/3.14/data/annotation/src/contrib:
>      cannot open URL 'https://bioconductor.org/packages/3.14/data/annotation/src/contrib/PACKAGES'
>     Warning: unable to access index for repository https://bioconductor.org/packages/3.14/data/experiment/src/contrib:
>      cannot open URL 'https://bioconductor.org/packages/3.14/data/experiment/src/contrib/PACKAGES'
> Flavor: r-oldrel-windows-ix86+x86_64

I suspect, this WARNING is related with the test infrastructure somehow. Since I also have to fix two NOTEs within the next two weeks, I should comment on this WARNING too.
What would you propose to do about the WARNING ? I cannot address it, because dataquieR is not using Bioconductor at all (I?m rather sure about this, because
`grep -ir bioc *` returns nothing, and because the BiocManager package does not list https://CRAN.R-project.org/package=BiocManager
in its reverse dependencies).

I expected the WARNING to disappear once someone fixes the suspected problems on r-oldrel-windows-ix86+x86_64, but this has not yet happened. Any hints how to handle this
are appreciated, thank you in advance,

Stephan


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP
URL: <https://stat.ethz.ch/pipermail/r-package-devel/attachments/20220830/073e61a4/attachment.sig>

From @ergue|@@oko| @end|ng |rom gm@||@com  Tue Aug 30 14:39:43 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Tue, 30 Aug 2022 14:39:43 +0200
Subject: [R-pkg-devel] Fwd:  src/ subdirectories contains sources....
In-Reply-To: <788b3859-60db-3f61-5a9b-15d71a48e291@insa-toulouse.fr>
References: <788b3859-60db-3f61-5a9b-15d71a48e291@insa-toulouse.fr>
Message-ID: <c38ca63a-40b4-3e0c-fc04-2be19759df8f@gmail.com>


Le 30/08/2022 ? 14:14, RICHET Yann a ?crit?:
> Dear all,
>
> I already asked some advice to well integrate a full C++ library as a submodule in my package... (which is just a wrapper for that cpp lib). As suggested, I moved the submodule inside src/, fixed some makefiles, ...
>
> But I still have a WARNING on Windows (only):
> * checking package subdirectories ... WARNING
> Subdirectory 'src' contains no source files.
>
> https://win-builder.r-project.org/incoming_pretest/rlibkriging_0.6-0_20220830_115756/Windows/00check.log
>
> While my src/ is well populated with subdirectories containing source files...

These files are coming from the library that you want to wrap. You still 
have to add an actual wrapper, i.e. your own code that will take SEXP 
arguments convert them in C type variables needed by the wrapped lib and 
once got the result from a lib call to convert it back to SEXP and 
return to R world. For example, the nloptr package (you are inspired 
off) has src/nloptr.c where it defines a function

 ?? SEXP NLoptR_Optimize( SEXP args ) {...}

and in R/nloptr.R it is called with

 ?? solution <- .Call( "NLoptR_Optimize", ret, PACKAGE = "nloptr" )

In now days, using Rcpp for lib wrapping is much more tractable solution 
(IMHO). So you can look over there.

Best,
Serguei.

> Regards,
>
> Yann
>
> ______________________________________________
> R-package-devel at r-project.org  mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Aug 31 13:44:48 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 31 Aug 2022 13:44:48 +0200
Subject: [R-pkg-devel] 
 r-oldrel-windows-ix86+x86_64 -- bioconductor links?
In-Reply-To: <D475C395-0034-4963-B215-1562009D9B13@uni-greifswald.de>
References: <D475C395-0034-4963-B215-1562009D9B13@uni-greifswald.de>
Message-ID: <d8359195-b09c-71eb-49d9-0a73cd1e976d@statistik.tu-dortmund.de>



On 30.08.2022 14:38, Stephan Struckmann wrote:
> Dear list members,
> 
> thank you for reading. For a few weeks, I have a WARNING on CRAN package checks for our dataquieR package, which does not even
> indirectly use Bioconductor nor cites anything from there. The warning states, that an old bioconductor release is not available any more:
> 
>> Check: for unstated dependencies in ?tests?
>> Result: WARN
>>      Warning: unable to access index for repository https://bioconductor.org/packages/3.14/bioc/src/contrib:
>>       cannot open URL 'https://bioconductor.org/packages/3.14/bioc/src/contrib/PACKAGES'
>>      Warning: unable to access index for repository https://bioconductor.org/packages/3.14/data/annotation/src/contrib:
>>       cannot open URL 'https://bioconductor.org/packages/3.14/data/annotation/src/contrib/PACKAGES'
>>      Warning: unable to access index for repository https://bioconductor.org/packages/3.14/data/experiment/src/contrib:
>>       cannot open URL 'https://bioconductor.org/packages/3.14/data/experiment/src/contrib/PACKAGES'
>> Flavor: r-oldrel-windows-ix86+x86_64

Simply ignore this.

Best,
Uwe Ligges


> I suspect, this WARNING is related with the test infrastructure somehow. Since I also have to fix two NOTEs within the next two weeks, I should comment on this WARNING too.
> What would you propose to do about the WARNING ? I cannot address it, because dataquieR is not using Bioconductor at all (I?m rather sure about this, because
> `grep -ir bioc *` returns nothing, and because the BiocManager package does not list https://CRAN.R-project.org/package=BiocManager
> in its reverse dependencies).
> 
> I expected the WARNING to disappear once someone fixes the suspected problems on r-oldrel-windows-ix86+x86_64, but this has not yet happened. Any hints how to handle this
> are appreciated, thank you in advance,
> 
> Stephan
> 
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From et|enne@b@cher @end|ng |rom protonm@||@com  Thu Sep  1 15:55:15 2022
From: et|enne@b@cher @end|ng |rom protonm@||@com (Etienne Bacher)
Date: Thu, 01 Sep 2022 13:55:15 +0000
Subject: [R-pkg-devel] tryCatch() doesn't capture errors due to && or ||
 with R CMD check --as-cran
Message-ID: <EYtAuD5vXFFQeFENJu_gUOXYiZoeRc85COpFtZDOLPWH4SgCxhZ-wR6qjssrCIAgqm3uxKSW3dSfDxqShu1_HkxROiND9PjbiuVTRQYpKQU=@protonmail.com>

Dear all, 

Calling && or || with LHS or (if evaluated) RHS of length greater than one gives an error in the devel version of R and a warning since R 4.2.0. With R 4.2.1, I can capture this warning with tryCatch(). However, R CMD check with R-devel fails because of this new behavior, meaning that tryCatch() doesn't work. For example, take this function:

foo <- function() {
  tryCatch(
    if (c(TRUE, TRUE) || c(TRUE, TRUE)) 1,
    warning = function(w) {
      print(w)
      NULL
    },
    error = function(e) {
      print(e)
      NULL
    }
  )
}

With R 4.2.1, this correctly gives a warning and returns NULL when I run this locally:
> foo()
<simpleWarning in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in coercion to 'logical(1)'>
NULL

And if I change the environment variables to return an error instead of the warning, it correctly gives an error and returns NULL:
> Sys.setenv(
    `_R_CHECK_LENGTH_1_CONDITION_` = "true",
    `_R_CHECK_LENGTH_1_LOGIC2_` = "true"
)
>foo()
<simpleError in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in coercion to 'logical(1)'>
NULL

This behavior is expected. But if I put this function in a package, add a test for it, and run R CMD check "." --as-cran (or rcmdcheck::rcmdcheck(args = "--as-cran")), then I get an error that I paste at the end of this email because it's quite long. I thought that tryCatch() would capture this error, even when using R CMD check with R-devel, but this is not the case. Is this an expected behavior or a bug?

If you want to reproduce this error, I made a tiny package here: https://github.com/etiennebacher/testpackage. You can simply clone the repo and run R CMD check on it. 

If it matters, I'm using R 4.2.1 on Windows 10.

Thanks in advance,

Etienne


 ----------- FAILURE REPORT -------------- 
 --- failure: length > 1 in coercion to logical ---
 --- srcref --- 
: 
 --- package (from environment) --- 
compiler
 --- call from context --- 
do.call(ffun, args)
 --- call from argument --- 
.Primitive("||")(c(TRUE, TRUE), c(TRUE, TRUE))
 --- R stacktrace ---
where 1: do.call(ffun, args)
where 2: mode(e)
where 3: mode(e) %in% constModes
where 4: checkConst(do.call(ffun, args))
where 5: doTryCatch(return(expr), name, parentenv, handler)
where 6: tryCatchOne(expr, names, parentenv, handlers[[1L]])
where 7: tryCatchList(expr, names[-nh], parentenv, handlers[-nh])
where 8: doTryCatch(return(expr), name, parentenv, handler)
where 9: tryCatchOne(tryCatchList(expr, names[-nh], parentenv, handlers[-nh]), 
    names[nh], parentenv, handlers[[nh]])
where 10: tryCatchList(expr, classes, parentenv, handlers)
where 11: tryCatch(checkConst(do.call(ffun, args)), error = function(e) NULL, 
    warning = function(w) NULL)
where 12: constantFoldCall(e, cntxt)
where 13: constantFold(test, cntxt, loc = cb$savecurloc())
where 14: h(e, cb, cntxt)
where 15: tryInline(call, cb, cntxt)
where 16: cmpCall(e, cb, cntxt)
where 17: cmp(e, cb, cntxt, setloc = FALSE)
where 18: genCode(a, pcntxt, loc = cb$savecurloc())
where 19: cb$putconst(genCode(a, pcntxt, loc = cb$savecurloc()))
where 20: cmpCallArgs(args, cb, cntxt, nse)
where 21: cmpCallSymFun(fun, args, call, cb, cntxt)
where 22: cmpCall(e, cb, cntxt)
where 23: cmp(subexp, cb, cntxt, setloc = FALSE)
where 24: h(e, cb, cntxt)
where 25: tryInline(call, cb, cntxt)
where 26: cmpCall(e, cb, cntxt)
where 27: cmp(e, cb, cntxt, setloc = FALSE)
where 28: genCode(body(f), ncntxt, loc = loc)
where 29: cmpfun(f)
where 30: doTryCatch(return(expr), name, parentenv, handler)
where 31: tryCatchOne(expr, names, parentenv, handlers[[1L]])
where 32: tryCatchList(expr, classes, parentenv, handlers)
where 33: tryCatch(cmpfun(f), error = function(e) {
    notifyCompilerError(paste(e$message, "at", deparse(e$call)))
    f
})
where 34: compiler:::tryCmpfun(function () 
{
    tryCatch(if (c(TRUE, TRUE) || c(TRUE, TRUE)) 
        1, warning = function(w) {
        print(w)
        NULL
    }, error = function(e) {
        print(e)
        NULL
    })
})
where 35: lazyLoadDBinsertVariable(vars[i], from, datafile, ascii, compress, 
    envhook)
where 36: makeLazyLoadDB(ns, dbbase, compress = compress, set.install.dir = set.install.dir)
where 37: code2LazyLoadDB(package, lib.loc = lib.loc, keep.source = keep.source, 
    keep.parse.data = keep.parse.data, compress = compress, set.install.dir = set.install.dir)
where 38: tools:::makeLazyLoading("testpackage", "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/00LOCK-TESTPA~1/00new", 
    keep.source = FALSE, keep.parse.data = FALSE, set.install.dir = "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/testpackage")

 --- value of length: 2 type: logical ---
[1] TRUE TRUE
 --- function from context --- 
function (what, args, quote = FALSE, envir = parent.frame()) 
{
    if (!is.list(args)) 
        stop("second argument must be a list")
    if (quote) 
        args <- lapply(args, enquote)
    .Internal(do.call(what, args, envir))
}
<bytecode: 0x0000021b0a155e20>
<environment: namespace:base>
 --- function search by body ---
Function do.call in namespace base has this body.
 ----------- END OF FAILURE REPORT -------------- 
Fatal error: length > 1 in coercion to logical


From pro|jcn@@h @end|ng |rom gm@||@com  Thu Sep  1 16:48:06 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Thu, 1 Sep 2022 10:48:06 -0400
Subject: [R-pkg-devel] Advice on elegant way to alias function name
Message-ID: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>

Hi,

I've a package where it has been suggested that one of the functions -- call
it "myfn()" -- should be called something else, say "thefn()". Of course, I'll
need to keep the old name around for a while.

Web search has suggested simple assignment of

     thefn <- myfn

but I cannot seem to get this to work with R CMD check when I put this in a .R
file in the code and put alias and usage stanzas in documentation. I get alias
and missing argument type errors. I've tried a number of variations on this theme
without appreciable success.

A workaround is to copy the entire function with Roxygen2 documentation and
name change, but this seems inelegant.

Is there a better way e.g., using something like onLoad ? Pointers to working
examples in CRAN or Github packages would be welcome.

Best, JN


From n|u|tz @end|ng |rom gm@||@com  Thu Sep  1 16:53:40 2022
From: n|u|tz @end|ng |rom gm@||@com (Neal Fultz)
Date: Thu, 1 Sep 2022 07:53:40 -0700
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
Message-ID: <CAL9B2ve8ERfK-e-QmXa3K0CWx_ycqWW5ABZovBOfrQst_SOYRw@mail.gmail.com>

Many of Hadley Wickhams packages have things with both US and UK spellings
(summarise/summarize, color/colour), I would check ggplot2 or dplyr.

https://github.com/cran/dplyr/blob/master/R/summarise.R#L122-L124

On Thu, Sep 1, 2022 at 7:48 AM J C Nash <profjcnash at gmail.com> wrote:

> Hi,
>
> I've a package where it has been suggested that one of the functions --
> call
> it "myfn()" -- should be called something else, say "thefn()". Of course,
> I'll
> need to keep the old name around for a while.
>
> Web search has suggested simple assignment of
>
>      thefn <- myfn
>
> but I cannot seem to get this to work with R CMD check when I put this in
> a .R
> file in the code and put alias and usage stanzas in documentation. I get
> alias
> and missing argument type errors. I've tried a number of variations on
> this theme
> without appreciable success.
>
> A workaround is to copy the entire function with Roxygen2 documentation and
> name change, but this seems inelegant.
>
> Is there a better way e.g., using something like onLoad ? Pointers to
> working
> examples in CRAN or Github packages would be welcome.
>
> Best, JN
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu Sep  1 17:01:09 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 1 Sep 2022 17:01:09 +0200
Subject: [R-pkg-devel] tryCatch() doesn't capture errors due to && or ||
 with R CMD check --as-cran
In-Reply-To: <EYtAuD5vXFFQeFENJu_gUOXYiZoeRc85COpFtZDOLPWH4SgCxhZ-wR6qjssrCIAgqm3uxKSW3dSfDxqShu1_HkxROiND9PjbiuVTRQYpKQU=@protonmail.com>
References: <EYtAuD5vXFFQeFENJu_gUOXYiZoeRc85COpFtZDOLPWH4SgCxhZ-wR6qjssrCIAgqm3uxKSW3dSfDxqShu1_HkxROiND9PjbiuVTRQYpKQU=@protonmail.com>
Message-ID: <fe3f5d10-f6f3-d5d7-b3ea-620c81c68287@gmail.com>


On 9/1/22 15:55, Etienne Bacher wrote:
> Dear all,
>
> Calling && or || with LHS or (if evaluated) RHS of length greater than one gives an error in the devel version of R and a warning since R 4.2.0. With R 4.2.1, I can capture this warning with tryCatch(). However, R CMD check with R-devel fails because of this new behavior, meaning that tryCatch() doesn't work. For example, take this function:
>
> foo <- function() {
>    tryCatch(
>      if (c(TRUE, TRUE) || c(TRUE, TRUE)) 1,
>      warning = function(w) {
>        print(w)
>        NULL
>      },
>      error = function(e) {
>        print(e)
>        NULL
>      }
>    )
> }
>
> With R 4.2.1, this correctly gives a warning and returns NULL when I run this locally:
>> foo()
> <simpleWarning in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in coercion to 'logical(1)'>
> NULL
>
> And if I change the environment variables to return an error instead of the warning, it correctly gives an error and returns NULL:
>> Sys.setenv(
>      `_R_CHECK_LENGTH_1_CONDITION_` = "true",
>      `_R_CHECK_LENGTH_1_LOGIC2_` = "true"
> )
>> foo()
> <simpleError in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in coercion to 'logical(1)'>
> NULL
>
> This behavior is expected. But if I put this function in a package, add a test for it, and run R CMD check "." --as-cran (or rcmdcheck::rcmdcheck(args = "--as-cran")), then I get an error that I paste at the end of this email because it's quite long. I thought that tryCatch() would capture this error, even when using R CMD check with R-devel, but this is not the case. Is this an expected behavior or a bug?
>
> If you want to reproduce this error, I made a tiny package here: https://github.com/etiennebacher/testpackage. You can simply clone the repo and run R CMD check on it.
>
> If it matters, I'm using R 4.2.1 on Windows 10.

This is because R CMD check in R 4.2.1 still used

Sys.setenv1("_R_CHECK_LENGTH_1_LOGIC2_", "abort,verbose")

with --as-cran (in check.R), so that the problematic code is found with 
highest probability.

By now in R-devel, these variables no longer have any effect (more in 
NEWS) and you always get an error, even during R CMD check --as-cran. 
Your example package passes on my build of R-devel.

Best
Tomas


>
> Thanks in advance,
>
> Etienne
>
>
>   ----------- FAILURE REPORT --------------
>   --- failure: length > 1 in coercion to logical ---
>   --- srcref ---
> :
>   --- package (from environment) ---
> compiler
>   --- call from context ---
> do.call(ffun, args)
>   --- call from argument ---
> .Primitive("||")(c(TRUE, TRUE), c(TRUE, TRUE))
>   --- R stacktrace ---
> where 1: do.call(ffun, args)
> where 2: mode(e)
> where 3: mode(e) %in% constModes
> where 4: checkConst(do.call(ffun, args))
> where 5: doTryCatch(return(expr), name, parentenv, handler)
> where 6: tryCatchOne(expr, names, parentenv, handlers[[1L]])
> where 7: tryCatchList(expr, names[-nh], parentenv, handlers[-nh])
> where 8: doTryCatch(return(expr), name, parentenv, handler)
> where 9: tryCatchOne(tryCatchList(expr, names[-nh], parentenv, handlers[-nh]),
>      names[nh], parentenv, handlers[[nh]])
> where 10: tryCatchList(expr, classes, parentenv, handlers)
> where 11: tryCatch(checkConst(do.call(ffun, args)), error = function(e) NULL,
>      warning = function(w) NULL)
> where 12: constantFoldCall(e, cntxt)
> where 13: constantFold(test, cntxt, loc = cb$savecurloc())
> where 14: h(e, cb, cntxt)
> where 15: tryInline(call, cb, cntxt)
> where 16: cmpCall(e, cb, cntxt)
> where 17: cmp(e, cb, cntxt, setloc = FALSE)
> where 18: genCode(a, pcntxt, loc = cb$savecurloc())
> where 19: cb$putconst(genCode(a, pcntxt, loc = cb$savecurloc()))
> where 20: cmpCallArgs(args, cb, cntxt, nse)
> where 21: cmpCallSymFun(fun, args, call, cb, cntxt)
> where 22: cmpCall(e, cb, cntxt)
> where 23: cmp(subexp, cb, cntxt, setloc = FALSE)
> where 24: h(e, cb, cntxt)
> where 25: tryInline(call, cb, cntxt)
> where 26: cmpCall(e, cb, cntxt)
> where 27: cmp(e, cb, cntxt, setloc = FALSE)
> where 28: genCode(body(f), ncntxt, loc = loc)
> where 29: cmpfun(f)
> where 30: doTryCatch(return(expr), name, parentenv, handler)
> where 31: tryCatchOne(expr, names, parentenv, handlers[[1L]])
> where 32: tryCatchList(expr, classes, parentenv, handlers)
> where 33: tryCatch(cmpfun(f), error = function(e) {
>      notifyCompilerError(paste(e$message, "at", deparse(e$call)))
>      f
> })
> where 34: compiler:::tryCmpfun(function ()
> {
>      tryCatch(if (c(TRUE, TRUE) || c(TRUE, TRUE))
>          1, warning = function(w) {
>          print(w)
>          NULL
>      }, error = function(e) {
>          print(e)
>          NULL
>      })
> })
> where 35: lazyLoadDBinsertVariable(vars[i], from, datafile, ascii, compress,
>      envhook)
> where 36: makeLazyLoadDB(ns, dbbase, compress = compress, set.install.dir = set.install.dir)
> where 37: code2LazyLoadDB(package, lib.loc = lib.loc, keep.source = keep.source,
>      keep.parse.data = keep.parse.data, compress = compress, set.install.dir = set.install.dir)
> where 38: tools:::makeLazyLoading("testpackage", "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/00LOCK-TESTPA~1/00new",
>      keep.source = FALSE, keep.parse.data = FALSE, set.install.dir = "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/testpackage")
>
>   --- value of length: 2 type: logical ---
> [1] TRUE TRUE
>   --- function from context ---
> function (what, args, quote = FALSE, envir = parent.frame())
> {
>      if (!is.list(args))
>          stop("second argument must be a list")
>      if (quote)
>          args <- lapply(args, enquote)
>      .Internal(do.call(what, args, envir))
> }
> <bytecode: 0x0000021b0a155e20>
> <environment: namespace:base>
>   --- function search by body ---
> Function do.call in namespace base has this body.
>   ----------- END OF FAILURE REPORT --------------
> Fatal error: length > 1 in coercion to logical
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu Sep  1 17:01:32 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 1 Sep 2022 17:01:32 +0200
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
Message-ID: <dbc3b596-4043-6a3d-813e-cf29ab0951f5@statistik.tu-dortmund.de>



On 01.09.2022 16:48, J C Nash wrote:
> Hi,
> 
> I've a package where it has been suggested that one of the functions -- 
> call
> it "myfn()" -- should be called something else, say "thefn()". Of 
> course, I'll
> need to keep the old name around for a while.
> 
> Web search has suggested simple assignment of
> 
>  ??? thefn <- myfn
> 
> but I cannot seem to get this to work with R CMD check when I put this 
> in a .R
> file in the code and put alias and usage stanzas in documentation. I get 
> alias
> and missing argument type errors. I've tried a number of variations on 
> this theme
> without appreciable success.

Can you make the package available? It should work.

Best,
Uwe

> A workaround is to copy the entire function with Roxygen2 documentation and
> name change, but this seems inelegant.
> 
> Is there a better way e.g., using something like onLoad ? Pointers to 
> working
> examples in CRAN or Github packages would be welcome.
> 
> Best, JN
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From @ergue|@@oko| @end|ng |rom gm@||@com  Thu Sep  1 17:09:34 2022
From: @ergue|@@oko| @end|ng |rom gm@||@com (Sokol Serguei)
Date: Thu, 1 Sep 2022 17:09:34 +0200
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
Message-ID: <f2901c71-3959-e637-77ce-3ca13ef10b0d@gmail.com>

Le 01/09/2022 ? 16:48, J C Nash a ?crit?:
> Hi,
>
> I've a package where it has been suggested that one of the functions 
> -- call
> it "myfn()" -- should be called something else, say "thefn()". Of 
> course, I'll
> need to keep the old name around for a while.
>
> Web search has suggested simple assignment of
>
> ??? thefn <- myfn
>
> but I cannot seem to get this to work with R CMD check when I put this 
> in a .R
> file in the code and put alias and usage stanzas in documentation.

Is there any place where we can see what alias and stanzas you have used 
actually?

Best,
Serguei.

> I get alias
> and missing argument type errors. I've tried a number of variations on 
> this theme
> without appreciable success.
>
> A workaround is to copy the entire function with Roxygen2 
> documentation and
> name change, but this seems inelegant.
>
> Is there a better way e.g., using something like onLoad ? Pointers to 
> working
> examples in CRAN or Github packages would be welcome.
>
> Best, JN
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu Sep  1 17:19:47 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 1 Sep 2022 17:19:47 +0200
Subject: [R-pkg-devel] tryCatch() doesn't capture errors due to && or ||
 with R CMD check --as-cran
In-Reply-To: <EYtAuD5vXFFQeFENJu_gUOXYiZoeRc85COpFtZDOLPWH4SgCxhZ-wR6qjssrCIAgqm3uxKSW3dSfDxqShu1_HkxROiND9PjbiuVTRQYpKQU=@protonmail.com>
References: <EYtAuD5vXFFQeFENJu_gUOXYiZoeRc85COpFtZDOLPWH4SgCxhZ-wR6qjssrCIAgqm3uxKSW3dSfDxqShu1_HkxROiND9PjbiuVTRQYpKQU=@protonmail.com>
Message-ID: <25360.52627.355395.525599@stat.math.ethz.ch>

>>>>> Etienne Bacher 
>>>>>     on Thu, 01 Sep 2022 13:55:15 +0000 writes:

> Dear all, 

> Calling && or || with LHS or (if evaluated) RHS of length greater than one gives an error in the devel version of R and a warning since R 4.2.0. With R 4.2.1, I can capture this warning with tryCatch(). However, R CMD check with R-devel fails because of this new behavior, meaning that tryCatch() doesn't work. 

Very much on purpose, even though we (the R Core team) may not
have said so loudly.

The problem is that too many "smart" people, including the
authors of certain widely used testing packages do call
tryCatch(), or suppressWarnings() and similar to eliminate
warnings and errors in a situation we really *do* want these to
be shown.

For instance, we, the Matrix package authors, have planned to
deprecate certain usages of  as(*, "<someMatrixClass>")  and
give deprecation warnings -- see  help(Deprecated) -- so the
users and package authors can see the undesired usages and
eventually update their code.

No, because of too much use of suppressWarnings() they *NEVER
EVER* see *any* deprecation warnings for all their own code
which silences these warnings and for all (often 100%) of their
tests where they use the famous test...t  package ...

An additional reason for such a non-suppressible error is that
when you find such warnings/errors in package testing of
packages with many dependencies, if the warning/error is raised
and you *do* see it, it may *still* not at all be easy to see
from which of the (sometimes 20--100) packages that are in use
the problem is caused.

I hope you understand that such "obnoxious" behavior is
rational and desirable in such rare cases.

Best regards,
Martin


--
Martin Maechler
ETH Zurich  and  R Core team

> For example, take this function:
> 
> foo <- function() {
>   tryCatch(
>     if (c(TRUE, TRUE) || c(TRUE, TRUE)) 1,
>     warning = function(w) {
>       print(w)
>       NULL
>     },
>     error = function(e) {
>       print(e)
>       NULL
>     }
>   )
> }
> 
> With R 4.2.1, this correctly gives a warning and returns NULL when I run this locally:
> > foo()
> <simpleWarning in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in coercion to 'logical(1)'>
> NULL
> 
> And if I change the environment variables to return an error instead of the warning, it correctly gives an error and returns NULL:
> > Sys.setenv(
>     `_R_CHECK_LENGTH_1_CONDITION_` = "true",
>     `_R_CHECK_LENGTH_1_LOGIC2_` = "true"
> )
> >foo()
> <simpleError in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in coercion to 'logical(1)'>
> NULL
> 
> This behavior is expected. But if I put this function in a package, add a test for it, and run R CMD check "." --as-cran (or rcmdcheck::rcmdcheck(args = "--as-cran")), then I get an error that I paste at the end of this email because it's quite long. I thought that tryCatch() would capture this error, even when using R CMD check with R-devel, but this is not the case. Is this an expected behavior or a bug?
> 
> If you want to reproduce this error, I made a tiny package here: https://github.com/etiennebacher/testpackage. You can simply clone the repo and run R CMD check on it. 
> 
> If it matters, I'm using R 4.2.1 on Windows 10.
> 
> Thanks in advance,
> 
> Etienne
> 
> 
>  ----------- FAILURE REPORT -------------- 
>  --- failure: length > 1 in coercion to logical ---
>  --- srcref --- 
> : 
>  --- package (from environment) --- 
> compiler
>  --- call from context --- 
> do.call(ffun, args)
>  --- call from argument --- 
> .Primitive("||")(c(TRUE, TRUE), c(TRUE, TRUE))
>  --- R stacktrace ---
> where 1: do.call(ffun, args)
> where 2: mode(e)
> where 3: mode(e) %in% constModes
> where 4: checkConst(do.call(ffun, args))
> where 5: doTryCatch(return(expr), name, parentenv, handler)
> where 6: tryCatchOne(expr, names, parentenv, handlers[[1L]])
> where 7: tryCatchList(expr, names[-nh], parentenv, handlers[-nh])
> where 8: doTryCatch(return(expr), name, parentenv, handler)
> where 9: tryCatchOne(tryCatchList(expr, names[-nh], parentenv, handlers[-nh]), 
>     names[nh], parentenv, handlers[[nh]])
> where 10: tryCatchList(expr, classes, parentenv, handlers)
> where 11: tryCatch(checkConst(do.call(ffun, args)), error = function(e) NULL, 
>     warning = function(w) NULL)
> where 12: constantFoldCall(e, cntxt)
> where 13: constantFold(test, cntxt, loc = cb$savecurloc())
> where 14: h(e, cb, cntxt)
> where 15: tryInline(call, cb, cntxt)
> where 16: cmpCall(e, cb, cntxt)
> where 17: cmp(e, cb, cntxt, setloc = FALSE)
> where 18: genCode(a, pcntxt, loc = cb$savecurloc())
> where 19: cb$putconst(genCode(a, pcntxt, loc = cb$savecurloc()))
> where 20: cmpCallArgs(args, cb, cntxt, nse)
> where 21: cmpCallSymFun(fun, args, call, cb, cntxt)
> where 22: cmpCall(e, cb, cntxt)
> where 23: cmp(subexp, cb, cntxt, setloc = FALSE)
> where 24: h(e, cb, cntxt)
> where 25: tryInline(call, cb, cntxt)
> where 26: cmpCall(e, cb, cntxt)
> where 27: cmp(e, cb, cntxt, setloc = FALSE)
> where 28: genCode(body(f), ncntxt, loc = loc)
> where 29: cmpfun(f)
> where 30: doTryCatch(return(expr), name, parentenv, handler)
> where 31: tryCatchOne(expr, names, parentenv, handlers[[1L]])
> where 32: tryCatchList(expr, classes, parentenv, handlers)
> where 33: tryCatch(cmpfun(f), error = function(e) {
>     notifyCompilerError(paste(e$message, "at", deparse(e$call)))
>     f
> })
> where 34: compiler:::tryCmpfun(function () 
> {
>     tryCatch(if (c(TRUE, TRUE) || c(TRUE, TRUE)) 
>         1, warning = function(w) {
>         print(w)
>         NULL
>     }, error = function(e) {
>         print(e)
>         NULL
>     })
> })
> where 35: lazyLoadDBinsertVariable(vars[i], from, datafile, ascii, compress, 
>     envhook)
> where 36: makeLazyLoadDB(ns, dbbase, compress = compress, set.install.dir = set.install.dir)
> where 37: code2LazyLoadDB(package, lib.loc = lib.loc, keep.source = keep.source, 
>     keep.parse.data = keep.parse.data, compress = compress, set.install.dir = set.install.dir)
> where 38: tools:::makeLazyLoading("testpackage", "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/00LOCK-TESTPA~1/00new", 
>     keep.source = FALSE, keep.parse.data = FALSE, set.install.dir = "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/testpackage")
> 
>  --- value of length: 2 type: logical ---
> [1] TRUE TRUE
>  --- function from context --- 
> function (what, args, quote = FALSE, envir = parent.frame()) 
> {
>     if (!is.list(args)) 
>         stop("second argument must be a list")
>     if (quote) 
>         args <- lapply(args, enquote)
>     .Internal(do.call(what, args, envir))
> }
> <bytecode: 0x0000021b0a155e20>
> <environment: namespace:base>
>  --- function search by body ---
> Function do.call in namespace base has this body.
>  ----------- END OF FAILURE REPORT -------------- 
> Fatal error: length > 1 in coercion to logical
>


From h@w|ckh@m @end|ng |rom gm@||@com  Thu Sep  1 17:29:33 2022
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Thu, 1 Sep 2022 10:29:33 -0500
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
Message-ID: <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>

On Thu, Sep 1, 2022 at 9:48 AM J C Nash <profjcnash at gmail.com> wrote:
>
> Hi,
>
> I've a package where it has been suggested that one of the functions -- call
> it "myfn()" -- should be called something else, say "thefn()". Of course, I'll
> need to keep the old name around for a while.
>
> Web search has suggested simple assignment of
>
>      thefn <- myfn
>
> but I cannot seem to get this to work with R CMD check when I put this in a .R
> file in the code and put alias and usage stanzas in documentation. I get alias
> and missing argument type errors. I've tried a number of variations on this theme
> without appreciable success.
>
> A workaround is to copy the entire function with Roxygen2 documentation and
> name change, but this seems inelegant.

You'll also need to add a couple of roxygen tags:

#' @export
#' @rdname myfn
thefn <- myfn

Hadley

-- 
http://hadley.nz


From ||one| @end|ng |rom r@tud|o@com  Thu Sep  1 18:47:36 2022
From: ||one| @end|ng |rom r@tud|o@com (Lionel Henry)
Date: Thu, 1 Sep 2022 18:47:36 +0200
Subject: [R-pkg-devel] tryCatch() doesn't capture errors due to && or ||
 with R CMD check --as-cran
In-Reply-To: <25360.52627.355395.525599@stat.math.ethz.ch>
References: <EYtAuD5vXFFQeFENJu_gUOXYiZoeRc85COpFtZDOLPWH4SgCxhZ-wR6qjssrCIAgqm3uxKSW3dSfDxqShu1_HkxROiND9PjbiuVTRQYpKQU=@protonmail.com>
 <25360.52627.355395.525599@stat.math.ethz.ch>
Message-ID: <CAJf4E3pkq0HjYzAtdwFm_Uhttowgo_o-c2nq9gqbjKSFB9gm6g@mail.gmail.com>

Hi Martin,

I'm not sure I understand what you mean regarding suppressed warnings
in testthat.

- All warnings are reported to users by `devtools::test()`, with
  accompanying backtraces. They are not hidden.

- R CMD check doesn't report warnings emitted from files in `tests/`.

If you need some sort of warning to surface as errors, warnings, or
notes in R CMD check, it should be possible to come up with
something. This could take the form of special classes of conditions
that R CMD check would catch and emit corresponding diagnostics
for. We would change testthat to make sure all such conditions are
properly emitted during checks.

Best,
Lionel


On 9/1/22, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
>>>>>> Etienne Bacher
>>>>>>     on Thu, 01 Sep 2022 13:55:15 +0000 writes:
>
>> Dear all,
>
>> Calling && or || with LHS or (if evaluated) RHS of length greater than one
>> gives an error in the devel version of R and a warning since R 4.2.0. With
>> R 4.2.1, I can capture this warning with tryCatch(). However, R CMD check
>> with R-devel fails because of this new behavior, meaning that tryCatch()
>> doesn't work.
>
> Very much on purpose, even though we (the R Core team) may not
> have said so loudly.
>
> The problem is that too many "smart" people, including the
> authors of certain widely used testing packages do call
> tryCatch(), or suppressWarnings() and similar to eliminate
> warnings and errors in a situation we really *do* want these to
> be shown.
>
> For instance, we, the Matrix package authors, have planned to
> deprecate certain usages of  as(*, "<someMatrixClass>")  and
> give deprecation warnings -- see  help(Deprecated) -- so the
> users and package authors can see the undesired usages and
> eventually update their code.
>
> No, because of too much use of suppressWarnings() they *NEVER
> EVER* see *any* deprecation warnings for all their own code
> which silences these warnings and for all (often 100%) of their
> tests where they use the famous test...t  package ...
>
> An additional reason for such a non-suppressible error is that
> when you find such warnings/errors in package testing of
> packages with many dependencies, if the warning/error is raised
> and you *do* see it, it may *still* not at all be easy to see
> from which of the (sometimes 20--100) packages that are in use
> the problem is caused.
>
> I hope you understand that such "obnoxious" behavior is
> rational and desirable in such rare cases.
>
> Best regards,
> Martin
>
>
> --
> Martin Maechler
> ETH Zurich  and  R Core team
>
>> For example, take this function:
>>
>> foo <- function() {
>>   tryCatch(
>>     if (c(TRUE, TRUE) || c(TRUE, TRUE)) 1,
>>     warning = function(w) {
>>       print(w)
>>       NULL
>>     },
>>     error = function(e) {
>>       print(e)
>>       NULL
>>     }
>>   )
>> }
>>
>> With R 4.2.1, this correctly gives a warning and returns NULL when I run
>> this locally:
>> > foo()
>> <simpleWarning in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in
>> coercion to 'logical(1)'>
>> NULL
>>
>> And if I change the environment variables to return an error instead of
>> the warning, it correctly gives an error and returns NULL:
>> > Sys.setenv(
>>     `_R_CHECK_LENGTH_1_CONDITION_` = "true",
>>     `_R_CHECK_LENGTH_1_LOGIC2_` = "true"
>> )
>> >foo()
>> <simpleError in c(TRUE, TRUE) || c(TRUE, TRUE): 'length(x) = 2 > 1' in
>> coercion to 'logical(1)'>
>> NULL
>>
>> This behavior is expected. But if I put this function in a package, add a
>> test for it, and run R CMD check "." --as-cran (or
>> rcmdcheck::rcmdcheck(args = "--as-cran")), then I get an error that I
>> paste at the end of this email because it's quite long. I thought that
>> tryCatch() would capture this error, even when using R CMD check with
>> R-devel, but this is not the case. Is this an expected behavior or a bug?
>>
>> If you want to reproduce this error, I made a tiny package here:
>> https://github.com/etiennebacher/testpackage. You can simply clone the
>> repo and run R CMD check on it.
>>
>> If it matters, I'm using R 4.2.1 on Windows 10.
>>
>> Thanks in advance,
>>
>> Etienne
>>
>>
>>  ----------- FAILURE REPORT --------------
>>  --- failure: length > 1 in coercion to logical ---
>>  --- srcref ---
>> :
>>  --- package (from environment) ---
>> compiler
>>  --- call from context ---
>> do.call(ffun, args)
>>  --- call from argument ---
>> .Primitive("||")(c(TRUE, TRUE), c(TRUE, TRUE))
>>  --- R stacktrace ---
>> where 1: do.call(ffun, args)
>> where 2: mode(e)
>> where 3: mode(e) %in% constModes
>> where 4: checkConst(do.call(ffun, args))
>> where 5: doTryCatch(return(expr), name, parentenv, handler)
>> where 6: tryCatchOne(expr, names, parentenv, handlers[[1L]])
>> where 7: tryCatchList(expr, names[-nh], parentenv, handlers[-nh])
>> where 8: doTryCatch(return(expr), name, parentenv, handler)
>> where 9: tryCatchOne(tryCatchList(expr, names[-nh], parentenv,
>> handlers[-nh]),
>>     names[nh], parentenv, handlers[[nh]])
>> where 10: tryCatchList(expr, classes, parentenv, handlers)
>> where 11: tryCatch(checkConst(do.call(ffun, args)), error = function(e)
>> NULL,
>>     warning = function(w) NULL)
>> where 12: constantFoldCall(e, cntxt)
>> where 13: constantFold(test, cntxt, loc = cb$savecurloc())
>> where 14: h(e, cb, cntxt)
>> where 15: tryInline(call, cb, cntxt)
>> where 16: cmpCall(e, cb, cntxt)
>> where 17: cmp(e, cb, cntxt, setloc = FALSE)
>> where 18: genCode(a, pcntxt, loc = cb$savecurloc())
>> where 19: cb$putconst(genCode(a, pcntxt, loc = cb$savecurloc()))
>> where 20: cmpCallArgs(args, cb, cntxt, nse)
>> where 21: cmpCallSymFun(fun, args, call, cb, cntxt)
>> where 22: cmpCall(e, cb, cntxt)
>> where 23: cmp(subexp, cb, cntxt, setloc = FALSE)
>> where 24: h(e, cb, cntxt)
>> where 25: tryInline(call, cb, cntxt)
>> where 26: cmpCall(e, cb, cntxt)
>> where 27: cmp(e, cb, cntxt, setloc = FALSE)
>> where 28: genCode(body(f), ncntxt, loc = loc)
>> where 29: cmpfun(f)
>> where 30: doTryCatch(return(expr), name, parentenv, handler)
>> where 31: tryCatchOne(expr, names, parentenv, handlers[[1L]])
>> where 32: tryCatchList(expr, classes, parentenv, handlers)
>> where 33: tryCatch(cmpfun(f), error = function(e) {
>>     notifyCompilerError(paste(e$message, "at", deparse(e$call)))
>>     f
>> })
>> where 34: compiler:::tryCmpfun(function ()
>> {
>>     tryCatch(if (c(TRUE, TRUE) || c(TRUE, TRUE))
>>         1, warning = function(w) {
>>         print(w)
>>         NULL
>>     }, error = function(e) {
>>         print(e)
>>         NULL
>>     })
>> })
>> where 35: lazyLoadDBinsertVariable(vars[i], from, datafile, ascii,
>> compress,
>>     envhook)
>> where 36: makeLazyLoadDB(ns, dbbase, compress = compress, set.install.dir
>> = set.install.dir)
>> where 37: code2LazyLoadDB(package, lib.loc = lib.loc, keep.source =
>> keep.source,
>>     keep.parse.data = keep.parse.data, compress = compress,
>> set.install.dir = set.install.dir)
>> where 38: tools:::makeLazyLoading("testpackage",
>> "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/00LOCK-TESTPA~1/00new",
>>
>>     keep.source = FALSE, keep.parse.data = FALSE, set.install.dir =
>> "C:/Users/etienne/AppData/Local/Temp/Rtmp8QXtOL/file41b43ee61605/testpackage.Rcheck/testpackage")
>>
>>  --- value of length: 2 type: logical ---
>> [1] TRUE TRUE
>>  --- function from context ---
>> function (what, args, quote = FALSE, envir = parent.frame())
>> {
>>     if (!is.list(args))
>>         stop("second argument must be a list")
>>     if (quote)
>>         args <- lapply(args, enquote)
>>     .Internal(do.call(what, args, envir))
>> }
>> <bytecode: 0x0000021b0a155e20>
>> <environment: namespace:base>
>>  --- function search by body ---
>> Function do.call in namespace base has this body.
>>  ----------- END OF FAILURE REPORT --------------
>> Fatal error: length > 1 in coercion to logical
>>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From pro|jcn@@h @end|ng |rom gm@||@com  Thu Sep  1 20:51:37 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Thu, 1 Sep 2022 14:51:37 -0400
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
 <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
Message-ID: <ac548c4d-5aaf-488c-c2d8-607576b6da7f@gmail.com>


Thanks to all for many quick replies.

In trying different suggestions, it appears I may have some sort of conflict
going on in the Roxygen tags and some other part of my package. To avoid
sowing confusion on the list, I'll take a step back and go through things
carefully and post my findings in a few days, hopefully with an explanation
of why things didn't work as I expected.

Best,

JN


From ru@@e||-|enth @end|ng |rom u|ow@@edu  Thu Sep  1 23:53:56 2022
From: ru@@e||-|enth @end|ng |rom u|ow@@edu (Lenth, Russell V)
Date: Thu, 1 Sep 2022 21:53:56 +0000
Subject: [R-pkg-devel] Examples with conditional blocks
Message-ID: <DM6PR04MB4474896BCDCF2B5DC1EEB82EF17B9@DM6PR04MB4474.namprd04.prod.outlook.com>

Dear package developers,

What is the best way to provide examples in help pages that should only be run under certain conditions -- 
e.g., whether another package is installed? The code that is run conditionally is then an expression, so
only the results of the last statement are displayed; and even if we force-print results, the output is
separated from the code that produces it. 

The best I have been able to come up with is to use withAutoprint(), such as we see here:
---------------------------------------------------------------------------
> example(hpd.summary)

hpd.sm> if(require("coda")) withAutoprint({
hpd.sm+   # Create an emmGrid object from a system file
hpd.sm+   cbpp.rg <- do.call(emmobj, 
hpd.sm+       readRDS(system.file("extdata", "cbpplist", package = "emmeans")))
hpd.sm+   cbpp.emm <- emmeans(cbpp.rg, "period")
hpd.sm+   hpd.summary(cbpp.emm)   # or just summary(cbpp.emm) as it gets redirected
hpd.sm+   
hpd.sm+   # Test for any two-fold difference
hpd.sm+   summary(pairs(cbpp.emm), type = "response", delta = log(2))
hpd.sm+ }, spaced = TRUE)
Loading required package: coda

> cbpp.rg <- do.call(emmobj, readRDS(system.file("extdata", "cbpplist", package = "emmeans")))

> cbpp.emm <- emmeans(cbpp.rg, "period")

> hpd.summary(cbpp.emm)
 period emmean lower.HPD upper.HPD
 1       -1.43     -1.96    -0.894
 2       -2.39     -3.13    -1.823
 3       -2.52     -3.19    -1.862
 4       -2.97     -3.88    -1.998

Point estimate displayed: median 
Results are given on the logit (not the response) scale. 
HPD interval probability: 0.95 

> summary(pairs(cbpp.emm), type = "response", delta = log(2))
 contrast          odds.ratio lower.HPD upper.HPD p.equiv odds.eq
 period1 / period2       2.60     1.264      4.34   0.210  0.2658
 period1 / period3       2.90     1.266      5.42   0.114  0.1287
 period1 / period4       4.64     1.595      9.76   0.026  0.0267
 period2 / period3       1.14     0.486      2.36   0.918 11.1951
 period2 / period4       1.78     0.580      4.35   0.604  1.5253
 period3 / period4       1.55     0.437      4.01   0.700  2.3333

Point estimate displayed: median 
'p.equiv' and 'odds.eq' based on posterior P(|lin. pred.| < 0.6931) 
Results are back-transformed from the log odds ratio scale 
HPD interval probability: 0.95
---------------------------------------------------------------------------

This "works" in that we can see the code and the output, but it is unduly messy: The example code is displayed twice, the call to withAutoprint() adds clutter, comments are suppressed, and the part last part no longer has the example prompt string ("hpd.sm>" in this illustration).

Along these lines, I have a suggestion for enhancement of the example() function. That function allows for the example code to be marked-up with conditional blocks such as \dontrun{}. My suggestion is to provide an additional conditional markup option, perhaps \runif{expr}{...}, that runs the code in the second pair of braces exactly like any other example code when expr is true, and behaves like \dontrun{} otherwise.

Thanks

Russ Lenth
Univ of Iowa


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Sep  2 00:13:28 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 1 Sep 2022 18:13:28 -0400
Subject: [R-pkg-devel] Examples with conditional blocks
In-Reply-To: <DM6PR04MB4474896BCDCF2B5DC1EEB82EF17B9@DM6PR04MB4474.namprd04.prod.outlook.com>
References: <DM6PR04MB4474896BCDCF2B5DC1EEB82EF17B9@DM6PR04MB4474.namprd04.prod.outlook.com>
Message-ID: <29d63215-ffcb-f04c-a34c-e4789b9bf476@gmail.com>

On 01/09/2022 5:53 p.m., Lenth, Russell V wrote:
> Dear package developers,
> 
> What is the best way to provide examples in help pages that should only be run under certain conditions --
> e.g., whether another package is installed? The code that is run conditionally is then an expression, so
> only the results of the last statement are displayed; and even if we force-print results, the output is
> separated from the code that produces it.
> 
> The best I have been able to come up with is to use withAutoprint(), such as we see here:

I don't think I've seen much better.

> ---------------------------------------------------------------------------
>> example(hpd.summary)
> 
> hpd.sm> if(require("coda")) withAutoprint({
> hpd.sm+   # Create an emmGrid object from a system file
> hpd.sm+   cbpp.rg <- do.call(emmobj,
> hpd.sm+       readRDS(system.file("extdata", "cbpplist", package = "emmeans")))
> hpd.sm+   cbpp.emm <- emmeans(cbpp.rg, "period")
> hpd.sm+   hpd.summary(cbpp.emm)   # or just summary(cbpp.emm) as it gets redirected
> hpd.sm+
> hpd.sm+   # Test for any two-fold difference
> hpd.sm+   summary(pairs(cbpp.emm), type = "response", delta = log(2))
> hpd.sm+ }, spaced = TRUE)
> Loading required package: coda
> 
>> cbpp.rg <- do.call(emmobj, readRDS(system.file("extdata", "cbpplist", package = "emmeans")))
> 
>> cbpp.emm <- emmeans(cbpp.rg, "period")
> 
>> hpd.summary(cbpp.emm)
>   period emmean lower.HPD upper.HPD
>   1       -1.43     -1.96    -0.894
>   2       -2.39     -3.13    -1.823
>   3       -2.52     -3.19    -1.862
>   4       -2.97     -3.88    -1.998
> 
> Point estimate displayed: median
> Results are given on the logit (not the response) scale.
> HPD interval probability: 0.95
> 
>> summary(pairs(cbpp.emm), type = "response", delta = log(2))
>   contrast          odds.ratio lower.HPD upper.HPD p.equiv odds.eq
>   period1 / period2       2.60     1.264      4.34   0.210  0.2658
>   period1 / period3       2.90     1.266      5.42   0.114  0.1287
>   period1 / period4       4.64     1.595      9.76   0.026  0.0267
>   period2 / period3       1.14     0.486      2.36   0.918 11.1951
>   period2 / period4       1.78     0.580      4.35   0.604  1.5253
>   period3 / period4       1.55     0.437      4.01   0.700  2.3333
> 
> Point estimate displayed: median
> 'p.equiv' and 'odds.eq' based on posterior P(|lin. pred.| < 0.6931)
> Results are back-transformed from the log odds ratio scale
> HPD interval probability: 0.95
> ---------------------------------------------------------------------------
> 
> This "works" in that we can see the code and the output, but it is unduly messy: The example code is displayed twice, the call to withAutoprint() adds clutter, comments are suppressed, and the part last part no longer has the example prompt string ("hpd.sm>" in this illustration).
> 
> Along these lines, I have a suggestion for enhancement of the example() function. That function allows for the example code to be marked-up with conditional blocks such as \dontrun{}. My suggestion is to provide an additional conditional markup option, perhaps \runif{expr}{...}, that runs the code in the second pair of braces exactly like any other example code when expr is true, and behaves like \dontrun{} otherwise.
> 

I think that would be a good idea, but it doesn't look easy.

Duncan Murdoch


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Fri Sep  2 17:18:08 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 2 Sep 2022 17:18:08 +0200
Subject: [R-pkg-devel] tryCatch() doesn't capture errors due to && or ||
 with R CMD check --as-cran
In-Reply-To: <CAJf4E3pkq0HjYzAtdwFm_Uhttowgo_o-c2nq9gqbjKSFB9gm6g@mail.gmail.com>
References: <EYtAuD5vXFFQeFENJu_gUOXYiZoeRc85COpFtZDOLPWH4SgCxhZ-wR6qjssrCIAgqm3uxKSW3dSfDxqShu1_HkxROiND9PjbiuVTRQYpKQU=@protonmail.com>
 <25360.52627.355395.525599@stat.math.ethz.ch>
 <CAJf4E3pkq0HjYzAtdwFm_Uhttowgo_o-c2nq9gqbjKSFB9gm6g@mail.gmail.com>
Message-ID: <25362.7856.798437.449426@stat.math.ethz.ch>

>>>>> Lionel Henry 
>>>>>     on Thu, 1 Sep 2022 18:47:36 +0200 writes:

    > Hi Martin,
    > I'm not sure I understand what you mean regarding suppressed warnings
    > in testthat.

    > - All warnings are reported to users by `devtools::test()`, with
    > accompanying backtraces. They are not hidden.

    > - R CMD check doesn't report warnings emitted from files in `tests/`.

but you can easily grep them in the tests/*.Rout files.
There are none of these in the testthat case,
and it's own summary only *counts* the number of warnings.

At least for me just now in a development version of lme4 (github),
running with increased (non-default) testlevel
	export LME4_TEST_LEVEL=2

I get useful *.Rout files (with only one warning, easily greppable)
for the non-testthat tests whereas  for the testthat ones I only get

------------------------------------------------------------------------
[ FAIL 3 | WARN 1 | SKIP 1 | PASS 829 ]

?? Skipped tests ???????????????????????????????????????????????????????????????
? On CRAN (1)

?? Failed tests ????????????????????????????????????????????????????????????????
?? Failure (test-methods.R:878:9): parallel influence ??????????????????????????
`i1` not equal to `i2`.
Component "vcov[-case]": Component "1": Attributes: < Length mismatch: comparison on first 1 components >
    .............................
    .............................
Component "vcov[-case]": Component "9": Attributes: < Length mismatch: comparison on first 1 components >
...
?? Failure (test-summary.R:33:3): lmer ?????????????????????????????????????????
tfun(cc1) not equal to c(...).
Lengths differ: 5 is not 10
?? Failure (test-summary.R:46:3): lmer ?????????????????????????????????????????
tfun(cc2) not equal to c(...).
Lengths differ: 5 is not 10

[ FAIL 3 | WARN 1 | SKIP 1 | PASS 829 ]
Error: Test failures
Execution halted
------------------------------------------------------------------------

Telling me (twice) that there was  1 warning, but
I don't know of any way to *see* that warning
(after everything is run, and I have  lme4.Rcheck/  to look
into).


    > If you need some sort of warning to surface as errors, warnings, or
    > notes in R CMD check, it should be possible to come up with
    > something.

Yes, that would be important for some of us.

IIRC, It does not help to just add

  options(warn = 2)

at the beginning of the main tests/*.R  file, or inside the
tests/testthat/*.R files , even though that would be standard R
behavior,  no ?

    > This could take the form of special classes of conditions
    > that R CMD check would catch and emit corresponding diagnostics
    > for. We would change testthat to make sure all such conditions are
    > properly emitted during checks.

If they are emitted as in R from warning() or stop() -- from R or C,
that would be a big step forward for us (R core) who'd like to
see effects of changing base R, and for all package maintainers considering
changing their API or just deprecating something, and using  .Deprecated()
{or equivalent} for that.

Thank you, Lionel!

Martin


From pro|jcn@@h @end|ng |rom gm@||@com  Fri Sep  2 22:22:33 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Fri, 2 Sep 2022 16:22:33 -0400
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
 <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
Message-ID: <c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>

With some playing around I found a workable solution.

- NAMESPACE needs  export(thefn)
- thefn.Rd needs usage and arguments documented
- myfn.Rd must NOT have alias(thefn)

And I believe I've got the roxygen2 tags to work in Rstudio. In R itself,
roxygen2 gives an error
     Error: invalid version specification ?0.68?
though the string '0.68' appears nowhere in my package according to grep.
I have no idea what this is about, especially as Rstudio works fine.

While I like the idea of documentation in code files, I think I'll go
back to separately created .Rd files.

If anyone is interested, package and README are at
https://gitlab.com/nashjc/nlsr2022

Best,

John Nash


On 2022-09-01 11:29, Hadley Wickham wrote:
> On Thu, Sep 1, 2022 at 9:48 AM J C Nash <profjcnash at gmail.com> wrote:
>>
>> Hi,
>>
>> I've a package where it has been suggested that one of the functions -- call
>> it "myfn()" -- should be called something else, say "thefn()". Of course, I'll
>> need to keep the old name around for a while.
>>
>> Web search has suggested simple assignment of
>>
>>       thefn <- myfn
>>
>> but I cannot seem to get this to work with R CMD check when I put this in a .R
>> file in the code and put alias and usage stanzas in documentation. I get alias
>> and missing argument type errors. I've tried a number of variations on this theme
>> without appreciable success.
>>
>> A workaround is to copy the entire function with Roxygen2 documentation and
>> name change, but this seems inelegant.
> 
> You'll also need to add a couple of roxygen tags:
> 
> #' @export
> #' @rdname myfn
> thefn <- myfn
> 
> Hadley
>


From edd @end|ng |rom deb|@n@org  Fri Sep  2 22:34:02 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 2 Sep 2022 15:34:02 -0500
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
 <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
 <c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
Message-ID: <25362.26810.80952.485910@rob.eddelbuettel.com>


On 2 September 2022 at 16:22, J C Nash wrote:
| And I believe I've got the roxygen2 tags to work in Rstudio. In R itself,
| roxygen2 gives an error
|      Error: invalid version specification ?0.68?
| though the string '0.68' appears nowhere in my package according to grep.
| I have no idea what this is about, especially as Rstudio works fine.

An unrelated, documented, yet unfixed bug in 'cli' affecting packages using it.

You need to define (in .Renviron, or via bash for your login, or system wide)
the variable VTE_VERSION with any value, for example '1' will do.

E.g. I call roxygen on the shell via 'roxy.r' from littler and my command
history has a few

   VTE_VERSION=1 roxy.r

It also bit me in 'rhub' and other packages communicating via 'cli'.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From bbo|ker @end|ng |rom gm@||@com  Fri Sep  2 23:00:48 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Fri, 2 Sep 2022 17:00:48 -0400
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <25362.26810.80952.485910@rob.eddelbuettel.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
 <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
 <c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
 <25362.26810.80952.485910@rob.eddelbuettel.com>
Message-ID: <39bb06f2-a8ec-b277-91eb-85ffb501211f@gmail.com>



On 2022-09-02 4:34 p.m., Dirk Eddelbuettel wrote:
> 
> On 2 September 2022 at 16:22, J C Nash wrote:
> | And I believe I've got the roxygen2 tags to work in Rstudio. In R itself,
> | roxygen2 gives an error
> |      Error: invalid version specification ?0.68?
> | though the string '0.68' appears nowhere in my package according to grep.
> | I have no idea what this is about, especially as Rstudio works fine.
> 
> An unrelated, documented, yet unfixed bug in 'cli' affecting packages using it.
> 
> You need to define (in .Renviron, or via bash for your login, or system wide)
> the variable VTE_VERSION with any value, for example '1' will do.
> 
> E.g. I call roxygen on the shell via 'roxy.r' from littler and my command
> history has a few
> 
>     VTE_VERSION=1 roxy.r
> 
> It also bit me in 'rhub' and other packages communicating via 'cli'.
> 
> Dirk
> 

  Yes, this one is cryptic and frustrating.

https://github.com/r-lib/devtools/issues/2439#issuecomment-1174146075

   You can also solve the problem by installing the development version 
of cli from Github (the fix was made *one day* after the last CRAN 
release ...)


From j|ox @end|ng |rom mcm@@ter@c@  Fri Sep  2 23:12:46 2022
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Fri, 2 Sep 2022 17:12:46 -0400
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <22575_1662150172_282KMqsp023450_c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
 <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
 <22575_1662150172_282KMqsp023450_c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
Message-ID: <e11051cf-4a10-e4c3-c250-95dcf9226013@mcmaster.ca>

Dear John,

I've used an alternative solution in similar situations, equivalent to 
defining

	thefn <- function(...) myfn(...)

Then only ... needs to be documented as arguments passed down to myfn(). 
Maybe that would work for you too.

Best,
  John

On 2022-09-02 4:22 p.m., J C Nash wrote:
> With some playing around I found a workable solution.
> 
> - NAMESPACE needs? export(thefn)
> - thefn.Rd needs usage and arguments documented
> - myfn.Rd must NOT have alias(thefn)
> 
> And I believe I've got the roxygen2 tags to work in Rstudio. In R itself,
> roxygen2 gives an error
>  ??? Error: invalid version specification ?0.68?
> though the string '0.68' appears nowhere in my package according to grep.
> I have no idea what this is about, especially as Rstudio works fine.
> 
> While I like the idea of documentation in code files, I think I'll go
> back to separately created .Rd files.
> 
> If anyone is interested, package and README are at
> https://gitlab.com/nashjc/nlsr2022
> 
> Best,
> 
> John Nash
> 
> 
> On 2022-09-01 11:29, Hadley Wickham wrote:
>> On Thu, Sep 1, 2022 at 9:48 AM J C Nash <profjcnash at gmail.com> wrote:
>>>
>>> Hi,
>>>
>>> I've a package where it has been suggested that one of the functions 
>>> -- call
>>> it "myfn()" -- should be called something else, say "thefn()". Of 
>>> course, I'll
>>> need to keep the old name around for a while.
>>>
>>> Web search has suggested simple assignment of
>>>
>>> ????? thefn <- myfn
>>>
>>> but I cannot seem to get this to work with R CMD check when I put 
>>> this in a .R
>>> file in the code and put alias and usage stanzas in documentation. I 
>>> get alias
>>> and missing argument type errors. I've tried a number of variations 
>>> on this theme
>>> without appreciable success.
>>>
>>> A workaround is to copy the entire function with Roxygen2 
>>> documentation and
>>> name change, but this seems inelegant.
>>
>> You'll also need to add a couple of roxygen tags:
>>
>> #' @export
>> #' @rdname myfn
>> thefn <- myfn
>>
>> Hadley
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/


From h@w|ckh@m @end|ng |rom gm@||@com  Fri Sep  2 23:46:52 2022
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Fri, 2 Sep 2022 16:46:52 -0500
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
 <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
 <c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
Message-ID: <CABdHhvF71poYw01nNhn7yye6Mh1+NacCYXM6Kc+39HsTeKnAug@mail.gmail.com>

On Fri, Sep 2, 2022 at 3:22 PM J C Nash <profjcnash at gmail.com> wrote:
>
> With some playing around I found a workable solution.
>
> - NAMESPACE needs  export(thefn)
> - thefn.Rd needs usage and arguments documented
> - myfn.Rd must NOT have alias(thefn)
>
> And I believe I've got the roxygen2 tags to work in Rstudio. In R itself,
> roxygen2 gives an error
>      Error: invalid version specification ?0.68?
> though the string '0.68' appears nowhere in my package according to grep.
> I have no idea what this is about, especially as Rstudio works fine.
>
> While I like the idea of documentation in code files, I think I'll go
> back to separately created .Rd files.
>
> If anyone is interested, package and README are at
> https://gitlab.com/nashjc/nlsr2022

All you need is:

#' @export
#' @rdname wrapnlsr
nlsr <- wrapnlsr

That will document nlsr and nlsr together in the same file.

In general, if you find yourself having to use `@usage` or `@aliases`
to get R CMD check to pass cleanly, something is off with the way
you're documenting your functions.

Hadley

-- 
http://hadley.nz


From pro|jcn@@h @end|ng |rom gm@||@com  Sat Sep  3 15:22:55 2022
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sat, 3 Sep 2022 09:22:55 -0400
Subject: [R-pkg-devel] Advice on elegant way to alias function name
In-Reply-To: <CABdHhvF71poYw01nNhn7yye6Mh1+NacCYXM6Kc+39HsTeKnAug@mail.gmail.com>
References: <1525c052-890f-b5eb-2079-1688097e2a02@gmail.com>
 <CABdHhvFKNMmDiXL1AU9jw0TO6zbAHQHy3C8eDM1NHkFXayQS2Q@mail.gmail.com>
 <c09a245a-5e61-3752-dd5d-68d9d5218dff@gmail.com>
 <CABdHhvF71poYw01nNhn7yye6Mh1+NacCYXM6Kc+39HsTeKnAug@mail.gmail.com>
Message-ID: <acc92182-de2c-7f79-5d4d-08341b1fe74d@gmail.com>

Hadley is correct. I had a typo in one of the tags.

And the @usage tag is not needed.

Thanks to all.

JN


On 2022-09-02 17:46, Hadley Wickham wrote:
> On Fri, Sep 2, 2022 at 3:22 PM J C Nash <profjcnash at gmail.com> wrote:
>>
>> With some playing around I found a workable solution.
>>
>> - NAMESPACE needs  export(thefn)
>> - thefn.Rd needs usage and arguments documented
>> - myfn.Rd must NOT have alias(thefn)
>>
>> And I believe I've got the roxygen2 tags to work in Rstudio. In R itself,
>> roxygen2 gives an error
>>       Error: invalid version specification ?0.68?
>> though the string '0.68' appears nowhere in my package according to grep.
>> I have no idea what this is about, especially as Rstudio works fine.
>>
>> While I like the idea of documentation in code files, I think I'll go
>> back to separately created .Rd files.
>>
>> If anyone is interested, package and README are at
>> https://gitlab.com/nashjc/nlsr2022
> 
> All you need is:
> 
> #' @export
> #' @rdname wrapnlsr
> nlsr <- wrapnlsr
> 
> That will document nlsr and nlsr together in the same file.
> 
> In general, if you find yourself having to use `@usage` or `@aliases`
> to get R CMD check to pass cleanly, something is off with the way
> you're documenting your functions.
> 
> Hadley
>


From bbo|ker @end|ng |rom gm@||@com  Sat Sep  3 22:09:42 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sat, 3 Sep 2022 16:09:42 -0400
Subject: [R-pkg-devel] LaTeX packages available for documentation?
Message-ID: <f501bf8b-2c29-2ca7-d655-81fbd47c4aaf@gmail.com>


     I'm trying to figure out if the list of LaTeX packages that can be 
expected to be available *when building PDF versions of man pages* is 
documented/available somewhere.

  One of my co-authors is a bit enthusiastic about complex math 
expressions in the man pages, e.g. using \dfrac (from the amsmath 
package) and \mathscr (from the mathrsfs package). These are OK in HTML 
version of the docs (now that LaTeX is allowed), but throw an error when 
building the PDF manuals.

   I think this will probably turn out to be a case of "'doctor, it 
hurts when I do this.' 'Well, then, don't do that.'" (i.e., remove fancy 
LaTeX markup from man pages), but I'm curious.

   cheers
    Ben Bolker

PS


   I've looked at these sections of the documentation:

https://cran.r-project.org/doc/manuals/R-exts.html#Writing-portable-packages
https://cran.r-project.org/doc/manuals/R-exts.html#Checking-packages
https://cran.r-project.org/doc/manuals/R-admin.html#Making-the-manuals

   and have searched for packages in the R sources:

$ find . -type f -exec grep "^.usepackage" {} \; | sort | uniq
\usepackage{a4wide}
\usepackage{amsmath}
\usepackage[authoryear,round]{natbib}
\usepackage{color}
\usepackage{fullpage}
\usepackage{fullpage}% save trees ;-)
\usepackage{graphicx, Rd}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{myVignette}
\usepackage[pdftex]{graphicx}
\usepackage{Rd}
\usepackage{Rd, parskip, amsmath, enumerate}
\usepackage[round]{natbib}
\usepackage{Sweave}


   weirdly, amsmath is included here, but it's only used in vignettes -- 
seems puzzling but plausible that package availability would be 
different for building vignettes vs. man pages ... ??


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Sep  3 22:41:27 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 3 Sep 2022 16:41:27 -0400
Subject: [R-pkg-devel] LaTeX packages available for documentation?
In-Reply-To: <f501bf8b-2c29-2ca7-d655-81fbd47c4aaf@gmail.com>
References: <f501bf8b-2c29-2ca7-d655-81fbd47c4aaf@gmail.com>
Message-ID: <3eb031c7-acce-7831-b75d-68e0c3092ad3@gmail.com>

I don't know if the LaTeX packages are fully documented, but there is 
some info in the R Admin manual in section 2.4 "Installation".  That 
might just apply to R, not contributed packages.

One way to figure it out is to ask R to convert an Rd file to pdf, and 
save the .tex file.  When I do that, I see that it uses or requires the 
following packages:

   Rd
   makeidx
   inputenc
   graphicx (maybe?  commented out in the example I ran)

and Rd.sty requires these (some conditionally), as seen in R sources 
share/texmf/tex/latex/Rd.sty:

   ifthen
   longtable
   hyperref
   bm
   alltt
   verbatim
   url
   textcomp
   iftex
   fontenc
   times
   lmodern
   beramono
   zi4
   inconsolata

Since these are gleaned from the source, they are likely subject to change.



On 03/09/2022 4:09 p.m., Ben Bolker wrote:
> 
>       I'm trying to figure out if the list of LaTeX packages that can be
> expected to be available *when building PDF versions of man pages* is
> documented/available somewhere.
> 
>    One of my co-authors is a bit enthusiastic about complex math
> expressions in the man pages, e.g. using \dfrac (from the amsmath
> package) and \mathscr (from the mathrsfs package). These are OK in HTML
> version of the docs (now that LaTeX is allowed), but throw an error when
> building the PDF manuals.
> 
>     I think this will probably turn out to be a case of "'doctor, it
> hurts when I do this.' 'Well, then, don't do that.'" (i.e., remove fancy
> LaTeX markup from man pages), but I'm curious.
> 
>     cheers
>      Ben Bolker
> 
> PS
> 
> 
>     I've looked at these sections of the documentation:
> 
> https://cran.r-project.org/doc/manuals/R-exts.html#Writing-portable-packages
> https://cran.r-project.org/doc/manuals/R-exts.html#Checking-packages
> https://cran.r-project.org/doc/manuals/R-admin.html#Making-the-manuals
> 
>     and have searched for packages in the R sources:
> 
> $ find . -type f -exec grep "^.usepackage" {} \; | sort | uniq
> \usepackage{a4wide}
> \usepackage{amsmath}
> \usepackage[authoryear,round]{natbib}
> \usepackage{color}
> \usepackage{fullpage}
> \usepackage{fullpage}% save trees ;-)
> \usepackage{graphicx, Rd}
> \usepackage{hyperref}
> \usepackage{listings}
> \usepackage{myVignette}
> \usepackage[pdftex]{graphicx}
> \usepackage{Rd}
> \usepackage{Rd, parskip, amsmath, enumerate}
> \usepackage[round]{natbib}
> \usepackage{Sweave}
> 
> 
>     weirdly, amsmath is included here, but it's only used in vignettes --
> seems puzzling but plausible that package availability would be
> different for building vignettes vs. man pages ... ??
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Sat Sep  3 22:45:07 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sat, 3 Sep 2022 16:45:07 -0400
Subject: [R-pkg-devel] LaTeX packages available for documentation?
In-Reply-To: <3eb031c7-acce-7831-b75d-68e0c3092ad3@gmail.com>
References: <f501bf8b-2c29-2ca7-d655-81fbd47c4aaf@gmail.com>
 <3eb031c7-acce-7831-b75d-68e0c3092ad3@gmail.com>
Message-ID: <ebe63758-a610-fcbe-6fed-9fa6183450e8@gmail.com>

   Thanks.  Feels like a request for including amsmath in Rd.sty might 
not be out of order (since presumably most TeX installations will have 
it if they have all of that other stuff, and since it might be a 
one-line change to the R source code ...)

On 2022-09-03 4:41 p.m., Duncan Murdoch wrote:
> I don't know if the LaTeX packages are fully documented, but there is 
> some info in the R Admin manual in section 2.4 "Installation".? That 
> might just apply to R, not contributed packages.
> 
> One way to figure it out is to ask R to convert an Rd file to pdf, and 
> save the .tex file.? When I do that, I see that it uses or requires the 
> following packages:
> 
>  ? Rd
>  ? makeidx
>  ? inputenc
>  ? graphicx (maybe?? commented out in the example I ran)
> 
> and Rd.sty requires these (some conditionally), as seen in R sources 
> share/texmf/tex/latex/Rd.sty:
> 
>  ? ifthen
>  ? longtable
>  ? hyperref
>  ? bm
>  ? alltt
>  ? verbatim
>  ? url
>  ? textcomp
>  ? iftex
>  ? fontenc
>  ? times
>  ? lmodern
>  ? beramono
>  ? zi4
>  ? inconsolata
> 
> Since these are gleaned from the source, they are likely subject to change.
> 
> 
> 
> On 03/09/2022 4:09 p.m., Ben Bolker wrote:
>>
>> ????? I'm trying to figure out if the list of LaTeX packages that can be
>> expected to be available *when building PDF versions of man pages* is
>> documented/available somewhere.
>>
>> ?? One of my co-authors is a bit enthusiastic about complex math
>> expressions in the man pages, e.g. using \dfrac (from the amsmath
>> package) and \mathscr (from the mathrsfs package). These are OK in HTML
>> version of the docs (now that LaTeX is allowed), but throw an error when
>> building the PDF manuals.
>>
>> ??? I think this will probably turn out to be a case of "'doctor, it
>> hurts when I do this.' 'Well, then, don't do that.'" (i.e., remove fancy
>> LaTeX markup from man pages), but I'm curious.
>>
>> ??? cheers
>> ???? Ben Bolker
>>
>> PS
>>
>>
>> ??? I've looked at these sections of the documentation:
>>
>> https://cran.r-project.org/doc/manuals/R-exts.html#Writing-portable-packages 
>>
>> https://cran.r-project.org/doc/manuals/R-exts.html#Checking-packages
>> https://cran.r-project.org/doc/manuals/R-admin.html#Making-the-manuals
>>
>> ??? and have searched for packages in the R sources:
>>
>> $ find . -type f -exec grep "^.usepackage" {} \; | sort | uniq
>> \usepackage{a4wide}
>> \usepackage{amsmath}
>> \usepackage[authoryear,round]{natbib}
>> \usepackage{color}
>> \usepackage{fullpage}
>> \usepackage{fullpage}% save trees ;-)
>> \usepackage{graphicx, Rd}
>> \usepackage{hyperref}
>> \usepackage{listings}
>> \usepackage{myVignette}
>> \usepackage[pdftex]{graphicx}
>> \usepackage{Rd}
>> \usepackage{Rd, parskip, amsmath, enumerate}
>> \usepackage[round]{natbib}
>> \usepackage{Sweave}
>>
>>
>> ??? weirdly, amsmath is included here, but it's only used in vignettes --
>> seems puzzling but plausible that package availability would be
>> different for building vignettes vs. man pages ... ??
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Sep  3 23:41:58 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 3 Sep 2022 17:41:58 -0400
Subject: [R-pkg-devel] LaTeX packages available for documentation?
In-Reply-To: <ebe63758-a610-fcbe-6fed-9fa6183450e8@gmail.com>
References: <f501bf8b-2c29-2ca7-d655-81fbd47c4aaf@gmail.com>
 <3eb031c7-acce-7831-b75d-68e0c3092ad3@gmail.com>
 <ebe63758-a610-fcbe-6fed-9fa6183450e8@gmail.com>
Message-ID: <3982208f-0b97-70c1-4cd2-b71cf2125035@gmail.com>

On 03/09/2022 4:45 p.m., Ben Bolker wrote:
>     Thanks.  Feels like a request for including amsmath in Rd.sty might
> not be out of order (since presumably most TeX installations will have
> it if they have all of that other stuff, and since it might be a
> one-line change to the R source code ...)

Yes, I agree.

Duncan Murdoch


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Sep  5 09:33:06 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 5 Sep 2022 09:33:06 +0200
Subject: [R-pkg-devel] LaTeX packages available for documentation?
In-Reply-To: <3982208f-0b97-70c1-4cd2-b71cf2125035@gmail.com>
References: <f501bf8b-2c29-2ca7-d655-81fbd47c4aaf@gmail.com>
 <3eb031c7-acce-7831-b75d-68e0c3092ad3@gmail.com>
 <ebe63758-a610-fcbe-6fed-9fa6183450e8@gmail.com>
 <3982208f-0b97-70c1-4cd2-b71cf2125035@gmail.com>
Message-ID: <1c949dc6-4d60-8555-f219-1db96dedbc55@statistik.tu-dortmund.de>



On 03.09.2022 23:41, Duncan Murdoch wrote:
> On 03/09/2022 4:45 p.m., Ben Bolker wrote:
>> ??? Thanks.? Feels like a request for including amsmath in Rd.sty might
>> not be out of order (since presumably most TeX installations will have
>> it if they have all of that other stuff, and since it might be a
>> one-line change to the R source code ...)

This is under discussion for some time now.  Although, there are some 
issues that adding amsmath witll break some packages and also requires 
minor changes in R. This will likely make it to R-devel shortly, perhaps 
also R-patched.

Best,
Uwe Ligges



> Yes, I agree.
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From F|or|@nSchwend|nger @end|ng |rom gmx@@t  Mon Sep  5 16:27:21 2022
From: F|or|@nSchwend|nger @end|ng |rom gmx@@t (Florian Schwendinger)
Date: Mon, 5 Sep 2022 16:27:21 +0200
Subject: [R-pkg-devel] MacOS CMAKE_OSX_ARCHITECTURES
Message-ID: <trinity-c2cfc433-198e-4cb1-844b-dfc84451045b-1662388041696@3c-app-gmx-bap60>

Dear package developers,

I currently try to debug a few issues which occur on MacOS
r-release-macos-arm64 and r-oldrel-macos-arm64.

To the setting I wrote an interface to mixed integer linear optimization
solver highs. Thereby I use the configure script + a bash file called
from configure to build a static library to which I link afterwards.

For MacOS M1 this was a little bit tricky since I needed to add the
CMAKE_OSX_ARCHITECTURES flag to get it to work (I have no direct access to MacOS M1).
What I currently doing for MacOS-M1 is
${CMAKE_EXE} \
-DCMAKE_INSTALL_PREFIX=${R_HIGHS_LIB_DIR} \
-DCMAKE_OSX_ARCHITECTURES="x86_64;arm64" ..

As far as I understand from the cmake release page
https://cmake.org/cmake/help/latest/release/3.19.html#id13
which states
"The precompiled macOS binary provided on cmake.org is now a universal
binary with x86_64 and arm64 architectures."
for this to work I need at least cmake version "3.19.2"?
Is this correct?
Is there a better way / another option?


I used for MacOS-M1 the minimum cmake version "3.20" since
this is the version I could test with a testing service.
Now seeing the error messages on
"r-release-macos-arm64" and "r-oldrel-macos-arm64"
I see these two setups use cmake "3.19.4" which means
I should have stuck to "3.19.2" if my assumption above is
correct. Is it possible to see beforehand what the highest
possible cmake version for CRAN is?

Best regards,
Florian
?
?


From @|mon@urb@nek @end|ng |rom R-project@org  Tue Sep  6 00:46:41 2022
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Tue, 6 Sep 2022 10:46:41 +1200
Subject: [R-pkg-devel] MacOS CMAKE_OSX_ARCHITECTURES
In-Reply-To: <trinity-c2cfc433-198e-4cb1-844b-dfc84451045b-1662388041696@3c-app-gmx-bap60>
References: <trinity-c2cfc433-198e-4cb1-844b-dfc84451045b-1662388041696@3c-app-gmx-bap60>
Message-ID: <7E969D73-AE82-4D30-8F34-1CC4C2CCA1A4@R-project.org>

Florian,

I think the CMake version is the least of your problems (that one would be trivial to address and I don't think it's needed at all). You cannot really assume that building multi-arch binaries is supported (most compilers don't support it) nor that it will work with R, so you cannot hard-code DCMAKE_OSX_ARCHITECTURES. If you are building a package, you have to use the compilers and flags from R - and they will differ a lot between architectures. Note that you have similar problem on other systems, not just macOS, there is no need to treat macOS differently in that respect.

I don't understand why you have four different CMakeLists - you only need one, the point of cmake is that it will correctly detect dependencies regardless of the OS and arch. However, you have to make sure you pass compiler flags from R so you have the right compilers and flags for the system and architecture that is being built. Once you do that, stock CMakeList typically work just fine.

I had a quick look and this worked for me (not using any of your patches):

## set R flags and compilers
export CC=`R CMD config CC`
export CXX=`R CMD config CXX`
export CXXFLAGS=`R CMD config CXXFLAGS`
export CFLAGS=`R CMD config CFLAGS`
export CPPFLAGS=`R CMD config CPPFLAGS`
export LDFLAGS=`R CMD config LDFLAGS`

${CMAKE_EXE} .. -DCMAKE_POSITION_INDEPENDENT_CODE:bool=ON -DSHARED:bool=OFF -DBUILD_TESTING:bool=OFF

(Maybe you need CXX11 instead of CXX above since CMakeList seems to suggest that it requires C++11)

Cheers,
Simon



> On Sep 6, 2022, at 2:27 AM, Florian Schwendinger <FlorianSchwendinger at gmx.at> wrote:
> 
> Dear package developers,
> 
> I currently try to debug a few issues which occur on MacOS
> r-release-macos-arm64 and r-oldrel-macos-arm64.
> 
> To the setting I wrote an interface to mixed integer linear optimization
> solver highs. Thereby I use the configure script + a bash file called
> from configure to build a static library to which I link afterwards.
> 
> For MacOS M1 this was a little bit tricky since I needed to add the
> CMAKE_OSX_ARCHITECTURES flag to get it to work (I have no direct access to MacOS M1).
> What I currently doing for MacOS-M1 is
> ${CMAKE_EXE} \
> -DCMAKE_INSTALL_PREFIX=${R_HIGHS_LIB_DIR} \
> -DCMAKE_OSX_ARCHITECTURES="x86_64;arm64" ..
> 
> As far as I understand from the cmake release page
> https://cmake.org/cmake/help/latest/release/3.19.html#id13
> which states
> "The precompiled macOS binary provided on cmake.org is now a universal
> binary with x86_64 and arm64 architectures."
> for this to work I need at least cmake version "3.19.2"?
> Is this correct?
> Is there a better way / another option?
> 
> 
> I used for MacOS-M1 the minimum cmake version "3.20" since
> this is the version I could test with a testing service.
> Now seeing the error messages on
> "r-release-macos-arm64" and "r-oldrel-macos-arm64"
> I see these two setups use cmake "3.19.4" which means
> I should have stuck to "3.19.2" if my assumption above is
> correct. Is it possible to see beforehand what the highest
> possible cmake version for CRAN is?
> 
> Best regards,
> Florian
>  
>  
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From j|r|@c@mor@vec @end|ng |rom gm@||@com  Tue Sep  6 04:48:02 2022
From: j|r|@c@mor@vec @end|ng |rom gm@||@com (=?UTF-8?B?SmnFmcOtIE1vcmF2ZWM=?=)
Date: Tue, 6 Sep 2022 14:48:02 +1200
Subject: [R-pkg-devel] Error checking in an independent C code and printing
 (perror, printf, etc.)
Message-ID: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>

Hello,

this is my first time writing C code that interacts with R.
To make my C code more modular, reusable, and easier to test with 
unittests, I split my code into:

a) code that does stuff
b) code that interfaces between a) and R.

Only the b) imports the R headers, a) is completely independent of R 
(and potentially shared between different projects).

That brings me to a problem: How to do error handling in C without the 
use of various C-specific print functions R-specific print functions?

The C-specific print functions raise a CRAN note:

Compiled code should not call entry points which might terminate R nor
write to stdout/stderr instead of to the console, nor use Fortran I/O
nor system RNGs

But R(C) print functions cannot be used without importing particular 
header,
which would induce otherwise another dependency, and tie it closely with R.

This is my first time writing into mailing list, hopefully I am doing 
everything ok.

Thanks everyone!

-- Jirka


From @teve@the@b@ye@|@n @end|ng |rom gm@||@com  Tue Sep  6 18:27:08 2022
From: @teve@the@b@ye@|@n @end|ng |rom gm@||@com (Steven Scott)
Date: Tue, 6 Sep 2022 09:27:08 -0700
Subject: [R-pkg-devel] 
 Error checking in an independent C code and printing
 (perror, printf, etc.)
In-Reply-To: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
References: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
Message-ID: <CAJqTW45totVngu19fFxZC_P2vAqmg6K47DhvHsGij-nmxKpsoQ@mail.gmail.com>

All software engineering problems are solved by an additional layer of
indirection!  ;-)

Introduce a function called "process_error".  Include one implementation
for your standalone C library.  Include another R-specific one when using
your C library as part of an R package.

On Tue, Sep 6, 2022 at 9:23 AM Ji?? Moravec <jiri.c.moravec at gmail.com>
wrote:

> Hello,
>
> this is my first time writing C code that interacts with R.
> To make my C code more modular, reusable, and easier to test with
> unittests, I split my code into:
>
> a) code that does stuff
> b) code that interfaces between a) and R.
>
> Only the b) imports the R headers, a) is completely independent of R
> (and potentially shared between different projects).
>
> That brings me to a problem: How to do error handling in C without the
> use of various C-specific print functions R-specific print functions?
>
> The C-specific print functions raise a CRAN note:
>
> Compiled code should not call entry points which might terminate R nor
> write to stdout/stderr instead of to the console, nor use Fortran I/O
> nor system RNGs
>
> But R(C) print functions cannot be used without importing particular
> header,
> which would induce otherwise another dependency, and tie it closely with R.
>
> This is my first time writing into mailing list, hopefully I am doing
> everything ok.
>
> Thanks everyone!
>
> -- Jirka
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Sep  6 18:28:59 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 6 Sep 2022 12:28:59 -0400
Subject: [R-pkg-devel] 
 Error checking in an independent C code and printing
 (perror, printf, etc.)
In-Reply-To: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
References: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
Message-ID: <70d6e94c-e016-79e8-e02a-ca9bf8fb97a8@gmail.com>

On 05/09/2022 10:48 p.m., Ji?? Moravec wrote:
> Hello,
> 
> this is my first time writing C code that interacts with R.
> To make my C code more modular, reusable, and easier to test with
> unittests, I split my code into:
> 
> a) code that does stuff
> b) code that interfaces between a) and R.
> 
> Only the b) imports the R headers, a) is completely independent of R
> (and potentially shared between different projects).
> 
> That brings me to a problem: How to do error handling in C without the
> use of various C-specific print functions R-specific print functions?
> 
> The C-specific print functions raise a CRAN note:
> 
> Compiled code should not call entry points which might terminate R nor
> write to stdout/stderr instead of to the console, nor use Fortran I/O
> nor system RNGs
> 
> But R(C) print functions cannot be used without importing particular
> header,
> which would induce otherwise another dependency, and tie it closely with R.

I think the best way is to think of error reporting as part of the 
interface.  Your code that does stuff shouldn't try to print anything, 
it should just return special error code values to indicate problems. 
The code in b) looks for those error codes and creates R messages or 
errors.  If you use the a) code in a different project, it would do the 
same, but report the errors in whatever way is natural in that context.

> 
> This is my first time writing into mailing list, hopefully I am doing
> everything ok.

Looks fine to me!

Duncan Murdoch


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Sep  6 18:52:55 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 6 Sep 2022 18:52:55 +0200
Subject: [R-pkg-devel] 
 Error checking in an independent C code and printing
 (perror, printf, etc.)
In-Reply-To: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
References: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
Message-ID: <20220906185255.703ccf20@parabola>

Hello Ji?? and welcome to the mailing list!

On Tue, 6 Sep 2022 14:48:02 +1200
"Ji?? Moravec" <jiri.c.moravec at gmail.com> wrote:

> That brings me to a problem: How to do error handling in C without
> the use of various <...> R-specific print functions?

(Assuming that's what you meant...)

One way would be to introduce callbacks from the R-independent part to
the R-interfacing part, but I can imagine this to require tedious
boilerplate. Also, many of R's entry points can raise an error
condition (e.g. if an allocation fails), which would result in a
longjmp() away from your code. Any resource not known to R's garbage
collector is going to be leaked in this situation.

I think you're actually allowed to format strings using sprintf and
friends; only actual printing to stdout/stderr is disallowed because
the user may be using e.g. Rgui on Windows and not see it at all. If
you need to print error messages, you can pass them to the R side as
strings, probably in storage allocated by the caller to avoid leaks on
errors. Error codes are of course an option too, but can be less
informative if not accompanied by an explanation of what went wrong.

(It's considered polite for package code to use R's message system not
only because of the stdout/Rgui problem mentioned above, but also
because it gives the user an option to run your code with
suppressMessages() and disable the verbose output. When the R code
directly calls cat() or the C code prints directly to console, that
option disappears.)

To summarise, R would accept any option where only R is interacting
with the user (or doing other I/O). If neither of this is satisfying,
can you provide a bit more details on the kind of error handling you're
looking for?
 
> This is my first time writing into mailing list, hopefully I am doing 
> everything ok.

Indeed you are!

-- 
Best regards,
Ivan


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Sep  7 11:58:33 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 7 Sep 2022 11:58:33 +0200
Subject: [R-pkg-devel] 
 Error checking in an independent C code and printing
 (perror, printf, etc.)
In-Reply-To: <7f7c1c96-23a8-8e23-3345-25a09bc9a485@gmail.com>
References: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
 <20220906185255.703ccf20@parabola>
 <7f7c1c96-23a8-8e23-3345-25a09bc9a485@gmail.com>
Message-ID: <20220907115833.6c2326cb@parabola>

On Wed, 7 Sep 2022 18:32:46 +1200
"Ji?? Moravec" <jiri.c.moravec at gmail.com> wrote:

> I was hoping that you will tell me that R takes control of the C's 
> stderr and stdout.
> That would make stuff easier. But I guess that is not really possible.

While there is fopencookie() in GNU libc, on other POSIX-compatible
platforms the only relatively portable option is to replace file
descriptors 0,1,2 with pipes and read those pipes from a thread. And on
Windows there can be multiple C runtime libraries running in the same
process, which makes taking over stdout/stderr extra hard.

> First time using the dreadful "goto", looks like it makes sense to
> free resources.

"goto cleanup" is a fine pattern in a language like C which lacks
both destructors and deferred execution.

> It still looks a bit ugly compared to simple "throw" (i.e., too much 
> code noise),
> and I now understand where the Java's checked exceptions are coming
> from. And somehow, now that I am thinking about it, I am getting used
> to it.

But if you'd like to "throw" from compiled code in an R package, the
Rcpp package can help you with that: it forms a layer between R and
your code that would catch the exception (letting the stack unwinding
process run the destructors to prevent the leaks) and convert it into
an R error condition. Common R types are also wrapped in C++ classes
with convenient STL-like accessors.

> I hope I am responding correctly ("respond all") and not spamming
> people.

Cc'ing the list is the right idea. On some lists it's considered
wrong to send replies anywhere but to the list, but reply-all
including the senders themselves seems to work fine here.

> Particularly, when to use PROTECT() is not clear (new SEXP objects,
> but not required if they are just interfaced with INTEGER(), REAL()
> or VECTOR_ELT).

If you can prove there won't be any allocations (including those done
by R for its own purposes when you call some API function) between the
creation of the new SEXP and the return from the function, you can omit
the PROTECT() call. A simpler and perhaps safer rule is to always
PROTECT() the allocations. I don't think it will cost you much in
performance, though it's possible I'm mistaken.

> The overview: 
> https://stat.ethz.ch/pipermail/r-devel/attachments/20120323/a13f948a/attachment.pdf
> was also really helpful and should be IMHO part of official
> documentation.

"Writing R Extensions" could use some improvements, that's true. For
example, "serialise a SEXP to my C callback" is a very useful function
which I think should be a part of public R API, but it's not mentioned
there at all. On the other hand, my package that uses the
R_InitOutPStream and R_Serialize entry points seems to have passed the
CRAN review. A table of all public entry points including short
descriptions and whether they allocate could be very useful.
Unfortunately, if an outsider like me were to write it, some core
member would still have to spend time reviewing it.

> An example how to work with named list (e.g., an S3 class), where 
> subsetting is done by name and not by position,
> would be really useful.

Hmm. For attributes and S4 slots, there's {GET,SET}_ATTR and
{GET,SET}_SLOT, but I don't see such a quick shortcut for
subsetting by name. Based on searching the R source, I think you could
use SEXP index = PROTECT(match(GET_NAMES(list), mkChar("name"), 0)); to
obtain an INTSXP vector of indices matching the names, 1-based (or 0 if
there was no match).

Rcpp offers a very convenient operator[](const std::string & name) that
does a similar thing: it obtains the names of the object, then compares
each of them to the name being looked up.

-- 
Best regards,
Ivan


From edd @end|ng |rom deb|@n@org  Wed Sep  7 16:03:16 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 7 Sep 2022 09:03:16 -0500
Subject: [R-pkg-devel] 
 Error checking in an independent C code and printing
 (perror, printf, etc.)
In-Reply-To: <20220907115833.6c2326cb@parabola>
References: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
 <20220906185255.703ccf20@parabola>
 <7f7c1c96-23a8-8e23-3345-25a09bc9a485@gmail.com>
 <20220907115833.6c2326cb@parabola>
Message-ID: <25368.42148.690124.702866@rob.eddelbuettel.com>


On 7 September 2022 at 11:58, Ivan Krylov wrote:
| there at all. On the other hand, my package that uses the
| R_InitOutPStream and R_Serialize entry points seems to have passed the
| CRAN review. A table of all public entry points including short
| descriptions and whether they allocate could be very useful.

And there is RApiSerialize:  https://cran.r-project.org/package=RApiSerialize

It takes R Core code and provides it in a package. That allows R Core to one
day change the non-exported API (so far it hasn't happened in the eight years
since the 0.1.0 release) yet lets packages use serialization: RcppRedis and
the excellent qs package make use of it.

Tip of the hat to the Rhpc package for the idea.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Sep  9 11:13:16 2022
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 9 Sep 2022 11:13:16 +0200
Subject: [R-pkg-devel] 
 Error checking in an independent C code and printing
 (perror, printf, etc.)
In-Reply-To: <25368.42148.690124.702866@rob.eddelbuettel.com>
References: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
 <20220906185255.703ccf20@parabola>
 <7f7c1c96-23a8-8e23-3345-25a09bc9a485@gmail.com>
 <20220907115833.6c2326cb@parabola>
 <25368.42148.690124.702866@rob.eddelbuettel.com>
Message-ID: <20220909111316.749a5331@parabola>

On Wed, 7 Sep 2022 09:03:16 -0500
Dirk Eddelbuettel <edd at debian.org> wrote:

> And there is RApiSerialize:
> https://cran.r-project.org/package=RApiSerialize
> 
> It takes R Core code and provides it in a package. That allows R Core
> to one day change the non-exported API (so far it hasn't happened in
> the eight years since the 0.1.0 release) yet lets packages use
> serialization: RcppRedis and the excellent qs package make use of it.

Thanks for the link! Since I only need a hash of the serialised data,
not the data itself, the callback interface is perfect for me, but I do
realise that I'm relying on something that isn't promised to keep being
there. I'll definitely keep RApiSerialize in mind.

-- 
Best regards,
Ivan


From j@|ro@h|d@|go@m|gue|e@ @end|ng |rom gm@||@com  Fri Sep  9 17:23:58 2022
From: j@|ro@h|d@|go@m|gue|e@ @end|ng |rom gm@||@com (Jairo Hidalgo Migueles)
Date: Fri, 9 Sep 2022 17:23:58 +0200
Subject: [R-pkg-devel] help using \Sexpr in .Rd documentaiton file results
 in error in windows
Message-ID: <CAJyC-m7pBvDz2xxiRyaWkfv3T7Ebuwu6m2StJ_dsX9B-A52A5Q@mail.gmail.com>

Dear list,

I tried to write a dynamic help file following the Writing R Extensions
manual (section 2.12, "Dynamic pages"). When using the \Sexpr macro, the
package does not longer pass the R CMD CHECK. I get the following error:

?? R CMD build ?????????????????????????????
?  checking for file 'C:\R\pkgs\GGIR/DESCRIPTION' ...
?  preparing 'GGIR': (8.5s)
?  checking DESCRIPTION meta-information ...
?  cleaning src
?  installing the package to process help pages (427ms)
?  building the PDF package manual (13.9s)
   Warning in system2(..., stdout = FALSE, stderr = FALSE) :
     '"makeindex"' not found
   Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,
 :
     unable to run 'makeindex' on 'Rd2.idx'
   Warning in system2(..., stdout = FALSE, stderr = FALSE) :
     '"makeindex"' not found
   Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,
 :
     unable to run 'makeindex' on 'Rd2.idx'
   Error in running tools::texi2pdf()
Error in proc$get_built_file() : Build process failed

It seems there is something wrong when building the package manual, but
after some attempts, I have not been able to fix this. Any advice is
welcome.

Here an example of the \Sexpr usage in the .Rd file, consider "argument"
the name of a parameter to function "fn" in package "pkg":

\usage{
fn(argument= \Sexpr{format(formals(pkg::fn)[[" argument "]])})
}

Best,
Jairo

	[[alternative HTML version deleted]]


From rhe|p @end|ng |rom krueger-|@m||y@de  Fri Sep  9 12:27:20 2022
From: rhe|p @end|ng |rom krueger-|@m||y@de (Knut Krueger)
Date: Fri, 9 Sep 2022 12:27:20 +0200
Subject: [R-pkg-devel] Package DOI format - created with Roxygen
Message-ID: <12df3d5f-7bf8-80a8-9e35-30c3ec647162-3077@krueger-family.de>


Hi to all,


The error message from Cran:

The DOIs are? available.
What is wrong with the format of the references? They are unchanged for 
a long time? version but now there are errors at this submission:
-------------------------------------

New submission

Package was archived on CRAN

Possibly misspelled words in DESCRIPTION:
    ADI (6:37, 8:9)
    FDI (6:71, 8:13)
    Hemelrijk (8:17)
    Musicnotition (8:131)
    Vries (8:78)
    al (8:30, 8:87)
    de (8:75)
    et (8:27, 8:84)

Found the following (possibly) invalid DOIs:
    DOI: 10.1163/156853905774405290
      From: DESCRIPTION
      Status: Forbidden
      Message: 403
    DOI: 10.1163/156853909X412241
      From: DESCRIPTION
      Status: Forbidden
      Message: 403

-----------------------------------------------------------



#' @return returns a list with\cr
#'ADI - the Average Dominance index\cr
#'Colors - the colors supported by vcolors sorted by ADI of the items\cr
#'ADI_count_matrix - the counts from which the ADI was calculated\cr
#' @author Knut Krueger, \email{Knut.Krueger at equine-science.de}
#' @references {
#' The Construction of Dominance Order: Comparing Performance of Five 
Methods Using an Individual-Based Model C. K. Hemelrijk, J. Wantia and 
L. Gygax, Behaviour Vol. 142, No. 8 (Aug., 2005), pp. 1037-1058
#' \doi{10.1163/156853905774405290}\cr
#'On using the DomWorld model to evaluate dominance ranking methods , de 
Vries, Han,? Behaviour, Volume 146, Number 6, 2009 , pp. 843-869(27)
#'\doi{10.1163/156853909X412241}
#' }


Kind regards Knut


From j|r|@c@mor@vec @end|ng |rom gm@||@com  Wed Sep  7 08:32:46 2022
From: j|r|@c@mor@vec @end|ng |rom gm@||@com (=?UTF-8?B?SmnFmcOtIE1vcmF2ZWM=?=)
Date: Wed, 7 Sep 2022 18:32:46 +1200
Subject: [R-pkg-devel] 
 Error checking in an independent C code and printing
 (perror, printf, etc.)
In-Reply-To: <20220906185255.703ccf20@parabola>
References: <9aee2ae4-bd5b-fe27-9964-0994bdcb0cb6@gmail.com>
 <20220906185255.703ccf20@parabola>
Message-ID: <7f7c1c96-23a8-8e23-3345-25a09bc9a485-4863@gmail.com>


I was hoping that you will tell me that R takes control of the C's 
stderr and stdout.
That would make stuff easier. But I guess that is not really possible.

I went the way suggested before and created an enum of error codes and a 
(static) const char* array of error messages.
When reading about error checking in C, that looked like the most 
wholesome way. First time using the dreadful "goto",
looks like it makes sense to free resources. 
(https://stackoverflow.com/a/59221452/4868692)

It still looks a bit ugly compared to simple "throw" (i.e., too much 
code noise),
and I now understand where the Java's checked exceptions are coming from.
And somehow, now that I am thinking about it, I am getting used to it.

Thanks again.
I hope I am responding correctly ("respond all") and not spamming people.

ps.: The .Call interface is easier than it seems, the R documentation is 
not very good and spread the information a bit too much over many pages.
Once I got my .Call(c_hello_world) (including all the linking, info 
about the C_ naming and speed, the 
`tools::package_native_routine_registration_skeleton` was nice),
it all went quite nicely from there. Particularly, when to use PROTECT() 
is not clear (new SEXP objects, but not required if they are just 
interfaced with INTEGER(), REAL()
or VECTOR_ELT).

The overview: 
https://stat.ethz.ch/pipermail/r-devel/attachments/20120323/a13f948a/attachment.pdf
was also really helpful and should be IMHO part of official documentation.

An example how to work with named list (e.g., an S3 class), where 
subsetting is done by name and not by position,
would be really useful.

-- Jirka


On 9/7/22 04:52, Ivan Krylov wrote:
> Hello Ji?? and welcome to the mailing list!
>
> On Tue, 6 Sep 2022 14:48:02 +1200
> "Ji?? Moravec" <jiri.c.moravec at gmail.com> wrote:
>
>> That brings me to a problem: How to do error handling in C without
>> the use of various <...> R-specific print functions?
> (Assuming that's what you meant...)
>
> One way would be to introduce callbacks from the R-independent part to
> the R-interfacing part, but I can imagine this to require tedious
> boilerplate. Also, many of R's entry points can raise an error
> condition (e.g. if an allocation fails), which would result in a
> longjmp() away from your code. Any resource not known to R's garbage
> collector is going to be leaked in this situation.
>
> I think you're actually allowed to format strings using sprintf and
> friends; only actual printing to stdout/stderr is disallowed because
> the user may be using e.g. Rgui on Windows and not see it at all. If
> you need to print error messages, you can pass them to the R side as
> strings, probably in storage allocated by the caller to avoid leaks on
> errors. Error codes are of course an option too, but can be less
> informative if not accompanied by an explanation of what went wrong.
>
> (It's considered polite for package code to use R's message system not
> only because of the stdout/Rgui problem mentioned above, but also
> because it gives the user an option to run your code with
> suppressMessages() and disable the verbose output. When the R code
> directly calls cat() or the C code prints directly to console, that
> option disappears.)
>
> To summarise, R would accept any option where only R is interacting
> with the user (or doing other I/O). If neither of this is satisfying,
> can you provide a bit more details on the kind of error handling you're
> looking for?
>   
>> This is my first time writing into mailing list, hopefully I am doing
>> everything ok.
> Indeed you are!
>


From m@tth|@@-gond@n @end|ng |rom gmx@de  Fri Sep  9 21:58:32 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (matthias-gondan)
Date: Fri, 09 Sep 2022 19:58:32 -0000
Subject: [R-pkg-devel] How to write a 'cases' environment in .Rd files?
In-Reply-To: <20220812091539.037d26da@trisector>
Message-ID: <1MNKhm-1o33f53oF8-00On1j-4951@mail.gmx.net>

I am currently developing an R package that translates R expressions to Html and Latex, things like dbinom(x, size, prob) to P\left(x; N, \pi\right)Generation of Rd files may be an interesting use case. It's still at an early stage, I appreciate contributions and interesting feature requests.github.com/mgondan/mathmlVon meinem/meiner Galaxy gesendet
-------- Urspr?ngliche Nachricht --------Von: Ivan Krylov <krylov.r00t at gmail.com> Datum: 12.08.22  08:16  (GMT+01:00) An: Marius Hofert <marius.hofert at uwaterloo.ca> Cc: r-package-devel at r-project.org Betreff: Re: [R-pkg-devel] How to write a 'cases' environment in .Rd files? On Thu, 11 Aug 2022 18:43:44 +0000Marius Hofert <marius.hofert at uwaterloo.ca> wrote:> Since recently, r-devel-linux-x86_64-debian-clang and> r-devel-linux-x86_64-debian-gcc trigger the note 'Undefined control> sequence: \cases in F(x) = \cases{...', possibly due to KaTeX> rendering help pages. I looked around quite a bit but couldn't find a> way to implement 'cases' environments. For example,> https://katex.org/docs/supported.html#environments mentions> \begin{cases} \end{cases}, so I tried> > \deqn{F(x) = \begin{cases}> 1,&\text{if}\ x > 0,\\> 0,&\text{if} x = 0.}}{...}> > but that triggers:> > ...> * checking PDF version of manual ... WARNING> LaTeX errors when creating PDF version.> This typically indicates Rd problems.> LaTeX errors found:> ! Misplaced alignment tab character &There is a possible workaround, but it's the opposite of beautiful. Youcan use conditional text to compile one version of the formula for HTMLhelp and another one for PDF help:\ifelse{html}{\eqn{\begin{cases}...}}{\eqn{\cases{...}}{ascii}}It's as tedious as it looks. For extra style(?) points, you can put athree-argument user-defined macro in man/macros/whatever.Rd thatforwards its arguments to one of the \ifelse branches. As far as Iremember, \newcommand{}{} has to fit on one line, but in R ? 3.6.0,macros themselves can take multi-line arguments.If you're targeting an earlier version of R, you can make multi-linearguments work by forcing R to cache the parse tree of the man pagewhile building a source tarball with a newer R version using\Sexpr[stage=build]{}, costing you some time during R CMD build and aslightly larger source tarball. (It's an implementation detail that onenormally shouldn't depend upon. Thankfully, as of 2022, there won't beany newer versions of R ? 3.5.x to break it.) Support forman/macros/*.Rd only appeared in R-3.2.0, so I haven't researchedcompatibility tricks for even older versions of R.-- Best regards,Ivan______________________________________________R-package-devel at r-project.org mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Fri Sep  9 22:09:56 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Fri, 9 Sep 2022 16:09:56 -0400
Subject: [R-pkg-devel] Package DOI format - created with Roxygen
In-Reply-To: <12df3d5f-7bf8-80a8-9e35-30c3ec647162-3077@krueger-family.de>
References: <12df3d5f-7bf8-80a8-9e35-30c3ec647162-3077@krueger-family.de>
Message-ID: <5d6b9dcc-e771-ca6d-5d94-f2e7a53d5a61@gmail.com>

This *may* be a false positive: it probably has to do with the issue 
that DOIs fail when they are checked by CRAN because proxies used by the 
publishers (Cloudflare etc.) detect automated queries and reject them.

   This has been discussed on r-package-devel *fairly* recently (last 
few months?), but I can't find it.

   Related: Do people have good strategies for searching R mailing 
lists? All the searchable aggregators I know about (gmane, nabble) are 
defunct by now.  Googling with site:stat.ethz.ch isn't sufficiently 
precise.  (I'd like to be able to do "full-text search for <xxxx> on 
r-package-devel".)

   cheers
    Ben Bolker

On 9/9/22 6:27 AM, Knut Krueger wrote:
> 
> Hi to all,
> 
> 
> The error message from Cran:
> 
> The DOIs are? available.
> What is wrong with the format of the references? They are unchanged for 
> a long time? version but now there are errors at this submission:
> -------------------------------------
> 
> New submission
> 
> Package was archived on CRAN
> 
> Possibly misspelled words in DESCRIPTION:
>  ?? ADI (6:37, 8:9)
>  ?? FDI (6:71, 8:13)
>  ?? Hemelrijk (8:17)
>  ?? Musicnotition (8:131)
>  ?? Vries (8:78)
>  ?? al (8:30, 8:87)
>  ?? de (8:75)
>  ?? et (8:27, 8:84)
> 
> Found the following (possibly) invalid DOIs:
>  ?? DOI: 10.1163/156853905774405290
>  ???? From: DESCRIPTION
>  ???? Status: Forbidden
>  ???? Message: 403
>  ?? DOI: 10.1163/156853909X412241
>  ???? From: DESCRIPTION
>  ???? Status: Forbidden
>  ???? Message: 403
> 
> -----------------------------------------------------------
> 
> 
> 
> #' @return returns a list with\cr
> #'ADI - the Average Dominance index\cr
> #'Colors - the colors supported by vcolors sorted by ADI of the items\cr
> #'ADI_count_matrix - the counts from which the ADI was calculated\cr
> #' @author Knut Krueger, \email{Knut.Krueger at equine-science.de}
> #' @references {
> #' The Construction of Dominance Order: Comparing Performance of Five 
> Methods Using an Individual-Based Model C. K. Hemelrijk, J. Wantia and 
> L. Gygax, Behaviour Vol. 142, No. 8 (Aug., 2005), pp. 1037-1058
> #' \doi{10.1163/156853905774405290}\cr
> #'On using the DomWorld model to evaluate dominance ranking methods , de 
> Vries, Han,? Behaviour, Volume 146, Number 6, 2009 , pp. 843-869(27)
> #'\doi{10.1163/156853909X412241}
> #' }
> 
> 
> Kind regards Knut
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
Graduate chair, Mathematics & Statistics


From bbo|ker @end|ng |rom gm@||@com  Fri Sep  9 22:23:40 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Fri, 9 Sep 2022 16:23:40 -0400
Subject: [R-pkg-devel] How to write a 'cases' environment in .Rd files?
In-Reply-To: <1MNKhm-1o33f53oF8-00On1j-4951@mail.gmx.net>
References: <1MNKhm-1o33f53oF8-00On1j-4951@mail.gmx.net>
Message-ID: <b569c4f6-c0a3-43e1-f47b-3a630c33aa7f@gmail.com>

   For what it's worth: (1) I think the problems from the original 
report are PDF-rendering and not KaTeX-rendering issues

(2) I have worked around this problem with something like this 
(\left\{\begin{array}{rl} ... \end{array}\right.)

\left\{
   \begin{array}{rl}
       1\,, & 0 \le {\cal R}_0 \le 1, \\
       \left(\frac{1}{{\cal R}_0}\right)^{k} \,, & 1\le{\cal R}_0.
   \end{array}
\right.

(3) amsmath will be available in Rd.sty shortly

https://github.com/wch/r-source/commit/18ab2514504e598f0bf24264dac2d870cf891e1e

On 8/12/22 3:09 AM, matthias-gondan wrote:
> I am currently developing an R package that translates R expressions to Html and Latex, things like dbinom(x, size, prob) to P\left(x; N, \pi\right)Generation of Rd files may be an interesting use case. It's still at an early stage, I appreciate contributions and interesting feature requests.github.com/mgondan/mathmlVon meinem/meiner Galaxy gesendet
> -------- Urspr?ngliche Nachricht --------Von: Ivan Krylov <krylov.r00t at gmail.com> Datum: 12.08.22  08:16  (GMT+01:00) An: Marius Hofert <marius.hofert at uwaterloo.ca> Cc: r-package-devel at r-project.org Betreff: Re: [R-pkg-devel] How to write a 'cases' environment in .Rd files? On Thu, 11 Aug 2022 18:43:44 +0000Marius Hofert <marius.hofert at uwaterloo.ca> wrote:> Since recently, r-devel-linux-x86_64-debian-clang and> r-devel-linux-x86_64-debian-gcc trigger the note 'Undefined control> sequence: \cases in F(x) = \cases{...', possibly due to KaTeX> rendering help pages. I looked around quite a bit but couldn't find a> way to implement 'cases' environments. For example,> https://katex.org/docs/supported.html#environments mentions> \begin{cases} \end{cases}, so I tried> > \deqn{F(x) = \begin{cases}> 1,&\text{if}\ x > 0,\\> 0,&\text{if} x = 0.}}{...}> > but that triggers:> > ...> * checking PDF version of manual ... WARNING> LaTeX errors when creating PDF version.> This typically indicates Rd problems.> LaTeX errors found:> ! Misplaced alignment tab character &There is a possible workaround, but it's the opposite of beautiful. Youcan use conditional text to compile one version of the formula for HTMLhelp and another one for PDF help:\ifelse{html}{\eqn{\begin{cases}...}}{\eqn{\cases{...}}{ascii}}It's as tedious as it looks. For extra style(?) points, you can put athree-argument user-defined macro in man/macros/whatever.Rd thatforwards its arguments to one of the \ifelse branches. As far as Iremember, \newcommand{}{} has to fit on one line, but in R ? 3.6.0,macros themselves can take multi-line arguments.If you're targeting an earlier version of R, you can make multi-linearguments work by forcing R to cache the parse tree of the man pagewhile building a source tarball with a newer R version using\Sexpr[stage=build]{}, costing you some time during R CMD build and aslightly larger source tarball. (It's an implementation detail that onenormally shouldn't depend upon. Thankfully, as of 2022, there won't beany newer versions of R ? 3.5.x to break it.) Support forman/macros/*.Rd only appeared in R-3.2.0, so I haven't researchedcompatibility tricks for even older versions of R.-- Best regards,Ivan______________________________________________R-package-devel at r-project.org mailing listhttps://stat.ethz.ch/mailman/listinfo/r-package-devel
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
Graduate chair, Mathematics & Statistics

From greg @end|ng |rom ||rm@n@y@h@com  Fri Sep  9 22:55:43 2022
From: greg @end|ng |rom ||rm@n@y@h@com (Greg Hunt)
Date: Sat, 10 Sep 2022 06:55:43 +1000
Subject: [R-pkg-devel] Package DOI format - created with Roxygen
In-Reply-To: <5d6b9dcc-e771-ca6d-5d94-f2e7a53d5a61@gmail.com>
References: <12df3d5f-7bf8-80a8-9e35-30c3ec647162-3077@krueger-family.de>
 <5d6b9dcc-e771-ca6d-5d94-f2e7a53d5a61@gmail.com>
Message-ID: <CAAS8PAJuEUH9bsHkK+NH1DG-3YiCU1JedrCGHHEau6VrX5DiCg@mail.gmail.com>

Ben,
Its not quite that simple, the use of HEAD rather than GET in the HTTP
request results in 403 errors in a fair number of cases and appears to be
readily fixable.  The thread was around the 30th of June.

Greg

On Sat, 10 Sept 2022 at 06:17, Ben Bolker <bbolker at gmail.com> wrote:

> This *may* be a false positive: it probably has to do with the issue
> that DOIs fail when they are checked by CRAN because proxies used by the
> publishers (Cloudflare etc.) detect automated queries and reject them.
>
>    This has been discussed on r-package-devel *fairly* recently (last
> few months?), but I can't find it.
>
>    Related: Do people have good strategies for searching R mailing
> lists? All the searchable aggregators I know about (gmane, nabble) are
> defunct by now.  Googling with site:stat.ethz.ch isn't sufficiently
> precise.  (I'd like to be able to do "full-text search for <xxxx> on
> r-package-devel".)
>
>    cheers
>     Ben Bolker
>
> On 9/9/22 6:27 AM, Knut Krueger wrote:
> >
> > Hi to all,
> >
> >
> > The error message from Cran:
> >
> > The DOIs are  available.
> > What is wrong with the format of the references? They are unchanged for
> > a long time  version but now there are errors at this submission:
> > -------------------------------------
> >
> > New submission
> >
> > Package was archived on CRAN
> >
> > Possibly misspelled words in DESCRIPTION:
> >     ADI (6:37, 8:9)
> >     FDI (6:71, 8:13)
> >     Hemelrijk (8:17)
> >     Musicnotition (8:131)
> >     Vries (8:78)
> >     al (8:30, 8:87)
> >     de (8:75)
> >     et (8:27, 8:84)
> >
> > Found the following (possibly) invalid DOIs:
> >     DOI: 10.1163/156853905774405290
> >       From: DESCRIPTION
> >       Status: Forbidden
> >       Message: 403
> >     DOI: 10.1163/156853909X412241
> >       From: DESCRIPTION
> >       Status: Forbidden
> >       Message: 403
> >
> > -----------------------------------------------------------
> >
> >
> >
> > #' @return returns a list with\cr
> > #'ADI - the Average Dominance index\cr
> > #'Colors - the colors supported by vcolors sorted by ADI of the items\cr
> > #'ADI_count_matrix - the counts from which the ADI was calculated\cr
> > #' @author Knut Krueger, \email{Knut.Krueger at equine-science.de}
> > #' @references {
> > #' The Construction of Dominance Order: Comparing Performance of Five
> > Methods Using an Individual-Based Model C. K. Hemelrijk, J. Wantia and
> > L. Gygax, Behaviour Vol. 142, No. 8 (Aug., 2005), pp. 1037-1058
> > #' \doi{10.1163/156853905774405290}\cr
> > #'On using the DomWorld model to evaluate dominance ranking methods , de
> > Vries, Han,  Behaviour, Volume 146, Number 6, 2009 , pp. 843-869(27)
> > #'\doi{10.1163/156853909X412241}
> > #' }
> >
> >
> > Kind regards Knut
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
> --
> Dr. Benjamin Bolker
> Professor, Mathematics & Statistics and Biology, McMaster University
> Director, School of Computational Science and Engineering
> Graduate chair, Mathematics & Statistics
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Fri Sep  9 23:26:24 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Fri, 9 Sep 2022 17:26:24 -0400
Subject: [R-pkg-devel] Package DOI format - created with Roxygen
In-Reply-To: <CAAS8PAJuEUH9bsHkK+NH1DG-3YiCU1JedrCGHHEau6VrX5DiCg@mail.gmail.com>
References: <12df3d5f-7bf8-80a8-9e35-30c3ec647162-3077@krueger-family.de>
 <5d6b9dcc-e771-ca6d-5d94-f2e7a53d5a61@gmail.com>
 <CAAS8PAJuEUH9bsHkK+NH1DG-3YiCU1JedrCGHHEau6VrX5DiCg@mail.gmail.com>
Message-ID: <9a9473b8-387d-6844-7ad5-b60b528aacb9@gmail.com>

   Thanks.

https://stat.ethz.ch/pipermail/r-package-devel/2022q2/008200.html

On 2022-09-09 4:55 p.m., Greg Hunt wrote:
> Ben,
> Its not quite that simple, the use of HEAD rather than GET in the HTTP 
> request results in 403 errors in a fair number of cases and appears to 
> be readily fixable.? The thread was around the 30th of June.
> 
> Greg
> 
> On Sat, 10 Sept 2022 at 06:17, Ben Bolker <bbolker at gmail.com 
> <mailto:bbolker at gmail.com>> wrote:
> 
>     This *may* be a false positive: it probably has to do with the issue
>     that DOIs fail when they are checked by CRAN because proxies used by
>     the
>     publishers (Cloudflare etc.) detect automated queries and reject them.
> 
>      ? ?This has been discussed on r-package-devel *fairly* recently (last
>     few months?), but I can't find it.
> 
>      ? ?Related: Do people have good strategies for searching R mailing
>     lists? All the searchable aggregators I know about (gmane, nabble) are
>     defunct by now.? Googling with site:stat.ethz.ch
>     <http://stat.ethz.ch> isn't sufficiently
>     precise.? (I'd like to be able to do "full-text search for <xxxx> on
>     r-package-devel".)
> 
>      ? ?cheers
>      ? ? Ben Bolker
> 
>     On 9/9/22 6:27 AM, Knut Krueger wrote:
>      >
>      > Hi to all,
>      >
>      >
>      > The error message from Cran:
>      >
>      > The DOIs are? available.
>      > What is wrong with the format of the references? They are
>     unchanged for
>      > a long time? version but now there are errors at this submission:
>      > -------------------------------------
>      >
>      > New submission
>      >
>      > Package was archived on CRAN
>      >
>      > Possibly misspelled words in DESCRIPTION:
>      >? ?? ADI (6:37, 8:9)
>      >? ?? FDI (6:71, 8:13)
>      >? ?? Hemelrijk (8:17)
>      >? ?? Musicnotition (8:131)
>      >? ?? Vries (8:78)
>      >? ?? al (8:30, 8:87)
>      >? ?? de (8:75)
>      >? ?? et (8:27, 8:84)
>      >
>      > Found the following (possibly) invalid DOIs:
>      >? ?? DOI: 10.1163/156853905774405290
>      >? ???? From: DESCRIPTION
>      >? ???? Status: Forbidden
>      >? ???? Message: 403
>      >? ?? DOI: 10.1163/156853909X412241
>      >? ???? From: DESCRIPTION
>      >? ???? Status: Forbidden
>      >? ???? Message: 403
>      >
>      > -----------------------------------------------------------
>      >
>      >
>      >
>      > #' @return returns a list with\cr
>      > #'ADI - the Average Dominance index\cr
>      > #'Colors - the colors supported by vcolors sorted by ADI of the
>     items\cr
>      > #'ADI_count_matrix - the counts from which the ADI was calculated\cr
>      > #' @author Knut Krueger, \email{Knut.Krueger at equine-science.de
>     <mailto:email%7BKnut.Krueger at equine-science.de>}
>      > #' @references {
>      > #' The Construction of Dominance Order: Comparing Performance of
>     Five
>      > Methods Using an Individual-Based Model C. K. Hemelrijk, J.
>     Wantia and
>      > L. Gygax, Behaviour Vol. 142, No. 8 (Aug., 2005), pp. 1037-1058
>      > #' \doi{10.1163/156853905774405290}\cr
>      > #'On using the DomWorld model to evaluate dominance ranking
>     methods , de
>      > Vries, Han,? Behaviour, Volume 146, Number 6, 2009 , pp. 843-869(27)
>      > #'\doi{10.1163/156853909X412241}
>      > #' }
>      >
>      >
>      > Kind regards Knut
>      >
>      > ______________________________________________
>      > R-package-devel at r-project.org
>     <mailto:R-package-devel at r-project.org> mailing list
>      > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> 
>     -- 
>     Dr. Benjamin Bolker
>     Professor, Mathematics & Statistics and Biology, McMaster University
>     Director, School of Computational Science and Engineering
>     Graduate chair, Mathematics & Statistics
> 
>     ______________________________________________
>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>     mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> 

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From dw|n@em|u@ @end|ng |rom comc@@t@net  Sat Sep 10 01:49:43 2022
From: dw|n@em|u@ @end|ng |rom comc@@t@net (David Winsemius)
Date: Fri, 9 Sep 2022 16:49:43 -0700
Subject: [R-pkg-devel] search strategies for R mailing lists
In-Reply-To: <5d6b9dcc-e771-ca6d-5d94-f2e7a53d5a61@gmail.com>
References: <12df3d5f-7bf8-80a8-9e35-30c3ec647162-3077@krueger-family.de>
 <5d6b9dcc-e771-ca6d-5d94-f2e7a53d5a61@gmail.com>
Message-ID: <e49994b8-55e9-d3f6-70af-89a22dff4dd1@comcast.net>


On 9/9/22 13:09, Ben Bolker wrote:
>
>
> ? Related: Do people have good strategies for searching R mailing 
> lists? All the searchable aggregators I know about (gmane, nabble) are 
> defunct by now.? Googling with site:stat.ethz.ch isn't sufficiently 
> precise.? (I'd like to be able to do "full-text search for <xxxx> on 
> r-package-devel".)

For many years, ~15, I've used MarkMail. It sadly does not index 
R-pkg-devel, but it does index r-help and r-devel and several other 
important resources.

https://markmail.org/search/?q=list%3Aorg.r-project

Here's todays count.

org.r-project.r-help 
<https://markmail.org/search/+list:org.r-project.r-help> 	386,759
org.r-project.r-devel 
<https://markmail.org/search/+list:org.r-project.r-devel> 	60,043
org.r-project.r-sig-geo 
<https://markmail.org/search/+list:org.r-project.r-sig-geo> 	28,146
org.r-project.r-sig-mixed-models 
<https://markmail.org/search/+list:org.r-project.r-sig-mixed-models> 
19,334
org.r-project.r-sig-finance 
<https://markmail.org/search/+list:org.r-project.r-sig-finance> 	14,810
org.r-project.r-sig-mac 
<https://markmail.org/search/+list:org.r-project.r-sig-mac> 	14,026
org.r-project.r-sig-ecology 
<https://markmail.org/search/+list:org.r-project.r-sig-ecology> 	6,281
org.r-project.r-sig-phylo 
<https://markmail.org/search/+list:org.r-project.r-sig-phylo> 	5,802
org.r-project.r-sig-debian 
<https://markmail.org/search/+list:org.r-project.r-sig-debian> 	3,414
org.r-project.r-sig-db 
<https://markmail.org/search/+list:org.r-project.r-sig-db> 	1,514

HTH

David




	[[alternative HTML version deleted]]


From dw|n@em|u@ @end|ng |rom comc@@t@net  Sat Sep 10 01:55:58 2022
From: dw|n@em|u@ @end|ng |rom comc@@t@net (David Winsemius)
Date: Fri, 9 Sep 2022 16:55:58 -0700
Subject: [R-pkg-devel] search strategies for R mailing lists
In-Reply-To: <e49994b8-55e9-d3f6-70af-89a22dff4dd1@comcast.net>
References: <12df3d5f-7bf8-80a8-9e35-30c3ec647162-3077@krueger-family.de>
 <5d6b9dcc-e771-ca6d-5d94-f2e7a53d5a61@gmail.com>
 <e49994b8-55e9-d3f6-70af-89a22dff4dd1@comcast.net>
Message-ID: <bc6abe8b-22b7-227f-7805-6a37c18820f3@comcast.net>


On 9/9/22 16:49, David Winsemius wrote:
> On 9/9/22 13:09, Ben Bolker wrote:
>>
>>  ? Related: Do people have good strategies for searching R mailing
>> lists? All the searchable aggregators I know about (gmane, nabble) are
>> defunct by now.? Googling with site:stat.ethz.ch isn't sufficiently
>> precise.? (I'd like to be able to do "full-text search for <xxxx> on
>> r-package-devel".)
> For many years, ~15, I've used MarkMail. It sadly does not index
> R-pkg-devel,


I was in error on that point. There are more packages indexed than show 
up on the default listing, you need to click the "More" button in the 
upper right corner of the list-of-lists.


What List?
1) 	org.r-project.r-help 
<https://markmail.org/search/+list:org.r-project.r-help> 	386,759
2) 	org.r-project.r-devel 
<https://markmail.org/search/+list:org.r-project.r-devel> 	60,043
3) 	org.r-project.r-sig-geo 
<https://markmail.org/search/+list:org.r-project.r-sig-geo> 	28,146
4) 	org.r-project.r-sig-mixed-models 
<https://markmail.org/search/+list:org.r-project.r-sig-mixed-models> 
19,334
5) 	org.r-project.r-sig-finance 
<https://markmail.org/search/+list:org.r-project.r-sig-finance> 	14,810
6) 	org.r-project.r-sig-mac 
<https://markmail.org/search/+list:org.r-project.r-sig-mac> 	14,026
7) 	org.r-project.r-sig-ecology 
<https://markmail.org/search/+list:org.r-project.r-sig-ecology> 	6,281
8) 	org.r-project.r-sig-phylo 
<https://markmail.org/search/+list:org.r-project.r-sig-phylo> 	5,802
9) 	org.r-project.r-sig-debian 
<https://markmail.org/search/+list:org.r-project.r-sig-debian> 	3,414
10) 	org.r-project.r-sig-db 
<https://markmail.org/search/+list:org.r-project.r-sig-db> 	1,514
11) 	org.r-project.r-sig-gui 
<https://markmail.org/search/+list:org.r-project.r-sig-gui> 	1,230
12) 	org.r-project.r-sig-teaching 
<https://markmail.org/search/+list:org.r-project.r-sig-teaching> 	867

13) 	org.r-project.r-packages 
<https://markmail.org/search/+list:org.r-project.r-packages> 	851
14) 	org.r-project.r-sig-fedora 
<https://markmail.org/search/+list:org.r-project.r-sig-fedora> 	821
15) 	org.r-project.r-sig-jobs 
<https://markmail.org/search/+list:org.r-project.r-sig-jobs> 	409
16) 	org.r-project.r-sig-wiki 
<https://markmail.org/search/+list:org.r-project.r-sig-wiki> 	398
17) 	org.r-project.r-sig-epi 
<https://markmail.org/search/+list:org.r-project.r-sig-epi> 	363
18) 	org.r-project.r-sig-robust 
<https://markmail.org/search/+list:org.r-project.r-sig-robust> 	283
19) 	org.r-project.r-announce 
<https://markmail.org/search/+list:org.r-project.r-announce> 	203
20) 	org.r-project.r-sig-gr 
<https://markmail.org/search/+list:org.r-project.r-sig-gr> 	170
21) 	org.r-project.r-sig-s 
<https://markmail.org/search/+list:org.r-project.r-sig-s> 	32
22) 	org.r-project.r-sig-networks 
<https://markmail.org/search/+list:org.r-project.r-sig-networks> 	27
23) 	org.r-project.r-sig-mediawiki 
<https://markmail.org/search/+list:org.r-project.r-sig-mediawiki> 	25
24) 	org.r-project.r-sig-qa 
<https://markmail.org/search/+list:org.r-project.r-sig-qa> 	25

I discovered this by searching on "doi packages" and seeing many 
citations to r-packages postings.


HTH

David


> but it does index r-help and r-devel and several other
> important resources.
>
> https://markmail.org/search/?q=list%3Aorg.r-project
>
> Here's todays count.
>
> org.r-project.r-help
> <https://markmail.org/search/+list:org.r-project.r-help> 	386,759
> org.r-project.r-devel
> <https://markmail.org/search/+list:org.r-project.r-devel> 	60,043
> org.r-project.r-sig-geo
> <https://markmail.org/search/+list:org.r-project.r-sig-geo> 	28,146
> org.r-project.r-sig-mixed-models
> <https://markmail.org/search/+list:org.r-project.r-sig-mixed-models>
> 19,334
> org.r-project.r-sig-finance
> <https://markmail.org/search/+list:org.r-project.r-sig-finance> 	14,810
> org.r-project.r-sig-mac
> <https://markmail.org/search/+list:org.r-project.r-sig-mac> 	14,026
> org.r-project.r-sig-ecology
> <https://markmail.org/search/+list:org.r-project.r-sig-ecology> 	6,281
> org.r-project.r-sig-phylo
> <https://markmail.org/search/+list:org.r-project.r-sig-phylo> 	5,802
> org.r-project.r-sig-debian
> <https://markmail.org/search/+list:org.r-project.r-sig-debian> 	3,414
> org.r-project.r-sig-db
> <https://markmail.org/search/+list:org.r-project.r-sig-db> 	1,514
>
> HTH
>
> David
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Sep 10 11:30:34 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 10 Sep 2022 05:30:34 -0400
Subject: [R-pkg-devel] 
 help using \Sexpr in .Rd documentaiton file results
 in error in windows
In-Reply-To: <CAJyC-m7pBvDz2xxiRyaWkfv3T7Ebuwu6m2StJ_dsX9B-A52A5Q@mail.gmail.com>
References: <CAJyC-m7pBvDz2xxiRyaWkfv3T7Ebuwu6m2StJ_dsX9B-A52A5Q@mail.gmail.com>
Message-ID: <f21a985a-ffce-631b-f922-627d71b8b09d@gmail.com>

On 09/09/2022 11:23 a.m., Jairo Hidalgo Migueles wrote:
> Dear list,
> 
> I tried to write a dynamic help file following the Writing R Extensions
> manual (section 2.12, "Dynamic pages"). When using the \Sexpr macro, the
> package does not longer pass the R CMD CHECK. I get the following error:
> 
> ?? R CMD build ?????????????????????????????
> ?  checking for file 'C:\R\pkgs\GGIR/DESCRIPTION' ...
> ?  preparing 'GGIR': (8.5s)
> ?  checking DESCRIPTION meta-information ...
> ?  cleaning src
> ?  installing the package to process help pages (427ms)
> ?  building the PDF package manual (13.9s)
>     Warning in system2(..., stdout = FALSE, stderr = FALSE) :
>       '"makeindex"' not found
>     Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,
>   :
>       unable to run 'makeindex' on 'Rd2.idx'
>     Warning in system2(..., stdout = FALSE, stderr = FALSE) :
>       '"makeindex"' not found
>     Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,
>   :
>       unable to run 'makeindex' on 'Rd2.idx'
>     Error in running tools::texi2pdf()
> Error in proc$get_built_file() : Build process failed
> 
> It seems there is something wrong when building the package manual, but
> after some attempts, I have not been able to fix this. Any advice is
> welcome.
> 
> Here an example of the \Sexpr usage in the .Rd file, consider "argument"
> the name of a parameter to function "fn" in package "pkg":
> 
> \usage{
> fn(argument= \Sexpr{format(formals(pkg::fn)[[" argument "]])})
> }
> 

There doesn't appear to be any complaint specifically about your Rd 
file.  The problem is that to evaluate that line, the package needs to 
be installed, and the installation is failing because the installer 
couldn't find the `makeindex` program.  That should be part of your 
LaTeX distribution.

You can ask INSTALL not to build the manual, and then this might succeed.

Duncan Murdoch


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Sep 10 18:38:53 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 10 Sep 2022 12:38:53 -0400
Subject: [R-pkg-devel] 
 help using \Sexpr in .Rd documentaiton file results
 in error in windows
In-Reply-To: <CALnEB15hDSdbeupFBSXd7N5QVQ-i6xQ7X9VniK_mCtXjAOaXaw@mail.gmail.com>
References: <CAJyC-m7pBvDz2xxiRyaWkfv3T7Ebuwu6m2StJ_dsX9B-A52A5Q@mail.gmail.com>
 <f21a985a-ffce-631b-f922-627d71b8b09d@gmail.com>
 <CALnEB15hDSdbeupFBSXd7N5QVQ-i6xQ7X9VniK_mCtXjAOaXaw@mail.gmail.com>
Message-ID: <7d85cf0b-12f3-0d71-7d7f-73666cd93b3e@gmail.com>


On 10/09/2022 9:49 a.m., Vincent van Hees wrote:
> Thanks Duncan, I am working with Jairo on this and we encounter 
> the?problem in a GitHub Actions environment.
> 
>     You can ask INSTALL not to build the manual, and then this might
>     succeed.
> 
> 
> Do you or anyone else here know how to tell GitHub Actions to not build 
> a manual?
> 
> We already have "--no-manual" in the package check statement:
> 
> rcmdcheck::rcmdcheck(args = c("--no-manual", "--as-cran"), error_on = 
> "warning", check_dir = "check")
> See full yml file here: 
> https://github.com/wadpac/GGIR/blob/issue617_documentation/.github/workflows/r.yml 
> <https://github.com/wadpac/GGIR/blob/issue617_documentation/.github/workflows/r.yml>

You set it as an `R CMD check` option, but the error happens in `R CMD 
build`.  So you also need `build_args = "--no-manual"` in your call to 
`rcmdcheck()` to avoid that.

Duncan Murdoch

> 
> Vincent
> 
> 
> 
> On Sat, 10 Sept 2022 at 11:31, Duncan Murdoch <murdoch.duncan at gmail.com 
> <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     On 09/09/2022 11:23 a.m., Jairo Hidalgo Migueles wrote:
>      > Dear list,
>      >
>      > I tried to write a dynamic help file following the Writing R
>     Extensions
>      > manual (section 2.12, "Dynamic pages"). When using the \Sexpr
>     macro, the
>      > package does not longer pass the R CMD CHECK. I get the following
>     error:
>      >
>      > ?? R CMD build ?????????????????????????????
>      > ?? checking for file 'C:\R\pkgs\GGIR/DESCRIPTION' ...
>      > ?? preparing 'GGIR': (8.5s)
>      > ?? checking DESCRIPTION meta-information ...
>      > ?? cleaning src
>      > ?? installing the package to process help pages (427ms)
>      > ?? building the PDF package manual (13.9s)
>      >? ? ?Warning in system2(..., stdout = FALSE, stderr = FALSE) :
>      >? ? ? ?'"makeindex"' not found
>      >? ? ?Error in texi2dvi(file = file, pdf = TRUE, clean = clean,
>     quiet = quiet,
>      >? ?:
>      >? ? ? ?unable to run 'makeindex' on 'Rd2.idx'
>      >? ? ?Warning in system2(..., stdout = FALSE, stderr = FALSE) :
>      >? ? ? ?'"makeindex"' not found
>      >? ? ?Error in texi2dvi(file = file, pdf = TRUE, clean = clean,
>     quiet = quiet,
>      >? ?:
>      >? ? ? ?unable to run 'makeindex' on 'Rd2.idx'
>      >? ? ?Error in running tools::texi2pdf()
>      > Error in proc$get_built_file() : Build process failed
>      >
>      > It seems there is something wrong when building the package
>     manual, but
>      > after some attempts, I have not been able to fix this. Any advice is
>      > welcome.
>      >
>      > Here an example of the \Sexpr usage in the .Rd file, consider
>     "argument"
>      > the name of a parameter to function "fn" in package "pkg":
>      >
>      > \usage{
>      > fn(argument= \Sexpr{format(formals(pkg::fn)[[" argument "]])})
>      > }
>      >
> 
>     There doesn't appear to be any complaint specifically about your Rd
>     file.? The problem is that to evaluate that line, the package needs to
>     be installed, and the installation is failing because the installer
>     couldn't find the `makeindex` program.? That should be part of your
>     LaTeX distribution.
> 
>     You can ask INSTALL not to build the manual, and then this might
>     succeed.
> 
>     Duncan Murdoch
> 
>     ______________________________________________
>     R-package-devel at r-project.org <mailto:R-package-devel at r-project.org>
>     mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>


From edwwe|2020 @end|ng |rom gm@||@com  Mon Sep 12 15:09:02 2022
From: edwwe|2020 @end|ng |rom gm@||@com (Edward Wei)
Date: Mon, 12 Sep 2022 06:09:02 -0700
Subject: [R-pkg-devel] Unable to create manual
Message-ID: <CAEf_eRCTaa5Xnv6TkHX=Jncqv+Fu7PMTM=_w7WLFj9SDGVKm5g@mail.gmail.com>

This is the following error message I get from R CMD check:

LaTeX errors when creating PDF version.
This typically indicates Rd problems.
* checking PDF version of manual without index ... ERROR
Re-running with no redirection of stdout/stderr.
Hmm ... looks like a package
Converting parsed Rd's to LaTeX ...
Creating pdf output from LaTeX ...
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in running tools::texi2pdf()
You may want to clean up by 'rm -Rf
C:/Users/edmon/AppData/Local/Temp/RtmpWkD7Iy/Rd2pdf35d81e3e188c'
* DONE

Status: 1 ERROR, 1 WARNING, 2 NOTEs


Then, I tried debugging by isolating errors from the Rd to PDF conversion.


C:\Users\edmon\Documents\R\RFIN> R CMD Rd2pdf avfintools --no-clean
Hmm ... looks like a package
Converting Rd files to LaTeX ...
Creating pdf output from LaTeX ...
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in running tools::texi2pdf()
You may want to clean up by 'rm -Rf .Rd2pdf27964'


In this folder is the file Rd2.tex which I tried to complie into a pdf. But
this error returns and PDF cannot be compiled. :


LaTeX Error: File `Rd.sty' not found.

Type X to quit or <RETURN> to proceed,
or enter new name. (Default extension: sty)

Enter file name:
! Emergency stop.
<read *>

l.4 \usepackage
               {makeidx}^^M
==> Fatal error occurred, no output PDF file produced!


Thanks for your help,

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Sep 12 16:20:09 2022
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 12 Sep 2022 16:20:09 +0200
Subject: [R-pkg-devel] Unable to create manual
In-Reply-To: <CAEf_eRCTaa5Xnv6TkHX=Jncqv+Fu7PMTM=_w7WLFj9SDGVKm5g@mail.gmail.com>
References: <CAEf_eRCTaa5Xnv6TkHX=Jncqv+Fu7PMTM=_w7WLFj9SDGVKm5g@mail.gmail.com>
Message-ID: <a704e800-ffef-7966-f566-bb00538c4908@statistik.tu-dortmund.de>



On 12.09.2022 15:09, Edward Wei wrote:
> This is the following error message I get from R CMD check:
> 
> LaTeX errors when creating PDF version.
> This typically indicates Rd problems.
> * checking PDF version of manual without index ... ERROR
> Re-running with no redirection of stdout/stderr.
> Hmm ... looks like a package
> Converting parsed Rd's to LaTeX ...
> Creating pdf output from LaTeX ...
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available



Install some LaTeX distribution?

Best,
Uwe Ligges



> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available
> Error in running tools::texi2pdf()
> You may want to clean up by 'rm -Rf
> C:/Users/edmon/AppData/Local/Temp/RtmpWkD7Iy/Rd2pdf35d81e3e188c'
> * DONE
> 
> Status: 1 ERROR, 1 WARNING, 2 NOTEs
> 
> 
> Then, I tried debugging by isolating errors from the Rd to PDF conversion.
> 
> 
> C:\Users\edmon\Documents\R\RFIN> R CMD Rd2pdf avfintools --no-clean
> Hmm ... looks like a package
> Converting Rd files to LaTeX ...
> Creating pdf output from LaTeX ...
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available
> Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
>    pdflatex is not available
> Error in running tools::texi2pdf()
> You may want to clean up by 'rm -Rf .Rd2pdf27964'
> 
> 
> In this folder is the file Rd2.tex which I tried to complie into a pdf. But
> this error returns and PDF cannot be compiled. :
> 
> 
> LaTeX Error: File `Rd.sty' not found.
> 
> Type X to quit or <RETURN> to proceed,
> or enter new name. (Default extension: sty)
> 
> Enter file name:
> ! Emergency stop.
> <read *>
> 
> l.4 \usepackage
>                 {makeidx}^^M
> ==> Fatal error occurred, no output PDF file produced!
> 
> 
> Thanks for your help,
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From m@tth|@@-gond@n @end|ng |rom gmx@de  Mon Sep 12 16:20:29 2022
From: m@tth|@@-gond@n @end|ng |rom gmx@de (Matthias Gondan)
Date: Mon, 12 Sep 2022 16:20:29 +0200
Subject: [R-pkg-devel] Unable to create manual
In-Reply-To: <CAEf_eRCTaa5Xnv6TkHX=Jncqv+Fu7PMTM=_w7WLFj9SDGVKm5g@mail.gmail.com>
References: <CAEf_eRCTaa5Xnv6TkHX=Jncqv+Fu7PMTM=_w7WLFj9SDGVKm5g@mail.gmail.com>
Message-ID: <1Mof9P-1p94FQ2bwf-00p8an@mail.gmx.net>

You may wish to check first if pdflatex works from the folder, i.e.

C:\Users\edmon\Documents\R\RFIN> pdflatex

The problem with Rd.sty may be unrelated.


Von: Edward Wei
Gesendet: Montag, 12. September 2022 15:09
An: r-package-devel at r-project.org
Betreff: [R-pkg-devel] Unable to create manual

This is the following error message I get from R CMD check:

LaTeX errors when creating PDF version.
This typically indicates Rd problems.
* checking PDF version of manual without index ... ERROR
Re-running with no redirection of stdout/stderr.
Hmm ... looks like a package
Converting parsed Rd's to LaTeX ...
Creating pdf output from LaTeX ...
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in running tools::texi2pdf()
You may want to clean up by 'rm -Rf
C:/Users/edmon/AppData/Local/Temp/RtmpWkD7Iy/Rd2pdf35d81e3e188c'
* DONE

Status: 1 ERROR, 1 WARNING, 2 NOTEs


Then, I tried debugging by isolating errors from the Rd to PDF conversion.


C:\Users\edmon\Documents\R\RFIN> R CMD Rd2pdf avfintools --no-clean
Hmm ... looks like a package
Converting Rd files to LaTeX ...
Creating pdf output from LaTeX ...
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in texi2dvi(file = file, pdf = TRUE, clean = clean, quiet = quiet,  :
  pdflatex is not available
Error in running tools::texi2pdf()
You may want to clean up by 'rm -Rf .Rd2pdf27964'


In this folder is the file Rd2.tex which I tried to complie into a pdf. But
this error returns and PDF cannot be compiled. :


LaTeX Error: File `Rd.sty' not found.

Type X to quit or <RETURN> to proceed,
or enter new name. (Default extension: sty)

Enter file name:
! Emergency stop.
<read *>

l.4 \usepackage
               {makeidx}^^M
==> Fatal error occurred, no output PDF file produced!


Thanks for your help,

	[[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel


	[[alternative HTML version deleted]]


From j|r|@c@mor@vec @end|ng |rom gm@||@com  Tue Sep 13 00:42:15 2022
From: j|r|@c@mor@vec @end|ng |rom gm@||@com (=?UTF-8?B?SmnFmcOtIE1vcmF2ZWM=?=)
Date: Tue, 13 Sep 2022 10:42:15 +1200
Subject: [R-pkg-devel] Undocumented requirement for CRAN
Message-ID: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>

There are quite a lot of undocumented requirement for CRAN.
This bite me several times already.

They are not documented in the 
https://cran.r-project.org/doc/manuals/R-exts.html
Nor they are marked by `R CMD check`

Ideally, these would be documented AND flagged by R CMD check.
Otherwise, it is a waste of time for both CRAN team and package developers.

So far, the undocumented requirements that were flagged for me are:

* Documenting return value even for functions without return value
 ? -- This is even contrary to the base code (i.e., many graphical 
functions do not document return values)

* Commented code in examples

* Examples for non-exported internal functions
 ? -- I understand that this is related to the fact that any ::: is 
highly discouraged (which is documented) and that examples for 
unexported functions cannot be run without ::: .
 ???? But I like the idea of using properly documented internal 
functions and usage of examples as for rudimentary testing.


Are there any other undocumented requirements?

(we could maybe create PR for `.check_packages*` so that these problems 
are flagged by `R CMD check`)

-- Jirka


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Sep 13 01:19:08 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 12 Sep 2022 19:19:08 -0400
Subject: [R-pkg-devel] Undocumented requirement for CRAN
In-Reply-To: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>
References: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>
Message-ID: <bf6d78cd-7a19-bc5d-d39e-cc098c256fc0@gmail.com>

On 12/09/2022 6:42 p.m., Ji?? Moravec wrote:
> There are quite a lot of undocumented requirement for CRAN.
> This bite me several times already.
> 
> They are not documented in the
> https://cran.r-project.org/doc/manuals/R-exts.html
> Nor they are marked by `R CMD check`
> 
> Ideally, these would be documented AND flagged by R CMD check.
> Otherwise, it is a waste of time for both CRAN team and package developers.
> 
> So far, the undocumented requirements that were flagged for me are:
> 
> * Documenting return value even for functions without return value
>   ? -- This is even contrary to the base code (i.e., many graphical
> functions do not document return values)
> 
> * Commented code in examples
> 
> * Examples for non-exported internal functions
>   ? -- I understand that this is related to the fact that any ::: is
> highly discouraged (which is documented) and that examples for
> unexported functions cannot be run without ::: .
>   ???? But I like the idea of using properly documented internal
> functions and usage of examples as for rudimentary testing.
> 
> 
> Are there any other undocumented requirements?

Of course there are.  CRAN is not an automaton, it is a group of people 
who review your submission.

Your question is like asking whether there are any undocumented 
requirements for acceptance of a paper in a journal.  Of course there are!

What you should do is aim for perfection in what you submit.  If you can 
spot problems, fix them before you submit.  Documenting examples is an 
obvious case where the example is likely to be improved with better 
commenting.

Example code for non-exported functions seems to miss the point.  If a 
user can't count on the interface for those functions remaining 
unchanged, why document it in a user-visible place?  Put those kinds of 
docs as comments in the source code.  Or if they can count on the 
interface, then they should be exported functions.  You can test them 
using ::: if you want tests.

There are no functions without return values.  Sometimes the return 
value is an invisible NULL, but there is always a return value.  The 
fact that some base packages don't document this is a deficiency in that 
documentation, not an excuse for having a deficiency in your documentation.

Duncan Murdoch


From j|r|@c@mor@vec @end|ng |rom gm@||@com  Tue Sep 13 01:45:48 2022
From: j|r|@c@mor@vec @end|ng |rom gm@||@com (=?UTF-8?B?SmnFmcOtIE1vcmF2ZWM=?=)
Date: Tue, 13 Sep 2022 11:45:48 +1200
Subject: [R-pkg-devel] Undocumented requirement for CRAN
In-Reply-To: <bf6d78cd-7a19-bc5d-d39e-cc098c256fc0@gmail.com>
References: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>
 <bf6d78cd-7a19-bc5d-d39e-cc098c256fc0@gmail.com>
Message-ID: <1cbf20d2-9214-f79b-e570-4205fc684359@gmail.com>

For experienced R developer like you, certain things might seem obvious 
without the need of any documentation.

But please understand that other languages do not have such requirements.
So for new people, or people coming from different languages, this might 
not seem as obvious as it is for you.

R already has a capability to do automated checking of packages to 
enforce certain level of quality.
 From this perspective, at least to me, it doesn't make sense that some 
issues are automatically flagged,
while other issues, which might be on the same or lower level of 
complexity, are not.
(also, packages are not journal articles)

Same with documentation, I can't spot and fix an issue, if I am not even 
aware that it is an issue.


 > If a user can't count on the interface for those functions remaining 
unchanged, why document it in a user-visible place?

Why not? Even unexported functions are user-visible through ::: . Since 
they are already documented, I might as well produce full documentation 
that is checked during `R CMD check`.
Isn't one of the R's advantage the ability to read code of any function 
without wading through the source files?

 > The fact that some base packages don't document this is a deficiency 
in that documentation, not an excuse for having a deficiency in your 
documentation.

That is good to know. I certainly know it now after having to fix this 
issue in my package. But how I am was supposed to know about it when 
this problem is not documented, `R CMD check` doesn't flag it, and 
official documentation uses it?


-- Jirka

On 9/13/22 11:19, Duncan Murdoch wrote:
> On 12/09/2022 6:42 p.m., Ji?? Moravec wrote:
>> There are quite a lot of undocumented requirement for CRAN.
>> This bite me several times already.
>>
>> They are not documented in the
>> https://cran.r-project.org/doc/manuals/R-exts.html
>> Nor they are marked by `R CMD check`
>>
>> Ideally, these would be documented AND flagged by R CMD check.
>> Otherwise, it is a waste of time for both CRAN team and package 
>> developers.
>>
>> So far, the undocumented requirements that were flagged for me are:
>>
>> * Documenting return value even for functions without return value
>> ? ? -- This is even contrary to the base code (i.e., many graphical
>> functions do not document return values)
>>
>> * Commented code in examples
>>
>> * Examples for non-exported internal functions
>> ? ? -- I understand that this is related to the fact that any ::: is
>> highly discouraged (which is documented) and that examples for
>> unexported functions cannot be run without ::: .
>> ? ???? But I like the idea of using properly documented internal
>> functions and usage of examples as for rudimentary testing.
>>
>>
>> Are there any other undocumented requirements?
>
> Of course there are.? CRAN is not an automaton, it is a group of 
> people who review your submission.
>
> Your question is like asking whether there are any undocumented 
> requirements for acceptance of a paper in a journal.? Of course there 
> are!
>
> What you should do is aim for perfection in what you submit.? If you 
> can spot problems, fix them before you submit.? Documenting examples 
> is an obvious case where the example is likely to be improved with 
> better commenting.
>
> Example code for non-exported functions seems to miss the point. If a 
> user can't count on the interface for those functions remaining 
> unchanged, why document it in a user-visible place?? Put those kinds 
> of docs as comments in the source code.? Or if they can count on the 
> interface, then they should be exported functions.? You can test them 
> using ::: if you want tests.
>
> There are no functions without return values.? Sometimes the return 
> value is an invisible NULL, but there is always a return value.? The 
> fact that some base packages don't document this is a deficiency in 
> that documentation, not an excuse for having a deficiency in your 
> documentation.
>
> Duncan Murdoch


From greg @end|ng |rom ||rm@n@y@h@com  Tue Sep 13 02:30:41 2022
From: greg @end|ng |rom ||rm@n@y@h@com (Greg Hunt)
Date: Tue, 13 Sep 2022 10:30:41 +1000
Subject: [R-pkg-devel] Undocumented requirement for CRAN
In-Reply-To: <1cbf20d2-9214-f79b-e570-4205fc684359@gmail.com>
References: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>
 <bf6d78cd-7a19-bc5d-d39e-cc098c256fc0@gmail.com>
 <1cbf20d2-9214-f79b-e570-4205fc684359@gmail.com>
Message-ID: <CAAS8PA+8HA61Zx3N-wwx5kqiTGn4fgntQ2=2J8_LsFsGRxA_rg@mail.gmail.com>

These aren't requirements of the language, they are issues of code and
documentation quality.  Other languages have exactly the same issues and no
code audit tool I've ever seen provides 100% coverage of potential issues.
There is always a level of human intelligence applied to effective code
review (I do know you can do code review without involving people but that
tends in practice to be fairly basic).  The CRAN process, human checking on
initial submission and a bit less on the later submissions seems like a
good balance of complexity and development effort.

Things like enforcing documentation of return values would require package
standards to be tightened.  That would cause problems for existing packages
and I don't think that there is specific markup for a return value anyway,
so detecting missing return value documentation either requires changes to
the underlying Rd markup, a bunch more intelligence in the check, or human
inspection.

The moment you document a function and explain how to get to it you have
committed to dealing with what happens when you change it.  Regardless of
whether its described as internal or publicly visible, people will use it
and they will get annoyed when you change it or when it is broken (which
may not matter to the internal use in the package but may be visible in
edge cases from outside).  If they have to go digging to find and
understand the internal interfaces its much clearer to them that they are
on their own.  Looked at another way, if the external interface is complete
then people don't need the internal interfaces.  If its incomplete then
thats an interface design problem.  I have seen distinction made between
general use programming interfaces and product (or release) sensitive
programming interfaces, but they come with statements about how they are
likely to change and what limited purposes they can be used for.  Thats a
more bureaucratic approach than R developers are likely to engage with.

Greg

On Tue, 13 Sept 2022 at 09:46, Ji?? Moravec <jiri.c.moravec at gmail.com>
wrote:

> For experienced R developer like you, certain things might seem obvious
> without the need of any documentation.
>
> But please understand that other languages do not have such requirements.
> So for new people, or people coming from different languages, this might
> not seem as obvious as it is for you.
>
> R already has a capability to do automated checking of packages to
> enforce certain level of quality.
>  From this perspective, at least to me, it doesn't make sense that some
> issues are automatically flagged,
> while other issues, which might be on the same or lower level of
> complexity, are not.
> (also, packages are not journal articles)
>
> Same with documentation, I can't spot and fix an issue, if I am not even
> aware that it is an issue.
>
>
>  > If a user can't count on the interface for those functions remaining
> unchanged, why document it in a user-visible place?
>
> Why not? Even unexported functions are user-visible through ::: . Since
> they are already documented, I might as well produce full documentation
> that is checked during `R CMD check`.
> Isn't one of the R's advantage the ability to read code of any function
> without wading through the source files?
>
>  > The fact that some base packages don't document this is a deficiency
> in that documentation, not an excuse for having a deficiency in your
> documentation.
>
> That is good to know. I certainly know it now after having to fix this
> issue in my package. But how I am was supposed to know about it when
> this problem is not documented, `R CMD check` doesn't flag it, and
> official documentation uses it?
>
>
> -- Jirka
>
> On 9/13/22 11:19, Duncan Murdoch wrote:
> > On 12/09/2022 6:42 p.m., Ji?? Moravec wrote:
> >> There are quite a lot of undocumented requirement for CRAN.
> >> This bite me several times already.
> >>
> >> They are not documented in the
> >> https://cran.r-project.org/doc/manuals/R-exts.html
> >> Nor they are marked by `R CMD check`
> >>
> >> Ideally, these would be documented AND flagged by R CMD check.
> >> Otherwise, it is a waste of time for both CRAN team and package
> >> developers.
> >>
> >> So far, the undocumented requirements that were flagged for me are:
> >>
> >> * Documenting return value even for functions without return value
> >>     -- This is even contrary to the base code (i.e., many graphical
> >> functions do not document return values)
> >>
> >> * Commented code in examples
> >>
> >> * Examples for non-exported internal functions
> >>     -- I understand that this is related to the fact that any ::: is
> >> highly discouraged (which is documented) and that examples for
> >> unexported functions cannot be run without ::: .
> >>        But I like the idea of using properly documented internal
> >> functions and usage of examples as for rudimentary testing.
> >>
> >>
> >> Are there any other undocumented requirements?
> >
> > Of course there are.  CRAN is not an automaton, it is a group of
> > people who review your submission.
> >
> > Your question is like asking whether there are any undocumented
> > requirements for acceptance of a paper in a journal.  Of course there
> > are!
> >
> > What you should do is aim for perfection in what you submit.  If you
> > can spot problems, fix them before you submit.  Documenting examples
> > is an obvious case where the example is likely to be improved with
> > better commenting.
> >
> > Example code for non-exported functions seems to miss the point. If a
> > user can't count on the interface for those functions remaining
> > unchanged, why document it in a user-visible place?  Put those kinds
> > of docs as comments in the source code.  Or if they can count on the
> > interface, then they should be exported functions.  You can test them
> > using ::: if you want tests.
> >
> > There are no functions without return values.  Sometimes the return
> > value is an invisible NULL, but there is always a return value.  The
> > fact that some base packages don't document this is a deficiency in
> > that documentation, not an excuse for having a deficiency in your
> > documentation.
> >
> > Duncan Murdoch
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From hugo@gruso@+R m@iii@g oii @orm@iesup@org  Tue Sep 13 09:11:36 2022
From: hugo@gruso@+R m@iii@g oii @orm@iesup@org (hugo@gruso@+R m@iii@g oii @orm@iesup@org)
Date: Tue, 13 Sep 2022 09:11:36 +0200
Subject: [R-pkg-devel] Undocumented requirement for CRAN
In-Reply-To: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>
References: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>
Message-ID: <6f57ec0d-3be4-5fe1-34ea-aa353330341d@normalesup.org>

Dear Jirka,

You can find such lists in community efforts such as:

- The rOpenSci devguide: 
https://devguide.ropensci.org/building.html#crangotchas

- The "prepare-for-cran" repo from ThinkR: 
https://github.com/ThinkR-open/prepare-for-cran

(Note that some of these tips might be slightly out-of-date in the sense 
that R CMD check now includes tests for them. The recommendations are 
still valid though.)

You may also find useful to follow the checklist produced by 
usethis::use_release_issue() to prepare your release.

Hope this helps!

Hugo


On 13/09/2022 00:42, Ji?? Moravec wrote:
> There are quite a lot of undocumented requirement for CRAN.
> This bite me several times already.
> 
> They are not documented in the 
> https://cran.r-project.org/doc/manuals/R-exts.html
> Nor they are marked by `R CMD check`
> 
> Ideally, these would be documented AND flagged by R CMD check.
> Otherwise, it is a waste of time for both CRAN team and package developers.
> 
> So far, the undocumented requirements that were flagged for me are:
> 
> * Documenting return value even for functions without return value
>  ? -- This is even contrary to the base code (i.e., many graphical 
> functions do not document return values)
> 
> * Commented code in examples
> 
> * Examples for non-exported internal functions
>  ? -- I understand that this is related to the fact that any ::: is 
> highly discouraged (which is documented) and that examples for 
> unexported functions cannot be run without ::: .
>  ???? But I like the idea of using properly documented internal 
> functions and usage of examples as for rudimentary testing.
> 
> 
> Are there any other undocumented requirements?
> 
> (we could maybe create PR for `.check_packages*` so that these problems 
> are flagged by `R CMD check`)
> 
> -- Jirka
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Sep 13 11:19:00 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 13 Sep 2022 05:19:00 -0400
Subject: [R-pkg-devel] Undocumented requirement for CRAN
In-Reply-To: <1cbf20d2-9214-f79b-e570-4205fc684359@gmail.com>
References: <3a71654e-6b41-fde8-7b76-a3038a77b090@gmail.com>
 <bf6d78cd-7a19-bc5d-d39e-cc098c256fc0@gmail.com>
 <1cbf20d2-9214-f79b-e570-4205fc684359@gmail.com>
Message-ID: <a02dc1d9-40b6-7ea8-f3b4-289b4f5187b1@gmail.com>

On 12/09/2022 7:45 p.m., Ji?? Moravec wrote:
> For experienced R developer like you, certain things might seem obvious
> without the need of any documentation.
> 
> But please understand that other languages do not have such requirements.
> So for new people, or people coming from different languages, this might
> not seem as obvious as it is for you.

As Greg said, this isn't a language requirement.  It's a publication 
requirement.  You are free to ignore it if you don't want to publish 
your package on CRAN.

> R already has a capability to do automated checking of packages to
> enforce certain level of quality.
>   From this perspective, at least to me, it doesn't make sense that some
> issues are automatically flagged,
> while other issues, which might be on the same or lower level of
> complexity, are not.

The way this happens is that some packages (e.g. base packages, as you 
saw) are published before it is realized that something is actually a 
problem.  To add the test will then trigger work for all those package 
authors to deal with it, and trigger work at CRAN to inform them and 
deal with the fallout from the authors who are slow to respond, or from 
authors who complain that the issue wasn't flagged in earlier versions 
of the tests.  The ability to carry out this work is finite, so not all 
possible tests are implemented instantly.

On the other hand, new submissions get manual examination, and so more 
stringent tests are possible.

> (also, packages are not journal articles)

Obviously there are big differences, but the general concept of 
requiring a certain level of quality applies to both.

> Same with documentation, I can't spot and fix an issue, if I am not even
> aware that it is an issue.

You are now aware of it.

Duncan Murdoch
> 
>   > If a user can't count on the interface for those functions remaining
> unchanged, why document it in a user-visible place?
> 
> Why not? Even unexported functions are user-visible through ::: . Since
> they are already documented, I might as well produce full documentation
> that is checked during `R CMD check`.
> Isn't one of the R's advantage the ability to read code of any function
> without wading through the source files?
> 
>   > The fact that some base packages don't document this is a deficiency
> in that documentation, not an excuse for having a deficiency in your
> documentation.
> 
> That is good to know. I certainly know it now after having to fix this
> issue in my package. But how I am was supposed to know about it when
> this problem is not documented, `R CMD check` doesn't flag it, and
> official documentation uses it?
> 
> 
> -- Jirka
> 
> On 9/13/22 11:19, Duncan Murdoch wrote:
>> On 12/09/2022 6:42 p.m., Ji?? Moravec wrote:
>>> There are quite a lot of undocumented requirement for CRAN.
>>> This bite me several times already.
>>>
>>> They are not documented in the
>>> https://cran.r-project.org/doc/manuals/R-exts.html
>>> Nor they are marked by `R CMD check`
>>>
>>> Ideally, these would be documented AND flagged by R CMD check.
>>> Otherwise, it is a waste of time for both CRAN team and package
>>> developers.
>>>
>>> So far, the undocumented requirements that were flagged for me are:
>>>
>>> * Documenting return value even for functions without return value
>>>  ? ? -- This is even contrary to the base code (i.e., many graphical
>>> functions do not document return values)
>>>
>>> * Commented code in examples
>>>
>>> * Examples for non-exported internal functions
>>>  ? ? -- I understand that this is related to the fact that any ::: is
>>> highly discouraged (which is documented) and that examples for
>>> unexported functions cannot be run without ::: .
>>>  ? ???? But I like the idea of using properly documented internal
>>> functions and usage of examples as for rudimentary testing.
>>>
>>>
>>> Are there any other undocumented requirements?
>>
>> Of course there are.? CRAN is not an automaton, it is a group of
>> people who review your submission.
>>
>> Your question is like asking whether there are any undocumented
>> requirements for acceptance of a paper in a journal.? Of course there
>> are!
>>
>> What you should do is aim for perfection in what you submit.? If you
>> can spot problems, fix them before you submit.? Documenting examples
>> is an obvious case where the example is likely to be improved with
>> better commenting.
>>
>> Example code for non-exported functions seems to miss the point. If a
>> user can't count on the interface for those functions remaining
>> unchanged, why document it in a user-visible place?? Put those kinds
>> of docs as comments in the source code.? Or if they can count on the
>> interface, then they should be exported functions.? You can test them
>> using ::: if you want tests.
>>
>> There are no functions without return values.? Sometimes the return
>> value is an invisible NULL, but there is always a return value.? The
>> fact that some base packages don't document this is a deficiency in
>> that documentation, not an excuse for having a deficiency in your
>> documentation.
>>
>> Duncan Murdoch


From F|or|@nSchwend|nger @end|ng |rom gmx@@t  Tue Sep 13 13:14:34 2022
From: F|or|@nSchwend|nger @end|ng |rom gmx@@t (Florian Schwendinger)
Date: Tue, 13 Sep 2022 13:14:34 +0200
Subject: [R-pkg-devel] windows i386
References: <trinity-0cc11150-2256-4a44-8c4f-03621ce6b847-1662838897962@3c-app-gmx-bs14>
Message-ID: <trinity-7de81137-380d-46a3-adb6-198126558649-1663067674244@3c-app-gmx-bap62>

Dear R-package-developers,

On 'r-oldrel-windows-ix86_x86_64' I get in 'check.log' the error message
"Error: package 'highs' is not installed for 'arch = i386'"
the statement that for arch = i386 the package is not installed is correct and expected,
since in 'install.out' I see the warning
"Warning: this package has a non-empty 'configure.win' file, so building only the main architecture"

Looking at r-package-devel archive, I found the suggestion to set Biarch TRUE in the DESCRIPTION file.
I don't want to force the build of "i386" by setting Biarch: TRUE,
since as far as I see from the source I link to this should not work and I don't want
to alter the library I link to as little as possible.
Therefore, I want skip the step "loading checks for arch 'i386'". Is this possible?

I know locally this can be resolved by adding the option '--no-multiarch',
but can a similar effect be accomplished at the CRAN checks?
Furthermore, I know I can could this issue by adding R >= 4.2 to the depends since Rtools 4.2
does not build for i386. But this does not seem like a nice fix.

Is there a better option and how would it work?

Best regards,
Florian


