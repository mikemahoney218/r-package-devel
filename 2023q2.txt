From kev|n@r@coombe@ @end|ng |rom gm@||@com  Sat Apr  1 23:03:28 2023
From: kev|n@r@coombe@ @end|ng |rom gm@||@com (Kevin R. Coombes)
Date: Sat, 1 Apr 2023 17:03:28 -0400
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
Message-ID: <2ea294cc-1b19-fc91-0007-6d1a60ef3ca2@gmail.com>

1. Yes, remove the "lazyData" line from the DESCRIPTION file.

2. Do you have "stats" in the "Imports" line in the DESCRIPTION file? If 
not, put it in along with the "importFrom" line in the NAMESPACE file.

On 3/31/2023 4:51 PM, Dennis Boos wrote:
> Recently I got a message from CRAN that my package Monte.Carlo.se (on CRAN
> for the last few years) does not pass current testing.  There seemed to be
> 2 problems:
>
> ***************************************************************************************************************
>
> 1. * checking LazyData ... NOTE
>    'LazyData' is specified without a 'data' directory
>
> I have this line in my DESCRIPTION file:
>
> LazyData: true
>
> Should I remove that?
>
> *****************************************************************************************************************
>
> 2. * checking examples with --run-donttest ... [42s/42s] ERROR
> Running examples in ?Monte.Carlo.se-Ex.R? failed
> The error most likely occurred in:
>
>> pairwise.se(hold,xcol=10:12,summary.f=cv)
> Error: object 'hold' not found
> Execution halted
>
> ***************************************************************************************
>
> So, I put in the R code to generate the data matrix *hold.  *But that
> brought a host of other errors when checking in Rstudio with
>
>> devtools::check("S:/Documents/srcis/a.projects/Monte.Carlo.isr.and.package/Monte.Carlo.se.March.2023")
> I started seeing the following list about standard functions like sd.
>
> N  checking R code for possible problems (3.4s)
>     boot.se: no visible global function definition for 'sd'
>     boot.var: no visible global function definition for 'var'
>     corr: no visible global function definition for 'cor'
>     cv: no visible global function definition for 'sd'
>     ratio.mean.sdhat.sd: no visible global function definition for 'sd'
>     ratio.mean.vhat.var: no visible global function definition for 'var'
>     ratio.sd: no visible global function definition for 'sd'
>     ratio.var: no visible global function definition for 'var'
>     varn: no visible global function definition for 'var'
>     Undefined global functions or variables:
>       cor sd var
>     Consider adding
>       importFrom("stats", "cor", "sd", "var")
>     to your NAMESPACE file.
>
> But you can't add those functions to NAMESPACE. Well I did but
>
> devtools::build()
>
>
> gets rid of it. Also, I keep getting the message in the Rstudio check
>
> WARNING
>     'qpdf' is needed for checks on size reduction of PDFs
>
>
> but I got the latest versions of R and Rstudio and was able to get
> qpdf to install and loaded with library(qpdf), but Rstudio still gives
> that message.
>
> So, if anybody has any suggestions, I would appreciate it.
>
> Thanks.
>
> Dennis
>
>
>
>
>
>
>
>
>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Apr  1 23:34:08 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 1 Apr 2023 17:34:08 -0400
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
Message-ID: <c6b52458-35c0-8ef4-93aa-d37c50769460@gmail.com>

On 31/03/2023 4:51 p.m., Dennis Boos wrote:
> Recently I got a message from CRAN that my package Monte.Carlo.se (on CRAN
> for the last few years) does not pass current testing.  There seemed to be
> 2 problems:
> 
> ***************************************************************************************************************
> 
> 1. * checking LazyData ... NOTE
>    'LazyData' is specified without a 'data' directory
> 
> I have this line in my DESCRIPTION file:
> 
> LazyData: true
> 
> Should I remove that?
> 
> *****************************************************************************************************************
> 
> 2. * checking examples with --run-donttest ... [42s/42s] ERROR
> Running examples in ?Monte.Carlo.se-Ex.R? failed
> The error most likely occurred in:
> 
>> pairwise.se(hold,xcol=10:12,summary.f=cv)
> Error: object 'hold' not found
> Execution halted
> 
> ***************************************************************************************
> 
> So, I put in the R code to generate the data matrix *hold.  *But that
> brought a host of other errors when checking in Rstudio with
> 
>> devtools::check("S:/Documents/srcis/a.projects/Monte.Carlo.isr.and.package/Monte.Carlo.se.March.2023")
> 
> I started seeing the following list about standard functions like sd.
> 
> N  checking R code for possible problems (3.4s)
>     boot.se: no visible global function definition for 'sd'
>     boot.var: no visible global function definition for 'var'
>     corr: no visible global function definition for 'cor'
>     cv: no visible global function definition for 'sd'
>     ratio.mean.sdhat.sd: no visible global function definition for 'sd'
>     ratio.mean.vhat.var: no visible global function definition for 'var'
>     ratio.sd: no visible global function definition for 'sd'
>     ratio.var: no visible global function definition for 'var'
>     varn: no visible global function definition for 'var'
>     Undefined global functions or variables:
>       cor sd var
>     Consider adding
>       importFrom("stats", "cor", "sd", "var")
>     to your NAMESPACE file.
> 
> But you can't add those functions to NAMESPACE. Well I did but
> 
> devtools::build()
> 
> 
> gets rid of it. Also, I keep getting the message in the Rstudio check
> 
> WARNING
>     'qpdf' is needed for checks on size reduction of PDFs
> 
> 
> but I got the latest versions of R and Rstudio and was able to get
> qpdf to install and loaded with library(qpdf), but Rstudio still gives
> that message.
> 

It sounds as though you're using Roxygen2 to generate your NAMESPACE 
file.  If so, you need @imports directives in the comments 
(conventionally before the function that uses the import, but I think it 
doesn't really matter where).

Duncan Murdoch


From murdoch@dunc@n @end|ng |rom gm@||@com  Sat Apr  1 23:36:50 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 1 Apr 2023 17:36:50 -0400
Subject: [R-pkg-devel] Vignette rebuilding failed
In-Reply-To: <CA+Rxh848cSvnnQ50CbiNr+dXagAx069hxPuGvNipHsvBWj2=8Q@mail.gmail.com>
References: <CA+Rxh848cSvnnQ50CbiNr+dXagAx069hxPuGvNipHsvBWj2=8Q@mail.gmail.com>
Message-ID: <f40b010f-25bc-a75c-151a-5e71d967cc1c@gmail.com>

The error message seems pretty clear:  "The function xfun::isFALSE() 
will be deprecated in the future. Please consider using base::isFALSE(x) 
or identical(x, FALSE) instead".

So don't use xfun::isFALSE().

Duncan Murdoch



On 31/03/2023 5:01 p.m., Deepankar Basu wrote:
> Hello All,
> 
> I am in the process of developing an R package (
> https://github.com/dbasu-umass/clptheory) and have encountered problems
> with the vignette.
> 
> I had initially been able to build the vignette but *after *I added a new
> function to my package, I have been  getting the error message that
> "Vignette rebuilding failed" when I use devtools:check().
> 
> If I use devtools:check(vignette=FALSE), there are no error messages. I can
> also compile the vignette with knitr.
> 
> Below is the output from devtools:check(vignette=FALSE)
>> devtools::check(vignettes = FALSE)
> ?? Documenting
> ?????????????????????????????????????????????????????????????????????????????????????????????
> ? Updating clptheory documentation
> ? Loading clptheory
> 
> ?? Building
> ????????????????????????????????????????????????????????????????????????????????????????????????
> Setting env vars:
> ? CFLAGS    : -Wall -pedantic -fdiagnostics-color=always
> ? CXXFLAGS  : -Wall -pedantic -fdiagnostics-color=always
> ? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ?? R CMD build
> ?????????????????????????????????????????????????????????????????????????????????????????????
> ?  checking for file ?/home/basu15/MyRProjects/clptheory/DESCRIPTION? ...
> ?  preparing ?clptheory?:
> ?  checking DESCRIPTION meta-information ...
> ?  checking for LF line-endings in source and make files and shell scripts
> ?  checking for empty or unneeded directories
> ?  building ?clptheory_0.0.0.9000.tar.gz?
> 
> ?? Checking
> ????????????????????????????????????????????????????????????????????????????????????????????????
> Setting env vars:
> ? _R_CHECK_CRAN_INCOMING_USE_ASPELL_           : TRUE
> ? _R_CHECK_CRAN_INCOMING_REMOTE_               : FALSE
> ? _R_CHECK_CRAN_INCOMING_                      : FALSE
> ? _R_CHECK_FORCE_SUGGESTS_                     : FALSE
> ? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE
> ? NOT_CRAN                                     : true
> ?? R CMD check
> ?????????????????????????????????????????????????????????????????????????????????????????????
> ?  using log directory ?/tmp/RtmpCSbZbZ/file3f721a56f9d0/clptheory.Rcheck?
> ?  using R version 4.2.3 (2023-03-15)
> ?  using platform: x86_64-pc-linux-gnu (64-bit)
> ?  using session charset: UTF-8
> ?  using options ?--no-manual --ignore-vignettes --as-cran?
> ?  checking for file ?clptheory/DESCRIPTION?
> ?  this is package ?clptheory? version ?0.0.0.9000?
> ?  package encoding: UTF-8
> ?  checking package namespace information
> ?  checking package dependencies (2.5s)
> ?  checking if this is a source package ...
> ?  checking if there is a namespace
> ?  checking for executable files ...
> ?  checking for hidden files and directories ...
> ?  checking for portable file names
> ?  checking for sufficient/correct file permissions
> ?  checking serialization versions ...
> ?  checking whether package ?clptheory? can be installed (7.1s)
> ?  checking installed package size
> ?  checking package directory ...
> ?  checking for future file timestamps ...
> ?  checking DESCRIPTION meta-information ...
> ?  checking top-level files ...
> ?  checking for left-over files
> ?  checking index information
> ?  checking package subdirectories ...
> ?  checking R files for non-ASCII characters ...
> ?  checking R files for syntax errors ...
> ?  checking whether the package can be loaded (1.8s)
> ?  checking whether the package can be loaded with stated dependencies
> (1.6s)
> ?  checking whether the package can be unloaded cleanly (1.6s)
> ?  checking whether the namespace can be loaded with stated dependencies
> (1.6s)
> ?  checking whether the namespace can be unloaded cleanly (1.8s)
> ?  checking loading without being on the library search path (1.8s)
> ?  checking dependencies in R code (1.7s)
> ?  checking S3 generic/method consistency (2.4s)
> ?  checking replacement functions (1.7s)
> ?  checking foreign function calls (1.7s)
> ?  checking R code for possible problems (9.5s)
> ?  checking Rd files ...
> ?  checking Rd metadata ...
> ?  checking Rd line widths ...
> ?  checking Rd cross-references ...
> ?  checking for missing documentation entries (1.7s)
> ?  checking for code/documentation mismatches (5.1s)
> ?  checking Rd \usage sections (2.5s)
> ?  checking Rd contents ...
> ?  checking for unstated dependencies in examples ...
> ?  checking contents of ?data? directory ...
> ?  checking data for non-ASCII characters (413ms)
> ?  checking LazyData
> ?  checking data for ASCII and uncompressed saves ...
> ?  checking files in ?vignettes? ... SKIPPED
> ?  checking examples (4.9s)
> ?  checking for non-standard things in the check directory
> ?  checking for detritus in the temp directory
> 
> 
> ?? R CMD check results
> ??????????????????????????????????????????????????????????? clptheory
> 0.0.0.9000 ????
> Duration: 55.1s
> 
> 0 errors ? | 0 warnings ? | 0 notes ?
> 
> Below is the output form devtools:check()
> 
>> devtools::check()
> ?? Documenting
> ?????????????????????????????????????????????????????????????????????????????????????????????
> ? Updating clptheory documentation
> ? Loading clptheory
> 
> ?? Building
> ????????????????????????????????????????????????????????????????????????????????????????????????
> Setting env vars:
> ? CFLAGS    : -Wall -pedantic -fdiagnostics-color=always
> ? CXXFLAGS  : -Wall -pedantic -fdiagnostics-color=always
> ? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always
> ?? R CMD build
> ?????????????????????????????????????????????????????????????????????????????????????????????
> ?  checking for file ?/home/basu15/MyRProjects/clptheory/DESCRIPTION? ...
> ?  preparing ?clptheory?:
> ?  checking DESCRIPTION meta-information ...
> ?  installing the package to build vignettes
> ?  creating vignettes (9.9s)
> ?  checking for LF line-endings in source and make files and shell scripts
> ?  checking for empty or unneeded directories
> ?  building ?clptheory_0.0.0.9000.tar.gz?
> 
> ?? Checking
> ????????????????????????????????????????????????????????????????????????????????????????????????
> Setting env vars:
> ? _R_CHECK_CRAN_INCOMING_USE_ASPELL_           : TRUE
> ? _R_CHECK_CRAN_INCOMING_REMOTE_               : FALSE
> ? _R_CHECK_CRAN_INCOMING_                      : FALSE
> ? _R_CHECK_FORCE_SUGGESTS_                     : FALSE
> ? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE
> ? NOT_CRAN                                     : true
> ?? R CMD check
> ?????????????????????????????????????????????????????????????????????????????????????????????
> ?  using log directory ?/tmp/RtmpCSbZbZ/file3f72577bb739/clptheory.Rcheck?
> ?  using R version 4.2.3 (2023-03-15)
> ?  using platform: x86_64-pc-linux-gnu (64-bit)
> ?  using session charset: UTF-8
> ?  using options ?--no-manual --as-cran?
> ?  checking for file ?clptheory/DESCRIPTION?
> ?  this is package ?clptheory? version ?0.0.0.9000?
> ?  package encoding: UTF-8
> ?  checking package namespace information
> ?  checking package dependencies (2.9s)
> ?  checking if this is a source package ...
> ?  checking if there is a namespace
> ?  checking for executable files ...
> ?  checking for hidden files and directories ...
> ?  checking for portable file names
> ?  checking for sufficient/correct file permissions
> ?  checking serialization versions ...
> ?  checking whether package ?clptheory? can be installed (7.6s)
> ?  checking installed package size ...
> ?  checking package directory
> ?  checking for future file timestamps ...
> ?  checking ?build? directory ...
> ?  checking DESCRIPTION meta-information ...
> ?  checking top-level files ...
> ?  checking for left-over files
> ?  checking index information ...
> ?  checking package subdirectories ...
> ?  checking R files for non-ASCII characters ...
> ?  checking R files for syntax errors ...
> ?  checking whether the package can be loaded (2s)
> ?  checking whether the package can be loaded with stated dependencies
> (1.8s)
> ?  checking whether the package can be unloaded cleanly (1.7s)
> ?  checking whether the namespace can be loaded with stated dependencies
> (1.8s)
> ?  checking whether the namespace can be unloaded cleanly (1.8s)
> ?  checking loading without being on the library search path (1.8s)
> ?  checking dependencies in R code (1.7s)
> ?  checking S3 generic/method consistency (2.3s)
> ?  checking replacement functions (1.6s)
> ?  checking foreign function calls (1.7s)
> ?  checking R code for possible problems (10s)
> ?  checking Rd files (367ms)
> ?  checking Rd metadata ...
> ?  checking Rd line widths ...
> ?  checking Rd cross-references ...
> ?  checking for missing documentation entries (2.1s)
> ?  checking for code/documentation mismatches (8.9s)
> ?  checking Rd \usage sections (3.3s)
> ?  checking Rd contents ...
> ?  checking for unstated dependencies in examples ...
> ?  checking contents of ?data? directory (335ms)
> ?  checking data for non-ASCII characters (584ms)
> ?  checking LazyData
> ?  checking data for ASCII and uncompressed saves (535ms)
> ?  checking installed files from ?inst/doc?
> ?  checking files in ?vignettes?
> ?  checking examples (6.9s)
> ?  checking for unstated dependencies in vignettes ...
> ?  checking package vignettes in ?inst/doc?
> E  checking re-building of vignette outputs (594ms)
>     Error(s) in re-building vignettes:
>       ...
>     --- re-building ?lvpp.Rmd? using rmarkdown
>     Quitting from lines 11-15 (lvpp.Rmd)
>     Error: processing vignette 'lvpp.Rmd' failed with diagnostics:
>     The function xfun::isFALSE() will be deprecated in the future. Please
> consider using base::isFALSE(x) or identical(x, FALSE) instead.
>     --- failed re-building ?lvpp.Rmd?
> 
>     SUMMARY: processing the following file failed:
>       ?lvpp.Rmd?
> 
>     Error: Vignette re-building failed.
>     Execution halted
> 
> ?  checking for non-standard things in the check directory
> ?  checking for detritus in the temp directory
> 
>     See
>       ?/tmp/RtmpCSbZbZ/file3f72577bb739/clptheory.Rcheck/00check.log?
>     for details.
> 
> 
> ?? R CMD check results
> ??????????????????????????????????????????????????????????? clptheory
> 0.0.0.9000 ????
> Duration: 1m 6.2s
> 
> ? checking re-building of vignette outputs ... ERROR
>    Error(s) in re-building vignettes:
>      ...
>    --- re-building ?lvpp.Rmd? using rmarkdown
>    Quitting from lines 11-15 (lvpp.Rmd)
>    Error: processing vignette 'lvpp.Rmd' failed with diagnostics:
>    The function xfun::isFALSE() will be deprecated in the future. Please
> consider using base::isFALSE(x) or identical(x, FALSE) instead.
>    --- failed re-building ?lvpp.Rmd?
> 
>    SUMMARY: processing the following file failed:
>      ?lvpp.Rmd?
> 
>    Error: Vignette re-building failed.
>    Execution halted
> 
> 1 error ? | 0 warnings ? | 0 notes ?
> 
> My package is available here: https://github.com/dbasu-umass/clptheory
> 
> Any help will be appreciated. (I found a few pages like this
> <https://github.com/r-lib/devtools/issues/2140> on this problem but the
> issue does not seem to have been resolved).
> 
> Thank you.
> DB
> 
>


From @hot@och|1990 @end|ng |rom gm@||@com  Sun Apr  2 00:42:38 2023
From: @hot@och|1990 @end|ng |rom gm@||@com (Shota Ochi)
Date: Sun, 2 Apr 2023 07:42:38 +0900
Subject: [R-pkg-devel] Vignette rebuilding failed
In-Reply-To: <f40b010f-25bc-a75c-151a-5e71d967cc1c@gmail.com>
References: <CA+Rxh848cSvnnQ50CbiNr+dXagAx069hxPuGvNipHsvBWj2=8Q@mail.gmail.com>
 <f40b010f-25bc-a75c-151a-5e71d967cc1c@gmail.com>
Message-ID: <CANOYX1RYgVM_hBiSZwJS+HXah0FE+5gpzVqszPXJKQgycyGapQ@mail.gmail.com>

>  Error(s) in re-building vignettes:
>    ...
>  --- re-building ?lvpp.Rmd? using rmarkdown
>  Quitting from lines 11-15 (lvpp.Rmd)
>  Error: processing vignette 'lvpp.Rmd' failed with diagnostics:
>  The function xfun::isFALSE() will be deprecated in the future. Please
>consider using base::isFALSE(x) or identical(x, FALSE) instead.
>  --- failed re-building ?lvpp.Rmd?

The error message means a function (knitr::opts_chunk$set) called
xfun::isFALSE() in lines 11-15 (lvpp.Rmd).
However, knitr::opts_chunk$set stopped using xfun::isFALSE().
See the commit shown below.
https://github.com/yihui/knitr/commit/ccb07c4c2266666f7375e5df242103672bd629ac

Updating knitr package should fix the error.

I tested your package on my Ubuntu machine and
got no error even after removing vignettes from .Rbuildignore.
I believe the cause of the error is not your package but your environment.

Best,
Shota Ochi


2023?4?2?(?) 6:44 Duncan Murdoch <murdoch.duncan at gmail.com>:

> The error message seems pretty clear:  "The function xfun::isFALSE()
> will be deprecated in the future. Please consider using base::isFALSE(x)
> or identical(x, FALSE) instead".
>
> So don't use xfun::isFALSE().
>
> Duncan Murdoch
>
>
>
> On 31/03/2023 5:01 p.m., Deepankar Basu wrote:
> > Hello All,
> >
> > I am in the process of developing an R package (
> > https://github.com/dbasu-umass/clptheory) and have encountered problems
> > with the vignette.
> >
> > I had initially been able to build the vignette but *after *I added a new
> > function to my package, I have been  getting the error message that
> > "Vignette rebuilding failed" when I use devtools:check().
> >
> > If I use devtools:check(vignette=FALSE), there are no error messages. I
> can
> > also compile the vignette with knitr.
> >
> > Below is the output from devtools:check(vignette=FALSE)
> >> devtools::check(vignettes = FALSE)
> > ?? Documenting
> >
> ?????????????????????????????????????????????????????????????????????????????????????????????
> > ? Updating clptheory documentation
> > ? Loading clptheory
> >
> > ?? Building
> >
> ????????????????????????????????????????????????????????????????????????????????????????????????
> > Setting env vars:
> > ? CFLAGS    : -Wall -pedantic -fdiagnostics-color=always
> > ? CXXFLAGS  : -Wall -pedantic -fdiagnostics-color=always
> > ? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ?? R CMD build
> >
> ?????????????????????????????????????????????????????????????????????????????????????????????
> > ?  checking for file ?/home/basu15/MyRProjects/clptheory/DESCRIPTION? ...
> > ?  preparing ?clptheory?:
> > ?  checking DESCRIPTION meta-information ...
> > ?  checking for LF line-endings in source and make files and shell
> scripts
> > ?  checking for empty or unneeded directories
> > ?  building ?clptheory_0.0.0.9000.tar.gz?
> >
> > ?? Checking
> >
> ????????????????????????????????????????????????????????????????????????????????????????????????
> > Setting env vars:
> > ? _R_CHECK_CRAN_INCOMING_USE_ASPELL_           : TRUE
> > ? _R_CHECK_CRAN_INCOMING_REMOTE_               : FALSE
> > ? _R_CHECK_CRAN_INCOMING_                      : FALSE
> > ? _R_CHECK_FORCE_SUGGESTS_                     : FALSE
> > ? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE
> > ? NOT_CRAN                                     : true
> > ?? R CMD check
> >
> ?????????????????????????????????????????????????????????????????????????????????????????????
> > ?  using log directory
> ?/tmp/RtmpCSbZbZ/file3f721a56f9d0/clptheory.Rcheck?
> > ?  using R version 4.2.3 (2023-03-15)
> > ?  using platform: x86_64-pc-linux-gnu (64-bit)
> > ?  using session charset: UTF-8
> > ?  using options ?--no-manual --ignore-vignettes --as-cran?
> > ?  checking for file ?clptheory/DESCRIPTION?
> > ?  this is package ?clptheory? version ?0.0.0.9000?
> > ?  package encoding: UTF-8
> > ?  checking package namespace information
> > ?  checking package dependencies (2.5s)
> > ?  checking if this is a source package ...
> > ?  checking if there is a namespace
> > ?  checking for executable files ...
> > ?  checking for hidden files and directories ...
> > ?  checking for portable file names
> > ?  checking for sufficient/correct file permissions
> > ?  checking serialization versions ...
> > ?  checking whether package ?clptheory? can be installed (7.1s)
> > ?  checking installed package size
> > ?  checking package directory ...
> > ?  checking for future file timestamps ...
> > ?  checking DESCRIPTION meta-information ...
> > ?  checking top-level files ...
> > ?  checking for left-over files
> > ?  checking index information
> > ?  checking package subdirectories ...
> > ?  checking R files for non-ASCII characters ...
> > ?  checking R files for syntax errors ...
> > ?  checking whether the package can be loaded (1.8s)
> > ?  checking whether the package can be loaded with stated dependencies
> > (1.6s)
> > ?  checking whether the package can be unloaded cleanly (1.6s)
> > ?  checking whether the namespace can be loaded with stated dependencies
> > (1.6s)
> > ?  checking whether the namespace can be unloaded cleanly (1.8s)
> > ?  checking loading without being on the library search path (1.8s)
> > ?  checking dependencies in R code (1.7s)
> > ?  checking S3 generic/method consistency (2.4s)
> > ?  checking replacement functions (1.7s)
> > ?  checking foreign function calls (1.7s)
> > ?  checking R code for possible problems (9.5s)
> > ?  checking Rd files ...
> > ?  checking Rd metadata ...
> > ?  checking Rd line widths ...
> > ?  checking Rd cross-references ...
> > ?  checking for missing documentation entries (1.7s)
> > ?  checking for code/documentation mismatches (5.1s)
> > ?  checking Rd \usage sections (2.5s)
> > ?  checking Rd contents ...
> > ?  checking for unstated dependencies in examples ...
> > ?  checking contents of ?data? directory ...
> > ?  checking data for non-ASCII characters (413ms)
> > ?  checking LazyData
> > ?  checking data for ASCII and uncompressed saves ...
> > ?  checking files in ?vignettes? ... SKIPPED
> > ?  checking examples (4.9s)
> > ?  checking for non-standard things in the check directory
> > ?  checking for detritus in the temp directory
> >
> >
> > ?? R CMD check results
> > ??????????????????????????????????????????????????????????? clptheory
> > 0.0.0.9000 ????
> > Duration: 55.1s
> >
> > 0 errors ? | 0 warnings ? | 0 notes ?
> >
> > Below is the output form devtools:check()
> >
> >> devtools::check()
> > ?? Documenting
> >
> ?????????????????????????????????????????????????????????????????????????????????????????????
> > ? Updating clptheory documentation
> > ? Loading clptheory
> >
> > ?? Building
> >
> ????????????????????????????????????????????????????????????????????????????????????????????????
> > Setting env vars:
> > ? CFLAGS    : -Wall -pedantic -fdiagnostics-color=always
> > ? CXXFLAGS  : -Wall -pedantic -fdiagnostics-color=always
> > ? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always
> > ?? R CMD build
> >
> ?????????????????????????????????????????????????????????????????????????????????????????????
> > ?  checking for file ?/home/basu15/MyRProjects/clptheory/DESCRIPTION? ...
> > ?  preparing ?clptheory?:
> > ?  checking DESCRIPTION meta-information ...
> > ?  installing the package to build vignettes
> > ?  creating vignettes (9.9s)
> > ?  checking for LF line-endings in source and make files and shell
> scripts
> > ?  checking for empty or unneeded directories
> > ?  building ?clptheory_0.0.0.9000.tar.gz?
> >
> > ?? Checking
> >
> ????????????????????????????????????????????????????????????????????????????????????????????????
> > Setting env vars:
> > ? _R_CHECK_CRAN_INCOMING_USE_ASPELL_           : TRUE
> > ? _R_CHECK_CRAN_INCOMING_REMOTE_               : FALSE
> > ? _R_CHECK_CRAN_INCOMING_                      : FALSE
> > ? _R_CHECK_FORCE_SUGGESTS_                     : FALSE
> > ? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE
> > ? NOT_CRAN                                     : true
> > ?? R CMD check
> >
> ?????????????????????????????????????????????????????????????????????????????????????????????
> > ?  using log directory
> ?/tmp/RtmpCSbZbZ/file3f72577bb739/clptheory.Rcheck?
> > ?  using R version 4.2.3 (2023-03-15)
> > ?  using platform: x86_64-pc-linux-gnu (64-bit)
> > ?  using session charset: UTF-8
> > ?  using options ?--no-manual --as-cran?
> > ?  checking for file ?clptheory/DESCRIPTION?
> > ?  this is package ?clptheory? version ?0.0.0.9000?
> > ?  package encoding: UTF-8
> > ?  checking package namespace information
> > ?  checking package dependencies (2.9s)
> > ?  checking if this is a source package ...
> > ?  checking if there is a namespace
> > ?  checking for executable files ...
> > ?  checking for hidden files and directories ...
> > ?  checking for portable file names
> > ?  checking for sufficient/correct file permissions
> > ?  checking serialization versions ...
> > ?  checking whether package ?clptheory? can be installed (7.6s)
> > ?  checking installed package size ...
> > ?  checking package directory
> > ?  checking for future file timestamps ...
> > ?  checking ?build? directory ...
> > ?  checking DESCRIPTION meta-information ...
> > ?  checking top-level files ...
> > ?  checking for left-over files
> > ?  checking index information ...
> > ?  checking package subdirectories ...
> > ?  checking R files for non-ASCII characters ...
> > ?  checking R files for syntax errors ...
> > ?  checking whether the package can be loaded (2s)
> > ?  checking whether the package can be loaded with stated dependencies
> > (1.8s)
> > ?  checking whether the package can be unloaded cleanly (1.7s)
> > ?  checking whether the namespace can be loaded with stated dependencies
> > (1.8s)
> > ?  checking whether the namespace can be unloaded cleanly (1.8s)
> > ?  checking loading without being on the library search path (1.8s)
> > ?  checking dependencies in R code (1.7s)
> > ?  checking S3 generic/method consistency (2.3s)
> > ?  checking replacement functions (1.6s)
> > ?  checking foreign function calls (1.7s)
> > ?  checking R code for possible problems (10s)
> > ?  checking Rd files (367ms)
> > ?  checking Rd metadata ...
> > ?  checking Rd line widths ...
> > ?  checking Rd cross-references ...
> > ?  checking for missing documentation entries (2.1s)
> > ?  checking for code/documentation mismatches (8.9s)
> > ?  checking Rd \usage sections (3.3s)
> > ?  checking Rd contents ...
> > ?  checking for unstated dependencies in examples ...
> > ?  checking contents of ?data? directory (335ms)
> > ?  checking data for non-ASCII characters (584ms)
> > ?  checking LazyData
> > ?  checking data for ASCII and uncompressed saves (535ms)
> > ?  checking installed files from ?inst/doc?
> > ?  checking files in ?vignettes?
> > ?  checking examples (6.9s)
> > ?  checking for unstated dependencies in vignettes ...
> > ?  checking package vignettes in ?inst/doc?
> > E  checking re-building of vignette outputs (594ms)
> >     Error(s) in re-building vignettes:
> >       ...
> >     --- re-building ?lvpp.Rmd? using rmarkdown
> >     Quitting from lines 11-15 (lvpp.Rmd)
> >     Error: processing vignette 'lvpp.Rmd' failed with diagnostics:
> >     The function xfun::isFALSE() will be deprecated in the future. Please
> > consider using base::isFALSE(x) or identical(x, FALSE) instead.
> >     --- failed re-building ?lvpp.Rmd?
> >
> >     SUMMARY: processing the following file failed:
> >       ?lvpp.Rmd?
> >
> >     Error: Vignette re-building failed.
> >     Execution halted
> >
> > ?  checking for non-standard things in the check directory
> > ?  checking for detritus in the temp directory
> >
> >     See
> >       ?/tmp/RtmpCSbZbZ/file3f72577bb739/clptheory.Rcheck/00check.log?
> >     for details.
> >
> >
> > ?? R CMD check results
> > ??????????????????????????????????????????????????????????? clptheory
> > 0.0.0.9000 ????
> > Duration: 1m 6.2s
> >
> > ? checking re-building of vignette outputs ... ERROR
> >    Error(s) in re-building vignettes:
> >      ...
> >    --- re-building ?lvpp.Rmd? using rmarkdown
> >    Quitting from lines 11-15 (lvpp.Rmd)
> >    Error: processing vignette 'lvpp.Rmd' failed with diagnostics:
> >    The function xfun::isFALSE() will be deprecated in the future. Please
> > consider using base::isFALSE(x) or identical(x, FALSE) instead.
> >    --- failed re-building ?lvpp.Rmd?
> >
> >    SUMMARY: processing the following file failed:
> >      ?lvpp.Rmd?
> >
> >    Error: Vignette re-building failed.
> >    Execution halted
> >
> > 1 error ? | 0 warnings ? | 0 notes ?
> >
> > My package is available here: https://github.com/dbasu-umass/clptheory
> >
> > Any help will be appreciated. (I found a few pages like this
> > <https://github.com/r-lib/devtools/issues/2140> on this problem but the
> > issue does not seem to have been resolved).
> >
> > Thank you.
> > DB
> >
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Sun Apr  2 07:37:44 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Sun, 2 Apr 2023 08:37:44 +0300
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
Message-ID: <20230402083744.2c1abeb7@Tarkus>

On Fri, 31 Mar 2023 16:51:40 -0400
Dennis Boos <boos at ncsu.edu> wrote:

> Also, I keep getting the message in the Rstudio check
> 
> WARNING
>    'qpdf' is needed for checks on size reduction of PDFs
> 
> 
> but I got the latest versions of R and Rstudio and was able to get
> qpdf to install and loaded with library(qpdf), but Rstudio still gives
> that message.

Almost there.

The 'qpdf' package interfaces to the same code that the 'qpdf' command
line tool uses to do its job. R CMD check uses the latter, not the
former. It looks like you're on Windows, so you need to install Rtools
in order to get a compatible version of 'qpdf':
https://cran.r-project.org/bin/windows/Rtools/rtools43/rtools.html

-- 
Best regards,
Ivan


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Sun Apr  2 12:12:39 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Sun, 2 Apr 2023 11:12:39 +0100
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <20230402083744.2c1abeb7@Tarkus>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
 <20230402083744.2c1abeb7@Tarkus>
Message-ID: <a91eb3b8-944b-0023-49bd-4d5bbe11792e@dewey.myzen.co.uk>

Comment in-line

On 02/04/2023 06:37, Ivan Krylov wrote:
> On Fri, 31 Mar 2023 16:51:40 -0400
> Dennis Boos <boos at ncsu.edu> wrote:
> 
>> Also, I keep getting the message in the Rstudio check
>>
>> WARNING
>>     'qpdf' is needed for checks on size reduction of PDFs
>>
>>
>> but I got the latest versions of R and Rstudio and was able to get
>> qpdf to install and loaded with library(qpdf), but Rstudio still gives
>> that message.
> 
> Almost there.
> 
> The 'qpdf' package interfaces to the same code that the 'qpdf' command
> line tool uses to do its job. R CMD check uses the latter, not the
> former. It looks like you're on Windows, so you need to install Rtools
> in order to get a compatible version of 'qpdf':
> https://cran.r-project.org/bin/windows/Rtools/rtools43/rtools.html
> 

I always get the warning about qpdf (on Windows) but it does not seem to 
be a problem on CRAN or winbuilder.

-- 
Michael
http://www.dewey.myzen.co.uk/home.html


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Sun Apr  2 17:33:49 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Sun, 2 Apr 2023 17:33:49 +0200
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <a91eb3b8-944b-0023-49bd-4d5bbe11792e@dewey.myzen.co.uk>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
 <20230402083744.2c1abeb7@Tarkus>
 <a91eb3b8-944b-0023-49bd-4d5bbe11792e@dewey.myzen.co.uk>
Message-ID: <78f7a5aa-99dc-dd85-c125-eff7068f106c@statistik.tu-dortmund.de>



On 02.04.2023 12:12, Michael Dewey wrote:
> Comment in-line
> 
> On 02/04/2023 06:37, Ivan Krylov wrote:
>> On Fri, 31 Mar 2023 16:51:40 -0400
>> Dennis Boos <boos at ncsu.edu> wrote:
>>
>>> Also, I keep getting the message in the Rstudio check
>>>
>>> WARNING
>>> ??? 'qpdf' is needed for checks on size reduction of PDFs
>>>
>>>
>>> but I got the latest versions of R and Rstudio and was able to get
>>> qpdf to install and loaded with library(qpdf), but Rstudio still gives
>>> that message.
>>
>> Almost there.
>>
>> The 'qpdf' package interfaces to the same code that the 'qpdf' command
>> line tool uses to do its job. R CMD check uses the latter, not the
>> former. It looks like you're on Windows, so you need to install Rtools
>> in order to get a compatible version of 'qpdf':
>> https://cran.r-project.org/bin/windows/Rtools/rtools43/rtools.html
>>
> 
> I always get the warning about qpdf (on Windows) but it does not seem to 
> be a problem on CRAN or winbuilder.
> 

You have to have qpdf installed and on your PATH.

Best,
Uwe Ligges


From rodr|go@tob@rc@rr|zo @end|ng |rom uw@@edu@@u  Tue Apr  4 09:08:52 2023
From: rodr|go@tob@rc@rr|zo @end|ng |rom uw@@edu@@u (Rodrigo Tobar Carrizo)
Date: Tue, 4 Apr 2023 07:08:52 +0000
Subject: [R-pkg-devel] OpenMP and CRAN checks
Message-ID: <SYCPR01MB40477F5D574DBBC27DD0F32BA9939@SYCPR01MB4047.ausprd01.prod.outlook.com>

Hi list,

We are having an issue with submitting a new version of the imager package to CRAN, and would like to understand how we are getting a particular NOTE. The package uses OpenMP for parallelisation of tasks. While we have a routine to set the number of threads that OpenMP should use (it internally issues a `omp_set_num_threads(threads)` call), we don't invoke it ourselves -- we let the users do it. None of our OpenMP pragmas set an explicit number of threads either. In other words, by default we use the system as-is.

In my environment (8 cores, 2 threads per core) I can see this working as expected. If I set the OMP_NUM_THREADS or OMP_THREAD_LIMIT environment variables to a given number before starting R, I can see that parallelisation stays within the given boundary. For example:

=================== examples============================
# No explicit limit, usually means "use all available cores"
$> Rscript -e 'library(foreach); library(imager); temp = foreach(1:100)%do%{as.cimg(matrix(rnorm(400^2),400,400))}; times = system.time(foreach(1:10)%do%{parmed(temp)}); print(times["user.self"]/times["elapsed"])' |& tail -n 1
15.75708

# 1 thread via OMP_THREAD_LIMIT
$> OMP_THREAD_LIMIT=1 Rscript -e 'library(foreach); library(imager); temp = foreach(1:100)%do%{as.cimg(matrix(rnorm(400^2),400,400))}; times = system.time(foreach(1:10)%do%{parmed(temp)}); print(times["user.self"]/times["elapsed"])' |& tail -n 1
0.994263

# 2 threads via OMP_NUM_THREADS
$> OMP_NUM_THREADS=2 Rscript -e 'library(foreach); library(imager); temp = foreach(1:100)%do%{as.cimg(matrix(rnorm(400^2),400,400))}; times = system.time(foreach(1:10)%do%{parmed(temp)}); print(times["user.self"]/times["elapsed"])' |& tail -n 1
1.994128
=================== examples============================

It is also our understanding (from [1], and more detailed in [2]) that the CRAN machines set OMP_THREAD_LIMIT=2 when running package checks to avoid package examples and vignettes from using more than 2 threads each, and thus be able to share the infrastructure as expected.

However, upon submission we received the following NOTE:

* checking examples ... [24s/21s] NOTE
Examples with CPU time > 2.5 times elapsed time
             user system elapsed ratio
cannyEdges 1.095  0.052   0.385 2.979

What I cannot explain is how, if OMP_THREAD_LIMIT is set, the example runs using more than 2 threads, therefor triggering such a NOTE. Isn't the OpenMP runtime supposed to limit the number of threads if this limit is set, hence limiting our parallelisation? I wouldn't single out this particular example: since OpenMP is used across the codebase it might be a question of good/bad luck which example triggers the warning. The code also doesn't spawn any child processes, all CPU utilisation stems from the main R process.

I do appreciate that we might have a future, different problem, where OMP_THREAD_LIMIT is specified but the code could still *try* to use more threads than the given limit (hence triggering a warning in some OpenMP platforms). That's the issue presented in [2], which they went and fixed -- but the limit should be obeyed by the OpenMP runtime in the first place, which is what puzzles me.

Any hints/help/guidance would be appreciated.

Regards,

Rodrigo

[1] https://rdrr.io/cran/data.table/man/openmp-utils.html
[2] https://github.com/Rdatatable/data.table/issues/3300

From boo@ @end|ng |rom nc@u@edu  Tue Apr  4 15:41:41 2023
From: boo@ @end|ng |rom nc@u@edu (Dennis Boos)
Date: Tue, 4 Apr 2023 09:41:41 -0400
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <c6b52458-35c0-8ef4-93aa-d37c50769460@gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
 <c6b52458-35c0-8ef4-93aa-d37c50769460@gmail.com>
Message-ID: <CAJJ-gHznV18NyPtuweYaGFdxisLTc+j26eN_uR2WVYzxttSG0Q@mail.gmail.com>

Thanks so much to all of you.  If you have time, I'm getting really
contradictory results.

1. It first seemed to have passed the check in Rstudio (I used
device::build() in the R window and then clicked on check in the drop down
menu under build).

==> devtools::check(document = FALSE, args = c('--as-cran'))
?? R CMD check results  Monte.Carlo.se 0.1.1 ????
Duration: 56.6s
0 errors ? | 0 warnings ? | 0 notes ?

R CMD check succeeded

However, I then couldn't find the tar.gz where it was supposed to be. It
was just gone.


Here is my namespace.  It says not to edit, but I had been told to add
the importFrom. So I didn't use
devtools::document() for fear roxygen2 would get rid of it.

# Generated by roxygen2: do not edit by hand
importFrom("stats", "cor", "sd", "var")
export(boot.se)
export(jack.se)
export(mc.se.matrix)
export(mc.se.vector)
export(pairwise.se)
export(sim.samp)

4. Here is my DESCRIPTION file

Package: Monte.Carlo.se
Type: Package
Title: Monte Carlo Standard Errors
Version: 0.1.1
Author: Dennis Boos, Kevin Matthew, Jason Osborne
Maintainer: Dennis Boos <boos at ncsu.edu>
Description: Computes Monte Carlo standard errors for summaries of
Monte Carlo output. Summaries and their standard errors are based on
columns of Monte Carlo simulation output. Dennis D. Boos and Jason A.
Osborne (2015) <doi:10.1111/insr.12087>.
License: GPL-3
Encoding: UTF-8
RoxygenNote: 7.2.3
Suggests: knitr, rmarkdown
Imports: stats
VignetteBuilder: knitr

5. And because of your advice: " It sounds as though you're using
Roxygen2 to generate your NAMESPACE file.
ff so, you need @imports directives in the comments
(conventionally before the function that uses the import, but I think it
doesn't really matter where)."

So I put "@imports" in the function that had trouble

#' @examples
#' \donttest{
#' # Using the output data matrix hold generated in vignette Example3,
#' # calculate jackknife and bootstrap standard errors
#' # for the differences and ratios of the CV estimates.
#' # First get the components of hold needed.
#'
#' @imports
#'
#' trim20 <- function(x){mean(x,.2)} # 20% trimmed mean function

Was that the correct thing to do?

6. And here are the failed check results. I'm clueless at this point.

==> devtools::check(document = FALSE, args = c('--as-cran'))
?? Building ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting
env vars:
? CFLAGS    : -Wall -pedantic -fdiagnostics-color=always
? CXXFLAGS  : -Wall -pedantic -fdiagnostics-color=always
? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always
? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always
? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always
? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always?? R CMD build
??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
 checking for file 'C:\Users\boos\Dropbox\My PC
(boos-home)\Desktop\dennis\R.packages\Monte.Carlo.se.March.2023/DESCRIPTION'
...?  preparing 'Monte.Carlo.se':?  checking DESCRIPTION
meta-information ...?  installing the package to build vignettes?
creating vignettes (3.6s)?  checking for LF line-endings in source and
make files and shell scripts?  checking for empty or unneeded
directories?  building 'Monte.Carlo.se_0.1.1.tar.gz'
   ?? Checking ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting
env vars:
? _R_CHECK_CRAN_INCOMING_REMOTE_               : FALSE
? _R_CHECK_CRAN_INCOMING_                      : FALSE
? _R_CHECK_FORCE_SUGGESTS_                     : FALSE
? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE
? NOT_CRAN                                     : true?? R CMD check
??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
 using log directory 'C:/Users/boos/Dropbox/My PC
(boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck' (793ms)?
using R version 4.2.3 (2023-03-15 ucrt)?  using platform:
x86_64-w64-mingw32 (64-bit)?  using session charset: UTF-8?  using
options '--no-manual --as-cran' (653ms)?  checking for file
'Monte.Carlo.se/DESCRIPTION'?  checking extension type ... Package?
this is package 'Monte.Carlo.se' version '0.1.1'?  package encoding:
UTF-8?  checking package namespace information?  checking package
dependencies (3.2s)?  checking if this is a source package?  checking
if there is a namespace?  checking for executable files (491ms)?
checking for hidden files and directories ...?  checking for portable
file names?  checking serialization versions?  checking whether
package 'Monte.Carlo.se' can be installed (2.9s)?  checking installed
package size ... ?  checking package directory ...?  checking for
future file timestamps ... ?  checking 'build' directory?  checking
DESCRIPTION meta-information ... ?  checking top-level files ...?
checking for left-over files?  checking index information ... ?
checking package subdirectories ... ?  checking R files for non-ASCII
characters ... ?  checking R files for syntax errors ... ?  checking
whether the package can be loaded ... ?  checking whether the package
can be loaded with stated dependencies ... ?  checking whether the
package can be unloaded cleanly ... ?  checking whether the namespace
can be loaded with stated dependencies ... ?  checking whether the
namespace can be unloaded cleanly ... ?  checking loading without
being on the library search path ... N  checking dependencies in R
code ...
   Namespace in Imports field not imported from: 'stats'
     All declared Imports should be used.?  checking S3 generic/method
consistency (422ms)?  checking replacement functions ... ?  checking
foreign function calls ... N  checking R code for possible problems
(3s)
   boot.se: no visible global function definition for 'sd'
   boot.var: no visible global function definition for 'var'
   corr: no visible global function definition for 'cor'
   cv: no visible global function definition for 'sd'
   ratio.mean.sdhat.sd: no visible global function definition for 'sd'
   ratio.mean.vhat.var: no visible global function definition for 'var'
   ratio.sd: no visible global function definition for 'sd'
   ratio.var: no visible global function definition for 'var'
   varn: no visible global function definition for 'var'
   Undefined global functions or variables:
     cor sd var
   Consider adding
     importFrom("stats", "cor", "sd", "var")
   to your NAMESPACE file.?  checking Rd files ... ?  checking Rd
metadata ... ?  checking Rd line widths ... ?  checking Rd
cross-references ... ?  checking for missing documentation entries ...
?  checking for code/documentation mismatches (562ms)?  checking Rd
\usage sections (661ms)?  checking Rd contents ... ?  checking for
unstated dependencies in examples ... ?  checking installed files from
'inst/doc'W  checking files in 'vignettes' ...
   Files in the 'vignettes' directory newer than same file in 'inst/doc':
     'Brief-Overview.Rmd'?  checking examples (573ms)?  checking
examples with --run-donttest ... [24s] OK (24.7s)?  checking for
unstated dependencies in vignettes ... ?  checking package vignettes
in 'inst/doc' ...?  checking re-building of vignette outputs (6.8s)?
checking for non-standard things in the check directory ...?  checking
for detritus in the temp directory

   See
     'C:/Users/boos/Dropbox/My PC
(boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck/00check.log'
   for details.

   ?? R CMD check results
???????????????????????????????????????????????????????????????????????????????????
Monte.Carlo.se 0.1.1 ????
Duration: 51.5s
? checking files in 'vignettes' ... WARNING
  Files in the 'vignettes' directory newer than same file in 'inst/doc':
    'Brief-Overview.Rmd'
? checking dependencies in R code ... NOTE
  Namespace in Imports field not imported from: 'stats'
    All declared Imports should be used.
? checking R code for possible problems ... NOTE
  boot.se: no visible global function definition for 'sd'
  boot.var: no visible global function definition for 'var'
  corr: no visible global function definition for 'cor'
  cv: no visible global function definition for 'sd'
  ratio.mean.sdhat.sd: no visible global function definition for 'sd'
  ratio.mean.vhat.var: no visible global function definition for 'var'
  ratio.sd: no visible global function definition for 'sd'
  ratio.var: no visible global function definition for 'var'
  varn: no visible global function definition for 'var'
  Undefined global functions or variables:
    cor sd var
  Consider adding
    importFrom("stats", "cor", "sd", "var")
  to your NAMESPACE file.
0 errors ? | 1 warning ? | 2 notes ?
Error: R CMD check found WARNINGs
Execution halted

Exited with status 1.





On Sat, Apr 1, 2023 at 5:34?PM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 31/03/2023 4:51 p.m., Dennis Boos wrote:
> > Recently I got a message from CRAN that my package Monte.Carlo.se (on
> CRAN
> > for the last few years) does not pass current testing.  There seemed to
> be
> > 2 problems:
> >
> >
> ***************************************************************************************************************
> >
> > 1. * checking LazyData ... NOTE
> >    'LazyData' is specified without a 'data' directory
> >
> > I have this line in my DESCRIPTION file:
> >
> > LazyData: true
> >
> > Should I remove that?
> >
> >
> *****************************************************************************************************************
> >
> > 2. * checking examples with --run-donttest ... [42s/42s] ERROR
> > Running examples in ?Monte.Carlo.se-Ex.R? failed
> > The error most likely occurred in:
> >
> >> pairwise.se(hold,xcol=10:12,summary.f=cv)
> > Error: object 'hold' not found
> > Execution halted
> >
> >
> ***************************************************************************************
> >
> > So, I put in the R code to generate the data matrix *hold.  *But that
> > brought a host of other errors when checking in Rstudio with
> >
> >>
> devtools::check("S:/Documents/srcis/a.projects/Monte.Carlo.isr.and.package/Monte.Carlo.se.March.2023")
> >
> > I started seeing the following list about standard functions like sd.
> >
> > N  checking R code for possible problems (3.4s)
> >     boot.se: no visible global function definition for 'sd'
> >     boot.var: no visible global function definition for 'var'
> >     corr: no visible global function definition for 'cor'
> >     cv: no visible global function definition for 'sd'
> >     ratio.mean.sdhat.sd: no visible global function definition for 'sd'
> >     ratio.mean.vhat.var: no visible global function definition for 'var'
> >     ratio.sd: no visible global function definition for 'sd'
> >     ratio.var: no visible global function definition for 'var'
> >     varn: no visible global function definition for 'var'
> >     Undefined global functions or variables:
> >       cor sd var
> >     Consider adding
> >       importFrom("stats", "cor", "sd", "var")
> >     to your NAMESPACE file.
> >
> > But you can't add those functions to NAMESPACE. Well I did but
> >
> > devtools::build()
> >
> >
> > gets rid of it. Also, I keep getting the message in the Rstudio check
> >
> > WARNING
> >     'qpdf' is needed for checks on size reduction of PDFs
> >
> >
> > but I got the latest versions of R and Rstudio and was able to get
> > qpdf to install and loaded with library(qpdf), but Rstudio still gives
> > that message.
> >
>
> It sounds as though you're using Roxygen2 to generate your NAMESPACE
> file.  If so, you need @imports directives in the comments
> (conventionally before the function that uses the import, but I think it
> doesn't really matter where).
>
> Duncan Murdoch
>
>

-- 
Dennis Boos                      email: dennis_boos at ncsu.edu
Department of Statistics    Phone: 919-515-1918
NC State University           Fax: 919-515-1169
Raleigh, NC 27695-8203   http://www4.stat.ncsu.edu/~boos

Aim for kindness, tolerance, and humility.

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Apr  4 16:00:00 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 4 Apr 2023 09:00:00 -0500
Subject: [R-pkg-devel] OpenMP and CRAN checks
In-Reply-To: <SYCPR01MB40477F5D574DBBC27DD0F32BA9939@SYCPR01MB4047.ausprd01.prod.outlook.com>
References: <SYCPR01MB40477F5D574DBBC27DD0F32BA9939@SYCPR01MB4047.ausprd01.prod.outlook.com>
Message-ID: <25644.11616.284536.185116@rob.eddelbuettel.com>


Hi Rodrigo,

This came up recently again on social media where I illustrated how the
tiledb package deals with it. So a quick recap:

First off, let's make the goals clear.

We want to _simultaneously_
 - abide by CRAN Policy rules and cap ourselves to two cores there
 - do not impose any limits on our users: ALL cores ALL the time

The solution we implemented a while is to use a function _that is an opt-in_
which looks at the standard OpenMP variable as well as at R's own Ncpus:

    limitTileDBCores <- function(ncores, verbose=FALSE) {
      if (missing(ncores)) {
        ## start with a simple fallback: 'Ncpus' (if set) or else 2
        ncores <- getOption("Ncpus", 2L)
        ## also consider OMP_THREAD_LIMIT (cf Writing R Extensions), gets NA if envvar unset
        ompcores <- as.integer(Sys.getenv("OMP_THREAD_LIMIT"))
        ## and then keep the smaller
        ncores <- min(na.omit(c(ncores, ompcores)))
      }
      stopifnot(`The 'ncores' argument must be numeric or character` = is.numeric(ncores) || is.character(ncores))
      ## for brevity omitted here how ncores propagates to TileDB library -- creates `cfg`
      if (verbose) message("Limiting TileDB to ",ncores," cores. See ?limitTileDBCores.")
      invisible(cfg)
    }

The key is that we reflect the smaller of Ncpus and OMP_THREAD_LIMIT along
with a fall-back of two in case nothing is set.

That function is then called (and feeds into the library config) at the
beginning of each
 - help file example
 - unit test file
 - vignette

As example (from a help file) is

    \dontshow{ctx <- tiledb_ctx(limitTileDBCores())}

(where ctx a context object controlling, inter alia, the thread pool).

By throttling it anywhere CRAN executes code, and using the prescribed
maximum of two core, we satisfy goal one of not getting thrown off CRAN. By
making it an _explicit_ opt-in we satisfy our goal of never slowing down our
users who (presumably) do not opt in. And those who have, say, Ncpus set (as
I do to spread R's own package installations over all my cores) get the
maximum performance for examples, tests, and vignettes too as they opted in.

"Works for us" as they say.

Hope this helps,  Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Apr  4 16:04:05 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 4 Apr 2023 10:04:05 -0400
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <CAJJ-gHznV18NyPtuweYaGFdxisLTc+j26eN_uR2WVYzxttSG0Q@mail.gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
 <c6b52458-35c0-8ef4-93aa-d37c50769460@gmail.com>
 <CAJJ-gHznV18NyPtuweYaGFdxisLTc+j26eN_uR2WVYzxttSG0Q@mail.gmail.com>
Message-ID: <443004df-44a8-21b2-55f9-df852e9ac872@gmail.com>

Your message is posted using HTML, which mangles a lot of it.  For 
example, the NAMESPACE file you posted has URLs mixed in with the text.

But if I can guess correctly what was in those files, it looks as though 
the package being checked doesn't have those files in it.  I don't know 
exactly what devtools::check does, but it's probably your problem.

I'd suggest this:  build the tarball, and check the tarball.

Duncan Murdoch

On 04/04/2023 9:41 a.m., Dennis Boos wrote:
> Thanks so much to all of you.? If you have time, I'm getting really 
> contradictory results.
> 
> 1. It first seemed to have passed the check in Rstudio (I used 
> device::build() in the R window and then clicked on check in the drop 
> down menu under build).
> 
> ==> devtools::check(document = FALSE, args = c('--as-cran'))
> 
> ?? R CMD check results Monte.Carlo.se <http://Monte.Carlo.se> 0.1.1 
> ????Duration: 56.6s 0 errors ?| 0 warnings ?| 0 notes ?R CMD check succeeded
> 
> However, I then couldn't find the tar.gz where it was supposed to be. It 
> was just gone.
> 
> 
> Here is my namespace. It says not to edit, but I had been told to add 
> the importFrom. So I didn't use
> devtools::document() for fear roxygen2 would get rid of it.
> 
> # Generated by roxygen2: do not edit by hand
> importFrom("stats", "cor", "sd", "var")
> export(boot.se  <http://boot.se>)
> export(jack.se  <http://jack.se>)
> export(mc.se.matrix)
> export(mc.se.vector)
> export(pairwise.se  <http://pairwise.se>)
> export(sim.samp)
> 
> 4.Here is my DESCRIPTION file
> 
> Package:Monte.Carlo.se  <http://Monte.Carlo.se>
> Type: Package
> Title: Monte Carlo Standard Errors
> Version: 0.1.1
> Author: Dennis Boos, Kevin Matthew, Jason Osborne
> Maintainer: Dennis Boos <boos at ncsu.edu  <mailto:boos at ncsu.edu>>
> Description: Computes Monte Carlo standard errors for summaries of Monte Carlo output. Summaries and their standard errors are based on columns of Monte Carlo simulation output. Dennis D. Boos and Jason A. Osborne (2015) <doi:10.1111/insr.12087>.
> License: GPL-3
> Encoding: UTF-8
> RoxygenNote: 7.2.3
> Suggests: knitr, rmarkdown
> Imports: stats
> VignetteBuilder: knitr
> 
> 5.And because of your advice:  " It sounds as though you're using Roxygen2 to generate your NAMESPACE file.
> ff so, you need @imports directives in the comments
> (conventionally before the function that uses the import, but I think it
> doesn't really matter where)."
> 
> So I put "@imports" in the function that had trouble
> 
> #' @examples
> #' \donttest{
> #' # Using the output data matrix hold generated in vignette Example3,
> #' # calculate jackknife and bootstrap standard errors
> #' # for the differences and ratios of the CV estimates.
> #' # First get the components of hold needed.
> #'
> #' @imports
> #'
> #' trim20 <- function(x){mean(x,.2)} # 20% trimmed mean function
> 
> Was that the correct thing to do?
> 
> 6.And here are the failed check results. I'm clueless at this point.
> 
> 
> ==> devtools::check(document = FALSE, args = c('--as-cran')) 
> ??Building????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting env vars:? CFLAGS : -Wall -pedantic -fdiagnostics-color=always? CXXFLAGS : -Wall -pedantic -fdiagnostics-color=always? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always??R CMD build??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????checking for file 'C:\Users\boos\Dropbox\My PC (boos-home)\Desktop\dennis\R.packages\Monte.Carlo.se.March.2023/DESCRIPTION'... ?preparing 'Monte.Carlo.se <http://Monte.Carlo.se>':?checking DESCRIPTION meta-information... ?installing the package to build vignettes?creating vignettes(3.6s)?checking for LF line-endings in source and make files and shell scripts?checking for empty or unneeded directories?building 'Monte.Carlo.se_0.1.1.tar.gz'??Checking????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting env vars:? _R_CHECK_CRAN_INCOMING_REMOTE_ : FALSE? _R_CHECK_CRAN_INCOMING_ : FALSE? _R_CHECK_FORCE_SUGGESTS_ : FALSE? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE? NOT_CRAN : true?? R CMD check ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????using log directory 'C:/Users/boos/Dropbox/My PC (boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck'(793ms)?using R version 4.2.3 (2023-03-15 ucrt)? using platform: x86_64-w64-mingw32 (64-bit)? using session charset: UTF-8?using options '--no-manual --as-cran'(653ms)?checking for file 'Monte.Carlo.se/DESCRIPTION <http://Monte.Carlo.se/DESCRIPTION>'? checking extension type ... Package? this is package 'Monte.Carlo.se <http://Monte.Carlo.se>' version '0.1.1'? package encoding: UTF-8?checking package namespace information?checking package dependencies(3.2s)?checking if this is a source package?checking if there is a namespace?checking for executable files(491ms)?checking for hidden files and directories... ?checking for portable file names?checking serialization versions?checking whether package 'Monte.Carlo.se <http://Monte.Carlo.se>' can be installed(2.9s)?checking installed package size... ?checking package directory... ?checking for future file timestamps... ?checking 'build' directory?checking DESCRIPTION meta-information... ?checking top-level files... ?checking for left-over files?checking index information... ?checking package subdirectories... ?checking R files for non-ASCII characters... ?checking R files for syntax errors... ?checking whether the package can be loaded... ?checking whether the package can be loaded with stated dependencies... ?checking whether the package can be unloaded cleanly... ?checking whether the namespace can be loaded with stated dependencies... ?checking whether the namespace can be unloaded cleanly... ?checking loading without being on the library search path... N checking dependencies in R code... Namespace in Imports field not imported from: 'stats' All declared Imports should be used. ?checking S3 generic/method consistency(422ms)?checking replacement functions... ?checking foreign function calls... N checking R code for possible problems(3s)boot.se <http://boot.se>: no visible global function definition for 'sd' boot.var: no visible global function definition for 'var' corr: no visible global function definition for 'cor' cv: no visible global function definition for 'sd' ratio.mean.sdhat.sd <http://ratio.mean.sdhat.sd>: no visible global function definition for 'sd' ratio.mean.vhat.var: no visible global function definition for 'var' ratio.sd <http://ratio.sd>: no visible global function definition for 'sd' ratio.var: no visible global function definition for 'var' varn: no visible global function definition for 'var' Undefined global functions or variables: cor sd var Consider adding importFrom("stats", "cor", "sd", "var") to your NAMESPACE file. ?checking Rd files... ?checking Rd metadata... ?checking Rd line widths... ?checking Rd cross-references... ?checking for missing documentation entries... ?checking for code/documentation mismatches(562ms)?checking Rd \usage sections(661ms)?checking Rd contents... ?checking for unstated dependencies in examples... ?checking installed files from 'inst/doc'W checking files in 'vignettes'... Files in the 'vignettes' directory newer than same file in 'inst/doc': 'Brief-Overview.Rmd' ?checking examples(573ms)?checking examples with --run-donttest ... [24s] OK(24.7s)?checking for unstated dependencies in vignettes... ?checking package vignettes in 'inst/doc'... ?checking re-building of vignette outputs(6.8s)?checking for non-standard things in the check directory... ?checking for detritus in the temp directorySee 'C:/Users/boos/Dropbox/My PC (boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck/00check.log' for details. ?? R CMD check results ??????????????????????????????????????????????????????????????????????????????????? Monte.Carlo.se <http://Monte.Carlo.se> 0.1.1 ????Duration: 51.5s ? checking files in 'vignettes' ... WARNINGFiles in the 'vignettes' directory newer than same file in 'inst/doc': 'Brief-Overview.Rmd' ? checking dependencies in R code ... NOTENamespace in Imports field not imported from: 'stats' All declared Imports should be used. ? checking R code for possible problems ... NOTEboot.se <http://boot.se>: no visible global function definition for 'sd' boot.var: no visible global function definition for 'var' corr: no visible global function definition for 'cor' cv: no visible global function definition for 'sd' ratio.mean.sdhat.sd <http://ratio.mean.sdhat.sd>: no visible global function definition for 'sd' ratio.mean.vhat.var: no visible global function definition for 'var' ratio.sd <http://ratio.sd>: no visible global function definition for 'sd' ratio.var: no visible global function definition for 'var' varn: no visible global function definition for 'var' Undefined global functions or variables: cor sd var Consider adding importFrom("stats", "cor", "sd", "var") to your NAMESPACE file. 0 errors ?| 1 warning ?| 2 notes ?Error: R CMD check found WARNINGs Execution halted Exited with status 1.
> 
> 
> 
> 
> 
> 
> 
> On Sat, Apr 1, 2023 at 5:34?PM Duncan Murdoch <murdoch.duncan at gmail.com 
> <mailto:murdoch.duncan at gmail.com>> wrote:
> 
>     On 31/03/2023 4:51 p.m., Dennis Boos wrote:
>      > Recently I got a message from CRAN that my package Monte.Carlo.se
>     <http://Monte.Carlo.se> (on CRAN
>      > for the last few years) does not pass current testing.? There
>     seemed to be
>      > 2 problems:
>      >
>      >
>     ***************************************************************************************************************
>      >
>      > 1. * checking LazyData ... NOTE
>      >? ? 'LazyData' is specified without a 'data' directory
>      >
>      > I have this line in my DESCRIPTION file:
>      >
>      > LazyData: true
>      >
>      > Should I remove that?
>      >
>      >
>     *****************************************************************************************************************
>      >
>      > 2. * checking examples with --run-donttest ... [42s/42s] ERROR
>      > Running examples in ?Monte.Carlo.se-Ex.R? failed
>      > The error most likely occurred in:
>      >
>      >> pairwise.se <http://pairwise.se>(hold,xcol=10:12,summary.f=cv)
>      > Error: object 'hold' not found
>      > Execution halted
>      >
>      >
>     ***************************************************************************************
>      >
>      > So, I put in the R code to generate the data matrix *hold.? *But that
>      > brought a host of other errors when checking in Rstudio with
>      >
>      >>
>     devtools::check("S:/Documents/srcis/a.projects/Monte.Carlo.isr.and.package/Monte.Carlo.se.March.2023")
>      >
>      > I started seeing the following list about standard functions like sd.
>      >
>      > N? checking R code for possible problems (3.4s)
>      > boot.se <http://boot.se>: no visible global function definition
>     for 'sd'
>      >? ? ?boot.var: no visible global function definition for 'var'
>      >? ? ?corr: no visible global function definition for 'cor'
>      >? ? ?cv: no visible global function definition for 'sd'
>      > ratio.mean.sdhat.sd <http://ratio.mean.sdhat.sd>: no visible
>     global function definition for 'sd'
>      >? ? ?ratio.mean.vhat.var: no visible global function definition
>     for 'var'
>      > ratio.sd <http://ratio.sd>: no visible global function definition
>     for 'sd'
>      >? ? ?ratio.var: no visible global function definition for 'var'
>      >? ? ?varn: no visible global function definition for 'var'
>      >? ? ?Undefined global functions or variables:
>      >? ? ? ?cor sd var
>      >? ? ?Consider adding
>      >? ? ? ?importFrom("stats", "cor", "sd", "var")
>      >? ? ?to your NAMESPACE file.
>      >
>      > But you can't add those functions to NAMESPACE. Well I did but
>      >
>      > devtools::build()
>      >
>      >
>      > gets rid of it. Also, I keep getting the message in the Rstudio check
>      >
>      > WARNING
>      >? ? ?'qpdf' is needed for checks on size reduction of PDFs
>      >
>      >
>      > but I got the latest versions of R and Rstudio and was able to get
>      > qpdf to install and loaded with library(qpdf), but Rstudio still
>     gives
>      > that message.
>      >
> 
>     It sounds as though you're using Roxygen2 to generate your NAMESPACE
>     file.? If so, you need @imports directives in the comments
>     (conventionally before the function that uses the import, but I
>     think it
>     doesn't really matter where).
> 
>     Duncan Murdoch
> 
> 
> 
> -- 
> Dennis Boos? ? ? ? ? ? ? ? ? ? ? email: dennis_boos at ncsu.edu 
> <mailto:dennis_boos at ncsu.edu>
> Department of Statistics? ? Phone: 919-515-1918
> NC State University? ? ? ? ? ?Fax: 919-515-1169
> Raleigh, NC 27695-8203 http://www4.stat.ncsu.edu/~boos 
> <http://www4.stat.ncsu.edu/~boos>
> 
> Aim for kindness, tolerance, and humility.


From edd @end|ng |rom deb|@n@org  Tue Apr  4 16:23:41 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 4 Apr 2023 09:23:41 -0500
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <443004df-44a8-21b2-55f9-df852e9ac872@gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
 <c6b52458-35c0-8ef4-93aa-d37c50769460@gmail.com>
 <CAJJ-gHznV18NyPtuweYaGFdxisLTc+j26eN_uR2WVYzxttSG0Q@mail.gmail.com>
 <443004df-44a8-21b2-55f9-df852e9ac872@gmail.com>
Message-ID: <25644.13037.198070.776153@rob.eddelbuettel.com>


On 4 April 2023 at 10:04, Duncan Murdoch wrote:
| I'd suggest this:  build the tarball, and check the tarball.

Strong second. The _Writing R Extensions_ manual does not mention devtools.
As Uwe often reminds everybody here the package is not used by CRAN either.

This may sound harsh but one of the key approaches to debugging often is to
strip away the layers to identify more atomic and minimal operations.  (And
RStudio can build the tarball for you too, see Build -> More -> Build Source
Package. Similarly you can ask it to not check the package using devtools.
You can always flip the switch back. Convenient helpers are useful, but at
times it is advisable to turn them off.)

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ||one| @end|ng |rom po@|t@co  Tue Apr  4 16:46:46 2023
From: ||one| @end|ng |rom po@|t@co (Lionel Henry)
Date: Tue, 4 Apr 2023 16:46:46 +0200
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <CAJf4E3ptG7j1M5MVUUvhx=S6DTzhiL0ksrD=X1uaVyAEw1+HjQ@mail.gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
 <c6b52458-35c0-8ef4-93aa-d37c50769460@gmail.com>
 <CAJJ-gHznV18NyPtuweYaGFdxisLTc+j26eN_uR2WVYzxttSG0Q@mail.gmail.com>
 <CAJf4E3ptG7j1M5MVUUvhx=S6DTzhiL0ksrD=X1uaVyAEw1+HjQ@mail.gmail.com>
Message-ID: <CAJf4E3qDNekz5BRLS0Wt8E=698T4e-QFVHhKTTfrvZHEB-U6og@mail.gmail.com>

> Here is my namespace.  It says not to edit, but I had been told to add
> the importFrom. So I didn't use
> devtools::document() for fear roxygen2 would get rid of it.

`devtools::check()` calls `document()` automatically so your changes to
the NAMESPACE file get overwritten. You can see this in the output.

To solve this, add the appropriate roxygen2 tag somewhere in your package e.g.

```
#' @importFrom stats var sd etc
NULL
```

Best,
Lionel

On 4/4/23, Lionel Henry <lionel at posit.co> wrote:
>> Here is my namespace.  It says not to edit, but I had been told to add
>> the importFrom. So I didn't use
>> devtools::document() for fear roxygen2 would get rid of it.
>
> `devtools::check()` calls `document()` automatically so your changes to
> the NAMESPACE file get overwritten. You can see this in the output.
>
> To solve this, add the appropriate roxygen2 tag somewhere in your package
> e.g.
>
> ```
> #' @importFrom stats var sd etc
> NULL
> ```
>
> Best,
> Lionel
>
> On 4/4/23, Dennis Boos <boos at ncsu.edu> wrote:
>> Thanks so much to all of you.  If you have time, I'm getting really
>> contradictory results.
>>
>> 1. It first seemed to have passed the check in Rstudio (I used
>> device::build() in the R window and then clicked on check in the drop
>> down
>> menu under build).
>>
>> ==> devtools::check(document = FALSE, args = c('--as-cran'))
>> ?? R CMD check results  Monte.Carlo.se 0.1.1 ????
>> Duration: 56.6s
>> 0 errors ? | 0 warnings ? | 0 notes ?
>>
>> R CMD check succeeded
>>
>> However, I then couldn't find the tar.gz where it was supposed to be. It
>> was just gone.
>>
>>
>> Here is my namespace.  It says not to edit, but I had been told to add
>> the importFrom. So I didn't use
>> devtools::document() for fear roxygen2 would get rid of it.
>>
>> # Generated by roxygen2: do not edit by hand
>> importFrom("stats", "cor", "sd", "var")
>> export(boot.se)
>> export(jack.se)
>> export(mc.se.matrix)
>> export(mc.se.vector)
>> export(pairwise.se)
>> export(sim.samp)
>>
>> 4. Here is my DESCRIPTION file
>>
>> Package: Monte.Carlo.se
>> Type: Package
>> Title: Monte Carlo Standard Errors
>> Version: 0.1.1
>> Author: Dennis Boos, Kevin Matthew, Jason Osborne
>> Maintainer: Dennis Boos <boos at ncsu.edu>
>> Description: Computes Monte Carlo standard errors for summaries of
>> Monte Carlo output. Summaries and their standard errors are based on
>> columns of Monte Carlo simulation output. Dennis D. Boos and Jason A.
>> Osborne (2015) <doi:10.1111/insr.12087>.
>> License: GPL-3
>> Encoding: UTF-8
>> RoxygenNote: 7.2.3
>> Suggests: knitr, rmarkdown
>> Imports: stats
>> VignetteBuilder: knitr
>>
>> 5. And because of your advice: " It sounds as though you're using
>> Roxygen2 to generate your NAMESPACE file.
>> ff so, you need @imports directives in the comments
>> (conventionally before the function that uses the import, but I think it
>> doesn't really matter where)."
>>
>> So I put "@imports" in the function that had trouble
>>
>> #' @examples
>> #' \donttest{
>> #' # Using the output data matrix hold generated in vignette Example3,
>> #' # calculate jackknife and bootstrap standard errors
>> #' # for the differences and ratios of the CV estimates.
>> #' # First get the components of hold needed.
>> #'
>> #' @imports
>> #'
>> #' trim20 <- function(x){mean(x,.2)} # 20% trimmed mean function
>>
>> Was that the correct thing to do?
>>
>> 6. And here are the failed check results. I'm clueless at this point.
>>
>> ==> devtools::check(document = FALSE, args = c('--as-cran'))
>> ?? Building
>> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting
>> env vars:
>> ? CFLAGS    : -Wall -pedantic -fdiagnostics-color=always
>> ? CXXFLAGS  : -Wall -pedantic -fdiagnostics-color=always
>> ? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always
>> ? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always
>> ? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always
>> ? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always?? R CMD build
>> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
>>  checking for file 'C:\Users\boos\Dropbox\My PC
>> (boos-home)\Desktop\dennis\R.packages\Monte.Carlo.se.March.2023/DESCRIPTION'
>> ...?  preparing 'Monte.Carlo.se':?  checking DESCRIPTION
>> meta-information ...?  installing the package to build vignettes?
>> creating vignettes (3.6s)?  checking for LF line-endings in source and
>> make files and shell scripts?  checking for empty or unneeded
>> directories?  building 'Monte.Carlo.se_0.1.1.tar.gz'
>>    ?? Checking
>> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting
>> env vars:
>> ? _R_CHECK_CRAN_INCOMING_REMOTE_               : FALSE
>> ? _R_CHECK_CRAN_INCOMING_                      : FALSE
>> ? _R_CHECK_FORCE_SUGGESTS_                     : FALSE
>> ? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE
>> ? NOT_CRAN                                     : true?? R CMD check
>> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
>>  using log directory 'C:/Users/boos/Dropbox/My PC
>> (boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck' (793ms)?
>> using R version 4.2.3 (2023-03-15 ucrt)?  using platform:
>> x86_64-w64-mingw32 (64-bit)?  using session charset: UTF-8?  using
>> options '--no-manual --as-cran' (653ms)?  checking for file
>> 'Monte.Carlo.se/DESCRIPTION'?  checking extension type ... Package?
>> this is package 'Monte.Carlo.se' version '0.1.1'?  package encoding:
>> UTF-8?  checking package namespace information?  checking package
>> dependencies (3.2s)?  checking if this is a source package?  checking
>> if there is a namespace?  checking for executable files (491ms)?
>> checking for hidden files and directories ...?  checking for portable
>> file names?  checking serialization versions?  checking whether
>> package 'Monte.Carlo.se' can be installed (2.9s)?  checking installed
>> package size ... ?  checking package directory ...?  checking for
>> future file timestamps ... ?  checking 'build' directory?  checking
>> DESCRIPTION meta-information ... ?  checking top-level files ...?
>> checking for left-over files?  checking index information ... ?
>> checking package subdirectories ... ?  checking R files for non-ASCII
>> characters ... ?  checking R files for syntax errors ... ?  checking
>> whether the package can be loaded ... ?  checking whether the package
>> can be loaded with stated dependencies ... ?  checking whether the
>> package can be unloaded cleanly ... ?  checking whether the namespace
>> can be loaded with stated dependencies ... ?  checking whether the
>> namespace can be unloaded cleanly ... ?  checking loading without
>> being on the library search path ... N  checking dependencies in R
>> code ...
>>    Namespace in Imports field not imported from: 'stats'
>>      All declared Imports should be used.?  checking S3 generic/method
>> consistency (422ms)?  checking replacement functions ... ?  checking
>> foreign function calls ... N  checking R code for possible problems
>> (3s)
>>    boot.se: no visible global function definition for 'sd'
>>    boot.var: no visible global function definition for 'var'
>>    corr: no visible global function definition for 'cor'
>>    cv: no visible global function definition for 'sd'
>>    ratio.mean.sdhat.sd: no visible global function definition for 'sd'
>>    ratio.mean.vhat.var: no visible global function definition for 'var'
>>    ratio.sd: no visible global function definition for 'sd'
>>    ratio.var: no visible global function definition for 'var'
>>    varn: no visible global function definition for 'var'
>>    Undefined global functions or variables:
>>      cor sd var
>>    Consider adding
>>      importFrom("stats", "cor", "sd", "var")
>>    to your NAMESPACE file.?  checking Rd files ... ?  checking Rd
>> metadata ... ?  checking Rd line widths ... ?  checking Rd
>> cross-references ... ?  checking for missing documentation entries ...
>> ?  checking for code/documentation mismatches (562ms)?  checking Rd
>> \usage sections (661ms)?  checking Rd contents ... ?  checking for
>> unstated dependencies in examples ... ?  checking installed files from
>> 'inst/doc'W  checking files in 'vignettes' ...
>>    Files in the 'vignettes' directory newer than same file in 'inst/doc':
>>      'Brief-Overview.Rmd'?  checking examples (573ms)?  checking
>> examples with --run-donttest ... [24s] OK (24.7s)?  checking for
>> unstated dependencies in vignettes ... ?  checking package vignettes
>> in 'inst/doc' ...?  checking re-building of vignette outputs (6.8s)?
>> checking for non-standard things in the check directory ...?  checking
>> for detritus in the temp directory
>>
>>    See
>>      'C:/Users/boos/Dropbox/My PC
>> (boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck/00check.log'
>>    for details.
>>
>>    ?? R CMD check results
>> ???????????????????????????????????????????????????????????????????????????????????
>> Monte.Carlo.se 0.1.1 ????
>> Duration: 51.5s
>> ? checking files in 'vignettes' ... WARNING
>>   Files in the 'vignettes' directory newer than same file in 'inst/doc':
>>     'Brief-Overview.Rmd'
>> ? checking dependencies in R code ... NOTE
>>   Namespace in Imports field not imported from: 'stats'
>>     All declared Imports should be used.
>> ? checking R code for possible problems ... NOTE
>>   boot.se: no visible global function definition for 'sd'
>>   boot.var: no visible global function definition for 'var'
>>   corr: no visible global function definition for 'cor'
>>   cv: no visible global function definition for 'sd'
>>   ratio.mean.sdhat.sd: no visible global function definition for 'sd'
>>   ratio.mean.vhat.var: no visible global function definition for 'var'
>>   ratio.sd: no visible global function definition for 'sd'
>>   ratio.var: no visible global function definition for 'var'
>>   varn: no visible global function definition for 'var'
>>   Undefined global functions or variables:
>>     cor sd var
>>   Consider adding
>>     importFrom("stats", "cor", "sd", "var")
>>   to your NAMESPACE file.
>> 0 errors ? | 1 warning ? | 2 notes ?
>> Error: R CMD check found WARNINGs
>> Execution halted
>>
>> Exited with status 1.
>>
>>
>>
>>
>>
>> On Sat, Apr 1, 2023 at 5:34?PM Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>
>>> On 31/03/2023 4:51 p.m., Dennis Boos wrote:
>>> > Recently I got a message from CRAN that my package Monte.Carlo.se (on
>>> CRAN
>>> > for the last few years) does not pass current testing.  There seemed
>>> > to
>>> be
>>> > 2 problems:
>>> >
>>> >
>>> ***************************************************************************************************************
>>> >
>>> > 1. * checking LazyData ... NOTE
>>> >    'LazyData' is specified without a 'data' directory
>>> >
>>> > I have this line in my DESCRIPTION file:
>>> >
>>> > LazyData: true
>>> >
>>> > Should I remove that?
>>> >
>>> >
>>> *****************************************************************************************************************
>>> >
>>> > 2. * checking examples with --run-donttest ... [42s/42s] ERROR
>>> > Running examples in ?Monte.Carlo.se-Ex.R? failed
>>> > The error most likely occurred in:
>>> >
>>> >> pairwise.se(hold,xcol=10:12,summary.f=cv)
>>> > Error: object 'hold' not found
>>> > Execution halted
>>> >
>>> >
>>> ***************************************************************************************
>>> >
>>> > So, I put in the R code to generate the data matrix *hold.  *But that
>>> > brought a host of other errors when checking in Rstudio with
>>> >
>>> >>
>>> devtools::check("S:/Documents/srcis/a.projects/Monte.Carlo.isr.and.package/Monte.Carlo.se.March.2023")
>>> >
>>> > I started seeing the following list about standard functions like sd.
>>> >
>>> > N  checking R code for possible problems (3.4s)
>>> >     boot.se: no visible global function definition for 'sd'
>>> >     boot.var: no visible global function definition for 'var'
>>> >     corr: no visible global function definition for 'cor'
>>> >     cv: no visible global function definition for 'sd'
>>> >     ratio.mean.sdhat.sd: no visible global function definition for
>>> > 'sd'
>>> >     ratio.mean.vhat.var: no visible global function definition for
>>> > 'var'
>>> >     ratio.sd: no visible global function definition for 'sd'
>>> >     ratio.var: no visible global function definition for 'var'
>>> >     varn: no visible global function definition for 'var'
>>> >     Undefined global functions or variables:
>>> >       cor sd var
>>> >     Consider adding
>>> >       importFrom("stats", "cor", "sd", "var")
>>> >     to your NAMESPACE file.
>>> >
>>> > But you can't add those functions to NAMESPACE. Well I did but
>>> >
>>> > devtools::build()
>>> >
>>> >
>>> > gets rid of it. Also, I keep getting the message in the Rstudio check
>>> >
>>> > WARNING
>>> >     'qpdf' is needed for checks on size reduction of PDFs
>>> >
>>> >
>>> > but I got the latest versions of R and Rstudio and was able to get
>>> > qpdf to install and loaded with library(qpdf), but Rstudio still gives
>>> > that message.
>>> >
>>>
>>> It sounds as though you're using Roxygen2 to generate your NAMESPACE
>>> file.  If so, you need @imports directives in the comments
>>> (conventionally before the function that uses the import, but I think it
>>> doesn't really matter where).
>>>
>>> Duncan Murdoch
>>>
>>>
>>
>> --
>> Dennis Boos                      email: dennis_boos at ncsu.edu
>> Department of Statistics    Phone: 919-515-1918
>> NC State University           Fax: 919-515-1169
>> Raleigh, NC 27695-8203   http://www4.stat.ncsu.edu/~boos
>>
>> Aim for kindness, tolerance, and humility.
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>


From ||one| @end|ng |rom po@|t@co  Tue Apr  4 22:19:15 2023
From: ||one| @end|ng |rom po@|t@co (Lionel Henry)
Date: Tue, 4 Apr 2023 22:19:15 +0200
Subject: [R-pkg-devel] correcting errors in an existing package
In-Reply-To: <CAJf4E3qDNekz5BRLS0Wt8E=698T4e-QFVHhKTTfrvZHEB-U6og@mail.gmail.com>
References: <CAJJ-gHw4O47SvoLHCeMxiTAsFWwCpJdxpZhom-4jRW5Onmp0QQ@mail.gmail.com>
 <c6b52458-35c0-8ef4-93aa-d37c50769460@gmail.com>
 <CAJJ-gHznV18NyPtuweYaGFdxisLTc+j26eN_uR2WVYzxttSG0Q@mail.gmail.com>
 <CAJf4E3ptG7j1M5MVUUvhx=S6DTzhiL0ksrD=X1uaVyAEw1+HjQ@mail.gmail.com>
 <CAJf4E3qDNekz5BRLS0Wt8E=698T4e-QFVHhKTTfrvZHEB-U6og@mail.gmail.com>
Message-ID: <CAJf4E3oQfZe20XcQhTndM_2=qHbPfBNJpyMuCKZWVmeGzizkmw@mail.gmail.com>

Hi Dennis,

I'm reincluding the list so that other people can see the clarifications too.

On 4/4/23, Dennis Boos <boos at ncsu.edu> wrote:

> Thanks so much. Could you give me a little more clarity?
>
> 1. Where do I add
>
> #' @importFrom stats var sd etc
>
> Within the R functions? Each one separately
>
> 2. Was "NULL" part of the code you meant me to use?

The roxygen code needs to be attached to some objects. You can include
the importFrom line as part of the docstring of another function but
since an import is often used in many functions it makes more sense to
declare them separately. Here I've used the `NULL` object for these
declarations, another option would have been "_PACKAGE", see
https://r-pkgs.org/man.html#sec-man-package-doc


> 3. I had no idea that the "check" remakes the tar.gz file from the folder.
> I thought it would have wanted to work off the created tar.gz because
> that's what we submit.

In the devtools workflow we rarely work directly with tar.gz files. They
are created behind the scene in the temp folder. At submission time we
use `devtools::release()` to create and send the tarball to CRAN.

Of course it's also fine to use the manual workflow or mix both.

Best,
Lionel

On 4/4/23, Lionel Henry <lionel at posit.co> wrote:
>> Here is my namespace.  It says not to edit, but I had been told to add
>> the importFrom. So I didn't use
>> devtools::document() for fear roxygen2 would get rid of it.
>
> `devtools::check()` calls `document()` automatically so your changes to
> the NAMESPACE file get overwritten. You can see this in the output.
>
> To solve this, add the appropriate roxygen2 tag somewhere in your package
> e.g.
>
> ```
> #' @importFrom stats var sd etc
> NULL
> ```
>
> Best,
> Lionel
>
> On 4/4/23, Lionel Henry <lionel at posit.co> wrote:
>>> Here is my namespace.  It says not to edit, but I had been told to add
>>> the importFrom. So I didn't use
>>> devtools::document() for fear roxygen2 would get rid of it.
>>
>> `devtools::check()` calls `document()` automatically so your changes to
>> the NAMESPACE file get overwritten. You can see this in the output.
>>
>> To solve this, add the appropriate roxygen2 tag somewhere in your package
>> e.g.
>>
>> ```
>> #' @importFrom stats var sd etc
>> NULL
>> ```
>>
>> Best,
>> Lionel
>>
>> On 4/4/23, Dennis Boos <boos at ncsu.edu> wrote:
>>> Thanks so much to all of you.  If you have time, I'm getting really
>>> contradictory results.
>>>
>>> 1. It first seemed to have passed the check in Rstudio (I used
>>> device::build() in the R window and then clicked on check in the drop
>>> down
>>> menu under build).
>>>
>>> ==> devtools::check(document = FALSE, args = c('--as-cran'))
>>> ?? R CMD check results  Monte.Carlo.se 0.1.1 ????
>>> Duration: 56.6s
>>> 0 errors ? | 0 warnings ? | 0 notes ?
>>>
>>> R CMD check succeeded
>>>
>>> However, I then couldn't find the tar.gz where it was supposed to be. It
>>> was just gone.
>>>
>>>
>>> Here is my namespace.  It says not to edit, but I had been told to add
>>> the importFrom. So I didn't use
>>> devtools::document() for fear roxygen2 would get rid of it.
>>>
>>> # Generated by roxygen2: do not edit by hand
>>> importFrom("stats", "cor", "sd", "var")
>>> export(boot.se)
>>> export(jack.se)
>>> export(mc.se.matrix)
>>> export(mc.se.vector)
>>> export(pairwise.se)
>>> export(sim.samp)
>>>
>>> 4. Here is my DESCRIPTION file
>>>
>>> Package: Monte.Carlo.se
>>> Type: Package
>>> Title: Monte Carlo Standard Errors
>>> Version: 0.1.1
>>> Author: Dennis Boos, Kevin Matthew, Jason Osborne
>>> Maintainer: Dennis Boos <boos at ncsu.edu>
>>> Description: Computes Monte Carlo standard errors for summaries of
>>> Monte Carlo output. Summaries and their standard errors are based on
>>> columns of Monte Carlo simulation output. Dennis D. Boos and Jason A.
>>> Osborne (2015) <doi:10.1111/insr.12087>.
>>> License: GPL-3
>>> Encoding: UTF-8
>>> RoxygenNote: 7.2.3
>>> Suggests: knitr, rmarkdown
>>> Imports: stats
>>> VignetteBuilder: knitr
>>>
>>> 5. And because of your advice: " It sounds as though you're using
>>> Roxygen2 to generate your NAMESPACE file.
>>> ff so, you need @imports directives in the comments
>>> (conventionally before the function that uses the import, but I think it
>>> doesn't really matter where)."
>>>
>>> So I put "@imports" in the function that had trouble
>>>
>>> #' @examples
>>> #' \donttest{
>>> #' # Using the output data matrix hold generated in vignette Example3,
>>> #' # calculate jackknife and bootstrap standard errors
>>> #' # for the differences and ratios of the CV estimates.
>>> #' # First get the components of hold needed.
>>> #'
>>> #' @imports
>>> #'
>>> #' trim20 <- function(x){mean(x,.2)} # 20% trimmed mean function
>>>
>>> Was that the correct thing to do?
>>>
>>> 6. And here are the failed check results. I'm clueless at this point.
>>>
>>> ==> devtools::check(document = FALSE, args = c('--as-cran'))
>>> ?? Building
>>> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting
>>> env vars:
>>> ? CFLAGS    : -Wall -pedantic -fdiagnostics-color=always
>>> ? CXXFLAGS  : -Wall -pedantic -fdiagnostics-color=always
>>> ? CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always
>>> ? CXX14FLAGS: -Wall -pedantic -fdiagnostics-color=always
>>> ? CXX17FLAGS: -Wall -pedantic -fdiagnostics-color=always
>>> ? CXX20FLAGS: -Wall -pedantic -fdiagnostics-color=always?? R CMD build
>>> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
>>>  checking for file 'C:\Users\boos\Dropbox\My PC
>>> (boos-home)\Desktop\dennis\R.packages\Monte.Carlo.se.March.2023/DESCRIPTION'
>>> ...?  preparing 'Monte.Carlo.se':?  checking DESCRIPTION
>>> meta-information ...?  installing the package to build vignettes?
>>> creating vignettes (3.6s)?  checking for LF line-endings in source and
>>> make files and shell scripts?  checking for empty or unneeded
>>> directories?  building 'Monte.Carlo.se_0.1.1.tar.gz'
>>>    ?? Checking
>>> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????Setting
>>> env vars:
>>> ? _R_CHECK_CRAN_INCOMING_REMOTE_               : FALSE
>>> ? _R_CHECK_CRAN_INCOMING_                      : FALSE
>>> ? _R_CHECK_FORCE_SUGGESTS_                     : FALSE
>>> ? _R_CHECK_PACKAGES_USED_IGNORE_UNUSED_IMPORTS_: FALSE
>>> ? NOT_CRAN                                     : true?? R CMD check
>>> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
>>>  using log directory 'C:/Users/boos/Dropbox/My PC
>>> (boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck' (793ms)?
>>> using R version 4.2.3 (2023-03-15 ucrt)?  using platform:
>>> x86_64-w64-mingw32 (64-bit)?  using session charset: UTF-8?  using
>>> options '--no-manual --as-cran' (653ms)?  checking for file
>>> 'Monte.Carlo.se/DESCRIPTION'?  checking extension type ... Package?
>>> this is package 'Monte.Carlo.se' version '0.1.1'?  package encoding:
>>> UTF-8?  checking package namespace information?  checking package
>>> dependencies (3.2s)?  checking if this is a source package?  checking
>>> if there is a namespace?  checking for executable files (491ms)?
>>> checking for hidden files and directories ...?  checking for portable
>>> file names?  checking serialization versions?  checking whether
>>> package 'Monte.Carlo.se' can be installed (2.9s)?  checking installed
>>> package size ... ?  checking package directory ...?  checking for
>>> future file timestamps ... ?  checking 'build' directory?  checking
>>> DESCRIPTION meta-information ... ?  checking top-level files ...?
>>> checking for left-over files?  checking index information ... ?
>>> checking package subdirectories ... ?  checking R files for non-ASCII
>>> characters ... ?  checking R files for syntax errors ... ?  checking
>>> whether the package can be loaded ... ?  checking whether the package
>>> can be loaded with stated dependencies ... ?  checking whether the
>>> package can be unloaded cleanly ... ?  checking whether the namespace
>>> can be loaded with stated dependencies ... ?  checking whether the
>>> namespace can be unloaded cleanly ... ?  checking loading without
>>> being on the library search path ... N  checking dependencies in R
>>> code ...
>>>    Namespace in Imports field not imported from: 'stats'
>>>      All declared Imports should be used.?  checking S3 generic/method
>>> consistency (422ms)?  checking replacement functions ... ?  checking
>>> foreign function calls ... N  checking R code for possible problems
>>> (3s)
>>>    boot.se: no visible global function definition for 'sd'
>>>    boot.var: no visible global function definition for 'var'
>>>    corr: no visible global function definition for 'cor'
>>>    cv: no visible global function definition for 'sd'
>>>    ratio.mean.sdhat.sd: no visible global function definition for 'sd'
>>>    ratio.mean.vhat.var: no visible global function definition for 'var'
>>>    ratio.sd: no visible global function definition for 'sd'
>>>    ratio.var: no visible global function definition for 'var'
>>>    varn: no visible global function definition for 'var'
>>>    Undefined global functions or variables:
>>>      cor sd var
>>>    Consider adding
>>>      importFrom("stats", "cor", "sd", "var")
>>>    to your NAMESPACE file.?  checking Rd files ... ?  checking Rd
>>> metadata ... ?  checking Rd line widths ... ?  checking Rd
>>> cross-references ... ?  checking for missing documentation entries ...
>>> ?  checking for code/documentation mismatches (562ms)?  checking Rd
>>> \usage sections (661ms)?  checking Rd contents ... ?  checking for
>>> unstated dependencies in examples ... ?  checking installed files from
>>> 'inst/doc'W  checking files in 'vignettes' ...
>>>    Files in the 'vignettes' directory newer than same file in
>>> 'inst/doc':
>>>      'Brief-Overview.Rmd'?  checking examples (573ms)?  checking
>>> examples with --run-donttest ... [24s] OK (24.7s)?  checking for
>>> unstated dependencies in vignettes ... ?  checking package vignettes
>>> in 'inst/doc' ...?  checking re-building of vignette outputs (6.8s)?
>>> checking for non-standard things in the check directory ...?  checking
>>> for detritus in the temp directory
>>>
>>>    See
>>>      'C:/Users/boos/Dropbox/My PC
>>> (boos-home)/Desktop/dennis/R.packages/Monte.Carlo.se.Rcheck/00check.log'
>>>    for details.
>>>
>>>    ?? R CMD check results
>>> ???????????????????????????????????????????????????????????????????????????????????
>>> Monte.Carlo.se 0.1.1 ????
>>> Duration: 51.5s
>>> ? checking files in 'vignettes' ... WARNING
>>>   Files in the 'vignettes' directory newer than same file in 'inst/doc':
>>>     'Brief-Overview.Rmd'
>>> ? checking dependencies in R code ... NOTE
>>>   Namespace in Imports field not imported from: 'stats'
>>>     All declared Imports should be used.
>>> ? checking R code for possible problems ... NOTE
>>>   boot.se: no visible global function definition for 'sd'
>>>   boot.var: no visible global function definition for 'var'
>>>   corr: no visible global function definition for 'cor'
>>>   cv: no visible global function definition for 'sd'
>>>   ratio.mean.sdhat.sd: no visible global function definition for 'sd'
>>>   ratio.mean.vhat.var: no visible global function definition for 'var'
>>>   ratio.sd: no visible global function definition for 'sd'
>>>   ratio.var: no visible global function definition for 'var'
>>>   varn: no visible global function definition for 'var'
>>>   Undefined global functions or variables:
>>>     cor sd var
>>>   Consider adding
>>>     importFrom("stats", "cor", "sd", "var")
>>>   to your NAMESPACE file.
>>> 0 errors ? | 1 warning ? | 2 notes ?
>>> Error: R CMD check found WARNINGs
>>> Execution halted
>>>
>>> Exited with status 1.
>>>
>>>
>>>
>>>
>>>
>>> On Sat, Apr 1, 2023 at 5:34?PM Duncan Murdoch <murdoch.duncan at gmail.com>
>>> wrote:
>>>
>>>> On 31/03/2023 4:51 p.m., Dennis Boos wrote:
>>>> > Recently I got a message from CRAN that my package Monte.Carlo.se (on
>>>> CRAN
>>>> > for the last few years) does not pass current testing.  There seemed
>>>> > to
>>>> be
>>>> > 2 problems:
>>>> >
>>>> >
>>>> ***************************************************************************************************************
>>>> >
>>>> > 1. * checking LazyData ... NOTE
>>>> >    'LazyData' is specified without a 'data' directory
>>>> >
>>>> > I have this line in my DESCRIPTION file:
>>>> >
>>>> > LazyData: true
>>>> >
>>>> > Should I remove that?
>>>> >
>>>> >
>>>> *****************************************************************************************************************
>>>> >
>>>> > 2. * checking examples with --run-donttest ... [42s/42s] ERROR
>>>> > Running examples in ?Monte.Carlo.se-Ex.R? failed
>>>> > The error most likely occurred in:
>>>> >
>>>> >> pairwise.se(hold,xcol=10:12,summary.f=cv)
>>>> > Error: object 'hold' not found
>>>> > Execution halted
>>>> >
>>>> >
>>>> ***************************************************************************************
>>>> >
>>>> > So, I put in the R code to generate the data matrix *hold.  *But that
>>>> > brought a host of other errors when checking in Rstudio with
>>>> >
>>>> >>
>>>> devtools::check("S:/Documents/srcis/a.projects/Monte.Carlo.isr.and.package/Monte.Carlo.se.March.2023")
>>>> >
>>>> > I started seeing the following list about standard functions like sd.
>>>> >
>>>> > N  checking R code for possible problems (3.4s)
>>>> >     boot.se: no visible global function definition for 'sd'
>>>> >     boot.var: no visible global function definition for 'var'
>>>> >     corr: no visible global function definition for 'cor'
>>>> >     cv: no visible global function definition for 'sd'
>>>> >     ratio.mean.sdhat.sd: no visible global function definition for
>>>> > 'sd'
>>>> >     ratio.mean.vhat.var: no visible global function definition for
>>>> > 'var'
>>>> >     ratio.sd: no visible global function definition for 'sd'
>>>> >     ratio.var: no visible global function definition for 'var'
>>>> >     varn: no visible global function definition for 'var'
>>>> >     Undefined global functions or variables:
>>>> >       cor sd var
>>>> >     Consider adding
>>>> >       importFrom("stats", "cor", "sd", "var")
>>>> >     to your NAMESPACE file.
>>>> >
>>>> > But you can't add those functions to NAMESPACE. Well I did but
>>>> >
>>>> > devtools::build()
>>>> >
>>>> >
>>>> > gets rid of it. Also, I keep getting the message in the Rstudio check
>>>> >
>>>> > WARNING
>>>> >     'qpdf' is needed for checks on size reduction of PDFs
>>>> >
>>>> >
>>>> > but I got the latest versions of R and Rstudio and was able to get
>>>> > qpdf to install and loaded with library(qpdf), but Rstudio still
>>>> > gives
>>>> > that message.
>>>> >
>>>>
>>>> It sounds as though you're using Roxygen2 to generate your NAMESPACE
>>>> file.  If so, you need @imports directives in the comments
>>>> (conventionally before the function that uses the import, but I think
>>>> it
>>>> doesn't really matter where).
>>>>
>>>> Duncan Murdoch
>>>>
>>>>
>>>
>>> --
>>> Dennis Boos                      email: dennis_boos at ncsu.edu
>>> Department of Statistics    Phone: 919-515-1918
>>> NC State University           Fax: 919-515-1169
>>> Raleigh, NC 27695-8203   http://www4.stat.ncsu.edu/~boos
>>>
>>> Aim for kindness, tolerance, and humility.
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>


From |@w@onj@|7net @end|ng |rom gm@||@com  Tue Apr  4 22:28:52 2023
From: |@w@onj@|7net @end|ng |rom gm@||@com (John Lawson)
Date: Tue, 4 Apr 2023 14:28:52 -0600
Subject: [R-pkg-devel] What checks are required before uploading a package
 to CRAN?
Message-ID: <CAJiVmSCVmKoSTcGOeUoBHKWH8Yvf9X4Q2jmoy8X+tCW08pMmfg@mail.gmail.com>

My R package checks on my windows computer with no errors, warnings or
notes. Next I used the win-builder upload page to check the package. I
uploaded the tar.gz file on R-release. I read the 00check.log file and
the only Note stated was that I was the developer. I understood that I
needed to upload the file to both R-release and R-devel before I could
upload it to the cran.r-project.org/submit.html page. I tried to
upload the file to the R-devel, but I got the following message.

ERROR: Access to the path
'C:\Inetpub\ftproot\R-devel\daewr_1.2-9.tar.gz' is denied. (perhaps
you uploaded already and the file has not been processed yet?)

It has been 4 days since I uploaded the file to R-release, and I get
automatic emails every other day from Uwe Ligges telling me my package
has been checked and built.

What checks are required before uploading the package tar.gz file to
the cran.r-project.org/submit.html page?

John Lawson


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Apr  5 09:17:45 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 5 Apr 2023 10:17:45 +0300
Subject: [R-pkg-devel] 
 What checks are required before uploading a package to CRAN?
In-Reply-To: <CAJiVmSCVmKoSTcGOeUoBHKWH8Yvf9X4Q2jmoy8X+tCW08pMmfg@mail.gmail.com>
References: <CAJiVmSCVmKoSTcGOeUoBHKWH8Yvf9X4Q2jmoy8X+tCW08pMmfg@mail.gmail.com>
Message-ID: <20230405101745.3588f05c@Tarkus>

On Tue, 4 Apr 2023 14:28:52 -0600
John Lawson <lawsonjsl7net at gmail.com> wrote:

> ERROR: Access to the path
> 'C:\Inetpub\ftproot\R-devel\daewr_1.2-9.tar.gz' is denied. (perhaps
> you uploaded already and the file has not been processed yet?)
> 
> It has been 4 days since I uploaded the file to R-release, and I get
> automatic emails every other day from Uwe Ligges telling me my package
> has been checked and built.

This might need some help from Uwe Ligges to resolve the package queue
problems.

> What checks are required before uploading the package tar.gz file to
> the cran.r-project.org/submit.html page?

The policy strongly recommends checking the package with R-devel but
doesn't require you to use Win-Builder. You can get R-devel for Windows
from <https://cran.r-project.org/bin/windows/base/rdevel.html> and run
R CMD check from that.

If you don't want to install additional software, you can use R-hub
<https://builder.r-hub.io/advanced> and other package checking services.
They don't run exactly the same software on exactly the same hardware
as CRAN checks, but they do fulfil the requirement to have your package
checked by R-devel.

-- 
Best regards,
Ivan


From rodr|go@tob@rc@rr|zo @end|ng |rom uw@@edu@@u  Wed Apr  5 09:45:14 2023
From: rodr|go@tob@rc@rr|zo @end|ng |rom uw@@edu@@u (Rodrigo Tobar Carrizo)
Date: Wed, 5 Apr 2023 07:45:14 +0000
Subject: [R-pkg-devel] OpenMP and CRAN checks
In-Reply-To: <25644.11616.284536.185116@rob.eddelbuettel.com>
References: <SYCPR01MB40477F5D574DBBC27DD0F32BA9939@SYCPR01MB4047.ausprd01.prod.outlook.com>
 <25644.11616.284536.185116@rob.eddelbuettel.com>
Message-ID: <SYCPR01MB4047F1337590AB97ED22DD41A9909@SYCPR01MB4047.ausprd01.prod.outlook.com>

Hi Dirk,

Thanks for your response. In a way this is more or less what I knew we would have to end up doing (i.e., explicit limit ourselves to 2 CPUs maximum for anything running on CRAN), but it still confuses me why this didn't just happen, given how CRAN sets OMP_THREAD_LIMIT=2 already, which should constrain us automatically.

I've taken your advice onboard and put in a very similar function that I am then invoking in all examples, tests and vignettes. Our code uses roxygen2, and there are 150 @examples in the inline documentation, so a midly complex sed command did the trick. The vignettes and tests were not as bad.

We'll try a resubmission and see how we fare.

Thanks again,

Rodrigo
________________________________
Von: Dirk Eddelbuettel <edd at debian.org>
Gesendet: Dienstag, 4. April 2023 22:00
An: Rodrigo Tobar Carrizo <rodrigo.tobarcarrizo at uwa.edu.au>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Betreff: Re: [R-pkg-devel] OpenMP and CRAN checks


Hi Rodrigo,

This came up recently again on social media where I illustrated how the
tiledb package deals with it. So a quick recap:

First off, let's make the goals clear.

We want to _simultaneously_
 - abide by CRAN Policy rules and cap ourselves to two cores there
 - do not impose any limits on our users: ALL cores ALL the time

The solution we implemented a while is to use a function _that is an opt-in_
which looks at the standard OpenMP variable as well as at R's own Ncpus:

    limitTileDBCores <- function(ncores, verbose=FALSE) {
      if (missing(ncores)) {
        ## start with a simple fallback: 'Ncpus' (if set) or else 2
        ncores <- getOption("Ncpus", 2L)
        ## also consider OMP_THREAD_LIMIT (cf Writing R Extensions), gets NA if envvar unset
        ompcores <- as.integer(Sys.getenv("OMP_THREAD_LIMIT"))
        ## and then keep the smaller
        ncores <- min(na.omit(c(ncores, ompcores)))
      }
      stopifnot(`The 'ncores' argument must be numeric or character` = is.numeric(ncores) || is.character(ncores))
      ## for brevity omitted here how ncores propagates to TileDB library -- creates `cfg`
      if (verbose) message("Limiting TileDB to ",ncores," cores. See ?limitTileDBCores.")
      invisible(cfg)
    }

The key is that we reflect the smaller of Ncpus and OMP_THREAD_LIMIT along
with a fall-back of two in case nothing is set.

That function is then called (and feeds into the library config) at the
beginning of each
 - help file example
 - unit test file
 - vignette

As example (from a help file) is

    \dontshow{ctx <- tiledb_ctx(limitTileDBCores())}

(where ctx a context object controlling, inter alia, the thread pool).

By throttling it anywhere CRAN executes code, and using the prescribed
maximum of two core, we satisfy goal one of not getting thrown off CRAN. By
making it an _explicit_ opt-in we satisfy our goal of never slowing down our
users who (presumably) do not opt in. And those who have, say, Ncpus set (as
I do to spread R's own package installations over all my cores) get the
maximum performance for examples, tests, and vignettes too as they opted in.

"Works for us" as they say.

Hope this helps,  Dirk

--
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Apr  5 11:08:25 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 5 Apr 2023 11:08:25 +0200
Subject: [R-pkg-devel] 
 What checks are required before uploading a package to CRAN?
In-Reply-To: <20230405101745.3588f05c@Tarkus>
References: <CAJiVmSCVmKoSTcGOeUoBHKWH8Yvf9X4Q2jmoy8X+tCW08pMmfg@mail.gmail.com>
 <20230405101745.3588f05c@Tarkus>
Message-ID: <bd2ecfc2-fb5d-b4da-c10b-24f8fdbbeab0@statistik.tu-dortmund.de>



On 05.04.2023 09:17, Ivan Krylov wrote:
> On Tue, 4 Apr 2023 14:28:52 -0600
> John Lawson <lawsonjsl7net at gmail.com> wrote:
> 
>> ERROR: Access to the path
>> 'C:\Inetpub\ftproot\R-devel\daewr_1.2-9.tar.gz' is denied. (perhaps
>> you uploaded already and the file has not been processed yet?)
>>
>> It has been 4 days since I uploaded the file to R-release, and I get
>> automatic emails every other day from Uwe Ligges telling me my package
>> has been checked and built.

Interesting, you shouild receive one mail for each upload.
Can yoiu tell me when you got an unexpected one? Can you forward it to me?

I do not see a package in any of the queues right now.

Best,
Uwe Ligges



> 
> This might need some help from Uwe Ligges to resolve the package queue
> problems.
> 
>> What checks are required before uploading the package tar.gz file to
>> the cran.r-project.org/submit.html page?
> 
> The policy strongly recommends checking the package with R-devel but
> doesn't require you to use Win-Builder. You can get R-devel for Windows
> from <https://cran.r-project.org/bin/windows/base/rdevel.html> and run
> R CMD check from that.
> 
> If you don't want to install additional software, you can use R-hub
> <https://builder.r-hub.io/advanced> and other package checking services.
> They don't run exactly the same software on exactly the same hardware
> as CRAN checks, but they do fulfil the requirement to have your package
> checked by R-devel.
>


From c|yde @end|ng |rom duke@edu  Fri Apr  7 18:01:31 2023
From: c|yde @end|ng |rom duke@edu (Merlise Clyde, Ph.D.)
Date: Fri, 7 Apr 2023 16:01:31 +0000
Subject: [R-pkg-devel] Missing quadmath library in r-release-macosx-arm64
Message-ID: <BN7PR05MB3972AF918C1ACF444332BF17C8969@BN7PR05MB3972.namprd05.prod.outlook.com>

I was checking the CRAN check page for my package BAS https://cran.r-project.org/web/checks/check_results_BAS.html

and saw that there has been an ERROR in the check status for r-release-macosx-arm64 for (at least) the last 2 days.   Looking at the check results linked there the package fails installation as it cannot locate the quadmath library:

https://www.r-project.org/nosvn/R.check/r-release-macos-arm64/BAS-00install.html

I am preparing for any update of the package and current testing using mac-builder for r-release and r-devel return no errors, warnings, etc.  (although it appears that r-release for the testing server is using R 4.2.1 ???)

Is this a false positive that may be ignored on submission of a new version or are there any other updates for packages using C/fortran on M1macs that I need to update.   (Can't find quadmath explicitly in WRE, but may have not searched optimally)

In my Makefile I have

??????PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

source code is at https://github.com/merliseclyde/BAS

TIA
Merlise






	[[alternative HTML version deleted]]


From @kw@|mmo @end|ng |rom gm@||@com  Fri Apr  7 21:14:08 2023
From: @kw@|mmo @end|ng |rom gm@||@com (Andrew Simmons)
Date: Fri, 7 Apr 2023 15:14:08 -0400
Subject: [R-pkg-devel] Changing R Package Maintainer
Message-ID: <CAPcHnpSNsci0TVO0Oz5YOgHOZv6PZ92Ggt-8ia+CVp-7Sawf2Q@mail.gmail.com>

Hi,


I'm changing my name and my email address. I've got an update I'd like to
submit to CRAN, I've changed my name and email in my DESCRIPTION.

I couldn't find any details about changing maintainers in the R manuals
unfortunately. Someone online said to just submit the update, CRAN will
send one email to the new address confirming the submission, and another to
the old address confirming the new maintainer. Someone else said to email
CRAN from the old address about the new maintainer and their address, and
wait for a response of approval before submission. It was unclear if that
would be CRAN-submissions at R-project.org or CRAN at R-project.org, but I'd
guess the first.

Has anyone else done this before or does anyone know the best procedure?
Also, given that this isn't a transfer of ownership, I'm still the same
person with a different name, would that make this process easier?


Thank you!

	[[alternative HTML version deleted]]


From h@w|ckh@m @end|ng |rom gm@||@com  Fri Apr  7 21:18:45 2023
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Sat, 8 Apr 2023 07:18:45 +1200
Subject: [R-pkg-devel] Changing R Package Maintainer
In-Reply-To: <CAPcHnpSNsci0TVO0Oz5YOgHOZv6PZ92Ggt-8ia+CVp-7Sawf2Q@mail.gmail.com>
References: <CAPcHnpSNsci0TVO0Oz5YOgHOZv6PZ92Ggt-8ia+CVp-7Sawf2Q@mail.gmail.com>
Message-ID: <CABdHhvG8-RXgYr-fwEis9LV8pkKTCJ7vLQ2a9h+7_+UVNN2WMQ@mail.gmail.com>

Just submit your package, and you'll get an automated email to the old address.

Hadley

On Sat, Apr 8, 2023 at 7:14?AM Andrew Simmons <akwsimmo at gmail.com> wrote:
>
> Hi,
>
>
> I'm changing my name and my email address. I've got an update I'd like to
> submit to CRAN, I've changed my name and email in my DESCRIPTION.
>
> I couldn't find any details about changing maintainers in the R manuals
> unfortunately. Someone online said to just submit the update, CRAN will
> send one email to the new address confirming the submission, and another to
> the old address confirming the new maintainer. Someone else said to email
> CRAN from the old address about the new maintainer and their address, and
> wait for a response of approval before submission. It was unclear if that
> would be CRAN-submissions at R-project.org or CRAN at R-project.org, but I'd
> guess the first.
>
> Has anyone else done this before or does anyone know the best procedure?
> Also, given that this isn't a transfer of ownership, I'm still the same
> person with a different name, would that make this process easier?
>
>
> Thank you!
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://hadley.nz


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Fri Apr  7 21:20:32 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Fri, 7 Apr 2023 21:20:32 +0200
Subject: [R-pkg-devel] Changing R Package Maintainer
In-Reply-To: <CAPcHnpSNsci0TVO0Oz5YOgHOZv6PZ92Ggt-8ia+CVp-7Sawf2Q@mail.gmail.com>
References: <CAPcHnpSNsci0TVO0Oz5YOgHOZv6PZ92Ggt-8ia+CVp-7Sawf2Q@mail.gmail.com>
Message-ID: <7347e306-1492-7154-6195-3e845bb96c95@statistik.tu-dortmund.de>



On 07.04.2023 21:14, Andrew Simmons wrote:
> Hi,
> 
> 
> I'm changing my name and my email address. I've got an update I'd like to
> submit to CRAN, I've changed my name and email in my DESCRIPTION.
> 
> I couldn't find any details about changing maintainers in the R manuals

It is in the CRAN policies.


> unfortunately. Someone online said to just submit the update, CRAN will
> send one email to the new address confirming the submission, and another to
> the old address confirming the new maintainer. 

Yes, that's true.


> Someone else said to email
> CRAN from the old address about the new maintainer and their address, and
> wait for a response of approval before submission. It was unclear if that
> would be CRAN-submissions at R-project.org or CRAN at R-project.org, but I'd
> guess the first.

THis is also a true option. Personally I'd prefer the first way.


> 
> Has anyone else done this before or does anyone know the best procedure?
> Also, given that this isn't a transfer of ownership, I'm still the same
> person with a different name, would that make this process easier?

Same process as we do not know whether it is the same person behind the 
other mail address.


Best,
Uwe Ligges




> 
> 
> Thank you!
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From b@rt-j@n@v@nro@@um @end|ng |rom wur@n|  Tue Apr 11 09:37:23 2023
From: b@rt-j@n@v@nro@@um @end|ng |rom wur@n| (Rossum, Bart-Jan van)
Date: Tue, 11 Apr 2023 07:37:23 +0000
Subject: [R-pkg-devel] Problems on R-devel because of changes in stats
 family function
Message-ID: <AM0PR01MB4369F5226E6481DAF9C1C664B99A9@AM0PR01MB4369.eurprd01.prod.exchangelabs.com>

Hi,

When submitting a new version of my LMMsolver package to CRAN, it fails on the automated tests, see:

Windows: https://win-builder.r-project.org/incoming_pretest/LMMsolver_1.0.5_20230407_120945/Windows/00check.log

I managed to track this down to a change in the output of the family function in the stats package:
https://search.r-project.org/R/refmans/stats/html/family.html

More specifically, it is about a new output in the call to family():

dispersion
(optional since R version 4.3.0) numeric: value of the dispersion parameter, if fixed, or NA_real_ if free.

Even though the documentation seems to suggest this output is optional, I don't see a way to suppress it. In all my calls to family I get an extra output dispersion with value NA.
I need to store the family information in my own outputs for further processing. Also my output are quite complex by themselves so I tend to check my full output objects with outputs previously stored.
Exactly this is giving me problems now. In R 4.3 all of my outputs will have an extra item as well, causing the tests to fail.

I am not sure how to solve this. I could suppress the affected tests when an installation of stats with version >= 4.3 is detected, but that doesn't feel good.
Do you have any other suggestions on how to solve this.

Thanks in advance,
Bart-Jan


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Apr 11 10:45:04 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 11 Apr 2023 04:45:04 -0400
Subject: [R-pkg-devel] Problems on R-devel because of changes in stats
 family function
In-Reply-To: <AM0PR01MB4369F5226E6481DAF9C1C664B99A9@AM0PR01MB4369.eurprd01.prod.exchangelabs.com>
References: <AM0PR01MB4369F5226E6481DAF9C1C664B99A9@AM0PR01MB4369.eurprd01.prod.exchangelabs.com>
Message-ID: <b706ed1a-676a-1283-a9c9-7c13bc6932ee@gmail.com>

On 11/04/2023 3:37 a.m., Rossum, Bart-Jan van wrote:
> Hi,
> 
> When submitting a new version of my LMMsolver package to CRAN, it fails on the automated tests, see:
> 
> Windows: https://win-builder.r-project.org/incoming_pretest/LMMsolver_1.0.5_20230407_120945/Windows/00check.log
> 
> I managed to track this down to a change in the output of the family function in the stats package:
> https://search.r-project.org/R/refmans/stats/html/family.html
> 
> More specifically, it is about a new output in the call to family():
> 
> dispersion
> (optional since R version 4.3.0) numeric: value of the dispersion parameter, if fixed, or NA_real_ if free.
> 
> Even though the documentation seems to suggest this output is optional, I don't see a way to suppress it. In all my calls to family I get an extra output dispersion with value NA.
> I need to store the family information in my own outputs for further processing. Also my output are quite complex by themselves so I tend to check my full output objects with outputs previously stored.
> Exactly this is giving me problems now. In R 4.3 all of my outputs will have an extra item as well, causing the tests to fail.
> 
> I am not sure how to solve this. I could suppress the affected tests when an installation of stats with version >= 4.3 is detected, but that doesn't feel good.
> Do you have any other suggestions on how to solve this.

One way to solve it would be to set the dispersion parameter to NULL 
before doing your comparison.  That should work across R versions.  For 
example,

    f <- gaussian()
    f$dispersion <- NULL
    expect_equal_to_reference(f, "family")

Another possibility would be to save two reference values, e.g.

    f <- gaussian()
    expect_equal_to_reference(f, if (getRversion() < 4.3.0) "oldfamily" 
else "newfamily")

You should do some sort of manual comparison when those two reference 
values are first created to make sure there are no other changes.

Duncan Murdoch


From g|@nm@rco@|bert| @end|ng |rom gm@||@com  Wed Apr 12 10:05:32 2023
From: g|@nm@rco@|bert| @end|ng |rom gm@||@com (Gianmarco Alberti)
Date: Wed, 12 Apr 2023 10:05:32 +0200
Subject: [R-pkg-devel] package not passing automatic checks: no clue as to
 what is causing 2 notes
In-Reply-To: <ac00d786-353e-4192-9ae4-b7d53bf74805@Spark>
References: <ac00d786-353e-4192-9ae4-b7d53bf74805@Spark>
Message-ID: <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>

Dear All,
I trust this email finds you doing well.

I had planned to release a new version of my package, and everything was checking perfectly on my machine and using the???devtools? functions check_win_oldrelease(), check_win_release(), and check_win_devel().

However, after submitting the package to CRAN, I have been notified that the package does not pass the automatic incoming checks. I had a look at the log file (https://win-builder.r-project.org/incoming_pretest/movecost_2.0_20230412_090758/Windows/00check.log) and I see two notes which I do not understand:

* checking HTML version of manual ... [6s] NOTE
Encountered the following conversion/validation errors:
'CreateProcess' failed to run 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'
'CreateProcess' failed to run 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'

* checking for detritus in the temp directory ... NOTE
Found the following files/directories: 'lastMiKTeXException'

Do you have any suggestion as to what can possibly cause those issues, and how to fix them?

Thanks

--
Dr Gianmarco Alberti | Lecturer in Spatial Forensics
BA, MA, PhD (Udine) - Coordinator of the BA dissertations

Department of Criminology - Faculty for Social Wellbeing
Room 332, Humanities B (FEMA)
University of Malta
Msida - MSD 2080 (Malta)
+356 2340 3718

Google Scholar:?https://scholar.google.com/citations?user=tFrJKQ0AAAAJ&hl=en
ResearchGate:?https://www.researchgate.net/profile/Gianmarco_Alberti4
Academia:?https://malta.academia.edu/GianmarcoAlberti
movecost:?https://CRAN.R-project.org/package=movecost
chisquare:?https://CRAN.R-project.org/package=chisquare
CAinterprTools:?https://CRAN.R-project.org/package=CAinterprTools

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed Apr 12 10:14:47 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 12 Apr 2023 04:14:47 -0400
Subject: [R-pkg-devel] 
 package not passing automatic checks: no clue as to
 what is causing 2 notes
In-Reply-To: <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>
References: <ac00d786-353e-4192-9ae4-b7d53bf74805@Spark>
 <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>
Message-ID: <5ba782bc-b13e-79dc-b287-b0b768e4aa2e@gmail.com>

The tidy.exe program is used in some checks of help files.  The error 
messages you have say that it failed to run.  I think that was an issue 
on the CRAN machine, not an issue with your package, so I'd follow the 
instructions in the email you received from CRAN to let them know the 
rejection appears to be a false positive.

Duncan Murdoch

On 12/04/2023 4:05 a.m., Gianmarco Alberti wrote:
> Dear All,
> I trust this email finds you doing well.
> 
> I had planned to release a new version of my package, and everything was checking perfectly on my machine and using the???devtools? functions check_win_oldrelease(), check_win_release(), and check_win_devel().
> 
> However, after submitting the package to CRAN, I have been notified that the package does not pass the automatic incoming checks. I had a look at the log file (https://win-builder.r-project.org/incoming_pretest/movecost_2.0_20230412_090758/Windows/00check.log) and I see two notes which I do not understand:
> 
> * checking HTML version of manual ... [6s] NOTE
> Encountered the following conversion/validation errors:
> 'CreateProcess' failed to run 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'
> 'CreateProcess' failed to run 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'
> 
> * checking for detritus in the temp directory ... NOTE
> Found the following files/directories: 'lastMiKTeXException'
> 
> Do you have any suggestion as to what can possibly cause those issues, and how to fix them?
> 
> Thanks
> 
> --
> Dr Gianmarco Alberti | Lecturer in Spatial Forensics
> BA, MA, PhD (Udine) - Coordinator of the BA dissertations
> 
> Department of Criminology - Faculty for Social Wellbeing
> Room 332, Humanities B (FEMA)
> University of Malta
> Msida - MSD 2080 (Malta)
> +356 2340 3718
> 
> Google Scholar:?https://scholar.google.com/citations?user=tFrJKQ0AAAAJ&hl=en
> ResearchGate:?https://www.researchgate.net/profile/Gianmarco_Alberti4
> Academia:?https://malta.academia.edu/GianmarcoAlberti
> movecost:?https://CRAN.R-project.org/package=movecost
> chisquare:?https://CRAN.R-project.org/package=chisquare
> CAinterprTools:?https://CRAN.R-project.org/package=CAinterprTools
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Apr 12 10:16:15 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 12 Apr 2023 11:16:15 +0300
Subject: [R-pkg-devel] 
 package not passing automatic checks: no clue as to
 what is causing 2 notes
In-Reply-To: <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>
References: <ac00d786-353e-4192-9ae4-b7d53bf74805@Spark>
 <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>
Message-ID: <20230412111615.55dd1545@parabola>

? Wed, 12 Apr 2023 10:05:32 +0200
Gianmarco Alberti <gianmarcoalberti at gmail.com> ?????:

> 'CreateProcess' failed to run
> 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language
> en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'

This is a (transient?) problem on the machine running the check:
something completely prevented HTML Tidy from running, even before the
process would have tried to load the required DLLs. Nothing to do with
your package.

> * checking for detritus in the temp directory ... NOTE
> Found the following files/directories: 'lastMiKTeXException'

I think this is a false positive too. Some other package may have
failed to compile its PDF documentation (at the same time?), which
caused MiKTeX to create this file in the temp directory. Your PDF
manual check resulted in an OK.

Does the automatic e-mail include the instructions on where to reply
with this explanation?

-- 
Best regards,
Ivan


From g|@nm@rco@|bert| @end|ng |rom gm@||@com  Wed Apr 12 10:48:51 2023
From: g|@nm@rco@|bert| @end|ng |rom gm@||@com (Gianmarco Alberti)
Date: Wed, 12 Apr 2023 10:48:51 +0200
Subject: [R-pkg-devel] 
 package not passing automatic checks: no clue as to
 what is causing 2 notes
In-Reply-To: <20230412111615.55dd1545@parabola>
References: <ac00d786-353e-4192-9ae4-b7d53bf74805@Spark>
 <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>
 <20230412111615.55dd1545@parabola>
Message-ID: <a750b115-b043-4e76-a60d-34a13e3a4123@Spark>

Hello,
Thanks for your prompt advices.

I am not an expert?.

I have sent an email to explain that those are likely to be issues on the CRAN?s end, and to inform that I would not mind to wait a while and re-do the entire submission procedure.

Thank you again
Gm

--
Dr Gianmarco Alberti | Lecturer in Spatial Forensics
BA, MA, PhD (Udine) - Coordinator of the BA dissertations

Department of Criminology - Faculty for Social Wellbeing
Room 332, Humanities B (FEMA)
University of Malta
Msida - MSD 2080 (Malta)
+356 2340 3718

Google Scholar:?https://scholar.google.com/citations?user=tFrJKQ0AAAAJ&hl=en
ResearchGate:?https://www.researchgate.net/profile/Gianmarco_Alberti4
Academia:?https://malta.academia.edu/GianmarcoAlberti
movecost:?https://CRAN.R-project.org/package=movecost
chisquare:?https://CRAN.R-project.org/package=chisquare
CAinterprTools:?https://CRAN.R-project.org/package=CAinterprTools
On 12 Apr 2023, 10:16 +0200, Ivan Krylov <krylov.r00t at gmail.com>, wrote:
> ? Wed, 12 Apr 2023 10:05:32 +0200
> Gianmarco Alberti <gianmarcoalberti at gmail.com> ?????:
>
> > 'CreateProcess' failed to run
> > 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language
> > en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'
>
> This is a (transient?) problem on the machine running the check:
> something completely prevented HTML Tidy from running, even before the
> process would have tried to load the required DLLs. Nothing to do with
> your package.
>
> > * checking for detritus in the temp directory ... NOTE
> > Found the following files/directories: 'lastMiKTeXException'
>
> I think this is a false positive too. Some other package may have
> failed to compile its PDF documentation (at the same time?), which
> caused MiKTeX to create this file in the temp directory. Your PDF
> manual check resulted in an OK.
>
> Does the automatic e-mail include the instructions on where to reply
> with this explanation?
>
> --
> Best regards,
> Ivan

	[[alternative HTML version deleted]]


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Wed Apr 12 11:08:47 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Wed, 12 Apr 2023 11:08:47 +0200
Subject: [R-pkg-devel] 
 package not passing automatic checks: no clue as to
 what is causing 2 notes
In-Reply-To: <a750b115-b043-4e76-a60d-34a13e3a4123@Spark>
References: <ac00d786-353e-4192-9ae4-b7d53bf74805@Spark>
 <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>
 <20230412111615.55dd1545@parabola>
 <a750b115-b043-4e76-a60d-34a13e3a4123@Spark>
Message-ID: <afcdc5ae-3b82-08d5-222b-b5cb5b57cd91@statistik.tu-dortmund.de>

Indeed, a hicc up of the Windows builder.
Should be resolved.

Best,
Uwe Ligges


On 12.04.2023 10:48, Gianmarco Alberti wrote:
> Hello,
> Thanks for your prompt advices.
> 
> I am not an expert?.
> 
> I have sent an email to explain that those are likely to be issues on the CRAN?s end, and to inform that I would not mind to wait a while and re-do the entire submission procedure.
> 
> Thank you again
> Gm
> 
> --
> Dr Gianmarco Alberti | Lecturer in Spatial Forensics
> BA, MA, PhD (Udine) - Coordinator of the BA dissertations
> 
> Department of Criminology - Faculty for Social Wellbeing
> Room 332, Humanities B (FEMA)
> University of Malta
> Msida - MSD 2080 (Malta)
> +356 2340 3718
> 
> Google Scholar:?https://scholar.google.com/citations?user=tFrJKQ0AAAAJ&hl=en
> ResearchGate:?https://www.researchgate.net/profile/Gianmarco_Alberti4
> Academia:?https://malta.academia.edu/GianmarcoAlberti
> movecost:?https://CRAN.R-project.org/package=movecost
> chisquare:?https://CRAN.R-project.org/package=chisquare
> CAinterprTools:?https://CRAN.R-project.org/package=CAinterprTools
> On 12 Apr 2023, 10:16 +0200, Ivan Krylov <krylov.r00t at gmail.com>, wrote:
>> ? Wed, 12 Apr 2023 10:05:32 +0200
>> Gianmarco Alberti <gianmarcoalberti at gmail.com> ?????:
>>
>>> 'CreateProcess' failed to run
>>> 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language
>>> en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'
>>
>> This is a (transient?) problem on the machine running the check:
>> something completely prevented HTML Tidy from running, even before the
>> process would have tried to load the required DLLs. Nothing to do with
>> your package.
>>
>>> * checking for detritus in the temp directory ... NOTE
>>> Found the following files/directories: 'lastMiKTeXException'
>>
>> I think this is a false positive too. Some other package may have
>> failed to compile its PDF documentation (at the same time?), which
>> caused MiKTeX to create this file in the temp directory. Your PDF
>> manual check resulted in an OK.
>>
>> Does the automatic e-mail include the instructions on where to reply
>> with this explanation?
>>
>> --
>> Best regards,
>> Ivan
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From g|@nm@rco@|bert| @end|ng |rom gm@||@com  Wed Apr 12 11:24:23 2023
From: g|@nm@rco@|bert| @end|ng |rom gm@||@com (Gianmarco Alberti)
Date: Wed, 12 Apr 2023 11:24:23 +0200
Subject: [R-pkg-devel] 
 package not passing automatic checks: no clue as to
 what is causing 2 notes
In-Reply-To: <afcdc5ae-3b82-08d5-222b-b5cb5b57cd91@statistik.tu-dortmund.de>
References: <ac00d786-353e-4192-9ae4-b7d53bf74805@Spark>
 <97304f8e-181f-4ee9-a111-bbcb9b843491@Spark>
 <20230412111615.55dd1545@parabola>
 <a750b115-b043-4e76-a60d-34a13e3a4123@Spark>
 <afcdc5ae-3b82-08d5-222b-b5cb5b57cd91@statistik.tu-dortmund.de>
Message-ID: <f3865965-1c25-487d-a407-c96820d947d0@Spark>

Thanks you!

Kind regards
Gm

--
Dr Gianmarco Alberti | Lecturer in Spatial Forensics
BA, MA, PhD (Udine) - Coordinator of the BA dissertations

Department of Criminology - Faculty for Social Wellbeing
Room 332, Humanities B (FEMA)
University of Malta
Msida - MSD 2080 (Malta)
+356 2340 3718

Google Scholar:?https://scholar.google.com/citations?user=tFrJKQ0AAAAJ&hl=en
ResearchGate:?https://www.researchgate.net/profile/Gianmarco_Alberti4
Academia:?https://malta.academia.edu/GianmarcoAlberti
movecost:?https://CRAN.R-project.org/package=movecost
chisquare:?https://CRAN.R-project.org/package=chisquare
CAinterprTools:?https://CRAN.R-project.org/package=CAinterprTools
On 12 Apr 2023, 11:08 +0200, Uwe Ligges <ligges at statistik.tu-dortmund.de>, wrote:
> Indeed, a hicc up of the Windows builder.
> Should be resolved.
>
> Best,
> Uwe Ligges
>
>
> On 12.04.2023 10:48, Gianmarco Alberti wrote:
> > Hello,
> > Thanks for your prompt advices.
> >
> > I am not an expert?.
> >
> > I have sent an email to explain that those are likely to be issues on the CRAN?s end, and to inform that I would not mind to wait a while and re-do the entire submission procedure.
> >
> > Thank you again
> > Gm
> >
> > --
> > Dr Gianmarco Alberti | Lecturer in Spatial Forensics
> > BA, MA, PhD (Udine) - Coordinator of the BA dissertations
> >
> > Department of Criminology - Faculty for Social Wellbeing
> > Room 332, Humanities B (FEMA)
> > University of Malta
> > Msida - MSD 2080 (Malta)
> > +356 2340 3718
> >
> > Google Scholar:?https://scholar.google.com/citations?user=tFrJKQ0AAAAJ&hl=en
> > ResearchGate:?https://www.researchgate.net/profile/Gianmarco_Alberti4
> > Academia:?https://malta.academia.edu/GianmarcoAlberti
> > movecost:?https://CRAN.R-project.org/package=movecost
> > chisquare:?https://CRAN.R-project.org/package=chisquare
> > CAinterprTools:?https://CRAN.R-project.org/package=CAinterprTools
> > On 12 Apr 2023, 10:16 +0200, Ivan Krylov <krylov.r00t at gmail.com>, wrote:
> > > ? Wed, 12 Apr 2023 10:05:32 +0200
> > > Gianmarco Alberti <gianmarcoalberti at gmail.com> ?????:
> > >
> > > > 'CreateProcess' failed to run
> > > > 'd:\rtools43\x86_64-w64-mingw32.static.posix\bin\tidy.exe -language
> > > > en -qe --drop-empty-elements no D:\temp\Rtmp29JsRe\file2426857b24734'
> > >
> > > This is a (transient?) problem on the machine running the check:
> > > something completely prevented HTML Tidy from running, even before the
> > > process would have tried to load the required DLLs. Nothing to do with
> > > your package.
> > >
> > > > * checking for detritus in the temp directory ... NOTE
> > > > Found the following files/directories: 'lastMiKTeXException'
> > >
> > > I think this is a false positive too. Some other package may have
> > > failed to compile its PDF documentation (at the same time?), which
> > > caused MiKTeX to create this file in the temp directory. Your PDF
> > > manual check resulted in an OK.
> > >
> > > Does the automatic e-mail include the instructions on where to reply
> > > with this explanation?
> > >
> > > --
> > > Best regards,
> > > Ivan
> >
> > [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From @@dom|nguez @end|ng |rom ht-d@t@@com  Tue Apr 18 02:10:51 2023
From: @@dom|nguez @end|ng |rom ht-d@t@@com (Socorro Dominguez)
Date: Mon, 17 Apr 2023 19:10:51 -0500
Subject: [R-pkg-devel] (no subject)
Message-ID: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>

Hello!

I need some help.

Could you explain how to write the *Description* field in the *Description*
file when we need to add links? I don't find any rules on how to write it
when it includes links such as <https://...>

Also, whenever I try to do a new line in the *Description* field with the
four spaces for indentation, I get an error from the R CMD

If you could provide me with some sort of template example, I would be
extremely grateful.

Best,

Socorro

-- 
Best regards,

Socorro E. Dominguez-Vida?a
s.dominguez at ht-data.com

	[[alternative HTML version deleted]]


From @@r@h@go@|ee @end|ng |rom gm@||@com  Tue Apr 18 02:19:07 2023
From: @@r@h@go@|ee @end|ng |rom gm@||@com (Sarah Goslee)
Date: Mon, 17 Apr 2023 20:19:07 -0400
Subject: [R-pkg-devel] (no subject)
In-Reply-To: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
References: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
Message-ID: <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>

Hi,

The Writing R Packages manual is the main documentation, specifically:
https://cran.r-project.org/doc/manuals/R-exts.html#The-DESCRIPTION-file

As for indentation, don't. Just use a newline.

I don't know of any templates, but the source code for many/most
packages is on RForge and/or github, so you can look at as many
DESCRIPTION files as you'd like to find the solutions you need.

If that doesn't help, then please share actual examples of what isn't
working in your file.

Sarah

On Mon, Apr 17, 2023 at 8:15?PM Socorro Dominguez
<s.dominguez at ht-data.com> wrote:
>
> Hello!
>
> I need some help.
>
> Could you explain how to write the *Description* field in the *Description*
> file when we need to add links? I don't find any rules on how to write it
> when it includes links such as <https://...>
>
> Also, whenever I try to do a new line in the *Description* field with the
> four spaces for indentation, I get an error from the R CMD
>
> If you could provide me with some sort of template example, I would be
> extremely grateful.
>
> Best,
>
> Socorro
>
> --
> Best regards,
>
> Socorro E. Dominguez-Vida?a
> s.dominguez at ht-data.com
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Sarah Goslee (she/her)
http://www.numberwright.com


From @@dom|nguez @end|ng |rom ht-d@t@@com  Tue Apr 18 02:41:17 2023
From: @@dom|nguez @end|ng |rom ht-d@t@@com (Socorro Dominguez)
Date: Mon, 17 Apr 2023 19:41:17 -0500
Subject: [R-pkg-devel] (no subject)
In-Reply-To: <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>
References: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
 <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>
Message-ID: <CAHDun9i2obvusWQ_51qtSQDV3OWrgzgDYTA_JiKCECZBqEuCdQ@mail.gmail.com>

Thank you!

So, based on this link:
https://r-pkgs.org/description.html#:~:text=to%20be%20indented%3A-,Description,-%3A%20The%20description
<https://r-pkgs.org/description.html#:~:text=to%20be%20indented%3A-,Description,-%3A%20The%20descriptio>
I thought I had to add indentations...

So, I originally sent:
```
Description: Access and manipulate data from the Neotoma Paleoecology
Database. <https://api.neotomadb.org/api-docs/>
```

I was requested to add <https://..> referencing the "Neotoma Paleoecology
Database".

With the Description above, I do not get any local errors when running the
R CMD but can rejects it and gives me this error:


If I do this:
```
Description: Access and manipulate data from the Neotoma Paleoecology
Database.
<https://api.neotomadb.org/api-docs/>
```

and run the R CMD, I get the following message:
```
Unknown, possibly mis-spelled, fields in DESCRIPTION:
  ?<https?
```
(however, it is not an error)


I see that I have to write complete sentences, so I have done the following:
```
Description: Access and manipulation of data using the Neotoma Paleoecology
Database.
<https://api.neotomadb.org/api-docs/>
```

I would llike to know if this is correct prior to submitting again. Or know
how should I place that <https...> tag

Thank you for all your help.

Socorro

On Mon, Apr 17, 2023 at 7:19?PM Sarah Goslee <sarah.goslee at gmail.com> wrote:

> Hi,
>
> The Writing R Packages manual is the main documentation, specifically:
> https://cran.r-project.org/doc/manuals/R-exts.html#The-DESCRIPTION-file
>
> As for indentation, don't. Just use a newline.
>
> I don't know of any templates, but the source code for many/most
> packages is on RForge and/or github, so you can look at as many
> DESCRIPTION files as you'd like to find the solutions you need.
>
> If that doesn't help, then please share actual examples of what isn't
> working in your file.
>
> Sarah
>
> On Mon, Apr 17, 2023 at 8:15?PM Socorro Dominguez
> <s.dominguez at ht-data.com> wrote:
> >
> > Hello!
> >
> > I need some help.
> >
> > Could you explain how to write the *Description* field in the
> *Description*
> > file when we need to add links? I don't find any rules on how to write it
> > when it includes links such as <https://...>
> >
> > Also, whenever I try to do a new line in the *Description* field with the
> > four spaces for indentation, I get an error from the R CMD
> >
> > If you could provide me with some sort of template example, I would be
> > extremely grateful.
> >
> > Best,
> >
> > Socorro
> >
> > --
> > Best regards,
> >
> > Socorro E. Dominguez-Vida?a
> > s.dominguez at ht-data.com
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>
>
> --
> Sarah Goslee (she/her)
> http://www.numberwright.com
>


-- 
Best regards,

Socorro E. Dominguez-Vida?a
s.dominguez at ht-data.com

	[[alternative HTML version deleted]]


From c|yde @end|ng |rom duke@edu  Tue Apr 18 03:32:17 2023
From: c|yde @end|ng |rom duke@edu (Merlise Clyde, Ph.D.)
Date: Tue, 18 Apr 2023 01:32:17 +0000
Subject: [R-pkg-devel] (no subject)
In-Reply-To: <CAHDun9i2obvusWQ_51qtSQDV3OWrgzgDYTA_JiKCECZBqEuCdQ@mail.gmail.com>
References: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
 <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>
 <CAHDun9i2obvusWQ_51qtSQDV3OWrgzgDYTA_JiKCECZBqEuCdQ@mail.gmail.com>
Message-ID: <BN7PR05MB39726A7A4D1C5CCB32847666C89D9@BN7PR05MB3972.namprd05.prod.outlook.com>

Make sure you have a period after the < > tag if that is the end of the paragraph/sentences - its is not clear it is there from the snippet that you sent.
(let us know if the package is on github as then we can see the entire file)

best,
Merlise
________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Socorro Dominguez <s.dominguez at ht-data.com>
Sent: Monday, April 17, 2023 8:41 PM
To: Sarah Goslee <sarah.goslee at gmail.com>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] (no subject)

Thank you!

So, based on this link:
https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20description__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0xeXNINIw$
<https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20descriptio__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0wC5cqebw$ >
I thought I had to add indentations...

So, I originally sent:
```
Description: Access and manipulate data from the Neotoma Paleoecology
Database. <https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$ >
```

I was requested to add <https://..> referencing the "Neotoma Paleoecology
Database".

With the Description above, I do not get any local errors when running the
R CMD but can rejects it and gives me this error:


If I do this:
```
Description: Access and manipulate data from the Neotoma Paleoecology
Database.
<https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$ >
```

and run the R CMD, I get the following message:
```
Unknown, possibly mis-spelled, fields in DESCRIPTION:
  ?<https?
```
(however, it is not an error)


I see that I have to write complete sentences, so I have done the following:
```
Description: Access and manipulation of data using the Neotoma Paleoecology
Database.
<https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$ >
```

I would llike to know if this is correct prior to submitting again. Or know
how should I place that <https...> tag

Thank you for all your help.

Socorro

On Mon, Apr 17, 2023 at 7:19?PM Sarah Goslee <sarah.goslee at gmail.com> wrote:

> Hi,
>
> The Writing R Packages manual is the main documentation, specifically:
> https://urldefense.com/v3/__https://cran.r-project.org/doc/manuals/R-exts.html*The-DESCRIPTION-file__;Iw!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0ypxASA8Q$
>
> As for indentation, don't. Just use a newline.
>
> I don't know of any templates, but the source code for many/most
> packages is on RForge and/or github, so you can look at as many
> DESCRIPTION files as you'd like to find the solutions you need.
>
> If that doesn't help, then please share actual examples of what isn't
> working in your file.
>
> Sarah
>
> On Mon, Apr 17, 2023 at 8:15?PM Socorro Dominguez
> <s.dominguez at ht-data.com> wrote:
> >
> > Hello!
> >
> > I need some help.
> >
> > Could you explain how to write the *Description* field in the
> *Description*
> > file when we need to add links? I don't find any rules on how to write it
> > when it includes links such as <https://...>
> >
> > Also, whenever I try to do a new line in the *Description* field with the
> > four spaces for indentation, I get an error from the R CMD
> >
> > If you could provide me with some sort of template example, I would be
> > extremely grateful.
> >
> > Best,
> >
> > Socorro
> >
> > --
> > Best regards,
> >
> > Socorro E. Dominguez-Vida?a
> > s.dominguez at ht-data.com
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$
>
>
>
> --
> Sarah Goslee (she/her)
> https://urldefense.com/v3/__http://www.numberwright.com__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x3pHxbwQ$
>


--
Best regards,

Socorro E. Dominguez-Vida?a
s.dominguez at ht-data.com

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$

	[[alternative HTML version deleted]]


From @@dom|nguez @end|ng |rom ht-d@t@@com  Tue Apr 18 03:37:48 2023
From: @@dom|nguez @end|ng |rom ht-d@t@@com (Socorro Dominguez)
Date: Mon, 17 Apr 2023 20:37:48 -0500
Subject: [R-pkg-devel] (no subject)
In-Reply-To: <BN7PR05MB39726A7A4D1C5CCB32847666C89D9@BN7PR05MB3972.namprd05.prod.outlook.com>
References: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
 <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>
 <CAHDun9i2obvusWQ_51qtSQDV3OWrgzgDYTA_JiKCECZBqEuCdQ@mail.gmail.com>
 <BN7PR05MB39726A7A4D1C5CCB32847666C89D9@BN7PR05MB3972.namprd05.prod.outlook.com>
Message-ID: <CAHDun9j_wGxHRZS-ABz7RJCjS7KJ12CFuyB5oA2w4mV-5AMRUA@mail.gmail.com>

Thank you for all the help.

Here is the GitHub link:
https://github.com/NeotomaDB/neotoma2

Best,

Socorro

On Mon, Apr 17, 2023 at 8:32?PM Merlise Clyde, Ph.D. <clyde at duke.edu> wrote:

> Make sure you have a period after the < > tag if that is the end of the
> paragraph/sentences - its is not clear it is there from the snippet that
> you sent.
> (let us know if the package is on github as then we can see the entire
> file)
>
> best,
> Merlise
> ------------------------------
> *From:* R-package-devel <r-package-devel-bounces at r-project.org> on behalf
> of Socorro Dominguez <s.dominguez at ht-data.com>
> *Sent:* Monday, April 17, 2023 8:41 PM
> *To:* Sarah Goslee <sarah.goslee at gmail.com>
> *Cc:* r-package-devel at r-project.org <r-package-devel at r-project.org>
> *Subject:* Re: [R-pkg-devel] (no subject)
>
> Thank you!
>
> So, based on this link:
>
> https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20description__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0xeXNINIw$
> <
> https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20descriptio__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0wC5cqebw$
> >
> I thought I had to add indentations...
>
> So, I originally sent:
> ```
> Description: Access and manipulate data from the Neotoma Paleoecology
> Database. <
> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
> >
> ```
>
> I was requested to add <https://..> referencing the "Neotoma Paleoecology
> Database".
>
> With the Description above, I do not get any local errors when running the
> R CMD but can rejects it and gives me this error:
>
>
> If I do this:
> ```
> Description: Access and manipulate data from the Neotoma Paleoecology
> Database.
> <
> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
> >
> ```
>
> and run the R CMD, I get the following message:
> ```
> Unknown, possibly mis-spelled, fields in DESCRIPTION:
>   ?<https?
> ```
> (however, it is not an error)
>
>
> I see that I have to write complete sentences, so I have done the
> following:
> ```
> Description: Access and manipulation of data using the Neotoma Paleoecology
> Database.
> <
> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
> >
> ```
>
> I would llike to know if this is correct prior to submitting again. Or know
> how should I place that <https...> tag
>
> Thank you for all your help.
>
> Socorro
>
> On Mon, Apr 17, 2023 at 7:19?PM Sarah Goslee <sarah.goslee at gmail.com>
> wrote:
>
> > Hi,
> >
> > The Writing R Packages manual is the main documentation, specifically:
> >
> https://urldefense.com/v3/__https://cran.r-project.org/doc/manuals/R-exts.html*The-DESCRIPTION-file__;Iw!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0ypxASA8Q$
> >
> > As for indentation, don't. Just use a newline.
> >
> > I don't know of any templates, but the source code for many/most
> > packages is on RForge and/or github, so you can look at as many
> > DESCRIPTION files as you'd like to find the solutions you need.
> >
> > If that doesn't help, then please share actual examples of what isn't
> > working in your file.
> >
> > Sarah
> >
> > On Mon, Apr 17, 2023 at 8:15?PM Socorro Dominguez
> > <s.dominguez at ht-data.com> wrote:
> > >
> > > Hello!
> > >
> > > I need some help.
> > >
> > > Could you explain how to write the *Description* field in the
> > *Description*
> > > file when we need to add links? I don't find any rules on how to write
> it
> > > when it includes links such as <https://...>
> > >
> > > Also, whenever I try to do a new line in the *Description* field with
> the
> > > four spaces for indentation, I get an error from the R CMD
> > >
> > > If you could provide me with some sort of template example, I would be
> > > extremely grateful.
> > >
> > > Best,
> > >
> > > Socorro
> > >
> > > --
> > > Best regards,
> > >
> > > Socorro E. Dominguez-Vida?a
> > > s.dominguez at ht-data.com
> > >
> > >         [[alternative HTML version deleted]]
> > >
> > > ______________________________________________
> > > R-package-devel at r-project.org mailing list
> > >
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$
> >
> >
> >
> > --
> > Sarah Goslee (she/her)
> >
> https://urldefense.com/v3/__http://www.numberwright.com__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x3pHxbwQ$
> >
>
>
> --
> Best regards,
>
> Socorro E. Dominguez-Vida?a
> s.dominguez at ht-data.com
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$
>


-- 
Best regards,

Socorro E. Dominguez-Vida?a
s.dominguez at ht-data.com

	[[alternative HTML version deleted]]


From @@dom|nguez @end|ng |rom ht-d@t@@com  Tue Apr 18 05:29:16 2023
From: @@dom|nguez @end|ng |rom ht-d@t@@com (Socorro Dominguez)
Date: Mon, 17 Apr 2023 22:29:16 -0500
Subject: [R-pkg-devel] (no subject)
In-Reply-To: <CADNULg_Ms-Dro03u5D1kBZvy0=9qQEpo0pVjUh+XMT8g2HUZFQ@mail.gmail.com>
References: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
 <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>
 <CAHDun9i2obvusWQ_51qtSQDV3OWrgzgDYTA_JiKCECZBqEuCdQ@mail.gmail.com>
 <BN7PR05MB39726A7A4D1C5CCB32847666C89D9@BN7PR05MB3972.namprd05.prod.outlook.com>
 <CAHDun9j_wGxHRZS-ABz7RJCjS7KJ12CFuyB5oA2w4mV-5AMRUA@mail.gmail.com>
 <CADNULg_Ms-Dro03u5D1kBZvy0=9qQEpo0pVjUh+XMT8g2HUZFQ@mail.gmail.com>
Message-ID: <CAHDun9idBe6FHgWGT1e44JSkjATkU_c+yGn5w8DG2mEnYJf-xw@mail.gmail.com>

Thank you all,

I really appreciate how fast you have all helped me and I am very grateful
for it.

I did not have a space. I wonder why it is rendering like that. I removed
the line and wrote it again just in case a weird character had gotten in
the way. Now I have done as you have suggested.

When I did the R CMD I had no issues locally and I had no more notes or
elements being interpreted as fields.

Thank you,

Socorro

On Mon, Apr 17, 2023 at 9:07?PM Iris Simmons <ikwsimmo at gmail.com> wrote:

> You put a space between "https:" and "//", you should definitely remove
> that. Also, you need to indent your description. Right now, your
> DESCRIPTION is being interpreted in this manner:
>
> ```
> Package
>
>
>
>
>
>
>                  "neotoma2"
>
>
>
>
>
>
>                       Title
>
>
>
>
>
>                                                        "Working with the
> Neotoma Paleoecology Database"
>
>
>
>
>
>
>                        Date
>
>
>
>
>
>
>                "2023-04-17"
>
>
>
>
>
>
>                     Version
>
>
>
>
>
>
>                     "1.0.0"
>
>
>
>
>
>
>                   Authors at R
> "\n    c(person(given = \"Dominguez Vidana\",\n             family =
> \"Socorro\",\n             role = c(\"aut\"),\n             email = \"
> s.dominguez at ht-data.com\",\n             comment =
> structure(\"0000-0002-7926-4935\", .Names = \"ORCID\")),\n
>  person(given = \"Simon\",\n             family = \"Goring\",\n
> role = c(\"aut\", \"cre\"),\n             email = \"goring at wisc.edu\",\n
>             comment = structure(\"0000-0002-2700-4605\", .Names =
> \"ORCID\")))"
>
>
>
>
>
>
>                         URL
>
>
>
>
>
>                                                                 "
> https://github.com/NeotomaDB/neotoma2"
>
>
>
>
>
>
>                  BugReports
>
>
>
>
>
>                                                          "
> https://github.com/NeotomaDB/neotoma2/issues"
>
>
>
>
>
>
>                 Description
>
>
>
>
>
>                              "Access and manipulation of data using the
> Neotoma Paleoecology Database."
>
>
>
>
>
>
>                      <https
>
>
>
>
>
>                                                                       "//
> api.neotomadb.org/api-docs/>."
>
>
>
>
>
>
>                     License
> ```
>
> You can see that it is interpreting "<https" as the name of a field and "//
> api.neotomadb.org/api-docs/>." as the contents of the field. I added 8
> spaces before "<https:" and removed the space and it worked perfectly fine.
>
> I hope this helps.
>
> On Mon, Apr 17, 2023 at 9:42?PM Socorro Dominguez <s.dominguez at ht-data.com>
> wrote:
>
>> Thank you for all the help.
>>
>> Here is the GitHub link:
>> https://github.com/NeotomaDB/neotoma2
>>
>> Best,
>>
>> Socorro
>>
>> On Mon, Apr 17, 2023 at 8:32?PM Merlise Clyde, Ph.D. <clyde at duke.edu>
>> wrote:
>>
>> > Make sure you have a period after the < > tag if that is the end of the
>> > paragraph/sentences - its is not clear it is there from the snippet that
>> > you sent.
>> > (let us know if the package is on github as then we can see the entire
>> > file)
>> >
>> > best,
>> > Merlise
>> > ------------------------------
>> > *From:* R-package-devel <r-package-devel-bounces at r-project.org> on
>> behalf
>> > of Socorro Dominguez <s.dominguez at ht-data.com>
>> > *Sent:* Monday, April 17, 2023 8:41 PM
>> > *To:* Sarah Goslee <sarah.goslee at gmail.com>
>> > *Cc:* r-package-devel at r-project.org <r-package-devel at r-project.org>
>> > *Subject:* Re: [R-pkg-devel] (no subject)
>> >
>> > Thank you!
>> >
>> > So, based on this link:
>> >
>> >
>> https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20description__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0xeXNINIw$
>> > <
>> >
>> https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20descriptio__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0wC5cqebw$
>> > >
>> > I thought I had to add indentations...
>> >
>> > So, I originally sent:
>> > ```
>> > Description: Access and manipulate data from the Neotoma Paleoecology
>> > Database. <
>> >
>> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
>> > >
>> > ```
>> >
>> > I was requested to add <https://..> referencing the "Neotoma
>> Paleoecology
>> > Database".
>> >
>> > With the Description above, I do not get any local errors when running
>> the
>> > R CMD but can rejects it and gives me this error:
>> >
>> >
>> > If I do this:
>> > ```
>> > Description: Access and manipulate data from the Neotoma Paleoecology
>> > Database.
>> > <
>> >
>> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
>> > >
>> > ```
>> >
>> > and run the R CMD, I get the following message:
>> > ```
>> > Unknown, possibly mis-spelled, fields in DESCRIPTION:
>> >   ?<https?
>> > ```
>> > (however, it is not an error)
>> >
>> >
>> > I see that I have to write complete sentences, so I have done the
>> > following:
>> > ```
>> > Description: Access and manipulation of data using the Neotoma
>> Paleoecology
>> > Database.
>> > <
>> >
>> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
>> > >
>> > ```
>> >
>> > I would llike to know if this is correct prior to submitting again. Or
>> know
>> > how should I place that <https...> tag
>> >
>> > Thank you for all your help.
>> >
>> > Socorro
>> >
>> > On Mon, Apr 17, 2023 at 7:19?PM Sarah Goslee <sarah.goslee at gmail.com>
>> > wrote:
>> >
>> > > Hi,
>> > >
>> > > The Writing R Packages manual is the main documentation, specifically:
>> > >
>> >
>> https://urldefense.com/v3/__https://cran.r-project.org/doc/manuals/R-exts.html*The-DESCRIPTION-file__;Iw!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0ypxASA8Q$
>> > >
>> > > As for indentation, don't. Just use a newline.
>> > >
>> > > I don't know of any templates, but the source code for many/most
>> > > packages is on RForge and/or github, so you can look at as many
>> > > DESCRIPTION files as you'd like to find the solutions you need.
>> > >
>> > > If that doesn't help, then please share actual examples of what isn't
>> > > working in your file.
>> > >
>> > > Sarah
>> > >
>> > > On Mon, Apr 17, 2023 at 8:15?PM Socorro Dominguez
>> > > <s.dominguez at ht-data.com> wrote:
>> > > >
>> > > > Hello!
>> > > >
>> > > > I need some help.
>> > > >
>> > > > Could you explain how to write the *Description* field in the
>> > > *Description*
>> > > > file when we need to add links? I don't find any rules on how to
>> write
>> > it
>> > > > when it includes links such as <https://...>
>> > > >
>> > > > Also, whenever I try to do a new line in the *Description* field
>> with
>> > the
>> > > > four spaces for indentation, I get an error from the R CMD
>> > > >
>> > > > If you could provide me with some sort of template example, I would
>> be
>> > > > extremely grateful.
>> > > >
>> > > > Best,
>> > > >
>> > > > Socorro
>> > > >
>> > > > --
>> > > > Best regards,
>> > > >
>> > > > Socorro E. Dominguez-Vida?a
>> > > > s.dominguez at ht-data.com
>> > > >
>> > > >         [[alternative HTML version deleted]]
>> > > >
>> > > > ______________________________________________
>> > > > R-package-devel at r-project.org mailing list
>> > > >
>> >
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$
>> > >
>> > >
>> > >
>> > > --
>> > > Sarah Goslee (she/her)
>> > >
>> >
>> https://urldefense.com/v3/__http://www.numberwright.com__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x3pHxbwQ$
>> > >
>> >
>> >
>> > --
>> > Best regards,
>> >
>> > Socorro E. Dominguez-Vida?a
>> > s.dominguez at ht-data.com
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > ______________________________________________
>> > R-package-devel at r-project.org mailing list
>> >
>> >
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$
>> >
>>
>>
>> --
>> Best regards,
>>
>> Socorro E. Dominguez-Vida?a
>> s.dominguez at ht-data.com
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>

-- 
Best regards,

Socorro E. Dominguez-Vida?a
s.dominguez at ht-data.com

	[[alternative HTML version deleted]]


From |kw@|mmo @end|ng |rom gm@||@com  Tue Apr 18 04:07:27 2023
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Mon, 17 Apr 2023 22:07:27 -0400
Subject: [R-pkg-devel] (no subject)
In-Reply-To: <CAHDun9j_wGxHRZS-ABz7RJCjS7KJ12CFuyB5oA2w4mV-5AMRUA@mail.gmail.com>
References: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
 <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>
 <CAHDun9i2obvusWQ_51qtSQDV3OWrgzgDYTA_JiKCECZBqEuCdQ@mail.gmail.com>
 <BN7PR05MB39726A7A4D1C5CCB32847666C89D9@BN7PR05MB3972.namprd05.prod.outlook.com>
 <CAHDun9j_wGxHRZS-ABz7RJCjS7KJ12CFuyB5oA2w4mV-5AMRUA@mail.gmail.com>
Message-ID: <CADNULg_Ms-Dro03u5D1kBZvy0=9qQEpo0pVjUh+XMT8g2HUZFQ@mail.gmail.com>

You put a space between "https:" and "//", you should definitely remove
that. Also, you need to indent your description. Right now, your
DESCRIPTION is being interpreted in this manner:

```
Package






               "neotoma2"






                    Title





                                                     "Working with the
Neotoma Paleoecology Database"






                     Date






             "2023-04-17"






                  Version






                  "1.0.0"






                Authors at R
"\n    c(person(given = \"Dominguez Vidana\",\n             family =
\"Socorro\",\n             role = c(\"aut\"),\n             email = \"
s.dominguez at ht-data.com\",\n             comment =
structure(\"0000-0002-7926-4935\", .Names = \"ORCID\")),\n
 person(given = \"Simon\",\n             family = \"Goring\",\n
role = c(\"aut\", \"cre\"),\n             email = \"goring at wisc.edu\",\n
          comment = structure(\"0000-0002-2700-4605\", .Names =
\"ORCID\")))"






                      URL





                                                              "
https://github.com/NeotomaDB/neotoma2"






               BugReports





                                                       "
https://github.com/NeotomaDB/neotoma2/issues"






              Description





                           "Access and manipulation of data using the
Neotoma Paleoecology Database."






                   <https





                                                                    "//
api.neotomadb.org/api-docs/>."






                  License
```

You can see that it is interpreting "<https" as the name of a field and "//
api.neotomadb.org/api-docs/>." as the contents of the field. I added 8
spaces before "<https:" and removed the space and it worked perfectly fine.

I hope this helps.

On Mon, Apr 17, 2023 at 9:42?PM Socorro Dominguez <s.dominguez at ht-data.com>
wrote:

> Thank you for all the help.
>
> Here is the GitHub link:
> https://github.com/NeotomaDB/neotoma2
>
> Best,
>
> Socorro
>
> On Mon, Apr 17, 2023 at 8:32?PM Merlise Clyde, Ph.D. <clyde at duke.edu>
> wrote:
>
> > Make sure you have a period after the < > tag if that is the end of the
> > paragraph/sentences - its is not clear it is there from the snippet that
> > you sent.
> > (let us know if the package is on github as then we can see the entire
> > file)
> >
> > best,
> > Merlise
> > ------------------------------
> > *From:* R-package-devel <r-package-devel-bounces at r-project.org> on
> behalf
> > of Socorro Dominguez <s.dominguez at ht-data.com>
> > *Sent:* Monday, April 17, 2023 8:41 PM
> > *To:* Sarah Goslee <sarah.goslee at gmail.com>
> > *Cc:* r-package-devel at r-project.org <r-package-devel at r-project.org>
> > *Subject:* Re: [R-pkg-devel] (no subject)
> >
> > Thank you!
> >
> > So, based on this link:
> >
> >
> https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20description__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0xeXNINIw$
> > <
> >
> https://urldefense.com/v3/__https://r-pkgs.org/description.html*:*:text=to*20be*20indented*3A-,Description,-*3A*20The*20descriptio__;I34lJSUlJSU!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0wC5cqebw$
> > >
> > I thought I had to add indentations...
> >
> > So, I originally sent:
> > ```
> > Description: Access and manipulate data from the Neotoma Paleoecology
> > Database. <
> >
> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
> > >
> > ```
> >
> > I was requested to add <https://..> referencing the "Neotoma
> Paleoecology
> > Database".
> >
> > With the Description above, I do not get any local errors when running
> the
> > R CMD but can rejects it and gives me this error:
> >
> >
> > If I do this:
> > ```
> > Description: Access and manipulate data from the Neotoma Paleoecology
> > Database.
> > <
> >
> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
> > >
> > ```
> >
> > and run the R CMD, I get the following message:
> > ```
> > Unknown, possibly mis-spelled, fields in DESCRIPTION:
> >   ?<https?
> > ```
> > (however, it is not an error)
> >
> >
> > I see that I have to write complete sentences, so I have done the
> > following:
> > ```
> > Description: Access and manipulation of data using the Neotoma
> Paleoecology
> > Database.
> > <
> >
> https://urldefense.com/v3/__https://api.neotomadb.org/api-docs/__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0zYR76mxw$
> > >
> > ```
> >
> > I would llike to know if this is correct prior to submitting again. Or
> know
> > how should I place that <https...> tag
> >
> > Thank you for all your help.
> >
> > Socorro
> >
> > On Mon, Apr 17, 2023 at 7:19?PM Sarah Goslee <sarah.goslee at gmail.com>
> > wrote:
> >
> > > Hi,
> > >
> > > The Writing R Packages manual is the main documentation, specifically:
> > >
> >
> https://urldefense.com/v3/__https://cran.r-project.org/doc/manuals/R-exts.html*The-DESCRIPTION-file__;Iw!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0ypxASA8Q$
> > >
> > > As for indentation, don't. Just use a newline.
> > >
> > > I don't know of any templates, but the source code for many/most
> > > packages is on RForge and/or github, so you can look at as many
> > > DESCRIPTION files as you'd like to find the solutions you need.
> > >
> > > If that doesn't help, then please share actual examples of what isn't
> > > working in your file.
> > >
> > > Sarah
> > >
> > > On Mon, Apr 17, 2023 at 8:15?PM Socorro Dominguez
> > > <s.dominguez at ht-data.com> wrote:
> > > >
> > > > Hello!
> > > >
> > > > I need some help.
> > > >
> > > > Could you explain how to write the *Description* field in the
> > > *Description*
> > > > file when we need to add links? I don't find any rules on how to
> write
> > it
> > > > when it includes links such as <https://...>
> > > >
> > > > Also, whenever I try to do a new line in the *Description* field with
> > the
> > > > four spaces for indentation, I get an error from the R CMD
> > > >
> > > > If you could provide me with some sort of template example, I would
> be
> > > > extremely grateful.
> > > >
> > > > Best,
> > > >
> > > > Socorro
> > > >
> > > > --
> > > > Best regards,
> > > >
> > > > Socorro E. Dominguez-Vida?a
> > > > s.dominguez at ht-data.com
> > > >
> > > >         [[alternative HTML version deleted]]
> > > >
> > > > ______________________________________________
> > > > R-package-devel at r-project.org mailing list
> > > >
> >
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$
> > >
> > >
> > >
> > > --
> > > Sarah Goslee (she/her)
> > >
> >
> https://urldefense.com/v3/__http://www.numberwright.com__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x3pHxbwQ$
> > >
> >
> >
> > --
> > Best regards,
> >
> > Socorro E. Dominguez-Vida?a
> > s.dominguez at ht-data.com
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> >
> >
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!OToaGQ!rL12FfD_Ox2OGl4JbHsG06nsukCSrpt3piRZQ1B5cllO12AOU7ZP2OcwA5dorRJWaIda0dk74FnqQ0x27JHaIA$
> >
>
>
> --
> Best regards,
>
> Socorro E. Dominguez-Vida?a
> s.dominguez at ht-data.com
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue Apr 18 16:32:03 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 18 Apr 2023 09:32:03 -0500
Subject: [R-pkg-devel] (no subject)
In-Reply-To: <CAHDun9j_wGxHRZS-ABz7RJCjS7KJ12CFuyB5oA2w4mV-5AMRUA@mail.gmail.com>
References: <CAHDun9gLdg0-9Bpuo=E5Kq9ibWS7Hf_av_e_rvVKVfsf-tUPQg@mail.gmail.com>
 <CAM_vjuk3DjJWPD-yVE3Hf7KwRt5T3Xqx3mFwX29uwBCnwDr4kw@mail.gmail.com>
 <CAHDun9i2obvusWQ_51qtSQDV3OWrgzgDYTA_JiKCECZBqEuCdQ@mail.gmail.com>
 <BN7PR05MB39726A7A4D1C5CCB32847666C89D9@BN7PR05MB3972.namprd05.prod.outlook.com>
 <CAHDun9j_wGxHRZS-ABz7RJCjS7KJ12CFuyB5oA2w4mV-5AMRUA@mail.gmail.com>
Message-ID: <25662.43491.287395.272916@rob.eddelbuettel.com>


On 17 April 2023 at 20:37, Socorro Dominguez wrote:
| Thank you for all the help.
| 
| Here is the GitHub link:
| https://github.com/NeotomaDB/neotoma2

Thanks for posting a link to the repo. That should really be a standard.

You currently have (and I indent by two spaces for clarity here)

  Description: Access and manipulation of data using the Neotoma Paleoecology Database.
          <https://api.neotomadb.org/api-docs/>.

which has two full stops. I would simply use

  Description: Access and manipulation of data using the Neotoma Paleoecology
    Database at <https://api.neotomadb.org/api-docs/>.

which brings the URL into the description text while keeping it one sentence
with one full stop.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @qch@r@k| @end|ng |rom |nter|@@p|  Wed Apr 19 10:36:25 2023
From: @qch@r@k| @end|ng |rom |nter|@@p| (A. Kucharski)
Date: Wed, 19 Apr 2023 10:36:25 +0200
Subject: [R-pkg-devel] Replacing dplyr by stats functions
Message-ID: <20230419083626.5DCCDA029E@poczta.interia.pl>

Hi,

I am developing my own package. I have a problem with its new version. Checking on the CRAN server gives 2 warnings like this (critpath is my package):
Warning: replacing previous import 'dplyr::lag' by 'stats::lag' when loading 'critpath'
Warning: replacing previous import 'dplyr::filter' by 'stats::filter' when loading 'critpath'

On my machine these warnings show up during Check but before Build starts so at the end I get a message that the number of warnings is 0. I don't use lag or filter at all in my package although I use both of these packages. Reordering the dplyr and stats package names in the Depends of the Description file didn't help. Is it a problem with my code or a conflict between those two packages? Please help me remove these warnings.

Best regards

Adam

Wys?ane z aplikacji Poczta dla systemu Windows 


	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Wed Apr 19 16:36:32 2023
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 19 Apr 2023 10:36:32 -0400
Subject: [R-pkg-devel] Replacing dplyr by stats functions
In-Reply-To: <20230419083626.5DCCDA029E@poczta.interia.pl>
References: <20230419083626.5DCCDA029E@poczta.interia.pl>
Message-ID: <a0b1369c-b057-1e11-7cfc-d3d2b848c5a5@gmail.com>

 ??? If you use Depends: in your package I think this is unavoidable 
(but, I don't think these should be counted against you as warnings by 
CRAN - they're "Warnings" not "WARNINGs" :-) )

 ?? The only way I know of to avoid this would be to Import: rather than 
Depend:, and import only the functions you need.


On 2023-04-19 4:36 a.m., A. Kucharski wrote:
> Hi,
>
> I am developing my own package. I have a problem with its new version. Checking on the CRAN server gives 2 warnings like this (critpath is my package):
> Warning: replacing previous import 'dplyr::lag' by 'stats::lag' when loading 'critpath'
> Warning: replacing previous import 'dplyr::filter' by 'stats::filter' when loading 'critpath'
>
> On my machine these warnings show up during Check but before Build starts so at the end I get a message that the number of warnings is 0. I don't use lag or filter at all in my package although I use both of these packages. Reordering the dplyr and stats package names in the Depends of the Description file didn't help. Is it a problem with my code or a conflict between those two packages? Please help me remove these warnings.
>
> Best regards
>
> Adam
>
> Wys?ane z aplikacji Poczta dla systemu Windows
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d|cko@@hm@dou @end|ng |rom gm@||@com  Wed Apr 19 16:41:30 2023
From: d|cko@@hm@dou @end|ng |rom gm@||@com (Ahmadou Dicko)
Date: Wed, 19 Apr 2023 14:41:30 +0000
Subject: [R-pkg-devel] Replacing dplyr by stats functions
In-Reply-To: <20230419083626.5DCCDA029E@poczta.interia.pl>
References: <20230419083626.5DCCDA029E@poczta.interia.pl>
Message-ID: <CAP8THHXjgHWk0LcDzv1C7po1t5wrpSa6-2CrW9wwAQ5VHnbtng@mail.gmail.com>

Hi Adam,

If you don't mind adding another dependency to your package, you can
use the {conflicted} package and its conflict_prefer function.

Best,
Ahmadou


On Wed, Apr 19, 2023 at 2:18?PM A. Kucharski <aqcharski at interia.pl> wrote:
>
> Hi,
>
> I am developing my own package. I have a problem with its new version. Checking on the CRAN server gives 2 warnings like this (critpath is my package):
> Warning: replacing previous import 'dplyr::lag' by 'stats::lag' when loading 'critpath'
> Warning: replacing previous import 'dplyr::filter' by 'stats::filter' when loading 'critpath'
>
> On my machine these warnings show up during Check but before Build starts so at the end I get a message that the number of warnings is 0. I don't use lag or filter at all in my package although I use both of these packages. Reordering the dplyr and stats package names in the Depends of the Description file didn't help. Is it a problem with my code or a conflict between those two packages? Please help me remove these warnings.
>
> Best regards
>
> Adam
>
> Wys?ane z aplikacji Poczta dla systemu Windows
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Ahmadou H. DICKO, PhD

Statistical consultant
Mobile: (+221) 77 123 81 69
Skype: dicko.ahmadou.h
Twitter : @dickoah
Gitlab: gitlab/dickoa
Github: github/dickoa


From jo@h@m@u|r|ch @end|ng |rom gm@||@com  Wed Apr 19 16:51:51 2023
From: jo@h@m@u|r|ch @end|ng |rom gm@||@com (Joshua Ulrich)
Date: Wed, 19 Apr 2023 09:51:51 -0500
Subject: [R-pkg-devel] Replacing dplyr by stats functions
In-Reply-To: <20230419083626.5DCCDA029E@poczta.interia.pl>
References: <20230419083626.5DCCDA029E@poczta.interia.pl>
Message-ID: <CAPPM_gR1TcNWMGj5OqW=ckZRocvSfTRDn2XYinjFRqDJAwte5g@mail.gmail.com>

On Wed, Apr 19, 2023 at 9:19?AM A. Kucharski <aqcharski at interia.pl> wrote:
>
> Hi,
>
> I am developing my own package. I have a problem with its new version. Checking on the CRAN server gives 2 warnings like this (critpath is my package):
> Warning: replacing previous import 'dplyr::lag' by 'stats::lag' when loading 'critpath'
> Warning: replacing previous import 'dplyr::filter' by 'stats::filter' when loading 'critpath'
>
> On my machine these warnings show up during Check but before Build starts so at the end I get a message that the number of warnings is 0. I don't use lag or filter at all in my package although I use both of these packages. Reordering the dplyr and stats package names in the Depends of the Description file didn't help. Is it a problem with my code or a conflict between those two packages? Please help me remove these warnings.
>
It's a conflict between stats and dplyr. The dplyr lag() function
masks the base R stats lag() generic, which breaks S3 method dispatch
for every package that has a lag() method when dplyr is attached.

You should use Imports instead of Depends unless you need the package
attached, which is a rare case.

The latest version of critpath on CRAN uses `import()` in the
NAMESPACE file. That imports every function in the entire package. Use
`importFrom()` to import only the functions you use from the package.
That should help avoid these types of conflicts.

> Best regards
>
> Adam
>
> Wys?ane z aplikacji Poczta dla systemu Windows
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From d@v|d_j_z|mmerm@nn @end|ng |rom hotm@||@com  Fri Apr 21 21:17:15 2023
From: d@v|d_j_z|mmerm@nn @end|ng |rom hotm@||@com (D Z)
Date: Fri, 21 Apr 2023 19:17:15 +0000
Subject: [R-pkg-devel] Segmentation Fault cause 'memory not mapped' on
 Debian only
Message-ID: <AS8PR03MB101195FCD51D3690649B9AA30D3609@AS8PR03MB10119.eurprd03.prod.outlook.com>

Hi all,
I wanted to publish my RITCH package (https://github.com/DavZim/RITCH) to CRAN, which has Rcpp code.
It has, in it?s CICD Pipeline, Tests for Macos, Windows, and Ubuntu (devel, release,, and oldrel-1), which all succeed on Github Actions.
When I submitted the package to CRAN, I was notified, that I got the following error on Debian (the tests on Windows throw no such bug, neither do the Github Actions tests):


   *** caught segfault ***

  address 0x55939b7ca000, cause 'memory not mapped'

  Segmentation fault

The full Report is currently available here: https://win-builder.r-project.org/incoming_pretest/RITCH_0.1.14_20230420_223157/Debian/00check.log (note the error happens in the test_filter_itch.R unit tests).

I looked for the error online but couldn?t find anything useful, and as I am not able to reproduce the segfault locally, cannot debug it.
Do you have any ideas or hunches what might cause this and how to resolve it?

Thank you,
David

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Fri Apr 21 21:32:50 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 21 Apr 2023 14:32:50 -0500
Subject: [R-pkg-devel] Segmentation Fault cause 'memory not mapped' on
 Debian only
In-Reply-To: <AS8PR03MB101195FCD51D3690649B9AA30D3609@AS8PR03MB10119.eurprd03.prod.outlook.com>
References: <AS8PR03MB101195FCD51D3690649B9AA30D3609@AS8PR03MB10119.eurprd03.prod.outlook.com>
Message-ID: <25666.58594.218291.306640@rob.eddelbuettel.com>


Hi David,

On 21 April 2023 at 19:17, D Z wrote:
| Hi all,
| I wanted to publish my RITCH package (https://github.com/DavZim/RITCH) to CRAN, which has Rcpp code.

That would be great!

| It has, in it?s CICD Pipeline, Tests for Macos, Windows, and Ubuntu (devel, release,, and oldrel-1), which all succeed on Github Actions.
| When I submitted the package to CRAN, I was notified, that I got the following error on Debian (the tests on Windows throw no such bug, neither do the Github Actions tests):
| 
| 
|    *** caught segfault ***
| 
|   address 0x55939b7ca000, cause 'memory not mapped'
| 
|   Segmentation fault
| 
| The full Report is currently available here: https://win-builder.r-project.org/incoming_pretest/RITCH_0.1.14_20230420_223157/Debian/00check.log (note the error happens in the test_filter_itch.R unit tests).
| 
| I looked for the error online but couldn?t find anything useful, and as I am not able to reproduce the segfault locally, cannot debug it.
| Do you have any ideas or hunches what might cause this and how to resolve it?

"Absence of error" on one platform does proove correctness on all, the hint
from the segfault should be taken seriously.  I just updated my older
checkout of your repo, built a current tarball and simply invoked

   R CMD check --use-valgrind RITCH_0.1.14.tar.gz

which you could do on CI too (I can help as needed, I would also pull the CI
runners forward from Ubuntu 20.04 to 22.04). When we do the above, the
examples output file RITCH-Ex.Rout ends in

  ==2269271== LEAK SUMMARY:
  ==2269271==    definitely lost: 1,363,969 bytes in 5,473 blocks
  ==2269271==    indirectly lost: 177,235 bytes in 1,281 blocks
  ==2269271==      possibly lost: 101,924,267 bytes in 148 blocks
  ==2269271==    still reachable: 89,572,890 bytes in 17,950 blocks
  ==2269271==         suppressed: 0 bytes in 0 blocks
  ==2269271== Reachable blocks (those to which a pointer was found) are not shown.
  ==2269271== To see them, rerun with: --leak-check=full --show-leak-kinds=all
  ==2269271== 
  ==2269271== ERROR SUMMARY: 30 errors from 30 contexts (suppressed: 0 from 0)

and the tests end in

  ==2273761== LEAK SUMMARY:
  ==2273761==    definitely lost: 5,223,981 bytes in 141,151 blocks
  ==2273761==    indirectly lost: 2,241,700 bytes in 2,767 blocks
  ==2273761==      possibly lost: 1,201,493,644 bytes in 270 blocks
  ==2273761==    still reachable: 133,909,136 bytes in 19,110 blocks
  ==2273761==         suppressed: 0 bytes in 0 blocks
  ==2273761== Reachable blocks (those to which a pointer was found) are not shown.
  ==2273761== To see them, rerun with: --leak-check=full --show-leak-kinds=all
  ==2273761== 
  ==2273761== ERROR SUMMARY: 43 errors from 39 contexts (suppressed: 0 from 0)

That probably warrants a few more close looks.

Hth, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jo@h@m@u|r|ch @end|ng |rom gm@||@com  Fri Apr 21 21:48:31 2023
From: jo@h@m@u|r|ch @end|ng |rom gm@||@com (Joshua Ulrich)
Date: Fri, 21 Apr 2023 14:48:31 -0500
Subject: [R-pkg-devel] Segmentation Fault cause 'memory not mapped' on
 Debian only
In-Reply-To: <25666.58594.218291.306640@rob.eddelbuettel.com>
References: <AS8PR03MB101195FCD51D3690649B9AA30D3609@AS8PR03MB10119.eurprd03.prod.outlook.com>
 <25666.58594.218291.306640@rob.eddelbuettel.com>
Message-ID: <CAPPM_gTsq1pT1nsds63ag1rZkx4t4c3vp-wf2H4uJd3rAO9bog@mail.gmail.com>

Hi David,

In addition to running under valgrind as Dirk suggests below, you
should also run under UBSAN and ASAN.

You can do all 3 (and more) using Winston Cheng's docker images:
https://github.com/wch/r-debug/

That should help you narrow down the problematic code.

Best,
Josh


On Fri, Apr 21, 2023 at 2:33?PM Dirk Eddelbuettel <edd at debian.org> wrote:
>
>
> Hi David,
>
> On 21 April 2023 at 19:17, D Z wrote:
> | Hi all,
> | I wanted to publish my RITCH package (https://github.com/DavZim/RITCH) to CRAN, which has Rcpp code.
>
> That would be great!
>
> | It has, in it?s CICD Pipeline, Tests for Macos, Windows, and Ubuntu (devel, release,, and oldrel-1), which all succeed on Github Actions.
> | When I submitted the package to CRAN, I was notified, that I got the following error on Debian (the tests on Windows throw no such bug, neither do the Github Actions tests):
> |
> |
> |    *** caught segfault ***
> |
> |   address 0x55939b7ca000, cause 'memory not mapped'
> |
> |   Segmentation fault
> |
> | The full Report is currently available here: https://win-builder.r-project.org/incoming_pretest/RITCH_0.1.14_20230420_223157/Debian/00check.log (note the error happens in the test_filter_itch.R unit tests).
> |
> | I looked for the error online but couldn?t find anything useful, and as I am not able to reproduce the segfault locally, cannot debug it.
> | Do you have any ideas or hunches what might cause this and how to resolve it?
>
> "Absence of error" on one platform does proove correctness on all, the hint
> from the segfault should be taken seriously.  I just updated my older
> checkout of your repo, built a current tarball and simply invoked
>
>    R CMD check --use-valgrind RITCH_0.1.14.tar.gz
>
> which you could do on CI too (I can help as needed, I would also pull the CI
> runners forward from Ubuntu 20.04 to 22.04). When we do the above, the
> examples output file RITCH-Ex.Rout ends in
>
>   ==2269271== LEAK SUMMARY:
>   ==2269271==    definitely lost: 1,363,969 bytes in 5,473 blocks
>   ==2269271==    indirectly lost: 177,235 bytes in 1,281 blocks
>   ==2269271==      possibly lost: 101,924,267 bytes in 148 blocks
>   ==2269271==    still reachable: 89,572,890 bytes in 17,950 blocks
>   ==2269271==         suppressed: 0 bytes in 0 blocks
>   ==2269271== Reachable blocks (those to which a pointer was found) are not shown.
>   ==2269271== To see them, rerun with: --leak-check=full --show-leak-kinds=all
>   ==2269271==
>   ==2269271== ERROR SUMMARY: 30 errors from 30 contexts (suppressed: 0 from 0)
>
> and the tests end in
>
>   ==2273761== LEAK SUMMARY:
>   ==2273761==    definitely lost: 5,223,981 bytes in 141,151 blocks
>   ==2273761==    indirectly lost: 2,241,700 bytes in 2,767 blocks
>   ==2273761==      possibly lost: 1,201,493,644 bytes in 270 blocks
>   ==2273761==    still reachable: 133,909,136 bytes in 19,110 blocks
>   ==2273761==         suppressed: 0 bytes in 0 blocks
>   ==2273761== Reachable blocks (those to which a pointer was found) are not shown.
>   ==2273761== To see them, rerun with: --leak-check=full --show-leak-kinds=all
>   ==2273761==
>   ==2273761== ERROR SUMMARY: 43 errors from 39 contexts (suppressed: 0 from 0)
>
> That probably warrants a few more close looks.
>
> Hth, Dirk
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From d@v|d_j_z|mmerm@nn @end|ng |rom hotm@||@com  Sat Apr 22 16:43:50 2023
From: d@v|d_j_z|mmerm@nn @end|ng |rom hotm@||@com (D Z)
Date: Sat, 22 Apr 2023 14:43:50 +0000
Subject: [R-pkg-devel] Segmentation Fault cause 'memory not mapped' on
 Debian only
In-Reply-To: <CAPPM_gTsq1pT1nsds63ag1rZkx4t4c3vp-wf2H4uJd3rAO9bog@mail.gmail.com>
References: <AS8PR03MB101195FCD51D3690649B9AA30D3609@AS8PR03MB10119.eurprd03.prod.outlook.com>
 <25666.58594.218291.306640@rob.eddelbuettel.com>
 <CAPPM_gTsq1pT1nsds63ag1rZkx4t4c3vp-wf2H4uJd3rAO9bog@mail.gmail.com>
Message-ID: <AS8PR03MB10119AD02237E2C7F1A6D2E33D3619@AS8PR03MB10119.eurprd03.prod.outlook.com>

Thank you Dirk and Joshua,
Using Valgrind, I have found several memory leaks in the program that required some smaller rewrites.
Valgrind (with Makevars flags -O0 and --ggdb) now reports no "definitely" and no "indirectly" lost bytes so that's a small win already.

But two questions remain:

  1.  I have 960 bytes "possibly lost", where the callstack does not touch any of my code but seems to originate from subset.c (base R?) and libgomp, is this ok/expected, or am I misreading the output?
  2.  For all tests that I ran, there are still 105mln bytes still reachable. I read online that this can be problematic, but usually isn't. Is this something that I should invest more time in or can I ignore this?

Thank you very much!
David


To reproduce the valgrind output using bash (this is using the latest code commit https://github.com/DavZim/RITCH/commit/13ea3f478717edf24f8db709f0cac1e22b501afc)

echo "PKG_CXXFLAGS=-O0 -ggdb\nPKG_LIBS=-O0 -ggdb -lz" >> src/Makevars.win
echo "PKG_CXXFLAGS=-O0 -ggdb\nPKG_LIBS=-O0 -ggdb -lz" >> src/Makevars

R CMD build .
R CMD INSTALL RITCH_0.1.15.tar.gz

R -d "valgrind --tool=memcheck --leak-check=full" -e "tinytest::test_package('RITCH')"
# omitted for brevity...
tinytest::test_package('RITCH')
test_filename_helpers.R.......   13 tests OK 1.1s
test_filter_itch.R............   60 tests OK 30.1s
test_gz_functions.R...........    5 tests OK 6.0s
test_read_functions.R.........  122 tests OK 14.1s
test_write_itch.R.............   18 tests OK 33.0s
All ok, 218 results (1m 24.5s)
>
==1535==
==1535== HEAP SUMMARY:
==1535==     in use at exit: 105,616,149 bytes in 18,292 blocks
==1535==   total heap usage: 562,268 allocs, 543,976 frees, 6,834,040,088 bytes allocated
==1535==
==1535== 960 bytes in 3 blocks are possibly lost in loss record 199 of 2,000
==1535==    at 0x483DD99: calloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==1535==    by 0x40149DA: allocate_dtv (dl-tls.c:286)
==1535==    by 0x40149DA: _dl_allocate_tls (dl-tls.c:532)
==1535==    by 0x5741322: allocate_stack (allocatestack.c:622)
==1535==    by 0x5741322: pthread_create@@GLIBC_2.2.5 (pthread_create.c:660)
==1535==    by 0x5710DEA: ??? (in /usr/lib/x86_64-linux-gnu/libgomp.so.1.0.0)
==1535==    by 0x57088E0: GOMP_parallel (in /usr/lib/x86_64-linux-gnu/libgomp.so.1.0.0)
==1535==    by 0x10882EB9: subsetVectorRaw (subset.c:54)
==1535==    by 0x10883B50: subsetDT (subset.c:309)
==1535==    by 0x494253D: ??? (in /usr/lib/R/lib/libR.so)
==1535==    by 0x49861A6: ??? (in /usr/lib/R/lib/libR.so)
==1535==    by 0x4999D77: Rf_eval (in /usr/lib/R/lib/libR.so)
==1535==    by 0x499BC2E: ??? (in /usr/lib/R/lib/libR.so)
==1535==    by 0x499CB21: Rf_applyClosure (in /usr/lib/R/lib/libR.so)
==1535==
==1535== LEAK SUMMARY:
==1535==    definitely lost: 0 bytes in 0 blocks
==1535==    indirectly lost: 0 bytes in 0 blocks
==1535==      possibly lost: 960 bytes in 3 blocks
==1535==    still reachable: 105,615,189 bytes in 18,289 blocks
==1535==                       of which reachable via heuristic:
==1535==                         newarray           : 4,264 bytes in 1 blocks
==1535==         suppressed: 0 bytes in 0 blocks
==1535== Reachable blocks (those to which a pointer was found) are not shown.
==1535== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==1535==
==1535== For lists of detected and suppressed errors, rerun with: -s
==1535== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

________________________________
From: Joshua Ulrich <josh.m.ulrich at gmail.com>
Sent: Friday, April 21, 2023 7:48 PM
To: Dirk Eddelbuettel <edd at debian.org>
Cc: D Z <david_j_zimmermann at hotmail.com>; r-package-devel at r-project.org <R-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] Segmentation Fault cause 'memory not mapped' on Debian only

Hi David,

In addition to running under valgrind as Dirk suggests below, you
should also run under UBSAN and ASAN.

You can do all 3 (and more) using Winston Cheng's docker images:
https://github.com/wch/r-debug/

That should help you narrow down the problematic code.

Best,
Josh


On Fri, Apr 21, 2023 at 2:33?PM Dirk Eddelbuettel <edd at debian.org> wrote:
>
>
> Hi David,
>
> On 21 April 2023 at 19:17, D Z wrote:
> | Hi all,
> | I wanted to publish my RITCH package (https://github.com/DavZim/RITCH) to CRAN, which has Rcpp code.
>
> That would be great!
>
> | It has, in it?s CICD Pipeline, Tests for Macos, Windows, and Ubuntu (devel, release,, and oldrel-1), which all succeed on Github Actions.
> | When I submitted the package to CRAN, I was notified, that I got the following error on Debian (the tests on Windows throw no such bug, neither do the Github Actions tests):
> |
> |
> |    *** caught segfault ***
> |
> |   address 0x55939b7ca000, cause 'memory not mapped'
> |
> |   Segmentation fault
> |
> | The full Report is currently available here: https://win-builder.r-project.org/incoming_pretest/RITCH_0.1.14_20230420_223157/Debian/00check.log (note the error happens in the test_filter_itch.R unit tests).
> |
> | I looked for the error online but couldn?t find anything useful, and as I am not able to reproduce the segfault locally, cannot debug it.
> | Do you have any ideas or hunches what might cause this and how to resolve it?
>
> "Absence of error" on one platform does proove correctness on all, the hint
> from the segfault should be taken seriously.  I just updated my older
> checkout of your repo, built a current tarball and simply invoked
>
>    R CMD check --use-valgrind RITCH_0.1.14.tar.gz
>
> which you could do on CI too (I can help as needed, I would also pull the CI
> runners forward from Ubuntu 20.04 to 22.04). When we do the above, the
> examples output file RITCH-Ex.Rout ends in
>
>   ==2269271== LEAK SUMMARY:
>   ==2269271==    definitely lost: 1,363,969 bytes in 5,473 blocks
>   ==2269271==    indirectly lost: 177,235 bytes in 1,281 blocks
>   ==2269271==      possibly lost: 101,924,267 bytes in 148 blocks
>   ==2269271==    still reachable: 89,572,890 bytes in 17,950 blocks
>   ==2269271==         suppressed: 0 bytes in 0 blocks
>   ==2269271== Reachable blocks (those to which a pointer was found) are not shown.
>   ==2269271== To see them, rerun with: --leak-check=full --show-leak-kinds=all
>   ==2269271==
>   ==2269271== ERROR SUMMARY: 30 errors from 30 contexts (suppressed: 0 from 0)
>
> and the tests end in
>
>   ==2273761== LEAK SUMMARY:
>   ==2273761==    definitely lost: 5,223,981 bytes in 141,151 blocks
>   ==2273761==    indirectly lost: 2,241,700 bytes in 2,767 blocks
>   ==2273761==      possibly lost: 1,201,493,644 bytes in 270 blocks
>   ==2273761==    still reachable: 133,909,136 bytes in 19,110 blocks
>   ==2273761==         suppressed: 0 bytes in 0 blocks
>   ==2273761== Reachable blocks (those to which a pointer was found) are not shown.
>   ==2273761== To see them, rerun with: --leak-check=full --show-leak-kinds=all
>   ==2273761==
>   ==2273761== ERROR SUMMARY: 43 errors from 39 contexts (suppressed: 0 from 0)
>
> That probably warrants a few more close looks.
>
> Hth, Dirk
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com<http://www.fosstrading.com>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Sat Apr 22 17:07:00 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sat, 22 Apr 2023 10:07:00 -0500
Subject: [R-pkg-devel] Segmentation Fault cause 'memory not mapped' on
 Debian only
In-Reply-To: <AS8PR03MB10119AD02237E2C7F1A6D2E33D3619@AS8PR03MB10119.eurprd03.prod.outlook.com>
References: <AS8PR03MB101195FCD51D3690649B9AA30D3609@AS8PR03MB10119.eurprd03.prod.outlook.com>
 <25666.58594.218291.306640@rob.eddelbuettel.com>
 <CAPPM_gTsq1pT1nsds63ag1rZkx4t4c3vp-wf2H4uJd3rAO9bog@mail.gmail.com>
 <AS8PR03MB10119AD02237E2C7F1A6D2E33D3619@AS8PR03MB10119.eurprd03.prod.outlook.com>
Message-ID: <25667.63508.772449.102784@rob.eddelbuettel.com>


On 22 April 2023 at 14:43, D Z wrote:
| Thank you Dirk and Joshua,
| Using Valgrind, I have found several memory leaks in the program that required
| some smaller rewrites.
| Valgrind (with Makevars flags -O0 and --ggdb) now reports no "definitely" and
| no "indirectly" lost bytes so that's a small win already.

Very nice and good news!
 
| But two questions remain:
| 
|  1. I have 960 bytes "possibly lost", where the callstack does not touch any of
|     my code but seems to originate from subset.c (base R?) and libgomp, is this
|     ok/expected, or am I misreading the output?
|  2. For all tests that I ran, there are still 105mln bytes still reachable. I
|     read online that this can be problematic, but usually isn't. Is this
|     something that I should invest more time in or can I ignore this?

It is difficult to say something _definite_ with a language like R that
manages memory dynamically. This is fundamentally different from C/C++ which
valgrind was written for.  So _ex ante_ you are in good news territory.  When
I am in doubt I sometimes compare to valgrind output (using the same
parameters) on a known-good package. You could try xts or zoo, for example,
or another package equally focused on creating data objects from binary files
as RITCH is.

The log below mentions GOMP. Might be worthwhile opening another branch in
your repo and throwing OpenMP out, or forcing a single thread, or ... for
another test. 

The additional ASAN/UBSAN tests mentioned by Josh are a good idea too -- and
CRAN runs them anyway (as part of the add-on test suites running from a
well-known university town in southern England...)

Best,  Dirk

| Thank you very much!
| David
| 
| 
| To reproduce the valgrind output using bash (this is using the latest code
| commit https://github.com/DavZim/RITCH/commit/
| 13ea3f478717edf24f8db709f0cac1e22b501afc)
| 
| echo "PKG_CXXFLAGS=-O0 -ggdb\nPKG_LIBS=-O0 -ggdb -lz" >> src/Makevars.win
| echo "PKG_CXXFLAGS=-O0 -ggdb\nPKG_LIBS=-O0 -ggdb -lz" >> src/Makevars
| 
| R CMD build .
| R CMD INSTALL RITCH_0.1.15.tar.gz
| 
| R -d "valgrind --tool=memcheck --leak-check=full" -e "tinytest::test_package
| ('RITCH')"
| # omitted for brevity...
| tinytest::test_package('RITCH')
| test_filename_helpers.R.......   13 tests OK 1.1s
| test_filter_itch.R............   60 tests OK 30.1s
| test_gz_functions.R...........    5 tests OK 6.0s
| test_read_functions.R.........  122 tests OK 14.1s
| test_write_itch.R.............   18 tests OK 33.0s
| All ok, 218 results (1m 24.5s)
| >
| ==1535==
| ==1535== HEAP SUMMARY:
| ==1535==     in use at exit: 105,616,149 bytes in 18,292 blocks
| ==1535==   total heap usage: 562,268 allocs, 543,976 frees, 6,834,040,088 bytes
| allocated
| ==1535==
| ==1535== 960 bytes in 3 blocks are possibly lost in loss record 199 of 2,000
| ==1535==    at 0x483DD99: calloc (in /usr/lib/x86_64-linux-gnu/valgrind/
| vgpreload_memcheck-amd64-linux.so)
| ==1535==    by 0x40149DA: allocate_dtv (dl-tls.c:286)
| ==1535==    by 0x40149DA: _dl_allocate_tls (dl-tls.c:532)
| ==1535==    by 0x5741322: allocate_stack (allocatestack.c:622)
| ==1535==    by 0x5741322: pthread_create@@GLIBC_2.2.5 (pthread_create.c:660)
| ==1535==    by 0x5710DEA: ??? (in /usr/lib/x86_64-linux-gnu/libgomp.so.1.0.0)
| ==1535==    by 0x57088E0: GOMP_parallel (in /usr/lib/x86_64-linux-gnu/
| libgomp.so.1.0.0)
| ==1535==    by 0x10882EB9: subsetVectorRaw (subset.c:54)
| ==1535==    by 0x10883B50: subsetDT (subset.c:309)
| ==1535==    by 0x494253D: ??? (in /usr/lib/R/lib/libR.so)
| ==1535==    by 0x49861A6: ??? (in /usr/lib/R/lib/libR.so)
| ==1535==    by 0x4999D77: Rf_eval (in /usr/lib/R/lib/libR.so)
| ==1535==    by 0x499BC2E: ??? (in /usr/lib/R/lib/libR.so)
| ==1535==    by 0x499CB21: Rf_applyClosure (in /usr/lib/R/lib/libR.so)
| ==1535==
| ==1535== LEAK SUMMARY:
| ==1535==    definitely lost: 0 bytes in 0 blocks
| ==1535==    indirectly lost: 0 bytes in 0 blocks
| ==1535==      possibly lost: 960 bytes in 3 blocks
| ==1535==    still reachable: 105,615,189 bytes in 18,289 blocks
| ==1535==                       of which reachable via heuristic:
| ==1535==                         newarray           : 4,264 bytes in 1 blocks
| ==1535==         suppressed: 0 bytes in 0 blocks
| ==1535== Reachable blocks (those to which a pointer was found) are not shown.
| ==1535== To see them, rerun with: --leak-check=full --show-leak-kinds=all
| ==1535==
| ==1535== For lists of detected and suppressed errors, rerun with: -s
| ==1535== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From bbo|ker @end|ng |rom gm@||@com  Sun Apr 23 00:56:08 2023
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sat, 22 Apr 2023 18:56:08 -0400
Subject: [R-pkg-devel] new/slightly mysterious CRAN warnings
Message-ID: <a864d643-b3d6-09c8-3956-657763573859@gmail.com>

   Submission of most recent version of lme4 threw a NOTE on CRAN's 
Debian platform that we had not seen when running "R CMD check 
--as-cran" with the most recent SVN checkout, nor when submitted to 
win-builder/R-devel.  These are legitimate issues (all now fixed), but 
we were taken by surprise because they weren't detected on any platforms 
we tested on.

   So far, archaeology in the R code base/Github mirror about recent 
changes to tools::checkS3methods, or about environment variables, hasn't 
been entirely successful, although based on

grep Sys.getenv src/library/tools/R/QC.R  | sed -e 's/.*Sys.getenv("//' 
| sed -e 's/"[,)].*//' | sort | uniq

it looks like we *might* want to set

_R_CHECK_S3_METHODS_SHOW_POSSIBLE_ISSUES_

when testing ...

   This is mostly a heads-up/documentation for anyone who might be 
interested.


Debian: 
<https://win-builder.r-project.org/incoming_pretest/lme4_1.1-33_20230421_145951/Debian/00check.log>

  R Under development (unstable) (2023-04-20 r84291)

  NOTE
Mismatches for apparent methods not registered:
print:
   function(x, ...)
print.bootWarnings:
   function(x, verbose)

format:
   function(x, ...)
format.perc:
   function(probs, digits)

Apparent methods for exported generics not registered:
   ngrps.default
See section ?Registering S3 methods? in the ?Writing R Extensions?
manual.


From edd @end|ng |rom deb|@n@org  Sun Apr 23 17:25:20 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sun, 23 Apr 2023 10:25:20 -0500
Subject: [R-pkg-devel] 'Default' macos (x86) download URL now gone?
Message-ID: <25669.19936.694972.114117@rob.eddelbuettel.com>


The URL ${CRAN}/bin/macosx/R-latest.pkg is in fairlt widespread use. A quick
Google query [1] reveals about 1.1k hits. And it happens to be used too in a
CI job a colleague noticed failing yesterday.

The bin/macosx/ page now prominently displays both leading flavours
  R-4.3.0-arm64.pkg
  R-4.3.0-x86_64.pkg
which makes sense give the architecture choices. We can of course update the
CI script, and likely will.

But given that this was apparently a somewhat widely-used URL to fetch R on
macOS, may I suggest that the convenience link be reestablished as a courtesy?

Best,  Dirk

https://github.com/search?q=macosx%2FR-latest.pkg&type=code

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @|mon@urb@nek @end|ng |rom R-project@org  Mon Apr 24 08:28:21 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 24 Apr 2023 18:28:21 +1200
Subject: [R-pkg-devel] 'Default' macos (x86) download URL now gone?
In-Reply-To: <25669.19936.694972.114117@rob.eddelbuettel.com>
References: <25669.19936.694972.114117@rob.eddelbuettel.com>
Message-ID: <5F0CF217-5A2E-466F-9738-B49A43688CAA@R-project.org>

Dirk,

thanks - the problem is that there is not a single installer package (for several years now), so that URL is ambiguous. Whether the missing link is a good or bad depends on how it is used. I would argue that any link to that URL is inherently bad, because there is no way of knowing that the link works for a particular system - that's why I have originally removed it with the R 4.3.0 release. I have restored it now, making it point to the R 4.3.0 arm64 release since that is arguably the closest to a single "latest R". R releases have not been stored in /bin/macosx since 2015, so anyone using a link there is asking for trouble.

For any CI I would strongly recommend using the "last-success" links: https://mac.r-project.org/big-sur/last-success/ in particular the .xz versions are they are specifically designed to be used by CI (small download, fast and localized install).

Cheers,
Simon


> On 24/04/2023, at 3:25 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> The URL ${CRAN}/bin/macosx/R-latest.pkg is in fairlt widespread use. A quick
> Google query [1] reveals about 1.1k hits. And it happens to be used too in a
> CI job a colleague noticed failing yesterday.
> 
> The bin/macosx/ page now prominently displays both leading flavours
>  R-4.3.0-arm64.pkg
>  R-4.3.0-x86_64.pkg
> which makes sense give the architecture choices. We can of course update the
> CI script, and likely will.
> 
> But given that this was apparently a somewhat widely-used URL to fetch R on
> macOS, may I suggest that the convenience link be reestablished as a courtesy?
> 
> Best,  Dirk
> 
> https://github.com/search?q=macosx%2FR-latest.pkg&type=code
> 
> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 


From konr@d@rudo|ph @end|ng |rom gm@||@com  Mon Apr 24 22:39:29 2023
From: konr@d@rudo|ph @end|ng |rom gm@||@com (Konrad Rudolph)
Date: Mon, 24 Apr 2023 22:39:29 +0200
Subject: [R-pkg-devel] How to format the NEWS.md file for CRAN submissions?
Message-ID: <CAM2gKPbCPo6Y46e3QhCpC9uBTHqDsYmEdKKdKZ=AkbtgtQ_KGQ@mail.gmail.com>

My package is creating a CRAN check NOTE because CRAN does not like the way
my NEWS.md file [1] is formatted.

I am largely adhering to existing conventions with regards to my NEWS.md,
in particular the (rather minimal) GNU conventions [2] mentioned in R-exts
as well as the conventions used by ?pkgdown? to compile the file into a web
page. The one peculiarity of my NEWS.md file (and where it diverges from
the documented ?pkgdown? convention) is caused by the fact that my package
has undergone a name change in the past. As a consequence, not all headings
in the NEWS.md file follow the format `# ?pkgname? ?version?`.
Consequently, the CRAN check complains

>   Cannot extract version info from the following section titles:
>     modules 0.x

I have two questions:

1. Am I overlooking where the CRAN requirements for NEWS files are
documented? As far as I can see I am not violating a documented rule.
2. What is the best way of avoiding this NOTE _without_ dropping the
changelog pre package name change? In particular, since ?pkgdown? does not
support this I would like keep these changes in a single NEWS.md file
rather than moving them into a separate file. Likewise, I think it would be
misleading (and hence undesirable) to change the section headings to use
the current package name for the old revisions.

[1]
https://github.com/klmr/box/blob/9f35bd28b26306fe94ade874c2b93a89ae3f3a61/NEWS.md
[2] https://www.gnu.org/prep/standards/standards.html#NEWS-File

Cheers,
Konrad

-- 
Konrad Rudolph // @klmr

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Apr 24 22:54:32 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 24 Apr 2023 16:54:32 -0400
Subject: [R-pkg-devel] 
 How to format the NEWS.md file for CRAN submissions?
In-Reply-To: <CAM2gKPbCPo6Y46e3QhCpC9uBTHqDsYmEdKKdKZ=AkbtgtQ_KGQ@mail.gmail.com>
References: <CAM2gKPbCPo6Y46e3QhCpC9uBTHqDsYmEdKKdKZ=AkbtgtQ_KGQ@mail.gmail.com>
Message-ID: <84c5598b-47ab-ef3e-431e-8dbbef272b08@gmail.com>

On 24/04/2023 4:39 p.m., Konrad Rudolph wrote:
> My package is creating a CRAN check NOTE because CRAN does not like the way
> my NEWS.md file [1] is formatted.
> 
> I am largely adhering to existing conventions with regards to my NEWS.md,
> in particular the (rather minimal) GNU conventions [2] mentioned in R-exts
> as well as the conventions used by ?pkgdown? to compile the file into a web
> page. The one peculiarity of my NEWS.md file (and where it diverges from
> the documented ?pkgdown? convention) is caused by the fact that my package
> has undergone a name change in the past. As a consequence, not all headings
> in the NEWS.md file follow the format `# ?pkgname? ?version?`.
> Consequently, the CRAN check complains
> 
>>    Cannot extract version info from the following section titles:
>>      modules 0.x
> 
> I have two questions:
> 
> 1. Am I overlooking where the CRAN requirements for NEWS files are
> documented? As far as I can see I am not violating a documented rule.

The documentation is in the ?util::news help topic.  It says:

"File ?NEWS.md? should contain the news in Markdown (following the 
CommonMark (https://commonmark.org/) specification), with the primary 
heading level giving the version number after a prefix followed by a 
space, and optionally followed by a space and a parenthesized ISO 8601 
format date."


> 2. What is the best way of avoiding this NOTE _without_ dropping the
> changelog pre package name change? In particular, since ?pkgdown? does not
> support this I would like keep these changes in a single NEWS.md file
> rather than moving them into a separate file. Likewise, I think it would be
> misleading (and hence undesirable) to change the section headings to use
> the current package name for the old revisions.

I don't think it cares what the prefix is, so you could use something 
other than the current package name there.

Duncan Murdoch


> 
> [1]
> https://github.com/klmr/box/blob/9f35bd28b26306fe94ade874c2b93a89ae3f3a61/NEWS.md
> [2] https://www.gnu.org/prep/standards/standards.html#NEWS-File
> 
> Cheers,
> Konrad
>


From gb @end|ng |rom eh@r@@e  Mon Apr 24 18:17:22 2023
From: gb @end|ng |rom eh@r@@e (=?UTF-8?Q?G=c3=b6ran_Brostr=c3=b6m?=)
Date: Mon, 24 Apr 2023 18:17:22 +0200
Subject: [R-pkg-devel] katex
Message-ID: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>

I upgraded to 4.3.0 and rebuilt and checked a package with --as-cran, 
receiving

* checking PDF version of manual ... OK
* checking HTML version of manual ...Warning in file(con, "r") :
   cannot open file '/usr/lib/R/doc/html/katex/katex.js': No such file 
or directory
Error in file(con, "r") : cannot open the connection
Execution halted

Never heard of 'katex' but googled and found it interesting to try, so I 
installed the R package katex and, on my ubuntu system:

$ sudo apt install katex

but I still get the error with R CMD check --as-cran. What am I missing?
Obviously /usr/lib/R/doc/html/katex/katex.js (no 'doc'), but ...

I am installing R via apt.

Thanks, G?ran


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Apr 25 10:02:05 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 25 Apr 2023 11:02:05 +0300
Subject: [R-pkg-devel] katex
In-Reply-To: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
References: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
Message-ID: <20230425110205.3c3ab024@Tarkus>

On Mon, 24 Apr 2023 18:17:22 +0200
G?ran Brostr?m <gb at ehar.se> wrote:

>    cannot open file '/usr/lib/R/doc/html/katex/katex.js': No such
> file or directory

> I still get the error with R CMD check --as-cran. What am I
> missing? Obviously /usr/lib/R/doc/html/katex/katex.js (no 'doc'), but
> ...
> 
> I am installing R via apt.

Thank you for mentioning this detail!

At least in Debian packages, R's copy of KaTeX lives in /usr/share: per
Debian policy, "share" is for human-readable files like KaTeX, and
"lib" is for shared libraries, compiled code and the like.

For a copy of R built from source, it's not a problem:
file.path(R.home(), 'doc', 'html') does point to where KaTeX lives.

For a copy of R packaged into *.deb, the right path can be obtained
using file.path(R.home("doc"), "html"):

--- src/library/tools/R/utils.R (revision 84280)
+++ src/library/tools/R/utils.R (working copy)
@@ -1788,7 +1788,7 @@
     ctx <- NULL
     function() {
         if(is.null(fun) && requireNamespace("V8", quietly = TRUE)) {
-            dir <- file.path(R.home(), "doc", "html")
+            dir <- file.path(R.home("doc"), "html")
             ctx <<- V8::v8("window")
             ctx$source(file.path(dir, "katex", "katex.js"))
             ## Provides additional macros:

This path is also valid for an R build launched from source (without
"make install"). I don't know whether this would break a
differently-packaged build of R, though.

-- 
Best regards,
Ivan


From gb @end|ng |rom eh@r@@e  Tue Apr 25 12:02:08 2023
From: gb @end|ng |rom eh@r@@e (=?UTF-8?Q?G=c3=b6ran_Brostr=c3=b6m?=)
Date: Tue, 25 Apr 2023 12:02:08 +0200
Subject: [R-pkg-devel] katex
In-Reply-To: <20230425110205.3c3ab024@Tarkus>
References: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
 <20230425110205.3c3ab024@Tarkus>
Message-ID: <b5a7e523-0d3a-1da0-fa6e-5790547e01b9@ehar.se>



On 2023-04-25 10:02, Ivan Krylov wrote:
> On Mon, 24 Apr 2023 18:17:22 +0200
> G?ran Brostr?m <gb at ehar.se> wrote:
> 
>>     cannot open file '/usr/lib/R/doc/html/katex/katex.js': No such
>> file or directory
> 
>> I still get the error with R CMD check --as-cran. What am I
>> missing? Obviously /usr/lib/R/doc/html/katex/katex.js (no 'doc'), but
>> ...
>>
>> I am installing R via apt.
> 
> Thank you for mentioning this detail!
> 
> At least in Debian packages, R's copy of KaTeX lives in /usr/share: per
> Debian policy, "share" is for human-readable files like KaTeX, and
> "lib" is for shared libraries, compiled code and the like.
> 
> For a copy of R built from source, it's not a problem:

Thanks. I have now built R from source and can confirm that everything 
works nicely. Can't remember when and why I stopped building R from 
source, probably not a good idea.

G?ran


From edd @end|ng |rom deb|@n@org  Tue Apr 25 13:39:23 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 25 Apr 2023 06:39:23 -0500
Subject: [R-pkg-devel] katex
In-Reply-To: <20230425110205.3c3ab024@Tarkus>
References: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
 <20230425110205.3c3ab024@Tarkus>
Message-ID: <25671.48107.989212.333685@rob.eddelbuettel.com>


On 25 April 2023 at 11:02, Ivan Krylov wrote:
| On Mon, 24 Apr 2023 18:17:22 +0200
| G?ran Brostr?m <gb at ehar.se> wrote:
| 
| >    cannot open file '/usr/lib/R/doc/html/katex/katex.js': No such
| > file or directory
| 
| > I still get the error with R CMD check --as-cran. What am I
| > missing? Obviously /usr/lib/R/doc/html/katex/katex.js (no 'doc'), but
| > ...
| > 
| > I am installing R via apt.
| 
| Thank you for mentioning this detail!
| 
| At least in Debian packages, R's copy of KaTeX lives in /usr/share: per
| Debian policy, "share" is for human-readable files like KaTeX, and
| "lib" is for shared libraries, compiled code and the like.

Yes, that is a distribution-wide preference other Linux distributions have
too, and that was turned on many, many years ago in Debian (glancing at
changelog: one reference to 1999 when Doug was still maintainer; otherwise
mostly in 2006 it seems).

It does make R depart from the 'everything below RHOME' model, but the
relevant changes have mostly been caught.
 
| For a copy of R built from source, it's not a problem:
| file.path(R.home(), 'doc', 'html') does point to where KaTeX lives.
| 
| For a copy of R packaged into *.deb, the right path can be obtained
| using file.path(R.home("doc"), "html"):
| 
| --- src/library/tools/R/utils.R (revision 84280)
| +++ src/library/tools/R/utils.R (working copy)
| @@ -1788,7 +1788,7 @@
|      ctx <- NULL
|      function() {
|          if(is.null(fun) && requireNamespace("V8", quietly = TRUE)) {
| -            dir <- file.path(R.home(), "doc", "html")
| +            dir <- file.path(R.home("doc"), "html")
|              ctx <<- V8::v8("window")
|              ctx$source(file.path(dir, "katex", "katex.js"))
|              ## Provides additional macros:

Nice catch. In favour. Would you mind filing a bugzilla report to make sure
this persists and makes it into R 4.3.1 or 4.4.0 or ... ?
 
| This path is also valid for an R build launched from source (without
| "make install"). I don't know whether this would break a
| differently-packaged build of R, though.

I would not expect it to.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n|  Tue Apr 25 13:39:14 2023
From: wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n| (Viechtbauer, Wolfgang (NP))
Date: Tue, 25 Apr 2023 11:39:14 +0000
Subject: [R-pkg-devel] katex
In-Reply-To: <b5a7e523-0d3a-1da0-fa6e-5790547e01b9@ehar.se>
References: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
 <20230425110205.3c3ab024@Tarkus>
 <b5a7e523-0d3a-1da0-fa6e-5790547e01b9@ehar.se>
Message-ID: <e414533084754191b43984e9073230fc@UM-MAIL3210.unimaas.nl>

I ran into the same issue (on Ubuntu 20.04).

I just copied everything from /usr/share/R/doc to /usr/lib/R:

A bit of a hack but then everything works fine.

Best,
Wolfgang

>-----Original Message-----
>From: R-package-devel [mailto:r-package-devel-bounces at r-project.org] On Behalf Of
>G?ran Brostr?m
>Sent: Tuesday, 25 April, 2023 12:02
>To: Ivan Krylov
>Cc: R-package-devel at r-project.org
>Subject: Re: [R-pkg-devel] katex
>
>On 2023-04-25 10:02, Ivan Krylov wrote:
>> On Mon, 24 Apr 2023 18:17:22 +0200
>> G?ran Brostr?m <gb at ehar.se> wrote:
>>
>>>     cannot open file '/usr/lib/R/doc/html/katex/katex.js': No such
>>> file or directory
>>
>>> I still get the error with R CMD check --as-cran. What am I
>>> missing? Obviously /usr/lib/R/doc/html/katex/katex.js (no 'doc'), but
>>> ...
>>>
>>> I am installing R via apt.
>>
>> Thank you for mentioning this detail!
>>
>> At least in Debian packages, R's copy of KaTeX lives in /usr/share: per
>> Debian policy, "share" is for human-readable files like KaTeX, and
>> "lib" is for shared libraries, compiled code and the like.
>>
>> For a copy of R built from source, it's not a problem:
>
>Thanks. I have now built R from source and can confirm that everything
>works nicely. Can't remember when and why I stopped building R from
>source, probably not a good idea.
>
>G?ran

From edd @end|ng |rom deb|@n@org  Tue Apr 25 13:50:29 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 25 Apr 2023 06:50:29 -0500
Subject: [R-pkg-devel] katex
In-Reply-To: <e414533084754191b43984e9073230fc@UM-MAIL3210.unimaas.nl>
References: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
 <20230425110205.3c3ab024@Tarkus>
 <b5a7e523-0d3a-1da0-fa6e-5790547e01b9@ehar.se>
 <e414533084754191b43984e9073230fc@UM-MAIL3210.unimaas.nl>
Message-ID: <25671.48773.596668.820414@rob.eddelbuettel.com>


On 25 April 2023 at 11:39, Viechtbauer, Wolfgang (NP) wrote:
| I ran into the same issue (on Ubuntu 20.04).
| 
| I just copied everything from /usr/share/R/doc to /usr/lib/R:
| 
| A bit of a hack but then everything works fine.

That is rather bad as you create lots of 'orphan' files your package manager
does not know about.  We really should not be advertise this in public
without strong disclaimers (which you added, so thanks).

This whole thread would have been well at home on r-sig-debian.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n|  Tue Apr 25 13:59:31 2023
From: wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n| (Viechtbauer, Wolfgang (NP))
Date: Tue, 25 Apr 2023 11:59:31 +0000
Subject: [R-pkg-devel] katex
In-Reply-To: <25671.48773.596668.820414@rob.eddelbuettel.com>
References: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
 <20230425110205.3c3ab024@Tarkus>
 <b5a7e523-0d3a-1da0-fa6e-5790547e01b9@ehar.se>
 <e414533084754191b43984e9073230fc@UM-MAIL3210.unimaas.nl>
 <25671.48773.596668.820414@rob.eddelbuettel.com>
Message-ID: <a46e877878414704b857c90b8e2ded19@UM-MAIL3210.unimaas.nl>

Yeah, I know -- like I said, hack / not recommended / should handle this properly.

I spent a few hours yesterday rebuilding my package library because I build all packages from source -- really should start using r2u (thanks!) -- so once I got that issue, I was just trying to move on to get some work done.

Best,
Wolfgang

>-----Original Message-----
>From: Dirk Eddelbuettel [mailto:edd at debian.org]
>Sent: Tuesday, 25 April, 2023 13:50
>To: Viechtbauer, Wolfgang (NP)
>Cc: G?ran Brostr?m; Ivan Krylov; R-package-devel at r-project.org
>Subject: Re: [R-pkg-devel] katex
>
>On 25 April 2023 at 11:39, Viechtbauer, Wolfgang (NP) wrote:
>| I ran into the same issue (on Ubuntu 20.04).
>|
>| I just copied everything from /usr/share/R/doc to /usr/lib/R:
>|
>| A bit of a hack but then everything works fine.
>
>That is rather bad as you create lots of 'orphan' files your package manager
>does not know about.  We really should not be advertise this in public
>without strong disclaimers (which you added, so thanks).
>
>This whole thread would have been well at home on r-sig-debian.
>
>Dirk
>
>--
>dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Tue Apr 25 14:01:05 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 25 Apr 2023 15:01:05 +0300
Subject: [R-pkg-devel] katex
In-Reply-To: <25671.48107.989212.333685@rob.eddelbuettel.com>
References: <720ec323-c1e0-83e0-407a-b6d621ccd4cb@ehar.se>
 <20230425110205.3c3ab024@Tarkus>
 <25671.48107.989212.333685@rob.eddelbuettel.com>
Message-ID: <20230425150105.031fa126@arachnoid>

On Tue, 25 Apr 2023 06:39:23 -0500
Dirk Eddelbuettel <edd at debian.org> wrote:

> Nice catch. In favour. Would you mind filing a bugzilla report to
> make sure this persists and makes it into R 4.3.1 or 4.4.0 or ... ?

Thanks for the review! Filed the report at
<https://bugs.r-project.org/show_bug.cgi?id=18517>.

-- 
Best regards,
Ivan


From konr@d@rudo|ph @end|ng |rom gm@||@com  Tue Apr 25 17:27:34 2023
From: konr@d@rudo|ph @end|ng |rom gm@||@com (Konrad Rudolph)
Date: Tue, 25 Apr 2023 17:27:34 +0200
Subject: [R-pkg-devel] 
 How to format the NEWS.md file for CRAN submissions?
In-Reply-To: <84c5598b-47ab-ef3e-431e-8dbbef272b08@gmail.com>
References: <CAM2gKPbCPo6Y46e3QhCpC9uBTHqDsYmEdKKdKZ=AkbtgtQ_KGQ@mail.gmail.com>
 <84c5598b-47ab-ef3e-431e-8dbbef272b08@gmail.com>
Message-ID: <CAM2gKPYrhB1u_3a66xrBmjkMWFO1p4kt6n=E1zgYVs_aXeq9jQ@mail.gmail.com>

Hi Duncan,

Thanks, that?s perfect. So the issue in my case was the ?0.0.x? version
instead of the package name. That?s easily fixable, as verified by running
`utils::news()` on my package.

Cheers,
Konrad

On Mon, Apr 24, 2023 at 10:54?PM Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 24/04/2023 4:39 p.m., Konrad Rudolph wrote:
> > My package is creating a CRAN check NOTE because CRAN does not like the
> way
> > my NEWS.md file [1] is formatted.
> >
> > I am largely adhering to existing conventions with regards to my NEWS.md,
> > in particular the (rather minimal) GNU conventions [2] mentioned in
> R-exts
> > as well as the conventions used by ?pkgdown? to compile the file into a
> web
> > page. The one peculiarity of my NEWS.md file (and where it diverges from
> > the documented ?pkgdown? convention) is caused by the fact that my
> package
> > has undergone a name change in the past. As a consequence, not all
> headings
> > in the NEWS.md file follow the format `# ?pkgname? ?version?`.
> > Consequently, the CRAN check complains
> >
> >>    Cannot extract version info from the following section titles:
> >>      modules 0.x
> >
> > I have two questions:
> >
> > 1. Am I overlooking where the CRAN requirements for NEWS files are
> > documented? As far as I can see I am not violating a documented rule.
>
> The documentation is in the ?util::news help topic.  It says:
>
> "File ?NEWS.md? should contain the news in Markdown (following the
> CommonMark (https://commonmark.org/) specification), with the primary
> heading level giving the version number after a prefix followed by a
> space, and optionally followed by a space and a parenthesized ISO 8601
> format date."
>
>
> > 2. What is the best way of avoiding this NOTE _without_ dropping the
> > changelog pre package name change? In particular, since ?pkgdown? does
> not
> > support this I would like keep these changes in a single NEWS.md file
> > rather than moving them into a separate file. Likewise, I think it would
> be
> > misleading (and hence undesirable) to change the section headings to use
> > the current package name for the old revisions.
>
> I don't think it cares what the prefix is, so you could use something
> other than the current package name there.
>
> Duncan Murdoch
>
>
> >
> > [1]
> >
> https://github.com/klmr/box/blob/9f35bd28b26306fe94ade874c2b93a89ae3f3a61/NEWS.md
> > [2] https://www.gnu.org/prep/standards/standards.html#NEWS-File
> >
> > Cheers,
> > Konrad
> >
>
>

-- 
Konrad Rudolph // @klmr

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Wed Apr 26 16:02:33 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 26 Apr 2023 09:02:33 -0500
Subject: [R-pkg-devel] 'Default' macos (x86) download URL now gone?
In-Reply-To: <5F0CF217-5A2E-466F-9738-B49A43688CAA@R-project.org>
References: <25669.19936.694972.114117@rob.eddelbuettel.com>
 <5F0CF217-5A2E-466F-9738-B49A43688CAA@R-project.org>
Message-ID: <25673.12025.938360.399881@rob.eddelbuettel.com>


Simon,

On 24 April 2023 at 18:28, Simon Urbanek wrote:
| thanks - the problem is that there is not a single installer package (for several years now), so that URL is ambiguous. Whether the missing link is a good or bad depends on how it is used. I would argue that any link to that URL is inherently bad, because there is no way of knowing that the link works for a particular system - that's why I have originally removed it with the R 4.3.0 release. I have restored it now, making it point to the R 4.3.0 arm64 release since that is arguably the closest to a single "latest R". R releases have not been stored in /bin/macosx since 2015, so anyone using a link there is asking for trouble.

Restoring it _but switching the architecture under it_ is another subtle way
to still break things where the expectation based on a decade+ of prior
practice was that this works:

   installer: Error - R 4.3.0 for macOS (ARM64) can?t be installed on this computer.
   Error: Process completed with exit code 1.

I long have repaired my (main) script in r-ci but this will likely surprise others.

| For any CI I would strongly recommend using the "last-success" links: https://mac.r-project.org/big-sur/last-success/ in particular the .xz versions are they are specifically designed to be used by CI (small download, fast and localized install).

That is a fine idea but no replacement as it leads to a need for a different
deployment and how / where to untar etc.

Maybe you are someone wants to wrap that into a suitable script or 'action
snippet' and document that?   I can't, I don't even have a mac.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Apr 26 17:00:06 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 26 Apr 2023 18:00:06 +0300
Subject: [R-pkg-devel] RFC: An ad-hoc "cluster" one can leave and rejoin
 later
Message-ID: <20230426180006.445b9bcb@arachnoid>

Hello R-package-devel members,

I've got an idea for a package. I'm definitely reinventing a wheel, but
I couldn't find anything that would fulfil 100% of my requirements.

I've got a computational experiment that takes a while to complete, but
the set of machines that can run it varies during the day. For example,
I can leave a computer running in my bedroom, but I'd rather turn it
off for the night. For now, I work around the problem with a lot of
caching [*], restarting the job with different cluster geometries and
letting it load the parts that are already done from the disk.

Here's a proof of concept implementation of a server that sits between
the clients and a pool of compute nodes, dynamically distributing the
tasks between the nodes: https://github.com/aitap/nodepool

In addition to letting nodes come and go as they like, it also doesn't
strain R's NCONNECTIONS limit on nodes and clients (although the pool
would still benefit from it being increased) and only requires the pool
to be available for inbound connections [**].

It's definitely not CRAN quality yet and at the very least needs a
better task submission API, but it does seem to work. Does it sound
like it could be useful in your own work? Any ideas I could implement,
besides those mentioned in the README?

Here's a terrible hack: the pool speaks R's cluster protocol. One
could, in theory, construct a mock-"cluster" object consisting of
connections to the pool server and use parLapplyLB to distribute a
number of tasks between the pool nodes. But that's a bad idea for a lot
of reasons.

-- 
Best regards,
Ivan

[*] I need caching anyway because some of my machines have hardware
problems and may just reboot for no reason.

[**] Although Henrik Bengtsson's excellent
parallelly::makeClusterPSOCK() makes it much less of a problem.


From gert @end|ng |rom gertvv@n|  Wed Apr 26 20:38:36 2023
From: gert @end|ng |rom gertvv@n| (Gert van Valkenhoef)
Date: Wed, 26 Apr 2023 20:38:36 +0200
Subject: [R-pkg-devel] CRAN check fails on NEWS
Message-ID: <f15cecf9-a55d-9193-5e64-541aba0d4e07@gertvv.nl>

Hi all,

I'm hoping you can help me understand this new CRAN check failure that 
occurs on Debian but not on Windows:

Debian:<https://win-builder.r-project.org/incoming_pretest/smaa_0.3-2_20230424_202447/Debian/00check.log>
Status: 1 NOTE

* checking package subdirectories ... NOTE
Problems with news in ?NEWS?:
   Cannot process chunk/lines:
     smaa 0.3-0
   ... etc ...

This error was not raised by previous versions and I did not change the 
NEWS file for this version. The same package passes the same check on 
Debian r-devel on r-hub (see the full build log: HTML 
<https://builder.r-hub.io/status/smaa_0.3-2.tar.gz-6ab795be6475b44b1ec363a82c45a2cb>, 
text 
<https://builder.r-hub.io/status/original/smaa_0.3-2.tar.gz-6ab795be6475b44b1ec363a82c45a2cb>, 
artifacts 
<https://artifacts.r-hub.io/smaa_0.3-2.tar.gz-6ab795be6475b44b1ec363a82c45a2cb>.)

I couldn't find any documentation regarding this error or a clear 
specification of how NEWS should be formatted. I had understood it t be 
a plain text file.

Thanks in advance,

Gert

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Wed Apr 26 21:32:15 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Wed, 26 Apr 2023 22:32:15 +0300
Subject: [R-pkg-devel] CRAN check fails on NEWS
In-Reply-To: <f15cecf9-a55d-9193-5e64-541aba0d4e07@gertvv.nl>
References: <f15cecf9-a55d-9193-5e64-541aba0d4e07@gertvv.nl>
Message-ID: <20230426223215.7a0e6102@Tarkus>

On Wed, 26 Apr 2023 20:38:36 +0200
Gert van Valkenhoef <gert at gertvv.nl> wrote:

> I'm hoping you can help me understand this new CRAN check failure
> that occurs on Debian but not on Windows:

Unfortunately, not all checks are enabled on all check machines.

> * checking package subdirectories ... NOTE
> Problems with news in ?NEWS?:
>    Cannot process chunk/lines:
>      smaa 0.3-0
>    ... etc ...

Your NEWS file at
<https://github.com/gertvv/rsmaa/blob/master/smaa/NEWS> looks like
valid Markdown to me. In fact, I can parse it using R's NEWS.md parser
without any warnings, so in order to solve the problem, you just need
to rename it to NEWS.md.

R's requirements for "plain text" NEWS files are documented in
help(news) (together with requirements for NEWS.md and NEWS.Rd).

> The same package passes the same check on  Debian r-devel on r-hub
> (see the full build log:
> HTML
> <https://builder.r-hub.io/status/smaa_0.3-2.tar.gz-6ab795be6475b44b1ec363a82c45a2cb>, 

Are they running R CMD check without --as-cran? This could be the
reason why they didn't pick up this problem sooner. Running
rhub::check_for_cran() will run a more comprehensive set of checks on
your package.

-- 
Best regards,
Ivan


From henr|k@bengt@@on @end|ng |rom gm@||@com  Wed Apr 26 21:50:50 2023
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Wed, 26 Apr 2023 12:50:50 -0700
Subject: [R-pkg-devel] CRAN check fails on NEWS
In-Reply-To: <20230426223215.7a0e6102@Tarkus>
References: <f15cecf9-a55d-9193-5e64-541aba0d4e07@gertvv.nl>
 <20230426223215.7a0e6102@Tarkus>
Message-ID: <CAFDcVCSJ1ktbDKH5dRTJYXEbiboSm1WOU+DVjTi6sUEm7cmQpg@mail.gmail.com>

To reproduce this, you can use tools:::.news_reader_default(), e.g.

> utils::download.file("https://raw.githubusercontent.com/gertvv/rsmaa/master/smaa/NEWS", "NEWS", quiet = TRUE)
> news <- tools:::.news_reader_default("NEWS")
Warning messages:
1: Cannot process chunk/lines:
  smaa 0.3-0
2: Cannot process chunk/lines:
  smaa 0.2-5
...
9: Cannot process chunk/lines:
  smaa 0.1

You can check for attribute 'bad' to detect if there are parsing errors, e.g.

> bad <- which(attr(news, "bad"))
> news[bad, "Version"]
[1] "0.3-0" "0.2-5" "0.2-4" "0.2-3" "0.2-2" "0.2-1" "0.2"   "0.1-1" "0.1"

I have a check_news() [0] that does this job for me (it checks both
NEWS and NEWS.md), e.g.

> check_news("NEWS")
Error: Detected 9 malformed entries in 'NEWS': 0.3-0, 0.2-5, 0.2-4,
0.2-3, 0.2-2, 0.2-1, 0.2, 0.1-1, 0.1

Hope this helps,

/Henrik

[0] https://github.com/HenrikBengtsson/dotfiles-for-R/blob/master/Rprofile.d/interactive%3DTRUE/check_news.R

On Wed, Apr 26, 2023 at 12:32?PM Ivan Krylov <krylov.r00t at gmail.com> wrote:
>
> On Wed, 26 Apr 2023 20:38:36 +0200
> Gert van Valkenhoef <gert at gertvv.nl> wrote:
>
> > I'm hoping you can help me understand this new CRAN check failure
> > that occurs on Debian but not on Windows:
>
> Unfortunately, not all checks are enabled on all check machines.
>
> > * checking package subdirectories ... NOTE
> > Problems with news in ?NEWS?:
> >    Cannot process chunk/lines:
> >      smaa 0.3-0
> >    ... etc ...
>
> Your NEWS file at
> <https://github.com/gertvv/rsmaa/blob/master/smaa/NEWS> looks like
> valid Markdown to me. In fact, I can parse it using R's NEWS.md parser
> without any warnings, so in order to solve the problem, you just need
> to rename it to NEWS.md.
>
> R's requirements for "plain text" NEWS files are documented in
> help(news) (together with requirements for NEWS.md and NEWS.Rd).
>
> > The same package passes the same check on  Debian r-devel on r-hub
> > (see the full build log:
> > HTML
> > <https://builder.r-hub.io/status/smaa_0.3-2.tar.gz-6ab795be6475b44b1ec363a82c45a2cb>,
>
> Are they running R CMD check without --as-cran? This could be the
> reason why they didn't pick up this problem sooner. Running
> rhub::check_for_cran() will run a more comprehensive set of checks on
> your package.
>
> --
> Best regards,
> Ivan
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n|  Thu Apr 27 13:47:27 2023
From: wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n| (Viechtbauer, Wolfgang (NP))
Date: Thu, 27 Apr 2023 11:47:27 +0000
Subject: [R-pkg-devel] RFC: An ad-hoc "cluster" one can leave and rejoin
 later
In-Reply-To: <20230426180006.445b9bcb@arachnoid>
References: <20230426180006.445b9bcb@arachnoid>
Message-ID: <ba8e2cd53b8146a1be61bd363ad9dc35@UM-MAIL3210.unimaas.nl>

Dear Ivan,

Yes, this is *definitely* very useful in my own work. In fact, I had thought about writing something like this myself!

Can you clarify what happens if a node disconnects from the pool while it is running some assigned task? I assume/hope the pool server keeps track of that and will then submit the nonfinished task to another node.

Also, are there any issues with using the pool machine also as a node?

PS: In the README, 'cliends' -> 'clients'.

Best,
Wolfgang

>-----Original Message-----
>From: R-package-devel [mailto:r-package-devel-bounces at r-project.org] On Behalf Of
>Ivan Krylov
>Sent: Wednesday, 26 April, 2023 17:00
>To: r-package-devel at r-project.org
>Subject: [R-pkg-devel] RFC: An ad-hoc "cluster" one can leave and rejoin later
>
>Hello R-package-devel members,
>
>I've got an idea for a package. I'm definitely reinventing a wheel, but
>I couldn't find anything that would fulfil 100% of my requirements.
>
>I've got a computational experiment that takes a while to complete, but
>the set of machines that can run it varies during the day. For example,
>I can leave a computer running in my bedroom, but I'd rather turn it
>off for the night. For now, I work around the problem with a lot of
>caching [*], restarting the job with different cluster geometries and
>letting it load the parts that are already done from the disk.
>
>Here's a proof of concept implementation of a server that sits between
>the clients and a pool of compute nodes, dynamically distributing the
>tasks between the nodes: https://github.com/aitap/nodepool
>
>In addition to letting nodes come and go as they like, it also doesn't
>strain R's NCONNECTIONS limit on nodes and clients (although the pool
>would still benefit from it being increased) and only requires the pool
>to be available for inbound connections [**].
>
>It's definitely not CRAN quality yet and at the very least needs a
>better task submission API, but it does seem to work. Does it sound
>like it could be useful in your own work? Any ideas I could implement,
>besides those mentioned in the README?
>
>Here's a terrible hack: the pool speaks R's cluster protocol. One
>could, in theory, construct a mock-"cluster" object consisting of
>connections to the pool server and use parLapplyLB to distribute a
>number of tasks between the pool nodes. But that's a bad idea for a lot
>of reasons.
>
>--
>Best regards,
>Ivan
>
>[*] I need caching anyway because some of my machines have hardware
>problems and may just reboot for no reason.
>
>[**] Although Henrik Bengtsson's excellent
>parallelly::makeClusterPSOCK() makes it much less of a problem.


From kry|ov@r00t @end|ng |rom gm@||@com  Fri Apr 28 09:48:38 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Fri, 28 Apr 2023 10:48:38 +0300
Subject: [R-pkg-devel] RFC: An ad-hoc "cluster" one can leave and rejoin
 later
In-Reply-To: <ba8e2cd53b8146a1be61bd363ad9dc35@UM-MAIL3210.unimaas.nl>
References: <20230426180006.445b9bcb@arachnoid>
 <ba8e2cd53b8146a1be61bd363ad9dc35@UM-MAIL3210.unimaas.nl>
Message-ID: <20230428104838.0e612704@Tarkus>

On Thu, 27 Apr 2023 11:47:27 +0000
"Viechtbauer, Wolfgang (NP)"
<wolfgang.viechtbauer at maastrichtuniversity.nl> wrote:

> Can you clarify what happens if a node disconnects from the pool
> while it is running some assigned task? I assume/hope the pool server
> keeps track of that and will then submit the nonfinished task to
> another node.

This is exactly what happens. In the function that removes a node from
the pool, there is a check for a pending task associated with that
node. If such a task is found, it's put back at the end of the queue.

(So if you accidentally create a task that crashes a node in a way that
cannot be caught by tryCatch(), it will eventually take the whole pool
offline. On the other hand, if the nodes are automatically restarted,
they will run all other tasks in the queue before encountering the
crashing task again.)

I'd like to write an integration test that would create a pool with two
nodes, send two tasks consisting of Sys.sleep() to them, then crash one
of the nodes after they accept the tasks. Even without the crashing
(which could be part of the task, if (node_destined_to_crash) q('no')),
this is some hair-raising code: I need multiple child processes running
with the same temporary library where the package version being tested
is installed, and also some synchronisation between them.

> Also, are there any issues with using the pool machine also as a node?

There shouldn't be. In fact, I should probably add a parameter to the
run_pool() function that automatically creates a number of nodes on the
same machine.

> PS: In the README, 'cliends' -> 'clients'.

Thanks!

-- 
Best regards,
Ivan


From gert @end|ng |rom gertvv@n|  Sat Apr 29 20:10:54 2023
From: gert @end|ng |rom gertvv@n| (Gert van Valkenhoef)
Date: Sat, 29 Apr 2023 20:10:54 +0200
Subject: [R-pkg-devel] CRAN check fails on NEWS
In-Reply-To: <CAFDcVCSJ1ktbDKH5dRTJYXEbiboSm1WOU+DVjTi6sUEm7cmQpg@mail.gmail.com>
References: <f15cecf9-a55d-9193-5e64-541aba0d4e07@gertvv.nl>
 <20230426223215.7a0e6102@Tarkus>
 <CAFDcVCSJ1ktbDKH5dRTJYXEbiboSm1WOU+DVjTi6sUEm7cmQpg@mail.gmail.com>
Message-ID: <aa0b18f2-15da-2883-2150-2729fc13f36a@gertvv.nl>

Thanks all for the help, looks like the package is back in good standing 
with CRAN. :-)

On 26/04/2023 21.50, Henrik Bengtsson wrote:
> To reproduce this, you can use tools:::.news_reader_default(), e.g.
>
>> utils::download.file("https://raw.githubusercontent.com/gertvv/rsmaa/master/smaa/NEWS", "NEWS", quiet = TRUE)
>> news <- tools:::.news_reader_default("NEWS")
> Warning messages:
> 1: Cannot process chunk/lines:
>    smaa 0.3-0
> 2: Cannot process chunk/lines:
>    smaa 0.2-5
> ...
> 9: Cannot process chunk/lines:
>    smaa 0.1
>
> You can check for attribute 'bad' to detect if there are parsing errors, e.g.
>
>> bad <- which(attr(news, "bad"))
>> news[bad, "Version"]
> [1] "0.3-0" "0.2-5" "0.2-4" "0.2-3" "0.2-2" "0.2-1" "0.2"   "0.1-1" "0.1"
>
> I have a check_news() [0] that does this job for me (it checks both
> NEWS and NEWS.md), e.g.
>
>> check_news("NEWS")
> Error: Detected 9 malformed entries in 'NEWS': 0.3-0, 0.2-5, 0.2-4,
> 0.2-3, 0.2-2, 0.2-1, 0.2, 0.1-1, 0.1
>
> Hope this helps,
>
> /Henrik
>
> [0] https://github.com/HenrikBengtsson/dotfiles-for-R/blob/master/Rprofile.d/interactive%3DTRUE/check_news.R
>
> On Wed, Apr 26, 2023 at 12:32?PM Ivan Krylov <krylov.r00t at gmail.com> wrote:
>> On Wed, 26 Apr 2023 20:38:36 +0200
>> Gert van Valkenhoef <gert at gertvv.nl> wrote:
>>
>>> I'm hoping you can help me understand this new CRAN check failure
>>> that occurs on Debian but not on Windows:
>> Unfortunately, not all checks are enabled on all check machines.
>>
>>> * checking package subdirectories ... NOTE
>>> Problems with news in ?NEWS?:
>>>     Cannot process chunk/lines:
>>>       smaa 0.3-0
>>>     ... etc ...
>> Your NEWS file at
>> <https://github.com/gertvv/rsmaa/blob/master/smaa/NEWS> looks like
>> valid Markdown to me. In fact, I can parse it using R's NEWS.md parser
>> without any warnings, so in order to solve the problem, you just need
>> to rename it to NEWS.md.
>>
>> R's requirements for "plain text" NEWS files are documented in
>> help(news) (together with requirements for NEWS.md and NEWS.Rd).
>>
>>> The same package passes the same check on  Debian r-devel on r-hub
>>> (see the full build log:
>>> HTML
>>> <https://builder.r-hub.io/status/smaa_0.3-2.tar.gz-6ab795be6475b44b1ec363a82c45a2cb>,
>> Are they running R CMD check without --as-cran? This could be the
>> reason why they didn't pick up this problem sooner. Running
>> rhub::check_for_cran() will run a more comprehensive set of checks on
>> your package.
>>
>> --
>> Best regards,
>> Ivan
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de  Wed May  3 14:00:51 2023
From: Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de (Ruff, Sergej)
Date: Wed, 3 May 2023 12:00:51 +0000
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <20230320230838.045b31ba@Tarkus>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <CAMyz+tUStG9z=JFkBVBatquzyonuQ2d5KjHXbq6C8Faz9Aijkg@mail.gmail.com>
 <221c8bb7465e4bcaa9db4c34738da689@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>,
 <20230320230838.045b31ba@Tarkus>
Message-ID: <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>

I implemented teh limma Bioconductor dependency into the Suggests file and made it conditionally


Meaning I provided the Description File with


Suggests:
    BiocManager,
    limma


and created a short function which checks if limma is available


#' Check for package dependency
#'
#' @title Check for 'limma' availability
#' @description checks if the 'limma' package is installed. If not already installed,
#' limma will be installed automatically.
#' @author Sergej Ruff
#' @importFrom utils install.packages menu
#' @export
#' @keywords internal
check_limma <- function() # Returns TRUE if available, FALSE otherwise
{
  if(requireNamespace("limma", quietly=TRUE)) return(TRUE)
  if(!interactive()) return(FALSE)
  inst <- menu(c("Yes", "No"), title="Package {limma} required but not installed.\nDo you want to install it now?")
  if(inst != 1)
  {
    message("To run this example, first install {limma} following the directions at 'https://bioconductor.org/packages/limma'")
    return(FALSE)
  }
  # the following could be wrapped in try and conditionally return TRUE / FALSE
  if(!requireNamespace("BiocManager", quietly=TRUE)) install.packages("BiocManager", quiet=TRUE)
  BiocManager::install("limma", update=FALSE, ask=FALSE, quiet=TRUE)
  return(TRUE)
}

In the example field which uses the limma functions I then implemented the check-function:


if(check_limma()){
group = gl(2, n)
design = model.matrix(~ group)
fit1 = limma::lmFit(X, design)
fit = limma::eBayes(fit1)

### Calculation of confidence intervals
CI = fc_ci(fit=fit, alpha=0.05, method="raw")
head(CI)
CI = fc_ci(fit=fit, alpha=0.05, method="BH")
head(CI)
CI = fc_ci(fit=fit, alpha=0.05, method="BY")
head(CI)

fc_plot(CI, xlim=c(-0.5, 3), ylim=-log10(c(1, 0.0001)), updown="up")
fc_plot(CI, xlim=c(-3, 0.5), ylim=-log10(c(1, 0.0001)), updown="down")
fc_plot(CI, xlim=c(-3, 3), ylim=-log10(c(1, 0.0001)), updown="all")
}



I don?t get any Errors. Thank you R mailing list for providing the tips.


I just wanted to ask, if theres any other way to implement it, since I have never seen an example field

which has a check-if dependency is available function.


Is there any Improvments i could make or better methods.


Also for the future - how Do i provide Bioconductor dependencies as "Imports" for a package that I want to submit to CRAN?

Do I need to make that also conditional? I know I should provide Installation description in a readme fiel but how do I make sure

that the Bioconductor dependencies dont cause a rejection from CRAN?


Best Regards,

Sergej

________________________________
Von: Ivan Krylov <krylov.r00t at gmail.com>
Gesendet: Montag, 20. M?rz 2023 21:08:38
An: Ruff, Sergej
Cc: r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package

On Mon, 20 Mar 2023 19:32:03 +0000
"Ruff, Sergej" <Sergej.Ruff at tiho-hannover.de> wrote:

> but I thought Notes will also cause rejection when submitting a
> package to CRAN. Won?t that be a problem?

True, a NOTE during an automatic check may cause a rejection, but you
won't get this NOTE there. Automatic CRAN pre-tests are done with a
full package set: anything from CRAN and BioConductor that runs on a
given operating system can be loaded.

(This differentiates CRAN from, say, PyPI or NPM: the two latter
ecosystems are much larger and are expected to handle conflicting
dependency requirements. CRAN is small enough to be able to enforce the
rule that every package must play well with the latest version of
everything else.)

There's an additional CRAN check called noSuggests
<https://www.stats.ox.ac.uk/pub/bdr/noSuggests/README.txt>. You will
get a NOTE there, but it's expected and won't count against you. The
only way avoid this NOTE there is to not have any packages in Suggests:
(or Enhances:).

--
Best regards,
Ivan

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed May  3 14:25:56 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 3 May 2023 08:25:56 -0400
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <221c8bb7465e4bcaa9db4c34738da689@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
Message-ID: <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>



On 03/05/2023 8:00 a.m., Ruff, Sergej wrote:
... [ lines about current solution deleted ]

> Also for the future - how Do i provide Bioconductor dependencies as "Imports" for a package that I want to submit to CRAN?

Just list it as you would a CRAN package.  The CRAN docs talk about 
"mainstream repositories"; I forget what the definition is of that 
(maybe repositories listed in `file.path(R.home(), 
"etc/repositories")`?), but definitely BioConductor is included.

> Do I need to make that also conditional? I know I should provide Installation description in a readme fiel but how do I make sure

No, you don't need to check.  If any imported package is not available, 
your package will not load, so errors will happen before you ever get to 
running examples.

> that the Bioconductor dependencies dont cause a rejection from CRAN?

Just make sure they exist on BioC and your code works with them.

Duncan Murdoch


From Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de  Wed May  3 15:17:06 2023
From: Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de (Ruff, Sergej)
Date: Wed, 3 May 2023 13:17:06 +0000
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <221c8bb7465e4bcaa9db4c34738da689@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>,
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
Message-ID: <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>

Thanks,


So is it just necessary for suggested packages.


So, is it just good practice to make a conditional check?

I saw some packages still include it.


For example the Seurat package.


Under Utils.R (line 349-379) of the SeuratObject-Package (https://cran.r-project.org/src/contrib/Archive/SeuratObject/) you will find the PackageCheck-function

which used by the Seurat-Package (https://cran.r-project.org/src/contrib/Archive/Seurat/) to check if packages are alredy installed.

You can find examples for DEseq2 under differential_expression.R (starting line 1314 or you cntr+f for packagecheck) in the Seurat.package (https://cran.r-project.org/src/contrib/Archive/Seurat/)

or for limma (starting line 2292).



________________________________
Von: Duncan Murdoch <murdoch.duncan at gmail.com>
Gesendet: Mittwoch, 3. Mai 2023 14:25:56
An: Ruff, Sergej; Ivan Krylov
Cc: r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package



On 03/05/2023 8:00 a.m., Ruff, Sergej wrote:
... [ lines about current solution deleted ]

> Also for the future - how Do i provide Bioconductor dependencies as "Imports" for a package that I want to submit to CRAN?

Just list it as you would a CRAN package.  The CRAN docs talk about
"mainstream repositories"; I forget what the definition is of that
(maybe repositories listed in `file.path(R.home(),
"etc/repositories")`?), but definitely BioConductor is included.

> Do I need to make that also conditional? I know I should provide Installation description in a readme fiel but how do I make sure

No, you don't need to check.  If any imported package is not available,
your package will not load, so errors will happen before you ever get to
running examples.

> that the Bioconductor dependencies dont cause a rejection from CRAN?

Just make sure they exist on BioC and your code works with them.

Duncan Murdoch


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed May  3 15:29:34 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 3 May 2023 09:29:34 -0400
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
Message-ID: <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>

On 03/05/2023 9:17 a.m., Ruff, Sergej wrote:
> Thanks,
> 
> 
> So is it just necessary for suggested packages.

Those and "Enhances" packages, but hardly anyone uses "Enhances".
> 
> 
> So, is it just good practice to make a conditional check?

No, it is a requirement if the package is used but is not listed in 
Depends or Imports.

If the package is in Depends or Imports it is a waste of time to make 
the check:  it will always succeed.

> I saw some packages still include it.
> 
> 
> For example the Seurat package.
>
I don't understand your question here.

Duncan Murdoch

> 
> Under Utils.R (line 349-379) of the SeuratObject-Package 
> (https://cran.r-project.org/src/contrib/Archive/SeuratObject/ 
> <https://cran.r-project.org/src/contrib/Archive/SeuratObject/>) you will 
> find the PackageCheck-function
> 
> which used by the Seurat-Package 
> (https://cran.r-project.org/src/contrib/Archive/Seurat/ 
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>) to check if 
> packages are alredy installed.
> 
> 
> You can find examples for DEseq2 under differential_expression.R 
> (starting line 1314 or you cntr+f for packagecheck) in 
> the?Seurat.package 
> (https://cran.r-project.org/src/contrib/Archive/Seurat/ 
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>)
> 
> or for limma (starting line 2292).
> 
> 
> 
> ------------------------------------------------------------------------
> *Von:* Duncan Murdoch <murdoch.duncan at gmail.com>
> *Gesendet:* Mittwoch, 3. Mai 2023 14:25:56
> *An:* Ruff, Sergej; Ivan Krylov
> *Cc:* r-package-devel at r-project.org
> *Betreff:* Re: [R-pkg-devel] How to declare Bioconductor Dependencies in 
> the Description File of my R Package
> 
> 
> On 03/05/2023 8:00 a.m., Ruff, Sergej wrote:
> ... [ lines about current solution deleted ]
> 
>> Also for the future - how Do i provide Bioconductor dependencies as "Imports" for a package that I want to submit to CRAN?
> 
> Just list it as you would a CRAN package.? The CRAN docs talk about
> "mainstream repositories"; I forget what the definition is of that
> (maybe repositories listed in `file.path(R.home(),
> "etc/repositories")`?), but definitely BioConductor is included.
> 
>> Do I need to make that also conditional? I know I should provide Installation description in a readme fiel but how do I make sure
> 
> No, you don't need to check.? If any imported package is not available,
> your package will not load, so errors will happen before you ever get to
> running examples.
> 
>> that the Bioconductor dependencies dont cause a rejection from CRAN?
> 
> Just make sure they exist on BioC and your code works with them.
> 
> Duncan Murdoch
>


From Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de  Wed May  3 15:50:06 2023
From: Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de (Ruff, Sergej)
Date: Wed, 3 May 2023 13:50:06 +0000
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>,
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
Message-ID: <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>

I took the Seurat package as an example, because it both lists the Bioconductor Dependencies under Imports in the DESCRIPTION-File

and it uses conditional functions to check if those dependencies are pre-installed.


"No, it is a requirement if the package is used but is not listed in
Depends or Imports.

If the package is in Depends or Imports it is a waste of time to make
the check:  it will always succeed."


that's what I also thought but I am confused why a package like Seurat then lists the dependencies in the DESCRIPTION-File and on top of that uses

conditional functions to check if the package is pre-installed or not. Wouldn't that make the packagecheck function used by Seurat redundant?

Sergej Ruff

________________________________
Von: Duncan Murdoch <murdoch.duncan at gmail.com>
Gesendet: Mittwoch, 3. Mai 2023 15:29:34
An: Ruff, Sergej; Ivan Krylov
Cc: r-package-devel at r-project.org
Betreff: Re: AW: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package

On 03/05/2023 9:17 a.m., Ruff, Sergej wrote:
> Thanks,
>
>
> So is it just necessary for suggested packages.

Those and "Enhances" packages, but hardly anyone uses "Enhances".
>
>
> So, is it just good practice to make a conditional check?

No, it is a requirement if the package is used but is not listed in
Depends or Imports.

If the package is in Depends or Imports it is a waste of time to make
the check:  it will always succeed.

> I saw some packages still include it.
>
>
> For example the Seurat package.
>
I don't understand your question here.

Duncan Murdoch

>
> Under Utils.R (line 349-379) of the SeuratObject-Package
> (https://cran.r-project.org/src/contrib/Archive/SeuratObject/
> <https://cran.r-project.org/src/contrib/Archive/SeuratObject/>) you will
> find the PackageCheck-function
>
> which used by the Seurat-Package
> (https://cran.r-project.org/src/contrib/Archive/Seurat/
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>) to check if
> packages are alredy installed.
>
>
> You can find examples for DEseq2 under differential_expression.R
> (starting line 1314 or you cntr+f for packagecheck) in
> the Seurat.package
> (https://cran.r-project.org/src/contrib/Archive/Seurat/
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>)
>
> or for limma (starting line 2292).
>
>
>
> ------------------------------------------------------------------------
> *Von:* Duncan Murdoch <murdoch.duncan at gmail.com>
> *Gesendet:* Mittwoch, 3. Mai 2023 14:25:56
> *An:* Ruff, Sergej; Ivan Krylov
> *Cc:* r-package-devel at r-project.org
> *Betreff:* Re: [R-pkg-devel] How to declare Bioconductor Dependencies in
> the Description File of my R Package
>
>
> On 03/05/2023 8:00 a.m., Ruff, Sergej wrote:
> ... [ lines about current solution deleted ]
>
>> Also for the future - how Do i provide Bioconductor dependencies as "Imports" for a package that I want to submit to CRAN?
>
> Just list it as you would a CRAN package.  The CRAN docs talk about
> "mainstream repositories"; I forget what the definition is of that
> (maybe repositories listed in `file.path(R.home(),
> "etc/repositories")`?), but definitely BioConductor is included.
>
>> Do I need to make that also conditional? I know I should provide Installation description in a readme fiel but how do I make sure
>
> No, you don't need to check.  If any imported package is not available,
> your package will not load, so errors will happen before you ever get to
> running examples.
>
>> that the Bioconductor dependencies dont cause a rejection from CRAN?
>
> Just make sure they exist on BioC and your code works with them.
>
> Duncan Murdoch
>


	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Wed May  3 16:22:09 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 3 May 2023 09:22:09 -0500
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>
Message-ID: <25682.28177.114923.880130@rob.eddelbuettel.com>


Sergej,

Please consider:

  - there are nearly 20k CRAN packages
  
  - all of them are mirrored at https://github.com/cran so you can browse

  - pick any one 'heavy' package you like, Seurat is a good example; there
    are other examples in geospatial or bioinformatics etc

  - you can browse _and search_ these to your hearts content

Here is an example of mine. In RcppArmadillo, years ago we (thanks to fine
Google Summer of Code work by Binxiang Ni) added extended support for sparse
matrices pass-through / conversione from R to C++ / Armadillo and back. That
is clearly an optional feature as most uses of (Rcpp)Armadillo use dense
matrices. So all code and test code is _conditional_.  File DESCRIPTION has

   Suggests: [...], Matrix (>= 1.3.0), [...], reticulate, slam

mostly for tests. I.e. We have very little R code: in one single file
R/SciPy2R.R we switched to doing this via reticulate and opee the function
with

    if (!requireNamespace("reticulate", quietly=TRUE)) {
        stop("You must install the 'reticulate' package (and have SciPy).", call.=FALSE)
    }

after an actual deprecation warning (as there was scipy converter once).

Similarly, the testsuites in inst/tinytests/* have several

    if (!requireNamespace("Matrix", quietly=TRUE)) exit_file("No Matrix package")

as well as

    if (!requireNamespace("reticulate", quietly=TRUE)) exit_file("Package reticulate missing")

    if (!packageVersion("reticulate") >= package_version("1.14"))
        exit_file("SciPy not needed on newer reticulate")

and tests for slam (another sparse matrix package besides the functionality
in Matrix).

Hopefully this brief snapshot gives you an idea.  There are (likely!!)
thousandss of examples you can browse, and I am sure you will find something.
If you have further (concrete) questions please do not hesitate to use the
resource of this list.

Cheers (or I should say "mit Braunschweiger Gruessen nach Hannover),

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de  Wed May  3 17:13:01 2023
From: Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de (Ruff, Sergej)
Date: Wed, 3 May 2023 15:13:01 +0000
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <25682.28177.114923.880130@rob.eddelbuettel.com>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>,
 <25682.28177.114923.880130@rob.eddelbuettel.com>
Message-ID: <66ce44cbbb8a43e9b26e1233d581d0c0@tiho-hannover.de>

Thank you, Dirk.


I see your dependencies are Suggested. I know that Suggested dependencies should be conditional.


Do you know if Non-Cran (Bioconductor) packages need to be conditional?  Do you have any experiece regarding Non-CRAN Dependencies

and how to handle them?


I believe Duncan Murdoch's experience and opinion regarding that topic, but i take any second and third opinion to be sure.


Thank you for your help.


Sergej

________________________________
Von: Dirk Eddelbuettel <edd at debian.org>
Gesendet: Mittwoch, 3. Mai 2023 16:22:09
An: Ruff, Sergej
Cc: Duncan Murdoch; Ivan Krylov; r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package


Sergej,

Please consider:

  - there are nearly 20k CRAN packages

  - all of them are mirrored at https://github.com/cran so you can browse

  - pick any one 'heavy' package you like, Seurat is a good example; there
    are other examples in geospatial or bioinformatics etc

  - you can browse _and search_ these to your hearts content

Here is an example of mine. In RcppArmadillo, years ago we (thanks to fine
Google Summer of Code work by Binxiang Ni) added extended support for sparse
matrices pass-through / conversione from R to C++ / Armadillo and back. That
is clearly an optional feature as most uses of (Rcpp)Armadillo use dense
matrices. So all code and test code is _conditional_.  File DESCRIPTION has

   Suggests: [...], Matrix (>= 1.3.0), [...], reticulate, slam

mostly for tests. I.e. We have very little R code: in one single file
R/SciPy2R.R we switched to doing this via reticulate and opee the function
with

    if (!requireNamespace("reticulate", quietly=TRUE)) {
        stop("You must install the 'reticulate' package (and have SciPy).", call.=FALSE)
    }

after an actual deprecation warning (as there was scipy converter once).

Similarly, the testsuites in inst/tinytests/* have several

    if (!requireNamespace("Matrix", quietly=TRUE)) exit_file("No Matrix package")

as well as

    if (!requireNamespace("reticulate", quietly=TRUE)) exit_file("Package reticulate missing")

    if (!packageVersion("reticulate") >= package_version("1.14"))
        exit_file("SciPy not needed on newer reticulate")

and tests for slam (another sparse matrix package besides the functionality
in Matrix).

Hopefully this brief snapshot gives you an idea.  There are (likely!!)
thousandss of examples you can browse, and I am sure you will find something.
If you have further (concrete) questions please do not hesitate to use the
resource of this list.

Cheers (or I should say "mit Braunschweiger Gruessen nach Hannover),

Dirk

--
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed May  3 17:25:15 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 3 May 2023 11:25:15 -0400
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>
Message-ID: <3c3e1424-7532-385e-a515-dcd4a3e3908c@gmail.com>

On 03/05/2023 9:50 a.m., Ruff, Sergej wrote:
> I took the Seurat package as an example, because it both lists the 
> Bioconductor?Dependencies under Imports in the DESCRIPTION-File

Which packages are you talking about?  I don't see any BioConductor 
dependencies in the Imports list for the current Seurat version.

Duncan Murdoch

> 
> and it uses conditional functions to check if those dependencies are 
> pre-installed.
> 
> 
> "No, it is a requirement if the package is used but is not listed in
> Depends or Imports.
> 
> If the package is in Depends or Imports it is a waste of time to make
> the check:? it will always succeed."
> 
> 
> that's what I also thought but I am confused why a package like Seurat 
> then lists the dependencies in the DESCRIPTION-File and on top of that uses
> 
> conditional functions to check if the package is pre-installed or not. 
> Wouldn't that make the packagecheck function used by Seurat redundant?
> 
> Sergej Ruff
> 
> ------------------------------------------------------------------------
> *Von:* Duncan Murdoch <murdoch.duncan at gmail.com>
> *Gesendet:* Mittwoch, 3. Mai 2023 15:29:34
> *An:* Ruff, Sergej; Ivan Krylov
> *Cc:* r-package-devel at r-project.org
> *Betreff:* Re: AW: [R-pkg-devel] How to declare Bioconductor 
> Dependencies in the Description File of my R Package
> On 03/05/2023 9:17 a.m., Ruff, Sergej wrote:
>> Thanks,
>> 
>> 
>> So is it just necessary for suggested packages.
> 
> Those and "Enhances" packages, but hardly anyone uses "Enhances".
>> 
>> 
>> So, is it just good practice to make a conditional check?
> 
> No, it is a requirement if the package is used but is not listed in
> Depends or Imports.
> 
> If the package is in Depends or Imports it is a waste of time to make
> the check:? it will always succeed.
> 
>> I saw some packages still include it.
>> 
>> 
>> For example the Seurat package.
>>
> I don't understand your question here.
> 
> Duncan Murdoch
> 
>> 
>> Under Utils.R (line 349-379) of the SeuratObject-Package 
>> (https://cran.r-project.org/src/contrib/Archive/SeuratObject/
>> <https://cran.r-project.org/src/contrib/Archive/SeuratObject/ 
> <https://cran.r-project.org/src/contrib/Archive/SeuratObject/>>) you will
>> find the PackageCheck-function
>> 
>> which used by the Seurat-Package 
>> (https://cran.r-project.org/src/contrib/Archive/Seurat/
>> <https://cran.r-project.org/src/contrib/Archive/Seurat/ 
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>>) to check if
>> packages are alredy installed.
>> 
>> 
>> You can find examples for DEseq2 under differential_expression.R 
>> (starting line 1314 or you cntr+f for packagecheck) in 
>> the?Seurat.package 
>> (https://cran.r-project.org/src/contrib/Archive/Seurat/
>> <https://cran.r-project.org/src/contrib/Archive/Seurat/ 
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>>)
>> 
>> or for limma (starting line 2292).
>> 
>> 
>> 
>> ------------------------------------------------------------------------
>> *Von:* Duncan Murdoch <murdoch.duncan at gmail.com>
>> *Gesendet:* Mittwoch, 3. Mai 2023 14:25:56
>> *An:* Ruff, Sergej; Ivan Krylov
>> *Cc:* r-package-devel at r-project.org
>> *Betreff:* Re: [R-pkg-devel] How to declare Bioconductor Dependencies in 
>> the Description File of my R Package
>> 
>> 
>> On 03/05/2023 8:00 a.m., Ruff, Sergej wrote:
>> ... [ lines about current solution deleted ]
>> 
>>> Also for the future - how Do i provide Bioconductor dependencies as "Imports" for a package that I want to submit to CRAN?
>> 
>> Just list it as you would a CRAN package.? The CRAN docs talk about
>> "mainstream repositories"; I forget what the definition is of that
>> (maybe repositories listed in `file.path(R.home(),
>> "etc/repositories")`?), but definitely BioConductor is included.
>> 
>>> Do I need to make that also conditional? I know I should provide Installation description in a readme fiel but how do I make sure
>> 
>> No, you don't need to check.? If any imported package is not available,
>> your package will not load, so errors will happen before you ever get to
>> running examples.
>> 
>>> that the Bioconductor dependencies dont cause a rejection from CRAN?
>> 
>> Just make sure they exist on BioC and your code works with them.
>> 
>> Duncan Murdoch
>> 
>


From Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de  Wed May  3 17:30:42 2023
From: Sergej@Ru|| @end|ng |rom t|ho-h@nnover@de (Ruff, Sergej)
Date: Wed, 3 May 2023 15:30:42 +0000
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <3c3e1424-7532-385e-a515-dcd4a3e3908c@gmail.com>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>,
 <3c3e1424-7532-385e-a515-dcd4a3e3908c@gmail.com>
Message-ID: <17911dddf80a4b7ca7c4b9c5bf25624d@tiho-hannover.de>

my bad,


I looked at the DESCRIPTIOn fiel again. I assumed that Cluster was a Bioconductor package.

I also didn?t see that DeSeq2 was in Suggests.


I will follow your advice and try using Bioconductor packages without a conditional function.


Sergej

________________________________
Von: Duncan Murdoch <murdoch.duncan at gmail.com>
Gesendet: Mittwoch, 3. Mai 2023 17:25:15
An: Ruff, Sergej; Ivan Krylov
Cc: r-package-devel at r-project.org
Betreff: Re: AW: AW: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package

On 03/05/2023 9:50 a.m., Ruff, Sergej wrote:
> I took the Seurat package as an example, because it both lists the
> Bioconductor Dependencies under Imports in the DESCRIPTION-File

Which packages are you talking about?  I don't see any BioConductor
dependencies in the Imports list for the current Seurat version.

Duncan Murdoch

>
> and it uses conditional functions to check if those dependencies are
> pre-installed.
>
>
> "No, it is a requirement if the package is used but is not listed in
> Depends or Imports.
>
> If the package is in Depends or Imports it is a waste of time to make
> the check:  it will always succeed."
>
>
> that's what I also thought but I am confused why a package like Seurat
> then lists the dependencies in the DESCRIPTION-File and on top of that uses
>
> conditional functions to check if the package is pre-installed or not.
> Wouldn't that make the packagecheck function used by Seurat redundant?
>
> Sergej Ruff
>
> ------------------------------------------------------------------------
> *Von:* Duncan Murdoch <murdoch.duncan at gmail.com>
> *Gesendet:* Mittwoch, 3. Mai 2023 15:29:34
> *An:* Ruff, Sergej; Ivan Krylov
> *Cc:* r-package-devel at r-project.org
> *Betreff:* Re: AW: [R-pkg-devel] How to declare Bioconductor
> Dependencies in the Description File of my R Package
> On 03/05/2023 9:17 a.m., Ruff, Sergej wrote:
>> Thanks,
>>
>>
>> So is it just necessary for suggested packages.
>
> Those and "Enhances" packages, but hardly anyone uses "Enhances".
>>
>>
>> So, is it just good practice to make a conditional check?
>
> No, it is a requirement if the package is used but is not listed in
> Depends or Imports.
>
> If the package is in Depends or Imports it is a waste of time to make
> the check:  it will always succeed.
>
>> I saw some packages still include it.
>>
>>
>> For example the Seurat package.
>>
> I don't understand your question here.
>
> Duncan Murdoch
>
>>
>> Under Utils.R (line 349-379) of the SeuratObject-Package
>> (https://cran.r-project.org/src/contrib/Archive/SeuratObject/
>> <https://cran.r-project.org/src/contrib/Archive/SeuratObject/
> <https://cran.r-project.org/src/contrib/Archive/SeuratObject/>>) you will
>> find the PackageCheck-function
>>
>> which used by the Seurat-Package
>> (https://cran.r-project.org/src/contrib/Archive/Seurat/
>> <https://cran.r-project.org/src/contrib/Archive/Seurat/
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>>) to check if
>> packages are alredy installed.
>>
>>
>> You can find examples for DEseq2 under differential_expression.R
>> (starting line 1314 or you cntr+f for packagecheck) in
>> the Seurat.package
>> (https://cran.r-project.org/src/contrib/Archive/Seurat/
>> <https://cran.r-project.org/src/contrib/Archive/Seurat/
> <https://cran.r-project.org/src/contrib/Archive/Seurat/>>)
>>
>> or for limma (starting line 2292).
>>
>>
>>
>> ------------------------------------------------------------------------
>> *Von:* Duncan Murdoch <murdoch.duncan at gmail.com>
>> *Gesendet:* Mittwoch, 3. Mai 2023 14:25:56
>> *An:* Ruff, Sergej; Ivan Krylov
>> *Cc:* r-package-devel at r-project.org
>> *Betreff:* Re: [R-pkg-devel] How to declare Bioconductor Dependencies in
>> the Description File of my R Package
>>
>>
>> On 03/05/2023 8:00 a.m., Ruff, Sergej wrote:
>> ... [ lines about current solution deleted ]
>>
>>> Also for the future - how Do i provide Bioconductor dependencies as "Imports" for a package that I want to submit to CRAN?
>>
>> Just list it as you would a CRAN package.  The CRAN docs talk about
>> "mainstream repositories"; I forget what the definition is of that
>> (maybe repositories listed in `file.path(R.home(),
>> "etc/repositories")`?), but definitely BioConductor is included.
>>
>>> Do I need to make that also conditional? I know I should provide Installation description in a readme fiel but how do I make sure
>>
>> No, you don't need to check.  If any imported package is not available,
>> your package will not load, so errors will happen before you ever get to
>> running examples.
>>
>>> that the Bioconductor dependencies dont cause a rejection from CRAN?
>>
>> Just make sure they exist on BioC and your code works with them.
>>
>> Duncan Murdoch
>>
>


	[[alternative HTML version deleted]]


From mtmorg@n@b|oc @end|ng |rom gm@||@com  Wed May  3 17:36:40 2023
From: mtmorg@n@b|oc @end|ng |rom gm@||@com (Martin Morgan)
Date: Wed, 3 May 2023 15:36:40 +0000
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <66ce44cbbb8a43e9b26e1233d581d0c0@tiho-hannover.de>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>,
 <25682.28177.114923.880130@rob.eddelbuettel.com>
 <66ce44cbbb8a43e9b26e1233d581d0c0@tiho-hannover.de>
Message-ID: <BY5PR04MB662737FA6521D906380C9C48F96C9@BY5PR04MB6627.namprd04.prod.outlook.com>

CRAN is fine with Bioconductor Depends: and Imports: dependencies, as previously mentioned. This is because the CRAN maintainers explicitly configure their system to know about Bioconductor package repositories.

Users face a different challenge -- many users will not have identified (e.g., via `setRepositories()` a Bioconductor repository, so when they try to install your package it will fail in a way that you have no control over -- a generic message saying that the Bioconductor dependencies was not found.

You could mitigate this by advertising that your CRAN package should be installed via `BiocManager::install("<your CRAN package>")`, which defines appropriate repositories for both CRAN and Bioconductor, but there is no way to unambiguously communicate this to users.

Martin

From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Ruff, Sergej <Sergej.Ruff at tiho-hannover.de>
Date: Wednesday, May 3, 2023 at 11:13 AM
To: Dirk Eddelbuettel <edd at debian.org>
Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package
Thank you, Dirk.


I see your dependencies are Suggested. I know that Suggested dependencies should be conditional.


Do you know if Non-Cran (Bioconductor) packages need to be conditional?  Do you have any experiece regarding Non-CRAN Dependencies

and how to handle them?


I believe Duncan Murdoch's experience and opinion regarding that topic, but i take any second and third opinion to be sure.


Thank you for your help.


Sergej

________________________________
Von: Dirk Eddelbuettel <edd at debian.org>
Gesendet: Mittwoch, 3. Mai 2023 16:22:09
An: Ruff, Sergej
Cc: Duncan Murdoch; Ivan Krylov; r-package-devel at r-project.org
Betreff: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package


Sergej,

Please consider:

  - there are nearly 20k CRAN packages

  - all of them are mirrored at https://github.com/cran so you can browse

  - pick any one 'heavy' package you like, Seurat is a good example; there
    are other examples in geospatial or bioinformatics etc

  - you can browse _and search_ these to your hearts content

Here is an example of mine. In RcppArmadillo, years ago we (thanks to fine
Google Summer of Code work by Binxiang Ni) added extended support for sparse
matrices pass-through / conversione from R to C++ / Armadillo and back. That
is clearly an optional feature as most uses of (Rcpp)Armadillo use dense
matrices. So all code and test code is _conditional_.  File DESCRIPTION has

   Suggests: [...], Matrix (>= 1.3.0), [...], reticulate, slam

mostly for tests. I.e. We have very little R code: in one single file
R/SciPy2R.R we switched to doing this via reticulate and opee the function
with

    if (!requireNamespace("reticulate", quietly=TRUE)) {
        stop("You must install the 'reticulate' package (and have SciPy).", call.=FALSE)
    }

after an actual deprecation warning (as there was scipy converter once).

Similarly, the testsuites in inst/tinytests/* have several

    if (!requireNamespace("Matrix", quietly=TRUE)) exit_file("No Matrix package")

as well as

    if (!requireNamespace("reticulate", quietly=TRUE)) exit_file("Package reticulate missing")

    if (!packageVersion("reticulate") >= package_version("1.14"))
        exit_file("SciPy not needed on newer reticulate")

and tests for slam (another sparse matrix package besides the functionality
in Matrix).

Hopefully this brief snapshot gives you an idea.  There are (likely!!)
thousandss of examples you can browse, and I am sure you will find something.
If you have further (concrete) questions please do not hesitate to use the
resource of this list.

Cheers (or I should say "mit Braunschweiger Gruessen nach Hannover),

Dirk

--
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

        [[alternative HTML version deleted]]

______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed May  3 23:00:08 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Thu, 4 May 2023 09:00:08 +1200
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <BY5PR04MB662737FA6521D906380C9C48F96C9@BY5PR04MB6627.namprd04.prod.outlook.com>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>
 <25682.28177.114923.880130@rob.eddelbuettel.com>
 <66ce44cbbb8a43e9b26e1233d581d0c0@tiho-hannover.de>
 <BY5PR04MB662737FA6521D906380C9C48F96C9@BY5PR04MB6627.namprd04.prod.outlook.com>
Message-ID: <85A1FFE9-F8C4-44E9-9462-76E4AD4ACB75@R-project.org>



> On May 4, 2023, at 3:36 AM, Martin Morgan <mtmorgan.bioc at gmail.com> wrote:
> 
> CRAN is fine with Bioconductor Depends: and Imports: dependencies, as previously mentioned. This is because the CRAN maintainers explicitly configure their system to know about Bioconductor package repositories.
> 

That is not exactly true (at least not for all maintainers ;)). Bioconductor packages are installed on as-needed (best-effort) basis and it is a manual process. Ideally, Bioconductor packages would be in Suggests, because if they are not, the package binary will be effectively broken for most users as they cannot install it without additional steps (and no stable state can be guaranteed, either). That's why I believe someone was suggesting a pre-flight check that alerts the user to such situation and prints instructions to remedy it (e.g., to use setRepositories()) as the majority of users will have no idea what's going on.

Cheers,
Simon



> Users face a different challenge -- many users will not have identified (e.g., via `setRepositories()` a Bioconductor repository, so when they try to install your package it will fail in a way that you have no control over -- a generic message saying that the Bioconductor dependencies was not found.
> 
> You could mitigate this by advertising that your CRAN package should be installed via `BiocManager::install("<your CRAN package>")`, which defines appropriate repositories for both CRAN and Bioconductor, but there is no way to unambiguously communicate this to users.
> 
> Martin
> 
> From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Ruff, Sergej <Sergej.Ruff at tiho-hannover.de>
> Date: Wednesday, May 3, 2023 at 11:13 AM
> To: Dirk Eddelbuettel <edd at debian.org>
> Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
> Subject: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package
> Thank you, Dirk.
> 
> 
> I see your dependencies are Suggested. I know that Suggested dependencies should be conditional.
> 
> 
> Do you know if Non-Cran (Bioconductor) packages need to be conditional?  Do you have any experiece regarding Non-CRAN Dependencies
> 
> and how to handle them?
> 
> 
> I believe Duncan Murdoch's experience and opinion regarding that topic, but i take any second and third opinion to be sure.
> 
> 
> Thank you for your help.
> 
> 
> Sergej
> 
> ________________________________
> Von: Dirk Eddelbuettel <edd at debian.org>
> Gesendet: Mittwoch, 3. Mai 2023 16:22:09
> An: Ruff, Sergej
> Cc: Duncan Murdoch; Ivan Krylov; r-package-devel at r-project.org
> Betreff: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package
> 
> 
> Sergej,
> 
> Please consider:
> 
>  - there are nearly 20k CRAN packages
> 
>  - all of them are mirrored at https://github.com/cran so you can browse
> 
>  - pick any one 'heavy' package you like, Seurat is a good example; there
>    are other examples in geospatial or bioinformatics etc
> 
>  - you can browse _and search_ these to your hearts content
> 
> Here is an example of mine. In RcppArmadillo, years ago we (thanks to fine
> Google Summer of Code work by Binxiang Ni) added extended support for sparse
> matrices pass-through / conversione from R to C++ / Armadillo and back. That
> is clearly an optional feature as most uses of (Rcpp)Armadillo use dense
> matrices. So all code and test code is _conditional_.  File DESCRIPTION has
> 
>   Suggests: [...], Matrix (>= 1.3.0), [...], reticulate, slam
> 
> mostly for tests. I.e. We have very little R code: in one single file
> R/SciPy2R.R we switched to doing this via reticulate and opee the function
> with
> 
>    if (!requireNamespace("reticulate", quietly=TRUE)) {
>        stop("You must install the 'reticulate' package (and have SciPy).", call.=FALSE)
>    }
> 
> after an actual deprecation warning (as there was scipy converter once).
> 
> Similarly, the testsuites in inst/tinytests/* have several
> 
>    if (!requireNamespace("Matrix", quietly=TRUE)) exit_file("No Matrix package")
> 
> as well as
> 
>    if (!requireNamespace("reticulate", quietly=TRUE)) exit_file("Package reticulate missing")
> 
>    if (!packageVersion("reticulate") >= package_version("1.14"))
>        exit_file("SciPy not needed on newer reticulate")
> 
> and tests for slam (another sparse matrix package besides the functionality
> in Matrix).
> 
> Hopefully this brief snapshot gives you an idea.  There are (likely!!)
> thousandss of examples you can browse, and I am sure you will find something.
> If you have further (concrete) questions please do not hesitate to use the
> resource of this list.
> 
> Cheers (or I should say "mit Braunschweiger Gruessen nach Hannover),
> 
> Dirk
> 
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
>        [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From edd @end|ng |rom deb|@n@org  Wed May  3 23:19:01 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 3 May 2023 16:19:01 -0500
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <85A1FFE9-F8C4-44E9-9462-76E4AD4ACB75@R-project.org>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <20230316211448.0dee9f35@Tarkus>
 <BY5PR04MB662799A65F1CC8AE1A84C615F9BC9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <ce33881470bb4743847e495abf35245d@tiho-hannover.de>
 <1d55266d-dd43-f8b4-e27a-564dbd838918@gmail.com>
 <423fc050c0554e9eaf1f2bca3582ad9e@tiho-hannover.de>
 <606f0f1a-1b8b-f32b-261a-8877672c80dc@gmail.com>
 <03f5eac57bda4158afe6778f98b17874@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>
 <25682.28177.114923.880130@rob.eddelbuettel.com>
 <66ce44cbbb8a43e9b26e1233d581d0c0@tiho-hannover.de>
 <BY5PR04MB662737FA6521D906380C9C48F96C9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <85A1FFE9-F8C4-44E9-9462-76E4AD4ACB75@R-project.org>
Message-ID: <25682.53189.129007.244887@rob.eddelbuettel.com>


On 4 May 2023 at 09:00, Simon Urbanek wrote:
| > On May 4, 2023, at 3:36 AM, Martin Morgan <mtmorgan.bioc at gmail.com> wrote:
| > CRAN is fine with Bioconductor Depends: and Imports: dependencies, as previously mentioned. This is because the CRAN maintainers explicitly configure their system to know about Bioconductor package repositories.
| 
| That is not exactly true (at least not for all maintainers ;)). Bioconductor packages are installed on as-needed (best-effort) basis and it is a manual process. Ideally, Bioconductor packages would be in Suggests, because if they are not, the package binary will be effectively broken for most users as they cannot install it without additional steps (and no stable state can be guaranteed, either). That's why I believe someone was suggesting a pre-flight check that alerts the user to such situation and prints instructions to remedy it (e.g., to use setRepositories()) as the majority of users will have no idea what's going on.

That is not exactly true either.

Everything depends on the repository you look at, and have set. In the
command below (broken over two lines for legibility)
 
  $ docker run --rm -ti rocker/r2u:jammy \
      Rscript -e 'system.time(install.packages("Seurat", "SingleCellExperiment"))'

we see it takes 35 seconds to download and install 138 binary packages
implied by this particular pair of CRAN and BioConductor packages.

Now, this works because r2u is 'joint' repo with (essentially all of) CRAN
and (a decent chunk of) BioConductor. We also not that we do not need
Martin's suggestion of a bioc wrapper to the installation as the packages are
known (and are _effectively_ in an apt repo, but that is a r2u [1] story).

That said, _in general_ it can be dicey to depends on BioConductor as not
every user may have it set.  So this thread is slowly meandering in the right
direction.

Dirk

[1] https://eddelbuettel.github.io/r2u/

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From d@v|dhughjone@ @end|ng |rom gm@||@com  Thu May  4 10:21:17 2023
From: d@v|dhughjone@ @end|ng |rom gm@||@com (David Hugh-Jones)
Date: Thu, 4 May 2023 09:21:17 +0100
Subject: [R-pkg-devel] Acknowledging small functions from another package
Message-ID: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>

Hi,

One of my packages copy-pasted some small functions (stuff like `%||%` for
is.null) from ggplot2. (Both packages are MIT-licensed.)

What is an appropriate way to acknowledge this in the DESCRIPTION Author:
or Authors at R section? (Note that the list of ggplot2 authors is long and
changing.)

Cheers,
David

	[[alternative HTML version deleted]]


From kry|ov@r00t @end|ng |rom gm@||@com  Thu May  4 10:53:34 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Thu, 4 May 2023 11:53:34 +0300
Subject: [R-pkg-devel] 
 Acknowledging small functions from another package
In-Reply-To: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>
References: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>
Message-ID: <20230504115334.13397f25@Tarkus>

On Thu, 4 May 2023 09:21:17 +0100
David Hugh-Jones <davidhughjones at gmail.com> wrote:

> One of my packages copy-pasted some small functions (stuff like
> `%||%` for is.null) from ggplot2. (Both packages are MIT-licensed.)
> 
> What is an appropriate way to acknowledge this in the DESCRIPTION
> Author: or Authors at R section?

One way would be to mention Hadley Wickham:
https://github.com/tidyverse/ggplot2/commit/ef2f944863a0db8841bf628e9eb4a9faef5049e6#diff-8f53135445ab98749043fa52e438346bb9acae8e0185aa95f186d0aa021bb7e0
(`git blame` will also tell you that he later moved this function to a
different file).

I think that person('ggplot2 authors', role = 'cph', comment = 'The
%||% operator') is also fine, just like e.g. unitizer package mentions
the code taken from R itself.

You can also find this operator in multiple base R packages, currently
unexported (maybe some day...). They mention in the comments that the
operator is adapted from ggplot2.

-- 
Best regards,
Ivan


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu May  4 11:00:41 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 4 May 2023 05:00:41 -0400
Subject: [R-pkg-devel] 
 Acknowledging small functions from another package
In-Reply-To: <20230504115334.13397f25@Tarkus>
References: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>
 <20230504115334.13397f25@Tarkus>
Message-ID: <4fed8390-3b61-1ffb-2ee1-705dc4062ab0@gmail.com>

On 04/05/2023 4:53 a.m., Ivan Krylov wrote:
> On Thu, 4 May 2023 09:21:17 +0100
> David Hugh-Jones <davidhughjones at gmail.com> wrote:
> 
>> One of my packages copy-pasted some small functions (stuff like
>> `%||%` for is.null) from ggplot2. (Both packages are MIT-licensed.)
>>
>> What is an appropriate way to acknowledge this in the DESCRIPTION
>> Author: or Authors at R section?
> 
> One way would be to mention Hadley Wickham:
> https://github.com/tidyverse/ggplot2/commit/ef2f944863a0db8841bf628e9eb4a9faef5049e6#diff-8f53135445ab98749043fa52e438346bb9acae8e0185aa95f186d0aa021bb7e0
> (`git blame` will also tell you that he later moved this function to a
> different file).
> 
> I think that person('ggplot2 authors', role = 'cph', comment = 'The
> %||% operator') is also fine, just like e.g. unitizer package mentions
> the code taken from R itself.
> 
> You can also find this operator in multiple base R packages, currently
> unexported (maybe some day...). They mention in the comments that the
> operator is adapted from ggplot2.

I'd probably use role = "ctb" instead for "ggplot2 authors", and include 
Posit PBC as a copyright holder (as ggplot2 does).  Presumably you or 
others are also copyright holders for your package and should also have 
role = "cph" added so it doesn't give the impression that Posit owns 
everything.

Duncan Murdoch


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Thu May  4 11:22:37 2023
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Thu, 4 May 2023 11:22:37 +0200
Subject: [R-pkg-devel] How to declare Bioconductor Dependencies in the
 Description File of my R Package
In-Reply-To: <85A1FFE9-F8C4-44E9-9462-76E4AD4ACB75@R-project.org>
References: <2c40c4ab71734309917f7e914887ddd3@tiho-hannover.de>
 <F866225D-5763-4FD3-9DF4-D0CDB463869C@R-project.org>
 <cc32cb58cb3b40aeaadbd771c46b8591@tiho-hannover.de>
 <GV2PR02MB877010C19AF243F9EAE6EF2CD5829@GV2PR02MB8770.eurprd02.prod.outlook.com>
 <4ceaafc8f8d5434aa591a5c7f35753dc@tiho-hannover.de>
 <735aa12f9ac94ef5a5f557bfd53046e8@tiho-hannover.de>
 <20230320145558.4ab8939f@arachnoid>
 <634b7abcc447481f912133910fe29ba3@tiho-hannover.de>
 <20230320230838.045b31ba@Tarkus>
 <159a122c5cd04c3991840cc176f8c91c@tiho-hannover.de>
 <22714749-97c0-1d67-1f8a-335e85a0e8cf@gmail.com>
 <c47628915d7c4ac687bd72c2d2af2e14@tiho-hannover.de>
 <eb9506e6-ba83-e27b-28e1-6eafd7bd5c5d@gmail.com>
 <82b7d8d9430f401a9f30337e29f5c787@tiho-hannover.de>
 <25682.28177.114923.880130@rob.eddelbuettel.com>
 <66ce44cbbb8a43e9b26e1233d581d0c0@tiho-hannover.de>
 <BY5PR04MB662737FA6521D906380C9C48F96C9@BY5PR04MB6627.namprd04.prod.outlook.com>
 <85A1FFE9-F8C4-44E9-9462-76E4AD4ACB75@R-project.org>
Message-ID: <fe3b03f2-0a1a-8369-c442-f8b916c76aa9@statistik.tu-dortmund.de>



On 03.05.2023 23:00, Simon Urbanek wrote:
> 
> 
>> On May 4, 2023, at 3:36 AM, Martin Morgan <mtmorgan.bioc at gmail.com> wrote:
>>
>> CRAN is fine with Bioconductor Depends: and Imports: dependencies, as previously mentioned. This is because the CRAN maintainers explicitly configure their system to know about Bioconductor package repositories.
>>
> 
> That is not exactly true (at least not for all maintainers ;)). Bioconductor packages are installed on as-needed (best-effort) basis and it is a manual process.

Apparently for MacOS.
On Fedora/Debian/WIndows we auto install from BioC. (actually, on 
Windows all BioC software packages are preinstalled).

Best,
Uwe Ligges

> Ideally, Bioconductor packages would be in Suggests, because if they are not, the package binary will be effectively broken for most users as they cannot install it without additional steps (and no stable state can be guaranteed, either). That's why I believe someone was suggesting a pre-flight check that alerts the user to such situation and prints instructions to remedy it (e.g., to use setRepositories()) as the majority of users will have no idea what's going on.
> 
> Cheers,
> Simon
> 
> 
> 
>> Users face a different challenge -- many users will not have identified (e.g., via `setRepositories()` a Bioconductor repository, so when they try to install your package it will fail in a way that you have no control over -- a generic message saying that the Bioconductor dependencies was not found.
>>
>> You could mitigate this by advertising that your CRAN package should be installed via `BiocManager::install("<your CRAN package>")`, which defines appropriate repositories for both CRAN and Bioconductor, but there is no way to unambiguously communicate this to users.
>>
>> Martin
>>
>> From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Ruff, Sergej <Sergej.Ruff at tiho-hannover.de>
>> Date: Wednesday, May 3, 2023 at 11:13 AM
>> To: Dirk Eddelbuettel <edd at debian.org>
>> Cc: r-package-devel at r-project.org <r-package-devel at r-project.org>
>> Subject: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package
>> Thank you, Dirk.
>>
>>
>> I see your dependencies are Suggested. I know that Suggested dependencies should be conditional.
>>
>>
>> Do you know if Non-Cran (Bioconductor) packages need to be conditional?  Do you have any experiece regarding Non-CRAN Dependencies
>>
>> and how to handle them?
>>
>>
>> I believe Duncan Murdoch's experience and opinion regarding that topic, but i take any second and third opinion to be sure.
>>
>>
>> Thank you for your help.
>>
>>
>> Sergej
>>
>> ________________________________
>> Von: Dirk Eddelbuettel <edd at debian.org>
>> Gesendet: Mittwoch, 3. Mai 2023 16:22:09
>> An: Ruff, Sergej
>> Cc: Duncan Murdoch; Ivan Krylov; r-package-devel at r-project.org
>> Betreff: Re: [R-pkg-devel] How to declare Bioconductor Dependencies in the Description File of my R Package
>>
>>
>> Sergej,
>>
>> Please consider:
>>
>>   - there are nearly 20k CRAN packages
>>
>>   - all of them are mirrored at https://github.com/cran so you can browse
>>
>>   - pick any one 'heavy' package you like, Seurat is a good example; there
>>     are other examples in geospatial or bioinformatics etc
>>
>>   - you can browse _and search_ these to your hearts content
>>
>> Here is an example of mine. In RcppArmadillo, years ago we (thanks to fine
>> Google Summer of Code work by Binxiang Ni) added extended support for sparse
>> matrices pass-through / conversione from R to C++ / Armadillo and back. That
>> is clearly an optional feature as most uses of (Rcpp)Armadillo use dense
>> matrices. So all code and test code is _conditional_.  File DESCRIPTION has
>>
>>    Suggests: [...], Matrix (>= 1.3.0), [...], reticulate, slam
>>
>> mostly for tests. I.e. We have very little R code: in one single file
>> R/SciPy2R.R we switched to doing this via reticulate and opee the function
>> with
>>
>>     if (!requireNamespace("reticulate", quietly=TRUE)) {
>>         stop("You must install the 'reticulate' package (and have SciPy).", call.=FALSE)
>>     }
>>
>> after an actual deprecation warning (as there was scipy converter once).
>>
>> Similarly, the testsuites in inst/tinytests/* have several
>>
>>     if (!requireNamespace("Matrix", quietly=TRUE)) exit_file("No Matrix package")
>>
>> as well as
>>
>>     if (!requireNamespace("reticulate", quietly=TRUE)) exit_file("Package reticulate missing")
>>
>>     if (!packageVersion("reticulate") >= package_version("1.14"))
>>         exit_file("SciPy not needed on newer reticulate")
>>
>> and tests for slam (another sparse matrix package besides the functionality
>> in Matrix).
>>
>> Hopefully this brief snapshot gives you an idea.  There are (likely!!)
>> thousandss of examples you can browse, and I am sure you will find something.
>> If you have further (concrete) questions please do not hesitate to use the
>> resource of this list.
>>
>> Cheers (or I should say "mit Braunschweiger Gruessen nach Hannover),
>>
>> Dirk
>>
>> --
>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From d@v|dhughjone@ @end|ng |rom gm@||@com  Thu May  4 11:59:39 2023
From: d@v|dhughjone@ @end|ng |rom gm@||@com (David Hugh-Jones)
Date: Thu, 4 May 2023 10:59:39 +0100
Subject: [R-pkg-devel] 
 Acknowledging small functions from another package
In-Reply-To: <4fed8390-3b61-1ffb-2ee1-705dc4062ab0@gmail.com>
References: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>
 <20230504115334.13397f25@Tarkus>
 <4fed8390-3b61-1ffb-2ee1-705dc4062ab0@gmail.com>
Message-ID: <CAARY7kjdVErkB-RXmndkx7jyhkpvzaQLBXYCB6zZLuMidwEgQQ@mail.gmail.com>

Thank you both. This sounds sensible. Yeah, add my vote for `base::%||%`!!


David


On Thu, 4 May 2023 at 10:00, Duncan Murdoch <murdoch.duncan at gmail.com>
wrote:

> On 04/05/2023 4:53 a.m., Ivan Krylov wrote:
> > On Thu, 4 May 2023 09:21:17 +0100
> > David Hugh-Jones <davidhughjones at gmail.com> wrote:
> >
> >> One of my packages copy-pasted some small functions (stuff like
> >> `%||%` for is.null) from ggplot2. (Both packages are MIT-licensed.)
> >>
> >> What is an appropriate way to acknowledge this in the DESCRIPTION
> >> Author: or Authors at R section?
> >
> > One way would be to mention Hadley Wickham:
> >
> https://github.com/tidyverse/ggplot2/commit/ef2f944863a0db8841bf628e9eb4a9faef5049e6#diff-8f53135445ab98749043fa52e438346bb9acae8e0185aa95f186d0aa021bb7e0
> > (`git blame` will also tell you that he later moved this function to a
> > different file).
> >
> > I think that person('ggplot2 authors', role = 'cph', comment = 'The
> > %||% operator') is also fine, just like e.g. unitizer package mentions
> > the code taken from R itself.
> >
> > You can also find this operator in multiple base R packages, currently
> > unexported (maybe some day...). They mention in the comments that the
> > operator is adapted from ggplot2.
>
> I'd probably use role = "ctb" instead for "ggplot2 authors", and include
> Posit PBC as a copyright holder (as ggplot2 does).  Presumably you or
> others are also copyright holders for your package and should also have
> role = "cph" added so it doesn't give the impression that Posit owns
> everything.
>
> Duncan Murdoch
>
>

	[[alternative HTML version deleted]]


From h@w|ckh@m @end|ng |rom gm@||@com  Thu May  4 15:19:52 2023
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Thu, 4 May 2023 08:19:52 -0500
Subject: [R-pkg-devel] 
 Acknowledging small functions from another package
In-Reply-To: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>
References: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>
Message-ID: <CABdHhvGx5E6JJ-U+dU1VFVHWRkxPmHHJhDNuoaGDijESSrX5sQ@mail.gmail.com>

IMO those functions are so small that you don't need to call them out
in your DESCRIPTION. Just note in a nearby comment where they came
from.

Hadley

On Thu, May 4, 2023 at 3:21?AM David Hugh-Jones
<davidhughjones at gmail.com> wrote:
>
> Hi,
>
> One of my packages copy-pasted some small functions (stuff like `%||%` for
> is.null) from ggplot2. (Both packages are MIT-licensed.)
>
> What is an appropriate way to acknowledge this in the DESCRIPTION Author:
> or Authors at R section? (Note that the list of ggplot2 authors is long and
> changing.)
>
> Cheers,
> David
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://hadley.nz


From bbo|ker @end|ng |rom gm@||@com  Thu May  4 15:27:04 2023
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 4 May 2023 09:27:04 -0400
Subject: [R-pkg-devel] 
 Acknowledging small functions from another package
In-Reply-To: <CAARY7kjdVErkB-RXmndkx7jyhkpvzaQLBXYCB6zZLuMidwEgQQ@mail.gmail.com>
References: <CAARY7ki1qVer1H+auykmhhY8qeOTnz_oV5jYzUp8vZx+tEL0qg@mail.gmail.com>
 <20230504115334.13397f25@Tarkus>
 <4fed8390-3b61-1ffb-2ee1-705dc4062ab0@gmail.com>
 <CAARY7kjdVErkB-RXmndkx7jyhkpvzaQLBXYCB6zZLuMidwEgQQ@mail.gmail.com>
Message-ID: <0ceb1660-73df-417f-a508-33e90ca05b0f@gmail.com>

   In fact Martin Maechler added this in 2021:

https://github.com/wch/r-source/blob/trunk/src/library/utils/R/str.R#L19-L21

## A pearl from ggplot2 et al.  NB: often needs '(.)' :   <lhs> %||% ( 
<rhs> )
## *not exported* [should rather be in 'base' than exported here]
`%||%` <- function(L,R) if(is.null(L)) R else L


On 2023-05-04 5:59 a.m., David Hugh-Jones wrote:
> Thank you both. This sounds sensible. Yeah, add my vote for `base::%||%`!!
> 
> 
> David
> 
> 
> On Thu, 4 May 2023 at 10:00, Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
> 
>> On 04/05/2023 4:53 a.m., Ivan Krylov wrote:
>>> On Thu, 4 May 2023 09:21:17 +0100
>>> David Hugh-Jones <davidhughjones at gmail.com> wrote:
>>>
>>>> One of my packages copy-pasted some small functions (stuff like
>>>> `%||%` for is.null) from ggplot2. (Both packages are MIT-licensed.)
>>>>
>>>> What is an appropriate way to acknowledge this in the DESCRIPTION
>>>> Author: or Authors at R section?
>>>
>>> One way would be to mention Hadley Wickham:
>>>
>> https://github.com/tidyverse/ggplot2/commit/ef2f944863a0db8841bf628e9eb4a9faef5049e6#diff-8f53135445ab98749043fa52e438346bb9acae8e0185aa95f186d0aa021bb7e0
>>> (`git blame` will also tell you that he later moved this function to a
>>> different file).
>>>
>>> I think that person('ggplot2 authors', role = 'cph', comment = 'The
>>> %||% operator') is also fine, just like e.g. unitizer package mentions
>>> the code taken from R itself.
>>>
>>> You can also find this operator in multiple base R packages, currently
>>> unexported (maybe some day...). They mention in the comments that the
>>> operator is adapted from ggplot2.
>>
>> I'd probably use role = "ctb" instead for "ggplot2 authors", and include
>> Posit PBC as a copyright holder (as ggplot2 does).  Presumably you or
>> others are also copyright holders for your package and should also have
>> role = "cph" added so it doesn't give the impression that Posit owns
>> everything.
>>
>> Duncan Murdoch
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
Dr. Benjamin Bolker
Professor, Mathematics & Statistics and Biology, McMaster University
Director, School of Computational Science and Engineering
(Acting) Graduate chair, Mathematics & Statistics
 > E-mail is sent at my convenience; I don't expect replies outside of 
working hours.


From u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de  Fri May  5 10:32:27 2023
From: u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de (Ulrike Groemping)
Date: Fri, 5 May 2023 10:32:27 +0200
Subject: [R-pkg-devel] Unfortunate function name generic.something
Message-ID: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>

Dear package developeRs,

I am working on fixing some notes regarding package DoE.base.
One note refers to the function levels.no and complains that the 
function is not documented as a method for the generic function levels.
Actually, it is not a method for the generic levels, but a standalone 
internal function that I like to have documented.

Is there a way to document the function without renaming it and without 
triggering a note about method documentation?

Best, Ulrike

-- 
##############################################
## Prof. Ulrike Groemping
## FB II
## Berliner Hochschule f?r Technik (BHT)
##############################################
## prof.bht-berlin.de/groemping
## Phone: +49(0)30 4504 5127
## Fax:   +49(0)30 4504 66 5127
## Home office: +49(0)30 394 04 863
##############################################


From |kw@|mmo @end|ng |rom gm@||@com  Fri May  5 12:56:02 2023
From: |kw@|mmo @end|ng |rom gm@||@com (Iris Simmons)
Date: Fri, 5 May 2023 06:56:02 -0400
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
Message-ID: <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>

You can add

\keyword{internal}

to the Rd file. Your documentation won't show up the in the pdf manual, it
won't show up in the package index, but you'll still be able to access the
doc page with ?levels.no or help("levels.no").

This is usually used in a package's deprecated and defunct doc pages, but
you can use it anywhere.

On Fri, May 5, 2023, 06:49 Ulrike Groemping <ulrike.groemping at bht-berlin.de>
wrote:

> Dear package developeRs,
>
> I am working on fixing some notes regarding package DoE.base.
> One note refers to the function levels.no and complains that the
> function is not documented as a method for the generic function levels.
> Actually, it is not a method for the generic levels, but a standalone
> internal function that I like to have documented.
>
> Is there a way to document the function without renaming it and without
> triggering a note about method documentation?
>
> Best, Ulrike
>
> --
> ##############################################
> ## Prof. Ulrike Groemping
> ## FB II
> ## Berliner Hochschule f?r Technik (BHT)
> ##############################################
> ## prof.bht-berlin.de/groemping
> ## Phone: +49(0)30 4504 5127
> ## Fax:   +49(0)30 4504 66 5127
> ## Home office: +49(0)30 394 04 863
> ##############################################
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de  Mon May  8 11:50:19 2023
From: u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de (Ulrike Groemping)
Date: Mon, 8 May 2023 11:50:19 +0200
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
Message-ID: <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>

Thank your for the solution attempt. However, using the keyword internal 
does not solve the problem, the note is still there. Any other proposals 
for properly documenting a function that looks like an S3 method, but isn't?

Best, Ulrike

Am 05.05.2023 um 12:56 schrieb Iris Simmons:
> You can add
>
> \keyword{internal}
>
> to the Rd file. Your documentation won't show up the in the pdf 
> manual, it won't show up in the package index, but you'll still be 
> able to access the doc page with ?levels.no <http://levels.no> or 
> help("levels.no <http://levels.no>").
>
> This is usually used in a package's deprecated and defunct doc pages, 
> but you can use it anywhere.
>
> On Fri, May 5, 2023, 06:49 Ulrike Groemping 
> <ulrike.groemping at bht-berlin.de> wrote:
>
>     Dear package developeRs,
>
>     I am working on fixing some notes regarding package DoE.base.
>     One note refers to the function levels.no <http://levels.no> and
>     complains that the
>     function is not documented as a method for the generic function
>     levels.
>     Actually, it is not a method for the generic levels, but a standalone
>     internal function that I like to have documented.
>
>     Is there a way to document the function without renaming it and
>     without
>     triggering a note about method documentation?
>
>     Best, Ulrike
>
>     -- 
>     ##############################################
>     ## Prof. Ulrike Groemping
>     ## FB II
>     ## Berliner Hochschule f?r Technik (BHT)
>     ##############################################
>     ## prof.bht-berlin.de/groemping <http://prof.bht-berlin.de/groemping>
>     ## Phone: +49(0)30 4504 5127
>     ## Fax:? ?+49(0)30 4504 66 5127
>     ## Home office: +49(0)30 394 04 863
>     ##############################################
>
>     ______________________________________________
>     R-package-devel at r-project.org mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon May  8 13:58:28 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 8 May 2023 07:58:28 -0400
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
Message-ID: <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>

There really isn't such a thing as "a function that looks like an S3 
method, but isn't".  If it looks like an S3 method, then in the proper 
circumstances, it will be called as one.

In your case the function name is levels.no, and it isn't exported.  So 
if you happen to have an object with a class inheriting from "no", and 
you call levels() on it, levels.no might be called.

This will only affect users of your package indirectly.  If they have 
objects inheriting from "no" and call levels() on them, levels.no will 
not be called.  But if they pass such an object to one of your package 
functions, and that function calls levels() on it, they could end up 
calling levels.no().  It all depends on what other classes that object 
inherits from.

You can test this yourself.  Set debugging on any one of your functions, 
then call it in the normal way.  Then while still in the debugger set 
debugging on levels.no, and create an object using

   x <- structure(1, class = "no")

and call levels(x).  You should break to the code of levels.no.

That is why the WRE manual says "First, a caveat: a function named 
gen.cl will be invoked by the generic gen for class cl, so do not name 
functions in this style unless they are intended to be methods."

So probably the best solution (even if inconvenient) is to rename 
levels.no to something that doesn't look like an S3 method.

Duncan Murdoch

On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
> Thank your for the solution attempt. However, using the keyword internal
> does not solve the problem, the note is still there. Any other proposals
> for properly documenting a function that looks like an S3 method, but isn't?
> 
> Best, Ulrike
> 
> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>> You can add
>>
>> \keyword{internal}
>>
>> to the Rd file. Your documentation won't show up the in the pdf
>> manual, it won't show up in the package index, but you'll still be
>> able to access the doc page with ?levels.no <http://levels.no> or
>> help("levels.no <http://levels.no>").
>>
>> This is usually used in a package's deprecated and defunct doc pages,
>> but you can use it anywhere.
>>
>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>> <ulrike.groemping at bht-berlin.de> wrote:
>>
>>      Dear package developeRs,
>>
>>      I am working on fixing some notes regarding package DoE.base.
>>      One note refers to the function levels.no <http://levels.no> and
>>      complains that the
>>      function is not documented as a method for the generic function
>>      levels.
>>      Actually, it is not a method for the generic levels, but a standalone
>>      internal function that I like to have documented.
>>
>>      Is there a way to document the function without renaming it and
>>      without
>>      triggering a note about method documentation?
>>
>>      Best, Ulrike
>>
>>      --
>>      ##############################################
>>      ## Prof. Ulrike Groemping
>>      ## FB II
>>      ## Berliner Hochschule f?r Technik (BHT)
>>      ##############################################
>>      ## prof.bht-berlin.de/groemping <http://prof.bht-berlin.de/groemping>
>>      ## Phone: +49(0)30 4504 5127
>>      ## Fax:? ?+49(0)30 4504 66 5127
>>      ## Home office: +49(0)30 394 04 863
>>      ##############################################
>>
>>      ______________________________________________
>>      R-package-devel at r-project.org mailing list
>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de  Mon May  8 14:28:09 2023
From: u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de (Ulrike Groemping)
Date: Mon, 8 May 2023 14:28:09 +0200
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
Message-ID: <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>

Thanks, Duncan. I appreciate the view that levels.no acts as an S3 
method for the generic levels, if an object of class "no" is handed to 
it. However, as the function is not intended as an S3 method, it does 
not make sense to document it as such. As the function is internal only, 
which makes the scenario that it causes trouble extremely unlikely, I 
will simply comment out the usage line for the function in order to get 
rid of the note but keep the usage visible. I hope that this is OK.

Best, Ulrike

Am 08.05.2023 um 13:58 schrieb Duncan Murdoch:
> There really isn't such a thing as "a function that looks like an S3 
> method, but isn't".? If it looks like an S3 method, then in the proper 
> circumstances, it will be called as one.
>
> In your case the function name is levels.no, and it isn't exported.? 
> So if you happen to have an object with a class inheriting from "no", 
> and you call levels() on it, levels.no might be called.
>
> This will only affect users of your package indirectly.? If they have 
> objects inheriting from "no" and call levels() on them, levels.no will 
> not be called.? But if they pass such an object to one of your package 
> functions, and that function calls levels() on it, they could end up 
> calling levels.no().? It all depends on what other classes that object 
> inherits from.
>
> You can test this yourself.? Set debugging on any one of your 
> functions, then call it in the normal way.? Then while still in the 
> debugger set debugging on levels.no, and create an object using
>
> ? x <- structure(1, class = "no")
>
> and call levels(x).? You should break to the code of levels.no.
>
> That is why the WRE manual says "First, a caveat: a function named 
> gen.cl will be invoked by the generic gen for class cl, so do not name 
> functions in this style unless they are intended to be methods."
>
> So probably the best solution (even if inconvenient) is to rename 
> levels.no to something that doesn't look like an S3 method.
>
> Duncan Murdoch
>
> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>> Thank your for the solution attempt. However, using the keyword internal
>> does not solve the problem, the note is still there. Any other proposals
>> for properly documenting a function that looks like an S3 method, but 
>> isn't?
>>
>> Best, Ulrike
>>
>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>> You can add
>>>
>>> \keyword{internal}
>>>
>>> to the Rd file. Your documentation won't show up the in the pdf
>>> manual, it won't show up in the package index, but you'll still be
>>> able to access the doc page with ?levels.no <http://levels.no> or
>>> help("levels.no <http://levels.no>").
>>>
>>> This is usually used in a package's deprecated and defunct doc pages,
>>> but you can use it anywhere.
>>>
>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>
>>> ???? Dear package developeRs,
>>>
>>> ???? I am working on fixing some notes regarding package DoE.base.
>>> ???? One note refers to the function levels.no <http://levels.no> and
>>> ???? complains that the
>>> ???? function is not documented as a method for the generic function
>>> ???? levels.
>>> ???? Actually, it is not a method for the generic levels, but a 
>>> standalone
>>> ???? internal function that I like to have documented.
>>>
>>> ???? Is there a way to document the function without renaming it and
>>> ???? without
>>> ???? triggering a note about method documentation?
>>>
>>> ???? Best, Ulrike
>>>
>>> ???? --
>>> ???? ##############################################
>>> ???? ## Prof. Ulrike Groemping
>>> ???? ## FB II
>>> ???? ## Berliner Hochschule f?r Technik (BHT)
>>> ???? ##############################################
>>> ???? ## prof.bht-berlin.de/groemping 
>>> <http://prof.bht-berlin.de/groemping>
>>> ???? ## Phone: +49(0)30 4504 5127
>>> ???? ## Fax:? ?+49(0)30 4504 66 5127
>>> ???? ## Home office: +49(0)30 394 04 863
>>> ???? ##############################################
>>>
>>> ???? ______________________________________________
>>> ???? R-package-devel at r-project.org mailing list
>>> ???? https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From h@w|ckh@m @end|ng |rom gm@||@com  Mon May  8 14:45:51 2023
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Mon, 8 May 2023 07:45:51 -0500
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>
Message-ID: <CABdHhvHvhtOuVrui92C-MjHpFEwPughjy_5K7YbKASVN3V8gKw@mail.gmail.com>

If it's internal only, you could change the name to levels_no()?
Hadley

On Mon, May 8, 2023 at 7:28?AM Ulrike Groemping
<ulrike.groemping at bht-berlin.de> wrote:
>
> Thanks, Duncan. I appreciate the view that levels.no acts as an S3
> method for the generic levels, if an object of class "no" is handed to
> it. However, as the function is not intended as an S3 method, it does
> not make sense to document it as such. As the function is internal only,
> which makes the scenario that it causes trouble extremely unlikely, I
> will simply comment out the usage line for the function in order to get
> rid of the note but keep the usage visible. I hope that this is OK.
>
> Best, Ulrike
>
> Am 08.05.2023 um 13:58 schrieb Duncan Murdoch:
> > There really isn't such a thing as "a function that looks like an S3
> > method, but isn't".  If it looks like an S3 method, then in the proper
> > circumstances, it will be called as one.
> >
> > In your case the function name is levels.no, and it isn't exported.
> > So if you happen to have an object with a class inheriting from "no",
> > and you call levels() on it, levels.no might be called.
> >
> > This will only affect users of your package indirectly.  If they have
> > objects inheriting from "no" and call levels() on them, levels.no will
> > not be called.  But if they pass such an object to one of your package
> > functions, and that function calls levels() on it, they could end up
> > calling levels.no().  It all depends on what other classes that object
> > inherits from.
> >
> > You can test this yourself.  Set debugging on any one of your
> > functions, then call it in the normal way.  Then while still in the
> > debugger set debugging on levels.no, and create an object using
> >
> >   x <- structure(1, class = "no")
> >
> > and call levels(x).  You should break to the code of levels.no.
> >
> > That is why the WRE manual says "First, a caveat: a function named
> > gen.cl will be invoked by the generic gen for class cl, so do not name
> > functions in this style unless they are intended to be methods."
> >
> > So probably the best solution (even if inconvenient) is to rename
> > levels.no to something that doesn't look like an S3 method.
> >
> > Duncan Murdoch
> >
> > On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
> >> Thank your for the solution attempt. However, using the keyword internal
> >> does not solve the problem, the note is still there. Any other proposals
> >> for properly documenting a function that looks like an S3 method, but
> >> isn't?
> >>
> >> Best, Ulrike
> >>
> >> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
> >>> You can add
> >>>
> >>> \keyword{internal}
> >>>
> >>> to the Rd file. Your documentation won't show up the in the pdf
> >>> manual, it won't show up in the package index, but you'll still be
> >>> able to access the doc page with ?levels.no <http://levels.no> or
> >>> help("levels.no <http://levels.no>").
> >>>
> >>> This is usually used in a package's deprecated and defunct doc pages,
> >>> but you can use it anywhere.
> >>>
> >>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
> >>> <ulrike.groemping at bht-berlin.de> wrote:
> >>>
> >>>      Dear package developeRs,
> >>>
> >>>      I am working on fixing some notes regarding package DoE.base.
> >>>      One note refers to the function levels.no <http://levels.no> and
> >>>      complains that the
> >>>      function is not documented as a method for the generic function
> >>>      levels.
> >>>      Actually, it is not a method for the generic levels, but a
> >>> standalone
> >>>      internal function that I like to have documented.
> >>>
> >>>      Is there a way to document the function without renaming it and
> >>>      without
> >>>      triggering a note about method documentation?
> >>>
> >>>      Best, Ulrike
> >>>
> >>>      --
> >>>      ##############################################
> >>>      ## Prof. Ulrike Groemping
> >>>      ## FB II
> >>>      ## Berliner Hochschule f?r Technik (BHT)
> >>>      ##############################################
> >>>      ## prof.bht-berlin.de/groemping
> >>> <http://prof.bht-berlin.de/groemping>
> >>>      ## Phone: +49(0)30 4504 5127
> >>>      ## Fax:   +49(0)30 4504 66 5127
> >>>      ## Home office: +49(0)30 394 04 863
> >>>      ##############################################
> >>>
> >>>      ______________________________________________
> >>>      R-package-devel at r-project.org mailing list
> >>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>
> >>
> >> ______________________________________________
> >> R-package-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
http://hadley.nz


From u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de  Mon May  8 14:48:36 2023
From: u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de (Ulrike Groemping)
Date: Mon, 8 May 2023 14:48:36 +0200
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <CABdHhvHvhtOuVrui92C-MjHpFEwPughjy_5K7YbKASVN3V8gKw@mail.gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>
 <CABdHhvHvhtOuVrui92C-MjHpFEwPughjy_5K7YbKASVN3V8gKw@mail.gmail.com>
Message-ID: <a59bd480-0be2-cd36-81b0-a30ecf4eeb00@bht-berlin.de>

I certainly could, but I'm using this little convenience function it in 
so many places (and packages) that this would be a massive amount of 
work - doesn't feel justified, given the tiny chance of causing a problem.
Ulrike

Am 08.05.2023 um 14:45 schrieb Hadley Wickham:
> If it's internal only, you could change the name to levels_no()?
> Hadley
>
> On Mon, May 8, 2023 at 7:28?AM Ulrike Groemping
> <ulrike.groemping at bht-berlin.de> wrote:
>> Thanks, Duncan. I appreciate the view that levels.no acts as an S3
>> method for the generic levels, if an object of class "no" is handed to
>> it. However, as the function is not intended as an S3 method, it does
>> not make sense to document it as such. As the function is internal only,
>> which makes the scenario that it causes trouble extremely unlikely, I
>> will simply comment out the usage line for the function in order to get
>> rid of the note but keep the usage visible. I hope that this is OK.
>>
>> Best, Ulrike
>>
>> Am 08.05.2023 um 13:58 schrieb Duncan Murdoch:
>>> There really isn't such a thing as "a function that looks like an S3
>>> method, but isn't".  If it looks like an S3 method, then in the proper
>>> circumstances, it will be called as one.
>>>
>>> In your case the function name is levels.no, and it isn't exported.
>>> So if you happen to have an object with a class inheriting from "no",
>>> and you call levels() on it, levels.no might be called.
>>>
>>> This will only affect users of your package indirectly.  If they have
>>> objects inheriting from "no" and call levels() on them, levels.no will
>>> not be called.  But if they pass such an object to one of your package
>>> functions, and that function calls levels() on it, they could end up
>>> calling levels.no().  It all depends on what other classes that object
>>> inherits from.
>>>
>>> You can test this yourself.  Set debugging on any one of your
>>> functions, then call it in the normal way.  Then while still in the
>>> debugger set debugging on levels.no, and create an object using
>>>
>>>    x <- structure(1, class = "no")
>>>
>>> and call levels(x).  You should break to the code of levels.no.
>>>
>>> That is why the WRE manual says "First, a caveat: a function named
>>> gen.cl will be invoked by the generic gen for class cl, so do not name
>>> functions in this style unless they are intended to be methods."
>>>
>>> So probably the best solution (even if inconvenient) is to rename
>>> levels.no to something that doesn't look like an S3 method.
>>>
>>> Duncan Murdoch
>>>
>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>> Thank your for the solution attempt. However, using the keyword internal
>>>> does not solve the problem, the note is still there. Any other proposals
>>>> for properly documenting a function that looks like an S3 method, but
>>>> isn't?
>>>>
>>>> Best, Ulrike
>>>>
>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>> You can add
>>>>>
>>>>> \keyword{internal}
>>>>>
>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>> manual, it won't show up in the package index, but you'll still be
>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>> help("levels.no <http://levels.no>").
>>>>>
>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>> but you can use it anywhere.
>>>>>
>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>>
>>>>>       Dear package developeRs,
>>>>>
>>>>>       I am working on fixing some notes regarding package DoE.base.
>>>>>       One note refers to the function levels.no <http://levels.no> and
>>>>>       complains that the
>>>>>       function is not documented as a method for the generic function
>>>>>       levels.
>>>>>       Actually, it is not a method for the generic levels, but a
>>>>> standalone
>>>>>       internal function that I like to have documented.
>>>>>
>>>>>       Is there a way to document the function without renaming it and
>>>>>       without
>>>>>       triggering a note about method documentation?
>>>>>
>>>>>       Best, Ulrike
>>>>>
>>>>>       --
>>>>>       ##############################################
>>>>>       ## Prof. Ulrike Groemping
>>>>>       ## FB II
>>>>>       ## Berliner Hochschule f?r Technik (BHT)
>>>>>       ##############################################
>>>>>       ## prof.bht-berlin.de/groemping
>>>>> <http://prof.bht-berlin.de/groemping>
>>>>>       ## Phone: +49(0)30 4504 5127
>>>>>       ## Fax:   +49(0)30 4504 66 5127
>>>>>       ## Home office: +49(0)30 394 04 863
>>>>>       ##############################################
>>>>>
>>>>>       ______________________________________________
>>>>>       R-package-devel at r-project.org mailing list
>>>>>       https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon May  8 15:48:02 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 8 May 2023 09:48:02 -0400
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>
Message-ID: <fac43d8b-aab8-636f-37ca-03b2ba36023e@gmail.com>

On 08/05/2023 8:28 a.m., Ulrike Groemping wrote:
> Thanks, Duncan. I appreciate the view that levels.no acts as an S3
> method for the generic levels, if an object of class "no" is handed to
> it. However, as the function is not intended as an S3 method, it does
> not make sense to document it as such. As the function is internal only,
> which makes the scenario that it causes trouble extremely unlikely, I
> will simply comment out the usage line for the function in order to get
> rid of the note but keep the usage visible. I hope that this is OK.

I think that should solve the warning issue, and it's better than 
documenting it as an S3 method when it's not intended to be one.

I don't know how likely it is to cause trouble.  You do call levels(), 
but I don't know if you ever call it on objects that weren't created 
internally.  If so, then there's the possibility that one of them will 
have that "no" class for a completely unrelated reason, and then there 
will be trouble.

Duncan Murdoch

> 
> Best, Ulrike
> 
> Am 08.05.2023 um 13:58 schrieb Duncan Murdoch:
>> There really isn't such a thing as "a function that looks like an S3
>> method, but isn't".? If it looks like an S3 method, then in the proper
>> circumstances, it will be called as one.
>>
>> In your case the function name is levels.no, and it isn't exported.
>> So if you happen to have an object with a class inheriting from "no",
>> and you call levels() on it, levels.no might be called.
>>
>> This will only affect users of your package indirectly.? If they have
>> objects inheriting from "no" and call levels() on them, levels.no will
>> not be called.? But if they pass such an object to one of your package
>> functions, and that function calls levels() on it, they could end up
>> calling levels.no().? It all depends on what other classes that object
>> inherits from.
>>
>> You can test this yourself.? Set debugging on any one of your
>> functions, then call it in the normal way.? Then while still in the
>> debugger set debugging on levels.no, and create an object using
>>
>>  ? x <- structure(1, class = "no")
>>
>> and call levels(x).? You should break to the code of levels.no.
>>
>> That is why the WRE manual says "First, a caveat: a function named
>> gen.cl will be invoked by the generic gen for class cl, so do not name
>> functions in this style unless they are intended to be methods."
>>
>> So probably the best solution (even if inconvenient) is to rename
>> levels.no to something that doesn't look like an S3 method.
>>
>> Duncan Murdoch
>>
>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>> Thank your for the solution attempt. However, using the keyword internal
>>> does not solve the problem, the note is still there. Any other proposals
>>> for properly documenting a function that looks like an S3 method, but
>>> isn't?
>>>
>>> Best, Ulrike
>>>
>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>> You can add
>>>>
>>>> \keyword{internal}
>>>>
>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>> manual, it won't show up in the package index, but you'll still be
>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>> help("levels.no <http://levels.no>").
>>>>
>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>> but you can use it anywhere.
>>>>
>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>
>>>>  ???? Dear package developeRs,
>>>>
>>>>  ???? I am working on fixing some notes regarding package DoE.base.
>>>>  ???? One note refers to the function levels.no <http://levels.no> and
>>>>  ???? complains that the
>>>>  ???? function is not documented as a method for the generic function
>>>>  ???? levels.
>>>>  ???? Actually, it is not a method for the generic levels, but a
>>>> standalone
>>>>  ???? internal function that I like to have documented.
>>>>
>>>>  ???? Is there a way to document the function without renaming it and
>>>>  ???? without
>>>>  ???? triggering a note about method documentation?
>>>>
>>>>  ???? Best, Ulrike
>>>>
>>>>  ???? --
>>>>  ???? ##############################################
>>>>  ???? ## Prof. Ulrike Groemping
>>>>  ???? ## FB II
>>>>  ???? ## Berliner Hochschule f?r Technik (BHT)
>>>>  ???? ##############################################
>>>>  ???? ## prof.bht-berlin.de/groemping
>>>> <http://prof.bht-berlin.de/groemping>
>>>>  ???? ## Phone: +49(0)30 4504 5127
>>>>  ???? ## Fax:? ?+49(0)30 4504 66 5127
>>>>  ???? ## Home office: +49(0)30 394 04 863
>>>>  ???? ##############################################
>>>>
>>>>  ???? ______________________________________________
>>>>  ???? R-package-devel at r-project.org mailing list
>>>>  ???? https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>


From u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de  Mon May  8 18:10:22 2023
From: u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de (Ulrike Groemping)
Date: Mon, 8 May 2023 18:10:22 +0200
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <fac43d8b-aab8-636f-37ca-03b2ba36023e@gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>
 <fac43d8b-aab8-636f-37ca-03b2ba36023e@gmail.com>
Message-ID: <74183109-3f1f-35ae-c7cb-684d2eca5f52@bht-berlin.de>

Am 08.05.2023 um 15:48 schrieb Duncan Murdoch:
> On 08/05/2023 8:28 a.m., Ulrike Groemping wrote:
>> Thanks, Duncan. I appreciate the view that levels.no acts as an S3
>> method for the generic levels, if an object of class "no" is handed to
>> it. However, as the function is not intended as an S3 method, it does
>> not make sense to document it as such. As the function is internal only,
>> which makes the scenario that it causes trouble extremely unlikely, I
>> will simply comment out the usage line for the function in order to get
>> rid of the note but keep the usage visible. I hope that this is OK.
>
> I think that should solve the warning issue, and it's better than 
> documenting it as an S3 method when it's not intended to be one.
>
> I don't know how likely it is to cause trouble.? You do call levels(), 
> but I don't know if you ever call it on objects that weren't created 
> internally.? If so, then there's the possibility that one of them will 
> have that "no" class for a completely unrelated reason, and then there 
> will be trouble.
>
> Duncan Murdoch
It solved the documentation warning issue, but another issue followed 
suit (found in the submission pretests only):

"Mismatches for apparent methods not registered:
levels:
   function(x)
levels.no:
   function(xx)"

I now changed the argument of levels.no to x, registered the method (as 
I was under the impression that not registering it would trigger the 
next complaint; of course, registering it might make it more likely to 
be mis-used). For preventing unnoticed problems, I made the function 
throw a meaningful error message ("DoE.base:::levels.no is not a method 
for the generic base::levels") in the (hopefully unlikely) case that it 
is handed an object of class "no" by someone who wants to use a levels 
method on that object. This version now passed the pretest checks.

Ulrike Groemping

>
>>
>> Best, Ulrike
>>
>> Am 08.05.2023 um 13:58 schrieb Duncan Murdoch:
>>> There really isn't such a thing as "a function that looks like an S3
>>> method, but isn't".? If it looks like an S3 method, then in the proper
>>> circumstances, it will be called as one.
>>>
>>> In your case the function name is levels.no, and it isn't exported.
>>> So if you happen to have an object with a class inheriting from "no",
>>> and you call levels() on it, levels.no might be called.
>>>
>>> This will only affect users of your package indirectly.? If they have
>>> objects inheriting from "no" and call levels() on them, levels.no will
>>> not be called.? But if they pass such an object to one of your package
>>> functions, and that function calls levels() on it, they could end up
>>> calling levels.no().? It all depends on what other classes that object
>>> inherits from.
>>>
>>> You can test this yourself.? Set debugging on any one of your
>>> functions, then call it in the normal way.? Then while still in the
>>> debugger set debugging on levels.no, and create an object using
>>>
>>> ?? x <- structure(1, class = "no")
>>>
>>> and call levels(x).? You should break to the code of levels.no.
>>>
>>> That is why the WRE manual says "First, a caveat: a function named
>>> gen.cl will be invoked by the generic gen for class cl, so do not name
>>> functions in this style unless they are intended to be methods."
>>>
>>> So probably the best solution (even if inconvenient) is to rename
>>> levels.no to something that doesn't look like an S3 method.
>>>
>>> Duncan Murdoch
>>>
>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>> Thank your for the solution attempt. However, using the keyword 
>>>> internal
>>>> does not solve the problem, the note is still there. Any other 
>>>> proposals
>>>> for properly documenting a function that looks like an S3 method, but
>>>> isn't?
>>>>
>>>> Best, Ulrike
>>>>
>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>> You can add
>>>>>
>>>>> \keyword{internal}
>>>>>
>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>> manual, it won't show up in the package index, but you'll still be
>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>> help("levels.no <http://levels.no>").
>>>>>
>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>> but you can use it anywhere.
>>>>>
>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>>
>>>>> ????? Dear package developeRs,
>>>>>
>>>>> ????? I am working on fixing some notes regarding package DoE.base.
>>>>> ????? One note refers to the function levels.no <http://levels.no> 
>>>>> and
>>>>> ????? complains that the
>>>>> ????? function is not documented as a method for the generic function
>>>>> ????? levels.
>>>>> ????? Actually, it is not a method for the generic levels, but a
>>>>> standalone
>>>>> ????? internal function that I like to have documented.
>>>>>
>>>>> ????? Is there a way to document the function without renaming it and
>>>>> ????? without
>>>>> ????? triggering a note about method documentation?
>>>>>
>>>>> ????? Best, Ulrike
>>>>>
>>>>> ????? --
>>>>> ????? ##############################################
>>>>> ????? ## Prof. Ulrike Groemping
>>>>> ????? ## FB II
>>>>> ????? ## Berliner Hochschule f?r Technik (BHT)
>>>>> ????? ##############################################
>>>>> ????? ## prof.bht-berlin.de/groemping
>>>>> <http://prof.bht-berlin.de/groemping>
>>>>> ????? ## Phone: +49(0)30 4504 5127
>>>>> ????? ## Fax:? ?+49(0)30 4504 66 5127
>>>>> ????? ## Home office: +49(0)30 394 04 863
>>>>> ????? ##############################################
>>>>>
>>>>> ????? ______________________________________________
>>>>> ????? R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon May  8 18:29:23 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 8 May 2023 12:29:23 -0400
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <74183109-3f1f-35ae-c7cb-684d2eca5f52@bht-berlin.de>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <16b3d9a8-6f54-b753-aed2-ec91b3d354d7@bht-berlin.de>
 <fac43d8b-aab8-636f-37ca-03b2ba36023e@gmail.com>
 <74183109-3f1f-35ae-c7cb-684d2eca5f52@bht-berlin.de>
Message-ID: <47ab689d-a511-e6bc-80b9-78b6ff884b71@gmail.com>

On 08/05/2023 12:10 p.m., Ulrike Groemping wrote:
> Am 08.05.2023 um 15:48 schrieb Duncan Murdoch:
>> On 08/05/2023 8:28 a.m., Ulrike Groemping wrote:
>>> Thanks, Duncan. I appreciate the view that levels.no acts as an S3
>>> method for the generic levels, if an object of class "no" is handed to
>>> it. However, as the function is not intended as an S3 method, it does
>>> not make sense to document it as such. As the function is internal only,
>>> which makes the scenario that it causes trouble extremely unlikely, I
>>> will simply comment out the usage line for the function in order to get
>>> rid of the note but keep the usage visible. I hope that this is OK.
>>
>> I think that should solve the warning issue, and it's better than
>> documenting it as an S3 method when it's not intended to be one.
>>
>> I don't know how likely it is to cause trouble.? You do call levels(),
>> but I don't know if you ever call it on objects that weren't created
>> internally.? If so, then there's the possibility that one of them will
>> have that "no" class for a completely unrelated reason, and then there
>> will be trouble.
>>
>> Duncan Murdoch
> It solved the documentation warning issue, but another issue followed
> suit (found in the submission pretests only):
> 
> "Mismatches for apparent methods not registered:
> levels:
>     function(x)
> levels.no:
>     function(xx)"
> 
> I now changed the argument of levels.no to x, registered the method (as
> I was under the impression that not registering it would trigger the
> next complaint; of course, registering it might make it more likely to
> be mis-used). For preventing unnoticed problems, I made the function
> throw a meaningful error message ("DoE.base:::levels.no is not a method
> for the generic base::levels") in the (hopefully unlikely) case that it
> is handed an object of class "no" by someone who wants to use a levels
> method on that object. This version now passed the pretest checks.

I think that registering it as an S3 method makes the potential problem 
worse, because it makes it much more visible.  That's assuming you now 
have something like

   S3method(levels, no)

in your NAMESPACE file, so every use of levels() by the user or in any 
package could potentially call levels.no if your package is loaded.

Duncan Murdoch


> 
> Ulrike Groemping
> 
>>
>>>
>>> Best, Ulrike
>>>
>>> Am 08.05.2023 um 13:58 schrieb Duncan Murdoch:
>>>> There really isn't such a thing as "a function that looks like an S3
>>>> method, but isn't".? If it looks like an S3 method, then in the proper
>>>> circumstances, it will be called as one.
>>>>
>>>> In your case the function name is levels.no, and it isn't exported.
>>>> So if you happen to have an object with a class inheriting from "no",
>>>> and you call levels() on it, levels.no might be called.
>>>>
>>>> This will only affect users of your package indirectly.? If they have
>>>> objects inheriting from "no" and call levels() on them, levels.no will
>>>> not be called.? But if they pass such an object to one of your package
>>>> functions, and that function calls levels() on it, they could end up
>>>> calling levels.no().? It all depends on what other classes that object
>>>> inherits from.
>>>>
>>>> You can test this yourself.? Set debugging on any one of your
>>>> functions, then call it in the normal way.? Then while still in the
>>>> debugger set debugging on levels.no, and create an object using
>>>>
>>>>  ?? x <- structure(1, class = "no")
>>>>
>>>> and call levels(x).? You should break to the code of levels.no.
>>>>
>>>> That is why the WRE manual says "First, a caveat: a function named
>>>> gen.cl will be invoked by the generic gen for class cl, so do not name
>>>> functions in this style unless they are intended to be methods."
>>>>
>>>> So probably the best solution (even if inconvenient) is to rename
>>>> levels.no to something that doesn't look like an S3 method.
>>>>
>>>> Duncan Murdoch
>>>>
>>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>>> Thank your for the solution attempt. However, using the keyword
>>>>> internal
>>>>> does not solve the problem, the note is still there. Any other
>>>>> proposals
>>>>> for properly documenting a function that looks like an S3 method, but
>>>>> isn't?
>>>>>
>>>>> Best, Ulrike
>>>>>
>>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>>> You can add
>>>>>>
>>>>>> \keyword{internal}
>>>>>>
>>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>>> manual, it won't show up in the package index, but you'll still be
>>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>>> help("levels.no <http://levels.no>").
>>>>>>
>>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>>> but you can use it anywhere.
>>>>>>
>>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>>>
>>>>>>  ????? Dear package developeRs,
>>>>>>
>>>>>>  ????? I am working on fixing some notes regarding package DoE.base.
>>>>>>  ????? One note refers to the function levels.no <http://levels.no>
>>>>>> and
>>>>>>  ????? complains that the
>>>>>>  ????? function is not documented as a method for the generic function
>>>>>>  ????? levels.
>>>>>>  ????? Actually, it is not a method for the generic levels, but a
>>>>>> standalone
>>>>>>  ????? internal function that I like to have documented.
>>>>>>
>>>>>>  ????? Is there a way to document the function without renaming it and
>>>>>>  ????? without
>>>>>>  ????? triggering a note about method documentation?
>>>>>>
>>>>>>  ????? Best, Ulrike
>>>>>>
>>>>>>  ????? --
>>>>>>  ????? ##############################################
>>>>>>  ????? ## Prof. Ulrike Groemping
>>>>>>  ????? ## FB II
>>>>>>  ????? ## Berliner Hochschule f?r Technik (BHT)
>>>>>>  ????? ##############################################
>>>>>>  ????? ## prof.bht-berlin.de/groemping
>>>>>> <http://prof.bht-berlin.de/groemping>
>>>>>>  ????? ## Phone: +49(0)30 4504 5127
>>>>>>  ????? ## Fax:? ?+49(0)30 4504 66 5127
>>>>>>  ????? ## Home office: +49(0)30 394 04 863
>>>>>>  ????? ##############################################
>>>>>>
>>>>>>  ????? ______________________________________________
>>>>>>  ????? R-package-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>


From @|mon@urb@nek @end|ng |rom R-project@org  Tue May  9 00:58:43 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Tue, 9 May 2023 10:58:43 +1200
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
Message-ID: <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>



> On 8/05/2023, at 11:58 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> There really isn't such a thing as "a function that looks like an S3 method, but isn't".  If it looks like an S3 method, then in the proper circumstances, it will be called as one.
> 


I disagree - that was the case in old versions, but not anymore. The whole point of introducing namespaces and method registration was to make it clear when a function is a method and when it is a function. If you export a function it won't be treated as a method:

In a package NAMESPACE:
export(foo.cls)
package R code: foo.cls <- function(x) "foo.cls"

in R:
> cls=structure(1,class="cls")
> foo=function(x) UseMethod("foo")
> foo(cls)
Error in UseMethod("foo") : 
  no applicable method for 'foo' applied to an object of class "cls"
> foo.cls(cls)
[1] "foo.cls"

So R knows very well what is a method and what is a function. If you wanted it to be a method, you have to use S3method(foo, cls) and that **is** different from export(foo.cls) - quite deliberately so.

Cheers,
Simon


> In your case the function name is levels.no, and it isn't exported.  So if you happen to have an object with a class inheriting from "no", and you call levels() on it, levels.no might be called.
> 
> This will only affect users of your package indirectly.  If they have objects inheriting from "no" and call levels() on them, levels.no will not be called.  But if they pass such an object to one of your package functions, and that function calls levels() on it, they could end up calling levels.no().  It all depends on what other classes that object inherits from.
> 
> You can test this yourself.  Set debugging on any one of your functions, then call it in the normal way.  Then while still in the debugger set debugging on levels.no, and create an object using
> 
>  x <- structure(1, class = "no")
> 
> and call levels(x).  You should break to the code of levels.no.
> 
> That is why the WRE manual says "First, a caveat: a function named gen.cl will be invoked by the generic gen for class cl, so do not name functions in this style unless they are intended to be methods."
> 
> So probably the best solution (even if inconvenient) is to rename levels.no to something that doesn't look like an S3 method.
> 
> Duncan Murdoch
> 
> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>> Thank your for the solution attempt. However, using the keyword internal
>> does not solve the problem, the note is still there. Any other proposals
>> for properly documenting a function that looks like an S3 method, but isn't?
>> Best, Ulrike
>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>> You can add
>>> 
>>> \keyword{internal}
>>> 
>>> to the Rd file. Your documentation won't show up the in the pdf
>>> manual, it won't show up in the package index, but you'll still be
>>> able to access the doc page with ?levels.no <http://levels.no> or
>>> help("levels.no <http://levels.no>").
>>> 
>>> This is usually used in a package's deprecated and defunct doc pages,
>>> but you can use it anywhere.
>>> 
>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>> <ulrike.groemping at bht-berlin.de> wrote:
>>> 
>>>     Dear package developeRs,
>>> 
>>>     I am working on fixing some notes regarding package DoE.base.
>>>     One note refers to the function levels.no <http://levels.no> and
>>>     complains that the
>>>     function is not documented as a method for the generic function
>>>     levels.
>>>     Actually, it is not a method for the generic levels, but a standalone
>>>     internal function that I like to have documented.
>>> 
>>>     Is there a way to document the function without renaming it and
>>>     without
>>>     triggering a note about method documentation?
>>> 
>>>     Best, Ulrike
>>> 
>>>     --
>>>     ##############################################
>>>     ## Prof. Ulrike Groemping
>>>     ## FB II
>>>     ## Berliner Hochschule f?r Technik (BHT)
>>>     ##############################################
>>>     ## prof.bht-berlin.de/groemping <http://prof.bht-berlin.de/groemping>
>>>     ## Phone: +49(0)30 4504 5127
>>>     ## Fax:   +49(0)30 4504 66 5127
>>>     ## Home office: +49(0)30 394 04 863
>>>     ##############################################
>>> 
>>>     ______________________________________________
>>>     R-package-devel at r-project.org mailing list
>>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>> 
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue May  9 01:23:00 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 8 May 2023 19:23:00 -0400
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>
Message-ID: <d816507e-c043-403a-d029-85babaabd086@gmail.com>

On 08/05/2023 6:58 p.m., Simon Urbanek wrote:
> 
> 
>> On 8/05/2023, at 11:58 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> There really isn't such a thing as "a function that looks like an S3 method, but isn't".  If it looks like an S3 method, then in the proper circumstances, it will be called as one.
>>
> 
> 
> I disagree - that was the case in old versions, but not anymore. The whole point of introducing namespaces and method registration was to make it clear when a function is a method and when it is a function. If you export a function it won't be treated as a method:
> 
> In a package NAMESPACE:
> export(foo.cls)
> package R code: foo.cls <- function(x) "foo.cls"
> 
> in R:
>> cls=structure(1,class="cls")
>> foo=function(x) UseMethod("foo")
>> foo(cls)
> Error in UseMethod("foo") :
>    no applicable method for 'foo' applied to an object of class "cls"
>> foo.cls(cls)
> [1] "foo.cls"
> 
> So R knows very well what is a method and what is a function. If you wanted it to be a method, you have to use S3method(foo, cls) and that **is** different from export(foo.cls) - quite deliberately so.

That is true for package users, but it's not true within the package.  I 
just tested this code in a package:

   levels.no <- function(xx, ...) {
     stop("not a method")
   }

   f <- function() {
     x <- structure(1, class = "no")
     levels(x)
   }

Both levels.no and f were exported.  If I attach the package and call 
f(), I get the error

   > library(testpkg)
   > f()
   Error in levels.no(x) : not a method

because levels.no is being treated as a method when levels() is called 
in the package.

If I create an x like that outside of the package and call levels(x) 
there, I get NULL, because levels.no is not being treated as a method in 
that context.

As far as I know, there is no possible way to have a function in a 
package that is called "levels.no" and not being treated as a method 
within the package.  I don't think there's any way to declare "this is 
not a method", other than naming it differently.

Duncan

> 
> Cheers,
> Simon
> 
> 
>> In your case the function name is levels.no, and it isn't exported.  So if you happen to have an object with a class inheriting from "no", and you call levels() on it, levels.no might be called.
>>
>> This will only affect users of your package indirectly.  If they have objects inheriting from "no" and call levels() on them, levels.no will not be called.  But if they pass such an object to one of your package functions, and that function calls levels() on it, they could end up calling levels.no().  It all depends on what other classes that object inherits from.
>>
>> You can test this yourself.  Set debugging on any one of your functions, then call it in the normal way.  Then while still in the debugger set debugging on levels.no, and create an object using
>>
>>   x <- structure(1, class = "no")
>>
>> and call levels(x).  You should break to the code of levels.no.
>>
>> That is why the WRE manual says "First, a caveat: a function named gen.cl will be invoked by the generic gen for class cl, so do not name functions in this style unless they are intended to be methods."
>>
>> So probably the best solution (even if inconvenient) is to rename levels.no to something that doesn't look like an S3 method.
>>
>> Duncan Murdoch
>>
>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>> Thank your for the solution attempt. However, using the keyword internal
>>> does not solve the problem, the note is still there. Any other proposals
>>> for properly documenting a function that looks like an S3 method, but isn't?
>>> Best, Ulrike
>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>> You can add
>>>>
>>>> \keyword{internal}
>>>>
>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>> manual, it won't show up in the package index, but you'll still be
>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>> help("levels.no <http://levels.no>").
>>>>
>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>> but you can use it anywhere.
>>>>
>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>
>>>>      Dear package developeRs,
>>>>
>>>>      I am working on fixing some notes regarding package DoE.base.
>>>>      One note refers to the function levels.no <http://levels.no> and
>>>>      complains that the
>>>>      function is not documented as a method for the generic function
>>>>      levels.
>>>>      Actually, it is not a method for the generic levels, but a standalone
>>>>      internal function that I like to have documented.
>>>>
>>>>      Is there a way to document the function without renaming it and
>>>>      without
>>>>      triggering a note about method documentation?
>>>>
>>>>      Best, Ulrike
>>>>
>>>>      --
>>>>      ##############################################
>>>>      ## Prof. Ulrike Groemping
>>>>      ## FB II
>>>>      ## Berliner Hochschule f?r Technik (BHT)
>>>>      ##############################################
>>>>      ## prof.bht-berlin.de/groemping <http://prof.bht-berlin.de/groemping>
>>>>      ## Phone: +49(0)30 4504 5127
>>>>      ## Fax:   +49(0)30 4504 66 5127
>>>>      ## Home office: +49(0)30 394 04 863
>>>>      ##############################################
>>>>
>>>>      ______________________________________________
>>>>      R-package-devel at r-project.org mailing list
>>>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue May  9 01:53:24 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 8 May 2023 19:53:24 -0400
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <d816507e-c043-403a-d029-85babaabd086@gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>
 <d816507e-c043-403a-d029-85babaabd086@gmail.com>
Message-ID: <a4f1834e-a8c7-676c-0442-5ebb2c3ab5f0@gmail.com>

If anyone wants to try my demo, they can install the test package using

   remotes::install_github("dmurdoch/testpkg")

and see the demonstration by running

   library(testpkg)
   example(f)

Duncan Murdoch

On 08/05/2023 7:23 p.m., Duncan Murdoch wrote:
> On 08/05/2023 6:58 p.m., Simon Urbanek wrote:
>>
>>
>>> On 8/05/2023, at 11:58 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>
>>> There really isn't such a thing as "a function that looks like an S3 method, but isn't".  If it looks like an S3 method, then in the proper circumstances, it will be called as one.
>>>
>>
>>
>> I disagree - that was the case in old versions, but not anymore. The whole point of introducing namespaces and method registration was to make it clear when a function is a method and when it is a function. If you export a function it won't be treated as a method:
>>
>> In a package NAMESPACE:
>> export(foo.cls)
>> package R code: foo.cls <- function(x) "foo.cls"
>>
>> in R:
>>> cls=structure(1,class="cls")
>>> foo=function(x) UseMethod("foo")
>>> foo(cls)
>> Error in UseMethod("foo") :
>>     no applicable method for 'foo' applied to an object of class "cls"
>>> foo.cls(cls)
>> [1] "foo.cls"
>>
>> So R knows very well what is a method and what is a function. If you wanted it to be a method, you have to use S3method(foo, cls) and that **is** different from export(foo.cls) - quite deliberately so.
> 
> That is true for package users, but it's not true within the package.  I
> just tested this code in a package:
> 
>     levels.no <- function(xx, ...) {
>       stop("not a method")
>     }
> 
>     f <- function() {
>       x <- structure(1, class = "no")
>       levels(x)
>     }
> 
> Both levels.no and f were exported.  If I attach the package and call
> f(), I get the error
> 
>     > library(testpkg)
>     > f()
>     Error in levels.no(x) : not a method
> 
> because levels.no is being treated as a method when levels() is called
> in the package.
> 
> If I create an x like that outside of the package and call levels(x)
> there, I get NULL, because levels.no is not being treated as a method in
> that context.
> 
> As far as I know, there is no possible way to have a function in a
> package that is called "levels.no" and not being treated as a method
> within the package.  I don't think there's any way to declare "this is
> not a method", other than naming it differently.
> 
> Duncan
> 
>>
>> Cheers,
>> Simon
>>
>>
>>> In your case the function name is levels.no, and it isn't exported.  So if you happen to have an object with a class inheriting from "no", and you call levels() on it, levels.no might be called.
>>>
>>> This will only affect users of your package indirectly.  If they have objects inheriting from "no" and call levels() on them, levels.no will not be called.  But if they pass such an object to one of your package functions, and that function calls levels() on it, they could end up calling levels.no().  It all depends on what other classes that object inherits from.
>>>
>>> You can test this yourself.  Set debugging on any one of your functions, then call it in the normal way.  Then while still in the debugger set debugging on levels.no, and create an object using
>>>
>>>    x <- structure(1, class = "no")
>>>
>>> and call levels(x).  You should break to the code of levels.no.
>>>
>>> That is why the WRE manual says "First, a caveat: a function named gen.cl will be invoked by the generic gen for class cl, so do not name functions in this style unless they are intended to be methods."
>>>
>>> So probably the best solution (even if inconvenient) is to rename levels.no to something that doesn't look like an S3 method.
>>>
>>> Duncan Murdoch
>>>
>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>> Thank your for the solution attempt. However, using the keyword internal
>>>> does not solve the problem, the note is still there. Any other proposals
>>>> for properly documenting a function that looks like an S3 method, but isn't?
>>>> Best, Ulrike
>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>> You can add
>>>>>
>>>>> \keyword{internal}
>>>>>
>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>> manual, it won't show up in the package index, but you'll still be
>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>> help("levels.no <http://levels.no>").
>>>>>
>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>> but you can use it anywhere.
>>>>>
>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>>
>>>>>       Dear package developeRs,
>>>>>
>>>>>       I am working on fixing some notes regarding package DoE.base.
>>>>>       One note refers to the function levels.no <http://levels.no> and
>>>>>       complains that the
>>>>>       function is not documented as a method for the generic function
>>>>>       levels.
>>>>>       Actually, it is not a method for the generic levels, but a standalone
>>>>>       internal function that I like to have documented.
>>>>>
>>>>>       Is there a way to document the function without renaming it and
>>>>>       without
>>>>>       triggering a note about method documentation?
>>>>>
>>>>>       Best, Ulrike
>>>>>
>>>>>       --
>>>>>       ##############################################
>>>>>       ## Prof. Ulrike Groemping
>>>>>       ## FB II
>>>>>       ## Berliner Hochschule f?r Technik (BHT)
>>>>>       ##############################################
>>>>>       ## prof.bht-berlin.de/groemping <http://prof.bht-berlin.de/groemping>
>>>>>       ## Phone: +49(0)30 4504 5127
>>>>>       ## Fax:   +49(0)30 4504 66 5127
>>>>>       ## Home office: +49(0)30 394 04 863
>>>>>       ##############################################
>>>>>
>>>>>       ______________________________________________
>>>>>       R-package-devel at r-project.org mailing list
>>>>>       https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>


From u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de  Tue May  9 08:13:22 2023
From: u|r|ke@groemp|ng @end|ng |rom bht-ber||n@de (Ulrike Groemping)
Date: Tue, 9 May 2023 08:13:22 +0200
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <d816507e-c043-403a-d029-85babaabd086@gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>
 <d816507e-c043-403a-d029-85babaabd086@gmail.com>
Message-ID: <0d38f1c1-a027-7016-1cf1-f31fe1d489e4@bht-berlin.de>

Am 09.05.2023 um 01:23 schrieb Duncan Murdoch:
> On 08/05/2023 6:58 p.m., Simon Urbanek wrote:
>>
>>
>>> On 8/05/2023, at 11:58 PM, Duncan Murdoch <murdoch.duncan at gmail.com> 
>>> wrote:
>>>
>>> There really isn't such a thing as "a function that looks like an S3 
>>> method, but isn't".? If it looks like an S3 method, then in the 
>>> proper circumstances, it will be called as one.
>>>
>>
>>
>> I disagree - that was the case in old versions, but not anymore. The 
>> whole point of introducing namespaces and method registration was to 
>> make it clear when a function is a method and when it is a function. 
>> If you export a function it won't be treated as a method:
>>
>> In a package NAMESPACE:
>> export(foo.cls)
>> package R code: foo.cls <- function(x) "foo.cls"
>>
>> in R:
>>> cls=structure(1,class="cls")
>>> foo=function(x) UseMethod("foo")
>>> foo(cls)
>> Error in UseMethod("foo") :
>> ?? no applicable method for 'foo' applied to an object of class "cls"
>>> foo.cls(cls)
>> [1] "foo.cls"
>>
>> So R knows very well what is a method and what is a function. If you 
>> wanted it to be a method, you have to use S3method(foo, cls) and that 
>> **is** different from export(foo.cls) - quite deliberately so.
>
> That is true for package users, but it's not true within the package.? 
> I just tested this code in a package:
>
> ? levels.no <- function(xx, ...) {
> ??? stop("not a method")
> ? }
>
> ? f <- function() {
> ??? x <- structure(1, class = "no")
> ??? levels(x)
> ? }
>
> Both levels.no and f were exported.? If I attach the package and call 
> f(), I get the error
>
> ? > library(testpkg)
> ? > f()
> ? Error in levels.no(x) : not a method
>
> because levels.no is being treated as a method when levels() is called 
> in the package.
>
> If I create an x like that outside of the package and call levels(x) 
> there, I get NULL, because levels.no is not being treated as a method 
> in that context.
>
> As far as I know, there is no possible way to have a function in a 
> package that is called "levels.no" and not being treated as a method 
> within the package.? I don't think there's any way to declare "this is 
> not a method", other than naming it differently.
>
> Duncan

Before the current check notes, I did not think about that problem. I 
think that it is quite unlikely to hit a user of mine, because the 
package calls levels() in a few places on columns of designs only. I 
still think that it should remain possible to have an *internal* 
function that is named in whatever way I like it named (I would of 
course not choose that name now, but it's there, and it would break a 
lot of my own non-package code if I changed it in the package). My 
current "fix" made the problem worse.
Would it have been permissible to not register the function ? I could 
then revert to not registering it, but keeping the error message in 
place, just in case the unlikely event happens.

Ulrike

>
>>
>> Cheers,
>> Simon
>>
>>
>>> In your case the function name is levels.no, and it isn't exported.? 
>>> So if you happen to have an object with a class inheriting from 
>>> "no", and you call levels() on it, levels.no might be called.
>>>
>>> This will only affect users of your package indirectly.? If they 
>>> have objects inheriting from "no" and call levels() on them, 
>>> levels.no will not be called.? But if they pass such an object to 
>>> one of your package functions, and that function calls levels() on 
>>> it, they could end up calling levels.no(). It all depends on what 
>>> other classes that object inherits from.
>>>
>>> You can test this yourself.? Set debugging on any one of your 
>>> functions, then call it in the normal way.? Then while still in the 
>>> debugger set debugging on levels.no, and create an object using
>>>
>>> ? x <- structure(1, class = "no")
>>>
>>> and call levels(x).? You should break to the code of levels.no.
>>>
>>> That is why the WRE manual says "First, a caveat: a function named 
>>> gen.cl will be invoked by the generic gen for class cl, so do not 
>>> name functions in this style unless they are intended to be methods."
>>>
>>> So probably the best solution (even if inconvenient) is to rename 
>>> levels.no to something that doesn't look like an S3 method.
>>>
>>> Duncan Murdoch
>>>
>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>> Thank your for the solution attempt. However, using the keyword 
>>>> internal
>>>> does not solve the problem, the note is still there. Any other 
>>>> proposals
>>>> for properly documenting a function that looks like an S3 method, 
>>>> but isn't?
>>>> Best, Ulrike
>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>> You can add
>>>>>
>>>>> \keyword{internal}
>>>>>
>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>> manual, it won't show up in the package index, but you'll still be
>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>> help("levels.no <http://levels.no>").
>>>>>
>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>> but you can use it anywhere.
>>>>>
>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>>
>>>>> ???? Dear package developeRs,
>>>>>
>>>>> ???? I am working on fixing some notes regarding package DoE.base.
>>>>> ???? One note refers to the function levels.no <http://levels.no> and
>>>>> ???? complains that the
>>>>> ???? function is not documented as a method for the generic function
>>>>> ???? levels.
>>>>> ???? Actually, it is not a method for the generic levels, but a 
>>>>> standalone
>>>>> ???? internal function that I like to have documented.
>>>>>
>>>>> ???? Is there a way to document the function without renaming it and
>>>>> ???? without
>>>>> ???? triggering a note about method documentation?
>>>>>
>>>>> ???? Best, Ulrike
>>>>>
>>>>> ???? --
>>>>> ???? ##############################################
>>>>> ???? ## Prof. Ulrike Groemping
>>>>> ???? ## FB II
>>>>> ???? ## Berliner Hochschule f?r Technik (BHT)
>>>>> ???? ##############################################
>>>>> ???? ## prof.bht-berlin.de/groemping 
>>>>> <http://prof.bht-berlin.de/groemping>
>>>>> ???? ## Phone: +49(0)30 4504 5127
>>>>> ???? ## Fax:?? +49(0)30 4504 66 5127
>>>>> ???? ## Home office: +49(0)30 394 04 863
>>>>> ???? ##############################################
>>>>>
>>>>> ???? ______________________________________________
>>>>> ???? R-package-devel at r-project.org mailing list
>>>>> ???? https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>
>


From ||@t@ @end|ng |rom dewey@myzen@co@uk  Tue May  9 14:31:07 2023
From: ||@t@ @end|ng |rom dewey@myzen@co@uk (Michael Dewey)
Date: Tue, 9 May 2023 13:31:07 +0100
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <0d38f1c1-a027-7016-1cf1-f31fe1d489e4@bht-berlin.de>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>
 <d816507e-c043-403a-d029-85babaabd086@gmail.com>
 <0d38f1c1-a027-7016-1cf1-f31fe1d489e4@bht-berlin.de>
Message-ID: <072fe64b-8abf-d18b-4a28-03251a57ae25@dewey.myzen.co.uk>

Dear Ulrike

Even though it will undobtedly be a lot of work to rename levels.no I 
cannot help feeling that by fighting against the system you may be 
storing up trouble for yourself in future when some upgrade breaks your 
current solution and you have to make yet more changes.

Michael

On 09/05/2023 07:13, Ulrike Groemping wrote:
> Am 09.05.2023 um 01:23 schrieb Duncan Murdoch:
>> On 08/05/2023 6:58 p.m., Simon Urbanek wrote:
>>>
>>>
>>>> On 8/05/2023, at 11:58 PM, Duncan Murdoch <murdoch.duncan at gmail.com> 
>>>> wrote:
>>>>
>>>> There really isn't such a thing as "a function that looks like an S3 
>>>> method, but isn't".? If it looks like an S3 method, then in the 
>>>> proper circumstances, it will be called as one.
>>>>
>>>
>>>
>>> I disagree - that was the case in old versions, but not anymore. The 
>>> whole point of introducing namespaces and method registration was to 
>>> make it clear when a function is a method and when it is a function. 
>>> If you export a function it won't be treated as a method:
>>>
>>> In a package NAMESPACE:
>>> export(foo.cls)
>>> package R code: foo.cls <- function(x) "foo.cls"
>>>
>>> in R:
>>>> cls=structure(1,class="cls")
>>>> foo=function(x) UseMethod("foo")
>>>> foo(cls)
>>> Error in UseMethod("foo") :
>>> ?? no applicable method for 'foo' applied to an object of class "cls"
>>>> foo.cls(cls)
>>> [1] "foo.cls"
>>>
>>> So R knows very well what is a method and what is a function. If you 
>>> wanted it to be a method, you have to use S3method(foo, cls) and that 
>>> **is** different from export(foo.cls) - quite deliberately so.
>>
>> That is true for package users, but it's not true within the package. 
>> I just tested this code in a package:
>>
>> ? levels.no <- function(xx, ...) {
>> ??? stop("not a method")
>> ? }
>>
>> ? f <- function() {
>> ??? x <- structure(1, class = "no")
>> ??? levels(x)
>> ? }
>>
>> Both levels.no and f were exported.? If I attach the package and call 
>> f(), I get the error
>>
>> ? > library(testpkg)
>> ? > f()
>> ? Error in levels.no(x) : not a method
>>
>> because levels.no is being treated as a method when levels() is called 
>> in the package.
>>
>> If I create an x like that outside of the package and call levels(x) 
>> there, I get NULL, because levels.no is not being treated as a method 
>> in that context.
>>
>> As far as I know, there is no possible way to have a function in a 
>> package that is called "levels.no" and not being treated as a method 
>> within the package.? I don't think there's any way to declare "this is 
>> not a method", other than naming it differently.
>>
>> Duncan
> 
> Before the current check notes, I did not think about that problem. I 
> think that it is quite unlikely to hit a user of mine, because the 
> package calls levels() in a few places on columns of designs only. I 
> still think that it should remain possible to have an *internal* 
> function that is named in whatever way I like it named (I would of 
> course not choose that name now, but it's there, and it would break a 
> lot of my own non-package code if I changed it in the package). My 
> current "fix" made the problem worse.
> Would it have been permissible to not register the function ? I could 
> then revert to not registering it, but keeping the error message in 
> place, just in case the unlikely event happens.
> 
> Ulrike
> 
>>
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>> In your case the function name is levels.no, and it isn't exported. 
>>>> So if you happen to have an object with a class inheriting from 
>>>> "no", and you call levels() on it, levels.no might be called.
>>>>
>>>> This will only affect users of your package indirectly.? If they 
>>>> have objects inheriting from "no" and call levels() on them, 
>>>> levels.no will not be called.? But if they pass such an object to 
>>>> one of your package functions, and that function calls levels() on 
>>>> it, they could end up calling levels.no(). It all depends on what 
>>>> other classes that object inherits from.
>>>>
>>>> You can test this yourself.? Set debugging on any one of your 
>>>> functions, then call it in the normal way.? Then while still in the 
>>>> debugger set debugging on levels.no, and create an object using
>>>>
>>>> ? x <- structure(1, class = "no")
>>>>
>>>> and call levels(x).? You should break to the code of levels.no.
>>>>
>>>> That is why the WRE manual says "First, a caveat: a function named 
>>>> gen.cl will be invoked by the generic gen for class cl, so do not 
>>>> name functions in this style unless they are intended to be methods."
>>>>
>>>> So probably the best solution (even if inconvenient) is to rename 
>>>> levels.no to something that doesn't look like an S3 method.
>>>>
>>>> Duncan Murdoch
>>>>
>>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>>> Thank your for the solution attempt. However, using the keyword 
>>>>> internal
>>>>> does not solve the problem, the note is still there. Any other 
>>>>> proposals
>>>>> for properly documenting a function that looks like an S3 method, 
>>>>> but isn't?
>>>>> Best, Ulrike
>>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>>> You can add
>>>>>>
>>>>>> \keyword{internal}
>>>>>>
>>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>>> manual, it won't show up in the package index, but you'll still be
>>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>>> help("levels.no <http://levels.no>").
>>>>>>
>>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>>> but you can use it anywhere.
>>>>>>
>>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>>>
>>>>>> ???? Dear package developeRs,
>>>>>>
>>>>>> ???? I am working on fixing some notes regarding package DoE.base.
>>>>>> ???? One note refers to the function levels.no <http://levels.no> and
>>>>>> ???? complains that the
>>>>>> ???? function is not documented as a method for the generic function
>>>>>> ???? levels.
>>>>>> ???? Actually, it is not a method for the generic levels, but a 
>>>>>> standalone
>>>>>> ???? internal function that I like to have documented.
>>>>>>
>>>>>> ???? Is there a way to document the function without renaming it and
>>>>>> ???? without
>>>>>> ???? triggering a note about method documentation?
>>>>>>
>>>>>> ???? Best, Ulrike
>>>>>>
>>>>>> ???? --
>>>>>> ???? ##############################################
>>>>>> ???? ## Prof. Ulrike Groemping
>>>>>> ???? ## FB II
>>>>>> ???? ## Berliner Hochschule f?r Technik (BHT)
>>>>>> ???? ##############################################
>>>>>> ???? ## prof.bht-berlin.de/groemping 
>>>>>> <http://prof.bht-berlin.de/groemping>
>>>>>> ???? ## Phone: +49(0)30 4504 5127
>>>>>> ???? ## Fax:?? +49(0)30 4504 66 5127
>>>>>> ???? ## Home office: +49(0)30 394 04 863
>>>>>> ???? ##############################################
>>>>>>
>>>>>> ???? ______________________________________________
>>>>>> ???? R-package-devel at r-project.org mailing list
>>>>>> ???? https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 

-- 
Michael
http://www.dewey.myzen.co.uk/home.html


From pro|jcn@@h @end|ng |rom gm@||@com  Tue May  9 18:57:06 2023
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Tue, 9 May 2023 12:57:06 -0400
Subject: [R-pkg-devel] files katex.js and katex-config.js not found in R CMD
 check --as-cran
Message-ID: <e4f56cd4-3856-c174-9cb6-906eb54dbd56@gmail.com>

In updating my nlsr package, I ran R CMD check --as-cran and got an error
that /usr/lib/R/doc/html/katex/katex.js was not found.

I installed the (large!) r-cran-katex. No joy.

katex.js was in /usr/share/R/doc/html/katex/  so I created a symlink. Then
I got katex-config.js not found (but in 1 directory up).
So

sudo ln -s /usr/share/R/doc/html/katex-config.js katex-config.js

Then I get the check to run OK. So I'm now up and running, but others might not
be so persistent.

Is there a glitch in my system? Or is this a bug in the latest R CMD check --as-cran?
(Or at least a configuration issue?)

Best,

John Nash


From kry|ov@r00t @end|ng |rom gm@||@com  Tue May  9 19:32:52 2023
From: kry|ov@r00t @end|ng |rom gm@||@com (Ivan Krylov)
Date: Tue, 9 May 2023 20:32:52 +0300
Subject: [R-pkg-devel] 
 files katex.js and katex-config.js not found in R CMD
 check --as-cran
In-Reply-To: <e4f56cd4-3856-c174-9cb6-906eb54dbd56@gmail.com>
References: <e4f56cd4-3856-c174-9cb6-906eb54dbd56@gmail.com>
Message-ID: <20230509203252.6ca2d653@Tarkus>

On Tue, 9 May 2023 12:57:06 -0400
J C Nash <profjcnash at gmail.com> wrote:

> In updating my nlsr package, I ran R CMD check --as-cran and got an
> error that /usr/lib/R/doc/html/katex/katex.js was not found.

> Is there a glitch in my system? Or is this a bug in the latest R CMD
> check --as-cran? (Or at least a configuration issue?)

It's an unfortunate interaction between an R issue and the way R is
packaged: https://bugs.r-project.org/show_bug.cgi?id=18517

The r84321 patch has already made its way into R-4-3-branch, so I think
it will become part of R-4.3.1 when it's released.

-- 
Best regards,
Ivan


From @|mon@urb@nek @end|ng |rom R-project@org  Tue May  9 23:05:05 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 10 May 2023 09:05:05 +1200
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <d816507e-c043-403a-d029-85babaabd086@gmail.com>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>
 <d816507e-c043-403a-d029-85babaabd086@gmail.com>
Message-ID: <9878B90C-A3CD-431C-A73E-615A53A0CB0C@R-project.org>

Duncan,

you're right that any functions in the call environment are always treated as methods (even before consulting method registrations). That is a special case - I presume for compatibility with the world before namespaces so that, e.g., you don't have to register methods in the global environment when working interactively. I wonder if that is something that packages could choose to opt out of for safety since they are already relying on method registration (and that would also in theory improve performance).

One interesting related issue is that in the current implementation of the method registration there is no concept of "private" methods (which is what the above rule effectively provides) since methods get registered with the generic, so they are either visible to everyone or not at all. If one would really want to support this, it would require a kind of "local" registration and then replacing the name-based search up the call chain with local registration search - but probably again at the cost of performance.

Cheers,
Simon


> On May 9, 2023, at 11:23 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> On 08/05/2023 6:58 p.m., Simon Urbanek wrote:
>>> On 8/05/2023, at 11:58 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>> 
>>> There really isn't such a thing as "a function that looks like an S3 method, but isn't".  If it looks like an S3 method, then in the proper circumstances, it will be called as one.
>>> 
>> I disagree - that was the case in old versions, but not anymore. The whole point of introducing namespaces and method registration was to make it clear when a function is a method and when it is a function. If you export a function it won't be treated as a method:
>> In a package NAMESPACE:
>> export(foo.cls)
>> package R code: foo.cls <- function(x) "foo.cls"
>> in R:
>>> cls=structure(1,class="cls")
>>> foo=function(x) UseMethod("foo")
>>> foo(cls)
>> Error in UseMethod("foo") :
>>   no applicable method for 'foo' applied to an object of class "cls"
>>> foo.cls(cls)
>> [1] "foo.cls"
>> So R knows very well what is a method and what is a function. If you wanted it to be a method, you have to use S3method(foo, cls) and that **is** different from export(foo.cls) - quite deliberately so.
> 
> That is true for package users, but it's not true within the package.  I just tested this code in a package:
> 
>  levels.no <- function(xx, ...) {
>    stop("not a method")
>  }
> 
>  f <- function() {
>    x <- structure(1, class = "no")
>    levels(x)
>  }
> 
> Both levels.no and f were exported.  If I attach the package and call f(), I get the error
> 
>  > library(testpkg)
>  > f()
>  Error in levels.no(x) : not a method
> 
> because levels.no is being treated as a method when levels() is called in the package.
> 
> If I create an x like that outside of the package and call levels(x) there, I get NULL, because levels.no is not being treated as a method in that context.
> 
> As far as I know, there is no possible way to have a function in a package that is called "levels.no" and not being treated as a method within the package.  I don't think there's any way to declare "this is not a method", other than naming it differently.
> 
> Duncan
> 
>> Cheers,
>> Simon
>>> In your case the function name is levels.no, and it isn't exported.  So if you happen to have an object with a class inheriting from "no", and you call levels() on it, levels.no might be called.
>>> 
>>> This will only affect users of your package indirectly.  If they have objects inheriting from "no" and call levels() on them, levels.no will not be called.  But if they pass such an object to one of your package functions, and that function calls levels() on it, they could end up calling levels.no().  It all depends on what other classes that object inherits from.
>>> 
>>> You can test this yourself.  Set debugging on any one of your functions, then call it in the normal way.  Then while still in the debugger set debugging on levels.no, and create an object using
>>> 
>>>  x <- structure(1, class = "no")
>>> 
>>> and call levels(x).  You should break to the code of levels.no.
>>> 
>>> That is why the WRE manual says "First, a caveat: a function named gen.cl will be invoked by the generic gen for class cl, so do not name functions in this style unless they are intended to be methods."
>>> 
>>> So probably the best solution (even if inconvenient) is to rename levels.no to something that doesn't look like an S3 method.
>>> 
>>> Duncan Murdoch
>>> 
>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>> Thank your for the solution attempt. However, using the keyword internal
>>>> does not solve the problem, the note is still there. Any other proposals
>>>> for properly documenting a function that looks like an S3 method, but isn't?
>>>> Best, Ulrike
>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>> You can add
>>>>> 
>>>>> \keyword{internal}
>>>>> 
>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>> manual, it won't show up in the package index, but you'll still be
>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>> help("levels.no <http://levels.no>").
>>>>> 
>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>> but you can use it anywhere.
>>>>> 
>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>> 
>>>>>     Dear package developeRs,
>>>>> 
>>>>>     I am working on fixing some notes regarding package DoE.base.
>>>>>     One note refers to the function levels.no <http://levels.no> and
>>>>>     complains that the
>>>>>     function is not documented as a method for the generic function
>>>>>     levels.
>>>>>     Actually, it is not a method for the generic levels, but a standalone
>>>>>     internal function that I like to have documented.
>>>>> 
>>>>>     Is there a way to document the function without renaming it and
>>>>>     without
>>>>>     triggering a note about method documentation?
>>>>> 
>>>>>     Best, Ulrike
>>>>> 
>>>>>     --
>>>>>     ##############################################
>>>>>     ## Prof. Ulrike Groemping
>>>>>     ## FB II
>>>>>     ## Berliner Hochschule f?r Technik (BHT)
>>>>>     ##############################################
>>>>>     ## prof.bht-berlin.de/groemping <http://prof.bht-berlin.de/groemping>
>>>>>     ## Phone: +49(0)30 4504 5127
>>>>>     ## Fax:   +49(0)30 4504 66 5127
>>>>>     ## Home office: +49(0)30 394 04 863
>>>>>     ##############################################
>>>>> 
>>>>>     ______________________________________________
>>>>>     R-package-devel at r-project.org mailing list
>>>>>     https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>> 
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>> 
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>> 
> 


From murdoch@dunc@n @end|ng |rom gm@||@com  Wed May 10 08:56:33 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 10 May 2023 02:56:33 -0400
Subject: [R-pkg-devel] Unfortunate function name generic.something
In-Reply-To: <9878B90C-A3CD-431C-A73E-615A53A0CB0C@R-project.org>
References: <37f4055e-8a32-d053-3e19-3a8c8b9a082f@bht-berlin.de>
 <CADNULg-AbELpZ7qmYmhK_PzMOuZwfpJC_tXFR-k8HqouC__smA@mail.gmail.com>
 <e40e8129-4559-93d6-ef03-2a399ce51c6a@bht-berlin.de>
 <60113484-624e-0d69-cf8b-d142cfdc484a@gmail.com>
 <7D81077A-93CA-4134-97AA-C336B27EC300@R-project.org>
 <d816507e-c043-403a-d029-85babaabd086@gmail.com>
 <9878B90C-A3CD-431C-A73E-615A53A0CB0C@R-project.org>
Message-ID: <126d9133-6612-183e-1fe6-a91d775c5e47@gmail.com>

On 09/05/2023 5:05 p.m., Simon Urbanek wrote:
> Duncan,
> 
> you're right that any functions in the call environment are always treated as methods (even before consulting method registrations). That is a special case - I presume for compatibility with the world before namespaces so that, e.g., you don't have to register methods in the global environment when working interactively. I wonder if that is something that packages could choose to opt out of for safety since they are already relying on method registration (and that would also in theory improve performance).
> 
> One interesting related issue is that in the current implementation of the method registration there is no concept of "private" methods (which is what the above rule effectively provides) since methods get registered with the generic, so they are either visible to everyone or not at all. If one would really want to support this, it would require a kind of "local" registration and then replacing the name-based search up the call chain with local registration search - but probably again at the cost of performance.

One possible implementation of this would be to register methods with an 
imported copy of the generic.

Duncan

> 
> Cheers,
> Simon
> 
> 
>> On May 9, 2023, at 11:23 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> On 08/05/2023 6:58 p.m., Simon Urbanek wrote:
>>>> On 8/05/2023, at 11:58 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>
>>>> There really isn't such a thing as "a function that looks like an S3 method, but isn't".  If it looks like an S3 method, then in the proper circumstances, it will be called as one.
>>>>
>>> I disagree - that was the case in old versions, but not anymore. The whole point of introducing namespaces and method registration was to make it clear when a function is a method and when it is a function. If you export a function it won't be treated as a method:
>>> In a package NAMESPACE:
>>> export(foo.cls)
>>> package R code: foo.cls <- function(x) "foo.cls"
>>> in R:
>>>> cls=structure(1,class="cls")
>>>> foo=function(x) UseMethod("foo")
>>>> foo(cls)
>>> Error in UseMethod("foo") :
>>>    no applicable method for 'foo' applied to an object of class "cls"
>>>> foo.cls(cls)
>>> [1] "foo.cls"
>>> So R knows very well what is a method and what is a function. If you wanted it to be a method, you have to use S3method(foo, cls) and that **is** different from export(foo.cls) - quite deliberately so.
>>
>> That is true for package users, but it's not true within the package.  I just tested this code in a package:
>>
>>   levels.no <- function(xx, ...) {
>>     stop("not a method")
>>   }
>>
>>   f <- function() {
>>     x <- structure(1, class = "no")
>>     levels(x)
>>   }
>>
>> Both levels.no and f were exported.  If I attach the package and call f(), I get the error
>>
>>   > library(testpkg)
>>   > f()
>>   Error in levels.no(x) : not a method
>>
>> because levels.no is being treated as a method when levels() is called in the package.
>>
>> If I create an x like that outside of the package and call levels(x) there, I get NULL, because levels.no is not being treated as a method in that context.
>>
>> As far as I know, there is no possible way to have a function in a package that is called "levels.no" and not being treated as a method within the package.  I don't think there's any way to declare "this is not a method", other than naming it differently.
>>
>> Duncan
>>
>>> Cheers,
>>> Simon
>>>> In your case the function name is levels.no, and it isn't exported.  So if you happen to have an object with a class inheriting from "no", and you call levels() on it, levels.no might be called.
>>>>
>>>> This will only affect users of your package indirectly.  If they have objects inheriting from "no" and call levels() on them, levels.no will not be called.  But if they pass such an object to one of your package functions, and that function calls levels() on it, they could end up calling levels.no().  It all depends on what other classes that object inherits from.
>>>>
>>>> You can test this yourself.  Set debugging on any one of your functions, then call it in the normal way.  Then while still in the debugger set debugging on levels.no, and create an object using
>>>>
>>>>   x <- structure(1, class = "no")
>>>>
>>>> and call levels(x).  You should break to the code of levels.no.
>>>>
>>>> That is why the WRE manual says "First, a caveat: a function named gen.cl will be invoked by the generic gen for class cl, so do not name functions in this style unless they are intended to be methods."
>>>>
>>>> So probably the best solution (even if inconvenient) is to rename levels.no to something that doesn't look like an S3 method.
>>>>
>>>> Duncan Murdoch
>>>>
>>>> On 08/05/2023 5:50 a.m., Ulrike Groemping wrote:
>>>>> Thank your for the solution attempt. However, using the keyword internal
>>>>> does not solve the problem, the note is still there. Any other proposals
>>>>> for properly documenting a function that looks like an S3 method, but isn't?
>>>>> Best, Ulrike
>>>>> Am 05.05.2023 um 12:56 schrieb Iris Simmons:
>>>>>> You can add
>>>>>>
>>>>>> \keyword{internal}
>>>>>>
>>>>>> to the Rd file. Your documentation won't show up the in the pdf
>>>>>> manual, it won't show up in the package index, but you'll still be
>>>>>> able to access the doc page with ?levels.no <http://levels.no> or
>>>>>> help("levels.no <http://levels.no>").
>>>>>>
>>>>>> This is usually used in a package's deprecated and defunct doc pages,
>>>>>> but you can use it anywhere.
>>>>>>
>>>>>> On Fri, May 5, 2023, 06:49 Ulrike Groemping
>>>>>> <ulrike.groemping at bht-berlin.de> wrote:
>>>>>>
>>>>>>      Dear package developeRs,
>>>>>>
>>>>>>      I am working on fixing some notes regarding package DoE.base.
>>>>>>      One note refers to the function levels.no <http://levels.no> and
>>>>>>      complains that the
>>>>>>      function is not documented as a method for the generic function
>>>>>>      levels.
>>>>>>      Actually, it is not a method for the generic levels, but a standalone
>>>>>>      internal function that I like to have documented.
>>>>>>
>>>>>>      Is there a way to document the function without renaming it and
>>>>>>      without
>>>>>>      triggering a note about method documentation?
>>>>>>
>>>>>>      Best, Ulrike
>>>>>>
>>>>>>      --
>>>>>>      ##############################################
>>>>>>      ## Prof. Ulrike Groemping
>>>>>>      ## FB II
>>>>>>      ## Berliner Hochschule f?r Technik (BHT)
>>>>>>      ##############################################
>>>>>>      ## prof.bht-berlin.de/groemping <http://prof.bht-berlin.de/groemping>
>>>>>>      ## Phone: +49(0)30 4504 5127
>>>>>>      ## Fax:   +49(0)30 4504 66 5127
>>>>>>      ## Home office: +49(0)30 394 04 863
>>>>>>      ##############################################
>>>>>>
>>>>>>      ______________________________________________
>>>>>>      R-package-devel at r-project.org mailing list
>>>>>>      https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>
>


From edd @end|ng |rom deb|@n@org  Wed May 10 14:01:37 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 10 May 2023 07:01:37 -0500
Subject: [R-pkg-devel] Please install cmake on macOS builders
Message-ID: <25691.34721.521790.758811@rob.eddelbuettel.com>


Simon,

Explicitly declaring

    SystemRequirements: cmake

appears to be insufficient to get a build on the (otherwise lovely to have)
'macOS builder', and leads to failure on (at least) 'r-oldrel-macos-x86_64'.

Would it be possible to actually have cmake installed?

These daus cmake is for better or worse becoming a standard, and I rely on it
for one (new) package to correctly configure a library. It would be nice to
be able to rely on it on macOS too.

Thanks,  Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Wed May 10 21:31:29 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 10 May 2023 21:31:29 +0200
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <25691.34721.521790.758811@rob.eddelbuettel.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
Message-ID: <25691.61713.694694.136591@stat.math.ethz.ch>

>>>>> Dirk Eddelbuettel 
>>>>>     on Wed, 10 May 2023 07:01:37 -0500 writes:

    > Simon,

    > Explicitly declaring

    > SystemRequirements: cmake

    > appears to be insufficient to get a build on the (otherwise lovely to have)
    > 'macOS builder', and leads to failure on (at least) 'r-oldrel-macos-x86_64'.

    > Would it be possible to actually have cmake installed?

    > These daus cmake is for better or worse becoming a standard, and I rely on it
    > for one (new) package to correctly configure a library. It would be nice to
    > be able to rely on it on macOS too.

Somewhat 'ditto' from here {about wanting 'cmake' to become +/-
standard tool for R packages use, *not* at all related to macOS} :

The SuiteSparse C library on parts of which our Matrix package
builds extensively  has also switched their setup to use  cmake
instead of make ... and this was actually one reason we have not
yet updated to the latest versions of SuiteSparse for the Matrix
package.

As Matrix is formally recommended, I would even be happy if
'cmake' became a +/- required OS tool for R ...

Martin

    > Thanks,  Dirk

    > -- 
    > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org

--
Martin Maechler
ETH Zurich  and  R Core team


From @|mon@urb@nek @end|ng |rom R-project@org  Wed May 10 22:35:44 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Thu, 11 May 2023 08:35:44 +1200
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <25691.34721.521790.758811@rob.eddelbuettel.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
Message-ID: <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>

Dirk,

can you be more specific, please? I suspect that it may be rather an issue in your package. All build machines have the official cmake releases installed and there are many packages that use it successfully. Here is the report on the currently installed versions. If you require more recent version, let me know.

high-sierra-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
cmake version 3.17.3

big-sur-arm64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
cmake version 3.19.4

mac-builder-arm64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
cmake version 3.21.2

big-sur-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
cmake version 3.26.0

Cheers,
Simon


> On May 11, 2023, at 12:01 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> Simon,
> 
> Explicitly declaring
> 
>    SystemRequirements: cmake
> 
> appears to be insufficient to get a build on the (otherwise lovely to have)
> 'macOS builder', and leads to failure on (at least) 'r-oldrel-macos-x86_64'.
> 
> Would it be possible to actually have cmake installed?
> 
> These daus cmake is for better or worse becoming a standard, and I rely on it
> for one (new) package to correctly configure a library. It would be nice to
> be able to rely on it on macOS too.
> 
> Thanks,  Dirk
> 
> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 


From r@c@rtwr|ght @end|ng |rom gm@||@com  Wed May 10 22:45:26 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 10 May 2023 13:45:26 -0700
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>
Message-ID: <CALOkxuwv4V7i4pZjF7yf=P8sS1QoFE-aa39x1iBDDA19hJSt7g@mail.gmail.com>

I use the following logic in my configure script to detect cmake on the
MacOS builders:

https://github.com/reedacartwright/rbedrock/blob/master/configure#L39-L49

I can't remember which package I borrowed this logic from. But it would be
nice if "Writing R Extensions" would expand their cmake section to cover
scenarios like this one.

While I would love to have something like CMake be better integrated into
CRAN, I've been using Meson (https://mesonbuild.com/) for a while and like
it better than CMake.

On Wed, May 10, 2023 at 1:36?PM Simon Urbanek <simon.urbanek at r-project.org>
wrote:

> Dirk,
>
> can you be more specific, please? I suspect that it may be rather an issue
> in your package. All build machines have the official cmake releases
> installed and there are many packages that use it successfully. Here is the
> report on the currently installed versions. If you require more recent
> version, let me know.
>
> high-sierra-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version |
> head -n1
> cmake version 3.17.3
>
> big-sur-arm64$ /Applications/CMake.app/Contents/bin/cmake --version | head
> -n1
> cmake version 3.19.4
>
> mac-builder-arm64$ /Applications/CMake.app/Contents/bin/cmake --version |
> head -n1
> cmake version 3.21.2
>
> big-sur-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version |
> head -n1
> cmake version 3.26.0
>
> Cheers,
> Simon
>
>
> > On May 11, 2023, at 12:01 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> >
> >
> > Simon,
> >
> > Explicitly declaring
> >
> >    SystemRequirements: cmake
> >
> > appears to be insufficient to get a build on the (otherwise lovely to
> have)
> > 'macOS builder', and leads to failure on (at least)
> 'r-oldrel-macos-x86_64'.
> >
> > Would it be possible to actually have cmake installed?
> >
> > These daus cmake is for better or worse becoming a standard, and I rely
> on it
> > for one (new) package to correctly configure a library. It would be nice
> to
> > be able to rely on it on macOS too.
> >
> > Thanks,  Dirk
> >
> > --
> > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!ZDzGKYSqloADeChMhl8e4QHq-S3hUWkUGBtFZOu3doH2FLaAb8quWzpo_Tbdn_aWQQY8VByJNGkqqGRXVa1gFD_cRjF7$
>

	[[alternative HTML version deleted]]


From r@c@rtwr|ght @end|ng |rom gm@||@com  Wed May 10 22:51:34 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Wed, 10 May 2023 13:51:34 -0700
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <CALOkxuwv4V7i4pZjF7yf=P8sS1QoFE-aa39x1iBDDA19hJSt7g@mail.gmail.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>
 <CALOkxuwv4V7i4pZjF7yf=P8sS1QoFE-aa39x1iBDDA19hJSt7g@mail.gmail.com>
Message-ID: <CALOkxuw6LSqxOkCTrEZgPATAD3OojGgFNTrMHeABYqN_UzSSZw@mail.gmail.com>

> But it would be nice if "Writing R Extensions" would expand their cmake
section to cover scenarios like this one.

Now that I double check, I see that it is mentioned at the end of the CMake
section. So I guess, the only way to improve the section would be to
include a link to a complete example script that includes all the bells and
whistles needed to get CMake running with R.

On Wed, May 10, 2023 at 1:45?PM Reed A. Cartwright <racartwright at gmail.com>
wrote:

> I use the following logic in my configure script to detect cmake on the
> MacOS builders:
>
> https://github.com/reedacartwright/rbedrock/blob/master/configure#L39-L49
>
> I can't remember which package I borrowed this logic from. But it would be
> nice if "Writing R Extensions" would expand their cmake section to cover
> scenarios like this one.
>
> While I would love to have something like CMake be better integrated into
> CRAN, I've been using Meson (https://mesonbuild.com/) for a while and
> like it better than CMake.
>
> On Wed, May 10, 2023 at 1:36?PM Simon Urbanek <simon.urbanek at r-project.org>
> wrote:
>
>> Dirk,
>>
>> can you be more specific, please? I suspect that it may be rather an
>> issue in your package. All build machines have the official cmake releases
>> installed and there are many packages that use it successfully. Here is the
>> report on the currently installed versions. If you require more recent
>> version, let me know.
>>
>> high-sierra-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version
>> | head -n1
>> cmake version 3.17.3
>>
>> big-sur-arm64$ /Applications/CMake.app/Contents/bin/cmake --version |
>> head -n1
>> cmake version 3.19.4
>>
>> mac-builder-arm64$ /Applications/CMake.app/Contents/bin/cmake --version |
>> head -n1
>> cmake version 3.21.2
>>
>> big-sur-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version |
>> head -n1
>> cmake version 3.26.0
>>
>> Cheers,
>> Simon
>>
>>
>> > On May 11, 2023, at 12:01 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
>> >
>> >
>> > Simon,
>> >
>> > Explicitly declaring
>> >
>> >    SystemRequirements: cmake
>> >
>> > appears to be insufficient to get a build on the (otherwise lovely to
>> have)
>> > 'macOS builder', and leads to failure on (at least)
>> 'r-oldrel-macos-x86_64'.
>> >
>> > Would it be possible to actually have cmake installed?
>> >
>> > These daus cmake is for better or worse becoming a standard, and I rely
>> on it
>> > for one (new) package to correctly configure a library. It would be
>> nice to
>> > be able to rely on it on macOS too.
>> >
>> > Thanks,  Dirk
>> >
>> > --
>> > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>> >
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>>
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!ZDzGKYSqloADeChMhl8e4QHq-S3hUWkUGBtFZOu3doH2FLaAb8quWzpo_Tbdn_aWQQY8VByJNGkqqGRXVa1gFD_cRjF7$
>>
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Wed May 10 22:59:22 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 10 May 2023 15:59:22 -0500
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>
Message-ID: <25692.1450.305458.556360@rob.eddelbuettel.com>


Simon,

On 11 May 2023 at 08:35, Simon Urbanek wrote:
| Dirk,
| 
| can you be more specific, please? I suspect that it may be rather an issue in your package. All build machines have the official cmake releases installed and there are many packages that use it successfully. Here is the report on the currently installed versions. If you require more recent version, let me know.
| 
| high-sierra-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
| cmake version 3.17.3
| 
| big-sur-arm64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
| cmake version 3.19.4
| 
| mac-builder-arm64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
| cmake version 3.21.2
| 
| big-sur-x86_64$ /Applications/CMake.app/Contents/bin/cmake --version | head -n1
| cmake version 3.26.0

edd at rob:/tmp/lib/big-sur-arm64/results/4.3/crc32c.Rcheck$ cat 00install.out 
* installing *source* package ?crc32c? ...
** using staged installation
** libs
using C compiler: ?Apple clang version 14.0.3 (clang-1403.0.22.14.1)?
using C++ compiler: ?Apple clang version 14.0.3 (clang-1403.0.22.14.1)?
using SDK: ?MacOSX11.3.sdk?
mkdir crc32c/build && \
                cd crc32c/build && \
                cmake .. && \
                make all && \
                cp -v libcrc32c.a .. && \
                rm -rf *
/bin/sh: cmake: command not found
make: *** [crc32c/libcrc32c.a] Error 127
ERROR: compilation failed for package ?crc32c?
* removing ?/Volumes/PkgBuild/work/1683752001-f31a3e60d7ec0840/packages/big-sur-arm64/results/4.3/crc32c.Rcheck/crc32c?
edd at rob:/tmp/lib/big-sur-arm64/results/4.3/crc32c.Rcheck$ 

That's from the downloaded 'results.tar.bz2' you offer.  Top-level URL is

  https://mac.r-project.org/macbuilder/results/1683752001-f31a3e60d7ec0840/

Most of my shell understanding is based on the understanding that calling
something as 'cmake' should work if a 'cmake' is installed. Yet:

  /bin/sh: cmake: command not found

seems to point more at your system than at me.  I don't do any $PATH setting
or resetting. Does something else get in the way? macOS has surprised me
before so maybe you can offer a hint.

Hth, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd @end|ng |rom deb|@n@org  Wed May 10 23:02:12 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 10 May 2023 16:02:12 -0500
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <CALOkxuwv4V7i4pZjF7yf=P8sS1QoFE-aa39x1iBDDA19hJSt7g@mail.gmail.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>
 <CALOkxuwv4V7i4pZjF7yf=P8sS1QoFE-aa39x1iBDDA19hJSt7g@mail.gmail.com>
Message-ID: <25692.1620.353469.332696@rob.eddelbuettel.com>


On 10 May 2023 at 13:45, Reed A. Cartwright wrote:
| I use the following logic in my configure script to detect cmake on the MacOS
| builders:
| 
| https://github.com/reedacartwright/rbedrock/blob/master/configure#L39-L49

Nice. That was entirely undocumented.  What a dance.  It should help.
 
| I can't remember which package I borrowed this logic from. But it would be nice
| if "Writing R Extensions" would expand their cmake section to cover scenarios
| like this one.

Yep.
 
| While I would love to have something like CMake be better integrated into CRAN,
| I've been using Meson (https://mesonbuild.com/) for a while and like it better
| than CMake.

"The thing about 15 standards is ..." paraphrasing xkcd. Use of cmake often
comes with a library these days so your or my preference is sadly mostly
irrelevant in the matter :-/

Thanks for the snippet though. I shall try that. Adding it to WRE would
indeed be a good idea.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From edd @end|ng |rom deb|@n@org  Wed May 10 23:40:01 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 10 May 2023 16:40:01 -0500
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <25692.1620.353469.332696@rob.eddelbuettel.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <8B55E8A3-C847-4D66-85DE-06AF970C89DC@R-project.org>
 <CALOkxuwv4V7i4pZjF7yf=P8sS1QoFE-aa39x1iBDDA19hJSt7g@mail.gmail.com>
 <25692.1620.353469.332696@rob.eddelbuettel.com>
Message-ID: <25692.3889.328338.759429@rob.eddelbuettel.com>


On 10 May 2023 at 16:02, Dirk Eddelbuettel wrote:
| 
| On 10 May 2023 at 13:45, Reed A. Cartwright wrote:
| | I use the following logic in my configure script to detect cmake on the MacOS
| | builders:
| | 
| | https://github.com/reedacartwright/rbedrock/blob/master/configure#L39-L49
| 
| Nice. That was entirely undocumented.  What a dance.  It should help.

It did. I had (minimal) logic in src/Makevars to make a static lib via cmake;
I now moved that up into a new script configure where I used your snippet to
find cmake "even if I find myself surrounded by macOS". And with that things
work. So thanks for the help.

We can discuss at length if providing something in a path you cannot know ex
ante know comprises "providing" something -- but I guess Simon was right that
his machine had cmake. Only that I didn't know where it was. Ah well.

But that is unplugged now, as is a mistake I had made in the CMakeLists.txt
adaptation for a static-only build. Which only gcc-13 found so all good for
another upload soon.

Thanks again!

Cheers, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From ru@@e||-|enth @end|ng |rom u|ow@@edu  Thu May 11 04:49:43 2023
From: ru@@e||-|enth @end|ng |rom u|ow@@edu (Lenth, Russell V)
Date: Thu, 11 May 2023 02:49:43 +0000
Subject: [R-pkg-devel] Unneeded S3 method registration
Message-ID: <DM6PR04MB4474A688663F3BDEE76D2553F1749@DM6PR04MB4474.namprd04.prod.outlook.com>

Dear R package developers

My emmeans package failed preliminary checks when I submitted an update today, apparently due to a recent change in requirements on method registration. The message I got was:

* checking S3 generic/method consistency ... NOTE
Apparent methods for exported generics not registered:
  emm_basis.Gam emm_basis.MCMCglmm emm_basis.averaging
  emm_basis.betareg emm_basis.brmsfit emm_basis.carbayes emm_basis.clm
  emm_basis.clmm emm_basis.coxme emm_basis.coxph emm_basis.default
  emm_basis.gam emm_basis.gamlss emm_basis.gamm emm_basis.gee
  emm_basis.geeglm emm_basis.geese emm_basis.gls emm_basis.gnls
  emm_basis.hurdle emm_basis.lqm emm_basis.lqmm emm_basis.mblogit
  emm_basis.mcmc emm_basis.mcmc.list emm_basis.mira emm_basis.mmer
  emm_basis.multinom emm_basis.nlme emm_basis.nls emm_basis.polr
  emm_basis.qdrg emm_basis.rms emm_basis.rq emm_basis.rqs
  emm_basis.stanreg emm_basis.survreg emm_basis.svyolr
  emm_basis.zeroinfl recover_data.MCMCglmm recover_data.averaging
  recover_data.betareg recover_data.brmsfit recover_data.carbayes
  recover_data.clm recover_data.clmm recover_data.coxme
  recover_data.coxph recover_data.default recover_data.gam
  recover_data.gamlss recover_data.gamm recover_data.gee
  recover_data.geeglm recover_data.geese recover_data.gls
  recover_data.gnls recover_data.hurdle recover_data.lqm
  recover_data.lqmm recover_data.manova recover_data.mblogit
  recover_data.mcmc recover_data.mcmc.list recover_data.mira
  recover_data.mmer recover_data.multinom recover_data.nlme
  recover_data.nls recover_data.polr recover_data.qdrg recover_data.rms
  recover_data.rq recover_data.rqs recover_data.stanreg
  recover_data.survreg recover_data.svyglm recover_data.svyolr
  recover_data.zeroinfl
See section 'Registering S3 methods' in the 'Writing R Extensions'
manual.

I guess my question is "why does this matter?" There are many, many functions mentioned here, but they are all methods for emm_basis and recover_data. Both generics are in the emmeans namespace, as are all these functions.

The section on registering S3 methods explains:

> The standard method for S3-style UseMethod dispatching might fail to locate methods defined in a package that is imported but not attached to the search path. To ensure that these methods are available the packages defining the methods should ensure that the generics are imported and register the methods using S3method directives...

But clearly all those methods flagged in the messages will be found in the same namespace as the generics -- emm_basis and recover_data -- so not being able to find them is not an issue. Moreover, emm_basis() and recover_data() are not meant to be called directly by a user, or even by code in another package. They are only meant to be called within the function emmeans::ref_grid(), and the existence of those generics and methods is simply a mechanism for being able to support a lot of different model classes.

Obviously, I could add a whole lot of S3method() directives to the NAMESPACE file, but it just seems wasteful to export all those methods when they are never needed outside the emmeans namespace.

Am I missing something?

Thanks

Russ Lenth



	[[alternative HTML version deleted]]


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu May 11 09:02:33 2023
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 11 May 2023 09:02:33 +0200
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <25691.61713.694694.136591@stat.math.ethz.ch>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <25691.61713.694694.136591@stat.math.ethz.ch>
Message-ID: <25692.37641.759470.866071@stat.math.ethz.ch>

>>>>> Martin Maechler 
>>>>>     on Wed, 10 May 2023 21:31:29 +0200 writes:

  >>>>> Dirk Eddelbuettel 
  >>>>>     on Wed, 10 May 2023 07:01:37 -0500 writes:

	>> Simon,

	>> Explicitly declaring

	>> SystemRequirements: cmake

	>> appears to be insufficient to get a build on the
	>> (otherwise lovely to have) 'macOS builder', and leads to
	>> failure on (at least) 'r-oldrel-macos-x86_64'.

	>> Would it be possible to actually have cmake installed?

	>> These daus cmake is for better or worse becoming a
	>> standard, and I rely on it for one (new) package to
	>> correctly configure a library. It would be nice to be
	>> able to rely on it on macOS too.

    > Somewhat 'ditto' from here {about wanting 'cmake' to
    > become +/- standard tool for R packages use, *not* at all
    > related to macOS} :

    > The SuiteSparse C library on parts of which our Matrix
    > package builds extensively has also switched their setup
    > to use cmake instead of make ... and this was actually one
    > reason we have not yet updated to the latest versions of
    > SuiteSparse for the Matrix package.

    > As Matrix is formally recommended, I would even be happy
    > if 'cmake' became a +/- required OS tool for R ...

I've been told in private that the above "be happy if"
may *not* be a good idea,
or rather even close to impossible as   cmake  seems to not fit
well, at all, with the quite sophisticated
    autoconf -> configure -> make
setup we have with building R + recommended packages
cross-platform compatibly as well as possible.

Martin


--
Martin Maechler ETH Zurich and R Core team


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu May 11 10:58:17 2023
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 11 May 2023 04:58:17 -0400
Subject: [R-pkg-devel] Unneeded S3 method registration
In-Reply-To: <DM6PR04MB4474A688663F3BDEE76D2553F1749@DM6PR04MB4474.namprd04.prod.outlook.com>
References: <DM6PR04MB4474A688663F3BDEE76D2553F1749@DM6PR04MB4474.namprd04.prod.outlook.com>
Message-ID: <944b549e-158f-f864-7072-e021823e65d2@gmail.com>

The problem is that there's no way to declare that an internal function 
should or shouldn't be treated as an S3 method, other than by declaring 
it as one in NAMESPACE and exporting it.  If you read the thread 
"Unfortunate function name generic.something?" that started last week, 
you'll see the opposing problem to yours:  a local function named 
levels.no that isn't intended to be an S3 method, but will be treated as 
one in some circumstances.

You do export emm_basis and recover_data, so those generics are 
available to users.  And you do declare some of the methods, e.g. in 
emmeans 1.8.5, users can see methods for some classes:

 > methods("emm_basis")
[1] emm_basis.aovlist* emm_basis.lm*      emm_basis.lme* 
emm_basis.merMod*  emm_basis.mlm*

As the message below says, you don't declare emm_basis.Gam to be a 
method, which means that a user with a Gam object who calls emm_basis 
will get the default method instead, whereas when code in your package 
calls it, they'll get the Gam method.

You say users should never call emm_basis directly, but package 
developers should provide methods for it.  At a minimum that's going to 
make debugging those packages much more confusing.  And if they have a 
class which inherits from Gam and want to call the inherited method, 
they won't get it.

So I think in this case the NOTE is something you should fix.

Duncan Murdoch

On 10/05/2023 10:49 p.m., Lenth, Russell V wrote:
> Dear R package developers
> 
> My emmeans package failed preliminary checks when I submitted an update today, apparently due to a recent change in requirements on method registration. The message I got was:
> 
> * checking S3 generic/method consistency ... NOTE
> Apparent methods for exported generics not registered:
>    emm_basis.Gam emm_basis.MCMCglmm emm_basis.averaging
>    emm_basis.betareg emm_basis.brmsfit emm_basis.carbayes emm_basis.clm
>    emm_basis.clmm emm_basis.coxme emm_basis.coxph emm_basis.default
>    emm_basis.gam emm_basis.gamlss emm_basis.gamm emm_basis.gee
>    emm_basis.geeglm emm_basis.geese emm_basis.gls emm_basis.gnls
>    emm_basis.hurdle emm_basis.lqm emm_basis.lqmm emm_basis.mblogit
>    emm_basis.mcmc emm_basis.mcmc.list emm_basis.mira emm_basis.mmer
>    emm_basis.multinom emm_basis.nlme emm_basis.nls emm_basis.polr
>    emm_basis.qdrg emm_basis.rms emm_basis.rq emm_basis.rqs
>    emm_basis.stanreg emm_basis.survreg emm_basis.svyolr
>    emm_basis.zeroinfl recover_data.MCMCglmm recover_data.averaging
>    recover_data.betareg recover_data.brmsfit recover_data.carbayes
>    recover_data.clm recover_data.clmm recover_data.coxme
>    recover_data.coxph recover_data.default recover_data.gam
>    recover_data.gamlss recover_data.gamm recover_data.gee
>    recover_data.geeglm recover_data.geese recover_data.gls
>    recover_data.gnls recover_data.hurdle recover_data.lqm
>    recover_data.lqmm recover_data.manova recover_data.mblogit
>    recover_data.mcmc recover_data.mcmc.list recover_data.mira
>    recover_data.mmer recover_data.multinom recover_data.nlme
>    recover_data.nls recover_data.polr recover_data.qdrg recover_data.rms
>    recover_data.rq recover_data.rqs recover_data.stanreg
>    recover_data.survreg recover_data.svyglm recover_data.svyolr
>    recover_data.zeroinfl
> See section 'Registering S3 methods' in the 'Writing R Extensions'
> manual.
> 
> I guess my question is "why does this matter?" There are many, many functions mentioned here, but they are all methods for emm_basis and recover_data. Both generics are in the emmeans namespace, as are all these functions.
> 
> The section on registering S3 methods explains:
> 
>> The standard method for S3-style UseMethod dispatching might fail to locate methods defined in a package that is imported but not attached to the search path. To ensure that these methods are available the packages defining the methods should ensure that the generics are imported and register the methods using S3method directives...
> 
> But clearly all those methods flagged in the messages will be found in the same namespace as the generics -- emm_basis and recover_data -- so not being able to find them is not an issue. Moreover, emm_basis() and recover_data() are not meant to be called directly by a user, or even by code in another package. They are only meant to be called within the function emmeans::ref_grid(), and the existence of those generics and methods is simply a mechanism for being able to support a lot of different model classes.
> 
> Obviously, I could add a whole lot of S3method() directives to the NAMESPACE file, but it just seems wasteful to export all those methods when they are never needed outside the emmeans namespace.
> 
> Am I missing something?
> 
> Thanks
> 
> Russ Lenth
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Thu May 11 13:16:19 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 11 May 2023 06:16:19 -0500
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <25692.37641.759470.866071@stat.math.ethz.ch>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <25691.61713.694694.136591@stat.math.ethz.ch>
 <25692.37641.759470.866071@stat.math.ethz.ch>
Message-ID: <25692.52867.527375.152408@rob.eddelbuettel.com>


On 11 May 2023 at 09:02, Martin Maechler wrote:
| I've been told in private that the above "be happy if"
| may *not* be a good idea,
| or rather even close to impossible as   cmake  seems to not fit
| well, at all, with the quite sophisticated
|     autoconf -> configure -> make
| setup we have with building R + recommended packages
| cross-platform compatibly as well as possible.

Yes, my bad -- it _is_ indeed in Writing R Extensions (albeit with an
actual error, see below) so I now use what it recommended (in the form
pointed out by Reed though) so for me it is

    sh -> make -> cmake

but could be autoconf too.

I presume the macOS systems needs it for cross-compilation or other dances.
Still annoying as hell.  A simple default may be better but I do not know any
of the dragons running around inside macOS.

Dirk


Appendix: Actual Error in Writing R Extensions.

Section 1.2.6 ends on these lines (r-release, and r-devel) I am quoting in full

    One way to work around this is for the package?s ?configure? script to
    include
         if test -z "$CMAKE"; then CMAKE="`which cmake`"; fi
         if test -z "$CMAKE"; then CMAKE=/Applications/CMake.app/Contents/bin/cmake; fi
         if test -f "$CMAKE"; then echo "no 'cmake' command found"; exit 1; fi
    and for the second approach to substitute ?CMAKE? into ?src//Makevars?.

The final 'test -f' has to be negated. Demo:

    edd at rob:/tmp$ cat foo.sh 
    ##!/bin/sh
    if test -z "$CMAKE"; then CMAKE="`which cmake`"; fi
    if test -z "$CMAKE"; then CMAKE=/Applications/CMake.app/Contents/bin/cmake; fi
    if test -f "$CMAKE"; then echo "no 'cmake' command found"; exit 1; fi
    echo "** using $CMAKE"
    edd at rob:/tmp$ ./foo.sh 
    no 'cmake' command found
    edd at rob:/tmp$ which cmake
    /usr/bin/cmake
    edd at rob:/tmp$ 

If I change foo.sh to use '! test -f' all is well

    edd at rob:/tmp$ be foo.sh    # be is an alias for emacsclient in tty mode
    edd at rob:/tmp$ ./foo.sh 
    ** using /usr/bin/cmake
    edd at rob:/tmp$ 

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From no@h@gre||er @end|ng |rom gm@||@com  Thu May 11 20:11:56 2023
From: no@h@gre||er @end|ng |rom gm@||@com (Noah Greifer)
Date: Thu, 11 May 2023 14:11:56 -0400
Subject: [R-pkg-devel] Inconsistent functionality of c++ code in MatchIt
Message-ID: <CAPhhD8=o8dZZFBH7FeLe0gWSdBz=b+JNKj+7+tosjqxDGJX+HQ@mail.gmail.com>

Hello,

I'm the mainter of the package *MatchIt*, which uses *Rcpp* to implement
nearest neighbor matching. One way to customize nearest neighbor
matching is to add a caliper, which is the largest distance two units can
be from each other before they are not allowed to be matched. I've had some
users complain recently that the caliper is not working for them, i.e.,
even after specifying a caliper, units are being matched who are
farther apart then the caliper width. I have been unable to replicate this
problem on my Mac; the caliper always works as intended.

One user noted that even when using the same package version, the
performance varied across two machines: one obeyed the caliper and one
didn't. I thought this might be related to the version of R installed, as
for some users updating R fixed the issue, but for others it didn't. I'm
kind of at a loss.

I have a suspicion that the problem is related to the function abs() in the
C++ functions find_right() and find_left() that I wrote to perform the
matching, which are in nn_match_vec.cpp
<https://github.com/kosukeimai/MatchIt/blob/master/src/nn_matchC_vec.cpp>.
I have had problems with abs() before (seemingly related to a namespace
conflict between std and Rcpp). In this case, abs() is used in the
following way:

if (abs(distance[ii] - distance[k]) > caliper_dist) {
    //if closest is outside caliper, break; none can be found
    break;
 }

Here, distance is a NumericVector, and ii and k are ints. My expectation is
that this would dispatch to std::abs() with a double as its input. It's
possible something is going wrong there. I'm wondering if this has to do
with recent changes to R's C++ engine or compilers.

If you want to run code to test whether the caliper is working correctly on
your machine, you can run the following code:

install.packages("MatchIt")
data("lalonde", package = "MatchIt")
m <- MatchIt::matchit(treat ~ age + educ + race + re74,
                      data = lalonde, caliper = .01)
summary(m)$nn

If the caliper is working correctly, you should see a small matrix that has
the row

Matched            88      88

If not, you would see the row

Matched           185     185

The GitHub issue of people complaining about this is here
<https://github.com/kosukeimai/MatchIt/issues/163> along with their
explanations about versions of *MatchIt* and R. The package code is also
there.

Any thoughts or insights about this would really help! Thank you so much!

Noah

	[[alternative HTML version deleted]]


From r@c@rtwr|ght @end|ng |rom gm@||@com  Thu May 11 20:15:50 2023
From: r@c@rtwr|ght @end|ng |rom gm@||@com (Reed A. Cartwright)
Date: Thu, 11 May 2023 11:15:50 -0700
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <25692.52867.527375.152408@rob.eddelbuettel.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <25691.61713.694694.136591@stat.math.ethz.ch>
 <25692.37641.759470.866071@stat.math.ethz.ch>
 <25692.52867.527375.152408@rob.eddelbuettel.com>
Message-ID: <CALOkxuym-etr-B_bv1bd+KjuUKo2ApVYgfa4fKG5hp5ZusonfA@mail.gmail.com>

Dirk,

I'm curious why you chose to call cmake from make instead of from
configure. I've always seen cmake as part of the configure step of package
building.

Thanks,
Reed


On Thu, May 11, 2023, 04:17 Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 11 May 2023 at 09:02, Martin Maechler wrote:
> | I've been told in private that the above "be happy if"
> | may *not* be a good idea,
> | or rather even close to impossible as   cmake  seems to not fit
> | well, at all, with the quite sophisticated
> |     autoconf -> configure -> make
> | setup we have with building R + recommended packages
> | cross-platform compatibly as well as possible.
>
> Yes, my bad -- it _is_ indeed in Writing R Extensions (albeit with an
> actual error, see below) so I now use what it recommended (in the form
> pointed out by Reed though) so for me it is
>
>     sh -> make -> cmake
>
> but could be autoconf too.
>
> I presume the macOS systems needs it for cross-compilation or other dances.
> Still annoying as hell.  A simple default may be better but I do not know
> any
> of the dragons running around inside macOS.
>
> Dirk
>
>
> Appendix: Actual Error in Writing R Extensions.
>
> Section 1.2.6 ends on these lines (r-release, and r-devel) I am quoting in
> full
>
>     One way to work around this is for the package?s ?configure? script to
>     include
>          if test -z "$CMAKE"; then CMAKE="`which cmake`"; fi
>          if test -z "$CMAKE"; then
> CMAKE=/Applications/CMake.app/Contents/bin/cmake; fi
>          if test -f "$CMAKE"; then echo "no 'cmake' command found"; exit
> 1; fi
>     and for the second approach to substitute ?CMAKE? into ?src//Makevars?.
>
> The final 'test -f' has to be negated. Demo:
>
>     edd at rob:/tmp$ cat foo.sh
>     ##!/bin/sh
>     if test -z "$CMAKE"; then CMAKE="`which cmake`"; fi
>     if test -z "$CMAKE"; then
> CMAKE=/Applications/CMake.app/Contents/bin/cmake; fi
>     if test -f "$CMAKE"; then echo "no 'cmake' command found"; exit 1; fi
>     echo "** using $CMAKE"
>     edd at rob:/tmp$ ./foo.sh
>     no 'cmake' command found
>     edd at rob:/tmp$ which cmake
>     /usr/bin/cmake
>     edd at rob:/tmp$
>
> If I change foo.sh to use '! test -f' all is well
>
>     edd at rob:/tmp$ be foo.sh    # be is an alias for emacsclient in tty
> mode
>     edd at rob:/tmp$ ./foo.sh
>     ** using /usr/bin/cmake
>     edd at rob:/tmp$
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-package-devel__;!!IKRxdwAv5BmarQ!cx5EOr8qi2w5dP-kdo90tRXU4I7VjWDeD19I3UQxXe1hCHor7wP-FBUn5gzg8PFkdlerFTrGD0uL$
>

	[[alternative HTML version deleted]]


From w||||@mwdun|@p @end|ng |rom gm@||@com  Thu May 11 20:49:55 2023
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Thu, 11 May 2023 11:49:55 -0700
Subject: [R-pkg-devel] Inconsistent functionality of c++ code in MatchIt
In-Reply-To: <CAPhhD8=o8dZZFBH7FeLe0gWSdBz=b+JNKj+7+tosjqxDGJX+HQ@mail.gmail.com>
References: <CAPhhD8=o8dZZFBH7FeLe0gWSdBz=b+JNKj+7+tosjqxDGJX+HQ@mail.gmail.com>
Message-ID: <CAHqSRuRJR4-vB4k5=Tgp+93d1p9ifxZzKgS-Gs2c4z7Chryq5Q@mail.gmail.com>

I see the problem when I compile the C++ code on Ubuntu 20.04 and the
latest R-devel with
   C++ compiler: ?g++ (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0
If I change all the unadorned 'abs' calls in src/nn_matchC_vec.cpp with the
prefix 'std::' the problem goes away.

-Bill


On Thu, May 11, 2023 at 11:12?AM Noah Greifer <noah.greifer at gmail.com>
wrote:

> Hello,
>
> I'm the mainter of the package *MatchIt*, which uses *Rcpp* to implement
> nearest neighbor matching. One way to customize nearest neighbor
> matching is to add a caliper, which is the largest distance two units can
> be from each other before they are not allowed to be matched. I've had some
> users complain recently that the caliper is not working for them, i.e.,
> even after specifying a caliper, units are being matched who are
> farther apart then the caliper width. I have been unable to replicate this
> problem on my Mac; the caliper always works as intended.
>
> One user noted that even when using the same package version, the
> performance varied across two machines: one obeyed the caliper and one
> didn't. I thought this might be related to the version of R installed, as
> for some users updating R fixed the issue, but for others it didn't. I'm
> kind of at a loss.
>
> I have a suspicion that the problem is related to the function abs() in the
> C++ functions find_right() and find_left() that I wrote to perform the
> matching, which are in nn_match_vec.cpp
> <https://github.com/kosukeimai/MatchIt/blob/master/src/nn_matchC_vec.cpp>.
> I have had problems with abs() before (seemingly related to a namespace
> conflict between std and Rcpp). In this case, abs() is used in the
> following way:
>
> if (abs(distance[ii] - distance[k]) > caliper_dist) {
>     //if closest is outside caliper, break; none can be found
>     break;
>  }
>
> Here, distance is a NumericVector, and ii and k are ints. My expectation is
> that this would dispatch to std::abs() with a double as its input. It's
> possible something is going wrong there. I'm wondering if this has to do
> with recent changes to R's C++ engine or compilers.
>
> If you want to run code to test whether the caliper is working correctly on
> your machine, you can run the following code:
>
> install.packages("MatchIt")
> data("lalonde", package = "MatchIt")
> m <- MatchIt::matchit(treat ~ age + educ + race + re74,
>                       data = lalonde, caliper = .01)
> summary(m)$nn
>
> If the caliper is working correctly, you should see a small matrix that has
> the row
>
> Matched            88      88
>
> If not, you would see the row
>
> Matched           185     185
>
> The GitHub issue of people complaining about this is here
> <https://github.com/kosukeimai/MatchIt/issues/163> along with their
> explanations about versions of *MatchIt* and R. The package code is also
> there.
>
> Any thoughts or insights about this would really help! Thank you so much!
>
> Noah
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From no@h@gre||er @end|ng |rom gm@||@com  Thu May 11 21:29:51 2023
From: no@h@gre||er @end|ng |rom gm@||@com (Noah Greifer)
Date: Thu, 11 May 2023 15:29:51 -0400
Subject: [R-pkg-devel] Inconsistent functionality of c++ code in MatchIt
In-Reply-To: <CAHqSRuRJR4-vB4k5=Tgp+93d1p9ifxZzKgS-Gs2c4z7Chryq5Q@mail.gmail.com>
References: <CAPhhD8=o8dZZFBH7FeLe0gWSdBz=b+JNKj+7+tosjqxDGJX+HQ@mail.gmail.com>
 <CAHqSRuRJR4-vB4k5=Tgp+93d1p9ifxZzKgS-Gs2c4z7Chryq5Q@mail.gmail.com>
Message-ID: <CAPhhD8nu1e=MwcDYc8hb4_BjqX5+9O-AqOoKhRQBhCKUzBfrCg@mail.gmail.com>

I want to thank Bill and everyone that reached out to me individually. It
looks like Bill's solution is the right one, as he was able to replicate
and fix the problem. I am still a bit confused on why this would occur on
some OSs and not others (probably due to different compilers), but I think
the solution is just writing explicit, robust code that should always work.
Thank you!

Noah

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Thu May 11 22:36:42 2023
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 11 May 2023 15:36:42 -0500
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <CALOkxuym-etr-B_bv1bd+KjuUKo2ApVYgfa4fKG5hp5ZusonfA@mail.gmail.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <25691.61713.694694.136591@stat.math.ethz.ch>
 <25692.37641.759470.866071@stat.math.ethz.ch>
 <25692.52867.527375.152408@rob.eddelbuettel.com>
 <CALOkxuym-etr-B_bv1bd+KjuUKo2ApVYgfa4fKG5hp5ZusonfA@mail.gmail.com>
Message-ID: <25693.20954.566598.812151@rob.eddelbuettel.com>


Hi Reed,

On 11 May 2023 at 11:15, Reed A. Cartwright wrote:
| I'm curious why you chose to call cmake from make instead of from configure.
| I've always seen cmake as part of the configure step of package building.

Great question! Couple of small answers: i) This started as a 'proof of
concept' that aimed to be small so getting by without requiring `configure`
seemed worth a try, ii) I had seen another src/Makevars invoking compilation
of a static library in a similar (albeit non-cmake) way and iii) as we now
know about section 1.2.6 (or soon 1.2.9) 'Using cmake' has it that way too.

Otherwise I quite like having `configure` and I frequently use it -- made
from 'genuine' configire.in via `autoconf`, or as scripts in shell or other
languages.

Cheers, Dirk

PS My repaired package is now on CRAN. I managed to bungle the static library
build (by not telling `cmake` to use position independent code), bungled
macOS but not telling myself where `cmake` could live, and in fixing that
bungled Windows by forgetting to add `src/Makevars.win` fallback. Yay me.

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @|mon@urb@nek @end|ng |rom R-project@org  Fri May 12 05:51:21 2023
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Fri, 12 May 2023 15:51:21 +1200
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <25693.20954.566598.812151@rob.eddelbuettel.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <25691.61713.694694.136591@stat.math.ethz.ch>
 <25692.37641.759470.866071@stat.math.ethz.ch>
 <25692.52867.527375.152408@rob.eddelbuettel.com>
 <CALOkxuym-etr-B_bv1bd+KjuUKo2ApVYgfa4fKG5hp5ZusonfA@mail.gmail.com>
 <25693.20954.566598.812151@rob.eddelbuettel.com>
Message-ID: <3DA9BC4C-BDE8-4416-A5EC-39D1C9C5D086@R-project.org>

I think it would be quite useful to have some community repository of code snippets dealing with such situations. R-exts gives advice and pieces of code which are useful, but they are not complete solutions and situations like Dirk's example are not that uncommon. (E.g., I recall some of the spatial packages copy/pasting code from each other for quote some time - which works, but is error prone if changes need to be made).

If one has to rely on a 3rd party library and one wants to fall back to source compilation when it is not available, it is a quite complex task, because one has to match the library's build system to R's and the package build rules as well. There are many ways where this can go wrong - Dirk mentioned some of them - and ideally not every package developer in that situation should be going through the pain of learning all the details the hard way.

Of course there are other packages as an example, but for someone not familiar with the details it's hard to see which ones do it right, and which ones don't - we don't always catch all the bad cases on CRAN.

I don't have a specific proposal, but if there was a GitHub repo or wiki or something to try to distill the useful bits from existing packages, I'd be happy to review it and give advice based on my experience from that macOS binary maintenance if that's useful.

Cheers,
Simon


> On May 12, 2023, at 8:36 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> Hi Reed,
> 
> On 11 May 2023 at 11:15, Reed A. Cartwright wrote:
> | I'm curious why you chose to call cmake from make instead of from configure.
> | I've always seen cmake as part of the configure step of package building.
> 
> Great question! Couple of small answers: i) This started as a 'proof of
> concept' that aimed to be small so getting by without requiring `configure`
> seemed worth a try, ii) I had seen another src/Makevars invoking compilation
> of a static library in a similar (albeit non-cmake) way and iii) as we now
> know about section 1.2.6 (or soon 1.2.9) 'Using cmake' has it that way too.
> 
> Otherwise I quite like having `configure` and I frequently use it -- made
> from 'genuine' configire.in via `autoconf`, or as scripts in shell or other
> languages.
> 
> Cheers, Dirk
> 
> PS My repaired package is now on CRAN. I managed to bungle the static library
> build (by not telling `cmake` to use position independent code), bungled
> macOS but not telling myself where `cmake` could live, and in fixing that
> bungled Windows by forgetting to add `src/Makevars.win` fallback. Yay me.
> 
> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 


From |uc@r @end|ng |rom |edor@project@org  Fri May 12 09:47:46 2023
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Fri, 12 May 2023 09:47:46 +0200
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <3DA9BC4C-BDE8-4416-A5EC-39D1C9C5D086@R-project.org>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <25691.61713.694694.136591@stat.math.ethz.ch>
 <25692.37641.759470.866071@stat.math.ethz.ch>
 <25692.52867.527375.152408@rob.eddelbuettel.com>
 <CALOkxuym-etr-B_bv1bd+KjuUKo2ApVYgfa4fKG5hp5ZusonfA@mail.gmail.com>
 <25693.20954.566598.812151@rob.eddelbuettel.com>
 <3DA9BC4C-BDE8-4416-A5EC-39D1C9C5D086@R-project.org>
Message-ID: <CALEXWq3a9=QGXBdnhnyS0Y7USzbhU1igrb6H394L1qNaCt3+7g@mail.gmail.com>

El vie., 12 may. 2023 5:58, Simon Urbanek <simon.urbanek at r-project.org>
escribi?:

> I think it would be quite useful to have some community repository of code
> snippets dealing with such situations. R-exts gives advice and pieces of
> code which are useful, but they are not complete solutions and situations
> like Dirk's example are not that uncommon. (E.g., I recall some of the
> spatial packages copy/pasting code from each other for quote some time -
> which works, but is error prone if changes need to be made).
>

This seems like a nice project for https://github.com/r-devel :)

I?aki



> If one has to rely on a 3rd party library and one wants to fall back to
> source compilation when it is not available, it is a quite complex task,
> because one has to match the library's build system to R's and the package
> build rules as well. There are many ways where this can go wrong - Dirk
> mentioned some of them - and ideally not every package developer in that
> situation should be going through the pain of learning all the details the
> hard way.
>
> Of course there are other packages as an example, but for someone not
> familiar with the details it's hard to see which ones do it right, and
> which ones don't - we don't always catch all the bad cases on CRAN.
>
> I don't have a specific proposal, but if there was a GitHub repo or wiki
> or something to try to distill the useful bits from existing packages, I'd
> be happy to review it and give advice based on my experience from that
> macOS binary maintenance if that's useful.
>
> Cheers,
> Simon
>
>
> > On May 12, 2023, at 8:36 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
> >
> >
> > Hi Reed,
> >
> > On 11 May 2023 at 11:15, Reed A. Cartwright wrote:
> > | I'm curious why you chose to call cmake from make instead of from
> configure.
> > | I've always seen cmake as part of the configure step of package
> building.
> >
> > Great question! Couple of small answers: i) This started as a 'proof of
> > concept' that aimed to be small so getting by without requiring
> `configure`
> > seemed worth a try, ii) I had seen another src/Makevars invoking
> compilation
> > of a static library in a similar (albeit non-cmake) way and iii) as we
> now
> > know about section 1.2.6 (or soon 1.2.9) 'Using cmake' has it that way
> too.
> >
> > Otherwise I quite like having `configure` and I frequently use it -- made
> > from 'genuine' configire.in via `autoconf`, or as scripts in shell or
> other
> > languages.
> >
> > Cheers, Dirk
> >
> > PS My repaired package is now on CRAN. I managed to bungle the static
> library
> > build (by not telling `cmake` to use position independent code), bungled
> > macOS but not telling myself where `cmake` could live, and in fixing that
> > bungled Windows by forgetting to add `src/Makevars.win` fallback. Yay me.
> >
> > --
> > dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> >
> > ______________________________________________
> > R-package-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>

	[[alternative HTML version deleted]]


From t|m@t@y|or @end|ng |rom h|ddene|eph@nt@@co@uk  Fri May 12 10:07:51 2023
From: t|m@t@y|or @end|ng |rom h|ddene|eph@nt@@co@uk (Tim Taylor)
Date: Fri, 12 May 2023 09:07:51 +0100
Subject: [R-pkg-devel] Please install cmake on macOS builders
In-Reply-To: <CALEXWq3a9=QGXBdnhnyS0Y7USzbhU1igrb6H394L1qNaCt3+7g@mail.gmail.com>
References: <25691.34721.521790.758811@rob.eddelbuettel.com>
 <25691.61713.694694.136591@stat.math.ethz.ch>
 <25692.37641.759470.866071@stat.math.ethz.ch>
 <25692.52867.527375.152408@rob.eddelbuettel.com>
 <CALOkxuym-etr-B_bv1bd+KjuUKo2ApVYgfa4fKG5hp5ZusonfA@mail.gmail.com>
 <25693.20954.566598.812151@rob.eddelbuettel.com>
 <3DA9BC4C-BDE8-4416-A5EC-39D1C9C5D086@R-project.org>
 <CALEXWq3a9=QGXBdnhnyS0Y7USzbhU1igrb6H394L1qNaCt3+7g@mail.gmail.com>
Message-ID: <4092f44a-9fc6-b60e-e920-01a6a06568b4@hiddenelephants.co.uk>

On 12/05/2023 08:47, I?aki Ucar wrote:
> El vie., 12 may. 2023 5:58, Simon Urbanek <simon.urbanek at r-project.org>
> escribi?:
>
>> I think it would be quite useful to have some community repository of code
>> snippets dealing with such situations. R-exts gives advice and pieces of
>> code which are useful, but they are not complete solutions and situations
>> like Dirk's example are not that uncommon. (E.g., I recall some of the
>> spatial packages copy/pasting code from each other for quote some time -
>> which works, but is error prone if changes need to be made).
>>
> This seems like a nice project for https://github.com/r-devel :)
>
> I?aki

I've also flagged in the #core-documentation channel of the R 
Contributors Slack (https://contributor.r-project.org/slack). It may (or 
may not) be something that they would like to look at during the 
upcoming R Project Sprint. I know Jeroen previously provided some 
guidance for rust (https://github.com/r-rust/faq) after a similar call 
from Simon last year. Centralising some of this community provided 
guidance under https://github.com/r-devel seems like it could be useful, 
especially when there is an offer of review from R-Core.

Tim

>
>> If one has to rely on a 3rd party library and one wants to fall back to
>> source compilation when it is not available, it is a quite complex task,
>> because one has to match the library's build system to R's and the package
>> build rules as well. There are many ways where this can go wrong - Dirk
>> mentioned some of them - and ideally not every package developer in that
>> situation should be going through the pain of learning all the details the
>> hard way.
>>
>> Of course there are other packages as an example, but for someone not
>> familiar with the details it's hard to see which ones do it right, and
>> which ones don't - we don't always catch all the bad cases on CRAN.
>>
>> I don't have a specific proposal, but if there was a GitHub repo or wiki
>> or something to try to distill the useful bits from existing packages, I'd
>> be happy to review it and give advice based on my experience from that
>> macOS binary maintenance if that's useful.
>>
>> Cheers,
>> Simon
>>
>>
>>> On May 12, 2023, at 8:36 AM, Dirk Eddelbuettel <edd at debian.org> wrote:
>>>
>>>
>>> Hi Reed,
>>>
>>> On 11 May 2023 at 11:15, Reed A. Cartwright wrote:
>>> | I'm curious why you chose to call cmake from make instead of from
>> configure.
>>> | I've always seen cmake as part of the configure step of package
>> building.
>>> Great question! Couple of small answers: i) This started as a 'proof of
>>> concept' that aimed to be small so getting by without requiring
>> `configure`
>>> seemed worth a try, ii) I had seen another src/Makevars invoking
>> compilation
>>> of a static library in a similar (albeit non-cmake) way and iii) as we
>> now
>>> know about section 1.2.6 (or soon 1.2.9) 'Using cmake' has it that way
>> too.
>>> Otherwise I quite like having `configure` and I frequently use it -- made
>>> from 'genuine' configire.in via `autoconf`, or as scripts in shell or
>> other
>>> languages.
>>>
>>> Cheers, Dirk
>>>
>>> PS My repaired package is now on CRAN. I managed to bungle the static
>> library
>>> build (by not telling `cmake` to use position independent code), bungled
>>> macOS but not telling myself where `cmake` could live, and in fixing that
>>> bungled Windows by forgetting to add `src/Makevars.win` fallback. Yay me.
>>>
>>> --
>>> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


